var Oee=Object.defineProperty;var Tk=r=>{throw TypeError(r)};var Nee=(r,e,t)=>e in r?Oee(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ia=(r,e,t)=>Nee(r,typeof e!="symbol"?e+"":e,t),l1=(r,e,t)=>e.has(r)||Tk("Cannot "+t);var J=(r,e,t)=>(l1(r,e,"read from private field"),t?t.call(r):e.get(r)),Qe=(r,e,t)=>e.has(r)?Tk("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),Ie=(r,e,t,i)=>(l1(r,e,"write to private field"),i?i.call(r,t):e.set(r,t),t),ur=(r,e,t)=>(l1(r,e,"access private method"),t);var t0=(r,e,t,i)=>({set _(s){Ie(r,e,s,t)},get _(){return J(r,e,i)}});function kee(r,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const s in i)if(s!=="default"&&!(s in r)){const n=Object.getOwnPropertyDescriptor(i,s);n&&Object.defineProperty(r,s,n.get?n:{enumerable:!0,get:()=>i[s]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();var xr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function pt(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Fee(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(i){var s=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:function(){return r[i]}})}),t}var bH={exports:{}},gT={},wH={exports:{}},je={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ey=Symbol.for("react.element"),Bee=Symbol.for("react.portal"),Uee=Symbol.for("react.fragment"),zee=Symbol.for("react.strict_mode"),Vee=Symbol.for("react.profiler"),jee=Symbol.for("react.provider"),$ee=Symbol.for("react.context"),Hee=Symbol.for("react.forward_ref"),Gee=Symbol.for("react.suspense"),Wee=Symbol.for("react.memo"),Xee=Symbol.for("react.lazy"),Ek=Symbol.iterator;function qee(r){return r===null||typeof r!="object"?null:(r=Ek&&r[Ek]||r["@@iterator"],typeof r=="function"?r:null)}var TH={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},EH=Object.assign,AH={};function em(r,e,t){this.props=r,this.context=e,this.refs=AH,this.updater=t||TH}em.prototype.isReactComponent={};em.prototype.setState=function(r,e){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,e,"setState")};em.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function CH(){}CH.prototype=em.prototype;function kD(r,e,t){this.props=r,this.context=e,this.refs=AH,this.updater=t||TH}var FD=kD.prototype=new CH;FD.constructor=kD;EH(FD,em.prototype);FD.isPureReactComponent=!0;var Ak=Array.isArray,PH=Object.prototype.hasOwnProperty,BD={current:null},IH={key:!0,ref:!0,__self:!0,__source:!0};function MH(r,e,t){var i,s={},n=null,a=null;if(e!=null)for(i in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(n=""+e.key),e)PH.call(e,i)&&!IH.hasOwnProperty(i)&&(s[i]=e[i]);var o=arguments.length-2;if(o===1)s.children=t;else if(1<o){for(var l=Array(o),c=0;c<o;c++)l[c]=arguments[c+2];s.children=l}if(r&&r.defaultProps)for(i in o=r.defaultProps,o)s[i]===void 0&&(s[i]=o[i]);return{$$typeof:ey,type:r,key:n,ref:a,props:s,_owner:BD.current}}function Yee(r,e){return{$$typeof:ey,type:r.type,key:e,ref:r.ref,props:r.props,_owner:r._owner}}function UD(r){return typeof r=="object"&&r!==null&&r.$$typeof===ey}function Kee(r){var e={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(t){return e[t]})}var Ck=/\/+/g;function c1(r,e){return typeof r=="object"&&r!==null&&r.key!=null?Kee(""+r.key):e.toString(36)}function US(r,e,t,i,s){var n=typeof r;(n==="undefined"||n==="boolean")&&(r=null);var a=!1;if(r===null)a=!0;else switch(n){case"string":case"number":a=!0;break;case"object":switch(r.$$typeof){case ey:case Bee:a=!0}}if(a)return a=r,s=s(a),r=i===""?"."+c1(a,0):i,Ak(s)?(t="",r!=null&&(t=r.replace(Ck,"$&/")+"/"),US(s,e,t,"",function(c){return c})):s!=null&&(UD(s)&&(s=Yee(s,t+(!s.key||a&&a.key===s.key?"":(""+s.key).replace(Ck,"$&/")+"/")+r)),e.push(s)),1;if(a=0,i=i===""?".":i+":",Ak(r))for(var o=0;o<r.length;o++){n=r[o];var l=i+c1(n,o);a+=US(n,e,t,l,s)}else if(l=qee(r),typeof l=="function")for(r=l.call(r),o=0;!(n=r.next()).done;)n=n.value,l=i+c1(n,o++),a+=US(n,e,t,l,s);else if(n==="object")throw e=String(r),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function i0(r,e,t){if(r==null)return r;var i=[],s=0;return US(r,i,"","",function(n){return e.call(t,n,s++)}),i}function Zee(r){if(r._status===-1){var e=r._result;e=e(),e.then(function(t){(r._status===0||r._status===-1)&&(r._status=1,r._result=t)},function(t){(r._status===0||r._status===-1)&&(r._status=2,r._result=t)}),r._status===-1&&(r._status=0,r._result=e)}if(r._status===1)return r._result.default;throw r._result}var Ur={current:null},zS={transition:null},Qee={ReactCurrentDispatcher:Ur,ReactCurrentBatchConfig:zS,ReactCurrentOwner:BD};function RH(){throw Error("act(...) is not supported in production builds of React.")}je.Children={map:i0,forEach:function(r,e,t){i0(r,function(){e.apply(this,arguments)},t)},count:function(r){var e=0;return i0(r,function(){e++}),e},toArray:function(r){return i0(r,function(e){return e})||[]},only:function(r){if(!UD(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};je.Component=em;je.Fragment=Uee;je.Profiler=Vee;je.PureComponent=kD;je.StrictMode=zee;je.Suspense=Gee;je.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Qee;je.act=RH;je.cloneElement=function(r,e,t){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var i=EH({},r.props),s=r.key,n=r.ref,a=r._owner;if(e!=null){if(e.ref!==void 0&&(n=e.ref,a=BD.current),e.key!==void 0&&(s=""+e.key),r.type&&r.type.defaultProps)var o=r.type.defaultProps;for(l in e)PH.call(e,l)&&!IH.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=t;else if(1<l){o=Array(l);for(var c=0;c<l;c++)o[c]=arguments[c+2];i.children=o}return{$$typeof:ey,type:r.type,key:s,ref:n,props:i,_owner:a}};je.createContext=function(r){return r={$$typeof:$ee,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:jee,_context:r},r.Consumer=r};je.createElement=MH;je.createFactory=function(r){var e=MH.bind(null,r);return e.type=r,e};je.createRef=function(){return{current:null}};je.forwardRef=function(r){return{$$typeof:Hee,render:r}};je.isValidElement=UD;je.lazy=function(r){return{$$typeof:Xee,_payload:{_status:-1,_result:r},_init:Zee}};je.memo=function(r,e){return{$$typeof:Wee,type:r,compare:e===void 0?null:e}};je.startTransition=function(r){var e=zS.transition;zS.transition={};try{r()}finally{zS.transition=e}};je.unstable_act=RH;je.useCallback=function(r,e){return Ur.current.useCallback(r,e)};je.useContext=function(r){return Ur.current.useContext(r)};je.useDebugValue=function(){};je.useDeferredValue=function(r){return Ur.current.useDeferredValue(r)};je.useEffect=function(r,e){return Ur.current.useEffect(r,e)};je.useId=function(){return Ur.current.useId()};je.useImperativeHandle=function(r,e,t){return Ur.current.useImperativeHandle(r,e,t)};je.useInsertionEffect=function(r,e){return Ur.current.useInsertionEffect(r,e)};je.useLayoutEffect=function(r,e){return Ur.current.useLayoutEffect(r,e)};je.useMemo=function(r,e){return Ur.current.useMemo(r,e)};je.useReducer=function(r,e,t){return Ur.current.useReducer(r,e,t)};je.useRef=function(r){return Ur.current.useRef(r)};je.useState=function(r){return Ur.current.useState(r)};je.useSyncExternalStore=function(r,e,t){return Ur.current.useSyncExternalStore(r,e,t)};je.useTransition=function(){return Ur.current.useTransition()};je.version="18.3.1";wH.exports=je;var E=wH.exports;const U=pt(E),zD=kee({__proto__:null,default:U},[E]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jee=E,ete=Symbol.for("react.element"),tte=Symbol.for("react.fragment"),ite=Object.prototype.hasOwnProperty,rte=Jee.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ste={key:!0,ref:!0,__self:!0,__source:!0};function DH(r,e,t){var i,s={},n=null,a=null;t!==void 0&&(n=""+t),e.key!==void 0&&(n=""+e.key),e.ref!==void 0&&(a=e.ref);for(i in e)ite.call(e,i)&&!ste.hasOwnProperty(i)&&(s[i]=e[i]);if(r&&r.defaultProps)for(i in e=r.defaultProps,e)s[i]===void 0&&(s[i]=e[i]);return{$$typeof:ete,type:r,key:n,ref:a,props:s,_owner:rte.current}}gT.Fragment=tte;gT.jsx=DH;gT.jsxs=DH;bH.exports=gT;var b=bH.exports,LH={exports:{}},ks={},OH={exports:{}},NH={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function e(L,D){var F=L.length;L.push(D);e:for(;0<F;){var j=F-1>>>1,z=L[j];if(0<s(z,D))L[j]=D,L[F]=z,F=j;else break e}}function t(L){return L.length===0?null:L[0]}function i(L){if(L.length===0)return null;var D=L[0],F=L.pop();if(F!==D){L[0]=F;e:for(var j=0,z=L.length,$=z>>>1;j<$;){var H=2*(j+1)-1,G=L[H],Y=H+1,W=L[Y];if(0>s(G,F))Y<z&&0>s(W,G)?(L[j]=W,L[Y]=F,j=Y):(L[j]=G,L[H]=F,j=H);else if(Y<z&&0>s(W,F))L[j]=W,L[Y]=F,j=Y;else break e}}return D}function s(L,D){var F=L.sortIndex-D.sortIndex;return F!==0?F:L.id-D.id}if(typeof performance=="object"&&typeof performance.now=="function"){var n=performance;r.unstable_now=function(){return n.now()}}else{var a=Date,o=a.now();r.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,f=!1,p=!1,m=!1,g=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(L){for(var D=t(c);D!==null;){if(D.callback===null)i(c);else if(D.startTime<=L)i(c),D.sortIndex=D.expirationTime,e(l,D);else break;D=t(c)}}function x(L){if(m=!1,y(L),!p)if(t(l)!==null)p=!0,B(S);else{var D=t(c);D!==null&&R(x,D.startTime-L)}}function S(L,D){p=!1,m&&(m=!1,_(A),A=-1),f=!0;var F=d;try{for(y(D),h=t(l);h!==null&&(!(h.expirationTime>D)||L&&!I());){var j=h.callback;if(typeof j=="function"){h.callback=null,d=h.priorityLevel;var z=j(h.expirationTime<=D);D=r.unstable_now(),typeof z=="function"?h.callback=z:h===t(l)&&i(l),y(D)}else i(l);h=t(l)}if(h!==null)var $=!0;else{var H=t(c);H!==null&&R(x,H.startTime-D),$=!1}return $}finally{h=null,d=F,f=!1}}var w=!1,T=null,A=-1,C=5,P=-1;function I(){return!(r.unstable_now()-P<C)}function M(){if(T!==null){var L=r.unstable_now();P=L;var D=!0;try{D=T(!0,L)}finally{D?N():(w=!1,T=null)}}else w=!1}var N;if(typeof v=="function")N=function(){v(M)};else if(typeof MessageChannel<"u"){var k=new MessageChannel,V=k.port2;k.port1.onmessage=M,N=function(){V.postMessage(null)}}else N=function(){g(M,0)};function B(L){T=L,w||(w=!0,N())}function R(L,D){A=g(function(){L(r.unstable_now())},D)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(L){L.callback=null},r.unstable_continueExecution=function(){p||f||(p=!0,B(S))},r.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<L?Math.floor(1e3/L):5},r.unstable_getCurrentPriorityLevel=function(){return d},r.unstable_getFirstCallbackNode=function(){return t(l)},r.unstable_next=function(L){switch(d){case 1:case 2:case 3:var D=3;break;default:D=d}var F=d;d=D;try{return L()}finally{d=F}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(L,D){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var F=d;d=L;try{return D()}finally{d=F}},r.unstable_scheduleCallback=function(L,D,F){var j=r.unstable_now();switch(typeof F=="object"&&F!==null?(F=F.delay,F=typeof F=="number"&&0<F?j+F:j):F=j,L){case 1:var z=-1;break;case 2:z=250;break;case 5:z=1073741823;break;case 4:z=1e4;break;default:z=5e3}return z=F+z,L={id:u++,callback:D,priorityLevel:L,startTime:F,expirationTime:z,sortIndex:-1},F>j?(L.sortIndex=F,e(c,L),t(l)===null&&L===t(c)&&(m?(_(A),A=-1):m=!0,R(x,F-j))):(L.sortIndex=z,e(l,L),p||f||(p=!0,B(S))),L},r.unstable_shouldYield=I,r.unstable_wrapCallback=function(L){var D=d;return function(){var F=d;d=D;try{return L.apply(this,arguments)}finally{d=F}}}})(NH);OH.exports=NH;var nte=OH.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ate=E,Is=nte;function re(r){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+r,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+r+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var kH=new Set,b_={};function Ih(r,e){Yf(r,e),Yf(r+"Capture",e)}function Yf(r,e){for(b_[r]=e,r=0;r<e.length;r++)kH.add(e[r])}var Wo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),$P=Object.prototype.hasOwnProperty,ote=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Pk={},Ik={};function lte(r){return $P.call(Ik,r)?!0:$P.call(Pk,r)?!1:ote.test(r)?Ik[r]=!0:(Pk[r]=!0,!1)}function cte(r,e,t,i){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:t!==null?!t.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function ute(r,e,t,i){if(e===null||typeof e>"u"||cte(r,e,t,i))return!0;if(i)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function zr(r,e,t,i,s,n,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=r,this.type=e,this.sanitizeURL=n,this.removeEmptyString=a}var nr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){nr[r]=new zr(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var e=r[0];nr[e]=new zr(e,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){nr[r]=new zr(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){nr[r]=new zr(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){nr[r]=new zr(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){nr[r]=new zr(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){nr[r]=new zr(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){nr[r]=new zr(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){nr[r]=new zr(r,5,!1,r.toLowerCase(),null,!1,!1)});var VD=/[\-:]([a-z])/g;function jD(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var e=r.replace(VD,jD);nr[e]=new zr(e,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var e=r.replace(VD,jD);nr[e]=new zr(e,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var e=r.replace(VD,jD);nr[e]=new zr(e,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){nr[r]=new zr(r,1,!1,r.toLowerCase(),null,!1,!1)});nr.xlinkHref=new zr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){nr[r]=new zr(r,1,!1,r.toLowerCase(),null,!0,!0)});function $D(r,e,t,i){var s=nr.hasOwnProperty(e)?nr[e]:null;(s!==null?s.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(ute(e,t,s,i)&&(t=null),i||s===null?lte(e)&&(t===null?r.removeAttribute(e):r.setAttribute(e,""+t)):s.mustUseProperty?r[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,i=s.attributeNamespace,t===null?r.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,i?r.setAttributeNS(i,e,t):r.setAttribute(e,t))))}var rl=ate.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,r0=Symbol.for("react.element"),Nd=Symbol.for("react.portal"),kd=Symbol.for("react.fragment"),HD=Symbol.for("react.strict_mode"),HP=Symbol.for("react.profiler"),FH=Symbol.for("react.provider"),BH=Symbol.for("react.context"),GD=Symbol.for("react.forward_ref"),GP=Symbol.for("react.suspense"),WP=Symbol.for("react.suspense_list"),WD=Symbol.for("react.memo"),Al=Symbol.for("react.lazy"),UH=Symbol.for("react.offscreen"),Mk=Symbol.iterator;function Om(r){return r===null||typeof r!="object"?null:(r=Mk&&r[Mk]||r["@@iterator"],typeof r=="function"?r:null)}var ri=Object.assign,u1;function bg(r){if(u1===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);u1=e&&e[1]||""}return`
`+u1+r}var h1=!1;function d1(r,e){if(!r||h1)return"";h1=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(r,[],e)}else{try{e.call()}catch(c){i=c}r.call(e.prototype)}else{try{throw Error()}catch(c){i=c}r()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var s=c.stack.split(`
`),n=i.stack.split(`
`),a=s.length-1,o=n.length-1;1<=a&&0<=o&&s[a]!==n[o];)o--;for(;1<=a&&0<=o;a--,o--)if(s[a]!==n[o]){if(a!==1||o!==1)do if(a--,o--,0>o||s[a]!==n[o]){var l=`
`+s[a].replace(" at new "," at ");return r.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",r.displayName)),l}while(1<=a&&0<=o);break}}}finally{h1=!1,Error.prepareStackTrace=t}return(r=r?r.displayName||r.name:"")?bg(r):""}function hte(r){switch(r.tag){case 5:return bg(r.type);case 16:return bg("Lazy");case 13:return bg("Suspense");case 19:return bg("SuspenseList");case 0:case 2:case 15:return r=d1(r.type,!1),r;case 11:return r=d1(r.type.render,!1),r;case 1:return r=d1(r.type,!0),r;default:return""}}function XP(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case kd:return"Fragment";case Nd:return"Portal";case HP:return"Profiler";case HD:return"StrictMode";case GP:return"Suspense";case WP:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case BH:return(r.displayName||"Context")+".Consumer";case FH:return(r._context.displayName||"Context")+".Provider";case GD:var e=r.render;return r=r.displayName,r||(r=e.displayName||e.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case WD:return e=r.displayName||null,e!==null?e:XP(r.type)||"Memo";case Al:e=r._payload,r=r._init;try{return XP(r(e))}catch{}}return null}function dte(r){var e=r.type;switch(r.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=e.render,r=r.displayName||r.name||"",e.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return XP(e);case 8:return e===HD?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function _c(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function zH(r){var e=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function fte(r){var e=zH(r)?"checked":"value",t=Object.getOwnPropertyDescriptor(r.constructor.prototype,e),i=""+r[e];if(!r.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,n=t.set;return Object.defineProperty(r,e,{configurable:!0,get:function(){return s.call(this)},set:function(a){i=""+a,n.call(this,a)}}),Object.defineProperty(r,e,{enumerable:t.enumerable}),{getValue:function(){return i},setValue:function(a){i=""+a},stopTracking:function(){r._valueTracker=null,delete r[e]}}}}function s0(r){r._valueTracker||(r._valueTracker=fte(r))}function VH(r){if(!r)return!1;var e=r._valueTracker;if(!e)return!0;var t=e.getValue(),i="";return r&&(i=zH(r)?r.checked?"true":"false":r.value),r=i,r!==t?(e.setValue(r),!0):!1}function xx(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function qP(r,e){var t=e.checked;return ri({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??r._wrapperState.initialChecked})}function Rk(r,e){var t=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;t=_c(e.value!=null?e.value:t),r._wrapperState={initialChecked:i,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function jH(r,e){e=e.checked,e!=null&&$D(r,"checked",e,!1)}function YP(r,e){jH(r,e);var t=_c(e.value),i=e.type;if(t!=null)i==="number"?(t===0&&r.value===""||r.value!=t)&&(r.value=""+t):r.value!==""+t&&(r.value=""+t);else if(i==="submit"||i==="reset"){r.removeAttribute("value");return}e.hasOwnProperty("value")?KP(r,e.type,t):e.hasOwnProperty("defaultValue")&&KP(r,e.type,_c(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(r.defaultChecked=!!e.defaultChecked)}function Dk(r,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+r._wrapperState.initialValue,t||e===r.value||(r.value=e),r.defaultValue=e}t=r.name,t!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,t!==""&&(r.name=t)}function KP(r,e,t){(e!=="number"||xx(r.ownerDocument)!==r)&&(t==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+t&&(r.defaultValue=""+t))}var wg=Array.isArray;function gf(r,e,t,i){if(r=r.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<r.length;t++)s=e.hasOwnProperty("$"+r[t].value),r[t].selected!==s&&(r[t].selected=s),s&&i&&(r[t].defaultSelected=!0)}else{for(t=""+_c(t),e=null,s=0;s<r.length;s++){if(r[s].value===t){r[s].selected=!0,i&&(r[s].defaultSelected=!0);return}e!==null||r[s].disabled||(e=r[s])}e!==null&&(e.selected=!0)}}function ZP(r,e){if(e.dangerouslySetInnerHTML!=null)throw Error(re(91));return ri({},e,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function Lk(r,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(re(92));if(wg(t)){if(1<t.length)throw Error(re(93));t=t[0]}e=t}e==null&&(e=""),t=e}r._wrapperState={initialValue:_c(t)}}function $H(r,e){var t=_c(e.value),i=_c(e.defaultValue);t!=null&&(t=""+t,t!==r.value&&(r.value=t),e.defaultValue==null&&r.defaultValue!==t&&(r.defaultValue=t)),i!=null&&(r.defaultValue=""+i)}function Ok(r){var e=r.textContent;e===r._wrapperState.initialValue&&e!==""&&e!==null&&(r.value=e)}function HH(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function QP(r,e){return r==null||r==="http://www.w3.org/1999/xhtml"?HH(e):r==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var n0,GH=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,i,s){MSApp.execUnsafeLocalFunction(function(){return r(e,t,i,s)})}:r}(function(r,e){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=e;else{for(n0=n0||document.createElement("div"),n0.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=n0.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;e.firstChild;)r.appendChild(e.firstChild)}});function w_(r,e){if(e){var t=r.firstChild;if(t&&t===r.lastChild&&t.nodeType===3){t.nodeValue=e;return}}r.textContent=e}var Og={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pte=["Webkit","ms","Moz","O"];Object.keys(Og).forEach(function(r){pte.forEach(function(e){e=e+r.charAt(0).toUpperCase()+r.substring(1),Og[e]=Og[r]})});function WH(r,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Og.hasOwnProperty(r)&&Og[r]?(""+e).trim():e+"px"}function XH(r,e){r=r.style;for(var t in e)if(e.hasOwnProperty(t)){var i=t.indexOf("--")===0,s=WH(t,e[t],i);t==="float"&&(t="cssFloat"),i?r.setProperty(t,s):r[t]=s}}var mte=ri({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function JP(r,e){if(e){if(mte[r]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(re(137,r));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(re(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(re(61))}if(e.style!=null&&typeof e.style!="object")throw Error(re(62))}}function eI(r,e){if(r.indexOf("-")===-1)return typeof e.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var tI=null;function XD(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var iI=null,_f=null,vf=null;function Nk(r){if(r=ry(r)){if(typeof iI!="function")throw Error(re(280));var e=r.stateNode;e&&(e=xT(e),iI(r.stateNode,r.type,e))}}function qH(r){_f?vf?vf.push(r):vf=[r]:_f=r}function YH(){if(_f){var r=_f,e=vf;if(vf=_f=null,Nk(r),e)for(r=0;r<e.length;r++)Nk(e[r])}}function KH(r,e){return r(e)}function ZH(){}var f1=!1;function QH(r,e,t){if(f1)return r(e,t);f1=!0;try{return KH(r,e,t)}finally{f1=!1,(_f!==null||vf!==null)&&(ZH(),YH())}}function T_(r,e){var t=r.stateNode;if(t===null)return null;var i=xT(t);if(i===null)return null;t=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(r=r.type,i=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!i;break e;default:r=!1}if(r)return null;if(t&&typeof t!="function")throw Error(re(231,e,typeof t));return t}var rI=!1;if(Wo)try{var Nm={};Object.defineProperty(Nm,"passive",{get:function(){rI=!0}}),window.addEventListener("test",Nm,Nm),window.removeEventListener("test",Nm,Nm)}catch{rI=!1}function gte(r,e,t,i,s,n,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(u){this.onError(u)}}var Ng=!1,bx=null,wx=!1,sI=null,_te={onError:function(r){Ng=!0,bx=r}};function vte(r,e,t,i,s,n,a,o,l){Ng=!1,bx=null,gte.apply(_te,arguments)}function yte(r,e,t,i,s,n,a,o,l){if(vte.apply(this,arguments),Ng){if(Ng){var c=bx;Ng=!1,bx=null}else throw Error(re(198));wx||(wx=!0,sI=c)}}function Mh(r){var e=r,t=r;if(r.alternate)for(;e.return;)e=e.return;else{r=e;do e=r,e.flags&4098&&(t=e.return),r=e.return;while(r)}return e.tag===3?t:null}function JH(r){if(r.tag===13){var e=r.memoizedState;if(e===null&&(r=r.alternate,r!==null&&(e=r.memoizedState)),e!==null)return e.dehydrated}return null}function kk(r){if(Mh(r)!==r)throw Error(re(188))}function Ste(r){var e=r.alternate;if(!e){if(e=Mh(r),e===null)throw Error(re(188));return e!==r?null:r}for(var t=r,i=e;;){var s=t.return;if(s===null)break;var n=s.alternate;if(n===null){if(i=s.return,i!==null){t=i;continue}break}if(s.child===n.child){for(n=s.child;n;){if(n===t)return kk(s),r;if(n===i)return kk(s),e;n=n.sibling}throw Error(re(188))}if(t.return!==i.return)t=s,i=n;else{for(var a=!1,o=s.child;o;){if(o===t){a=!0,t=s,i=n;break}if(o===i){a=!0,i=s,t=n;break}o=o.sibling}if(!a){for(o=n.child;o;){if(o===t){a=!0,t=n,i=s;break}if(o===i){a=!0,i=n,t=s;break}o=o.sibling}if(!a)throw Error(re(189))}}if(t.alternate!==i)throw Error(re(190))}if(t.tag!==3)throw Error(re(188));return t.stateNode.current===t?r:e}function eG(r){return r=Ste(r),r!==null?tG(r):null}function tG(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var e=tG(r);if(e!==null)return e;r=r.sibling}return null}var iG=Is.unstable_scheduleCallback,Fk=Is.unstable_cancelCallback,xte=Is.unstable_shouldYield,bte=Is.unstable_requestPaint,gi=Is.unstable_now,wte=Is.unstable_getCurrentPriorityLevel,qD=Is.unstable_ImmediatePriority,rG=Is.unstable_UserBlockingPriority,Tx=Is.unstable_NormalPriority,Tte=Is.unstable_LowPriority,sG=Is.unstable_IdlePriority,_T=null,Ra=null;function Ete(r){if(Ra&&typeof Ra.onCommitFiberRoot=="function")try{Ra.onCommitFiberRoot(_T,r,void 0,(r.current.flags&128)===128)}catch{}}var $n=Math.clz32?Math.clz32:Pte,Ate=Math.log,Cte=Math.LN2;function Pte(r){return r>>>=0,r===0?32:31-(Ate(r)/Cte|0)|0}var a0=64,o0=4194304;function Tg(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function Ex(r,e){var t=r.pendingLanes;if(t===0)return 0;var i=0,s=r.suspendedLanes,n=r.pingedLanes,a=t&268435455;if(a!==0){var o=a&~s;o!==0?i=Tg(o):(n&=a,n!==0&&(i=Tg(n)))}else a=t&~s,a!==0?i=Tg(a):n!==0&&(i=Tg(n));if(i===0)return 0;if(e!==0&&e!==i&&!(e&s)&&(s=i&-i,n=e&-e,s>=n||s===16&&(n&4194240)!==0))return e;if(i&4&&(i|=t&16),e=r.entangledLanes,e!==0)for(r=r.entanglements,e&=i;0<e;)t=31-$n(e),s=1<<t,i|=r[t],e&=~s;return i}function Ite(r,e){switch(r){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Mte(r,e){for(var t=r.suspendedLanes,i=r.pingedLanes,s=r.expirationTimes,n=r.pendingLanes;0<n;){var a=31-$n(n),o=1<<a,l=s[a];l===-1?(!(o&t)||o&i)&&(s[a]=Ite(o,e)):l<=e&&(r.expiredLanes|=o),n&=~o}}function nI(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function nG(){var r=a0;return a0<<=1,!(a0&4194240)&&(a0=64),r}function p1(r){for(var e=[],t=0;31>t;t++)e.push(r);return e}function ty(r,e,t){r.pendingLanes|=e,e!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,e=31-$n(e),r[e]=t}function Rte(r,e){var t=r.pendingLanes&~e;r.pendingLanes=e,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=e,r.mutableReadLanes&=e,r.entangledLanes&=e,e=r.entanglements;var i=r.eventTimes;for(r=r.expirationTimes;0<t;){var s=31-$n(t),n=1<<s;e[s]=0,i[s]=-1,r[s]=-1,t&=~n}}function YD(r,e){var t=r.entangledLanes|=e;for(r=r.entanglements;t;){var i=31-$n(t),s=1<<i;s&e|r[i]&e&&(r[i]|=e),t&=~s}}var ft=0;function aG(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var oG,KD,lG,cG,uG,aI=!1,l0=[],rc=null,sc=null,nc=null,E_=new Map,A_=new Map,jl=[],Dte="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Bk(r,e){switch(r){case"focusin":case"focusout":rc=null;break;case"dragenter":case"dragleave":sc=null;break;case"mouseover":case"mouseout":nc=null;break;case"pointerover":case"pointerout":E_.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":A_.delete(e.pointerId)}}function km(r,e,t,i,s,n){return r===null||r.nativeEvent!==n?(r={blockedOn:e,domEventName:t,eventSystemFlags:i,nativeEvent:n,targetContainers:[s]},e!==null&&(e=ry(e),e!==null&&KD(e)),r):(r.eventSystemFlags|=i,e=r.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),r)}function Lte(r,e,t,i,s){switch(e){case"focusin":return rc=km(rc,r,e,t,i,s),!0;case"dragenter":return sc=km(sc,r,e,t,i,s),!0;case"mouseover":return nc=km(nc,r,e,t,i,s),!0;case"pointerover":var n=s.pointerId;return E_.set(n,km(E_.get(n)||null,r,e,t,i,s)),!0;case"gotpointercapture":return n=s.pointerId,A_.set(n,km(A_.get(n)||null,r,e,t,i,s)),!0}return!1}function hG(r){var e=bu(r.target);if(e!==null){var t=Mh(e);if(t!==null){if(e=t.tag,e===13){if(e=JH(t),e!==null){r.blockedOn=e,uG(r.priority,function(){lG(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){r.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}r.blockedOn=null}function VS(r){if(r.blockedOn!==null)return!1;for(var e=r.targetContainers;0<e.length;){var t=oI(r.domEventName,r.eventSystemFlags,e[0],r.nativeEvent);if(t===null){t=r.nativeEvent;var i=new t.constructor(t.type,t);tI=i,t.target.dispatchEvent(i),tI=null}else return e=ry(t),e!==null&&KD(e),r.blockedOn=t,!1;e.shift()}return!0}function Uk(r,e,t){VS(r)&&t.delete(e)}function Ote(){aI=!1,rc!==null&&VS(rc)&&(rc=null),sc!==null&&VS(sc)&&(sc=null),nc!==null&&VS(nc)&&(nc=null),E_.forEach(Uk),A_.forEach(Uk)}function Fm(r,e){r.blockedOn===e&&(r.blockedOn=null,aI||(aI=!0,Is.unstable_scheduleCallback(Is.unstable_NormalPriority,Ote)))}function C_(r){function e(s){return Fm(s,r)}if(0<l0.length){Fm(l0[0],r);for(var t=1;t<l0.length;t++){var i=l0[t];i.blockedOn===r&&(i.blockedOn=null)}}for(rc!==null&&Fm(rc,r),sc!==null&&Fm(sc,r),nc!==null&&Fm(nc,r),E_.forEach(e),A_.forEach(e),t=0;t<jl.length;t++)i=jl[t],i.blockedOn===r&&(i.blockedOn=null);for(;0<jl.length&&(t=jl[0],t.blockedOn===null);)hG(t),t.blockedOn===null&&jl.shift()}var yf=rl.ReactCurrentBatchConfig,Ax=!0;function Nte(r,e,t,i){var s=ft,n=yf.transition;yf.transition=null;try{ft=1,ZD(r,e,t,i)}finally{ft=s,yf.transition=n}}function kte(r,e,t,i){var s=ft,n=yf.transition;yf.transition=null;try{ft=4,ZD(r,e,t,i)}finally{ft=s,yf.transition=n}}function ZD(r,e,t,i){if(Ax){var s=oI(r,e,t,i);if(s===null)T1(r,e,i,Cx,t),Bk(r,i);else if(Lte(s,r,e,t,i))i.stopPropagation();else if(Bk(r,i),e&4&&-1<Dte.indexOf(r)){for(;s!==null;){var n=ry(s);if(n!==null&&oG(n),n=oI(r,e,t,i),n===null&&T1(r,e,i,Cx,t),n===s)break;s=n}s!==null&&i.stopPropagation()}else T1(r,e,i,null,t)}}var Cx=null;function oI(r,e,t,i){if(Cx=null,r=XD(i),r=bu(r),r!==null)if(e=Mh(r),e===null)r=null;else if(t=e.tag,t===13){if(r=JH(e),r!==null)return r;r=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;r=null}else e!==r&&(r=null);return Cx=r,null}function dG(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(wte()){case qD:return 1;case rG:return 4;case Tx:case Tte:return 16;case sG:return 536870912;default:return 16}default:return 16}}var Ql=null,QD=null,jS=null;function fG(){if(jS)return jS;var r,e=QD,t=e.length,i,s="value"in Ql?Ql.value:Ql.textContent,n=s.length;for(r=0;r<t&&e[r]===s[r];r++);var a=t-r;for(i=1;i<=a&&e[t-i]===s[n-i];i++);return jS=s.slice(r,1<i?1-i:void 0)}function $S(r){var e=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&e===13&&(r=13)):r=e,r===10&&(r=13),32<=r||r===13?r:0}function c0(){return!0}function zk(){return!1}function Fs(r){function e(t,i,s,n,a){this._reactName=t,this._targetInst=s,this.type=i,this.nativeEvent=n,this.target=a,this.currentTarget=null;for(var o in r)r.hasOwnProperty(o)&&(t=r[o],this[o]=t?t(n):n[o]);return this.isDefaultPrevented=(n.defaultPrevented!=null?n.defaultPrevented:n.returnValue===!1)?c0:zk,this.isPropagationStopped=zk,this}return ri(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=c0)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=c0)},persist:function(){},isPersistent:c0}),e}var tm={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},JD=Fs(tm),iy=ri({},tm,{view:0,detail:0}),Fte=Fs(iy),m1,g1,Bm,vT=ri({},iy,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:eL,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Bm&&(Bm&&r.type==="mousemove"?(m1=r.screenX-Bm.screenX,g1=r.screenY-Bm.screenY):g1=m1=0,Bm=r),m1)},movementY:function(r){return"movementY"in r?r.movementY:g1}}),Vk=Fs(vT),Bte=ri({},vT,{dataTransfer:0}),Ute=Fs(Bte),zte=ri({},iy,{relatedTarget:0}),_1=Fs(zte),Vte=ri({},tm,{animationName:0,elapsedTime:0,pseudoElement:0}),jte=Fs(Vte),$te=ri({},tm,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),Hte=Fs($te),Gte=ri({},tm,{data:0}),jk=Fs(Gte),Wte={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Xte={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},qte={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Yte(r){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(r):(r=qte[r])?!!e[r]:!1}function eL(){return Yte}var Kte=ri({},iy,{key:function(r){if(r.key){var e=Wte[r.key]||r.key;if(e!=="Unidentified")return e}return r.type==="keypress"?(r=$S(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?Xte[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:eL,charCode:function(r){return r.type==="keypress"?$S(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?$S(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),Zte=Fs(Kte),Qte=ri({},vT,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),$k=Fs(Qte),Jte=ri({},iy,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:eL}),eie=Fs(Jte),tie=ri({},tm,{propertyName:0,elapsedTime:0,pseudoElement:0}),iie=Fs(tie),rie=ri({},vT,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),sie=Fs(rie),nie=[9,13,27,32],tL=Wo&&"CompositionEvent"in window,kg=null;Wo&&"documentMode"in document&&(kg=document.documentMode);var aie=Wo&&"TextEvent"in window&&!kg,pG=Wo&&(!tL||kg&&8<kg&&11>=kg),Hk=" ",Gk=!1;function mG(r,e){switch(r){case"keyup":return nie.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function gG(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Fd=!1;function oie(r,e){switch(r){case"compositionend":return gG(e);case"keypress":return e.which!==32?null:(Gk=!0,Hk);case"textInput":return r=e.data,r===Hk&&Gk?null:r;default:return null}}function lie(r,e){if(Fd)return r==="compositionend"||!tL&&mG(r,e)?(r=fG(),jS=QD=Ql=null,Fd=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return pG&&e.locale!=="ko"?null:e.data;default:return null}}var cie={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Wk(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e==="input"?!!cie[r.type]:e==="textarea"}function _G(r,e,t,i){qH(i),e=Px(e,"onChange"),0<e.length&&(t=new JD("onChange","change",null,t,i),r.push({event:t,listeners:e}))}var Fg=null,P_=null;function uie(r){PG(r,0)}function yT(r){var e=zd(r);if(VH(e))return r}function hie(r,e){if(r==="change")return e}var vG=!1;if(Wo){var v1;if(Wo){var y1="oninput"in document;if(!y1){var Xk=document.createElement("div");Xk.setAttribute("oninput","return;"),y1=typeof Xk.oninput=="function"}v1=y1}else v1=!1;vG=v1&&(!document.documentMode||9<document.documentMode)}function qk(){Fg&&(Fg.detachEvent("onpropertychange",yG),P_=Fg=null)}function yG(r){if(r.propertyName==="value"&&yT(P_)){var e=[];_G(e,P_,r,XD(r)),QH(uie,e)}}function die(r,e,t){r==="focusin"?(qk(),Fg=e,P_=t,Fg.attachEvent("onpropertychange",yG)):r==="focusout"&&qk()}function fie(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return yT(P_)}function pie(r,e){if(r==="click")return yT(e)}function mie(r,e){if(r==="input"||r==="change")return yT(e)}function gie(r,e){return r===e&&(r!==0||1/r===1/e)||r!==r&&e!==e}var Xn=typeof Object.is=="function"?Object.is:gie;function I_(r,e){if(Xn(r,e))return!0;if(typeof r!="object"||r===null||typeof e!="object"||e===null)return!1;var t=Object.keys(r),i=Object.keys(e);if(t.length!==i.length)return!1;for(i=0;i<t.length;i++){var s=t[i];if(!$P.call(e,s)||!Xn(r[s],e[s]))return!1}return!0}function Yk(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function Kk(r,e){var t=Yk(r);r=0;for(var i;t;){if(t.nodeType===3){if(i=r+t.textContent.length,r<=e&&i>=e)return{node:t,offset:e-r};r=i}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Yk(t)}}function SG(r,e){return r&&e?r===e?!0:r&&r.nodeType===3?!1:e&&e.nodeType===3?SG(r,e.parentNode):"contains"in r?r.contains(e):r.compareDocumentPosition?!!(r.compareDocumentPosition(e)&16):!1:!1}function xG(){for(var r=window,e=xx();e instanceof r.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)r=e.contentWindow;else break;e=xx(r.document)}return e}function iL(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e&&(e==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||e==="textarea"||r.contentEditable==="true")}function _ie(r){var e=xG(),t=r.focusedElem,i=r.selectionRange;if(e!==t&&t&&t.ownerDocument&&SG(t.ownerDocument.documentElement,t)){if(i!==null&&iL(t)){if(e=i.start,r=i.end,r===void 0&&(r=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(r,t.value.length);else if(r=(e=t.ownerDocument||document)&&e.defaultView||window,r.getSelection){r=r.getSelection();var s=t.textContent.length,n=Math.min(i.start,s);i=i.end===void 0?n:Math.min(i.end,s),!r.extend&&n>i&&(s=i,i=n,n=s),s=Kk(t,n);var a=Kk(t,i);s&&a&&(r.rangeCount!==1||r.anchorNode!==s.node||r.anchorOffset!==s.offset||r.focusNode!==a.node||r.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),r.removeAllRanges(),n>i?(r.addRange(e),r.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),r.addRange(e)))}}for(e=[],r=t;r=r.parentNode;)r.nodeType===1&&e.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)r=e[t],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var vie=Wo&&"documentMode"in document&&11>=document.documentMode,Bd=null,lI=null,Bg=null,cI=!1;function Zk(r,e,t){var i=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;cI||Bd==null||Bd!==xx(i)||(i=Bd,"selectionStart"in i&&iL(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Bg&&I_(Bg,i)||(Bg=i,i=Px(lI,"onSelect"),0<i.length&&(e=new JD("onSelect","select",null,e,t),r.push({event:e,listeners:i}),e.target=Bd)))}function u0(r,e){var t={};return t[r.toLowerCase()]=e.toLowerCase(),t["Webkit"+r]="webkit"+e,t["Moz"+r]="moz"+e,t}var Ud={animationend:u0("Animation","AnimationEnd"),animationiteration:u0("Animation","AnimationIteration"),animationstart:u0("Animation","AnimationStart"),transitionend:u0("Transition","TransitionEnd")},S1={},bG={};Wo&&(bG=document.createElement("div").style,"AnimationEvent"in window||(delete Ud.animationend.animation,delete Ud.animationiteration.animation,delete Ud.animationstart.animation),"TransitionEvent"in window||delete Ud.transitionend.transition);function ST(r){if(S1[r])return S1[r];if(!Ud[r])return r;var e=Ud[r],t;for(t in e)if(e.hasOwnProperty(t)&&t in bG)return S1[r]=e[t];return r}var wG=ST("animationend"),TG=ST("animationiteration"),EG=ST("animationstart"),AG=ST("transitionend"),CG=new Map,Qk="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ec(r,e){CG.set(r,e),Ih(e,[r])}for(var x1=0;x1<Qk.length;x1++){var b1=Qk[x1],yie=b1.toLowerCase(),Sie=b1[0].toUpperCase()+b1.slice(1);Ec(yie,"on"+Sie)}Ec(wG,"onAnimationEnd");Ec(TG,"onAnimationIteration");Ec(EG,"onAnimationStart");Ec("dblclick","onDoubleClick");Ec("focusin","onFocus");Ec("focusout","onBlur");Ec(AG,"onTransitionEnd");Yf("onMouseEnter",["mouseout","mouseover"]);Yf("onMouseLeave",["mouseout","mouseover"]);Yf("onPointerEnter",["pointerout","pointerover"]);Yf("onPointerLeave",["pointerout","pointerover"]);Ih("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ih("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ih("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ih("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ih("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ih("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Eg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),xie=new Set("cancel close invalid load scroll toggle".split(" ").concat(Eg));function Jk(r,e,t){var i=r.type||"unknown-event";r.currentTarget=t,yte(i,e,void 0,r),r.currentTarget=null}function PG(r,e){e=(e&4)!==0;for(var t=0;t<r.length;t++){var i=r[t],s=i.event;i=i.listeners;e:{var n=void 0;if(e)for(var a=i.length-1;0<=a;a--){var o=i[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==n&&s.isPropagationStopped())break e;Jk(s,o,c),n=l}else for(a=0;a<i.length;a++){if(o=i[a],l=o.instance,c=o.currentTarget,o=o.listener,l!==n&&s.isPropagationStopped())break e;Jk(s,o,c),n=l}}}if(wx)throw r=sI,wx=!1,sI=null,r}function Bt(r,e){var t=e[pI];t===void 0&&(t=e[pI]=new Set);var i=r+"__bubble";t.has(i)||(IG(e,r,2,!1),t.add(i))}function w1(r,e,t){var i=0;e&&(i|=4),IG(t,r,i,e)}var h0="_reactListening"+Math.random().toString(36).slice(2);function M_(r){if(!r[h0]){r[h0]=!0,kH.forEach(function(t){t!=="selectionchange"&&(xie.has(t)||w1(t,!1,r),w1(t,!0,r))});var e=r.nodeType===9?r:r.ownerDocument;e===null||e[h0]||(e[h0]=!0,w1("selectionchange",!1,e))}}function IG(r,e,t,i){switch(dG(e)){case 1:var s=Nte;break;case 4:s=kte;break;default:s=ZD}t=s.bind(null,e,t,r),s=void 0,!rI||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),i?s!==void 0?r.addEventListener(e,t,{capture:!0,passive:s}):r.addEventListener(e,t,!0):s!==void 0?r.addEventListener(e,t,{passive:s}):r.addEventListener(e,t,!1)}function T1(r,e,t,i,s){var n=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var a=i.tag;if(a===3||a===4){var o=i.stateNode.containerInfo;if(o===s||o.nodeType===8&&o.parentNode===s)break;if(a===4)for(a=i.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;a=a.return}for(;o!==null;){if(a=bu(o),a===null)return;if(l=a.tag,l===5||l===6){i=n=a;continue e}o=o.parentNode}}i=i.return}QH(function(){var c=n,u=XD(t),h=[];e:{var d=CG.get(r);if(d!==void 0){var f=JD,p=r;switch(r){case"keypress":if($S(t)===0)break e;case"keydown":case"keyup":f=Zte;break;case"focusin":p="focus",f=_1;break;case"focusout":p="blur",f=_1;break;case"beforeblur":case"afterblur":f=_1;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=Vk;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=Ute;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=eie;break;case wG:case TG:case EG:f=jte;break;case AG:f=iie;break;case"scroll":f=Fte;break;case"wheel":f=sie;break;case"copy":case"cut":case"paste":f=Hte;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=$k}var m=(e&4)!==0,g=!m&&r==="scroll",_=m?d!==null?d+"Capture":null:d;m=[];for(var v=c,y;v!==null;){y=v;var x=y.stateNode;if(y.tag===5&&x!==null&&(y=x,_!==null&&(x=T_(v,_),x!=null&&m.push(R_(v,x,y)))),g)break;v=v.return}0<m.length&&(d=new f(d,p,null,t,u),h.push({event:d,listeners:m}))}}if(!(e&7)){e:{if(d=r==="mouseover"||r==="pointerover",f=r==="mouseout"||r==="pointerout",d&&t!==tI&&(p=t.relatedTarget||t.fromElement)&&(bu(p)||p[Xo]))break e;if((f||d)&&(d=u.window===u?u:(d=u.ownerDocument)?d.defaultView||d.parentWindow:window,f?(p=t.relatedTarget||t.toElement,f=c,p=p?bu(p):null,p!==null&&(g=Mh(p),p!==g||p.tag!==5&&p.tag!==6)&&(p=null)):(f=null,p=c),f!==p)){if(m=Vk,x="onMouseLeave",_="onMouseEnter",v="mouse",(r==="pointerout"||r==="pointerover")&&(m=$k,x="onPointerLeave",_="onPointerEnter",v="pointer"),g=f==null?d:zd(f),y=p==null?d:zd(p),d=new m(x,v+"leave",f,t,u),d.target=g,d.relatedTarget=y,x=null,bu(u)===c&&(m=new m(_,v+"enter",p,t,u),m.target=y,m.relatedTarget=g,x=m),g=x,f&&p)t:{for(m=f,_=p,v=0,y=m;y;y=Gh(y))v++;for(y=0,x=_;x;x=Gh(x))y++;for(;0<v-y;)m=Gh(m),v--;for(;0<y-v;)_=Gh(_),y--;for(;v--;){if(m===_||_!==null&&m===_.alternate)break t;m=Gh(m),_=Gh(_)}m=null}else m=null;f!==null&&eF(h,d,f,m,!1),p!==null&&g!==null&&eF(h,g,p,m,!0)}}e:{if(d=c?zd(c):window,f=d.nodeName&&d.nodeName.toLowerCase(),f==="select"||f==="input"&&d.type==="file")var S=hie;else if(Wk(d))if(vG)S=mie;else{S=fie;var w=die}else(f=d.nodeName)&&f.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(S=pie);if(S&&(S=S(r,c))){_G(h,S,t,u);break e}w&&w(r,d,c),r==="focusout"&&(w=d._wrapperState)&&w.controlled&&d.type==="number"&&KP(d,"number",d.value)}switch(w=c?zd(c):window,r){case"focusin":(Wk(w)||w.contentEditable==="true")&&(Bd=w,lI=c,Bg=null);break;case"focusout":Bg=lI=Bd=null;break;case"mousedown":cI=!0;break;case"contextmenu":case"mouseup":case"dragend":cI=!1,Zk(h,t,u);break;case"selectionchange":if(vie)break;case"keydown":case"keyup":Zk(h,t,u)}var T;if(tL)e:{switch(r){case"compositionstart":var A="onCompositionStart";break e;case"compositionend":A="onCompositionEnd";break e;case"compositionupdate":A="onCompositionUpdate";break e}A=void 0}else Fd?mG(r,t)&&(A="onCompositionEnd"):r==="keydown"&&t.keyCode===229&&(A="onCompositionStart");A&&(pG&&t.locale!=="ko"&&(Fd||A!=="onCompositionStart"?A==="onCompositionEnd"&&Fd&&(T=fG()):(Ql=u,QD="value"in Ql?Ql.value:Ql.textContent,Fd=!0)),w=Px(c,A),0<w.length&&(A=new jk(A,r,null,t,u),h.push({event:A,listeners:w}),T?A.data=T:(T=gG(t),T!==null&&(A.data=T)))),(T=aie?oie(r,t):lie(r,t))&&(c=Px(c,"onBeforeInput"),0<c.length&&(u=new jk("onBeforeInput","beforeinput",null,t,u),h.push({event:u,listeners:c}),u.data=T))}PG(h,e)})}function R_(r,e,t){return{instance:r,listener:e,currentTarget:t}}function Px(r,e){for(var t=e+"Capture",i=[];r!==null;){var s=r,n=s.stateNode;s.tag===5&&n!==null&&(s=n,n=T_(r,t),n!=null&&i.unshift(R_(r,n,s)),n=T_(r,e),n!=null&&i.push(R_(r,n,s))),r=r.return}return i}function Gh(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function eF(r,e,t,i,s){for(var n=e._reactName,a=[];t!==null&&t!==i;){var o=t,l=o.alternate,c=o.stateNode;if(l!==null&&l===i)break;o.tag===5&&c!==null&&(o=c,s?(l=T_(t,n),l!=null&&a.unshift(R_(t,l,o))):s||(l=T_(t,n),l!=null&&a.push(R_(t,l,o)))),t=t.return}a.length!==0&&r.push({event:e,listeners:a})}var bie=/\r\n?/g,wie=/\u0000|\uFFFD/g;function tF(r){return(typeof r=="string"?r:""+r).replace(bie,`
`).replace(wie,"")}function d0(r,e,t){if(e=tF(e),tF(r)!==e&&t)throw Error(re(425))}function Ix(){}var uI=null,hI=null;function dI(r,e){return r==="textarea"||r==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var fI=typeof setTimeout=="function"?setTimeout:void 0,Tie=typeof clearTimeout=="function"?clearTimeout:void 0,iF=typeof Promise=="function"?Promise:void 0,Eie=typeof queueMicrotask=="function"?queueMicrotask:typeof iF<"u"?function(r){return iF.resolve(null).then(r).catch(Aie)}:fI;function Aie(r){setTimeout(function(){throw r})}function E1(r,e){var t=e,i=0;do{var s=t.nextSibling;if(r.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(i===0){r.removeChild(s),C_(e);return}i--}else t!=="$"&&t!=="$?"&&t!=="$!"||i++;t=s}while(t);C_(e)}function ac(r){for(;r!=null;r=r.nextSibling){var e=r.nodeType;if(e===1||e===3)break;if(e===8){if(e=r.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return r}function rF(r){r=r.previousSibling;for(var e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return r;e--}else t==="/$"&&e++}r=r.previousSibling}return null}var im=Math.random().toString(36).slice(2),Ta="__reactFiber$"+im,D_="__reactProps$"+im,Xo="__reactContainer$"+im,pI="__reactEvents$"+im,Cie="__reactListeners$"+im,Pie="__reactHandles$"+im;function bu(r){var e=r[Ta];if(e)return e;for(var t=r.parentNode;t;){if(e=t[Xo]||t[Ta]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(r=rF(r);r!==null;){if(t=r[Ta])return t;r=rF(r)}return e}r=t,t=r.parentNode}return null}function ry(r){return r=r[Ta]||r[Xo],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function zd(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(re(33))}function xT(r){return r[D_]||null}var mI=[],Vd=-1;function Ac(r){return{current:r}}function Wt(r){0>Vd||(r.current=mI[Vd],mI[Vd]=null,Vd--)}function Mt(r,e){Vd++,mI[Vd]=r.current,r.current=e}var vc={},Er=Ac(vc),Qr=Ac(!1),Zu=vc;function Kf(r,e){var t=r.type.contextTypes;if(!t)return vc;var i=r.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var s={},n;for(n in t)s[n]=e[n];return i&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=e,r.__reactInternalMemoizedMaskedChildContext=s),s}function Jr(r){return r=r.childContextTypes,r!=null}function Mx(){Wt(Qr),Wt(Er)}function sF(r,e,t){if(Er.current!==vc)throw Error(re(168));Mt(Er,e),Mt(Qr,t)}function MG(r,e,t){var i=r.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return t;i=i.getChildContext();for(var s in i)if(!(s in e))throw Error(re(108,dte(r)||"Unknown",s));return ri({},t,i)}function Rx(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||vc,Zu=Er.current,Mt(Er,r),Mt(Qr,Qr.current),!0}function nF(r,e,t){var i=r.stateNode;if(!i)throw Error(re(169));t?(r=MG(r,e,Zu),i.__reactInternalMemoizedMergedChildContext=r,Wt(Qr),Wt(Er),Mt(Er,r)):Wt(Qr),Mt(Qr,t)}var To=null,bT=!1,A1=!1;function RG(r){To===null?To=[r]:To.push(r)}function Iie(r){bT=!0,RG(r)}function Cc(){if(!A1&&To!==null){A1=!0;var r=0,e=ft;try{var t=To;for(ft=1;r<t.length;r++){var i=t[r];do i=i(!0);while(i!==null)}To=null,bT=!1}catch(s){throw To!==null&&(To=To.slice(r+1)),iG(qD,Cc),s}finally{ft=e,A1=!1}}return null}var jd=[],$d=0,Dx=null,Lx=0,Ks=[],Zs=0,Qu=null,Mo=1,Ro="";function iu(r,e){jd[$d++]=Lx,jd[$d++]=Dx,Dx=r,Lx=e}function DG(r,e,t){Ks[Zs++]=Mo,Ks[Zs++]=Ro,Ks[Zs++]=Qu,Qu=r;var i=Mo;r=Ro;var s=32-$n(i)-1;i&=~(1<<s),t+=1;var n=32-$n(e)+s;if(30<n){var a=s-s%5;n=(i&(1<<a)-1).toString(32),i>>=a,s-=a,Mo=1<<32-$n(e)+s|t<<s|i,Ro=n+r}else Mo=1<<n|t<<s|i,Ro=r}function rL(r){r.return!==null&&(iu(r,1),DG(r,1,0))}function sL(r){for(;r===Dx;)Dx=jd[--$d],jd[$d]=null,Lx=jd[--$d],jd[$d]=null;for(;r===Qu;)Qu=Ks[--Zs],Ks[Zs]=null,Ro=Ks[--Zs],Ks[Zs]=null,Mo=Ks[--Zs],Ks[Zs]=null}var ws=null,bs=null,Zt=!1,Bn=null;function LG(r,e){var t=en(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=r,e=r.deletions,e===null?(r.deletions=[t],r.flags|=16):e.push(t)}function aF(r,e){switch(r.tag){case 5:var t=r.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(r.stateNode=e,ws=r,bs=ac(e.firstChild),!0):!1;case 6:return e=r.pendingProps===""||e.nodeType!==3?null:e,e!==null?(r.stateNode=e,ws=r,bs=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Qu!==null?{id:Mo,overflow:Ro}:null,r.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=en(18,null,null,0),t.stateNode=e,t.return=r,r.child=t,ws=r,bs=null,!0):!1;default:return!1}}function gI(r){return(r.mode&1)!==0&&(r.flags&128)===0}function _I(r){if(Zt){var e=bs;if(e){var t=e;if(!aF(r,e)){if(gI(r))throw Error(re(418));e=ac(t.nextSibling);var i=ws;e&&aF(r,e)?LG(i,t):(r.flags=r.flags&-4097|2,Zt=!1,ws=r)}}else{if(gI(r))throw Error(re(418));r.flags=r.flags&-4097|2,Zt=!1,ws=r}}}function oF(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;ws=r}function f0(r){if(r!==ws)return!1;if(!Zt)return oF(r),Zt=!0,!1;var e;if((e=r.tag!==3)&&!(e=r.tag!==5)&&(e=r.type,e=e!=="head"&&e!=="body"&&!dI(r.type,r.memoizedProps)),e&&(e=bs)){if(gI(r))throw OG(),Error(re(418));for(;e;)LG(r,e),e=ac(e.nextSibling)}if(oF(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(re(317));e:{for(r=r.nextSibling,e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="/$"){if(e===0){bs=ac(r.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}r=r.nextSibling}bs=null}}else bs=ws?ac(r.stateNode.nextSibling):null;return!0}function OG(){for(var r=bs;r;)r=ac(r.nextSibling)}function Zf(){bs=ws=null,Zt=!1}function nL(r){Bn===null?Bn=[r]:Bn.push(r)}var Mie=rl.ReactCurrentBatchConfig;function Um(r,e,t){if(r=t.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(re(309));var i=t.stateNode}if(!i)throw Error(re(147,r));var s=i,n=""+r;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===n?e.ref:(e=function(a){var o=s.refs;a===null?delete o[n]:o[n]=a},e._stringRef=n,e)}if(typeof r!="string")throw Error(re(284));if(!t._owner)throw Error(re(290,r))}return r}function p0(r,e){throw r=Object.prototype.toString.call(e),Error(re(31,r==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":r))}function lF(r){var e=r._init;return e(r._payload)}function NG(r){function e(_,v){if(r){var y=_.deletions;y===null?(_.deletions=[v],_.flags|=16):y.push(v)}}function t(_,v){if(!r)return null;for(;v!==null;)e(_,v),v=v.sibling;return null}function i(_,v){for(_=new Map;v!==null;)v.key!==null?_.set(v.key,v):_.set(v.index,v),v=v.sibling;return _}function s(_,v){return _=uc(_,v),_.index=0,_.sibling=null,_}function n(_,v,y){return _.index=y,r?(y=_.alternate,y!==null?(y=y.index,y<v?(_.flags|=2,v):y):(_.flags|=2,v)):(_.flags|=1048576,v)}function a(_){return r&&_.alternate===null&&(_.flags|=2),_}function o(_,v,y,x){return v===null||v.tag!==6?(v=L1(y,_.mode,x),v.return=_,v):(v=s(v,y),v.return=_,v)}function l(_,v,y,x){var S=y.type;return S===kd?u(_,v,y.props.children,x,y.key):v!==null&&(v.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Al&&lF(S)===v.type)?(x=s(v,y.props),x.ref=Um(_,v,y),x.return=_,x):(x=KS(y.type,y.key,y.props,null,_.mode,x),x.ref=Um(_,v,y),x.return=_,x)}function c(_,v,y,x){return v===null||v.tag!==4||v.stateNode.containerInfo!==y.containerInfo||v.stateNode.implementation!==y.implementation?(v=O1(y,_.mode,x),v.return=_,v):(v=s(v,y.children||[]),v.return=_,v)}function u(_,v,y,x,S){return v===null||v.tag!==7?(v=Bu(y,_.mode,x,S),v.return=_,v):(v=s(v,y),v.return=_,v)}function h(_,v,y){if(typeof v=="string"&&v!==""||typeof v=="number")return v=L1(""+v,_.mode,y),v.return=_,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case r0:return y=KS(v.type,v.key,v.props,null,_.mode,y),y.ref=Um(_,null,v),y.return=_,y;case Nd:return v=O1(v,_.mode,y),v.return=_,v;case Al:var x=v._init;return h(_,x(v._payload),y)}if(wg(v)||Om(v))return v=Bu(v,_.mode,y,null),v.return=_,v;p0(_,v)}return null}function d(_,v,y,x){var S=v!==null?v.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return S!==null?null:o(_,v,""+y,x);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case r0:return y.key===S?l(_,v,y,x):null;case Nd:return y.key===S?c(_,v,y,x):null;case Al:return S=y._init,d(_,v,S(y._payload),x)}if(wg(y)||Om(y))return S!==null?null:u(_,v,y,x,null);p0(_,y)}return null}function f(_,v,y,x,S){if(typeof x=="string"&&x!==""||typeof x=="number")return _=_.get(y)||null,o(v,_,""+x,S);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case r0:return _=_.get(x.key===null?y:x.key)||null,l(v,_,x,S);case Nd:return _=_.get(x.key===null?y:x.key)||null,c(v,_,x,S);case Al:var w=x._init;return f(_,v,y,w(x._payload),S)}if(wg(x)||Om(x))return _=_.get(y)||null,u(v,_,x,S,null);p0(v,x)}return null}function p(_,v,y,x){for(var S=null,w=null,T=v,A=v=0,C=null;T!==null&&A<y.length;A++){T.index>A?(C=T,T=null):C=T.sibling;var P=d(_,T,y[A],x);if(P===null){T===null&&(T=C);break}r&&T&&P.alternate===null&&e(_,T),v=n(P,v,A),w===null?S=P:w.sibling=P,w=P,T=C}if(A===y.length)return t(_,T),Zt&&iu(_,A),S;if(T===null){for(;A<y.length;A++)T=h(_,y[A],x),T!==null&&(v=n(T,v,A),w===null?S=T:w.sibling=T,w=T);return Zt&&iu(_,A),S}for(T=i(_,T);A<y.length;A++)C=f(T,_,A,y[A],x),C!==null&&(r&&C.alternate!==null&&T.delete(C.key===null?A:C.key),v=n(C,v,A),w===null?S=C:w.sibling=C,w=C);return r&&T.forEach(function(I){return e(_,I)}),Zt&&iu(_,A),S}function m(_,v,y,x){var S=Om(y);if(typeof S!="function")throw Error(re(150));if(y=S.call(y),y==null)throw Error(re(151));for(var w=S=null,T=v,A=v=0,C=null,P=y.next();T!==null&&!P.done;A++,P=y.next()){T.index>A?(C=T,T=null):C=T.sibling;var I=d(_,T,P.value,x);if(I===null){T===null&&(T=C);break}r&&T&&I.alternate===null&&e(_,T),v=n(I,v,A),w===null?S=I:w.sibling=I,w=I,T=C}if(P.done)return t(_,T),Zt&&iu(_,A),S;if(T===null){for(;!P.done;A++,P=y.next())P=h(_,P.value,x),P!==null&&(v=n(P,v,A),w===null?S=P:w.sibling=P,w=P);return Zt&&iu(_,A),S}for(T=i(_,T);!P.done;A++,P=y.next())P=f(T,_,A,P.value,x),P!==null&&(r&&P.alternate!==null&&T.delete(P.key===null?A:P.key),v=n(P,v,A),w===null?S=P:w.sibling=P,w=P);return r&&T.forEach(function(M){return e(_,M)}),Zt&&iu(_,A),S}function g(_,v,y,x){if(typeof y=="object"&&y!==null&&y.type===kd&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case r0:e:{for(var S=y.key,w=v;w!==null;){if(w.key===S){if(S=y.type,S===kd){if(w.tag===7){t(_,w.sibling),v=s(w,y.props.children),v.return=_,_=v;break e}}else if(w.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Al&&lF(S)===w.type){t(_,w.sibling),v=s(w,y.props),v.ref=Um(_,w,y),v.return=_,_=v;break e}t(_,w);break}else e(_,w);w=w.sibling}y.type===kd?(v=Bu(y.props.children,_.mode,x,y.key),v.return=_,_=v):(x=KS(y.type,y.key,y.props,null,_.mode,x),x.ref=Um(_,v,y),x.return=_,_=x)}return a(_);case Nd:e:{for(w=y.key;v!==null;){if(v.key===w)if(v.tag===4&&v.stateNode.containerInfo===y.containerInfo&&v.stateNode.implementation===y.implementation){t(_,v.sibling),v=s(v,y.children||[]),v.return=_,_=v;break e}else{t(_,v);break}else e(_,v);v=v.sibling}v=O1(y,_.mode,x),v.return=_,_=v}return a(_);case Al:return w=y._init,g(_,v,w(y._payload),x)}if(wg(y))return p(_,v,y,x);if(Om(y))return m(_,v,y,x);p0(_,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,v!==null&&v.tag===6?(t(_,v.sibling),v=s(v,y),v.return=_,_=v):(t(_,v),v=L1(y,_.mode,x),v.return=_,_=v),a(_)):t(_,v)}return g}var Qf=NG(!0),kG=NG(!1),Ox=Ac(null),Nx=null,Hd=null,aL=null;function oL(){aL=Hd=Nx=null}function lL(r){var e=Ox.current;Wt(Ox),r._currentValue=e}function vI(r,e,t){for(;r!==null;){var i=r.alternate;if((r.childLanes&e)!==e?(r.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),r===t)break;r=r.return}}function Sf(r,e){Nx=r,aL=Hd=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&e&&(Kr=!0),r.firstContext=null)}function ln(r){var e=r._currentValue;if(aL!==r)if(r={context:r,memoizedValue:e,next:null},Hd===null){if(Nx===null)throw Error(re(308));Hd=r,Nx.dependencies={lanes:0,firstContext:r}}else Hd=Hd.next=r;return e}var wu=null;function cL(r){wu===null?wu=[r]:wu.push(r)}function FG(r,e,t,i){var s=e.interleaved;return s===null?(t.next=t,cL(e)):(t.next=s.next,s.next=t),e.interleaved=t,qo(r,i)}function qo(r,e){r.lanes|=e;var t=r.alternate;for(t!==null&&(t.lanes|=e),t=r,r=r.return;r!==null;)r.childLanes|=e,t=r.alternate,t!==null&&(t.childLanes|=e),t=r,r=r.return;return t.tag===3?t.stateNode:null}var Cl=!1;function uL(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function BG(r,e){r=r.updateQueue,e.updateQueue===r&&(e.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function ko(r,e){return{eventTime:r,lane:e,tag:0,payload:null,callback:null,next:null}}function oc(r,e,t){var i=r.updateQueue;if(i===null)return null;if(i=i.shared,Ke&2){var s=i.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),i.pending=e,qo(r,t)}return s=i.interleaved,s===null?(e.next=e,cL(i)):(e.next=s.next,s.next=e),i.interleaved=e,qo(r,t)}function HS(r,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var i=e.lanes;i&=r.pendingLanes,t|=i,e.lanes=t,YD(r,t)}}function cF(r,e){var t=r.updateQueue,i=r.alternate;if(i!==null&&(i=i.updateQueue,t===i)){var s=null,n=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};n===null?s=n=a:n=n.next=a,t=t.next}while(t!==null);n===null?s=n=e:n=n.next=e}else s=n=e;t={baseState:i.baseState,firstBaseUpdate:s,lastBaseUpdate:n,shared:i.shared,effects:i.effects},r.updateQueue=t;return}r=t.lastBaseUpdate,r===null?t.firstBaseUpdate=e:r.next=e,t.lastBaseUpdate=e}function kx(r,e,t,i){var s=r.updateQueue;Cl=!1;var n=s.firstBaseUpdate,a=s.lastBaseUpdate,o=s.shared.pending;if(o!==null){s.shared.pending=null;var l=o,c=l.next;l.next=null,a===null?n=c:a.next=c,a=l;var u=r.alternate;u!==null&&(u=u.updateQueue,o=u.lastBaseUpdate,o!==a&&(o===null?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(n!==null){var h=s.baseState;a=0,u=c=l=null,o=n;do{var d=o.lane,f=o.eventTime;if((i&d)===d){u!==null&&(u=u.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=r,m=o;switch(d=e,f=t,m.tag){case 1:if(p=m.payload,typeof p=="function"){h=p.call(f,h,d);break e}h=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=m.payload,d=typeof p=="function"?p.call(f,h,d):p,d==null)break e;h=ri({},h,d);break e;case 2:Cl=!0}}o.callback!==null&&o.lane!==0&&(r.flags|=64,d=s.effects,d===null?s.effects=[o]:d.push(o))}else f={eventTime:f,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},u===null?(c=u=f,l=h):u=u.next=f,a|=d;if(o=o.next,o===null){if(o=s.shared.pending,o===null)break;d=o,o=d.next,d.next=null,s.lastBaseUpdate=d,s.shared.pending=null}}while(!0);if(u===null&&(l=h),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=u,e=s.shared.interleaved,e!==null){s=e;do a|=s.lane,s=s.next;while(s!==e)}else n===null&&(s.shared.lanes=0);eh|=a,r.lanes=a,r.memoizedState=h}}function uF(r,e,t){if(r=e.effects,e.effects=null,r!==null)for(e=0;e<r.length;e++){var i=r[e],s=i.callback;if(s!==null){if(i.callback=null,i=t,typeof s!="function")throw Error(re(191,s));s.call(i)}}}var sy={},Da=Ac(sy),L_=Ac(sy),O_=Ac(sy);function Tu(r){if(r===sy)throw Error(re(174));return r}function hL(r,e){switch(Mt(O_,e),Mt(L_,r),Mt(Da,sy),r=e.nodeType,r){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:QP(null,"");break;default:r=r===8?e.parentNode:e,e=r.namespaceURI||null,r=r.tagName,e=QP(e,r)}Wt(Da),Mt(Da,e)}function Jf(){Wt(Da),Wt(L_),Wt(O_)}function UG(r){Tu(O_.current);var e=Tu(Da.current),t=QP(e,r.type);e!==t&&(Mt(L_,r),Mt(Da,t))}function dL(r){L_.current===r&&(Wt(Da),Wt(L_))}var ei=Ac(0);function Fx(r){for(var e=r;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var C1=[];function fL(){for(var r=0;r<C1.length;r++)C1[r]._workInProgressVersionPrimary=null;C1.length=0}var GS=rl.ReactCurrentDispatcher,P1=rl.ReactCurrentBatchConfig,Ju=0,ii=null,Ri=null,qi=null,Bx=!1,Ug=!1,N_=0,Rie=0;function hr(){throw Error(re(321))}function pL(r,e){if(e===null)return!1;for(var t=0;t<e.length&&t<r.length;t++)if(!Xn(r[t],e[t]))return!1;return!0}function mL(r,e,t,i,s,n){if(Ju=n,ii=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,GS.current=r===null||r.memoizedState===null?Nie:kie,r=t(i,s),Ug){n=0;do{if(Ug=!1,N_=0,25<=n)throw Error(re(301));n+=1,qi=Ri=null,e.updateQueue=null,GS.current=Fie,r=t(i,s)}while(Ug)}if(GS.current=Ux,e=Ri!==null&&Ri.next!==null,Ju=0,qi=Ri=ii=null,Bx=!1,e)throw Error(re(300));return r}function gL(){var r=N_!==0;return N_=0,r}function la(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return qi===null?ii.memoizedState=qi=r:qi=qi.next=r,qi}function cn(){if(Ri===null){var r=ii.alternate;r=r!==null?r.memoizedState:null}else r=Ri.next;var e=qi===null?ii.memoizedState:qi.next;if(e!==null)qi=e,Ri=r;else{if(r===null)throw Error(re(310));Ri=r,r={memoizedState:Ri.memoizedState,baseState:Ri.baseState,baseQueue:Ri.baseQueue,queue:Ri.queue,next:null},qi===null?ii.memoizedState=qi=r:qi=qi.next=r}return qi}function k_(r,e){return typeof e=="function"?e(r):e}function I1(r){var e=cn(),t=e.queue;if(t===null)throw Error(re(311));t.lastRenderedReducer=r;var i=Ri,s=i.baseQueue,n=t.pending;if(n!==null){if(s!==null){var a=s.next;s.next=n.next,n.next=a}i.baseQueue=s=n,t.pending=null}if(s!==null){n=s.next,i=i.baseState;var o=a=null,l=null,c=n;do{var u=c.lane;if((Ju&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:r(i,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(o=l=h,a=i):l=l.next=h,ii.lanes|=u,eh|=u}c=c.next}while(c!==null&&c!==n);l===null?a=i:l.next=o,Xn(i,e.memoizedState)||(Kr=!0),e.memoizedState=i,e.baseState=a,e.baseQueue=l,t.lastRenderedState=i}if(r=t.interleaved,r!==null){s=r;do n=s.lane,ii.lanes|=n,eh|=n,s=s.next;while(s!==r)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function M1(r){var e=cn(),t=e.queue;if(t===null)throw Error(re(311));t.lastRenderedReducer=r;var i=t.dispatch,s=t.pending,n=e.memoizedState;if(s!==null){t.pending=null;var a=s=s.next;do n=r(n,a.action),a=a.next;while(a!==s);Xn(n,e.memoizedState)||(Kr=!0),e.memoizedState=n,e.baseQueue===null&&(e.baseState=n),t.lastRenderedState=n}return[n,i]}function zG(){}function VG(r,e){var t=ii,i=cn(),s=e(),n=!Xn(i.memoizedState,s);if(n&&(i.memoizedState=s,Kr=!0),i=i.queue,_L(HG.bind(null,t,i,r),[r]),i.getSnapshot!==e||n||qi!==null&&qi.memoizedState.tag&1){if(t.flags|=2048,F_(9,$G.bind(null,t,i,s,e),void 0,null),Qi===null)throw Error(re(349));Ju&30||jG(t,e,s)}return s}function jG(r,e,t){r.flags|=16384,r={getSnapshot:e,value:t},e=ii.updateQueue,e===null?(e={lastEffect:null,stores:null},ii.updateQueue=e,e.stores=[r]):(t=e.stores,t===null?e.stores=[r]:t.push(r))}function $G(r,e,t,i){e.value=t,e.getSnapshot=i,GG(e)&&WG(r)}function HG(r,e,t){return t(function(){GG(e)&&WG(r)})}function GG(r){var e=r.getSnapshot;r=r.value;try{var t=e();return!Xn(r,t)}catch{return!0}}function WG(r){var e=qo(r,1);e!==null&&Hn(e,r,1,-1)}function hF(r){var e=la();return typeof r=="function"&&(r=r()),e.memoizedState=e.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:k_,lastRenderedState:r},e.queue=r,r=r.dispatch=Oie.bind(null,ii,r),[e.memoizedState,r]}function F_(r,e,t,i){return r={tag:r,create:e,destroy:t,deps:i,next:null},e=ii.updateQueue,e===null?(e={lastEffect:null,stores:null},ii.updateQueue=e,e.lastEffect=r.next=r):(t=e.lastEffect,t===null?e.lastEffect=r.next=r:(i=t.next,t.next=r,r.next=i,e.lastEffect=r)),r}function XG(){return cn().memoizedState}function WS(r,e,t,i){var s=la();ii.flags|=r,s.memoizedState=F_(1|e,t,void 0,i===void 0?null:i)}function wT(r,e,t,i){var s=cn();i=i===void 0?null:i;var n=void 0;if(Ri!==null){var a=Ri.memoizedState;if(n=a.destroy,i!==null&&pL(i,a.deps)){s.memoizedState=F_(e,t,n,i);return}}ii.flags|=r,s.memoizedState=F_(1|e,t,n,i)}function dF(r,e){return WS(8390656,8,r,e)}function _L(r,e){return wT(2048,8,r,e)}function qG(r,e){return wT(4,2,r,e)}function YG(r,e){return wT(4,4,r,e)}function KG(r,e){if(typeof e=="function")return r=r(),e(r),function(){e(null)};if(e!=null)return r=r(),e.current=r,function(){e.current=null}}function ZG(r,e,t){return t=t!=null?t.concat([r]):null,wT(4,4,KG.bind(null,e,r),t)}function vL(){}function QG(r,e){var t=cn();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&pL(e,i[1])?i[0]:(t.memoizedState=[r,e],r)}function JG(r,e){var t=cn();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&pL(e,i[1])?i[0]:(r=r(),t.memoizedState=[r,e],r)}function eW(r,e,t){return Ju&21?(Xn(t,e)||(t=nG(),ii.lanes|=t,eh|=t,r.baseState=!0),e):(r.baseState&&(r.baseState=!1,Kr=!0),r.memoizedState=t)}function Die(r,e){var t=ft;ft=t!==0&&4>t?t:4,r(!0);var i=P1.transition;P1.transition={};try{r(!1),e()}finally{ft=t,P1.transition=i}}function tW(){return cn().memoizedState}function Lie(r,e,t){var i=cc(r);if(t={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null},iW(r))rW(e,t);else if(t=FG(r,e,t,i),t!==null){var s=Br();Hn(t,r,i,s),sW(t,e,i)}}function Oie(r,e,t){var i=cc(r),s={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null};if(iW(r))rW(e,s);else{var n=r.alternate;if(r.lanes===0&&(n===null||n.lanes===0)&&(n=e.lastRenderedReducer,n!==null))try{var a=e.lastRenderedState,o=n(a,t);if(s.hasEagerState=!0,s.eagerState=o,Xn(o,a)){var l=e.interleaved;l===null?(s.next=s,cL(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=FG(r,e,s,i),t!==null&&(s=Br(),Hn(t,r,i,s),sW(t,e,i))}}function iW(r){var e=r.alternate;return r===ii||e!==null&&e===ii}function rW(r,e){Ug=Bx=!0;var t=r.pending;t===null?e.next=e:(e.next=t.next,t.next=e),r.pending=e}function sW(r,e,t){if(t&4194240){var i=e.lanes;i&=r.pendingLanes,t|=i,e.lanes=t,YD(r,t)}}var Ux={readContext:ln,useCallback:hr,useContext:hr,useEffect:hr,useImperativeHandle:hr,useInsertionEffect:hr,useLayoutEffect:hr,useMemo:hr,useReducer:hr,useRef:hr,useState:hr,useDebugValue:hr,useDeferredValue:hr,useTransition:hr,useMutableSource:hr,useSyncExternalStore:hr,useId:hr,unstable_isNewReconciler:!1},Nie={readContext:ln,useCallback:function(r,e){return la().memoizedState=[r,e===void 0?null:e],r},useContext:ln,useEffect:dF,useImperativeHandle:function(r,e,t){return t=t!=null?t.concat([r]):null,WS(4194308,4,KG.bind(null,e,r),t)},useLayoutEffect:function(r,e){return WS(4194308,4,r,e)},useInsertionEffect:function(r,e){return WS(4,2,r,e)},useMemo:function(r,e){var t=la();return e=e===void 0?null:e,r=r(),t.memoizedState=[r,e],r},useReducer:function(r,e,t){var i=la();return e=t!==void 0?t(e):e,i.memoizedState=i.baseState=e,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:e},i.queue=r,r=r.dispatch=Lie.bind(null,ii,r),[i.memoizedState,r]},useRef:function(r){var e=la();return r={current:r},e.memoizedState=r},useState:hF,useDebugValue:vL,useDeferredValue:function(r){return la().memoizedState=r},useTransition:function(){var r=hF(!1),e=r[0];return r=Die.bind(null,r[1]),la().memoizedState=r,[e,r]},useMutableSource:function(){},useSyncExternalStore:function(r,e,t){var i=ii,s=la();if(Zt){if(t===void 0)throw Error(re(407));t=t()}else{if(t=e(),Qi===null)throw Error(re(349));Ju&30||jG(i,e,t)}s.memoizedState=t;var n={value:t,getSnapshot:e};return s.queue=n,dF(HG.bind(null,i,n,r),[r]),i.flags|=2048,F_(9,$G.bind(null,i,n,t,e),void 0,null),t},useId:function(){var r=la(),e=Qi.identifierPrefix;if(Zt){var t=Ro,i=Mo;t=(i&~(1<<32-$n(i)-1)).toString(32)+t,e=":"+e+"R"+t,t=N_++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=Rie++,e=":"+e+"r"+t.toString(32)+":";return r.memoizedState=e},unstable_isNewReconciler:!1},kie={readContext:ln,useCallback:QG,useContext:ln,useEffect:_L,useImperativeHandle:ZG,useInsertionEffect:qG,useLayoutEffect:YG,useMemo:JG,useReducer:I1,useRef:XG,useState:function(){return I1(k_)},useDebugValue:vL,useDeferredValue:function(r){var e=cn();return eW(e,Ri.memoizedState,r)},useTransition:function(){var r=I1(k_)[0],e=cn().memoizedState;return[r,e]},useMutableSource:zG,useSyncExternalStore:VG,useId:tW,unstable_isNewReconciler:!1},Fie={readContext:ln,useCallback:QG,useContext:ln,useEffect:_L,useImperativeHandle:ZG,useInsertionEffect:qG,useLayoutEffect:YG,useMemo:JG,useReducer:M1,useRef:XG,useState:function(){return M1(k_)},useDebugValue:vL,useDeferredValue:function(r){var e=cn();return Ri===null?e.memoizedState=r:eW(e,Ri.memoizedState,r)},useTransition:function(){var r=M1(k_)[0],e=cn().memoizedState;return[r,e]},useMutableSource:zG,useSyncExternalStore:VG,useId:tW,unstable_isNewReconciler:!1};function Pn(r,e){if(r&&r.defaultProps){e=ri({},e),r=r.defaultProps;for(var t in r)e[t]===void 0&&(e[t]=r[t]);return e}return e}function yI(r,e,t,i){e=r.memoizedState,t=t(i,e),t=t==null?e:ri({},e,t),r.memoizedState=t,r.lanes===0&&(r.updateQueue.baseState=t)}var TT={isMounted:function(r){return(r=r._reactInternals)?Mh(r)===r:!1},enqueueSetState:function(r,e,t){r=r._reactInternals;var i=Br(),s=cc(r),n=ko(i,s);n.payload=e,t!=null&&(n.callback=t),e=oc(r,n,s),e!==null&&(Hn(e,r,s,i),HS(e,r,s))},enqueueReplaceState:function(r,e,t){r=r._reactInternals;var i=Br(),s=cc(r),n=ko(i,s);n.tag=1,n.payload=e,t!=null&&(n.callback=t),e=oc(r,n,s),e!==null&&(Hn(e,r,s,i),HS(e,r,s))},enqueueForceUpdate:function(r,e){r=r._reactInternals;var t=Br(),i=cc(r),s=ko(t,i);s.tag=2,e!=null&&(s.callback=e),e=oc(r,s,i),e!==null&&(Hn(e,r,i,t),HS(e,r,i))}};function fF(r,e,t,i,s,n,a){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(i,n,a):e.prototype&&e.prototype.isPureReactComponent?!I_(t,i)||!I_(s,n):!0}function nW(r,e,t){var i=!1,s=vc,n=e.contextType;return typeof n=="object"&&n!==null?n=ln(n):(s=Jr(e)?Zu:Er.current,i=e.contextTypes,n=(i=i!=null)?Kf(r,s):vc),e=new e(t,n),r.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=TT,r.stateNode=e,e._reactInternals=r,i&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=s,r.__reactInternalMemoizedMaskedChildContext=n),e}function pF(r,e,t,i){r=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,i),e.state!==r&&TT.enqueueReplaceState(e,e.state,null)}function SI(r,e,t,i){var s=r.stateNode;s.props=t,s.state=r.memoizedState,s.refs={},uL(r);var n=e.contextType;typeof n=="object"&&n!==null?s.context=ln(n):(n=Jr(e)?Zu:Er.current,s.context=Kf(r,n)),s.state=r.memoizedState,n=e.getDerivedStateFromProps,typeof n=="function"&&(yI(r,e,n,t),s.state=r.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&TT.enqueueReplaceState(s,s.state,null),kx(r,t,s,i),s.state=r.memoizedState),typeof s.componentDidMount=="function"&&(r.flags|=4194308)}function ep(r,e){try{var t="",i=e;do t+=hte(i),i=i.return;while(i);var s=t}catch(n){s=`
Error generating stack: `+n.message+`
`+n.stack}return{value:r,source:e,stack:s,digest:null}}function R1(r,e,t){return{value:r,source:null,stack:t??null,digest:e??null}}function xI(r,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var Bie=typeof WeakMap=="function"?WeakMap:Map;function aW(r,e,t){t=ko(-1,t),t.tag=3,t.payload={element:null};var i=e.value;return t.callback=function(){Vx||(Vx=!0,RI=i),xI(r,e)},t}function oW(r,e,t){t=ko(-1,t),t.tag=3;var i=r.type.getDerivedStateFromError;if(typeof i=="function"){var s=e.value;t.payload=function(){return i(s)},t.callback=function(){xI(r,e)}}var n=r.stateNode;return n!==null&&typeof n.componentDidCatch=="function"&&(t.callback=function(){xI(r,e),typeof i!="function"&&(lc===null?lc=new Set([this]):lc.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function mF(r,e,t){var i=r.pingCache;if(i===null){i=r.pingCache=new Bie;var s=new Set;i.set(e,s)}else s=i.get(e),s===void 0&&(s=new Set,i.set(e,s));s.has(t)||(s.add(t),r=Qie.bind(null,r,e,t),e.then(r,r))}function gF(r){do{var e;if((e=r.tag===13)&&(e=r.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return r;r=r.return}while(r!==null);return null}function _F(r,e,t,i,s){return r.mode&1?(r.flags|=65536,r.lanes=s,r):(r===e?r.flags|=65536:(r.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=ko(-1,1),e.tag=2,oc(t,e,1))),t.lanes|=1),r)}var Uie=rl.ReactCurrentOwner,Kr=!1;function Mr(r,e,t,i){e.child=r===null?kG(e,null,t,i):Qf(e,r.child,t,i)}function vF(r,e,t,i,s){t=t.render;var n=e.ref;return Sf(e,s),i=mL(r,e,t,i,n,s),t=gL(),r!==null&&!Kr?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~s,Yo(r,e,s)):(Zt&&t&&rL(e),e.flags|=1,Mr(r,e,i,s),e.child)}function yF(r,e,t,i,s){if(r===null){var n=t.type;return typeof n=="function"&&!AL(n)&&n.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=n,lW(r,e,n,i,s)):(r=KS(t.type,null,i,e,e.mode,s),r.ref=e.ref,r.return=e,e.child=r)}if(n=r.child,!(r.lanes&s)){var a=n.memoizedProps;if(t=t.compare,t=t!==null?t:I_,t(a,i)&&r.ref===e.ref)return Yo(r,e,s)}return e.flags|=1,r=uc(n,i),r.ref=e.ref,r.return=e,e.child=r}function lW(r,e,t,i,s){if(r!==null){var n=r.memoizedProps;if(I_(n,i)&&r.ref===e.ref)if(Kr=!1,e.pendingProps=i=n,(r.lanes&s)!==0)r.flags&131072&&(Kr=!0);else return e.lanes=r.lanes,Yo(r,e,s)}return bI(r,e,t,i,s)}function cW(r,e,t){var i=e.pendingProps,s=i.children,n=r!==null?r.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Mt(Wd,gs),gs|=t;else{if(!(t&1073741824))return r=n!==null?n.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:r,cachePool:null,transitions:null},e.updateQueue=null,Mt(Wd,gs),gs|=r,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=n!==null?n.baseLanes:t,Mt(Wd,gs),gs|=i}else n!==null?(i=n.baseLanes|t,e.memoizedState=null):i=t,Mt(Wd,gs),gs|=i;return Mr(r,e,s,t),e.child}function uW(r,e){var t=e.ref;(r===null&&t!==null||r!==null&&r.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function bI(r,e,t,i,s){var n=Jr(t)?Zu:Er.current;return n=Kf(e,n),Sf(e,s),t=mL(r,e,t,i,n,s),i=gL(),r!==null&&!Kr?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~s,Yo(r,e,s)):(Zt&&i&&rL(e),e.flags|=1,Mr(r,e,t,s),e.child)}function SF(r,e,t,i,s){if(Jr(t)){var n=!0;Rx(e)}else n=!1;if(Sf(e,s),e.stateNode===null)XS(r,e),nW(e,t,i),SI(e,t,i,s),i=!0;else if(r===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,c=t.contextType;typeof c=="object"&&c!==null?c=ln(c):(c=Jr(t)?Zu:Er.current,c=Kf(e,c));var u=t.getDerivedStateFromProps,h=typeof u=="function"||typeof a.getSnapshotBeforeUpdate=="function";h||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==i||l!==c)&&pF(e,a,i,c),Cl=!1;var d=e.memoizedState;a.state=d,kx(e,i,a,s),l=e.memoizedState,o!==i||d!==l||Qr.current||Cl?(typeof u=="function"&&(yI(e,t,u,i),l=e.memoizedState),(o=Cl||fF(e,t,o,i,d,l,c))?(h||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),a.props=i,a.state=l,a.context=c,i=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{a=e.stateNode,BG(r,e),o=e.memoizedProps,c=e.type===e.elementType?o:Pn(e.type,o),a.props=c,h=e.pendingProps,d=a.context,l=t.contextType,typeof l=="object"&&l!==null?l=ln(l):(l=Jr(t)?Zu:Er.current,l=Kf(e,l));var f=t.getDerivedStateFromProps;(u=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==h||d!==l)&&pF(e,a,i,l),Cl=!1,d=e.memoizedState,a.state=d,kx(e,i,a,s);var p=e.memoizedState;o!==h||d!==p||Qr.current||Cl?(typeof f=="function"&&(yI(e,t,f,i),p=e.memoizedState),(c=Cl||fF(e,t,c,i,d,p,l)||!1)?(u||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(i,p,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(i,p,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===r.memoizedProps&&d===r.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===r.memoizedProps&&d===r.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=p),a.props=i,a.state=p,a.context=l,i=c):(typeof a.componentDidUpdate!="function"||o===r.memoizedProps&&d===r.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===r.memoizedProps&&d===r.memoizedState||(e.flags|=1024),i=!1)}return wI(r,e,t,i,n,s)}function wI(r,e,t,i,s,n){uW(r,e);var a=(e.flags&128)!==0;if(!i&&!a)return s&&nF(e,t,!1),Yo(r,e,n);i=e.stateNode,Uie.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,r!==null&&a?(e.child=Qf(e,r.child,null,n),e.child=Qf(e,null,o,n)):Mr(r,e,o,n),e.memoizedState=i.state,s&&nF(e,t,!0),e.child}function hW(r){var e=r.stateNode;e.pendingContext?sF(r,e.pendingContext,e.pendingContext!==e.context):e.context&&sF(r,e.context,!1),hL(r,e.containerInfo)}function xF(r,e,t,i,s){return Zf(),nL(s),e.flags|=256,Mr(r,e,t,i),e.child}var TI={dehydrated:null,treeContext:null,retryLane:0};function EI(r){return{baseLanes:r,cachePool:null,transitions:null}}function dW(r,e,t){var i=e.pendingProps,s=ei.current,n=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=r!==null&&r.memoizedState===null?!1:(s&2)!==0),o?(n=!0,e.flags&=-129):(r===null||r.memoizedState!==null)&&(s|=1),Mt(ei,s&1),r===null)return _I(e),r=e.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(e.mode&1?r.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=i.children,r=i.fallback,n?(i=e.mode,n=e.child,a={mode:"hidden",children:a},!(i&1)&&n!==null?(n.childLanes=0,n.pendingProps=a):n=CT(a,i,0,null),r=Bu(r,i,t,null),n.return=e,r.return=e,n.sibling=r,e.child=n,e.child.memoizedState=EI(t),e.memoizedState=TI,r):yL(e,a));if(s=r.memoizedState,s!==null&&(o=s.dehydrated,o!==null))return zie(r,e,a,i,o,s,t);if(n){n=i.fallback,a=e.mode,s=r.child,o=s.sibling;var l={mode:"hidden",children:i.children};return!(a&1)&&e.child!==s?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=uc(s,l),i.subtreeFlags=s.subtreeFlags&14680064),o!==null?n=uc(o,n):(n=Bu(n,a,t,null),n.flags|=2),n.return=e,i.return=e,i.sibling=n,e.child=i,i=n,n=e.child,a=r.child.memoizedState,a=a===null?EI(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},n.memoizedState=a,n.childLanes=r.childLanes&~t,e.memoizedState=TI,i}return n=r.child,r=n.sibling,i=uc(n,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=t),i.return=e,i.sibling=null,r!==null&&(t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)),e.child=i,e.memoizedState=null,i}function yL(r,e){return e=CT({mode:"visible",children:e},r.mode,0,null),e.return=r,r.child=e}function m0(r,e,t,i){return i!==null&&nL(i),Qf(e,r.child,null,t),r=yL(e,e.pendingProps.children),r.flags|=2,e.memoizedState=null,r}function zie(r,e,t,i,s,n,a){if(t)return e.flags&256?(e.flags&=-257,i=R1(Error(re(422))),m0(r,e,a,i)):e.memoizedState!==null?(e.child=r.child,e.flags|=128,null):(n=i.fallback,s=e.mode,i=CT({mode:"visible",children:i.children},s,0,null),n=Bu(n,s,a,null),n.flags|=2,i.return=e,n.return=e,i.sibling=n,e.child=i,e.mode&1&&Qf(e,r.child,null,a),e.child.memoizedState=EI(a),e.memoizedState=TI,n);if(!(e.mode&1))return m0(r,e,a,null);if(s.data==="$!"){if(i=s.nextSibling&&s.nextSibling.dataset,i)var o=i.dgst;return i=o,n=Error(re(419)),i=R1(n,i,void 0),m0(r,e,a,i)}if(o=(a&r.childLanes)!==0,Kr||o){if(i=Qi,i!==null){switch(a&-a){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(i.suspendedLanes|a)?0:s,s!==0&&s!==n.retryLane&&(n.retryLane=s,qo(r,s),Hn(i,r,s,-1))}return EL(),i=R1(Error(re(421))),m0(r,e,a,i)}return s.data==="$?"?(e.flags|=128,e.child=r.child,e=Jie.bind(null,r),s._reactRetry=e,null):(r=n.treeContext,bs=ac(s.nextSibling),ws=e,Zt=!0,Bn=null,r!==null&&(Ks[Zs++]=Mo,Ks[Zs++]=Ro,Ks[Zs++]=Qu,Mo=r.id,Ro=r.overflow,Qu=e),e=yL(e,i.children),e.flags|=4096,e)}function bF(r,e,t){r.lanes|=e;var i=r.alternate;i!==null&&(i.lanes|=e),vI(r.return,e,t)}function D1(r,e,t,i,s){var n=r.memoizedState;n===null?r.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:t,tailMode:s}:(n.isBackwards=e,n.rendering=null,n.renderingStartTime=0,n.last=i,n.tail=t,n.tailMode=s)}function fW(r,e,t){var i=e.pendingProps,s=i.revealOrder,n=i.tail;if(Mr(r,e,i.children,t),i=ei.current,i&2)i=i&1|2,e.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=e.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&bF(r,t,e);else if(r.tag===19)bF(r,t,e);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break e;for(;r.sibling===null;){if(r.return===null||r.return===e)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}i&=1}if(Mt(ei,i),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)r=t.alternate,r!==null&&Fx(r)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),D1(e,!1,s,t,n);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(r=s.alternate,r!==null&&Fx(r)===null){e.child=s;break}r=s.sibling,s.sibling=t,t=s,s=r}D1(e,!0,t,null,n);break;case"together":D1(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function XS(r,e){!(e.mode&1)&&r!==null&&(r.alternate=null,e.alternate=null,e.flags|=2)}function Yo(r,e,t){if(r!==null&&(e.dependencies=r.dependencies),eh|=e.lanes,!(t&e.childLanes))return null;if(r!==null&&e.child!==r.child)throw Error(re(153));if(e.child!==null){for(r=e.child,t=uc(r,r.pendingProps),e.child=t,t.return=e;r.sibling!==null;)r=r.sibling,t=t.sibling=uc(r,r.pendingProps),t.return=e;t.sibling=null}return e.child}function Vie(r,e,t){switch(e.tag){case 3:hW(e),Zf();break;case 5:UG(e);break;case 1:Jr(e.type)&&Rx(e);break;case 4:hL(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,s=e.memoizedProps.value;Mt(Ox,i._currentValue),i._currentValue=s;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(Mt(ei,ei.current&1),e.flags|=128,null):t&e.child.childLanes?dW(r,e,t):(Mt(ei,ei.current&1),r=Yo(r,e,t),r!==null?r.sibling:null);Mt(ei,ei.current&1);break;case 19:if(i=(t&e.childLanes)!==0,r.flags&128){if(i)return fW(r,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Mt(ei,ei.current),i)break;return null;case 22:case 23:return e.lanes=0,cW(r,e,t)}return Yo(r,e,t)}var pW,AI,mW,gW;pW=function(r,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)r.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};AI=function(){};mW=function(r,e,t,i){var s=r.memoizedProps;if(s!==i){r=e.stateNode,Tu(Da.current);var n=null;switch(t){case"input":s=qP(r,s),i=qP(r,i),n=[];break;case"select":s=ri({},s,{value:void 0}),i=ri({},i,{value:void 0}),n=[];break;case"textarea":s=ZP(r,s),i=ZP(r,i),n=[];break;default:typeof s.onClick!="function"&&typeof i.onClick=="function"&&(r.onclick=Ix)}JP(t,i);var a;t=null;for(c in s)if(!i.hasOwnProperty(c)&&s.hasOwnProperty(c)&&s[c]!=null)if(c==="style"){var o=s[c];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(b_.hasOwnProperty(c)?n||(n=[]):(n=n||[]).push(c,null));for(c in i){var l=i[c];if(o=s!=null?s[c]:void 0,i.hasOwnProperty(c)&&l!==o&&(l!=null||o!=null))if(c==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(t||(t={}),t[a]=l[a])}else t||(n||(n=[]),n.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(n=n||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(n=n||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(b_.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Bt("scroll",r),n||o===l||(n=[])):(n=n||[]).push(c,l))}t&&(n=n||[]).push("style",t);var c=n;(e.updateQueue=c)&&(e.flags|=4)}};gW=function(r,e,t,i){t!==i&&(e.flags|=4)};function zm(r,e){if(!Zt)switch(r.tailMode){case"hidden":e=r.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?r.tail=null:t.sibling=null;break;case"collapsed":t=r.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e||r.tail===null?r.tail=null:r.tail.sibling=null:i.sibling=null}}function dr(r){var e=r.alternate!==null&&r.alternate.child===r.child,t=0,i=0;if(e)for(var s=r.child;s!==null;)t|=s.lanes|s.childLanes,i|=s.subtreeFlags&14680064,i|=s.flags&14680064,s.return=r,s=s.sibling;else for(s=r.child;s!==null;)t|=s.lanes|s.childLanes,i|=s.subtreeFlags,i|=s.flags,s.return=r,s=s.sibling;return r.subtreeFlags|=i,r.childLanes=t,e}function jie(r,e,t){var i=e.pendingProps;switch(sL(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return dr(e),null;case 1:return Jr(e.type)&&Mx(),dr(e),null;case 3:return i=e.stateNode,Jf(),Wt(Qr),Wt(Er),fL(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(r===null||r.child===null)&&(f0(e)?e.flags|=4:r===null||r.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Bn!==null&&(OI(Bn),Bn=null))),AI(r,e),dr(e),null;case 5:dL(e);var s=Tu(O_.current);if(t=e.type,r!==null&&e.stateNode!=null)mW(r,e,t,i,s),r.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(re(166));return dr(e),null}if(r=Tu(Da.current),f0(e)){i=e.stateNode,t=e.type;var n=e.memoizedProps;switch(i[Ta]=e,i[D_]=n,r=(e.mode&1)!==0,t){case"dialog":Bt("cancel",i),Bt("close",i);break;case"iframe":case"object":case"embed":Bt("load",i);break;case"video":case"audio":for(s=0;s<Eg.length;s++)Bt(Eg[s],i);break;case"source":Bt("error",i);break;case"img":case"image":case"link":Bt("error",i),Bt("load",i);break;case"details":Bt("toggle",i);break;case"input":Rk(i,n),Bt("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!n.multiple},Bt("invalid",i);break;case"textarea":Lk(i,n),Bt("invalid",i)}JP(t,n),s=null;for(var a in n)if(n.hasOwnProperty(a)){var o=n[a];a==="children"?typeof o=="string"?i.textContent!==o&&(n.suppressHydrationWarning!==!0&&d0(i.textContent,o,r),s=["children",o]):typeof o=="number"&&i.textContent!==""+o&&(n.suppressHydrationWarning!==!0&&d0(i.textContent,o,r),s=["children",""+o]):b_.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&Bt("scroll",i)}switch(t){case"input":s0(i),Dk(i,n,!0);break;case"textarea":s0(i),Ok(i);break;case"select":case"option":break;default:typeof n.onClick=="function"&&(i.onclick=Ix)}i=s,e.updateQueue=i,i!==null&&(e.flags|=4)}else{a=s.nodeType===9?s:s.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=HH(t)),r==="http://www.w3.org/1999/xhtml"?t==="script"?(r=a.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof i.is=="string"?r=a.createElement(t,{is:i.is}):(r=a.createElement(t),t==="select"&&(a=r,i.multiple?a.multiple=!0:i.size&&(a.size=i.size))):r=a.createElementNS(r,t),r[Ta]=e,r[D_]=i,pW(r,e,!1,!1),e.stateNode=r;e:{switch(a=eI(t,i),t){case"dialog":Bt("cancel",r),Bt("close",r),s=i;break;case"iframe":case"object":case"embed":Bt("load",r),s=i;break;case"video":case"audio":for(s=0;s<Eg.length;s++)Bt(Eg[s],r);s=i;break;case"source":Bt("error",r),s=i;break;case"img":case"image":case"link":Bt("error",r),Bt("load",r),s=i;break;case"details":Bt("toggle",r),s=i;break;case"input":Rk(r,i),s=qP(r,i),Bt("invalid",r);break;case"option":s=i;break;case"select":r._wrapperState={wasMultiple:!!i.multiple},s=ri({},i,{value:void 0}),Bt("invalid",r);break;case"textarea":Lk(r,i),s=ZP(r,i),Bt("invalid",r);break;default:s=i}JP(t,s),o=s;for(n in o)if(o.hasOwnProperty(n)){var l=o[n];n==="style"?XH(r,l):n==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&GH(r,l)):n==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&w_(r,l):typeof l=="number"&&w_(r,""+l):n!=="suppressContentEditableWarning"&&n!=="suppressHydrationWarning"&&n!=="autoFocus"&&(b_.hasOwnProperty(n)?l!=null&&n==="onScroll"&&Bt("scroll",r):l!=null&&$D(r,n,l,a))}switch(t){case"input":s0(r),Dk(r,i,!1);break;case"textarea":s0(r),Ok(r);break;case"option":i.value!=null&&r.setAttribute("value",""+_c(i.value));break;case"select":r.multiple=!!i.multiple,n=i.value,n!=null?gf(r,!!i.multiple,n,!1):i.defaultValue!=null&&gf(r,!!i.multiple,i.defaultValue,!0);break;default:typeof s.onClick=="function"&&(r.onclick=Ix)}switch(t){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return dr(e),null;case 6:if(r&&e.stateNode!=null)gW(r,e,r.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(re(166));if(t=Tu(O_.current),Tu(Da.current),f0(e)){if(i=e.stateNode,t=e.memoizedProps,i[Ta]=e,(n=i.nodeValue!==t)&&(r=ws,r!==null))switch(r.tag){case 3:d0(i.nodeValue,t,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&d0(i.nodeValue,t,(r.mode&1)!==0)}n&&(e.flags|=4)}else i=(t.nodeType===9?t:t.ownerDocument).createTextNode(i),i[Ta]=e,e.stateNode=i}return dr(e),null;case 13:if(Wt(ei),i=e.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(Zt&&bs!==null&&e.mode&1&&!(e.flags&128))OG(),Zf(),e.flags|=98560,n=!1;else if(n=f0(e),i!==null&&i.dehydrated!==null){if(r===null){if(!n)throw Error(re(318));if(n=e.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(re(317));n[Ta]=e}else Zf(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;dr(e),n=!1}else Bn!==null&&(OI(Bn),Bn=null),n=!0;if(!n)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(i=i!==null,i!==(r!==null&&r.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(r===null||ei.current&1?Fi===0&&(Fi=3):EL())),e.updateQueue!==null&&(e.flags|=4),dr(e),null);case 4:return Jf(),AI(r,e),r===null&&M_(e.stateNode.containerInfo),dr(e),null;case 10:return lL(e.type._context),dr(e),null;case 17:return Jr(e.type)&&Mx(),dr(e),null;case 19:if(Wt(ei),n=e.memoizedState,n===null)return dr(e),null;if(i=(e.flags&128)!==0,a=n.rendering,a===null)if(i)zm(n,!1);else{if(Fi!==0||r!==null&&r.flags&128)for(r=e.child;r!==null;){if(a=Fx(r),a!==null){for(e.flags|=128,zm(n,!1),i=a.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=t,t=e.child;t!==null;)n=t,r=i,n.flags&=14680066,a=n.alternate,a===null?(n.childLanes=0,n.lanes=r,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=a.childLanes,n.lanes=a.lanes,n.child=a.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=a.memoizedProps,n.memoizedState=a.memoizedState,n.updateQueue=a.updateQueue,n.type=a.type,r=a.dependencies,n.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),t=t.sibling;return Mt(ei,ei.current&1|2),e.child}r=r.sibling}n.tail!==null&&gi()>tp&&(e.flags|=128,i=!0,zm(n,!1),e.lanes=4194304)}else{if(!i)if(r=Fx(a),r!==null){if(e.flags|=128,i=!0,t=r.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),zm(n,!0),n.tail===null&&n.tailMode==="hidden"&&!a.alternate&&!Zt)return dr(e),null}else 2*gi()-n.renderingStartTime>tp&&t!==1073741824&&(e.flags|=128,i=!0,zm(n,!1),e.lanes=4194304);n.isBackwards?(a.sibling=e.child,e.child=a):(t=n.last,t!==null?t.sibling=a:e.child=a,n.last=a)}return n.tail!==null?(e=n.tail,n.rendering=e,n.tail=e.sibling,n.renderingStartTime=gi(),e.sibling=null,t=ei.current,Mt(ei,i?t&1|2:t&1),e):(dr(e),null);case 22:case 23:return TL(),i=e.memoizedState!==null,r!==null&&r.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?gs&1073741824&&(dr(e),e.subtreeFlags&6&&(e.flags|=8192)):dr(e),null;case 24:return null;case 25:return null}throw Error(re(156,e.tag))}function $ie(r,e){switch(sL(e),e.tag){case 1:return Jr(e.type)&&Mx(),r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 3:return Jf(),Wt(Qr),Wt(Er),fL(),r=e.flags,r&65536&&!(r&128)?(e.flags=r&-65537|128,e):null;case 5:return dL(e),null;case 13:if(Wt(ei),r=e.memoizedState,r!==null&&r.dehydrated!==null){if(e.alternate===null)throw Error(re(340));Zf()}return r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 19:return Wt(ei),null;case 4:return Jf(),null;case 10:return lL(e.type._context),null;case 22:case 23:return TL(),null;case 24:return null;default:return null}}var g0=!1,yr=!1,Hie=typeof WeakSet=="function"?WeakSet:Set,ue=null;function Gd(r,e){var t=r.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(i){di(r,e,i)}else t.current=null}function CI(r,e,t){try{t()}catch(i){di(r,e,i)}}var wF=!1;function Gie(r,e){if(uI=Ax,r=xG(),iL(r)){if("selectionStart"in r)var t={start:r.selectionStart,end:r.selectionEnd};else e:{t=(t=r.ownerDocument)&&t.defaultView||window;var i=t.getSelection&&t.getSelection();if(i&&i.rangeCount!==0){t=i.anchorNode;var s=i.anchorOffset,n=i.focusNode;i=i.focusOffset;try{t.nodeType,n.nodeType}catch{t=null;break e}var a=0,o=-1,l=-1,c=0,u=0,h=r,d=null;t:for(;;){for(var f;h!==t||s!==0&&h.nodeType!==3||(o=a+s),h!==n||i!==0&&h.nodeType!==3||(l=a+i),h.nodeType===3&&(a+=h.nodeValue.length),(f=h.firstChild)!==null;)d=h,h=f;for(;;){if(h===r)break t;if(d===t&&++c===s&&(o=a),d===n&&++u===i&&(l=a),(f=h.nextSibling)!==null)break;h=d,d=h.parentNode}h=f}t=o===-1||l===-1?null:{start:o,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(hI={focusedElem:r,selectionRange:t},Ax=!1,ue=e;ue!==null;)if(e=ue,r=e.child,(e.subtreeFlags&1028)!==0&&r!==null)r.return=e,ue=r;else for(;ue!==null;){e=ue;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var m=p.memoizedProps,g=p.memoizedState,_=e.stateNode,v=_.getSnapshotBeforeUpdate(e.elementType===e.type?m:Pn(e.type,m),g);_.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var y=e.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(re(163))}}catch(x){di(e,e.return,x)}if(r=e.sibling,r!==null){r.return=e.return,ue=r;break}ue=e.return}return p=wF,wF=!1,p}function zg(r,e,t){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var s=i=i.next;do{if((s.tag&r)===r){var n=s.destroy;s.destroy=void 0,n!==void 0&&CI(e,t,n)}s=s.next}while(s!==i)}}function ET(r,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&r)===r){var i=t.create;t.destroy=i()}t=t.next}while(t!==e)}}function PI(r){var e=r.ref;if(e!==null){var t=r.stateNode;switch(r.tag){case 5:r=t;break;default:r=t}typeof e=="function"?e(r):e.current=r}}function _W(r){var e=r.alternate;e!==null&&(r.alternate=null,_W(e)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(e=r.stateNode,e!==null&&(delete e[Ta],delete e[D_],delete e[pI],delete e[Cie],delete e[Pie])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function vW(r){return r.tag===5||r.tag===3||r.tag===4}function TF(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||vW(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function II(r,e,t){var i=r.tag;if(i===5||i===6)r=r.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(r,e):t.insertBefore(r,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(r,t)):(e=t,e.appendChild(r)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Ix));else if(i!==4&&(r=r.child,r!==null))for(II(r,e,t),r=r.sibling;r!==null;)II(r,e,t),r=r.sibling}function MI(r,e,t){var i=r.tag;if(i===5||i===6)r=r.stateNode,e?t.insertBefore(r,e):t.appendChild(r);else if(i!==4&&(r=r.child,r!==null))for(MI(r,e,t),r=r.sibling;r!==null;)MI(r,e,t),r=r.sibling}var ir=null,Dn=!1;function pl(r,e,t){for(t=t.child;t!==null;)yW(r,e,t),t=t.sibling}function yW(r,e,t){if(Ra&&typeof Ra.onCommitFiberUnmount=="function")try{Ra.onCommitFiberUnmount(_T,t)}catch{}switch(t.tag){case 5:yr||Gd(t,e);case 6:var i=ir,s=Dn;ir=null,pl(r,e,t),ir=i,Dn=s,ir!==null&&(Dn?(r=ir,t=t.stateNode,r.nodeType===8?r.parentNode.removeChild(t):r.removeChild(t)):ir.removeChild(t.stateNode));break;case 18:ir!==null&&(Dn?(r=ir,t=t.stateNode,r.nodeType===8?E1(r.parentNode,t):r.nodeType===1&&E1(r,t),C_(r)):E1(ir,t.stateNode));break;case 4:i=ir,s=Dn,ir=t.stateNode.containerInfo,Dn=!0,pl(r,e,t),ir=i,Dn=s;break;case 0:case 11:case 14:case 15:if(!yr&&(i=t.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){s=i=i.next;do{var n=s,a=n.destroy;n=n.tag,a!==void 0&&(n&2||n&4)&&CI(t,e,a),s=s.next}while(s!==i)}pl(r,e,t);break;case 1:if(!yr&&(Gd(t,e),i=t.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=t.memoizedProps,i.state=t.memoizedState,i.componentWillUnmount()}catch(o){di(t,e,o)}pl(r,e,t);break;case 21:pl(r,e,t);break;case 22:t.mode&1?(yr=(i=yr)||t.memoizedState!==null,pl(r,e,t),yr=i):pl(r,e,t);break;default:pl(r,e,t)}}function EF(r){var e=r.updateQueue;if(e!==null){r.updateQueue=null;var t=r.stateNode;t===null&&(t=r.stateNode=new Hie),e.forEach(function(i){var s=ere.bind(null,r,i);t.has(i)||(t.add(i),i.then(s,s))})}}function gn(r,e){var t=e.deletions;if(t!==null)for(var i=0;i<t.length;i++){var s=t[i];try{var n=r,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:ir=o.stateNode,Dn=!1;break e;case 3:ir=o.stateNode.containerInfo,Dn=!0;break e;case 4:ir=o.stateNode.containerInfo,Dn=!0;break e}o=o.return}if(ir===null)throw Error(re(160));yW(n,a,s),ir=null,Dn=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(c){di(s,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)SW(e,r),e=e.sibling}function SW(r,e){var t=r.alternate,i=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(gn(e,r),ra(r),i&4){try{zg(3,r,r.return),ET(3,r)}catch(m){di(r,r.return,m)}try{zg(5,r,r.return)}catch(m){di(r,r.return,m)}}break;case 1:gn(e,r),ra(r),i&512&&t!==null&&Gd(t,t.return);break;case 5:if(gn(e,r),ra(r),i&512&&t!==null&&Gd(t,t.return),r.flags&32){var s=r.stateNode;try{w_(s,"")}catch(m){di(r,r.return,m)}}if(i&4&&(s=r.stateNode,s!=null)){var n=r.memoizedProps,a=t!==null?t.memoizedProps:n,o=r.type,l=r.updateQueue;if(r.updateQueue=null,l!==null)try{o==="input"&&n.type==="radio"&&n.name!=null&&jH(s,n),eI(o,a);var c=eI(o,n);for(a=0;a<l.length;a+=2){var u=l[a],h=l[a+1];u==="style"?XH(s,h):u==="dangerouslySetInnerHTML"?GH(s,h):u==="children"?w_(s,h):$D(s,u,h,c)}switch(o){case"input":YP(s,n);break;case"textarea":$H(s,n);break;case"select":var d=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!n.multiple;var f=n.value;f!=null?gf(s,!!n.multiple,f,!1):d!==!!n.multiple&&(n.defaultValue!=null?gf(s,!!n.multiple,n.defaultValue,!0):gf(s,!!n.multiple,n.multiple?[]:"",!1))}s[D_]=n}catch(m){di(r,r.return,m)}}break;case 6:if(gn(e,r),ra(r),i&4){if(r.stateNode===null)throw Error(re(162));s=r.stateNode,n=r.memoizedProps;try{s.nodeValue=n}catch(m){di(r,r.return,m)}}break;case 3:if(gn(e,r),ra(r),i&4&&t!==null&&t.memoizedState.isDehydrated)try{C_(e.containerInfo)}catch(m){di(r,r.return,m)}break;case 4:gn(e,r),ra(r);break;case 13:gn(e,r),ra(r),s=r.child,s.flags&8192&&(n=s.memoizedState!==null,s.stateNode.isHidden=n,!n||s.alternate!==null&&s.alternate.memoizedState!==null||(bL=gi())),i&4&&EF(r);break;case 22:if(u=t!==null&&t.memoizedState!==null,r.mode&1?(yr=(c=yr)||u,gn(e,r),yr=c):gn(e,r),ra(r),i&8192){if(c=r.memoizedState!==null,(r.stateNode.isHidden=c)&&!u&&r.mode&1)for(ue=r,u=r.child;u!==null;){for(h=ue=u;ue!==null;){switch(d=ue,f=d.child,d.tag){case 0:case 11:case 14:case 15:zg(4,d,d.return);break;case 1:Gd(d,d.return);var p=d.stateNode;if(typeof p.componentWillUnmount=="function"){i=d,t=d.return;try{e=i,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(m){di(i,t,m)}}break;case 5:Gd(d,d.return);break;case 22:if(d.memoizedState!==null){CF(h);continue}}f!==null?(f.return=d,ue=f):CF(h)}u=u.sibling}e:for(u=null,h=r;;){if(h.tag===5){if(u===null){u=h;try{s=h.stateNode,c?(n=s.style,typeof n.setProperty=="function"?n.setProperty("display","none","important"):n.display="none"):(o=h.stateNode,l=h.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=WH("display",a))}catch(m){di(r,r.return,m)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(m){di(r,r.return,m)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===r)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===r)break e;for(;h.sibling===null;){if(h.return===null||h.return===r)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:gn(e,r),ra(r),i&4&&EF(r);break;case 21:break;default:gn(e,r),ra(r)}}function ra(r){var e=r.flags;if(e&2){try{e:{for(var t=r.return;t!==null;){if(vW(t)){var i=t;break e}t=t.return}throw Error(re(160))}switch(i.tag){case 5:var s=i.stateNode;i.flags&32&&(w_(s,""),i.flags&=-33);var n=TF(r);MI(r,n,s);break;case 3:case 4:var a=i.stateNode.containerInfo,o=TF(r);II(r,o,a);break;default:throw Error(re(161))}}catch(l){di(r,r.return,l)}r.flags&=-3}e&4096&&(r.flags&=-4097)}function Wie(r,e,t){ue=r,xW(r)}function xW(r,e,t){for(var i=(r.mode&1)!==0;ue!==null;){var s=ue,n=s.child;if(s.tag===22&&i){var a=s.memoizedState!==null||g0;if(!a){var o=s.alternate,l=o!==null&&o.memoizedState!==null||yr;o=g0;var c=yr;if(g0=a,(yr=l)&&!c)for(ue=s;ue!==null;)a=ue,l=a.child,a.tag===22&&a.memoizedState!==null?PF(s):l!==null?(l.return=a,ue=l):PF(s);for(;n!==null;)ue=n,xW(n),n=n.sibling;ue=s,g0=o,yr=c}AF(r)}else s.subtreeFlags&8772&&n!==null?(n.return=s,ue=n):AF(r)}}function AF(r){for(;ue!==null;){var e=ue;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:yr||ET(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!yr)if(t===null)i.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:Pn(e.type,t.memoizedProps);i.componentDidUpdate(s,t.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var n=e.updateQueue;n!==null&&uF(e,n,i);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}uF(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&C_(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(re(163))}yr||e.flags&512&&PI(e)}catch(d){di(e,e.return,d)}}if(e===r){ue=null;break}if(t=e.sibling,t!==null){t.return=e.return,ue=t;break}ue=e.return}}function CF(r){for(;ue!==null;){var e=ue;if(e===r){ue=null;break}var t=e.sibling;if(t!==null){t.return=e.return,ue=t;break}ue=e.return}}function PF(r){for(;ue!==null;){var e=ue;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{ET(4,e)}catch(l){di(e,t,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var s=e.return;try{i.componentDidMount()}catch(l){di(e,s,l)}}var n=e.return;try{PI(e)}catch(l){di(e,n,l)}break;case 5:var a=e.return;try{PI(e)}catch(l){di(e,a,l)}}}catch(l){di(e,e.return,l)}if(e===r){ue=null;break}var o=e.sibling;if(o!==null){o.return=e.return,ue=o;break}ue=e.return}}var Xie=Math.ceil,zx=rl.ReactCurrentDispatcher,SL=rl.ReactCurrentOwner,sn=rl.ReactCurrentBatchConfig,Ke=0,Qi=null,bi=null,rr=0,gs=0,Wd=Ac(0),Fi=0,B_=null,eh=0,AT=0,xL=0,Vg=null,qr=null,bL=0,tp=1/0,_o=null,Vx=!1,RI=null,lc=null,_0=!1,Jl=null,jx=0,jg=0,DI=null,qS=-1,YS=0;function Br(){return Ke&6?gi():qS!==-1?qS:qS=gi()}function cc(r){return r.mode&1?Ke&2&&rr!==0?rr&-rr:Mie.transition!==null?(YS===0&&(YS=nG()),YS):(r=ft,r!==0||(r=window.event,r=r===void 0?16:dG(r.type)),r):1}function Hn(r,e,t,i){if(50<jg)throw jg=0,DI=null,Error(re(185));ty(r,t,i),(!(Ke&2)||r!==Qi)&&(r===Qi&&(!(Ke&2)&&(AT|=t),Fi===4&&$l(r,rr)),es(r,i),t===1&&Ke===0&&!(e.mode&1)&&(tp=gi()+500,bT&&Cc()))}function es(r,e){var t=r.callbackNode;Mte(r,e);var i=Ex(r,r===Qi?rr:0);if(i===0)t!==null&&Fk(t),r.callbackNode=null,r.callbackPriority=0;else if(e=i&-i,r.callbackPriority!==e){if(t!=null&&Fk(t),e===1)r.tag===0?Iie(IF.bind(null,r)):RG(IF.bind(null,r)),Eie(function(){!(Ke&6)&&Cc()}),t=null;else{switch(aG(i)){case 1:t=qD;break;case 4:t=rG;break;case 16:t=Tx;break;case 536870912:t=sG;break;default:t=Tx}t=IW(t,bW.bind(null,r))}r.callbackPriority=e,r.callbackNode=t}}function bW(r,e){if(qS=-1,YS=0,Ke&6)throw Error(re(327));var t=r.callbackNode;if(xf()&&r.callbackNode!==t)return null;var i=Ex(r,r===Qi?rr:0);if(i===0)return null;if(i&30||i&r.expiredLanes||e)e=$x(r,i);else{e=i;var s=Ke;Ke|=2;var n=TW();(Qi!==r||rr!==e)&&(_o=null,tp=gi()+500,Fu(r,e));do try{Kie();break}catch(o){wW(r,o)}while(!0);oL(),zx.current=n,Ke=s,bi!==null?e=0:(Qi=null,rr=0,e=Fi)}if(e!==0){if(e===2&&(s=nI(r),s!==0&&(i=s,e=LI(r,s))),e===1)throw t=B_,Fu(r,0),$l(r,i),es(r,gi()),t;if(e===6)$l(r,i);else{if(s=r.current.alternate,!(i&30)&&!qie(s)&&(e=$x(r,i),e===2&&(n=nI(r),n!==0&&(i=n,e=LI(r,n))),e===1))throw t=B_,Fu(r,0),$l(r,i),es(r,gi()),t;switch(r.finishedWork=s,r.finishedLanes=i,e){case 0:case 1:throw Error(re(345));case 2:ru(r,qr,_o);break;case 3:if($l(r,i),(i&130023424)===i&&(e=bL+500-gi(),10<e)){if(Ex(r,0)!==0)break;if(s=r.suspendedLanes,(s&i)!==i){Br(),r.pingedLanes|=r.suspendedLanes&s;break}r.timeoutHandle=fI(ru.bind(null,r,qr,_o),e);break}ru(r,qr,_o);break;case 4:if($l(r,i),(i&4194240)===i)break;for(e=r.eventTimes,s=-1;0<i;){var a=31-$n(i);n=1<<a,a=e[a],a>s&&(s=a),i&=~n}if(i=s,i=gi()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Xie(i/1960))-i,10<i){r.timeoutHandle=fI(ru.bind(null,r,qr,_o),i);break}ru(r,qr,_o);break;case 5:ru(r,qr,_o);break;default:throw Error(re(329))}}}return es(r,gi()),r.callbackNode===t?bW.bind(null,r):null}function LI(r,e){var t=Vg;return r.current.memoizedState.isDehydrated&&(Fu(r,e).flags|=256),r=$x(r,e),r!==2&&(e=qr,qr=t,e!==null&&OI(e)),r}function OI(r){qr===null?qr=r:qr.push.apply(qr,r)}function qie(r){for(var e=r;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var i=0;i<t.length;i++){var s=t[i],n=s.getSnapshot;s=s.value;try{if(!Xn(n(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function $l(r,e){for(e&=~xL,e&=~AT,r.suspendedLanes|=e,r.pingedLanes&=~e,r=r.expirationTimes;0<e;){var t=31-$n(e),i=1<<t;r[t]=-1,e&=~i}}function IF(r){if(Ke&6)throw Error(re(327));xf();var e=Ex(r,0);if(!(e&1))return es(r,gi()),null;var t=$x(r,e);if(r.tag!==0&&t===2){var i=nI(r);i!==0&&(e=i,t=LI(r,i))}if(t===1)throw t=B_,Fu(r,0),$l(r,e),es(r,gi()),t;if(t===6)throw Error(re(345));return r.finishedWork=r.current.alternate,r.finishedLanes=e,ru(r,qr,_o),es(r,gi()),null}function wL(r,e){var t=Ke;Ke|=1;try{return r(e)}finally{Ke=t,Ke===0&&(tp=gi()+500,bT&&Cc())}}function th(r){Jl!==null&&Jl.tag===0&&!(Ke&6)&&xf();var e=Ke;Ke|=1;var t=sn.transition,i=ft;try{if(sn.transition=null,ft=1,r)return r()}finally{ft=i,sn.transition=t,Ke=e,!(Ke&6)&&Cc()}}function TL(){gs=Wd.current,Wt(Wd)}function Fu(r,e){r.finishedWork=null,r.finishedLanes=0;var t=r.timeoutHandle;if(t!==-1&&(r.timeoutHandle=-1,Tie(t)),bi!==null)for(t=bi.return;t!==null;){var i=t;switch(sL(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Mx();break;case 3:Jf(),Wt(Qr),Wt(Er),fL();break;case 5:dL(i);break;case 4:Jf();break;case 13:Wt(ei);break;case 19:Wt(ei);break;case 10:lL(i.type._context);break;case 22:case 23:TL()}t=t.return}if(Qi=r,bi=r=uc(r.current,null),rr=gs=e,Fi=0,B_=null,xL=AT=eh=0,qr=Vg=null,wu!==null){for(e=0;e<wu.length;e++)if(t=wu[e],i=t.interleaved,i!==null){t.interleaved=null;var s=i.next,n=t.pending;if(n!==null){var a=n.next;n.next=s,i.next=a}t.pending=i}wu=null}return r}function wW(r,e){do{var t=bi;try{if(oL(),GS.current=Ux,Bx){for(var i=ii.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}Bx=!1}if(Ju=0,qi=Ri=ii=null,Ug=!1,N_=0,SL.current=null,t===null||t.return===null){Fi=1,B_=e,bi=null;break}e:{var n=r,a=t.return,o=t,l=e;if(e=rr,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=o,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var d=u.alternate;d?(u.updateQueue=d.updateQueue,u.memoizedState=d.memoizedState,u.lanes=d.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=gF(a);if(f!==null){f.flags&=-257,_F(f,a,o,n,e),f.mode&1&&mF(n,c,e),e=f,l=c;var p=e.updateQueue;if(p===null){var m=new Set;m.add(l),e.updateQueue=m}else p.add(l);break e}else{if(!(e&1)){mF(n,c,e),EL();break e}l=Error(re(426))}}else if(Zt&&o.mode&1){var g=gF(a);if(g!==null){!(g.flags&65536)&&(g.flags|=256),_F(g,a,o,n,e),nL(ep(l,o));break e}}n=l=ep(l,o),Fi!==4&&(Fi=2),Vg===null?Vg=[n]:Vg.push(n),n=a;do{switch(n.tag){case 3:n.flags|=65536,e&=-e,n.lanes|=e;var _=aW(n,l,e);cF(n,_);break e;case 1:o=l;var v=n.type,y=n.stateNode;if(!(n.flags&128)&&(typeof v.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(lc===null||!lc.has(y)))){n.flags|=65536,e&=-e,n.lanes|=e;var x=oW(n,o,e);cF(n,x);break e}}n=n.return}while(n!==null)}AW(t)}catch(S){e=S,bi===t&&t!==null&&(bi=t=t.return);continue}break}while(!0)}function TW(){var r=zx.current;return zx.current=Ux,r===null?Ux:r}function EL(){(Fi===0||Fi===3||Fi===2)&&(Fi=4),Qi===null||!(eh&268435455)&&!(AT&268435455)||$l(Qi,rr)}function $x(r,e){var t=Ke;Ke|=2;var i=TW();(Qi!==r||rr!==e)&&(_o=null,Fu(r,e));do try{Yie();break}catch(s){wW(r,s)}while(!0);if(oL(),Ke=t,zx.current=i,bi!==null)throw Error(re(261));return Qi=null,rr=0,Fi}function Yie(){for(;bi!==null;)EW(bi)}function Kie(){for(;bi!==null&&!xte();)EW(bi)}function EW(r){var e=PW(r.alternate,r,gs);r.memoizedProps=r.pendingProps,e===null?AW(r):bi=e,SL.current=null}function AW(r){var e=r;do{var t=e.alternate;if(r=e.return,e.flags&32768){if(t=$ie(t,e),t!==null){t.flags&=32767,bi=t;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{Fi=6,bi=null;return}}else if(t=jie(t,e,gs),t!==null){bi=t;return}if(e=e.sibling,e!==null){bi=e;return}bi=e=r}while(e!==null);Fi===0&&(Fi=5)}function ru(r,e,t){var i=ft,s=sn.transition;try{sn.transition=null,ft=1,Zie(r,e,t,i)}finally{sn.transition=s,ft=i}return null}function Zie(r,e,t,i){do xf();while(Jl!==null);if(Ke&6)throw Error(re(327));t=r.finishedWork;var s=r.finishedLanes;if(t===null)return null;if(r.finishedWork=null,r.finishedLanes=0,t===r.current)throw Error(re(177));r.callbackNode=null,r.callbackPriority=0;var n=t.lanes|t.childLanes;if(Rte(r,n),r===Qi&&(bi=Qi=null,rr=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||_0||(_0=!0,IW(Tx,function(){return xf(),null})),n=(t.flags&15990)!==0,t.subtreeFlags&15990||n){n=sn.transition,sn.transition=null;var a=ft;ft=1;var o=Ke;Ke|=4,SL.current=null,Gie(r,t),SW(t,r),_ie(hI),Ax=!!uI,hI=uI=null,r.current=t,Wie(t),bte(),Ke=o,ft=a,sn.transition=n}else r.current=t;if(_0&&(_0=!1,Jl=r,jx=s),n=r.pendingLanes,n===0&&(lc=null),Ete(t.stateNode),es(r,gi()),e!==null)for(i=r.onRecoverableError,t=0;t<e.length;t++)s=e[t],i(s.value,{componentStack:s.stack,digest:s.digest});if(Vx)throw Vx=!1,r=RI,RI=null,r;return jx&1&&r.tag!==0&&xf(),n=r.pendingLanes,n&1?r===DI?jg++:(jg=0,DI=r):jg=0,Cc(),null}function xf(){if(Jl!==null){var r=aG(jx),e=sn.transition,t=ft;try{if(sn.transition=null,ft=16>r?16:r,Jl===null)var i=!1;else{if(r=Jl,Jl=null,jx=0,Ke&6)throw Error(re(331));var s=Ke;for(Ke|=4,ue=r.current;ue!==null;){var n=ue,a=n.child;if(ue.flags&16){var o=n.deletions;if(o!==null){for(var l=0;l<o.length;l++){var c=o[l];for(ue=c;ue!==null;){var u=ue;switch(u.tag){case 0:case 11:case 15:zg(8,u,n)}var h=u.child;if(h!==null)h.return=u,ue=h;else for(;ue!==null;){u=ue;var d=u.sibling,f=u.return;if(_W(u),u===c){ue=null;break}if(d!==null){d.return=f,ue=d;break}ue=f}}}var p=n.alternate;if(p!==null){var m=p.child;if(m!==null){p.child=null;do{var g=m.sibling;m.sibling=null,m=g}while(m!==null)}}ue=n}}if(n.subtreeFlags&2064&&a!==null)a.return=n,ue=a;else e:for(;ue!==null;){if(n=ue,n.flags&2048)switch(n.tag){case 0:case 11:case 15:zg(9,n,n.return)}var _=n.sibling;if(_!==null){_.return=n.return,ue=_;break e}ue=n.return}}var v=r.current;for(ue=v;ue!==null;){a=ue;var y=a.child;if(a.subtreeFlags&2064&&y!==null)y.return=a,ue=y;else e:for(a=v;ue!==null;){if(o=ue,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:ET(9,o)}}catch(S){di(o,o.return,S)}if(o===a){ue=null;break e}var x=o.sibling;if(x!==null){x.return=o.return,ue=x;break e}ue=o.return}}if(Ke=s,Cc(),Ra&&typeof Ra.onPostCommitFiberRoot=="function")try{Ra.onPostCommitFiberRoot(_T,r)}catch{}i=!0}return i}finally{ft=t,sn.transition=e}}return!1}function MF(r,e,t){e=ep(t,e),e=aW(r,e,1),r=oc(r,e,1),e=Br(),r!==null&&(ty(r,1,e),es(r,e))}function di(r,e,t){if(r.tag===3)MF(r,r,t);else for(;e!==null;){if(e.tag===3){MF(e,r,t);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(lc===null||!lc.has(i))){r=ep(t,r),r=oW(e,r,1),e=oc(e,r,1),r=Br(),e!==null&&(ty(e,1,r),es(e,r));break}}e=e.return}}function Qie(r,e,t){var i=r.pingCache;i!==null&&i.delete(e),e=Br(),r.pingedLanes|=r.suspendedLanes&t,Qi===r&&(rr&t)===t&&(Fi===4||Fi===3&&(rr&130023424)===rr&&500>gi()-bL?Fu(r,0):xL|=t),es(r,e)}function CW(r,e){e===0&&(r.mode&1?(e=o0,o0<<=1,!(o0&130023424)&&(o0=4194304)):e=1);var t=Br();r=qo(r,e),r!==null&&(ty(r,e,t),es(r,t))}function Jie(r){var e=r.memoizedState,t=0;e!==null&&(t=e.retryLane),CW(r,t)}function ere(r,e){var t=0;switch(r.tag){case 13:var i=r.stateNode,s=r.memoizedState;s!==null&&(t=s.retryLane);break;case 19:i=r.stateNode;break;default:throw Error(re(314))}i!==null&&i.delete(e),CW(r,t)}var PW;PW=function(r,e,t){if(r!==null)if(r.memoizedProps!==e.pendingProps||Qr.current)Kr=!0;else{if(!(r.lanes&t)&&!(e.flags&128))return Kr=!1,Vie(r,e,t);Kr=!!(r.flags&131072)}else Kr=!1,Zt&&e.flags&1048576&&DG(e,Lx,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;XS(r,e),r=e.pendingProps;var s=Kf(e,Er.current);Sf(e,t),s=mL(null,e,i,r,s,t);var n=gL();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Jr(i)?(n=!0,Rx(e)):n=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,uL(e),s.updater=TT,e.stateNode=s,s._reactInternals=e,SI(e,i,r,t),e=wI(null,e,i,!0,n,t)):(e.tag=0,Zt&&n&&rL(e),Mr(null,e,s,t),e=e.child),e;case 16:i=e.elementType;e:{switch(XS(r,e),r=e.pendingProps,s=i._init,i=s(i._payload),e.type=i,s=e.tag=ire(i),r=Pn(i,r),s){case 0:e=bI(null,e,i,r,t);break e;case 1:e=SF(null,e,i,r,t);break e;case 11:e=vF(null,e,i,r,t);break e;case 14:e=yF(null,e,i,Pn(i.type,r),t);break e}throw Error(re(306,i,""))}return e;case 0:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:Pn(i,s),bI(r,e,i,s,t);case 1:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:Pn(i,s),SF(r,e,i,s,t);case 3:e:{if(hW(e),r===null)throw Error(re(387));i=e.pendingProps,n=e.memoizedState,s=n.element,BG(r,e),kx(e,i,null,t);var a=e.memoizedState;if(i=a.element,n.isDehydrated)if(n={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=n,e.memoizedState=n,e.flags&256){s=ep(Error(re(423)),e),e=xF(r,e,i,t,s);break e}else if(i!==s){s=ep(Error(re(424)),e),e=xF(r,e,i,t,s);break e}else for(bs=ac(e.stateNode.containerInfo.firstChild),ws=e,Zt=!0,Bn=null,t=kG(e,null,i,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Zf(),i===s){e=Yo(r,e,t);break e}Mr(r,e,i,t)}e=e.child}return e;case 5:return UG(e),r===null&&_I(e),i=e.type,s=e.pendingProps,n=r!==null?r.memoizedProps:null,a=s.children,dI(i,s)?a=null:n!==null&&dI(i,n)&&(e.flags|=32),uW(r,e),Mr(r,e,a,t),e.child;case 6:return r===null&&_I(e),null;case 13:return dW(r,e,t);case 4:return hL(e,e.stateNode.containerInfo),i=e.pendingProps,r===null?e.child=Qf(e,null,i,t):Mr(r,e,i,t),e.child;case 11:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:Pn(i,s),vF(r,e,i,s,t);case 7:return Mr(r,e,e.pendingProps,t),e.child;case 8:return Mr(r,e,e.pendingProps.children,t),e.child;case 12:return Mr(r,e,e.pendingProps.children,t),e.child;case 10:e:{if(i=e.type._context,s=e.pendingProps,n=e.memoizedProps,a=s.value,Mt(Ox,i._currentValue),i._currentValue=a,n!==null)if(Xn(n.value,a)){if(n.children===s.children&&!Qr.current){e=Yo(r,e,t);break e}}else for(n=e.child,n!==null&&(n.return=e);n!==null;){var o=n.dependencies;if(o!==null){a=n.child;for(var l=o.firstContext;l!==null;){if(l.context===i){if(n.tag===1){l=ko(-1,t&-t),l.tag=2;var c=n.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}n.lanes|=t,l=n.alternate,l!==null&&(l.lanes|=t),vI(n.return,t,e),o.lanes|=t;break}l=l.next}}else if(n.tag===10)a=n.type===e.type?null:n.child;else if(n.tag===18){if(a=n.return,a===null)throw Error(re(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),vI(a,t,e),a=n.sibling}else a=n.child;if(a!==null)a.return=n;else for(a=n;a!==null;){if(a===e){a=null;break}if(n=a.sibling,n!==null){n.return=a.return,a=n;break}a=a.return}n=a}Mr(r,e,s.children,t),e=e.child}return e;case 9:return s=e.type,i=e.pendingProps.children,Sf(e,t),s=ln(s),i=i(s),e.flags|=1,Mr(r,e,i,t),e.child;case 14:return i=e.type,s=Pn(i,e.pendingProps),s=Pn(i.type,s),yF(r,e,i,s,t);case 15:return lW(r,e,e.type,e.pendingProps,t);case 17:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:Pn(i,s),XS(r,e),e.tag=1,Jr(i)?(r=!0,Rx(e)):r=!1,Sf(e,t),nW(e,i,s),SI(e,i,s,t),wI(null,e,i,!0,r,t);case 19:return fW(r,e,t);case 22:return cW(r,e,t)}throw Error(re(156,e.tag))};function IW(r,e){return iG(r,e)}function tre(r,e,t,i){this.tag=r,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function en(r,e,t,i){return new tre(r,e,t,i)}function AL(r){return r=r.prototype,!(!r||!r.isReactComponent)}function ire(r){if(typeof r=="function")return AL(r)?1:0;if(r!=null){if(r=r.$$typeof,r===GD)return 11;if(r===WD)return 14}return 2}function uc(r,e){var t=r.alternate;return t===null?(t=en(r.tag,e,r.key,r.mode),t.elementType=r.elementType,t.type=r.type,t.stateNode=r.stateNode,t.alternate=r,r.alternate=t):(t.pendingProps=e,t.type=r.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=r.flags&14680064,t.childLanes=r.childLanes,t.lanes=r.lanes,t.child=r.child,t.memoizedProps=r.memoizedProps,t.memoizedState=r.memoizedState,t.updateQueue=r.updateQueue,e=r.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=r.sibling,t.index=r.index,t.ref=r.ref,t}function KS(r,e,t,i,s,n){var a=2;if(i=r,typeof r=="function")AL(r)&&(a=1);else if(typeof r=="string")a=5;else e:switch(r){case kd:return Bu(t.children,s,n,e);case HD:a=8,s|=8;break;case HP:return r=en(12,t,e,s|2),r.elementType=HP,r.lanes=n,r;case GP:return r=en(13,t,e,s),r.elementType=GP,r.lanes=n,r;case WP:return r=en(19,t,e,s),r.elementType=WP,r.lanes=n,r;case UH:return CT(t,s,n,e);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case FH:a=10;break e;case BH:a=9;break e;case GD:a=11;break e;case WD:a=14;break e;case Al:a=16,i=null;break e}throw Error(re(130,r==null?r:typeof r,""))}return e=en(a,t,e,s),e.elementType=r,e.type=i,e.lanes=n,e}function Bu(r,e,t,i){return r=en(7,r,i,e),r.lanes=t,r}function CT(r,e,t,i){return r=en(22,r,i,e),r.elementType=UH,r.lanes=t,r.stateNode={isHidden:!1},r}function L1(r,e,t){return r=en(6,r,null,e),r.lanes=t,r}function O1(r,e,t){return e=en(4,r.children!==null?r.children:[],r.key,e),e.lanes=t,e.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},e}function rre(r,e,t,i,s){this.tag=e,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=p1(0),this.expirationTimes=p1(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=p1(0),this.identifierPrefix=i,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function CL(r,e,t,i,s,n,a,o,l){return r=new rre(r,e,t,o,l),e===1?(e=1,n===!0&&(e|=8)):e=0,n=en(3,null,null,e),r.current=n,n.stateNode=r,n.memoizedState={element:i,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},uL(n),r}function sre(r,e,t){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Nd,key:i==null?null:""+i,children:r,containerInfo:e,implementation:t}}function MW(r){if(!r)return vc;r=r._reactInternals;e:{if(Mh(r)!==r||r.tag!==1)throw Error(re(170));var e=r;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Jr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(re(171))}if(r.tag===1){var t=r.type;if(Jr(t))return MG(r,t,e)}return e}function RW(r,e,t,i,s,n,a,o,l){return r=CL(t,i,!0,r,s,n,a,o,l),r.context=MW(null),t=r.current,i=Br(),s=cc(t),n=ko(i,s),n.callback=e??null,oc(t,n,s),r.current.lanes=s,ty(r,s,i),es(r,i),r}function PT(r,e,t,i){var s=e.current,n=Br(),a=cc(s);return t=MW(t),e.context===null?e.context=t:e.pendingContext=t,e=ko(n,a),e.payload={element:r},i=i===void 0?null:i,i!==null&&(e.callback=i),r=oc(s,e,a),r!==null&&(Hn(r,s,a,n),HS(r,s,a)),a}function Hx(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function RF(r,e){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var t=r.retryLane;r.retryLane=t!==0&&t<e?t:e}}function PL(r,e){RF(r,e),(r=r.alternate)&&RF(r,e)}function nre(){return null}var DW=typeof reportError=="function"?reportError:function(r){console.error(r)};function IL(r){this._internalRoot=r}IT.prototype.render=IL.prototype.render=function(r){var e=this._internalRoot;if(e===null)throw Error(re(409));PT(r,e,null,null)};IT.prototype.unmount=IL.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var e=r.containerInfo;th(function(){PT(null,r,null,null)}),e[Xo]=null}};function IT(r){this._internalRoot=r}IT.prototype.unstable_scheduleHydration=function(r){if(r){var e=cG();r={blockedOn:null,target:r,priority:e};for(var t=0;t<jl.length&&e!==0&&e<jl[t].priority;t++);jl.splice(t,0,r),t===0&&hG(r)}};function ML(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function MT(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function DF(){}function are(r,e,t,i,s){if(s){if(typeof i=="function"){var n=i;i=function(){var c=Hx(a);n.call(c)}}var a=RW(e,i,r,0,null,!1,!1,"",DF);return r._reactRootContainer=a,r[Xo]=a.current,M_(r.nodeType===8?r.parentNode:r),th(),a}for(;s=r.lastChild;)r.removeChild(s);if(typeof i=="function"){var o=i;i=function(){var c=Hx(l);o.call(c)}}var l=CL(r,0,!1,null,null,!1,!1,"",DF);return r._reactRootContainer=l,r[Xo]=l.current,M_(r.nodeType===8?r.parentNode:r),th(function(){PT(e,l,t,i)}),l}function RT(r,e,t,i,s){var n=t._reactRootContainer;if(n){var a=n;if(typeof s=="function"){var o=s;s=function(){var l=Hx(a);o.call(l)}}PT(e,a,r,s)}else a=are(t,e,r,s,i);return Hx(a)}oG=function(r){switch(r.tag){case 3:var e=r.stateNode;if(e.current.memoizedState.isDehydrated){var t=Tg(e.pendingLanes);t!==0&&(YD(e,t|1),es(e,gi()),!(Ke&6)&&(tp=gi()+500,Cc()))}break;case 13:th(function(){var i=qo(r,1);if(i!==null){var s=Br();Hn(i,r,1,s)}}),PL(r,1)}};KD=function(r){if(r.tag===13){var e=qo(r,134217728);if(e!==null){var t=Br();Hn(e,r,134217728,t)}PL(r,134217728)}};lG=function(r){if(r.tag===13){var e=cc(r),t=qo(r,e);if(t!==null){var i=Br();Hn(t,r,e,i)}PL(r,e)}};cG=function(){return ft};uG=function(r,e){var t=ft;try{return ft=r,e()}finally{ft=t}};iI=function(r,e,t){switch(e){case"input":if(YP(r,t),e=t.name,t.type==="radio"&&e!=null){for(t=r;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var i=t[e];if(i!==r&&i.form===r.form){var s=xT(i);if(!s)throw Error(re(90));VH(i),YP(i,s)}}}break;case"textarea":$H(r,t);break;case"select":e=t.value,e!=null&&gf(r,!!t.multiple,e,!1)}};KH=wL;ZH=th;var ore={usingClientEntryPoint:!1,Events:[ry,zd,xT,qH,YH,wL]},Vm={findFiberByHostInstance:bu,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},lre={bundleType:Vm.bundleType,version:Vm.version,rendererPackageName:Vm.rendererPackageName,rendererConfig:Vm.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:rl.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=eG(r),r===null?null:r.stateNode},findFiberByHostInstance:Vm.findFiberByHostInstance||nre,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var v0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!v0.isDisabled&&v0.supportsFiber)try{_T=v0.inject(lre),Ra=v0}catch{}}ks.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ore;ks.createPortal=function(r,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ML(e))throw Error(re(200));return sre(r,e,null,t)};ks.createRoot=function(r,e){if(!ML(r))throw Error(re(299));var t=!1,i="",s=DW;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=CL(r,1,!1,null,null,t,!1,i,s),r[Xo]=e.current,M_(r.nodeType===8?r.parentNode:r),new IL(e)};ks.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var e=r._reactInternals;if(e===void 0)throw typeof r.render=="function"?Error(re(188)):(r=Object.keys(r).join(","),Error(re(268,r)));return r=eG(e),r=r===null?null:r.stateNode,r};ks.flushSync=function(r){return th(r)};ks.hydrate=function(r,e,t){if(!MT(e))throw Error(re(200));return RT(null,r,e,!0,t)};ks.hydrateRoot=function(r,e,t){if(!ML(r))throw Error(re(405));var i=t!=null&&t.hydratedSources||null,s=!1,n="",a=DW;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=RW(e,null,r,1,t??null,s,!1,n,a),r[Xo]=e.current,M_(r),i)for(r=0;r<i.length;r++)t=i[r],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new IT(e)};ks.render=function(r,e,t){if(!MT(e))throw Error(re(200));return RT(null,r,e,!1,t)};ks.unmountComponentAtNode=function(r){if(!MT(r))throw Error(re(40));return r._reactRootContainer?(th(function(){RT(null,null,r,!1,function(){r._reactRootContainer=null,r[Xo]=null})}),!0):!1};ks.unstable_batchedUpdates=wL;ks.unstable_renderSubtreeIntoContainer=function(r,e,t,i){if(!MT(t))throw Error(re(200));if(r==null||r._reactInternals===void 0)throw Error(re(38));return RT(r,e,t,!1,i)};ks.version="18.3.1-next-f1338f8080-20240426";function LW(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(LW)}catch(r){console.error(r)}}LW(),LH.exports=ks;var tn=LH.exports;const OW=pt(tn);var NW,LF=tn;NW=LF.createRoot,LF.hydrateRoot;const cre=1,ure=1e6;let N1=0;function hre(){return N1=(N1+1)%Number.MAX_SAFE_INTEGER,N1.toString()}const k1=new Map,OF=r=>{if(k1.has(r))return;const e=setTimeout(()=>{k1.delete(r),$g({type:"REMOVE_TOAST",toastId:r})},ure);k1.set(r,e)},dre=(r,e)=>{switch(e.type){case"ADD_TOAST":return{...r,toasts:[e.toast,...r.toasts].slice(0,cre)};case"UPDATE_TOAST":return{...r,toasts:r.toasts.map(t=>t.id===e.toast.id?{...t,...e.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=e;return t?OF(t):r.toasts.forEach(i=>{OF(i.id)}),{...r,toasts:r.toasts.map(i=>i.id===t||t===void 0?{...i,open:!1}:i)}}case"REMOVE_TOAST":return e.toastId===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(t=>t.id!==e.toastId)}}},ZS=[];let QS={toasts:[]};function $g(r){QS=dre(QS,r),ZS.forEach(e=>{e(QS)})}function fre({...r}){const e=hre(),t=s=>$g({type:"UPDATE_TOAST",toast:{...s,id:e}}),i=()=>$g({type:"DISMISS_TOAST",toastId:e});return $g({type:"ADD_TOAST",toast:{...r,id:e,open:!0,onOpenChange:s=>{s||i()}}}),{id:e,dismiss:i,update:t}}function Ar(){const[r,e]=E.useState(QS);return E.useEffect(()=>(ZS.push(e),()=>{const t=ZS.indexOf(e);t>-1&&ZS.splice(t,1)}),[r]),{...r,toast:fre,dismiss:t=>$g({type:"DISMISS_TOAST",toastId:t})}}function le(r,e,{checkForDefaultPrevented:t=!0}={}){return function(s){if(r==null||r(s),t===!1||!s.defaultPrevented)return e==null?void 0:e(s)}}function NF(r,e){if(typeof r=="function")return r(e);r!=null&&(r.current=e)}function DT(...r){return e=>{let t=!1;const i=r.map(s=>{const n=NF(s,e);return!t&&typeof n=="function"&&(t=!0),n});if(t)return()=>{for(let s=0;s<i.length;s++){const n=i[s];typeof n=="function"?n():NF(r[s],null)}}}}function Ze(...r){return E.useCallback(DT(...r),r)}function pre(r,e){const t=E.createContext(e),i=n=>{const{children:a,...o}=n,l=E.useMemo(()=>o,Object.values(o));return b.jsx(t.Provider,{value:l,children:a})};i.displayName=r+"Provider";function s(n){const a=E.useContext(t);if(a)return a;if(e!==void 0)return e;throw new Error(`\`${n}\` must be used within \`${r}\``)}return[i,s]}function Ga(r,e=[]){let t=[];function i(n,a){const o=E.createContext(a),l=t.length;t=[...t,a];const c=h=>{var _;const{scope:d,children:f,...p}=h,m=((_=d==null?void 0:d[r])==null?void 0:_[l])||o,g=E.useMemo(()=>p,Object.values(p));return b.jsx(m.Provider,{value:g,children:f})};c.displayName=n+"Provider";function u(h,d){var m;const f=((m=d==null?void 0:d[r])==null?void 0:m[l])||o,p=E.useContext(f);if(p)return p;if(a!==void 0)return a;throw new Error(`\`${h}\` must be used within \`${n}\``)}return[c,u]}const s=()=>{const n=t.map(a=>E.createContext(a));return function(o){const l=(o==null?void 0:o[r])||n;return E.useMemo(()=>({[`__scope${r}`]:{...o,[r]:l}}),[o,l])}};return s.scopeName=r,[i,mre(s,...e)]}function mre(...r){const e=r[0];if(r.length===1)return e;const t=()=>{const i=r.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(n){const a=i.reduce((o,{useScope:l,scopeName:c})=>{const h=l(n)[`__scope${c}`];return{...o,...h}},{});return E.useMemo(()=>({[`__scope${e.scopeName}`]:a}),[a])}};return t.scopeName=e.scopeName,t}function ih(r){const e=_re(r),t=E.forwardRef((i,s)=>{const{children:n,...a}=i,o=E.Children.toArray(n),l=o.find(yre);if(l){const c=l.props.children,u=o.map(h=>h===l?E.Children.count(c)>1?E.Children.only(null):E.isValidElement(c)?c.props.children:null:h);return b.jsx(e,{...a,ref:s,children:E.isValidElement(c)?E.cloneElement(c,void 0,u):null})}return b.jsx(e,{...a,ref:s,children:n})});return t.displayName=`${r}.Slot`,t}var gre=ih("Slot");function _re(r){const e=E.forwardRef((t,i)=>{const{children:s,...n}=t;if(E.isValidElement(s)){const a=xre(s),o=Sre(n,s.props);return s.type!==E.Fragment&&(o.ref=i?DT(i,a):a),E.cloneElement(s,o)}return E.Children.count(s)>1?E.Children.only(null):null});return e.displayName=`${r}.SlotClone`,e}var kW=Symbol("radix.slottable");function vre(r){const e=({children:t})=>b.jsx(b.Fragment,{children:t});return e.displayName=`${r}.Slottable`,e.__radixId=kW,e}function yre(r){return E.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===kW}function Sre(r,e){const t={...e};for(const i in e){const s=r[i],n=e[i];/^on[A-Z]/.test(i)?s&&n?t[i]=(...o)=>{const l=n(...o);return s(...o),l}:s&&(t[i]=s):i==="style"?t[i]={...s,...n}:i==="className"&&(t[i]=[s,n].filter(Boolean).join(" "))}return{...r,...t}}function xre(r){var i,s;let e=(i=Object.getOwnPropertyDescriptor(r.props,"ref"))==null?void 0:i.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?r.ref:(e=(s=Object.getOwnPropertyDescriptor(r,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?r.props.ref:r.props.ref||r.ref)}function LT(r){const e=r+"CollectionProvider",[t,i]=Ga(e),[s,n]=t(e,{collectionRef:{current:null},itemMap:new Map}),a=m=>{const{scope:g,children:_}=m,v=U.useRef(null),y=U.useRef(new Map).current;return b.jsx(s,{scope:g,itemMap:y,collectionRef:v,children:_})};a.displayName=e;const o=r+"CollectionSlot",l=ih(o),c=U.forwardRef((m,g)=>{const{scope:_,children:v}=m,y=n(o,_),x=Ze(g,y.collectionRef);return b.jsx(l,{ref:x,children:v})});c.displayName=o;const u=r+"CollectionItemSlot",h="data-radix-collection-item",d=ih(u),f=U.forwardRef((m,g)=>{const{scope:_,children:v,...y}=m,x=U.useRef(null),S=Ze(g,x),w=n(u,_);return U.useEffect(()=>(w.itemMap.set(x,{ref:x,...y}),()=>void w.itemMap.delete(x))),b.jsx(d,{[h]:"",ref:S,children:v})});f.displayName=u;function p(m){const g=n(r+"CollectionConsumer",m);return U.useCallback(()=>{const v=g.collectionRef.current;if(!v)return[];const y=Array.from(v.querySelectorAll(`[${h}]`));return Array.from(g.itemMap.values()).sort((w,T)=>y.indexOf(w.ref.current)-y.indexOf(T.ref.current))},[g.collectionRef,g.itemMap])}return[{Provider:a,Slot:c,ItemSlot:f},p,i]}var bre=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ee=bre.reduce((r,e)=>{const t=ih(`Primitive.${e}`),i=E.forwardRef((s,n)=>{const{asChild:a,...o}=s,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),b.jsx(l,{...o,ref:n})});return i.displayName=`Primitive.${e}`,{...r,[e]:i}},{});function RL(r,e){r&&tn.flushSync(()=>r.dispatchEvent(e))}function is(r){const e=E.useRef(r);return E.useEffect(()=>{e.current=r}),E.useMemo(()=>(...t)=>{var i;return(i=e.current)==null?void 0:i.call(e,...t)},[])}function wre(r,e=globalThis==null?void 0:globalThis.document){const t=is(r);E.useEffect(()=>{const i=s=>{s.key==="Escape"&&t(s)};return e.addEventListener("keydown",i,{capture:!0}),()=>e.removeEventListener("keydown",i,{capture:!0})},[t,e])}var Tre="DismissableLayer",NI="dismissableLayer.update",Ere="dismissableLayer.pointerDownOutside",Are="dismissableLayer.focusOutside",kF,FW=E.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),rm=E.forwardRef((r,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:i,onPointerDownOutside:s,onFocusOutside:n,onInteractOutside:a,onDismiss:o,...l}=r,c=E.useContext(FW),[u,h]=E.useState(null),d=(u==null?void 0:u.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,f]=E.useState({}),p=Ze(e,T=>h(T)),m=Array.from(c.layers),[g]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),_=m.indexOf(g),v=u?m.indexOf(u):-1,y=c.layersWithOutsidePointerEventsDisabled.size>0,x=v>=_,S=Pre(T=>{const A=T.target,C=[...c.branches].some(P=>P.contains(A));!x||C||(s==null||s(T),a==null||a(T),T.defaultPrevented||o==null||o())},d),w=Ire(T=>{const A=T.target;[...c.branches].some(P=>P.contains(A))||(n==null||n(T),a==null||a(T),T.defaultPrevented||o==null||o())},d);return wre(T=>{v===c.layers.size-1&&(i==null||i(T),!T.defaultPrevented&&o&&(T.preventDefault(),o()))},d),E.useEffect(()=>{if(u)return t&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(kF=d.body.style.pointerEvents,d.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),FF(),()=>{t&&c.layersWithOutsidePointerEventsDisabled.size===1&&(d.body.style.pointerEvents=kF)}},[u,d,t,c]),E.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),FF())},[u,c]),E.useEffect(()=>{const T=()=>f({});return document.addEventListener(NI,T),()=>document.removeEventListener(NI,T)},[]),b.jsx(Ee.div,{...l,ref:p,style:{pointerEvents:y?x?"auto":"none":void 0,...r.style},onFocusCapture:le(r.onFocusCapture,w.onFocusCapture),onBlurCapture:le(r.onBlurCapture,w.onBlurCapture),onPointerDownCapture:le(r.onPointerDownCapture,S.onPointerDownCapture)})});rm.displayName=Tre;var Cre="DismissableLayerBranch",BW=E.forwardRef((r,e)=>{const t=E.useContext(FW),i=E.useRef(null),s=Ze(e,i);return E.useEffect(()=>{const n=i.current;if(n)return t.branches.add(n),()=>{t.branches.delete(n)}},[t.branches]),b.jsx(Ee.div,{...r,ref:s})});BW.displayName=Cre;function Pre(r,e=globalThis==null?void 0:globalThis.document){const t=is(r),i=E.useRef(!1),s=E.useRef(()=>{});return E.useEffect(()=>{const n=o=>{if(o.target&&!i.current){let l=function(){UW(Ere,t,c,{discrete:!0})};const c={originalEvent:o};o.pointerType==="touch"?(e.removeEventListener("click",s.current),s.current=l,e.addEventListener("click",s.current,{once:!0})):l()}else e.removeEventListener("click",s.current);i.current=!1},a=window.setTimeout(()=>{e.addEventListener("pointerdown",n)},0);return()=>{window.clearTimeout(a),e.removeEventListener("pointerdown",n),e.removeEventListener("click",s.current)}},[e,t]),{onPointerDownCapture:()=>i.current=!0}}function Ire(r,e=globalThis==null?void 0:globalThis.document){const t=is(r),i=E.useRef(!1);return E.useEffect(()=>{const s=n=>{n.target&&!i.current&&UW(Are,t,{originalEvent:n},{discrete:!1})};return e.addEventListener("focusin",s),()=>e.removeEventListener("focusin",s)},[e,t]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}function FF(){const r=new CustomEvent(NI);document.dispatchEvent(r)}function UW(r,e,t,{discrete:i}){const s=t.originalEvent.target,n=new CustomEvent(r,{bubbles:!1,cancelable:!0,detail:t});e&&s.addEventListener(r,e,{once:!0}),i?RL(s,n):s.dispatchEvent(n)}var Mre=rm,Rre=BW,ar=globalThis!=null&&globalThis.document?E.useLayoutEffect:()=>{},Dre="Portal",ny=E.forwardRef((r,e)=>{var o;const{container:t,...i}=r,[s,n]=E.useState(!1);ar(()=>n(!0),[]);const a=t||s&&((o=globalThis==null?void 0:globalThis.document)==null?void 0:o.body);return a?OW.createPortal(b.jsx(Ee.div,{...i,ref:e}),a):null});ny.displayName=Dre;function Lre(r,e){return E.useReducer((t,i)=>e[t][i]??t,r)}var Jn=r=>{const{present:e,children:t}=r,i=Ore(e),s=typeof t=="function"?t({present:i.isPresent}):E.Children.only(t),n=Ze(i.ref,Nre(s));return typeof t=="function"||i.isPresent?E.cloneElement(s,{ref:n}):null};Jn.displayName="Presence";function Ore(r){const[e,t]=E.useState(),i=E.useRef(null),s=E.useRef(r),n=E.useRef("none"),a=r?"mounted":"unmounted",[o,l]=Lre(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return E.useEffect(()=>{const c=y0(i.current);n.current=o==="mounted"?c:"none"},[o]),ar(()=>{const c=i.current,u=s.current;if(u!==r){const d=n.current,f=y0(c);r?l("MOUNT"):f==="none"||(c==null?void 0:c.display)==="none"?l("UNMOUNT"):l(u&&d!==f?"ANIMATION_OUT":"UNMOUNT"),s.current=r}},[r,l]),ar(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,h=f=>{const m=y0(i.current).includes(f.animationName);if(f.target===e&&m&&(l("ANIMATION_END"),!s.current)){const g=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=g)})}},d=f=>{f.target===e&&(n.current=y0(i.current))};return e.addEventListener("animationstart",d),e.addEventListener("animationcancel",h),e.addEventListener("animationend",h),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",d),e.removeEventListener("animationcancel",h),e.removeEventListener("animationend",h)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:E.useCallback(c=>{i.current=c?getComputedStyle(c):null,t(c)},[])}}function y0(r){return(r==null?void 0:r.animationName)||"none"}function Nre(r){var i,s;let e=(i=Object.getOwnPropertyDescriptor(r.props,"ref"))==null?void 0:i.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?r.ref:(e=(s=Object.getOwnPropertyDescriptor(r,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?r.props.ref:r.props.ref||r.ref)}var kre=zD[" useInsertionEffect ".trim().toString()]||ar;function rh({prop:r,defaultProp:e,onChange:t=()=>{},caller:i}){const[s,n,a]=Fre({defaultProp:e,onChange:t}),o=r!==void 0,l=o?r:s;{const u=E.useRef(r!==void 0);E.useEffect(()=>{const h=u.current;h!==o&&console.warn(`${i} is changing from ${h?"controlled":"uncontrolled"} to ${o?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=o},[o,i])}const c=E.useCallback(u=>{var h;if(o){const d=Bre(u)?u(r):u;d!==r&&((h=a.current)==null||h.call(a,d))}else n(u)},[o,r,n,a]);return[l,c]}function Fre({defaultProp:r,onChange:e}){const[t,i]=E.useState(r),s=E.useRef(t),n=E.useRef(e);return kre(()=>{n.current=e},[e]),E.useEffect(()=>{var a;s.current!==t&&((a=n.current)==null||a.call(n,t),s.current=t)},[t,s]),[t,i,n]}function Bre(r){return typeof r=="function"}var zW=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Ure="VisuallyHidden",OT=E.forwardRef((r,e)=>b.jsx(Ee.span,{...r,ref:e,style:{...zW,...r.style}}));OT.displayName=Ure;var zre=OT,DL="ToastProvider",[LL,Vre,jre]=LT("Toast"),[VW,yit]=Ga("Toast",[jre]),[$re,NT]=VW(DL),jW=r=>{const{__scopeToast:e,label:t="Notification",duration:i=5e3,swipeDirection:s="right",swipeThreshold:n=50,children:a}=r,[o,l]=E.useState(null),[c,u]=E.useState(0),h=E.useRef(!1),d=E.useRef(!1);return t.trim()||console.error(`Invalid prop \`label\` supplied to \`${DL}\`. Expected non-empty \`string\`.`),b.jsx(LL.Provider,{scope:e,children:b.jsx($re,{scope:e,label:t,duration:i,swipeDirection:s,swipeThreshold:n,toastCount:c,viewport:o,onViewportChange:l,onToastAdd:E.useCallback(()=>u(f=>f+1),[]),onToastRemove:E.useCallback(()=>u(f=>f-1),[]),isFocusedToastEscapeKeyDownRef:h,isClosePausedRef:d,children:a})})};jW.displayName=DL;var $W="ToastViewport",Hre=["F8"],kI="toast.viewportPause",FI="toast.viewportResume",HW=E.forwardRef((r,e)=>{const{__scopeToast:t,hotkey:i=Hre,label:s="Notifications ({hotkey})",...n}=r,a=NT($W,t),o=Vre(t),l=E.useRef(null),c=E.useRef(null),u=E.useRef(null),h=E.useRef(null),d=Ze(e,h,a.onViewportChange),f=i.join("+").replace(/Key/g,"").replace(/Digit/g,""),p=a.toastCount>0;E.useEffect(()=>{const g=_=>{var y;i.length!==0&&i.every(x=>_[x]||_.code===x)&&((y=h.current)==null||y.focus())};return document.addEventListener("keydown",g),()=>document.removeEventListener("keydown",g)},[i]),E.useEffect(()=>{const g=l.current,_=h.current;if(p&&g&&_){const v=()=>{if(!a.isClosePausedRef.current){const w=new CustomEvent(kI);_.dispatchEvent(w),a.isClosePausedRef.current=!0}},y=()=>{if(a.isClosePausedRef.current){const w=new CustomEvent(FI);_.dispatchEvent(w),a.isClosePausedRef.current=!1}},x=w=>{!g.contains(w.relatedTarget)&&y()},S=()=>{g.contains(document.activeElement)||y()};return g.addEventListener("focusin",v),g.addEventListener("focusout",x),g.addEventListener("pointermove",v),g.addEventListener("pointerleave",S),window.addEventListener("blur",v),window.addEventListener("focus",y),()=>{g.removeEventListener("focusin",v),g.removeEventListener("focusout",x),g.removeEventListener("pointermove",v),g.removeEventListener("pointerleave",S),window.removeEventListener("blur",v),window.removeEventListener("focus",y)}}},[p,a.isClosePausedRef]);const m=E.useCallback(({tabbingDirection:g})=>{const v=o().map(y=>{const x=y.ref.current,S=[x,...rse(x)];return g==="forwards"?S:S.reverse()});return(g==="forwards"?v.reverse():v).flat()},[o]);return E.useEffect(()=>{const g=h.current;if(g){const _=v=>{var S,w,T;const y=v.altKey||v.ctrlKey||v.metaKey;if(v.key==="Tab"&&!y){const A=document.activeElement,C=v.shiftKey;if(v.target===g&&C){(S=c.current)==null||S.focus();return}const M=m({tabbingDirection:C?"backwards":"forwards"}),N=M.findIndex(k=>k===A);F1(M.slice(N+1))?v.preventDefault():C?(w=c.current)==null||w.focus():(T=u.current)==null||T.focus()}};return g.addEventListener("keydown",_),()=>g.removeEventListener("keydown",_)}},[o,m]),b.jsxs(Rre,{ref:l,role:"region","aria-label":s.replace("{hotkey}",f),tabIndex:-1,style:{pointerEvents:p?void 0:"none"},children:[p&&b.jsx(BI,{ref:c,onFocusFromOutsideViewport:()=>{const g=m({tabbingDirection:"forwards"});F1(g)}}),b.jsx(LL.Slot,{scope:t,children:b.jsx(Ee.ol,{tabIndex:-1,...n,ref:d})}),p&&b.jsx(BI,{ref:u,onFocusFromOutsideViewport:()=>{const g=m({tabbingDirection:"backwards"});F1(g)}})]})});HW.displayName=$W;var GW="ToastFocusProxy",BI=E.forwardRef((r,e)=>{const{__scopeToast:t,onFocusFromOutsideViewport:i,...s}=r,n=NT(GW,t);return b.jsx(OT,{"aria-hidden":!0,tabIndex:0,...s,ref:e,style:{position:"fixed"},onFocus:a=>{var c;const o=a.relatedTarget;!((c=n.viewport)!=null&&c.contains(o))&&i()}})});BI.displayName=GW;var ay="Toast",Gre="toast.swipeStart",Wre="toast.swipeMove",Xre="toast.swipeCancel",qre="toast.swipeEnd",WW=E.forwardRef((r,e)=>{const{forceMount:t,open:i,defaultOpen:s,onOpenChange:n,...a}=r,[o,l]=rh({prop:i,defaultProp:s??!0,onChange:n,caller:ay});return b.jsx(Jn,{present:t||o,children:b.jsx(Zre,{open:o,...a,ref:e,onClose:()=>l(!1),onPause:is(r.onPause),onResume:is(r.onResume),onSwipeStart:le(r.onSwipeStart,c=>{c.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:le(r.onSwipeMove,c=>{const{x:u,y:h}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","move"),c.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${h}px`)}),onSwipeCancel:le(r.onSwipeCancel,c=>{c.currentTarget.setAttribute("data-swipe","cancel"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:le(r.onSwipeEnd,c=>{const{x:u,y:h}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","end"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${h}px`),l(!1)})})})});WW.displayName=ay;var[Yre,Kre]=VW(ay,{onClose(){}}),Zre=E.forwardRef((r,e)=>{const{__scopeToast:t,type:i="foreground",duration:s,open:n,onClose:a,onEscapeKeyDown:o,onPause:l,onResume:c,onSwipeStart:u,onSwipeMove:h,onSwipeCancel:d,onSwipeEnd:f,...p}=r,m=NT(ay,t),[g,_]=E.useState(null),v=Ze(e,k=>_(k)),y=E.useRef(null),x=E.useRef(null),S=s||m.duration,w=E.useRef(0),T=E.useRef(S),A=E.useRef(0),{onToastAdd:C,onToastRemove:P}=m,I=is(()=>{var V;(g==null?void 0:g.contains(document.activeElement))&&((V=m.viewport)==null||V.focus()),a()}),M=E.useCallback(k=>{!k||k===1/0||(window.clearTimeout(A.current),w.current=new Date().getTime(),A.current=window.setTimeout(I,k))},[I]);E.useEffect(()=>{const k=m.viewport;if(k){const V=()=>{M(T.current),c==null||c()},B=()=>{const R=new Date().getTime()-w.current;T.current=T.current-R,window.clearTimeout(A.current),l==null||l()};return k.addEventListener(kI,B),k.addEventListener(FI,V),()=>{k.removeEventListener(kI,B),k.removeEventListener(FI,V)}}},[m.viewport,S,l,c,M]),E.useEffect(()=>{n&&!m.isClosePausedRef.current&&M(S)},[n,S,m.isClosePausedRef,M]),E.useEffect(()=>(C(),()=>P()),[C,P]);const N=E.useMemo(()=>g?JW(g):null,[g]);return m.viewport?b.jsxs(b.Fragment,{children:[N&&b.jsx(Qre,{__scopeToast:t,role:"status","aria-live":i==="foreground"?"assertive":"polite","aria-atomic":!0,children:N}),b.jsx(Yre,{scope:t,onClose:I,children:tn.createPortal(b.jsx(LL.ItemSlot,{scope:t,children:b.jsx(Mre,{asChild:!0,onEscapeKeyDown:le(o,()=>{m.isFocusedToastEscapeKeyDownRef.current||I(),m.isFocusedToastEscapeKeyDownRef.current=!1}),children:b.jsx(Ee.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":n?"open":"closed","data-swipe-direction":m.swipeDirection,...p,ref:v,style:{userSelect:"none",touchAction:"none",...r.style},onKeyDown:le(r.onKeyDown,k=>{k.key==="Escape"&&(o==null||o(k.nativeEvent),k.nativeEvent.defaultPrevented||(m.isFocusedToastEscapeKeyDownRef.current=!0,I()))}),onPointerDown:le(r.onPointerDown,k=>{k.button===0&&(y.current={x:k.clientX,y:k.clientY})}),onPointerMove:le(r.onPointerMove,k=>{if(!y.current)return;const V=k.clientX-y.current.x,B=k.clientY-y.current.y,R=!!x.current,L=["left","right"].includes(m.swipeDirection),D=["left","up"].includes(m.swipeDirection)?Math.min:Math.max,F=L?D(0,V):0,j=L?0:D(0,B),z=k.pointerType==="touch"?10:2,$={x:F,y:j},H={originalEvent:k,delta:$};R?(x.current=$,S0(Wre,h,H,{discrete:!1})):BF($,m.swipeDirection,z)?(x.current=$,S0(Gre,u,H,{discrete:!1}),k.target.setPointerCapture(k.pointerId)):(Math.abs(V)>z||Math.abs(B)>z)&&(y.current=null)}),onPointerUp:le(r.onPointerUp,k=>{const V=x.current,B=k.target;if(B.hasPointerCapture(k.pointerId)&&B.releasePointerCapture(k.pointerId),x.current=null,y.current=null,V){const R=k.currentTarget,L={originalEvent:k,delta:V};BF(V,m.swipeDirection,m.swipeThreshold)?S0(qre,f,L,{discrete:!0}):S0(Xre,d,L,{discrete:!0}),R.addEventListener("click",D=>D.preventDefault(),{once:!0})}})})})}),m.viewport)})]}):null}),Qre=r=>{const{__scopeToast:e,children:t,...i}=r,s=NT(ay,e),[n,a]=E.useState(!1),[o,l]=E.useState(!1);return tse(()=>a(!0)),E.useEffect(()=>{const c=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(c)},[]),o?null:b.jsx(ny,{asChild:!0,children:b.jsx(OT,{...i,children:n&&b.jsxs(b.Fragment,{children:[s.label," ",t]})})})},Jre="ToastTitle",XW=E.forwardRef((r,e)=>{const{__scopeToast:t,...i}=r;return b.jsx(Ee.div,{...i,ref:e})});XW.displayName=Jre;var ese="ToastDescription",qW=E.forwardRef((r,e)=>{const{__scopeToast:t,...i}=r;return b.jsx(Ee.div,{...i,ref:e})});qW.displayName=ese;var YW="ToastAction",KW=E.forwardRef((r,e)=>{const{altText:t,...i}=r;return t.trim()?b.jsx(QW,{altText:t,asChild:!0,children:b.jsx(OL,{...i,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${YW}\`. Expected non-empty \`string\`.`),null)});KW.displayName=YW;var ZW="ToastClose",OL=E.forwardRef((r,e)=>{const{__scopeToast:t,...i}=r,s=Kre(ZW,t);return b.jsx(QW,{asChild:!0,children:b.jsx(Ee.button,{type:"button",...i,ref:e,onClick:le(r.onClick,s.onClose)})})});OL.displayName=ZW;var QW=E.forwardRef((r,e)=>{const{__scopeToast:t,altText:i,...s}=r;return b.jsx(Ee.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":i||void 0,...s,ref:e})});function JW(r){const e=[];return Array.from(r.childNodes).forEach(i=>{if(i.nodeType===i.TEXT_NODE&&i.textContent&&e.push(i.textContent),ise(i)){const s=i.ariaHidden||i.hidden||i.style.display==="none",n=i.dataset.radixToastAnnounceExclude==="";if(!s)if(n){const a=i.dataset.radixToastAnnounceAlt;a&&e.push(a)}else e.push(...JW(i))}}),e}function S0(r,e,t,{discrete:i}){const s=t.originalEvent.currentTarget,n=new CustomEvent(r,{bubbles:!0,cancelable:!0,detail:t});e&&s.addEventListener(r,e,{once:!0}),i?RL(s,n):s.dispatchEvent(n)}var BF=(r,e,t=0)=>{const i=Math.abs(r.x),s=Math.abs(r.y),n=i>s;return e==="left"||e==="right"?n&&i>t:!n&&s>t};function tse(r=()=>{}){const e=is(r);ar(()=>{let t=0,i=0;return t=window.requestAnimationFrame(()=>i=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(t),window.cancelAnimationFrame(i)}},[e])}function ise(r){return r.nodeType===r.ELEMENT_NODE}function rse(r){const e=[],t=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,{acceptNode:i=>{const s=i.tagName==="INPUT"&&i.type==="hidden";return i.disabled||i.hidden||s?NodeFilter.FILTER_SKIP:i.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function F1(r){const e=document.activeElement;return r.some(t=>t===e?!0:(t.focus(),document.activeElement!==e))}var sse=jW,e8=HW,t8=WW,i8=XW,r8=qW,s8=KW,n8=OL;function a8(r){var e,t,i="";if(typeof r=="string"||typeof r=="number")i+=r;else if(typeof r=="object")if(Array.isArray(r)){var s=r.length;for(e=0;e<s;e++)r[e]&&(t=a8(r[e]))&&(i&&(i+=" "),i+=t)}else for(t in r)r[t]&&(i&&(i+=" "),i+=t);return i}function Re(){for(var r,e,t=0,i="",s=arguments.length;t<s;t++)(r=arguments[t])&&(e=a8(r))&&(i&&(i+=" "),i+=e);return i}const UF=r=>typeof r=="boolean"?`${r}`:r===0?"0":r,zF=Re,kT=(r,e)=>t=>{var i;if((e==null?void 0:e.variants)==null)return zF(r,t==null?void 0:t.class,t==null?void 0:t.className);const{variants:s,defaultVariants:n}=e,a=Object.keys(s).map(c=>{const u=t==null?void 0:t[c],h=n==null?void 0:n[c];if(u===null)return null;const d=UF(u)||UF(h);return s[c][d]}),o=t&&Object.entries(t).reduce((c,u)=>{let[h,d]=u;return d===void 0||(c[h]=d),c},{}),l=e==null||(i=e.compoundVariants)===null||i===void 0?void 0:i.reduce((c,u)=>{let{class:h,className:d,...f}=u;return Object.entries(f).every(p=>{let[m,g]=p;return Array.isArray(g)?g.includes({...n,...o}[m]):{...n,...o}[m]===g})?[...c,h,d]:c},[]);return zF(r,a,l,t==null?void 0:t.class,t==null?void 0:t.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nse=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),o8=(...r)=>r.filter((e,t,i)=>!!e&&e.trim()!==""&&i.indexOf(e)===t).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var ase={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ose=E.forwardRef(({color:r="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:i,className:s="",children:n,iconNode:a,...o},l)=>E.createElement("svg",{ref:l,...ase,width:e,height:e,stroke:r,strokeWidth:i?Number(t)*24/Number(e):t,className:o8("lucide",s),...o},[...a.map(([c,u])=>E.createElement(c,u)),...Array.isArray(n)?n:[n]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=(r,e)=>{const t=E.forwardRef(({className:i,...s},n)=>E.createElement(ose,{ref:n,iconNode:e,className:o8(`lucide-${nse(r)}`,i),...s}));return t.displayName=`${r}`,t};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gx=Ge("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lse=Ge("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NL=Ge("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FT=Ge("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cse=Ge("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const use=Ge("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hse=Ge("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dse=Ge("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fse=Ge("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bf=Ge("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pse=Ge("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mse=Ge("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gse=Ge("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VF=Ge("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _se=Ge("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jF=Ge("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vse=Ge("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yse=Ge("Nut",[["path",{d:"M12 4V2",key:"1k5q1u"}],["path",{d:"M5 10v4a7.004 7.004 0 0 0 5.277 6.787c.412.104.802.292 1.102.592L12 22l.621-.621c.3-.3.69-.488 1.102-.592A7.003 7.003 0 0 0 19 14v-4",key:"1tgyif"}],["path",{d:"M12 4C8 4 4.5 6 4 8c-.243.97-.919 1.952-2 3 1.31-.082 1.972-.29 3-1 .54.92.982 1.356 2 2 1.452-.647 1.954-1.098 2.5-2 .595.995 1.151 1.427 2.5 2 1.31-.621 1.862-1.058 2.5-2 .629.977 1.162 1.423 2.5 2 1.209-.548 1.68-.967 2-2 1.032.916 1.683 1.157 3 1-1.297-1.036-1.758-2.03-2-3-.5-2-4-4-8-4Z",key:"tnsqj"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B1=Ge("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sse=Ge("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $F=Ge("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xse=Ge("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l8=Ge("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bse=Ge("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wse=Ge("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ip=Ge("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tse=Ge("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ese=Ge("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ase=Ge("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cse=Ge("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pse=Ge("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ise=Ge("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mse=Ge("Wheat",[["path",{d:"M2 22 16 8",key:"60hf96"}],["path",{d:"M3.47 12.53 5 11l1.53 1.53a3.5 3.5 0 0 1 0 4.94L5 19l-1.53-1.53a3.5 3.5 0 0 1 0-4.94Z",key:"1rdhi6"}],["path",{d:"M7.47 8.53 9 7l1.53 1.53a3.5 3.5 0 0 1 0 4.94L9 15l-1.53-1.53a3.5 3.5 0 0 1 0-4.94Z",key:"1sdzmb"}],["path",{d:"M11.47 4.53 13 3l1.53 1.53a3.5 3.5 0 0 1 0 4.94L13 11l-1.53-1.53a3.5 3.5 0 0 1 0-4.94Z",key:"eoatbi"}],["path",{d:"M20 2h2v2a4 4 0 0 1-4 4h-2V6a4 4 0 0 1 4-4Z",key:"19rau1"}],["path",{d:"M11.47 17.47 13 19l-1.53 1.53a3.5 3.5 0 0 1-4.94 0L5 19l1.53-1.53a3.5 3.5 0 0 1 4.94 0Z",key:"tc8ph9"}],["path",{d:"M15.47 13.47 17 15l-1.53 1.53a3.5 3.5 0 0 1-4.94 0L9 15l1.53-1.53a3.5 3.5 0 0 1 4.94 0Z",key:"2m8kc5"}],["path",{d:"M19.47 9.47 21 11l-1.53 1.53a3.5 3.5 0 0 1-4.94 0L13 11l1.53-1.53a3.5 3.5 0 0 1 4.94 0Z",key:"vex3ng"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kL=Ge("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rse=Ge("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),FL="-",Dse=r=>{const e=Ose(r),{conflictingClassGroups:t,conflictingClassGroupModifiers:i}=r;return{getClassGroupId:a=>{const o=a.split(FL);return o[0]===""&&o.length!==1&&o.shift(),c8(o,e)||Lse(a)},getConflictingClassGroupIds:(a,o)=>{const l=t[a]||[];return o&&i[a]?[...l,...i[a]]:l}}},c8=(r,e)=>{var a;if(r.length===0)return e.classGroupId;const t=r[0],i=e.nextPart.get(t),s=i?c8(r.slice(1),i):void 0;if(s)return s;if(e.validators.length===0)return;const n=r.join(FL);return(a=e.validators.find(({validator:o})=>o(n)))==null?void 0:a.classGroupId},HF=/^\[(.+)\]$/,Lse=r=>{if(HF.test(r)){const e=HF.exec(r)[1],t=e==null?void 0:e.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},Ose=r=>{const{theme:e,prefix:t}=r,i={nextPart:new Map,validators:[]};return kse(Object.entries(r.classGroups),t).forEach(([n,a])=>{UI(a,i,n,e)}),i},UI=(r,e,t,i)=>{r.forEach(s=>{if(typeof s=="string"){const n=s===""?e:GF(e,s);n.classGroupId=t;return}if(typeof s=="function"){if(Nse(s)){UI(s(i),e,t,i);return}e.validators.push({validator:s,classGroupId:t});return}Object.entries(s).forEach(([n,a])=>{UI(a,GF(e,n),t,i)})})},GF=(r,e)=>{let t=r;return e.split(FL).forEach(i=>{t.nextPart.has(i)||t.nextPart.set(i,{nextPart:new Map,validators:[]}),t=t.nextPart.get(i)}),t},Nse=r=>r.isThemeGetter,kse=(r,e)=>e?r.map(([t,i])=>{const s=i.map(n=>typeof n=="string"?e+n:typeof n=="object"?Object.fromEntries(Object.entries(n).map(([a,o])=>[e+a,o])):n);return[t,s]}):r,Fse=r=>{if(r<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,i=new Map;const s=(n,a)=>{t.set(n,a),e++,e>r&&(e=0,i=t,t=new Map)};return{get(n){let a=t.get(n);if(a!==void 0)return a;if((a=i.get(n))!==void 0)return s(n,a),a},set(n,a){t.has(n)?t.set(n,a):s(n,a)}}},u8="!",Bse=r=>{const{separator:e,experimentalParseClassName:t}=r,i=e.length===1,s=e[0],n=e.length,a=o=>{const l=[];let c=0,u=0,h;for(let g=0;g<o.length;g++){let _=o[g];if(c===0){if(_===s&&(i||o.slice(g,g+n)===e)){l.push(o.slice(u,g)),u=g+n;continue}if(_==="/"){h=g;continue}}_==="["?c++:_==="]"&&c--}const d=l.length===0?o:o.substring(u),f=d.startsWith(u8),p=f?d.substring(1):d,m=h&&h>u?h-u:void 0;return{modifiers:l,hasImportantModifier:f,baseClassName:p,maybePostfixModifierPosition:m}};return t?o=>t({className:o,parseClassName:a}):a},Use=r=>{if(r.length<=1)return r;const e=[];let t=[];return r.forEach(i=>{i[0]==="["?(e.push(...t.sort(),i),t=[]):t.push(i)}),e.push(...t.sort()),e},zse=r=>({cache:Fse(r.cacheSize),parseClassName:Bse(r),...Dse(r)}),Vse=/\s+/,jse=(r,e)=>{const{parseClassName:t,getClassGroupId:i,getConflictingClassGroupIds:s}=e,n=[],a=r.trim().split(Vse);let o="";for(let l=a.length-1;l>=0;l-=1){const c=a[l],{modifiers:u,hasImportantModifier:h,baseClassName:d,maybePostfixModifierPosition:f}=t(c);let p=!!f,m=i(p?d.substring(0,f):d);if(!m){if(!p){o=c+(o.length>0?" "+o:o);continue}if(m=i(d),!m){o=c+(o.length>0?" "+o:o);continue}p=!1}const g=Use(u).join(":"),_=h?g+u8:g,v=_+m;if(n.includes(v))continue;n.push(v);const y=s(m,p);for(let x=0;x<y.length;++x){const S=y[x];n.push(_+S)}o=c+(o.length>0?" "+o:o)}return o};function $se(){let r=0,e,t,i="";for(;r<arguments.length;)(e=arguments[r++])&&(t=h8(e))&&(i&&(i+=" "),i+=t);return i}const h8=r=>{if(typeof r=="string")return r;let e,t="";for(let i=0;i<r.length;i++)r[i]&&(e=h8(r[i]))&&(t&&(t+=" "),t+=e);return t};function Hse(r,...e){let t,i,s,n=a;function a(l){const c=e.reduce((u,h)=>h(u),r());return t=zse(c),i=t.cache.get,s=t.cache.set,n=o,o(l)}function o(l){const c=i(l);if(c)return c;const u=jse(l,t);return s(l,u),u}return function(){return n($se.apply(null,arguments))}}const Nt=r=>{const e=t=>t[r]||[];return e.isThemeGetter=!0,e},d8=/^\[(?:([a-z-]+):)?(.+)\]$/i,Gse=/^\d+\/\d+$/,Wse=new Set(["px","full","screen"]),Xse=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,qse=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Yse=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Kse=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Zse=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,to=r=>wf(r)||Wse.has(r)||Gse.test(r),ml=r=>sm(r,"length",nne),wf=r=>!!r&&!Number.isNaN(Number(r)),U1=r=>sm(r,"number",wf),jm=r=>!!r&&Number.isInteger(Number(r)),Qse=r=>r.endsWith("%")&&wf(r.slice(0,-1)),Oe=r=>d8.test(r),gl=r=>Xse.test(r),Jse=new Set(["length","size","percentage"]),ene=r=>sm(r,Jse,f8),tne=r=>sm(r,"position",f8),ine=new Set(["image","url"]),rne=r=>sm(r,ine,one),sne=r=>sm(r,"",ane),$m=()=>!0,sm=(r,e,t)=>{const i=d8.exec(r);return i?i[1]?typeof e=="string"?i[1]===e:e.has(i[1]):t(i[2]):!1},nne=r=>qse.test(r)&&!Yse.test(r),f8=()=>!1,ane=r=>Kse.test(r),one=r=>Zse.test(r),lne=()=>{const r=Nt("colors"),e=Nt("spacing"),t=Nt("blur"),i=Nt("brightness"),s=Nt("borderColor"),n=Nt("borderRadius"),a=Nt("borderSpacing"),o=Nt("borderWidth"),l=Nt("contrast"),c=Nt("grayscale"),u=Nt("hueRotate"),h=Nt("invert"),d=Nt("gap"),f=Nt("gradientColorStops"),p=Nt("gradientColorStopPositions"),m=Nt("inset"),g=Nt("margin"),_=Nt("opacity"),v=Nt("padding"),y=Nt("saturate"),x=Nt("scale"),S=Nt("sepia"),w=Nt("skew"),T=Nt("space"),A=Nt("translate"),C=()=>["auto","contain","none"],P=()=>["auto","hidden","clip","visible","scroll"],I=()=>["auto",Oe,e],M=()=>[Oe,e],N=()=>["",to,ml],k=()=>["auto",wf,Oe],V=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],B=()=>["solid","dashed","dotted","double","none"],R=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],L=()=>["start","end","center","between","around","evenly","stretch"],D=()=>["","0",Oe],F=()=>["auto","avoid","all","avoid-page","page","left","right","column"],j=()=>[wf,Oe];return{cacheSize:500,separator:":",theme:{colors:[$m],spacing:[to,ml],blur:["none","",gl,Oe],brightness:j(),borderColor:[r],borderRadius:["none","","full",gl,Oe],borderSpacing:M(),borderWidth:N(),contrast:j(),grayscale:D(),hueRotate:j(),invert:D(),gap:M(),gradientColorStops:[r],gradientColorStopPositions:[Qse,ml],inset:I(),margin:I(),opacity:j(),padding:M(),saturate:j(),scale:j(),sepia:D(),skew:j(),space:M(),translate:M()},classGroups:{aspect:[{aspect:["auto","square","video",Oe]}],container:["container"],columns:[{columns:[gl]}],"break-after":[{"break-after":F()}],"break-before":[{"break-before":F()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...V(),Oe]}],overflow:[{overflow:P()}],"overflow-x":[{"overflow-x":P()}],"overflow-y":[{"overflow-y":P()}],overscroll:[{overscroll:C()}],"overscroll-x":[{"overscroll-x":C()}],"overscroll-y":[{"overscroll-y":C()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[m]}],"inset-x":[{"inset-x":[m]}],"inset-y":[{"inset-y":[m]}],start:[{start:[m]}],end:[{end:[m]}],top:[{top:[m]}],right:[{right:[m]}],bottom:[{bottom:[m]}],left:[{left:[m]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",jm,Oe]}],basis:[{basis:I()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Oe]}],grow:[{grow:D()}],shrink:[{shrink:D()}],order:[{order:["first","last","none",jm,Oe]}],"grid-cols":[{"grid-cols":[$m]}],"col-start-end":[{col:["auto",{span:["full",jm,Oe]},Oe]}],"col-start":[{"col-start":k()}],"col-end":[{"col-end":k()}],"grid-rows":[{"grid-rows":[$m]}],"row-start-end":[{row:["auto",{span:[jm,Oe]},Oe]}],"row-start":[{"row-start":k()}],"row-end":[{"row-end":k()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Oe]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Oe]}],gap:[{gap:[d]}],"gap-x":[{"gap-x":[d]}],"gap-y":[{"gap-y":[d]}],"justify-content":[{justify:["normal",...L()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...L(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...L(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[v]}],px:[{px:[v]}],py:[{py:[v]}],ps:[{ps:[v]}],pe:[{pe:[v]}],pt:[{pt:[v]}],pr:[{pr:[v]}],pb:[{pb:[v]}],pl:[{pl:[v]}],m:[{m:[g]}],mx:[{mx:[g]}],my:[{my:[g]}],ms:[{ms:[g]}],me:[{me:[g]}],mt:[{mt:[g]}],mr:[{mr:[g]}],mb:[{mb:[g]}],ml:[{ml:[g]}],"space-x":[{"space-x":[T]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[T]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Oe,e]}],"min-w":[{"min-w":[Oe,e,"min","max","fit"]}],"max-w":[{"max-w":[Oe,e,"none","full","min","max","fit","prose",{screen:[gl]},gl]}],h:[{h:[Oe,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Oe,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Oe,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Oe,e,"auto","min","max","fit"]}],"font-size":[{text:["base",gl,ml]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",U1]}],"font-family":[{font:[$m]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Oe]}],"line-clamp":[{"line-clamp":["none",wf,U1]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",to,Oe]}],"list-image":[{"list-image":["none",Oe]}],"list-style-type":[{list:["none","disc","decimal",Oe]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[r]}],"placeholder-opacity":[{"placeholder-opacity":[_]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[r]}],"text-opacity":[{"text-opacity":[_]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...B(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",to,ml]}],"underline-offset":[{"underline-offset":["auto",to,Oe]}],"text-decoration-color":[{decoration:[r]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:M()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Oe]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Oe]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[_]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...V(),tne]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",ene]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},rne]}],"bg-color":[{bg:[r]}],"gradient-from-pos":[{from:[p]}],"gradient-via-pos":[{via:[p]}],"gradient-to-pos":[{to:[p]}],"gradient-from":[{from:[f]}],"gradient-via":[{via:[f]}],"gradient-to":[{to:[f]}],rounded:[{rounded:[n]}],"rounded-s":[{"rounded-s":[n]}],"rounded-e":[{"rounded-e":[n]}],"rounded-t":[{"rounded-t":[n]}],"rounded-r":[{"rounded-r":[n]}],"rounded-b":[{"rounded-b":[n]}],"rounded-l":[{"rounded-l":[n]}],"rounded-ss":[{"rounded-ss":[n]}],"rounded-se":[{"rounded-se":[n]}],"rounded-ee":[{"rounded-ee":[n]}],"rounded-es":[{"rounded-es":[n]}],"rounded-tl":[{"rounded-tl":[n]}],"rounded-tr":[{"rounded-tr":[n]}],"rounded-br":[{"rounded-br":[n]}],"rounded-bl":[{"rounded-bl":[n]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[_]}],"border-style":[{border:[...B(),"hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[_]}],"divide-style":[{divide:B()}],"border-color":[{border:[s]}],"border-color-x":[{"border-x":[s]}],"border-color-y":[{"border-y":[s]}],"border-color-s":[{"border-s":[s]}],"border-color-e":[{"border-e":[s]}],"border-color-t":[{"border-t":[s]}],"border-color-r":[{"border-r":[s]}],"border-color-b":[{"border-b":[s]}],"border-color-l":[{"border-l":[s]}],"divide-color":[{divide:[s]}],"outline-style":[{outline:["",...B()]}],"outline-offset":[{"outline-offset":[to,Oe]}],"outline-w":[{outline:[to,ml]}],"outline-color":[{outline:[r]}],"ring-w":[{ring:N()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[r]}],"ring-opacity":[{"ring-opacity":[_]}],"ring-offset-w":[{"ring-offset":[to,ml]}],"ring-offset-color":[{"ring-offset":[r]}],shadow:[{shadow:["","inner","none",gl,sne]}],"shadow-color":[{shadow:[$m]}],opacity:[{opacity:[_]}],"mix-blend":[{"mix-blend":[...R(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":R()}],filter:[{filter:["","none"]}],blur:[{blur:[t]}],brightness:[{brightness:[i]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",gl,Oe]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[h]}],saturate:[{saturate:[y]}],sepia:[{sepia:[S]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[t]}],"backdrop-brightness":[{"backdrop-brightness":[i]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[h]}],"backdrop-opacity":[{"backdrop-opacity":[_]}],"backdrop-saturate":[{"backdrop-saturate":[y]}],"backdrop-sepia":[{"backdrop-sepia":[S]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[a]}],"border-spacing-x":[{"border-spacing-x":[a]}],"border-spacing-y":[{"border-spacing-y":[a]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Oe]}],duration:[{duration:j()}],ease:[{ease:["linear","in","out","in-out",Oe]}],delay:[{delay:j()}],animate:[{animate:["none","spin","ping","pulse","bounce",Oe]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[x]}],"scale-x":[{"scale-x":[x]}],"scale-y":[{"scale-y":[x]}],rotate:[{rotate:[jm,Oe]}],"translate-x":[{"translate-x":[A]}],"translate-y":[{"translate-y":[A]}],"skew-x":[{"skew-x":[w]}],"skew-y":[{"skew-y":[w]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Oe]}],accent:[{accent:["auto",r]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Oe]}],"caret-color":[{caret:[r]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":M()}],"scroll-mx":[{"scroll-mx":M()}],"scroll-my":[{"scroll-my":M()}],"scroll-ms":[{"scroll-ms":M()}],"scroll-me":[{"scroll-me":M()}],"scroll-mt":[{"scroll-mt":M()}],"scroll-mr":[{"scroll-mr":M()}],"scroll-mb":[{"scroll-mb":M()}],"scroll-ml":[{"scroll-ml":M()}],"scroll-p":[{"scroll-p":M()}],"scroll-px":[{"scroll-px":M()}],"scroll-py":[{"scroll-py":M()}],"scroll-ps":[{"scroll-ps":M()}],"scroll-pe":[{"scroll-pe":M()}],"scroll-pt":[{"scroll-pt":M()}],"scroll-pr":[{"scroll-pr":M()}],"scroll-pb":[{"scroll-pb":M()}],"scroll-pl":[{"scroll-pl":M()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Oe]}],fill:[{fill:[r,"none"]}],"stroke-w":[{stroke:[to,ml,U1]}],stroke:[{stroke:[r,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},cne=Hse(lne);function ye(...r){return cne(Re(r))}const une=sse,p8=E.forwardRef(({className:r,...e},t)=>b.jsx(e8,{ref:t,className:ye("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",r),...e}));p8.displayName=e8.displayName;const hne=kT("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),m8=E.forwardRef(({className:r,variant:e,...t},i)=>b.jsx(t8,{ref:i,className:ye(hne({variant:e}),r),...t}));m8.displayName=t8.displayName;const dne=E.forwardRef(({className:r,...e},t)=>b.jsx(s8,{ref:t,className:ye("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",r),...e}));dne.displayName=s8.displayName;const g8=E.forwardRef(({className:r,...e},t)=>b.jsx(n8,{ref:t,className:ye("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",r),"toast-close":"",...e,children:b.jsx(kL,{className:"h-4 w-4"})}));g8.displayName=n8.displayName;const _8=E.forwardRef(({className:r,...e},t)=>b.jsx(i8,{ref:t,className:ye("text-sm font-semibold",r),...e}));_8.displayName=i8.displayName;const v8=E.forwardRef(({className:r,...e},t)=>b.jsx(r8,{ref:t,className:ye("text-sm opacity-90",r),...e}));v8.displayName=r8.displayName;function fne(){const{toasts:r}=Ar();return b.jsxs(une,{children:[r.map(function({id:e,title:t,description:i,action:s,...n}){return b.jsxs(m8,{...n,children:[b.jsxs("div",{className:"grid gap-1",children:[t&&b.jsx(_8,{children:t}),i&&b.jsx(v8,{children:i})]}),s,b.jsx(g8,{})]},e)}),b.jsx(p8,{})]})}var Wx=["light","dark"],BL="(prefers-color-scheme: dark)",pne=typeof window>"u",UL=E.createContext(void 0),mne={setTheme:r=>{},themes:[]},y8=()=>{var r;return(r=E.useContext(UL))!=null?r:mne},gne=r=>E.useContext(UL)?r.children:E.createElement(vne,{...r}),_ne=["light","dark"],vne=({forcedTheme:r,disableTransitionOnChange:e=!1,enableSystem:t=!0,enableColorScheme:i=!0,storageKey:s="theme",themes:n=_ne,defaultTheme:a=t?"system":"light",attribute:o="data-theme",value:l,children:c,nonce:u})=>{let[h,d]=E.useState(()=>WF(s,a)),[f,p]=E.useState(()=>WF(s)),m=l?Object.values(l):n,g=E.useCallback(x=>{let S=x;if(!S)return;x==="system"&&t&&(S=XF());let w=l?l[S]:S,T=e?Sne():null,A=document.documentElement;if(o==="class"?(A.classList.remove(...m),w&&A.classList.add(w)):w?A.setAttribute(o,w):A.removeAttribute(o),i){let C=Wx.includes(a)?a:null,P=Wx.includes(S)?S:C;A.style.colorScheme=P}T==null||T()},[]),_=E.useCallback(x=>{let S=typeof x=="function"?x(x):x;d(S);try{localStorage.setItem(s,S)}catch{}},[r]),v=E.useCallback(x=>{let S=XF(x);p(S),h==="system"&&t&&!r&&g("system")},[h,r]);E.useEffect(()=>{let x=window.matchMedia(BL);return x.addListener(v),v(x),()=>x.removeListener(v)},[v]),E.useEffect(()=>{let x=S=>{if(S.key!==s)return;let w=S.newValue||a;_(w)};return window.addEventListener("storage",x),()=>window.removeEventListener("storage",x)},[_]),E.useEffect(()=>{g(r??h)},[r,h]);let y=E.useMemo(()=>({theme:h,setTheme:_,forcedTheme:r,resolvedTheme:h==="system"?f:h,themes:t?[...n,"system"]:n,systemTheme:t?f:void 0}),[h,_,r,f,t,n]);return E.createElement(UL.Provider,{value:y},E.createElement(yne,{forcedTheme:r,disableTransitionOnChange:e,enableSystem:t,enableColorScheme:i,storageKey:s,themes:n,defaultTheme:a,attribute:o,value:l,children:c,attrs:m,nonce:u}),c)},yne=E.memo(({forcedTheme:r,storageKey:e,attribute:t,enableSystem:i,enableColorScheme:s,defaultTheme:n,value:a,attrs:o,nonce:l})=>{let c=n==="system",u=t==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${o.map(p=>`'${p}'`).join(",")})`};`:`var d=document.documentElement,n='${t}',s='setAttribute';`,h=s?Wx.includes(n)&&n?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${n}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",d=(p,m=!1,g=!0)=>{let _=a?a[p]:p,v=m?p+"|| ''":`'${_}'`,y="";return s&&g&&!m&&Wx.includes(p)&&(y+=`d.style.colorScheme = '${p}';`),t==="class"?m||_?y+=`c.add(${v})`:y+="null":_&&(y+=`d[s](n,${v})`),y},f=r?`!function(){${u}${d(r)}}()`:i?`!function(){try{${u}var e=localStorage.getItem('${e}');if('system'===e||(!e&&${c})){var t='${BL}',m=window.matchMedia(t);if(m.media!==t||m.matches){${d("dark")}}else{${d("light")}}}else if(e){${a?`var x=${JSON.stringify(a)};`:""}${d(a?"x[e]":"e",!0)}}${c?"":"else{"+d(n,!1,!1)+"}"}${h}}catch(e){}}()`:`!function(){try{${u}var e=localStorage.getItem('${e}');if(e){${a?`var x=${JSON.stringify(a)};`:""}${d(a?"x[e]":"e",!0)}}else{${d(n,!1,!1)};}${h}}catch(t){}}();`;return E.createElement("script",{nonce:l,dangerouslySetInnerHTML:{__html:f}})}),WF=(r,e)=>{if(pne)return;let t;try{t=localStorage.getItem(r)||void 0}catch{}return t||e},Sne=()=>{let r=document.createElement("style");return r.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),document.head.appendChild(r),()=>{window.getComputedStyle(document.body),setTimeout(()=>{document.head.removeChild(r)},1)}},XF=r=>(r||(r=window.matchMedia(BL)),r.matches?"dark":"light"),xne=r=>{switch(r){case"success":return Tne;case"info":return Ane;case"warning":return Ene;case"error":return Cne;default:return null}},bne=Array(12).fill(0),wne=({visible:r,className:e})=>U.createElement("div",{className:["sonner-loading-wrapper",e].filter(Boolean).join(" "),"data-visible":r},U.createElement("div",{className:"sonner-spinner"},bne.map((t,i)=>U.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${i}`})))),Tne=U.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},U.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),Ene=U.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},U.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),Ane=U.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},U.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),Cne=U.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},U.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Pne=U.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},U.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),U.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),Ine=()=>{let[r,e]=U.useState(document.hidden);return U.useEffect(()=>{let t=()=>{e(document.hidden)};return document.addEventListener("visibilitychange",t),()=>window.removeEventListener("visibilitychange",t)},[]),r},zI=1,Mne=class{constructor(){this.subscribe=r=>(this.subscribers.push(r),()=>{let e=this.subscribers.indexOf(r);this.subscribers.splice(e,1)}),this.publish=r=>{this.subscribers.forEach(e=>e(r))},this.addToast=r=>{this.publish(r),this.toasts=[...this.toasts,r]},this.create=r=>{var e;let{message:t,...i}=r,s=typeof(r==null?void 0:r.id)=="number"||((e=r.id)==null?void 0:e.length)>0?r.id:zI++,n=this.toasts.find(o=>o.id===s),a=r.dismissible===void 0?!0:r.dismissible;return this.dismissedToasts.has(s)&&this.dismissedToasts.delete(s),n?this.toasts=this.toasts.map(o=>o.id===s?(this.publish({...o,...r,id:s,title:t}),{...o,...r,id:s,dismissible:a,title:t}):o):this.addToast({title:t,...i,dismissible:a,id:s}),s},this.dismiss=r=>(this.dismissedToasts.add(r),r||this.toasts.forEach(e=>{this.subscribers.forEach(t=>t({id:e.id,dismiss:!0}))}),this.subscribers.forEach(e=>e({id:r,dismiss:!0})),r),this.message=(r,e)=>this.create({...e,message:r}),this.error=(r,e)=>this.create({...e,message:r,type:"error"}),this.success=(r,e)=>this.create({...e,type:"success",message:r}),this.info=(r,e)=>this.create({...e,type:"info",message:r}),this.warning=(r,e)=>this.create({...e,type:"warning",message:r}),this.loading=(r,e)=>this.create({...e,type:"loading",message:r}),this.promise=(r,e)=>{if(!e)return;let t;e.loading!==void 0&&(t=this.create({...e,promise:r,type:"loading",message:e.loading,description:typeof e.description!="function"?e.description:void 0}));let i=r instanceof Promise?r:r(),s=t!==void 0,n,a=i.then(async l=>{if(n=["resolve",l],U.isValidElement(l))s=!1,this.create({id:t,type:"default",message:l});else if(Dne(l)&&!l.ok){s=!1;let c=typeof e.error=="function"?await e.error(`HTTP error! status: ${l.status}`):e.error,u=typeof e.description=="function"?await e.description(`HTTP error! status: ${l.status}`):e.description;this.create({id:t,type:"error",message:c,description:u})}else if(e.success!==void 0){s=!1;let c=typeof e.success=="function"?await e.success(l):e.success,u=typeof e.description=="function"?await e.description(l):e.description;this.create({id:t,type:"success",message:c,description:u})}}).catch(async l=>{if(n=["reject",l],e.error!==void 0){s=!1;let c=typeof e.error=="function"?await e.error(l):e.error,u=typeof e.description=="function"?await e.description(l):e.description;this.create({id:t,type:"error",message:c,description:u})}}).finally(()=>{var l;s&&(this.dismiss(t),t=void 0),(l=e.finally)==null||l.call(e)}),o=()=>new Promise((l,c)=>a.then(()=>n[0]==="reject"?c(n[1]):l(n[1])).catch(c));return typeof t!="string"&&typeof t!="number"?{unwrap:o}:Object.assign(t,{unwrap:o})},this.custom=(r,e)=>{let t=(e==null?void 0:e.id)||zI++;return this.create({jsx:r(t),id:t,...e}),t},this.getActiveToasts=()=>this.toasts.filter(r=>!this.dismissedToasts.has(r.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},Gr=new Mne,Rne=(r,e)=>{let t=(e==null?void 0:e.id)||zI++;return Gr.addToast({title:r,...e,id:t}),t},Dne=r=>r&&typeof r=="object"&&"ok"in r&&typeof r.ok=="boolean"&&"status"in r&&typeof r.status=="number",Lne=Rne,One=()=>Gr.toasts,Nne=()=>Gr.getActiveToasts();Object.assign(Lne,{success:Gr.success,info:Gr.info,warning:Gr.warning,error:Gr.error,custom:Gr.custom,message:Gr.message,promise:Gr.promise,dismiss:Gr.dismiss,loading:Gr.loading},{getHistory:One,getToasts:Nne});function kne(r,{insertAt:e}={}){if(typeof document>"u")return;let t=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",e==="top"&&t.firstChild?t.insertBefore(i,t.firstChild):t.appendChild(i),i.styleSheet?i.styleSheet.cssText=r:i.appendChild(document.createTextNode(r))}kne(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function x0(r){return r.label!==void 0}var Fne=3,Bne="32px",Une="16px",qF=4e3,zne=356,Vne=14,jne=20,$ne=200;function _n(...r){return r.filter(Boolean).join(" ")}function Hne(r){let[e,t]=r.split("-"),i=[];return e&&i.push(e),t&&i.push(t),i}var Gne=r=>{var e,t,i,s,n,a,o,l,c,u,h;let{invert:d,toast:f,unstyled:p,interacting:m,setHeights:g,visibleToasts:_,heights:v,index:y,toasts:x,expanded:S,removeToast:w,defaultRichColors:T,closeButton:A,style:C,cancelButtonStyle:P,actionButtonStyle:I,className:M="",descriptionClassName:N="",duration:k,position:V,gap:B,loadingIcon:R,expandByDefault:L,classNames:D,icons:F,closeButtonAriaLabel:j="Close toast",pauseWhenPageIsHidden:z}=r,[$,H]=U.useState(null),[G,Y]=U.useState(null),[W,ie]=U.useState(!1),[q,K]=U.useState(!1),[te,X]=U.useState(!1),[_e,pe]=U.useState(!1),[ze,Fe]=U.useState(!1),[vt,ne]=U.useState(0),[vi,pi]=U.useState(0),ni=U.useRef(f.duration||k||qF),Ci=U.useRef(null),er=U.useRef(null),lr=y===0,Cr=y+1<=_,Ae=f.type,$i=f.dismissible!==!1,ns=f.className||"",mn=f.descriptionClassName||"",Ja=U.useMemo(()=>v.findIndex(ve=>ve.toastId===f.id)||0,[v,f.id]),as=U.useMemo(()=>{var ve;return(ve=f.closeButton)!=null?ve:A},[f.closeButton,A]),hl=U.useMemo(()=>f.duration||k||qF,[f.duration,k]),Mm=U.useRef(0),dl=U.useRef(0),Hh=U.useRef(0),eo=U.useRef(null),[n1,Qy]=V.split("-"),Jy=U.useMemo(()=>v.reduce((ve,Le,Be)=>Be>=Ja?ve:ve+Le.height,0),[v,Ja]),e0=Ine(),a1=f.invert||d,yi=Ae==="loading";dl.current=U.useMemo(()=>Ja*B+Jy,[Ja,Jy]),U.useEffect(()=>{ni.current=hl},[hl]),U.useEffect(()=>{ie(!0)},[]),U.useEffect(()=>{let ve=er.current;if(ve){let Le=ve.getBoundingClientRect().height;return pi(Le),g(Be=>[{toastId:f.id,height:Le,position:f.position},...Be]),()=>g(Be=>Be.filter(oi=>oi.toastId!==f.id))}},[g,f.id]),U.useLayoutEffect(()=>{if(!W)return;let ve=er.current,Le=ve.style.height;ve.style.height="auto";let Be=ve.getBoundingClientRect().height;ve.style.height=Le,pi(Be),g(oi=>oi.find(Hi=>Hi.toastId===f.id)?oi.map(Hi=>Hi.toastId===f.id?{...Hi,height:Be}:Hi):[{toastId:f.id,height:Be,position:f.position},...oi])},[W,f.title,f.description,g,f.id]);let ai=U.useCallback(()=>{K(!0),ne(dl.current),g(ve=>ve.filter(Le=>Le.toastId!==f.id)),setTimeout(()=>{w(f)},$ne)},[f,w,g,dl]);U.useEffect(()=>{if(f.promise&&Ae==="loading"||f.duration===1/0||f.type==="loading")return;let ve;return S||m||z&&e0?(()=>{if(Hh.current<Mm.current){let Le=new Date().getTime()-Mm.current;ni.current=ni.current-Le}Hh.current=new Date().getTime()})():ni.current!==1/0&&(Mm.current=new Date().getTime(),ve=setTimeout(()=>{var Le;(Le=f.onAutoClose)==null||Le.call(f,f),ai()},ni.current)),()=>clearTimeout(ve)},[S,m,f,Ae,z,e0,ai]),U.useEffect(()=>{f.delete&&ai()},[ai,f.delete]);function Pr(){var ve,Le,Be;return F!=null&&F.loading?U.createElement("div",{className:_n(D==null?void 0:D.loader,(ve=f==null?void 0:f.classNames)==null?void 0:ve.loader,"sonner-loader"),"data-visible":Ae==="loading"},F.loading):R?U.createElement("div",{className:_n(D==null?void 0:D.loader,(Le=f==null?void 0:f.classNames)==null?void 0:Le.loader,"sonner-loader"),"data-visible":Ae==="loading"},R):U.createElement(wne,{className:_n(D==null?void 0:D.loader,(Be=f==null?void 0:f.classNames)==null?void 0:Be.loader),visible:Ae==="loading"})}return U.createElement("li",{tabIndex:0,ref:er,className:_n(M,ns,D==null?void 0:D.toast,(e=f==null?void 0:f.classNames)==null?void 0:e.toast,D==null?void 0:D.default,D==null?void 0:D[Ae],(t=f==null?void 0:f.classNames)==null?void 0:t[Ae]),"data-sonner-toast":"","data-rich-colors":(i=f.richColors)!=null?i:T,"data-styled":!(f.jsx||f.unstyled||p),"data-mounted":W,"data-promise":!!f.promise,"data-swiped":ze,"data-removed":q,"data-visible":Cr,"data-y-position":n1,"data-x-position":Qy,"data-index":y,"data-front":lr,"data-swiping":te,"data-dismissible":$i,"data-type":Ae,"data-invert":a1,"data-swipe-out":_e,"data-swipe-direction":G,"data-expanded":!!(S||L&&W),style:{"--index":y,"--toasts-before":y,"--z-index":x.length-y,"--offset":`${q?vt:dl.current}px`,"--initial-height":L?"auto":`${vi}px`,...C,...f.style},onDragEnd:()=>{X(!1),H(null),eo.current=null},onPointerDown:ve=>{yi||!$i||(Ci.current=new Date,ne(dl.current),ve.target.setPointerCapture(ve.pointerId),ve.target.tagName!=="BUTTON"&&(X(!0),eo.current={x:ve.clientX,y:ve.clientY}))},onPointerUp:()=>{var ve,Le,Be,oi;if(_e||!$i)return;eo.current=null;let Hi=Number(((ve=er.current)==null?void 0:ve.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Tt=Number(((Le=er.current)==null?void 0:Le.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),cr=new Date().getTime()-((Be=Ci.current)==null?void 0:Be.getTime()),li=$==="x"?Hi:Tt,Gi=Math.abs(li)/cr;if(Math.abs(li)>=jne||Gi>.11){ne(dl.current),(oi=f.onDismiss)==null||oi.call(f,f),Y($==="x"?Hi>0?"right":"left":Tt>0?"down":"up"),ai(),pe(!0),Fe(!1);return}X(!1),H(null)},onPointerMove:ve=>{var Le,Be,oi,Hi;if(!eo.current||!$i||((Le=window.getSelection())==null?void 0:Le.toString().length)>0)return;let Tt=ve.clientY-eo.current.y,cr=ve.clientX-eo.current.x,li=(Be=r.swipeDirections)!=null?Be:Hne(V);!$&&(Math.abs(cr)>1||Math.abs(Tt)>1)&&H(Math.abs(cr)>Math.abs(Tt)?"x":"y");let Gi={x:0,y:0};$==="y"?(li.includes("top")||li.includes("bottom"))&&(li.includes("top")&&Tt<0||li.includes("bottom")&&Tt>0)&&(Gi.y=Tt):$==="x"&&(li.includes("left")||li.includes("right"))&&(li.includes("left")&&cr<0||li.includes("right")&&cr>0)&&(Gi.x=cr),(Math.abs(Gi.x)>0||Math.abs(Gi.y)>0)&&Fe(!0),(oi=er.current)==null||oi.style.setProperty("--swipe-amount-x",`${Gi.x}px`),(Hi=er.current)==null||Hi.style.setProperty("--swipe-amount-y",`${Gi.y}px`)}},as&&!f.jsx?U.createElement("button",{"aria-label":j,"data-disabled":yi,"data-close-button":!0,onClick:yi||!$i?()=>{}:()=>{var ve;ai(),(ve=f.onDismiss)==null||ve.call(f,f)},className:_n(D==null?void 0:D.closeButton,(s=f==null?void 0:f.classNames)==null?void 0:s.closeButton)},(n=F==null?void 0:F.close)!=null?n:Pne):null,f.jsx||E.isValidElement(f.title)?f.jsx?f.jsx:typeof f.title=="function"?f.title():f.title:U.createElement(U.Fragment,null,Ae||f.icon||f.promise?U.createElement("div",{"data-icon":"",className:_n(D==null?void 0:D.icon,(a=f==null?void 0:f.classNames)==null?void 0:a.icon)},f.promise||f.type==="loading"&&!f.icon?f.icon||Pr():null,f.type!=="loading"?f.icon||(F==null?void 0:F[Ae])||xne(Ae):null):null,U.createElement("div",{"data-content":"",className:_n(D==null?void 0:D.content,(o=f==null?void 0:f.classNames)==null?void 0:o.content)},U.createElement("div",{"data-title":"",className:_n(D==null?void 0:D.title,(l=f==null?void 0:f.classNames)==null?void 0:l.title)},typeof f.title=="function"?f.title():f.title),f.description?U.createElement("div",{"data-description":"",className:_n(N,mn,D==null?void 0:D.description,(c=f==null?void 0:f.classNames)==null?void 0:c.description)},typeof f.description=="function"?f.description():f.description):null),E.isValidElement(f.cancel)?f.cancel:f.cancel&&x0(f.cancel)?U.createElement("button",{"data-button":!0,"data-cancel":!0,style:f.cancelButtonStyle||P,onClick:ve=>{var Le,Be;x0(f.cancel)&&$i&&((Be=(Le=f.cancel).onClick)==null||Be.call(Le,ve),ai())},className:_n(D==null?void 0:D.cancelButton,(u=f==null?void 0:f.classNames)==null?void 0:u.cancelButton)},f.cancel.label):null,E.isValidElement(f.action)?f.action:f.action&&x0(f.action)?U.createElement("button",{"data-button":!0,"data-action":!0,style:f.actionButtonStyle||I,onClick:ve=>{var Le,Be;x0(f.action)&&((Be=(Le=f.action).onClick)==null||Be.call(Le,ve),!ve.defaultPrevented&&ai())},className:_n(D==null?void 0:D.actionButton,(h=f==null?void 0:f.classNames)==null?void 0:h.actionButton)},f.action.label):null))};function YF(){if(typeof window>"u"||typeof document>"u")return"ltr";let r=document.documentElement.getAttribute("dir");return r==="auto"||!r?window.getComputedStyle(document.documentElement).direction:r}function Wne(r,e){let t={};return[r,e].forEach((i,s)=>{let n=s===1,a=n?"--mobile-offset":"--offset",o=n?Une:Bne;function l(c){["top","right","bottom","left"].forEach(u=>{t[`${a}-${u}`]=typeof c=="number"?`${c}px`:c})}typeof i=="number"||typeof i=="string"?l(i):typeof i=="object"?["top","right","bottom","left"].forEach(c=>{i[c]===void 0?t[`${a}-${c}`]=o:t[`${a}-${c}`]=typeof i[c]=="number"?`${i[c]}px`:i[c]}):l(o)}),t}var Xne=E.forwardRef(function(r,e){let{invert:t,position:i="bottom-right",hotkey:s=["altKey","KeyT"],expand:n,closeButton:a,className:o,offset:l,mobileOffset:c,theme:u="light",richColors:h,duration:d,style:f,visibleToasts:p=Fne,toastOptions:m,dir:g=YF(),gap:_=Vne,loadingIcon:v,icons:y,containerAriaLabel:x="Notifications",pauseWhenPageIsHidden:S}=r,[w,T]=U.useState([]),A=U.useMemo(()=>Array.from(new Set([i].concat(w.filter(z=>z.position).map(z=>z.position)))),[w,i]),[C,P]=U.useState([]),[I,M]=U.useState(!1),[N,k]=U.useState(!1),[V,B]=U.useState(u!=="system"?u:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),R=U.useRef(null),L=s.join("+").replace(/Key/g,"").replace(/Digit/g,""),D=U.useRef(null),F=U.useRef(!1),j=U.useCallback(z=>{T($=>{var H;return(H=$.find(G=>G.id===z.id))!=null&&H.delete||Gr.dismiss(z.id),$.filter(({id:G})=>G!==z.id)})},[]);return U.useEffect(()=>Gr.subscribe(z=>{if(z.dismiss){T($=>$.map(H=>H.id===z.id?{...H,delete:!0}:H));return}setTimeout(()=>{OW.flushSync(()=>{T($=>{let H=$.findIndex(G=>G.id===z.id);return H!==-1?[...$.slice(0,H),{...$[H],...z},...$.slice(H+1)]:[z,...$]})})})}),[]),U.useEffect(()=>{if(u!=="system"){B(u);return}if(u==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?B("dark"):B("light")),typeof window>"u")return;let z=window.matchMedia("(prefers-color-scheme: dark)");try{z.addEventListener("change",({matches:$})=>{B($?"dark":"light")})}catch{z.addListener(({matches:H})=>{try{B(H?"dark":"light")}catch(G){console.error(G)}})}},[u]),U.useEffect(()=>{w.length<=1&&M(!1)},[w]),U.useEffect(()=>{let z=$=>{var H,G;s.every(Y=>$[Y]||$.code===Y)&&(M(!0),(H=R.current)==null||H.focus()),$.code==="Escape"&&(document.activeElement===R.current||(G=R.current)!=null&&G.contains(document.activeElement))&&M(!1)};return document.addEventListener("keydown",z),()=>document.removeEventListener("keydown",z)},[s]),U.useEffect(()=>{if(R.current)return()=>{D.current&&(D.current.focus({preventScroll:!0}),D.current=null,F.current=!1)}},[R.current]),U.createElement("section",{ref:e,"aria-label":`${x} ${L}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},A.map((z,$)=>{var H;let[G,Y]=z.split("-");return w.length?U.createElement("ol",{key:z,dir:g==="auto"?YF():g,tabIndex:-1,ref:R,className:o,"data-sonner-toaster":!0,"data-theme":V,"data-y-position":G,"data-lifted":I&&w.length>1&&!n,"data-x-position":Y,style:{"--front-toast-height":`${((H=C[0])==null?void 0:H.height)||0}px`,"--width":`${zne}px`,"--gap":`${_}px`,...f,...Wne(l,c)},onBlur:W=>{F.current&&!W.currentTarget.contains(W.relatedTarget)&&(F.current=!1,D.current&&(D.current.focus({preventScroll:!0}),D.current=null))},onFocus:W=>{W.target instanceof HTMLElement&&W.target.dataset.dismissible==="false"||F.current||(F.current=!0,D.current=W.relatedTarget)},onMouseEnter:()=>M(!0),onMouseMove:()=>M(!0),onMouseLeave:()=>{N||M(!1)},onDragEnd:()=>M(!1),onPointerDown:W=>{W.target instanceof HTMLElement&&W.target.dataset.dismissible==="false"||k(!0)},onPointerUp:()=>k(!1)},w.filter(W=>!W.position&&$===0||W.position===z).map((W,ie)=>{var q,K;return U.createElement(Gne,{key:W.id,icons:y,index:ie,toast:W,defaultRichColors:h,duration:(q=m==null?void 0:m.duration)!=null?q:d,className:m==null?void 0:m.className,descriptionClassName:m==null?void 0:m.descriptionClassName,invert:t,visibleToasts:p,closeButton:(K=m==null?void 0:m.closeButton)!=null?K:a,interacting:N,position:z,style:m==null?void 0:m.style,unstyled:m==null?void 0:m.unstyled,classNames:m==null?void 0:m.classNames,cancelButtonStyle:m==null?void 0:m.cancelButtonStyle,actionButtonStyle:m==null?void 0:m.actionButtonStyle,removeToast:j,toasts:w.filter(te=>te.position==W.position),heights:C.filter(te=>te.position==W.position),setHeights:P,expandByDefault:n,gap:_,loadingIcon:v,expanded:I,pauseWhenPageIsHidden:S,swipeDirections:r.swipeDirections})})):null}))});const qne=({...r})=>{const{theme:e="system"}=y8();return b.jsx(Xne,{theme:e,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...r})};var Yne=zD[" useId ".trim().toString()]||(()=>{}),Kne=0;function Fo(r){const[e,t]=E.useState(Yne());return ar(()=>{t(i=>i??String(Kne++))},[r]),e?`radix-${e}`:""}const Zne=["top","right","bottom","left"],yc=Math.min,ys=Math.max,Xx=Math.round,b0=Math.floor,La=r=>({x:r,y:r}),Qne={left:"right",right:"left",bottom:"top",top:"bottom"},Jne={start:"end",end:"start"};function VI(r,e,t){return ys(r,yc(e,t))}function Ko(r,e){return typeof r=="function"?r(e):r}function Zo(r){return r.split("-")[0]}function nm(r){return r.split("-")[1]}function zL(r){return r==="x"?"y":"x"}function VL(r){return r==="y"?"height":"width"}const eae=new Set(["top","bottom"]);function Pa(r){return eae.has(Zo(r))?"y":"x"}function jL(r){return zL(Pa(r))}function tae(r,e,t){t===void 0&&(t=!1);const i=nm(r),s=jL(r),n=VL(s);let a=s==="x"?i===(t?"end":"start")?"right":"left":i==="start"?"bottom":"top";return e.reference[n]>e.floating[n]&&(a=qx(a)),[a,qx(a)]}function iae(r){const e=qx(r);return[jI(r),e,jI(e)]}function jI(r){return r.replace(/start|end/g,e=>Jne[e])}const KF=["left","right"],ZF=["right","left"],rae=["top","bottom"],sae=["bottom","top"];function nae(r,e,t){switch(r){case"top":case"bottom":return t?e?ZF:KF:e?KF:ZF;case"left":case"right":return e?rae:sae;default:return[]}}function aae(r,e,t,i){const s=nm(r);let n=nae(Zo(r),t==="start",i);return s&&(n=n.map(a=>a+"-"+s),e&&(n=n.concat(n.map(jI)))),n}function qx(r){return r.replace(/left|right|bottom|top/g,e=>Qne[e])}function oae(r){return{top:0,right:0,bottom:0,left:0,...r}}function S8(r){return typeof r!="number"?oae(r):{top:r,right:r,bottom:r,left:r}}function Yx(r){const{x:e,y:t,width:i,height:s}=r;return{width:i,height:s,top:t,left:e,right:e+i,bottom:t+s,x:e,y:t}}function QF(r,e,t){let{reference:i,floating:s}=r;const n=Pa(e),a=jL(e),o=VL(a),l=Zo(e),c=n==="y",u=i.x+i.width/2-s.width/2,h=i.y+i.height/2-s.height/2,d=i[o]/2-s[o]/2;let f;switch(l){case"top":f={x:u,y:i.y-s.height};break;case"bottom":f={x:u,y:i.y+i.height};break;case"right":f={x:i.x+i.width,y:h};break;case"left":f={x:i.x-s.width,y:h};break;default:f={x:i.x,y:i.y}}switch(nm(e)){case"start":f[a]-=d*(t&&c?-1:1);break;case"end":f[a]+=d*(t&&c?-1:1);break}return f}const lae=async(r,e,t)=>{const{placement:i="bottom",strategy:s="absolute",middleware:n=[],platform:a}=t,o=n.filter(Boolean),l=await(a.isRTL==null?void 0:a.isRTL(e));let c=await a.getElementRects({reference:r,floating:e,strategy:s}),{x:u,y:h}=QF(c,i,l),d=i,f={},p=0;for(let m=0;m<o.length;m++){const{name:g,fn:_}=o[m],{x:v,y,data:x,reset:S}=await _({x:u,y:h,initialPlacement:i,placement:d,strategy:s,middlewareData:f,rects:c,platform:a,elements:{reference:r,floating:e}});u=v??u,h=y??h,f={...f,[g]:{...f[g],...x}},S&&p<=50&&(p++,typeof S=="object"&&(S.placement&&(d=S.placement),S.rects&&(c=S.rects===!0?await a.getElementRects({reference:r,floating:e,strategy:s}):S.rects),{x:u,y:h}=QF(c,d,l)),m=-1)}return{x:u,y:h,placement:d,strategy:s,middlewareData:f}};async function U_(r,e){var t;e===void 0&&(e={});const{x:i,y:s,platform:n,rects:a,elements:o,strategy:l}=r,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:h="floating",altBoundary:d=!1,padding:f=0}=Ko(e,r),p=S8(f),g=o[d?h==="floating"?"reference":"floating":h],_=Yx(await n.getClippingRect({element:(t=await(n.isElement==null?void 0:n.isElement(g)))==null||t?g:g.contextElement||await(n.getDocumentElement==null?void 0:n.getDocumentElement(o.floating)),boundary:c,rootBoundary:u,strategy:l})),v=h==="floating"?{x:i,y:s,width:a.floating.width,height:a.floating.height}:a.reference,y=await(n.getOffsetParent==null?void 0:n.getOffsetParent(o.floating)),x=await(n.isElement==null?void 0:n.isElement(y))?await(n.getScale==null?void 0:n.getScale(y))||{x:1,y:1}:{x:1,y:1},S=Yx(n.convertOffsetParentRelativeRectToViewportRelativeRect?await n.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:v,offsetParent:y,strategy:l}):v);return{top:(_.top-S.top+p.top)/x.y,bottom:(S.bottom-_.bottom+p.bottom)/x.y,left:(_.left-S.left+p.left)/x.x,right:(S.right-_.right+p.right)/x.x}}const cae=r=>({name:"arrow",options:r,async fn(e){const{x:t,y:i,placement:s,rects:n,platform:a,elements:o,middlewareData:l}=e,{element:c,padding:u=0}=Ko(r,e)||{};if(c==null)return{};const h=S8(u),d={x:t,y:i},f=jL(s),p=VL(f),m=await a.getDimensions(c),g=f==="y",_=g?"top":"left",v=g?"bottom":"right",y=g?"clientHeight":"clientWidth",x=n.reference[p]+n.reference[f]-d[f]-n.floating[p],S=d[f]-n.reference[f],w=await(a.getOffsetParent==null?void 0:a.getOffsetParent(c));let T=w?w[y]:0;(!T||!await(a.isElement==null?void 0:a.isElement(w)))&&(T=o.floating[y]||n.floating[p]);const A=x/2-S/2,C=T/2-m[p]/2-1,P=yc(h[_],C),I=yc(h[v],C),M=P,N=T-m[p]-I,k=T/2-m[p]/2+A,V=VI(M,k,N),B=!l.arrow&&nm(s)!=null&&k!==V&&n.reference[p]/2-(k<M?P:I)-m[p]/2<0,R=B?k<M?k-M:k-N:0;return{[f]:d[f]+R,data:{[f]:V,centerOffset:k-V-R,...B&&{alignmentOffset:R}},reset:B}}}),uae=function(r){return r===void 0&&(r={}),{name:"flip",options:r,async fn(e){var t,i;const{placement:s,middlewareData:n,rects:a,initialPlacement:o,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:h=!0,fallbackPlacements:d,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:m=!0,...g}=Ko(r,e);if((t=n.arrow)!=null&&t.alignmentOffset)return{};const _=Zo(s),v=Pa(o),y=Zo(o)===o,x=await(l.isRTL==null?void 0:l.isRTL(c.floating)),S=d||(y||!m?[qx(o)]:iae(o)),w=p!=="none";!d&&w&&S.push(...aae(o,m,p,x));const T=[o,...S],A=await U_(e,g),C=[];let P=((i=n.flip)==null?void 0:i.overflows)||[];if(u&&C.push(A[_]),h){const k=tae(s,a,x);C.push(A[k[0]],A[k[1]])}if(P=[...P,{placement:s,overflows:C}],!C.every(k=>k<=0)){var I,M;const k=(((I=n.flip)==null?void 0:I.index)||0)+1,V=T[k];if(V&&(!(h==="alignment"?v!==Pa(V):!1)||P.every(L=>L.overflows[0]>0&&Pa(L.placement)===v)))return{data:{index:k,overflows:P},reset:{placement:V}};let B=(M=P.filter(R=>R.overflows[0]<=0).sort((R,L)=>R.overflows[1]-L.overflows[1])[0])==null?void 0:M.placement;if(!B)switch(f){case"bestFit":{var N;const R=(N=P.filter(L=>{if(w){const D=Pa(L.placement);return D===v||D==="y"}return!0}).map(L=>[L.placement,L.overflows.filter(D=>D>0).reduce((D,F)=>D+F,0)]).sort((L,D)=>L[1]-D[1])[0])==null?void 0:N[0];R&&(B=R);break}case"initialPlacement":B=o;break}if(s!==B)return{reset:{placement:B}}}return{}}}};function JF(r,e){return{top:r.top-e.height,right:r.right-e.width,bottom:r.bottom-e.height,left:r.left-e.width}}function eB(r){return Zne.some(e=>r[e]>=0)}const hae=function(r){return r===void 0&&(r={}),{name:"hide",options:r,async fn(e){const{rects:t}=e,{strategy:i="referenceHidden",...s}=Ko(r,e);switch(i){case"referenceHidden":{const n=await U_(e,{...s,elementContext:"reference"}),a=JF(n,t.reference);return{data:{referenceHiddenOffsets:a,referenceHidden:eB(a)}}}case"escaped":{const n=await U_(e,{...s,altBoundary:!0}),a=JF(n,t.floating);return{data:{escapedOffsets:a,escaped:eB(a)}}}default:return{}}}}},x8=new Set(["left","top"]);async function dae(r,e){const{placement:t,platform:i,elements:s}=r,n=await(i.isRTL==null?void 0:i.isRTL(s.floating)),a=Zo(t),o=nm(t),l=Pa(t)==="y",c=x8.has(a)?-1:1,u=n&&l?-1:1,h=Ko(e,r);let{mainAxis:d,crossAxis:f,alignmentAxis:p}=typeof h=="number"?{mainAxis:h,crossAxis:0,alignmentAxis:null}:{mainAxis:h.mainAxis||0,crossAxis:h.crossAxis||0,alignmentAxis:h.alignmentAxis};return o&&typeof p=="number"&&(f=o==="end"?p*-1:p),l?{x:f*u,y:d*c}:{x:d*c,y:f*u}}const fae=function(r){return r===void 0&&(r=0),{name:"offset",options:r,async fn(e){var t,i;const{x:s,y:n,placement:a,middlewareData:o}=e,l=await dae(e,r);return a===((t=o.offset)==null?void 0:t.placement)&&(i=o.arrow)!=null&&i.alignmentOffset?{}:{x:s+l.x,y:n+l.y,data:{...l,placement:a}}}}},pae=function(r){return r===void 0&&(r={}),{name:"shift",options:r,async fn(e){const{x:t,y:i,placement:s}=e,{mainAxis:n=!0,crossAxis:a=!1,limiter:o={fn:g=>{let{x:_,y:v}=g;return{x:_,y:v}}},...l}=Ko(r,e),c={x:t,y:i},u=await U_(e,l),h=Pa(Zo(s)),d=zL(h);let f=c[d],p=c[h];if(n){const g=d==="y"?"top":"left",_=d==="y"?"bottom":"right",v=f+u[g],y=f-u[_];f=VI(v,f,y)}if(a){const g=h==="y"?"top":"left",_=h==="y"?"bottom":"right",v=p+u[g],y=p-u[_];p=VI(v,p,y)}const m=o.fn({...e,[d]:f,[h]:p});return{...m,data:{x:m.x-t,y:m.y-i,enabled:{[d]:n,[h]:a}}}}}},mae=function(r){return r===void 0&&(r={}),{options:r,fn(e){const{x:t,y:i,placement:s,rects:n,middlewareData:a}=e,{offset:o=0,mainAxis:l=!0,crossAxis:c=!0}=Ko(r,e),u={x:t,y:i},h=Pa(s),d=zL(h);let f=u[d],p=u[h];const m=Ko(o,e),g=typeof m=="number"?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(l){const y=d==="y"?"height":"width",x=n.reference[d]-n.floating[y]+g.mainAxis,S=n.reference[d]+n.reference[y]-g.mainAxis;f<x?f=x:f>S&&(f=S)}if(c){var _,v;const y=d==="y"?"width":"height",x=x8.has(Zo(s)),S=n.reference[h]-n.floating[y]+(x&&((_=a.offset)==null?void 0:_[h])||0)+(x?0:g.crossAxis),w=n.reference[h]+n.reference[y]+(x?0:((v=a.offset)==null?void 0:v[h])||0)-(x?g.crossAxis:0);p<S?p=S:p>w&&(p=w)}return{[d]:f,[h]:p}}}},gae=function(r){return r===void 0&&(r={}),{name:"size",options:r,async fn(e){var t,i;const{placement:s,rects:n,platform:a,elements:o}=e,{apply:l=()=>{},...c}=Ko(r,e),u=await U_(e,c),h=Zo(s),d=nm(s),f=Pa(s)==="y",{width:p,height:m}=n.floating;let g,_;h==="top"||h==="bottom"?(g=h,_=d===(await(a.isRTL==null?void 0:a.isRTL(o.floating))?"start":"end")?"left":"right"):(_=h,g=d==="end"?"top":"bottom");const v=m-u.top-u.bottom,y=p-u.left-u.right,x=yc(m-u[g],v),S=yc(p-u[_],y),w=!e.middlewareData.shift;let T=x,A=S;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(A=y),(i=e.middlewareData.shift)!=null&&i.enabled.y&&(T=v),w&&!d){const P=ys(u.left,0),I=ys(u.right,0),M=ys(u.top,0),N=ys(u.bottom,0);f?A=p-2*(P!==0||I!==0?P+I:ys(u.left,u.right)):T=m-2*(M!==0||N!==0?M+N:ys(u.top,u.bottom))}await l({...e,availableWidth:A,availableHeight:T});const C=await a.getDimensions(o.floating);return p!==C.width||m!==C.height?{reset:{rects:!0}}:{}}}};function BT(){return typeof window<"u"}function am(r){return b8(r)?(r.nodeName||"").toLowerCase():"#document"}function Ts(r){var e;return(r==null||(e=r.ownerDocument)==null?void 0:e.defaultView)||window}function Wa(r){var e;return(e=(b8(r)?r.ownerDocument:r.document)||window.document)==null?void 0:e.documentElement}function b8(r){return BT()?r instanceof Node||r instanceof Ts(r).Node:!1}function qn(r){return BT()?r instanceof Element||r instanceof Ts(r).Element:!1}function Fa(r){return BT()?r instanceof HTMLElement||r instanceof Ts(r).HTMLElement:!1}function tB(r){return!BT()||typeof ShadowRoot>"u"?!1:r instanceof ShadowRoot||r instanceof Ts(r).ShadowRoot}const _ae=new Set(["inline","contents"]);function oy(r){const{overflow:e,overflowX:t,overflowY:i,display:s}=Yn(r);return/auto|scroll|overlay|hidden|clip/.test(e+i+t)&&!_ae.has(s)}const vae=new Set(["table","td","th"]);function yae(r){return vae.has(am(r))}const Sae=[":popover-open",":modal"];function UT(r){return Sae.some(e=>{try{return r.matches(e)}catch{return!1}})}const xae=["transform","translate","scale","rotate","perspective"],bae=["transform","translate","scale","rotate","perspective","filter"],wae=["paint","layout","strict","content"];function $L(r){const e=HL(),t=qn(r)?Yn(r):r;return xae.some(i=>t[i]?t[i]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||bae.some(i=>(t.willChange||"").includes(i))||wae.some(i=>(t.contain||"").includes(i))}function Tae(r){let e=Sc(r);for(;Fa(e)&&!rp(e);){if($L(e))return e;if(UT(e))return null;e=Sc(e)}return null}function HL(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Eae=new Set(["html","body","#document"]);function rp(r){return Eae.has(am(r))}function Yn(r){return Ts(r).getComputedStyle(r)}function zT(r){return qn(r)?{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}:{scrollLeft:r.scrollX,scrollTop:r.scrollY}}function Sc(r){if(am(r)==="html")return r;const e=r.assignedSlot||r.parentNode||tB(r)&&r.host||Wa(r);return tB(e)?e.host:e}function w8(r){const e=Sc(r);return rp(e)?r.ownerDocument?r.ownerDocument.body:r.body:Fa(e)&&oy(e)?e:w8(e)}function z_(r,e,t){var i;e===void 0&&(e=[]),t===void 0&&(t=!0);const s=w8(r),n=s===((i=r.ownerDocument)==null?void 0:i.body),a=Ts(s);if(n){const o=$I(a);return e.concat(a,a.visualViewport||[],oy(s)?s:[],o&&t?z_(o):[])}return e.concat(s,z_(s,[],t))}function $I(r){return r.parent&&Object.getPrototypeOf(r.parent)?r.frameElement:null}function T8(r){const e=Yn(r);let t=parseFloat(e.width)||0,i=parseFloat(e.height)||0;const s=Fa(r),n=s?r.offsetWidth:t,a=s?r.offsetHeight:i,o=Xx(t)!==n||Xx(i)!==a;return o&&(t=n,i=a),{width:t,height:i,$:o}}function GL(r){return qn(r)?r:r.contextElement}function Tf(r){const e=GL(r);if(!Fa(e))return La(1);const t=e.getBoundingClientRect(),{width:i,height:s,$:n}=T8(e);let a=(n?Xx(t.width):t.width)/i,o=(n?Xx(t.height):t.height)/s;return(!a||!Number.isFinite(a))&&(a=1),(!o||!Number.isFinite(o))&&(o=1),{x:a,y:o}}const Aae=La(0);function E8(r){const e=Ts(r);return!HL()||!e.visualViewport?Aae:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Cae(r,e,t){return e===void 0&&(e=!1),!t||e&&t!==Ts(r)?!1:e}function sh(r,e,t,i){e===void 0&&(e=!1),t===void 0&&(t=!1);const s=r.getBoundingClientRect(),n=GL(r);let a=La(1);e&&(i?qn(i)&&(a=Tf(i)):a=Tf(r));const o=Cae(n,t,i)?E8(n):La(0);let l=(s.left+o.x)/a.x,c=(s.top+o.y)/a.y,u=s.width/a.x,h=s.height/a.y;if(n){const d=Ts(n),f=i&&qn(i)?Ts(i):i;let p=d,m=$I(p);for(;m&&i&&f!==p;){const g=Tf(m),_=m.getBoundingClientRect(),v=Yn(m),y=_.left+(m.clientLeft+parseFloat(v.paddingLeft))*g.x,x=_.top+(m.clientTop+parseFloat(v.paddingTop))*g.y;l*=g.x,c*=g.y,u*=g.x,h*=g.y,l+=y,c+=x,p=Ts(m),m=$I(p)}}return Yx({width:u,height:h,x:l,y:c})}function WL(r,e){const t=zT(r).scrollLeft;return e?e.left+t:sh(Wa(r)).left+t}function A8(r,e,t){t===void 0&&(t=!1);const i=r.getBoundingClientRect(),s=i.left+e.scrollLeft-(t?0:WL(r,i)),n=i.top+e.scrollTop;return{x:s,y:n}}function Pae(r){let{elements:e,rect:t,offsetParent:i,strategy:s}=r;const n=s==="fixed",a=Wa(i),o=e?UT(e.floating):!1;if(i===a||o&&n)return t;let l={scrollLeft:0,scrollTop:0},c=La(1);const u=La(0),h=Fa(i);if((h||!h&&!n)&&((am(i)!=="body"||oy(a))&&(l=zT(i)),Fa(i))){const f=sh(i);c=Tf(i),u.x=f.x+i.clientLeft,u.y=f.y+i.clientTop}const d=a&&!h&&!n?A8(a,l,!0):La(0);return{width:t.width*c.x,height:t.height*c.y,x:t.x*c.x-l.scrollLeft*c.x+u.x+d.x,y:t.y*c.y-l.scrollTop*c.y+u.y+d.y}}function Iae(r){return Array.from(r.getClientRects())}function Mae(r){const e=Wa(r),t=zT(r),i=r.ownerDocument.body,s=ys(e.scrollWidth,e.clientWidth,i.scrollWidth,i.clientWidth),n=ys(e.scrollHeight,e.clientHeight,i.scrollHeight,i.clientHeight);let a=-t.scrollLeft+WL(r);const o=-t.scrollTop;return Yn(i).direction==="rtl"&&(a+=ys(e.clientWidth,i.clientWidth)-s),{width:s,height:n,x:a,y:o}}function Rae(r,e){const t=Ts(r),i=Wa(r),s=t.visualViewport;let n=i.clientWidth,a=i.clientHeight,o=0,l=0;if(s){n=s.width,a=s.height;const c=HL();(!c||c&&e==="fixed")&&(o=s.offsetLeft,l=s.offsetTop)}return{width:n,height:a,x:o,y:l}}const Dae=new Set(["absolute","fixed"]);function Lae(r,e){const t=sh(r,!0,e==="fixed"),i=t.top+r.clientTop,s=t.left+r.clientLeft,n=Fa(r)?Tf(r):La(1),a=r.clientWidth*n.x,o=r.clientHeight*n.y,l=s*n.x,c=i*n.y;return{width:a,height:o,x:l,y:c}}function iB(r,e,t){let i;if(e==="viewport")i=Rae(r,t);else if(e==="document")i=Mae(Wa(r));else if(qn(e))i=Lae(e,t);else{const s=E8(r);i={x:e.x-s.x,y:e.y-s.y,width:e.width,height:e.height}}return Yx(i)}function C8(r,e){const t=Sc(r);return t===e||!qn(t)||rp(t)?!1:Yn(t).position==="fixed"||C8(t,e)}function Oae(r,e){const t=e.get(r);if(t)return t;let i=z_(r,[],!1).filter(o=>qn(o)&&am(o)!=="body"),s=null;const n=Yn(r).position==="fixed";let a=n?Sc(r):r;for(;qn(a)&&!rp(a);){const o=Yn(a),l=$L(a);!l&&o.position==="fixed"&&(s=null),(n?!l&&!s:!l&&o.position==="static"&&!!s&&Dae.has(s.position)||oy(a)&&!l&&C8(r,a))?i=i.filter(u=>u!==a):s=o,a=Sc(a)}return e.set(r,i),i}function Nae(r){let{element:e,boundary:t,rootBoundary:i,strategy:s}=r;const a=[...t==="clippingAncestors"?UT(e)?[]:Oae(e,this._c):[].concat(t),i],o=a[0],l=a.reduce((c,u)=>{const h=iB(e,u,s);return c.top=ys(h.top,c.top),c.right=yc(h.right,c.right),c.bottom=yc(h.bottom,c.bottom),c.left=ys(h.left,c.left),c},iB(e,o,s));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function kae(r){const{width:e,height:t}=T8(r);return{width:e,height:t}}function Fae(r,e,t){const i=Fa(e),s=Wa(e),n=t==="fixed",a=sh(r,!0,n,e);let o={scrollLeft:0,scrollTop:0};const l=La(0);function c(){l.x=WL(s)}if(i||!i&&!n)if((am(e)!=="body"||oy(s))&&(o=zT(e)),i){const f=sh(e,!0,n,e);l.x=f.x+e.clientLeft,l.y=f.y+e.clientTop}else s&&c();n&&!i&&s&&c();const u=s&&!i&&!n?A8(s,o):La(0),h=a.left+o.scrollLeft-l.x-u.x,d=a.top+o.scrollTop-l.y-u.y;return{x:h,y:d,width:a.width,height:a.height}}function z1(r){return Yn(r).position==="static"}function rB(r,e){if(!Fa(r)||Yn(r).position==="fixed")return null;if(e)return e(r);let t=r.offsetParent;return Wa(r)===t&&(t=t.ownerDocument.body),t}function P8(r,e){const t=Ts(r);if(UT(r))return t;if(!Fa(r)){let s=Sc(r);for(;s&&!rp(s);){if(qn(s)&&!z1(s))return s;s=Sc(s)}return t}let i=rB(r,e);for(;i&&yae(i)&&z1(i);)i=rB(i,e);return i&&rp(i)&&z1(i)&&!$L(i)?t:i||Tae(r)||t}const Bae=async function(r){const e=this.getOffsetParent||P8,t=this.getDimensions,i=await t(r.floating);return{reference:Fae(r.reference,await e(r.floating),r.strategy),floating:{x:0,y:0,width:i.width,height:i.height}}};function Uae(r){return Yn(r).direction==="rtl"}const zae={convertOffsetParentRelativeRectToViewportRelativeRect:Pae,getDocumentElement:Wa,getClippingRect:Nae,getOffsetParent:P8,getElementRects:Bae,getClientRects:Iae,getDimensions:kae,getScale:Tf,isElement:qn,isRTL:Uae};function I8(r,e){return r.x===e.x&&r.y===e.y&&r.width===e.width&&r.height===e.height}function Vae(r,e){let t=null,i;const s=Wa(r);function n(){var o;clearTimeout(i),(o=t)==null||o.disconnect(),t=null}function a(o,l){o===void 0&&(o=!1),l===void 0&&(l=1),n();const c=r.getBoundingClientRect(),{left:u,top:h,width:d,height:f}=c;if(o||e(),!d||!f)return;const p=b0(h),m=b0(s.clientWidth-(u+d)),g=b0(s.clientHeight-(h+f)),_=b0(u),y={rootMargin:-p+"px "+-m+"px "+-g+"px "+-_+"px",threshold:ys(0,yc(1,l))||1};let x=!0;function S(w){const T=w[0].intersectionRatio;if(T!==l){if(!x)return a();T?a(!1,T):i=setTimeout(()=>{a(!1,1e-7)},1e3)}T===1&&!I8(c,r.getBoundingClientRect())&&a(),x=!1}try{t=new IntersectionObserver(S,{...y,root:s.ownerDocument})}catch{t=new IntersectionObserver(S,y)}t.observe(r)}return a(!0),n}function jae(r,e,t,i){i===void 0&&(i={});const{ancestorScroll:s=!0,ancestorResize:n=!0,elementResize:a=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:l=!1}=i,c=GL(r),u=s||n?[...c?z_(c):[],...z_(e)]:[];u.forEach(_=>{s&&_.addEventListener("scroll",t,{passive:!0}),n&&_.addEventListener("resize",t)});const h=c&&o?Vae(c,t):null;let d=-1,f=null;a&&(f=new ResizeObserver(_=>{let[v]=_;v&&v.target===c&&f&&(f.unobserve(e),cancelAnimationFrame(d),d=requestAnimationFrame(()=>{var y;(y=f)==null||y.observe(e)})),t()}),c&&!l&&f.observe(c),f.observe(e));let p,m=l?sh(r):null;l&&g();function g(){const _=sh(r);m&&!I8(m,_)&&t(),m=_,p=requestAnimationFrame(g)}return t(),()=>{var _;u.forEach(v=>{s&&v.removeEventListener("scroll",t),n&&v.removeEventListener("resize",t)}),h==null||h(),(_=f)==null||_.disconnect(),f=null,l&&cancelAnimationFrame(p)}}const $ae=fae,Hae=pae,Gae=uae,Wae=gae,Xae=hae,sB=cae,qae=mae,Yae=(r,e,t)=>{const i=new Map,s={platform:zae,...t},n={...s.platform,_c:i};return lae(r,e,{...s,platform:n})};var Kae=typeof document<"u",Zae=function(){},JS=Kae?E.useLayoutEffect:Zae;function Kx(r,e){if(r===e)return!0;if(typeof r!=typeof e)return!1;if(typeof r=="function"&&r.toString()===e.toString())return!0;let t,i,s;if(r&&e&&typeof r=="object"){if(Array.isArray(r)){if(t=r.length,t!==e.length)return!1;for(i=t;i--!==0;)if(!Kx(r[i],e[i]))return!1;return!0}if(s=Object.keys(r),t=s.length,t!==Object.keys(e).length)return!1;for(i=t;i--!==0;)if(!{}.hasOwnProperty.call(e,s[i]))return!1;for(i=t;i--!==0;){const n=s[i];if(!(n==="_owner"&&r.$$typeof)&&!Kx(r[n],e[n]))return!1}return!0}return r!==r&&e!==e}function M8(r){return typeof window>"u"?1:(r.ownerDocument.defaultView||window).devicePixelRatio||1}function nB(r,e){const t=M8(r);return Math.round(e*t)/t}function V1(r){const e=E.useRef(r);return JS(()=>{e.current=r}),e}function Qae(r){r===void 0&&(r={});const{placement:e="bottom",strategy:t="absolute",middleware:i=[],platform:s,elements:{reference:n,floating:a}={},transform:o=!0,whileElementsMounted:l,open:c}=r,[u,h]=E.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[d,f]=E.useState(i);Kx(d,i)||f(i);const[p,m]=E.useState(null),[g,_]=E.useState(null),v=E.useCallback(L=>{L!==w.current&&(w.current=L,m(L))},[]),y=E.useCallback(L=>{L!==T.current&&(T.current=L,_(L))},[]),x=n||p,S=a||g,w=E.useRef(null),T=E.useRef(null),A=E.useRef(u),C=l!=null,P=V1(l),I=V1(s),M=V1(c),N=E.useCallback(()=>{if(!w.current||!T.current)return;const L={placement:e,strategy:t,middleware:d};I.current&&(L.platform=I.current),Yae(w.current,T.current,L).then(D=>{const F={...D,isPositioned:M.current!==!1};k.current&&!Kx(A.current,F)&&(A.current=F,tn.flushSync(()=>{h(F)}))})},[d,e,t,I,M]);JS(()=>{c===!1&&A.current.isPositioned&&(A.current.isPositioned=!1,h(L=>({...L,isPositioned:!1})))},[c]);const k=E.useRef(!1);JS(()=>(k.current=!0,()=>{k.current=!1}),[]),JS(()=>{if(x&&(w.current=x),S&&(T.current=S),x&&S){if(P.current)return P.current(x,S,N);N()}},[x,S,N,P,C]);const V=E.useMemo(()=>({reference:w,floating:T,setReference:v,setFloating:y}),[v,y]),B=E.useMemo(()=>({reference:x,floating:S}),[x,S]),R=E.useMemo(()=>{const L={position:t,left:0,top:0};if(!B.floating)return L;const D=nB(B.floating,u.x),F=nB(B.floating,u.y);return o?{...L,transform:"translate("+D+"px, "+F+"px)",...M8(B.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:D,top:F}},[t,o,B.floating,u.x,u.y]);return E.useMemo(()=>({...u,update:N,refs:V,elements:B,floatingStyles:R}),[u,N,V,B,R])}const Jae=r=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:r,fn(t){const{element:i,padding:s}=typeof r=="function"?r(t):r;return i&&e(i)?i.current!=null?sB({element:i.current,padding:s}).fn(t):{}:i?sB({element:i,padding:s}).fn(t):{}}}},eoe=(r,e)=>({...$ae(r),options:[r,e]}),toe=(r,e)=>({...Hae(r),options:[r,e]}),ioe=(r,e)=>({...qae(r),options:[r,e]}),roe=(r,e)=>({...Gae(r),options:[r,e]}),soe=(r,e)=>({...Wae(r),options:[r,e]}),noe=(r,e)=>({...Xae(r),options:[r,e]}),aoe=(r,e)=>({...Jae(r),options:[r,e]});var ooe="Arrow",R8=E.forwardRef((r,e)=>{const{children:t,width:i=10,height:s=5,...n}=r;return b.jsx(Ee.svg,{...n,ref:e,width:i,height:s,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:r.asChild?t:b.jsx("polygon",{points:"0,0 30,0 15,10"})})});R8.displayName=ooe;var loe=R8;function D8(r){const[e,t]=E.useState(void 0);return ar(()=>{if(r){t({width:r.offsetWidth,height:r.offsetHeight});const i=new ResizeObserver(s=>{if(!Array.isArray(s)||!s.length)return;const n=s[0];let a,o;if("borderBoxSize"in n){const l=n.borderBoxSize,c=Array.isArray(l)?l[0]:l;a=c.inlineSize,o=c.blockSize}else a=r.offsetWidth,o=r.offsetHeight;t({width:a,height:o})});return i.observe(r,{box:"border-box"}),()=>i.unobserve(r)}else t(void 0)},[r]),e}var XL="Popper",[L8,om]=Ga(XL),[coe,O8]=L8(XL),N8=r=>{const{__scopePopper:e,children:t}=r,[i,s]=E.useState(null);return b.jsx(coe,{scope:e,anchor:i,onAnchorChange:s,children:t})};N8.displayName=XL;var k8="PopperAnchor",F8=E.forwardRef((r,e)=>{const{__scopePopper:t,virtualRef:i,...s}=r,n=O8(k8,t),a=E.useRef(null),o=Ze(e,a);return E.useEffect(()=>{n.onAnchorChange((i==null?void 0:i.current)||a.current)}),i?null:b.jsx(Ee.div,{...s,ref:o})});F8.displayName=k8;var qL="PopperContent",[uoe,hoe]=L8(qL),B8=E.forwardRef((r,e)=>{var W,ie,q,K,te,X;const{__scopePopper:t,side:i="bottom",sideOffset:s=0,align:n="center",alignOffset:a=0,arrowPadding:o=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:h="partial",hideWhenDetached:d=!1,updatePositionStrategy:f="optimized",onPlaced:p,...m}=r,g=O8(qL,t),[_,v]=E.useState(null),y=Ze(e,_e=>v(_e)),[x,S]=E.useState(null),w=D8(x),T=(w==null?void 0:w.width)??0,A=(w==null?void 0:w.height)??0,C=i+(n!=="center"?"-"+n:""),P=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},I=Array.isArray(c)?c:[c],M=I.length>0,N={padding:P,boundary:I.filter(foe),altBoundary:M},{refs:k,floatingStyles:V,placement:B,isPositioned:R,middlewareData:L}=Qae({strategy:"fixed",placement:C,whileElementsMounted:(..._e)=>jae(..._e,{animationFrame:f==="always"}),elements:{reference:g.anchor},middleware:[eoe({mainAxis:s+A,alignmentAxis:a}),l&&toe({mainAxis:!0,crossAxis:!1,limiter:h==="partial"?ioe():void 0,...N}),l&&roe({...N}),soe({...N,apply:({elements:_e,rects:pe,availableWidth:ze,availableHeight:Fe})=>{const{width:vt,height:ne}=pe.reference,vi=_e.floating.style;vi.setProperty("--radix-popper-available-width",`${ze}px`),vi.setProperty("--radix-popper-available-height",`${Fe}px`),vi.setProperty("--radix-popper-anchor-width",`${vt}px`),vi.setProperty("--radix-popper-anchor-height",`${ne}px`)}}),x&&aoe({element:x,padding:o}),poe({arrowWidth:T,arrowHeight:A}),d&&noe({strategy:"referenceHidden",...N})]}),[D,F]=V8(B),j=is(p);ar(()=>{R&&(j==null||j())},[R,j]);const z=(W=L.arrow)==null?void 0:W.x,$=(ie=L.arrow)==null?void 0:ie.y,H=((q=L.arrow)==null?void 0:q.centerOffset)!==0,[G,Y]=E.useState();return ar(()=>{_&&Y(window.getComputedStyle(_).zIndex)},[_]),b.jsx("div",{ref:k.setFloating,"data-radix-popper-content-wrapper":"",style:{...V,transform:R?V.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:G,"--radix-popper-transform-origin":[(K=L.transformOrigin)==null?void 0:K.x,(te=L.transformOrigin)==null?void 0:te.y].join(" "),...((X=L.hide)==null?void 0:X.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:r.dir,children:b.jsx(uoe,{scope:t,placedSide:D,onArrowChange:S,arrowX:z,arrowY:$,shouldHideArrow:H,children:b.jsx(Ee.div,{"data-side":D,"data-align":F,...m,ref:y,style:{...m.style,animation:R?void 0:"none"}})})})});B8.displayName=qL;var U8="PopperArrow",doe={top:"bottom",right:"left",bottom:"top",left:"right"},z8=E.forwardRef(function(e,t){const{__scopePopper:i,...s}=e,n=hoe(U8,i),a=doe[n.placedSide];return b.jsx("span",{ref:n.onArrowChange,style:{position:"absolute",left:n.arrowX,top:n.arrowY,[a]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[n.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[n.placedSide],visibility:n.shouldHideArrow?"hidden":void 0},children:b.jsx(loe,{...s,ref:t,style:{...s.style,display:"block"}})})});z8.displayName=U8;function foe(r){return r!==null}var poe=r=>({name:"transformOrigin",options:r,fn(e){var g,_,v;const{placement:t,rects:i,middlewareData:s}=e,a=((g=s.arrow)==null?void 0:g.centerOffset)!==0,o=a?0:r.arrowWidth,l=a?0:r.arrowHeight,[c,u]=V8(t),h={start:"0%",center:"50%",end:"100%"}[u],d=(((_=s.arrow)==null?void 0:_.x)??0)+o/2,f=(((v=s.arrow)==null?void 0:v.y)??0)+l/2;let p="",m="";return c==="bottom"?(p=a?h:`${d}px`,m=`${-l}px`):c==="top"?(p=a?h:`${d}px`,m=`${i.floating.height+l}px`):c==="right"?(p=`${-l}px`,m=a?h:`${f}px`):c==="left"&&(p=`${i.floating.width+l}px`,m=a?h:`${f}px`),{data:{x:p,y:m}}}});function V8(r){const[e,t="center"]=r.split("-");return[e,t]}var j8=N8,YL=F8,KL=B8,ZL=z8,[VT,Sit]=Ga("Tooltip",[om]),QL=om(),$8="TooltipProvider",moe=700,aB="tooltip.open",[goe,H8]=VT($8),G8=r=>{const{__scopeTooltip:e,delayDuration:t=moe,skipDelayDuration:i=300,disableHoverableContent:s=!1,children:n}=r,a=E.useRef(!0),o=E.useRef(!1),l=E.useRef(0);return E.useEffect(()=>{const c=l.current;return()=>window.clearTimeout(c)},[]),b.jsx(goe,{scope:e,isOpenDelayedRef:a,delayDuration:t,onOpen:E.useCallback(()=>{window.clearTimeout(l.current),a.current=!1},[]),onClose:E.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>a.current=!0,i)},[i]),isPointerInTransitRef:o,onPointerInTransitChange:E.useCallback(c=>{o.current=c},[]),disableHoverableContent:s,children:n})};G8.displayName=$8;var W8="Tooltip",[xit,jT]=VT(W8),HI="TooltipTrigger",_oe=E.forwardRef((r,e)=>{const{__scopeTooltip:t,...i}=r,s=jT(HI,t),n=H8(HI,t),a=QL(t),o=E.useRef(null),l=Ze(e,o,s.onTriggerChange),c=E.useRef(!1),u=E.useRef(!1),h=E.useCallback(()=>c.current=!1,[]);return E.useEffect(()=>()=>document.removeEventListener("pointerup",h),[h]),b.jsx(YL,{asChild:!0,...a,children:b.jsx(Ee.button,{"aria-describedby":s.open?s.contentId:void 0,"data-state":s.stateAttribute,...i,ref:l,onPointerMove:le(r.onPointerMove,d=>{d.pointerType!=="touch"&&!u.current&&!n.isPointerInTransitRef.current&&(s.onTriggerEnter(),u.current=!0)}),onPointerLeave:le(r.onPointerLeave,()=>{s.onTriggerLeave(),u.current=!1}),onPointerDown:le(r.onPointerDown,()=>{s.open&&s.onClose(),c.current=!0,document.addEventListener("pointerup",h,{once:!0})}),onFocus:le(r.onFocus,()=>{c.current||s.onOpen()}),onBlur:le(r.onBlur,s.onClose),onClick:le(r.onClick,s.onClose)})})});_oe.displayName=HI;var voe="TooltipPortal",[bit,yoe]=VT(voe,{forceMount:void 0}),sp="TooltipContent",X8=E.forwardRef((r,e)=>{const t=yoe(sp,r.__scopeTooltip),{forceMount:i=t.forceMount,side:s="top",...n}=r,a=jT(sp,r.__scopeTooltip);return b.jsx(Jn,{present:i||a.open,children:a.disableHoverableContent?b.jsx(q8,{side:s,...n,ref:e}):b.jsx(Soe,{side:s,...n,ref:e})})}),Soe=E.forwardRef((r,e)=>{const t=jT(sp,r.__scopeTooltip),i=H8(sp,r.__scopeTooltip),s=E.useRef(null),n=Ze(e,s),[a,o]=E.useState(null),{trigger:l,onClose:c}=t,u=s.current,{onPointerInTransitChange:h}=i,d=E.useCallback(()=>{o(null),h(!1)},[h]),f=E.useCallback((p,m)=>{const g=p.currentTarget,_={x:p.clientX,y:p.clientY},v=Eoe(_,g.getBoundingClientRect()),y=Aoe(_,v),x=Coe(m.getBoundingClientRect()),S=Ioe([...y,...x]);o(S),h(!0)},[h]);return E.useEffect(()=>()=>d(),[d]),E.useEffect(()=>{if(l&&u){const p=g=>f(g,u),m=g=>f(g,l);return l.addEventListener("pointerleave",p),u.addEventListener("pointerleave",m),()=>{l.removeEventListener("pointerleave",p),u.removeEventListener("pointerleave",m)}}},[l,u,f,d]),E.useEffect(()=>{if(a){const p=m=>{const g=m.target,_={x:m.clientX,y:m.clientY},v=(l==null?void 0:l.contains(g))||(u==null?void 0:u.contains(g)),y=!Poe(_,a);v?d():y&&(d(),c())};return document.addEventListener("pointermove",p),()=>document.removeEventListener("pointermove",p)}},[l,u,a,c,d]),b.jsx(q8,{...r,ref:n})}),[xoe,boe]=VT(W8,{isInside:!1}),woe=vre("TooltipContent"),q8=E.forwardRef((r,e)=>{const{__scopeTooltip:t,children:i,"aria-label":s,onEscapeKeyDown:n,onPointerDownOutside:a,...o}=r,l=jT(sp,t),c=QL(t),{onClose:u}=l;return E.useEffect(()=>(document.addEventListener(aB,u),()=>document.removeEventListener(aB,u)),[u]),E.useEffect(()=>{if(l.trigger){const h=d=>{const f=d.target;f!=null&&f.contains(l.trigger)&&u()};return window.addEventListener("scroll",h,{capture:!0}),()=>window.removeEventListener("scroll",h,{capture:!0})}},[l.trigger,u]),b.jsx(rm,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:n,onPointerDownOutside:a,onFocusOutside:h=>h.preventDefault(),onDismiss:u,children:b.jsxs(KL,{"data-state":l.stateAttribute,...c,...o,ref:e,style:{...o.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[b.jsx(woe,{children:i}),b.jsx(xoe,{scope:t,isInside:!0,children:b.jsx(zre,{id:l.contentId,role:"tooltip",children:s||i})})]})})});X8.displayName=sp;var Y8="TooltipArrow",Toe=E.forwardRef((r,e)=>{const{__scopeTooltip:t,...i}=r,s=QL(t);return boe(Y8,t).isInside?null:b.jsx(ZL,{...s,...i,ref:e})});Toe.displayName=Y8;function Eoe(r,e){const t=Math.abs(e.top-r.y),i=Math.abs(e.bottom-r.y),s=Math.abs(e.right-r.x),n=Math.abs(e.left-r.x);switch(Math.min(t,i,s,n)){case n:return"left";case s:return"right";case t:return"top";case i:return"bottom";default:throw new Error("unreachable")}}function Aoe(r,e,t=5){const i=[];switch(e){case"top":i.push({x:r.x-t,y:r.y+t},{x:r.x+t,y:r.y+t});break;case"bottom":i.push({x:r.x-t,y:r.y-t},{x:r.x+t,y:r.y-t});break;case"left":i.push({x:r.x+t,y:r.y-t},{x:r.x+t,y:r.y+t});break;case"right":i.push({x:r.x-t,y:r.y-t},{x:r.x-t,y:r.y+t});break}return i}function Coe(r){const{top:e,right:t,bottom:i,left:s}=r;return[{x:s,y:e},{x:t,y:e},{x:t,y:i},{x:s,y:i}]}function Poe(r,e){const{x:t,y:i}=r;let s=!1;for(let n=0,a=e.length-1;n<e.length;a=n++){const o=e[n],l=e[a],c=o.x,u=o.y,h=l.x,d=l.y;u>i!=d>i&&t<(h-c)*(i-u)/(d-u)+c&&(s=!s)}return s}function Ioe(r){const e=r.slice();return e.sort((t,i)=>t.x<i.x?-1:t.x>i.x?1:t.y<i.y?-1:t.y>i.y?1:0),Moe(e)}function Moe(r){if(r.length<=1)return r.slice();const e=[];for(let i=0;i<r.length;i++){const s=r[i];for(;e.length>=2;){const n=e[e.length-1],a=e[e.length-2];if((n.x-a.x)*(s.y-a.y)>=(n.y-a.y)*(s.x-a.x))e.pop();else break}e.push(s)}e.pop();const t=[];for(let i=r.length-1;i>=0;i--){const s=r[i];for(;t.length>=2;){const n=t[t.length-1],a=t[t.length-2];if((n.x-a.x)*(s.y-a.y)>=(n.y-a.y)*(s.x-a.x))t.pop();else break}t.push(s)}return t.pop(),e.length===1&&t.length===1&&e[0].x===t[0].x&&e[0].y===t[0].y?e:e.concat(t)}var Roe=G8,K8=X8;const Doe=Roe,Loe=E.forwardRef(({className:r,sideOffset:e=4,...t},i)=>b.jsx(K8,{ref:i,sideOffset:e,className:ye("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...t}));Loe.displayName=K8.displayName;var $T=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(r){return this.listeners.add(r),this.onSubscribe(),()=>{this.listeners.delete(r),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},HT=typeof window>"u"||"Deno"in globalThis;function In(){}function Ooe(r,e){return typeof r=="function"?r(e):r}function Noe(r){return typeof r=="number"&&r>=0&&r!==1/0}function koe(r,e){return Math.max(r+(e||0)-Date.now(),0)}function GI(r,e){return typeof r=="function"?r(e):r}function Foe(r,e){return typeof r=="function"?r(e):r}function oB(r,e){const{type:t="all",exact:i,fetchStatus:s,predicate:n,queryKey:a,stale:o}=r;if(a){if(i){if(e.queryHash!==JL(a,e.options))return!1}else if(!j_(e.queryKey,a))return!1}if(t!=="all"){const l=e.isActive();if(t==="active"&&!l||t==="inactive"&&l)return!1}return!(typeof o=="boolean"&&e.isStale()!==o||s&&s!==e.state.fetchStatus||n&&!n(e))}function lB(r,e){const{exact:t,status:i,predicate:s,mutationKey:n}=r;if(n){if(!e.options.mutationKey)return!1;if(t){if(V_(e.options.mutationKey)!==V_(n))return!1}else if(!j_(e.options.mutationKey,n))return!1}return!(i&&e.state.status!==i||s&&!s(e))}function JL(r,e){return((e==null?void 0:e.queryKeyHashFn)||V_)(r)}function V_(r){return JSON.stringify(r,(e,t)=>WI(t)?Object.keys(t).sort().reduce((i,s)=>(i[s]=t[s],i),{}):t)}function j_(r,e){return r===e?!0:typeof r!=typeof e?!1:r&&e&&typeof r=="object"&&typeof e=="object"?Object.keys(e).every(t=>j_(r[t],e[t])):!1}function Z8(r,e){if(r===e)return r;const t=cB(r)&&cB(e);if(t||WI(r)&&WI(e)){const i=t?r:Object.keys(r),s=i.length,n=t?e:Object.keys(e),a=n.length,o=t?[]:{},l=new Set(i);let c=0;for(let u=0;u<a;u++){const h=t?u:n[u];(!t&&l.has(h)||t)&&r[h]===void 0&&e[h]===void 0?(o[h]=void 0,c++):(o[h]=Z8(r[h],e[h]),o[h]===r[h]&&r[h]!==void 0&&c++)}return s===a&&c===s?r:o}return e}function cB(r){return Array.isArray(r)&&r.length===Object.keys(r).length}function WI(r){if(!uB(r))return!1;const e=r.constructor;if(e===void 0)return!0;const t=e.prototype;return!(!uB(t)||!t.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(r)!==Object.prototype)}function uB(r){return Object.prototype.toString.call(r)==="[object Object]"}function Boe(r){return new Promise(e=>{setTimeout(e,r)})}function Uoe(r,e,t){return typeof t.structuralSharing=="function"?t.structuralSharing(r,e):t.structuralSharing!==!1?Z8(r,e):e}function zoe(r,e,t=0){const i=[...r,e];return t&&i.length>t?i.slice(1):i}function Voe(r,e,t=0){const i=[e,...r];return t&&i.length>t?i.slice(0,-1):i}var eO=Symbol();function Q8(r,e){return!r.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!r.queryFn||r.queryFn===eO?()=>Promise.reject(new Error(`Missing queryFn: '${r.queryHash}'`)):r.queryFn}var Ru,Xl,Vf,pH,joe=(pH=class extends $T{constructor(){super();Qe(this,Ru);Qe(this,Xl);Qe(this,Vf);Ie(this,Vf,e=>{if(!HT&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}})}onSubscribe(){J(this,Xl)||this.setEventListener(J(this,Vf))}onUnsubscribe(){var e;this.hasListeners()||((e=J(this,Xl))==null||e.call(this),Ie(this,Xl,void 0))}setEventListener(e){var t;Ie(this,Vf,e),(t=J(this,Xl))==null||t.call(this),Ie(this,Xl,e(i=>{typeof i=="boolean"?this.setFocused(i):this.onFocus()}))}setFocused(e){J(this,Ru)!==e&&(Ie(this,Ru,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){var e;return typeof J(this,Ru)=="boolean"?J(this,Ru):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},Ru=new WeakMap,Xl=new WeakMap,Vf=new WeakMap,pH),J8=new joe,jf,ql,$f,mH,$oe=(mH=class extends $T{constructor(){super();Qe(this,jf,!0);Qe(this,ql);Qe(this,$f);Ie(this,$f,e=>{if(!HT&&window.addEventListener){const t=()=>e(!0),i=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",i,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",i)}}})}onSubscribe(){J(this,ql)||this.setEventListener(J(this,$f))}onUnsubscribe(){var e;this.hasListeners()||((e=J(this,ql))==null||e.call(this),Ie(this,ql,void 0))}setEventListener(e){var t;Ie(this,$f,e),(t=J(this,ql))==null||t.call(this),Ie(this,ql,e(this.setOnline.bind(this)))}setOnline(e){J(this,jf)!==e&&(Ie(this,jf,e),this.listeners.forEach(i=>{i(e)}))}isOnline(){return J(this,jf)}},jf=new WeakMap,ql=new WeakMap,$f=new WeakMap,mH),Zx=new $oe;function Hoe(){let r,e;const t=new Promise((s,n)=>{r=s,e=n});t.status="pending",t.catch(()=>{});function i(s){Object.assign(t,s),delete t.resolve,delete t.reject}return t.resolve=s=>{i({status:"fulfilled",value:s}),r(s)},t.reject=s=>{i({status:"rejected",reason:s}),e(s)},t}function Goe(r){return Math.min(1e3*2**r,3e4)}function e6(r){return(r??"online")==="online"?Zx.isOnline():!0}var t6=class extends Error{constructor(r){super("CancelledError"),this.revert=r==null?void 0:r.revert,this.silent=r==null?void 0:r.silent}};function j1(r){return r instanceof t6}function i6(r){let e=!1,t=0,i=!1,s;const n=Hoe(),a=m=>{var g;i||(d(new t6(m)),(g=r.abort)==null||g.call(r))},o=()=>{e=!0},l=()=>{e=!1},c=()=>J8.isFocused()&&(r.networkMode==="always"||Zx.isOnline())&&r.canRun(),u=()=>e6(r.networkMode)&&r.canRun(),h=m=>{var g;i||(i=!0,(g=r.onSuccess)==null||g.call(r,m),s==null||s(),n.resolve(m))},d=m=>{var g;i||(i=!0,(g=r.onError)==null||g.call(r,m),s==null||s(),n.reject(m))},f=()=>new Promise(m=>{var g;s=_=>{(i||c())&&m(_)},(g=r.onPause)==null||g.call(r)}).then(()=>{var m;s=void 0,i||(m=r.onContinue)==null||m.call(r)}),p=()=>{if(i)return;let m;const g=t===0?r.initialPromise:void 0;try{m=g??r.fn()}catch(_){m=Promise.reject(_)}Promise.resolve(m).then(h).catch(_=>{var w;if(i)return;const v=r.retry??(HT?0:3),y=r.retryDelay??Goe,x=typeof y=="function"?y(t,_):y,S=v===!0||typeof v=="number"&&t<v||typeof v=="function"&&v(t,_);if(e||!S){d(_);return}t++,(w=r.onFail)==null||w.call(r,t,_),Boe(x).then(()=>c()?void 0:f()).then(()=>{e?d(_):p()})})};return{promise:n,cancel:a,continue:()=>(s==null||s(),n),cancelRetry:o,continueRetry:l,canStart:u,start:()=>(u()?p():f().then(p),n)}}var Woe=r=>setTimeout(r,0);function Xoe(){let r=[],e=0,t=o=>{o()},i=o=>{o()},s=Woe;const n=o=>{e?r.push(o):s(()=>{t(o)})},a=()=>{const o=r;r=[],o.length&&s(()=>{i(()=>{o.forEach(l=>{t(l)})})})};return{batch:o=>{let l;e++;try{l=o()}finally{e--,e||a()}return l},batchCalls:o=>(...l)=>{n(()=>{o(...l)})},schedule:n,setNotifyFunction:o=>{t=o},setBatchNotifyFunction:o=>{i=o},setScheduler:o=>{s=o}}}var Rr=Xoe(),Du,gH,r6=(gH=class{constructor(){Qe(this,Du)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Noe(this.gcTime)&&Ie(this,Du,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(r){this.gcTime=Math.max(this.gcTime||0,r??(HT?1/0:5*60*1e3))}clearGcTimeout(){J(this,Du)&&(clearTimeout(J(this,Du)),Ie(this,Du,void 0))}},Du=new WeakMap,gH),Hf,Lu,Xs,Ou,gr,Qv,Nu,Mn,mo,_H,qoe=(_H=class extends r6{constructor(e){super();Qe(this,Mn);Qe(this,Hf);Qe(this,Lu);Qe(this,Xs);Qe(this,Ou);Qe(this,gr);Qe(this,Qv);Qe(this,Nu);Ie(this,Nu,!1),Ie(this,Qv,e.defaultOptions),this.setOptions(e.options),this.observers=[],Ie(this,Ou,e.client),Ie(this,Xs,J(this,Ou).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,Ie(this,Hf,Koe(this.options)),this.state=e.state??J(this,Hf),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=J(this,gr))==null?void 0:e.promise}setOptions(e){this.options={...J(this,Qv),...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&J(this,Xs).remove(this)}setData(e,t){const i=Uoe(this.state.data,e,this.options);return ur(this,Mn,mo).call(this,{data:i,type:"success",dataUpdatedAt:t==null?void 0:t.updatedAt,manual:t==null?void 0:t.manual}),i}setState(e,t){ur(this,Mn,mo).call(this,{type:"setState",state:e,setStateOptions:t})}cancel(e){var i,s;const t=(i=J(this,gr))==null?void 0:i.promise;return(s=J(this,gr))==null||s.cancel(e),t?t.then(In).catch(In):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(J(this,Hf))}isActive(){return this.observers.some(e=>Foe(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===eO||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>GI(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!koe(this.state.dataUpdatedAt,e)}onFocus(){var t;const e=this.observers.find(i=>i.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(t=J(this,gr))==null||t.continue()}onOnline(){var t;const e=this.observers.find(i=>i.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(t=J(this,gr))==null||t.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),J(this,Xs).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(J(this,gr)&&(J(this,Nu)?J(this,gr).cancel({revert:!0}):J(this,gr).cancelRetry()),this.scheduleGc()),J(this,Xs).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||ur(this,Mn,mo).call(this,{type:"invalidate"})}fetch(e,t){var c,u,h;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(t!=null&&t.cancelRefetch))this.cancel({silent:!0});else if(J(this,gr))return J(this,gr).continueRetry(),J(this,gr).promise}if(e&&this.setOptions(e),!this.options.queryFn){const d=this.observers.find(f=>f.options.queryFn);d&&this.setOptions(d.options)}const i=new AbortController,s=d=>{Object.defineProperty(d,"signal",{enumerable:!0,get:()=>(Ie(this,Nu,!0),i.signal)})},n=()=>{const d=Q8(this.options,t),p=(()=>{const m={client:J(this,Ou),queryKey:this.queryKey,meta:this.meta};return s(m),m})();return Ie(this,Nu,!1),this.options.persister?this.options.persister(d,p,this):d(p)},o=(()=>{const d={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:J(this,Ou),state:this.state,fetchFn:n};return s(d),d})();(c=this.options.behavior)==null||c.onFetch(o,this),Ie(this,Lu,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((u=o.fetchOptions)==null?void 0:u.meta))&&ur(this,Mn,mo).call(this,{type:"fetch",meta:(h=o.fetchOptions)==null?void 0:h.meta});const l=d=>{var f,p,m,g;j1(d)&&d.silent||ur(this,Mn,mo).call(this,{type:"error",error:d}),j1(d)||((p=(f=J(this,Xs).config).onError)==null||p.call(f,d,this),(g=(m=J(this,Xs).config).onSettled)==null||g.call(m,this.state.data,d,this)),this.scheduleGc()};return Ie(this,gr,i6({initialPromise:t==null?void 0:t.initialPromise,fn:o.fetchFn,abort:i.abort.bind(i),onSuccess:d=>{var f,p,m,g;if(d===void 0){l(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(d)}catch(_){l(_);return}(p=(f=J(this,Xs).config).onSuccess)==null||p.call(f,d,this),(g=(m=J(this,Xs).config).onSettled)==null||g.call(m,d,this.state.error,this),this.scheduleGc()},onError:l,onFail:(d,f)=>{ur(this,Mn,mo).call(this,{type:"failed",failureCount:d,error:f})},onPause:()=>{ur(this,Mn,mo).call(this,{type:"pause"})},onContinue:()=>{ur(this,Mn,mo).call(this,{type:"continue"})},retry:o.options.retry,retryDelay:o.options.retryDelay,networkMode:o.options.networkMode,canRun:()=>!0})),J(this,gr).start()}},Hf=new WeakMap,Lu=new WeakMap,Xs=new WeakMap,Ou=new WeakMap,gr=new WeakMap,Qv=new WeakMap,Nu=new WeakMap,Mn=new WeakSet,mo=function(e){const t=i=>{switch(e.type){case"failed":return{...i,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...i,fetchStatus:"paused"};case"continue":return{...i,fetchStatus:"fetching"};case"fetch":return{...i,...Yoe(i.data,this.options),fetchMeta:e.meta??null};case"success":return Ie(this,Lu,void 0),{...i,data:e.data,dataUpdateCount:i.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const s=e.error;return j1(s)&&s.revert&&J(this,Lu)?{...J(this,Lu),fetchStatus:"idle"}:{...i,error:s,errorUpdateCount:i.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:i.fetchFailureCount+1,fetchFailureReason:s,fetchStatus:"idle",status:"error"};case"invalidate":return{...i,isInvalidated:!0};case"setState":return{...i,...e.state}}};this.state=t(this.state),Rr.batch(()=>{this.observers.forEach(i=>{i.onQueryUpdate()}),J(this,Xs).notify({query:this,type:"updated",action:e})})},_H);function Yoe(r,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:e6(e.networkMode)?"fetching":"paused",...r===void 0&&{error:null,status:"pending"}}}function Koe(r){const e=typeof r.initialData=="function"?r.initialData():r.initialData,t=e!==void 0,i=t?typeof r.initialDataUpdatedAt=="function"?r.initialDataUpdatedAt():r.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:t?i??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:t?"success":"pending",fetchStatus:"idle"}}var ya,vH,Zoe=(vH=class extends $T{constructor(e={}){super();Qe(this,ya);this.config=e,Ie(this,ya,new Map)}build(e,t,i){const s=t.queryKey,n=t.queryHash??JL(s,t);let a=this.get(n);return a||(a=new qoe({client:e,queryKey:s,queryHash:n,options:e.defaultQueryOptions(t),state:i,defaultOptions:e.getQueryDefaults(s)}),this.add(a)),a}add(e){J(this,ya).has(e.queryHash)||(J(this,ya).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=J(this,ya).get(e.queryHash);t&&(e.destroy(),t===e&&J(this,ya).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){Rr.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return J(this,ya).get(e)}getAll(){return[...J(this,ya).values()]}find(e){const t={exact:!0,...e};return this.getAll().find(i=>oB(t,i))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(i=>oB(e,i)):t}notify(e){Rr.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){Rr.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){Rr.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},ya=new WeakMap,vH),Sa,Ir,ku,xa,wl,yH,Qoe=(yH=class extends r6{constructor(e){super();Qe(this,xa);Qe(this,Sa);Qe(this,Ir);Qe(this,ku);this.mutationId=e.mutationId,Ie(this,Ir,e.mutationCache),Ie(this,Sa,[]),this.state=e.state||Joe(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){J(this,Sa).includes(e)||(J(this,Sa).push(e),this.clearGcTimeout(),J(this,Ir).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){Ie(this,Sa,J(this,Sa).filter(t=>t!==e)),this.scheduleGc(),J(this,Ir).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){J(this,Sa).length||(this.state.status==="pending"?this.scheduleGc():J(this,Ir).remove(this))}continue(){var e;return((e=J(this,ku))==null?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var n,a,o,l,c,u,h,d,f,p,m,g,_,v,y,x,S,w,T,A;const t=()=>{ur(this,xa,wl).call(this,{type:"continue"})};Ie(this,ku,i6({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(C,P)=>{ur(this,xa,wl).call(this,{type:"failed",failureCount:C,error:P})},onPause:()=>{ur(this,xa,wl).call(this,{type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>J(this,Ir).canRun(this)}));const i=this.state.status==="pending",s=!J(this,ku).canStart();try{if(i)t();else{ur(this,xa,wl).call(this,{type:"pending",variables:e,isPaused:s}),await((a=(n=J(this,Ir).config).onMutate)==null?void 0:a.call(n,e,this));const P=await((l=(o=this.options).onMutate)==null?void 0:l.call(o,e));P!==this.state.context&&ur(this,xa,wl).call(this,{type:"pending",context:P,variables:e,isPaused:s})}const C=await J(this,ku).start();return await((u=(c=J(this,Ir).config).onSuccess)==null?void 0:u.call(c,C,e,this.state.context,this)),await((d=(h=this.options).onSuccess)==null?void 0:d.call(h,C,e,this.state.context)),await((p=(f=J(this,Ir).config).onSettled)==null?void 0:p.call(f,C,null,this.state.variables,this.state.context,this)),await((g=(m=this.options).onSettled)==null?void 0:g.call(m,C,null,e,this.state.context)),ur(this,xa,wl).call(this,{type:"success",data:C}),C}catch(C){try{throw await((v=(_=J(this,Ir).config).onError)==null?void 0:v.call(_,C,e,this.state.context,this)),await((x=(y=this.options).onError)==null?void 0:x.call(y,C,e,this.state.context)),await((w=(S=J(this,Ir).config).onSettled)==null?void 0:w.call(S,void 0,C,this.state.variables,this.state.context,this)),await((A=(T=this.options).onSettled)==null?void 0:A.call(T,void 0,C,e,this.state.context)),C}finally{ur(this,xa,wl).call(this,{type:"error",error:C})}}finally{J(this,Ir).runNext(this)}}},Sa=new WeakMap,Ir=new WeakMap,ku=new WeakMap,xa=new WeakSet,wl=function(e){const t=i=>{switch(e.type){case"failed":return{...i,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...i,isPaused:!0};case"continue":return{...i,isPaused:!1};case"pending":return{...i,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...i,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...i,data:void 0,error:e.error,failureCount:i.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),Rr.batch(()=>{J(this,Sa).forEach(i=>{i.onMutationUpdate(e)}),J(this,Ir).notify({mutation:this,type:"updated",action:e})})},yH);function Joe(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Po,Rn,Jv,SH,ele=(SH=class extends $T{constructor(e={}){super();Qe(this,Po);Qe(this,Rn);Qe(this,Jv);this.config=e,Ie(this,Po,new Set),Ie(this,Rn,new Map),Ie(this,Jv,0)}build(e,t,i){const s=new Qoe({mutationCache:this,mutationId:++t0(this,Jv)._,options:e.defaultMutationOptions(t),state:i});return this.add(s),s}add(e){J(this,Po).add(e);const t=w0(e);if(typeof t=="string"){const i=J(this,Rn).get(t);i?i.push(e):J(this,Rn).set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(J(this,Po).delete(e)){const t=w0(e);if(typeof t=="string"){const i=J(this,Rn).get(t);if(i)if(i.length>1){const s=i.indexOf(e);s!==-1&&i.splice(s,1)}else i[0]===e&&J(this,Rn).delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=w0(e);if(typeof t=="string"){const i=J(this,Rn).get(t),s=i==null?void 0:i.find(n=>n.state.status==="pending");return!s||s===e}else return!0}runNext(e){var i;const t=w0(e);if(typeof t=="string"){const s=(i=J(this,Rn).get(t))==null?void 0:i.find(n=>n!==e&&n.state.isPaused);return(s==null?void 0:s.continue())??Promise.resolve()}else return Promise.resolve()}clear(){Rr.batch(()=>{J(this,Po).forEach(e=>{this.notify({type:"removed",mutation:e})}),J(this,Po).clear(),J(this,Rn).clear()})}getAll(){return Array.from(J(this,Po))}find(e){const t={exact:!0,...e};return this.getAll().find(i=>lB(t,i))}findAll(e={}){return this.getAll().filter(t=>lB(e,t))}notify(e){Rr.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return Rr.batch(()=>Promise.all(e.map(t=>t.continue().catch(In))))}},Po=new WeakMap,Rn=new WeakMap,Jv=new WeakMap,SH);function w0(r){var e;return(e=r.options.scope)==null?void 0:e.id}function hB(r){return{onFetch:(e,t)=>{var u,h,d,f,p;const i=e.options,s=(d=(h=(u=e.fetchOptions)==null?void 0:u.meta)==null?void 0:h.fetchMore)==null?void 0:d.direction,n=((f=e.state.data)==null?void 0:f.pages)||[],a=((p=e.state.data)==null?void 0:p.pageParams)||[];let o={pages:[],pageParams:[]},l=0;const c=async()=>{let m=!1;const g=y=>{Object.defineProperty(y,"signal",{enumerable:!0,get:()=>(e.signal.aborted?m=!0:e.signal.addEventListener("abort",()=>{m=!0}),e.signal)})},_=Q8(e.options,e.fetchOptions),v=async(y,x,S)=>{if(m)return Promise.reject();if(x==null&&y.pages.length)return Promise.resolve(y);const T=(()=>{const I={client:e.client,queryKey:e.queryKey,pageParam:x,direction:S?"backward":"forward",meta:e.options.meta};return g(I),I})(),A=await _(T),{maxPages:C}=e.options,P=S?Voe:zoe;return{pages:P(y.pages,A,C),pageParams:P(y.pageParams,x,C)}};if(s&&n.length){const y=s==="backward",x=y?tle:dB,S={pages:n,pageParams:a},w=x(i,S);o=await v(S,w,y)}else{const y=r??n.length;do{const x=l===0?a[0]??i.initialPageParam:dB(i,o);if(l>0&&x==null)break;o=await v(o,x),l++}while(l<y)}return o};e.options.persister?e.fetchFn=()=>{var m,g;return(g=(m=e.options).persister)==null?void 0:g.call(m,c,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},t)}:e.fetchFn=c}}}function dB(r,{pages:e,pageParams:t}){const i=e.length-1;return e.length>0?r.getNextPageParam(e[i],e,t[i],t):void 0}function tle(r,{pages:e,pageParams:t}){var i;return e.length>0?(i=r.getPreviousPageParam)==null?void 0:i.call(r,e[0],e,t[0],t):void 0}var ui,Yl,Kl,Gf,Wf,Zl,Xf,qf,xH,ile=(xH=class{constructor(r={}){Qe(this,ui);Qe(this,Yl);Qe(this,Kl);Qe(this,Gf);Qe(this,Wf);Qe(this,Zl);Qe(this,Xf);Qe(this,qf);Ie(this,ui,r.queryCache||new Zoe),Ie(this,Yl,r.mutationCache||new ele),Ie(this,Kl,r.defaultOptions||{}),Ie(this,Gf,new Map),Ie(this,Wf,new Map),Ie(this,Zl,0)}mount(){t0(this,Zl)._++,J(this,Zl)===1&&(Ie(this,Xf,J8.subscribe(async r=>{r&&(await this.resumePausedMutations(),J(this,ui).onFocus())})),Ie(this,qf,Zx.subscribe(async r=>{r&&(await this.resumePausedMutations(),J(this,ui).onOnline())})))}unmount(){var r,e;t0(this,Zl)._--,J(this,Zl)===0&&((r=J(this,Xf))==null||r.call(this),Ie(this,Xf,void 0),(e=J(this,qf))==null||e.call(this),Ie(this,qf,void 0))}isFetching(r){return J(this,ui).findAll({...r,fetchStatus:"fetching"}).length}isMutating(r){return J(this,Yl).findAll({...r,status:"pending"}).length}getQueryData(r){var t;const e=this.defaultQueryOptions({queryKey:r});return(t=J(this,ui).get(e.queryHash))==null?void 0:t.state.data}ensureQueryData(r){const e=this.defaultQueryOptions(r),t=J(this,ui).build(this,e),i=t.state.data;return i===void 0?this.fetchQuery(r):(r.revalidateIfStale&&t.isStaleByTime(GI(e.staleTime,t))&&this.prefetchQuery(e),Promise.resolve(i))}getQueriesData(r){return J(this,ui).findAll(r).map(({queryKey:e,state:t})=>{const i=t.data;return[e,i]})}setQueryData(r,e,t){const i=this.defaultQueryOptions({queryKey:r}),s=J(this,ui).get(i.queryHash),n=s==null?void 0:s.state.data,a=Ooe(e,n);if(a!==void 0)return J(this,ui).build(this,i).setData(a,{...t,manual:!0})}setQueriesData(r,e,t){return Rr.batch(()=>J(this,ui).findAll(r).map(({queryKey:i})=>[i,this.setQueryData(i,e,t)]))}getQueryState(r){var t;const e=this.defaultQueryOptions({queryKey:r});return(t=J(this,ui).get(e.queryHash))==null?void 0:t.state}removeQueries(r){const e=J(this,ui);Rr.batch(()=>{e.findAll(r).forEach(t=>{e.remove(t)})})}resetQueries(r,e){const t=J(this,ui);return Rr.batch(()=>(t.findAll(r).forEach(i=>{i.reset()}),this.refetchQueries({type:"active",...r},e)))}cancelQueries(r,e={}){const t={revert:!0,...e},i=Rr.batch(()=>J(this,ui).findAll(r).map(s=>s.cancel(t)));return Promise.all(i).then(In).catch(In)}invalidateQueries(r,e={}){return Rr.batch(()=>(J(this,ui).findAll(r).forEach(t=>{t.invalidate()}),(r==null?void 0:r.refetchType)==="none"?Promise.resolve():this.refetchQueries({...r,type:(r==null?void 0:r.refetchType)??(r==null?void 0:r.type)??"active"},e)))}refetchQueries(r,e={}){const t={...e,cancelRefetch:e.cancelRefetch??!0},i=Rr.batch(()=>J(this,ui).findAll(r).filter(s=>!s.isDisabled()&&!s.isStatic()).map(s=>{let n=s.fetch(void 0,t);return t.throwOnError||(n=n.catch(In)),s.state.fetchStatus==="paused"?Promise.resolve():n}));return Promise.all(i).then(In)}fetchQuery(r){const e=this.defaultQueryOptions(r);e.retry===void 0&&(e.retry=!1);const t=J(this,ui).build(this,e);return t.isStaleByTime(GI(e.staleTime,t))?t.fetch(e):Promise.resolve(t.state.data)}prefetchQuery(r){return this.fetchQuery(r).then(In).catch(In)}fetchInfiniteQuery(r){return r.behavior=hB(r.pages),this.fetchQuery(r)}prefetchInfiniteQuery(r){return this.fetchInfiniteQuery(r).then(In).catch(In)}ensureInfiniteQueryData(r){return r.behavior=hB(r.pages),this.ensureQueryData(r)}resumePausedMutations(){return Zx.isOnline()?J(this,Yl).resumePausedMutations():Promise.resolve()}getQueryCache(){return J(this,ui)}getMutationCache(){return J(this,Yl)}getDefaultOptions(){return J(this,Kl)}setDefaultOptions(r){Ie(this,Kl,r)}setQueryDefaults(r,e){J(this,Gf).set(V_(r),{queryKey:r,defaultOptions:e})}getQueryDefaults(r){const e=[...J(this,Gf).values()],t={};return e.forEach(i=>{j_(r,i.queryKey)&&Object.assign(t,i.defaultOptions)}),t}setMutationDefaults(r,e){J(this,Wf).set(V_(r),{mutationKey:r,defaultOptions:e})}getMutationDefaults(r){const e=[...J(this,Wf).values()],t={};return e.forEach(i=>{j_(r,i.mutationKey)&&Object.assign(t,i.defaultOptions)}),t}defaultQueryOptions(r){if(r._defaulted)return r;const e={...J(this,Kl).queries,...this.getQueryDefaults(r.queryKey),...r,_defaulted:!0};return e.queryHash||(e.queryHash=JL(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===eO&&(e.enabled=!1),e}defaultMutationOptions(r){return r!=null&&r._defaulted?r:{...J(this,Kl).mutations,...(r==null?void 0:r.mutationKey)&&this.getMutationDefaults(r.mutationKey),...r,_defaulted:!0}}clear(){J(this,ui).clear(),J(this,Yl).clear()}},ui=new WeakMap,Yl=new WeakMap,Kl=new WeakMap,Gf=new WeakMap,Wf=new WeakMap,Zl=new WeakMap,Xf=new WeakMap,qf=new WeakMap,xH),rle=E.createContext(void 0),sle=({client:r,children:e})=>(E.useEffect(()=>(r.mount(),()=>{r.unmount()}),[r]),b.jsx(rle.Provider,{value:r,children:e}));/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function $_(){return $_=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},$_.apply(this,arguments)}var ec;(function(r){r.Pop="POP",r.Push="PUSH",r.Replace="REPLACE"})(ec||(ec={}));const fB="popstate";function nle(r){r===void 0&&(r={});function e(i,s){let{pathname:n,search:a,hash:o}=i.location;return XI("",{pathname:n,search:a,hash:o},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(i,s){return typeof s=="string"?s:Qx(s)}return ole(e,t,null,r)}function Ti(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function s6(r,e){if(!r){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function ale(){return Math.random().toString(36).substr(2,8)}function pB(r,e){return{usr:r.state,key:r.key,idx:e}}function XI(r,e,t,i){return t===void 0&&(t=null),$_({pathname:typeof r=="string"?r:r.pathname,search:"",hash:""},typeof e=="string"?lm(e):e,{state:t,key:e&&e.key||i||ale()})}function Qx(r){let{pathname:e="/",search:t="",hash:i=""}=r;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function lm(r){let e={};if(r){let t=r.indexOf("#");t>=0&&(e.hash=r.substr(t),r=r.substr(0,t));let i=r.indexOf("?");i>=0&&(e.search=r.substr(i),r=r.substr(0,i)),r&&(e.pathname=r)}return e}function ole(r,e,t,i){i===void 0&&(i={});let{window:s=document.defaultView,v5Compat:n=!1}=i,a=s.history,o=ec.Pop,l=null,c=u();c==null&&(c=0,a.replaceState($_({},a.state,{idx:c}),""));function u(){return(a.state||{idx:null}).idx}function h(){o=ec.Pop;let g=u(),_=g==null?null:g-c;c=g,l&&l({action:o,location:m.location,delta:_})}function d(g,_){o=ec.Push;let v=XI(m.location,g,_);c=u()+1;let y=pB(v,c),x=m.createHref(v);try{a.pushState(y,"",x)}catch(S){if(S instanceof DOMException&&S.name==="DataCloneError")throw S;s.location.assign(x)}n&&l&&l({action:o,location:m.location,delta:1})}function f(g,_){o=ec.Replace;let v=XI(m.location,g,_);c=u();let y=pB(v,c),x=m.createHref(v);a.replaceState(y,"",x),n&&l&&l({action:o,location:m.location,delta:0})}function p(g){let _=s.location.origin!=="null"?s.location.origin:s.location.href,v=typeof g=="string"?g:Qx(g);return v=v.replace(/ $/,"%20"),Ti(_,"No window.location.(origin|href) available to create URL for href: "+v),new URL(v,_)}let m={get action(){return o},get location(){return r(s,a)},listen(g){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(fB,h),l=g,()=>{s.removeEventListener(fB,h),l=null}},createHref(g){return e(s,g)},createURL:p,encodeLocation(g){let _=p(g);return{pathname:_.pathname,search:_.search,hash:_.hash}},push:d,replace:f,go(g){return a.go(g)}};return m}var mB;(function(r){r.data="data",r.deferred="deferred",r.redirect="redirect",r.error="error"})(mB||(mB={}));function lle(r,e,t){return t===void 0&&(t="/"),cle(r,e,t)}function cle(r,e,t,i){let s=typeof e=="string"?lm(e):e,n=tO(s.pathname||"/",t);if(n==null)return null;let a=n6(r);ule(a);let o=null;for(let l=0;o==null&&l<a.length;++l){let c=ble(n);o=yle(a[l],c)}return o}function n6(r,e,t,i){e===void 0&&(e=[]),t===void 0&&(t=[]),i===void 0&&(i="");let s=(n,a,o)=>{let l={relativePath:o===void 0?n.path||"":o,caseSensitive:n.caseSensitive===!0,childrenIndex:a,route:n};l.relativePath.startsWith("/")&&(Ti(l.relativePath.startsWith(i),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+i+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(i.length));let c=hc([i,l.relativePath]),u=t.concat(l);n.children&&n.children.length>0&&(Ti(n.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),n6(n.children,e,u,c)),!(n.path==null&&!n.index)&&e.push({path:c,score:_le(c,n.index),routesMeta:u})};return r.forEach((n,a)=>{var o;if(n.path===""||!((o=n.path)!=null&&o.includes("?")))s(n,a);else for(let l of a6(n.path))s(n,a,l)}),e}function a6(r){let e=r.split("/");if(e.length===0)return[];let[t,...i]=e,s=t.endsWith("?"),n=t.replace(/\?$/,"");if(i.length===0)return s?[n,""]:[n];let a=a6(i.join("/")),o=[];return o.push(...a.map(l=>l===""?n:[n,l].join("/"))),s&&o.push(...a),o.map(l=>r.startsWith("/")&&l===""?"/":l)}function ule(r){r.sort((e,t)=>e.score!==t.score?t.score-e.score:vle(e.routesMeta.map(i=>i.childrenIndex),t.routesMeta.map(i=>i.childrenIndex)))}const hle=/^:[\w-]+$/,dle=3,fle=2,ple=1,mle=10,gle=-2,gB=r=>r==="*";function _le(r,e){let t=r.split("/"),i=t.length;return t.some(gB)&&(i+=gle),e&&(i+=fle),t.filter(s=>!gB(s)).reduce((s,n)=>s+(hle.test(n)?dle:n===""?ple:mle),i)}function vle(r,e){return r.length===e.length&&r.slice(0,-1).every((i,s)=>i===e[s])?r[r.length-1]-e[e.length-1]:0}function yle(r,e,t){let{routesMeta:i}=r,s={},n="/",a=[];for(let o=0;o<i.length;++o){let l=i[o],c=o===i.length-1,u=n==="/"?e:e.slice(n.length)||"/",h=Sle({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),d=l.route;if(!h)return null;Object.assign(s,h.params),a.push({params:s,pathname:hc([n,h.pathname]),pathnameBase:Ale(hc([n,h.pathnameBase])),route:d}),h.pathnameBase!=="/"&&(n=hc([n,h.pathnameBase]))}return a}function Sle(r,e){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[t,i]=xle(r.path,r.caseSensitive,r.end),s=e.match(t);if(!s)return null;let n=s[0],a=n.replace(/(.)\/+$/,"$1"),o=s.slice(1);return{params:i.reduce((c,u,h)=>{let{paramName:d,isOptional:f}=u;if(d==="*"){let m=o[h]||"";a=n.slice(0,n.length-m.length).replace(/(.)\/+$/,"$1")}const p=o[h];return f&&!p?c[d]=void 0:c[d]=(p||"").replace(/%2F/g,"/"),c},{}),pathname:n,pathnameBase:a,pattern:r}}function xle(r,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),s6(r==="*"||!r.endsWith("*")||r.endsWith("/*"),'Route path "'+r+'" will be treated as if it were '+('"'+r.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+r.replace(/\*$/,"/*")+'".'));let i=[],s="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,l)=>(i.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(i.push({paramName:"*"}),s+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":r!==""&&r!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),i]}function ble(r){try{return r.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return s6(!1,'The URL path "'+r+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),r}}function tO(r,e){if(e==="/")return r;if(!r.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,i=r.charAt(t);return i&&i!=="/"?null:r.slice(t)||"/"}function wle(r,e){e===void 0&&(e="/");let{pathname:t,search:i="",hash:s=""}=typeof r=="string"?lm(r):r;return{pathname:t?t.startsWith("/")?t:Tle(t,e):e,search:Cle(i),hash:Ple(s)}}function Tle(r,e){let t=e.replace(/\/+$/,"").split("/");return r.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function $1(r,e,t,i){return"Cannot include a '"+r+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(i)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Ele(r){return r.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function o6(r,e){let t=Ele(r);return e?t.map((i,s)=>s===t.length-1?i.pathname:i.pathnameBase):t.map(i=>i.pathnameBase)}function l6(r,e,t,i){i===void 0&&(i=!1);let s;typeof r=="string"?s=lm(r):(s=$_({},r),Ti(!s.pathname||!s.pathname.includes("?"),$1("?","pathname","search",s)),Ti(!s.pathname||!s.pathname.includes("#"),$1("#","pathname","hash",s)),Ti(!s.search||!s.search.includes("#"),$1("#","search","hash",s)));let n=r===""||s.pathname==="",a=n?"/":s.pathname,o;if(a==null)o=t;else{let h=e.length-1;if(!i&&a.startsWith("..")){let d=a.split("/");for(;d[0]==="..";)d.shift(),h-=1;s.pathname=d.join("/")}o=h>=0?e[h]:"/"}let l=wle(s,o),c=a&&a!=="/"&&a.endsWith("/"),u=(n||a===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}const hc=r=>r.join("/").replace(/\/\/+/g,"/"),Ale=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),Cle=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,Ple=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function Ile(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}const c6=["post","put","patch","delete"];new Set(c6);const Mle=["get",...c6];new Set(Mle);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function H_(){return H_=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},H_.apply(this,arguments)}const iO=E.createContext(null),Rle=E.createContext(null),Rh=E.createContext(null),GT=E.createContext(null),Pc=E.createContext({outlet:null,matches:[],isDataRoute:!1}),u6=E.createContext(null);function Dle(r,e){let{relative:t}=e===void 0?{}:e;ly()||Ti(!1);let{basename:i,navigator:s}=E.useContext(Rh),{hash:n,pathname:a,search:o}=f6(r,{relative:t}),l=a;return i!=="/"&&(l=a==="/"?i:hc([i,a])),s.createHref({pathname:l,search:o,hash:n})}function ly(){return E.useContext(GT)!=null}function cy(){return ly()||Ti(!1),E.useContext(GT).location}function h6(r){E.useContext(Rh).static||E.useLayoutEffect(r)}function d6(){let{isDataRoute:r}=E.useContext(Pc);return r?Wle():Lle()}function Lle(){ly()||Ti(!1);let r=E.useContext(iO),{basename:e,future:t,navigator:i}=E.useContext(Rh),{matches:s}=E.useContext(Pc),{pathname:n}=cy(),a=JSON.stringify(o6(s,t.v7_relativeSplatPath)),o=E.useRef(!1);return h6(()=>{o.current=!0}),E.useCallback(function(c,u){if(u===void 0&&(u={}),!o.current)return;if(typeof c=="number"){i.go(c);return}let h=l6(c,JSON.parse(a),n,u.relative==="path");r==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:hc([e,h.pathname])),(u.replace?i.replace:i.push)(h,u.state,u)},[e,i,a,n,r])}function Ole(){let{matches:r}=E.useContext(Pc),e=r[r.length-1];return e?e.params:{}}function f6(r,e){let{relative:t}=e===void 0?{}:e,{future:i}=E.useContext(Rh),{matches:s}=E.useContext(Pc),{pathname:n}=cy(),a=JSON.stringify(o6(s,i.v7_relativeSplatPath));return E.useMemo(()=>l6(r,JSON.parse(a),n,t==="path"),[r,a,n,t])}function Nle(r,e){return kle(r,e)}function kle(r,e,t,i){ly()||Ti(!1);let{navigator:s}=E.useContext(Rh),{matches:n}=E.useContext(Pc),a=n[n.length-1],o=a?a.params:{};a&&a.pathname;let l=a?a.pathnameBase:"/";a&&a.route;let c=cy(),u;if(e){var h;let g=typeof e=="string"?lm(e):e;l==="/"||(h=g.pathname)!=null&&h.startsWith(l)||Ti(!1),u=g}else u=c;let d=u.pathname||"/",f=d;if(l!=="/"){let g=l.replace(/^\//,"").split("/");f="/"+d.replace(/^\//,"").split("/").slice(g.length).join("/")}let p=lle(r,{pathname:f}),m=Vle(p&&p.map(g=>Object.assign({},g,{params:Object.assign({},o,g.params),pathname:hc([l,s.encodeLocation?s.encodeLocation(g.pathname).pathname:g.pathname]),pathnameBase:g.pathnameBase==="/"?l:hc([l,s.encodeLocation?s.encodeLocation(g.pathnameBase).pathname:g.pathnameBase])})),n,t,i);return e&&m?E.createElement(GT.Provider,{value:{location:H_({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:ec.Pop}},m):m}function Fle(){let r=Gle(),e=Ile(r)?r.status+" "+r.statusText:r instanceof Error?r.message:JSON.stringify(r),t=r instanceof Error?r.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return E.createElement(E.Fragment,null,E.createElement("h2",null,"Unexpected Application Error!"),E.createElement("h3",{style:{fontStyle:"italic"}},e),t?E.createElement("pre",{style:s},t):null,null)}const Ble=E.createElement(Fle,null);class Ule extends E.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?E.createElement(Pc.Provider,{value:this.props.routeContext},E.createElement(u6.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function zle(r){let{routeContext:e,match:t,children:i}=r,s=E.useContext(iO);return s&&s.static&&s.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=t.route.id),E.createElement(Pc.Provider,{value:e},i)}function Vle(r,e,t,i){var s;if(e===void 0&&(e=[]),t===void 0&&(t=null),i===void 0&&(i=null),r==null){var n;if(!t)return null;if(t.errors)r=t.matches;else if((n=i)!=null&&n.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)r=t.matches;else return null}let a=r,o=(s=t)==null?void 0:s.errors;if(o!=null){let u=a.findIndex(h=>h.route.id&&(o==null?void 0:o[h.route.id])!==void 0);u>=0||Ti(!1),a=a.slice(0,Math.min(a.length,u+1))}let l=!1,c=-1;if(t&&i&&i.v7_partialHydration)for(let u=0;u<a.length;u++){let h=a[u];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(c=u),h.route.id){let{loaderData:d,errors:f}=t,p=h.route.loader&&d[h.route.id]===void 0&&(!f||f[h.route.id]===void 0);if(h.route.lazy||p){l=!0,c>=0?a=a.slice(0,c+1):a=[a[0]];break}}}return a.reduceRight((u,h,d)=>{let f,p=!1,m=null,g=null;t&&(f=o&&h.route.id?o[h.route.id]:void 0,m=h.route.errorElement||Ble,l&&(c<0&&d===0?(Xle("route-fallback"),p=!0,g=null):c===d&&(p=!0,g=h.route.hydrateFallbackElement||null)));let _=e.concat(a.slice(0,d+1)),v=()=>{let y;return f?y=m:p?y=g:h.route.Component?y=E.createElement(h.route.Component,null):h.route.element?y=h.route.element:y=u,E.createElement(zle,{match:h,routeContext:{outlet:u,matches:_,isDataRoute:t!=null},children:y})};return t&&(h.route.ErrorBoundary||h.route.errorElement||d===0)?E.createElement(Ule,{location:t.location,revalidation:t.revalidation,component:m,error:f,children:v(),routeContext:{outlet:null,matches:_,isDataRoute:!0}}):v()},null)}var p6=function(r){return r.UseBlocker="useBlocker",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r}(p6||{}),m6=function(r){return r.UseBlocker="useBlocker",r.UseLoaderData="useLoaderData",r.UseActionData="useActionData",r.UseRouteError="useRouteError",r.UseNavigation="useNavigation",r.UseRouteLoaderData="useRouteLoaderData",r.UseMatches="useMatches",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r.UseRouteId="useRouteId",r}(m6||{});function jle(r){let e=E.useContext(iO);return e||Ti(!1),e}function $le(r){let e=E.useContext(Rle);return e||Ti(!1),e}function Hle(r){let e=E.useContext(Pc);return e||Ti(!1),e}function g6(r){let e=Hle(),t=e.matches[e.matches.length-1];return t.route.id||Ti(!1),t.route.id}function Gle(){var r;let e=E.useContext(u6),t=$le(),i=g6();return e!==void 0?e:(r=t.errors)==null?void 0:r[i]}function Wle(){let{router:r}=jle(p6.UseNavigateStable),e=g6(m6.UseNavigateStable),t=E.useRef(!1);return h6(()=>{t.current=!0}),E.useCallback(function(s,n){n===void 0&&(n={}),t.current&&(typeof s=="number"?r.navigate(s):r.navigate(s,H_({fromRouteId:e},n)))},[r,e])}const _B={};function Xle(r,e,t){_B[r]||(_B[r]=!0)}function qle(r,e){r==null||r.v7_startTransition,r==null||r.v7_relativeSplatPath}function Ag(r){Ti(!1)}function Yle(r){let{basename:e="/",children:t=null,location:i,navigationType:s=ec.Pop,navigator:n,static:a=!1,future:o}=r;ly()&&Ti(!1);let l=e.replace(/^\/*/,"/"),c=E.useMemo(()=>({basename:l,navigator:n,static:a,future:H_({v7_relativeSplatPath:!1},o)}),[l,o,n,a]);typeof i=="string"&&(i=lm(i));let{pathname:u="/",search:h="",hash:d="",state:f=null,key:p="default"}=i,m=E.useMemo(()=>{let g=tO(u,l);return g==null?null:{location:{pathname:g,search:h,hash:d,state:f,key:p},navigationType:s}},[l,u,h,d,f,p,s]);return m==null?null:E.createElement(Rh.Provider,{value:c},E.createElement(GT.Provider,{children:t,value:m}))}function Kle(r){let{children:e,location:t}=r;return Nle(qI(e),t)}new Promise(()=>{});function qI(r,e){e===void 0&&(e=[]);let t=[];return E.Children.forEach(r,(i,s)=>{if(!E.isValidElement(i))return;let n=[...e,s];if(i.type===E.Fragment){t.push.apply(t,qI(i.props.children,n));return}i.type!==Ag&&Ti(!1),!i.props.index||!i.props.children||Ti(!1);let a={id:i.props.id||n.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(a.children=qI(i.props.children,n)),t.push(a)}),t}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function YI(){return YI=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},YI.apply(this,arguments)}function Zle(r,e){if(r==null)return{};var t={},i=Object.keys(r),s,n;for(n=0;n<i.length;n++)s=i[n],!(e.indexOf(s)>=0)&&(t[s]=r[s]);return t}function Qle(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function Jle(r,e){return r.button===0&&(!e||e==="_self")&&!Qle(r)}const ece=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],tce="6";try{window.__reactRouterVersion=tce}catch{}const ice="startTransition",vB=zD[ice];function rce(r){let{basename:e,children:t,future:i,window:s}=r,n=E.useRef();n.current==null&&(n.current=nle({window:s,v5Compat:!0}));let a=n.current,[o,l]=E.useState({action:a.action,location:a.location}),{v7_startTransition:c}=i||{},u=E.useCallback(h=>{c&&vB?vB(()=>l(h)):l(h)},[l,c]);return E.useLayoutEffect(()=>a.listen(u),[a,u]),E.useEffect(()=>qle(i),[i]),E.createElement(Yle,{basename:e,children:t,location:o.location,navigationType:o.action,navigator:a,future:i})}const sce=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",nce=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ace=E.forwardRef(function(e,t){let{onClick:i,relative:s,reloadDocument:n,replace:a,state:o,target:l,to:c,preventScrollReset:u,viewTransition:h}=e,d=Zle(e,ece),{basename:f}=E.useContext(Rh),p,m=!1;if(typeof c=="string"&&nce.test(c)&&(p=c,sce))try{let y=new URL(window.location.href),x=c.startsWith("//")?new URL(y.protocol+c):new URL(c),S=tO(x.pathname,f);x.origin===y.origin&&S!=null?c=S+x.search+x.hash:m=!0}catch{}let g=Dle(c,{relative:s}),_=oce(c,{replace:a,state:o,target:l,preventScrollReset:u,relative:s,viewTransition:h});function v(y){i&&i(y),y.defaultPrevented||_(y)}return E.createElement("a",YI({},d,{href:p||g,onClick:m||n?i:v,ref:t,target:l}))});var yB;(function(r){r.UseScrollRestoration="useScrollRestoration",r.UseSubmit="useSubmit",r.UseSubmitFetcher="useSubmitFetcher",r.UseFetcher="useFetcher",r.useViewTransitionState="useViewTransitionState"})(yB||(yB={}));var SB;(function(r){r.UseFetcher="useFetcher",r.UseFetchers="useFetchers",r.UseScrollRestoration="useScrollRestoration"})(SB||(SB={}));function oce(r,e){let{target:t,replace:i,state:s,preventScrollReset:n,relative:a,viewTransition:o}=e===void 0?{}:e,l=d6(),c=cy(),u=f6(r,{relative:a});return E.useCallback(h=>{if(Jle(h,t)){h.preventDefault();let d=i!==void 0?i:Qx(c)===Qx(u);l(r,{replace:d,state:s,preventScrollReset:n,relative:a,viewTransition:o})}},[c,l,u,i,s,t,r,n,a,o])}var lce=E.createContext(void 0);function rO(r){const e=E.useContext(lce);return r||e||"ltr"}var H1=0;function sO(){E.useEffect(()=>{const r=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",r[0]??xB()),document.body.insertAdjacentElement("beforeend",r[1]??xB()),H1++,()=>{H1===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),H1--}},[])}function xB(){const r=document.createElement("span");return r.setAttribute("data-radix-focus-guard",""),r.tabIndex=0,r.style.outline="none",r.style.opacity="0",r.style.position="fixed",r.style.pointerEvents="none",r}var G1="focusScope.autoFocusOnMount",W1="focusScope.autoFocusOnUnmount",bB={bubbles:!1,cancelable:!0},cce="FocusScope",WT=E.forwardRef((r,e)=>{const{loop:t=!1,trapped:i=!1,onMountAutoFocus:s,onUnmountAutoFocus:n,...a}=r,[o,l]=E.useState(null),c=is(s),u=is(n),h=E.useRef(null),d=Ze(e,m=>l(m)),f=E.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;E.useEffect(()=>{if(i){let m=function(y){if(f.paused||!o)return;const x=y.target;o.contains(x)?h.current=x:Tl(h.current,{select:!0})},g=function(y){if(f.paused||!o)return;const x=y.relatedTarget;x!==null&&(o.contains(x)||Tl(h.current,{select:!0}))},_=function(y){if(document.activeElement===document.body)for(const S of y)S.removedNodes.length>0&&Tl(o)};document.addEventListener("focusin",m),document.addEventListener("focusout",g);const v=new MutationObserver(_);return o&&v.observe(o,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",m),document.removeEventListener("focusout",g),v.disconnect()}}},[i,o,f.paused]),E.useEffect(()=>{if(o){TB.add(f);const m=document.activeElement;if(!o.contains(m)){const _=new CustomEvent(G1,bB);o.addEventListener(G1,c),o.dispatchEvent(_),_.defaultPrevented||(uce(mce(_6(o)),{select:!0}),document.activeElement===m&&Tl(o))}return()=>{o.removeEventListener(G1,c),setTimeout(()=>{const _=new CustomEvent(W1,bB);o.addEventListener(W1,u),o.dispatchEvent(_),_.defaultPrevented||Tl(m??document.body,{select:!0}),o.removeEventListener(W1,u),TB.remove(f)},0)}}},[o,c,u,f]);const p=E.useCallback(m=>{if(!t&&!i||f.paused)return;const g=m.key==="Tab"&&!m.altKey&&!m.ctrlKey&&!m.metaKey,_=document.activeElement;if(g&&_){const v=m.currentTarget,[y,x]=hce(v);y&&x?!m.shiftKey&&_===x?(m.preventDefault(),t&&Tl(y,{select:!0})):m.shiftKey&&_===y&&(m.preventDefault(),t&&Tl(x,{select:!0})):_===v&&m.preventDefault()}},[t,i,f.paused]);return b.jsx(Ee.div,{tabIndex:-1,...a,ref:d,onKeyDown:p})});WT.displayName=cce;function uce(r,{select:e=!1}={}){const t=document.activeElement;for(const i of r)if(Tl(i,{select:e}),document.activeElement!==t)return}function hce(r){const e=_6(r),t=wB(e,r),i=wB(e.reverse(),r);return[t,i]}function _6(r){const e=[],t=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,{acceptNode:i=>{const s=i.tagName==="INPUT"&&i.type==="hidden";return i.disabled||i.hidden||s?NodeFilter.FILTER_SKIP:i.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function wB(r,e){for(const t of r)if(!dce(t,{upTo:e}))return t}function dce(r,{upTo:e}){if(getComputedStyle(r).visibility==="hidden")return!0;for(;r;){if(e!==void 0&&r===e)return!1;if(getComputedStyle(r).display==="none")return!0;r=r.parentElement}return!1}function fce(r){return r instanceof HTMLInputElement&&"select"in r}function Tl(r,{select:e=!1}={}){if(r&&r.focus){const t=document.activeElement;r.focus({preventScroll:!0}),r!==t&&fce(r)&&e&&r.select()}}var TB=pce();function pce(){let r=[];return{add(e){const t=r[0];e!==t&&(t==null||t.pause()),r=EB(r,e),r.unshift(e)},remove(e){var t;r=EB(r,e),(t=r[0])==null||t.resume()}}}function EB(r,e){const t=[...r],i=t.indexOf(e);return i!==-1&&t.splice(i,1),t}function mce(r){return r.filter(e=>e.tagName!=="A")}var X1="rovingFocusGroup.onEntryFocus",gce={bubbles:!1,cancelable:!0},uy="RovingFocusGroup",[KI,v6,_ce]=LT(uy),[vce,y6]=Ga(uy,[_ce]),[yce,Sce]=vce(uy),S6=E.forwardRef((r,e)=>b.jsx(KI.Provider,{scope:r.__scopeRovingFocusGroup,children:b.jsx(KI.Slot,{scope:r.__scopeRovingFocusGroup,children:b.jsx(xce,{...r,ref:e})})}));S6.displayName=uy;var xce=E.forwardRef((r,e)=>{const{__scopeRovingFocusGroup:t,orientation:i,loop:s=!1,dir:n,currentTabStopId:a,defaultCurrentTabStopId:o,onCurrentTabStopIdChange:l,onEntryFocus:c,preventScrollOnEntryFocus:u=!1,...h}=r,d=E.useRef(null),f=Ze(e,d),p=rO(n),[m,g]=rh({prop:a,defaultProp:o??null,onChange:l,caller:uy}),[_,v]=E.useState(!1),y=is(c),x=v6(t),S=E.useRef(!1),[w,T]=E.useState(0);return E.useEffect(()=>{const A=d.current;if(A)return A.addEventListener(X1,y),()=>A.removeEventListener(X1,y)},[y]),b.jsx(yce,{scope:t,orientation:i,dir:p,loop:s,currentTabStopId:m,onItemFocus:E.useCallback(A=>g(A),[g]),onItemShiftTab:E.useCallback(()=>v(!0),[]),onFocusableItemAdd:E.useCallback(()=>T(A=>A+1),[]),onFocusableItemRemove:E.useCallback(()=>T(A=>A-1),[]),children:b.jsx(Ee.div,{tabIndex:_||w===0?-1:0,"data-orientation":i,...h,ref:f,style:{outline:"none",...r.style},onMouseDown:le(r.onMouseDown,()=>{S.current=!0}),onFocus:le(r.onFocus,A=>{const C=!S.current;if(A.target===A.currentTarget&&C&&!_){const P=new CustomEvent(X1,gce);if(A.currentTarget.dispatchEvent(P),!P.defaultPrevented){const I=x().filter(B=>B.focusable),M=I.find(B=>B.active),N=I.find(B=>B.id===m),V=[M,N,...I].filter(Boolean).map(B=>B.ref.current);w6(V,u)}}S.current=!1}),onBlur:le(r.onBlur,()=>v(!1))})})}),x6="RovingFocusGroupItem",b6=E.forwardRef((r,e)=>{const{__scopeRovingFocusGroup:t,focusable:i=!0,active:s=!1,tabStopId:n,children:a,...o}=r,l=Fo(),c=n||l,u=Sce(x6,t),h=u.currentTabStopId===c,d=v6(t),{onFocusableItemAdd:f,onFocusableItemRemove:p,currentTabStopId:m}=u;return E.useEffect(()=>{if(i)return f(),()=>p()},[i,f,p]),b.jsx(KI.ItemSlot,{scope:t,id:c,focusable:i,active:s,children:b.jsx(Ee.span,{tabIndex:h?0:-1,"data-orientation":u.orientation,...o,ref:e,onMouseDown:le(r.onMouseDown,g=>{i?u.onItemFocus(c):g.preventDefault()}),onFocus:le(r.onFocus,()=>u.onItemFocus(c)),onKeyDown:le(r.onKeyDown,g=>{if(g.key==="Tab"&&g.shiftKey){u.onItemShiftTab();return}if(g.target!==g.currentTarget)return;const _=Tce(g,u.orientation,u.dir);if(_!==void 0){if(g.metaKey||g.ctrlKey||g.altKey||g.shiftKey)return;g.preventDefault();let y=d().filter(x=>x.focusable).map(x=>x.ref.current);if(_==="last")y.reverse();else if(_==="prev"||_==="next"){_==="prev"&&y.reverse();const x=y.indexOf(g.currentTarget);y=u.loop?Ece(y,x+1):y.slice(x+1)}setTimeout(()=>w6(y))}}),children:typeof a=="function"?a({isCurrentTabStop:h,hasTabStop:m!=null}):a})})});b6.displayName=x6;var bce={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function wce(r,e){return e!=="rtl"?r:r==="ArrowLeft"?"ArrowRight":r==="ArrowRight"?"ArrowLeft":r}function Tce(r,e,t){const i=wce(r.key,t);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(i))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(i)))return bce[i]}function w6(r,e=!1){const t=document.activeElement;for(const i of r)if(i===t||(i.focus({preventScroll:e}),document.activeElement!==t))return}function Ece(r,e){return r.map((t,i)=>r[(e+i)%r.length])}var Ace=S6,Cce=b6,Pce=function(r){if(typeof document>"u")return null;var e=Array.isArray(r)?r[0]:r;return e.ownerDocument.body},Wh=new WeakMap,T0=new WeakMap,E0={},q1=0,T6=function(r){return r&&(r.host||T6(r.parentNode))},Ice=function(r,e){return e.map(function(t){if(r.contains(t))return t;var i=T6(t);return i&&r.contains(i)?i:(console.error("aria-hidden",t,"in not contained inside",r,". Doing nothing"),null)}).filter(function(t){return!!t})},Mce=function(r,e,t,i){var s=Ice(e,Array.isArray(r)?r:[r]);E0[t]||(E0[t]=new WeakMap);var n=E0[t],a=[],o=new Set,l=new Set(s),c=function(h){!h||o.has(h)||(o.add(h),c(h.parentNode))};s.forEach(c);var u=function(h){!h||l.has(h)||Array.prototype.forEach.call(h.children,function(d){if(o.has(d))u(d);else try{var f=d.getAttribute(i),p=f!==null&&f!=="false",m=(Wh.get(d)||0)+1,g=(n.get(d)||0)+1;Wh.set(d,m),n.set(d,g),a.push(d),m===1&&p&&T0.set(d,!0),g===1&&d.setAttribute(t,"true"),p||d.setAttribute(i,"true")}catch(_){console.error("aria-hidden: cannot operate on ",d,_)}})};return u(e),o.clear(),q1++,function(){a.forEach(function(h){var d=Wh.get(h)-1,f=n.get(h)-1;Wh.set(h,d),n.set(h,f),d||(T0.has(h)||h.removeAttribute(i),T0.delete(h)),f||h.removeAttribute(t)}),q1--,q1||(Wh=new WeakMap,Wh=new WeakMap,T0=new WeakMap,E0={})}},nO=function(r,e,t){t===void 0&&(t="data-aria-hidden");var i=Array.from(Array.isArray(r)?r:[r]),s=Pce(r);return s?(i.push.apply(i,Array.from(s.querySelectorAll("[aria-live], script"))),Mce(i,s,t,"aria-hidden")):function(){return null}},Ea=function(){return Ea=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++){t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},Ea.apply(this,arguments)};function E6(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(r);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(t[i[s]]=r[i[s]]);return t}function Rce(r,e,t){if(t||arguments.length===2)for(var i=0,s=e.length,n;i<s;i++)(n||!(i in e))&&(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return r.concat(n||Array.prototype.slice.call(e))}var ex="right-scroll-bar-position",tx="width-before-scroll-bar",Dce="with-scroll-bars-hidden",Lce="--removed-body-scroll-bar-size";function Y1(r,e){return typeof r=="function"?r(e):r&&(r.current=e),r}function Oce(r,e){var t=E.useState(function(){return{value:r,callback:e,facade:{get current(){return t.value},set current(i){var s=t.value;s!==i&&(t.value=i,t.callback(i,s))}}}})[0];return t.callback=e,t.facade}var Nce=typeof window<"u"?E.useLayoutEffect:E.useEffect,AB=new WeakMap;function kce(r,e){var t=Oce(null,function(i){return r.forEach(function(s){return Y1(s,i)})});return Nce(function(){var i=AB.get(t);if(i){var s=new Set(i),n=new Set(r),a=t.current;s.forEach(function(o){n.has(o)||Y1(o,null)}),n.forEach(function(o){s.has(o)||Y1(o,a)})}AB.set(t,r)},[r]),t}function Fce(r){return r}function Bce(r,e){e===void 0&&(e=Fce);var t=[],i=!1,s={read:function(){if(i)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:r},useMedium:function(n){var a=e(n,i);return t.push(a),function(){t=t.filter(function(o){return o!==a})}},assignSyncMedium:function(n){for(i=!0;t.length;){var a=t;t=[],a.forEach(n)}t={push:function(o){return n(o)},filter:function(){return t}}},assignMedium:function(n){i=!0;var a=[];if(t.length){var o=t;t=[],o.forEach(n),a=t}var l=function(){var u=a;a=[],u.forEach(n)},c=function(){return Promise.resolve().then(l)};c(),t={push:function(u){a.push(u),c()},filter:function(u){return a=a.filter(u),t}}}};return s}function Uce(r){r===void 0&&(r={});var e=Bce(null);return e.options=Ea({async:!0,ssr:!1},r),e}var A6=function(r){var e=r.sideCar,t=E6(r,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var i=e.read();if(!i)throw new Error("Sidecar medium not found");return E.createElement(i,Ea({},t))};A6.isSideCarExport=!0;function zce(r,e){return r.useMedium(e),A6}var C6=Uce(),K1=function(){},XT=E.forwardRef(function(r,e){var t=E.useRef(null),i=E.useState({onScrollCapture:K1,onWheelCapture:K1,onTouchMoveCapture:K1}),s=i[0],n=i[1],a=r.forwardProps,o=r.children,l=r.className,c=r.removeScrollBar,u=r.enabled,h=r.shards,d=r.sideCar,f=r.noRelative,p=r.noIsolation,m=r.inert,g=r.allowPinchZoom,_=r.as,v=_===void 0?"div":_,y=r.gapMode,x=E6(r,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),S=d,w=kce([t,e]),T=Ea(Ea({},x),s);return E.createElement(E.Fragment,null,u&&E.createElement(S,{sideCar:C6,removeScrollBar:c,shards:h,noRelative:f,noIsolation:p,inert:m,setCallbacks:n,allowPinchZoom:!!g,lockRef:t,gapMode:y}),a?E.cloneElement(E.Children.only(o),Ea(Ea({},T),{ref:w})):E.createElement(v,Ea({},T,{className:l,ref:w}),o))});XT.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};XT.classNames={fullWidth:tx,zeroRight:ex};var Vce=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function jce(){if(!document)return null;var r=document.createElement("style");r.type="text/css";var e=Vce();return e&&r.setAttribute("nonce",e),r}function $ce(r,e){r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}function Hce(r){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(r)}var Gce=function(){var r=0,e=null;return{add:function(t){r==0&&(e=jce())&&($ce(e,t),Hce(e)),r++},remove:function(){r--,!r&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},Wce=function(){var r=Gce();return function(e,t){E.useEffect(function(){return r.add(e),function(){r.remove()}},[e&&t])}},P6=function(){var r=Wce(),e=function(t){var i=t.styles,s=t.dynamic;return r(i,s),null};return e},Xce={left:0,top:0,right:0,gap:0},Z1=function(r){return parseInt(r||"",10)||0},qce=function(r){var e=window.getComputedStyle(document.body),t=e[r==="padding"?"paddingLeft":"marginLeft"],i=e[r==="padding"?"paddingTop":"marginTop"],s=e[r==="padding"?"paddingRight":"marginRight"];return[Z1(t),Z1(i),Z1(s)]},Yce=function(r){if(r===void 0&&(r="margin"),typeof window>"u")return Xce;var e=qce(r),t=document.documentElement.clientWidth,i=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,i-t+e[2]-e[0])}},Kce=P6(),Ef="data-scroll-locked",Zce=function(r,e,t,i){var s=r.left,n=r.top,a=r.right,o=r.gap;return t===void 0&&(t="margin"),`
  .`.concat(Dce,` {
   overflow: hidden `).concat(i,`;
   padding-right: `).concat(o,"px ").concat(i,`;
  }
  body[`).concat(Ef,`] {
    overflow: hidden `).concat(i,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(i,";"),t==="margin"&&`
    padding-left: `.concat(s,`px;
    padding-top: `).concat(n,`px;
    padding-right: `).concat(a,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(o,"px ").concat(i,`;
    `),t==="padding"&&"padding-right: ".concat(o,"px ").concat(i,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(ex,` {
    right: `).concat(o,"px ").concat(i,`;
  }
  
  .`).concat(tx,` {
    margin-right: `).concat(o,"px ").concat(i,`;
  }
  
  .`).concat(ex," .").concat(ex,` {
    right: 0 `).concat(i,`;
  }
  
  .`).concat(tx," .").concat(tx,` {
    margin-right: 0 `).concat(i,`;
  }
  
  body[`).concat(Ef,`] {
    `).concat(Lce,": ").concat(o,`px;
  }
`)},CB=function(){var r=parseInt(document.body.getAttribute(Ef)||"0",10);return isFinite(r)?r:0},Qce=function(){E.useEffect(function(){return document.body.setAttribute(Ef,(CB()+1).toString()),function(){var r=CB()-1;r<=0?document.body.removeAttribute(Ef):document.body.setAttribute(Ef,r.toString())}},[])},Jce=function(r){var e=r.noRelative,t=r.noImportant,i=r.gapMode,s=i===void 0?"margin":i;Qce();var n=E.useMemo(function(){return Yce(s)},[s]);return E.createElement(Kce,{styles:Zce(n,!e,s,t?"":"!important")})},ZI=!1;if(typeof window<"u")try{var A0=Object.defineProperty({},"passive",{get:function(){return ZI=!0,!0}});window.addEventListener("test",A0,A0),window.removeEventListener("test",A0,A0)}catch{ZI=!1}var Xh=ZI?{passive:!1}:!1,eue=function(r){return r.tagName==="TEXTAREA"},I6=function(r,e){if(!(r instanceof Element))return!1;var t=window.getComputedStyle(r);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!eue(r)&&t[e]==="visible")},tue=function(r){return I6(r,"overflowY")},iue=function(r){return I6(r,"overflowX")},PB=function(r,e){var t=e.ownerDocument,i=e;do{typeof ShadowRoot<"u"&&i instanceof ShadowRoot&&(i=i.host);var s=M6(r,i);if(s){var n=R6(r,i),a=n[1],o=n[2];if(a>o)return!0}i=i.parentNode}while(i&&i!==t.body);return!1},rue=function(r){var e=r.scrollTop,t=r.scrollHeight,i=r.clientHeight;return[e,t,i]},sue=function(r){var e=r.scrollLeft,t=r.scrollWidth,i=r.clientWidth;return[e,t,i]},M6=function(r,e){return r==="v"?tue(e):iue(e)},R6=function(r,e){return r==="v"?rue(e):sue(e)},nue=function(r,e){return r==="h"&&e==="rtl"?-1:1},aue=function(r,e,t,i,s){var n=nue(r,window.getComputedStyle(e).direction),a=n*i,o=t.target,l=e.contains(o),c=!1,u=a>0,h=0,d=0;do{if(!o)break;var f=R6(r,o),p=f[0],m=f[1],g=f[2],_=m-g-n*p;(p||_)&&M6(r,o)&&(h+=_,d+=p);var v=o.parentNode;o=v&&v.nodeType===Node.DOCUMENT_FRAGMENT_NODE?v.host:v}while(!l&&o!==document.body||l&&(e.contains(o)||e===o));return(u&&Math.abs(h)<1||!u&&Math.abs(d)<1)&&(c=!0),c},C0=function(r){return"changedTouches"in r?[r.changedTouches[0].clientX,r.changedTouches[0].clientY]:[0,0]},IB=function(r){return[r.deltaX,r.deltaY]},MB=function(r){return r&&"current"in r?r.current:r},oue=function(r,e){return r[0]===e[0]&&r[1]===e[1]},lue=function(r){return`
  .block-interactivity-`.concat(r,` {pointer-events: none;}
  .allow-interactivity-`).concat(r,` {pointer-events: all;}
`)},cue=0,qh=[];function uue(r){var e=E.useRef([]),t=E.useRef([0,0]),i=E.useRef(),s=E.useState(cue++)[0],n=E.useState(P6)[0],a=E.useRef(r);E.useEffect(function(){a.current=r},[r]),E.useEffect(function(){if(r.inert){document.body.classList.add("block-interactivity-".concat(s));var m=Rce([r.lockRef.current],(r.shards||[]).map(MB),!0).filter(Boolean);return m.forEach(function(g){return g.classList.add("allow-interactivity-".concat(s))}),function(){document.body.classList.remove("block-interactivity-".concat(s)),m.forEach(function(g){return g.classList.remove("allow-interactivity-".concat(s))})}}},[r.inert,r.lockRef.current,r.shards]);var o=E.useCallback(function(m,g){if("touches"in m&&m.touches.length===2||m.type==="wheel"&&m.ctrlKey)return!a.current.allowPinchZoom;var _=C0(m),v=t.current,y="deltaX"in m?m.deltaX:v[0]-_[0],x="deltaY"in m?m.deltaY:v[1]-_[1],S,w=m.target,T=Math.abs(y)>Math.abs(x)?"h":"v";if("touches"in m&&T==="h"&&w.type==="range")return!1;var A=PB(T,w);if(!A)return!0;if(A?S=T:(S=T==="v"?"h":"v",A=PB(T,w)),!A)return!1;if(!i.current&&"changedTouches"in m&&(y||x)&&(i.current=S),!S)return!0;var C=i.current||S;return aue(C,g,m,C==="h"?y:x)},[]),l=E.useCallback(function(m){var g=m;if(!(!qh.length||qh[qh.length-1]!==n)){var _="deltaY"in g?IB(g):C0(g),v=e.current.filter(function(S){return S.name===g.type&&(S.target===g.target||g.target===S.shadowParent)&&oue(S.delta,_)})[0];if(v&&v.should){g.cancelable&&g.preventDefault();return}if(!v){var y=(a.current.shards||[]).map(MB).filter(Boolean).filter(function(S){return S.contains(g.target)}),x=y.length>0?o(g,y[0]):!a.current.noIsolation;x&&g.cancelable&&g.preventDefault()}}},[]),c=E.useCallback(function(m,g,_,v){var y={name:m,delta:g,target:_,should:v,shadowParent:hue(_)};e.current.push(y),setTimeout(function(){e.current=e.current.filter(function(x){return x!==y})},1)},[]),u=E.useCallback(function(m){t.current=C0(m),i.current=void 0},[]),h=E.useCallback(function(m){c(m.type,IB(m),m.target,o(m,r.lockRef.current))},[]),d=E.useCallback(function(m){c(m.type,C0(m),m.target,o(m,r.lockRef.current))},[]);E.useEffect(function(){return qh.push(n),r.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:d}),document.addEventListener("wheel",l,Xh),document.addEventListener("touchmove",l,Xh),document.addEventListener("touchstart",u,Xh),function(){qh=qh.filter(function(m){return m!==n}),document.removeEventListener("wheel",l,Xh),document.removeEventListener("touchmove",l,Xh),document.removeEventListener("touchstart",u,Xh)}},[]);var f=r.removeScrollBar,p=r.inert;return E.createElement(E.Fragment,null,p?E.createElement(n,{styles:lue(s)}):null,f?E.createElement(Jce,{noRelative:r.noRelative,gapMode:r.gapMode}):null)}function hue(r){for(var e=null;r!==null;)r instanceof ShadowRoot&&(e=r.host,r=r.host),r=r.parentNode;return e}const due=zce(C6,uue);var qT=E.forwardRef(function(r,e){return E.createElement(XT,Ea({},r,{ref:e,sideCar:due}))});qT.classNames=XT.classNames;var QI=["Enter"," "],fue=["ArrowDown","PageUp","Home"],D6=["ArrowUp","PageDown","End"],pue=[...fue,...D6],mue={ltr:[...QI,"ArrowRight"],rtl:[...QI,"ArrowLeft"]},gue={ltr:["ArrowLeft"],rtl:["ArrowRight"]},hy="Menu",[G_,_ue,vue]=LT(hy),[Dh,L6]=Ga(hy,[vue,om,y6]),YT=om(),O6=y6(),[yue,Lh]=Dh(hy),[Sue,dy]=Dh(hy),N6=r=>{const{__scopeMenu:e,open:t=!1,children:i,dir:s,onOpenChange:n,modal:a=!0}=r,o=YT(e),[l,c]=E.useState(null),u=E.useRef(!1),h=is(n),d=rO(s);return E.useEffect(()=>{const f=()=>{u.current=!0,document.addEventListener("pointerdown",p,{capture:!0,once:!0}),document.addEventListener("pointermove",p,{capture:!0,once:!0})},p=()=>u.current=!1;return document.addEventListener("keydown",f,{capture:!0}),()=>{document.removeEventListener("keydown",f,{capture:!0}),document.removeEventListener("pointerdown",p,{capture:!0}),document.removeEventListener("pointermove",p,{capture:!0})}},[]),b.jsx(j8,{...o,children:b.jsx(yue,{scope:e,open:t,onOpenChange:h,content:l,onContentChange:c,children:b.jsx(Sue,{scope:e,onClose:E.useCallback(()=>h(!1),[h]),isUsingKeyboardRef:u,dir:d,modal:a,children:i})})})};N6.displayName=hy;var xue="MenuAnchor",aO=E.forwardRef((r,e)=>{const{__scopeMenu:t,...i}=r,s=YT(t);return b.jsx(YL,{...s,...i,ref:e})});aO.displayName=xue;var oO="MenuPortal",[bue,k6]=Dh(oO,{forceMount:void 0}),F6=r=>{const{__scopeMenu:e,forceMount:t,children:i,container:s}=r,n=Lh(oO,e);return b.jsx(bue,{scope:e,forceMount:t,children:b.jsx(Jn,{present:t||n.open,children:b.jsx(ny,{asChild:!0,container:s,children:i})})})};F6.displayName=oO;var nn="MenuContent",[wue,lO]=Dh(nn),B6=E.forwardRef((r,e)=>{const t=k6(nn,r.__scopeMenu),{forceMount:i=t.forceMount,...s}=r,n=Lh(nn,r.__scopeMenu),a=dy(nn,r.__scopeMenu);return b.jsx(G_.Provider,{scope:r.__scopeMenu,children:b.jsx(Jn,{present:i||n.open,children:b.jsx(G_.Slot,{scope:r.__scopeMenu,children:a.modal?b.jsx(Tue,{...s,ref:e}):b.jsx(Eue,{...s,ref:e})})})})}),Tue=E.forwardRef((r,e)=>{const t=Lh(nn,r.__scopeMenu),i=E.useRef(null),s=Ze(e,i);return E.useEffect(()=>{const n=i.current;if(n)return nO(n)},[]),b.jsx(cO,{...r,ref:s,trapFocus:t.open,disableOutsidePointerEvents:t.open,disableOutsideScroll:!0,onFocusOutside:le(r.onFocusOutside,n=>n.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>t.onOpenChange(!1)})}),Eue=E.forwardRef((r,e)=>{const t=Lh(nn,r.__scopeMenu);return b.jsx(cO,{...r,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>t.onOpenChange(!1)})}),Aue=ih("MenuContent.ScrollLock"),cO=E.forwardRef((r,e)=>{const{__scopeMenu:t,loop:i=!1,trapFocus:s,onOpenAutoFocus:n,onCloseAutoFocus:a,disableOutsidePointerEvents:o,onEntryFocus:l,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:h,onInteractOutside:d,onDismiss:f,disableOutsideScroll:p,...m}=r,g=Lh(nn,t),_=dy(nn,t),v=YT(t),y=O6(t),x=_ue(t),[S,w]=E.useState(null),T=E.useRef(null),A=Ze(e,T,g.onContentChange),C=E.useRef(0),P=E.useRef(""),I=E.useRef(0),M=E.useRef(null),N=E.useRef("right"),k=E.useRef(0),V=p?qT:E.Fragment,B=p?{as:Aue,allowPinchZoom:!0}:void 0,R=D=>{var W,ie;const F=P.current+D,j=x().filter(q=>!q.disabled),z=document.activeElement,$=(W=j.find(q=>q.ref.current===z))==null?void 0:W.textValue,H=j.map(q=>q.textValue),G=Bue(H,F,$),Y=(ie=j.find(q=>q.textValue===G))==null?void 0:ie.ref.current;(function q(K){P.current=K,window.clearTimeout(C.current),K!==""&&(C.current=window.setTimeout(()=>q(""),1e3))})(F),Y&&setTimeout(()=>Y.focus())};E.useEffect(()=>()=>window.clearTimeout(C.current),[]),sO();const L=E.useCallback(D=>{var j,z;return N.current===((j=M.current)==null?void 0:j.side)&&zue(D,(z=M.current)==null?void 0:z.area)},[]);return b.jsx(wue,{scope:t,searchRef:P,onItemEnter:E.useCallback(D=>{L(D)&&D.preventDefault()},[L]),onItemLeave:E.useCallback(D=>{var F;L(D)||((F=T.current)==null||F.focus(),w(null))},[L]),onTriggerLeave:E.useCallback(D=>{L(D)&&D.preventDefault()},[L]),pointerGraceTimerRef:I,onPointerGraceIntentChange:E.useCallback(D=>{M.current=D},[]),children:b.jsx(V,{...B,children:b.jsx(WT,{asChild:!0,trapped:s,onMountAutoFocus:le(n,D=>{var F;D.preventDefault(),(F=T.current)==null||F.focus({preventScroll:!0})}),onUnmountAutoFocus:a,children:b.jsx(rm,{asChild:!0,disableOutsidePointerEvents:o,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:h,onInteractOutside:d,onDismiss:f,children:b.jsx(Ace,{asChild:!0,...y,dir:_.dir,orientation:"vertical",loop:i,currentTabStopId:S,onCurrentTabStopIdChange:w,onEntryFocus:le(l,D=>{_.isUsingKeyboardRef.current||D.preventDefault()}),preventScrollOnEntryFocus:!0,children:b.jsx(KL,{role:"menu","aria-orientation":"vertical","data-state":eX(g.open),"data-radix-menu-content":"",dir:_.dir,...v,...m,ref:A,style:{outline:"none",...m.style},onKeyDown:le(m.onKeyDown,D=>{const j=D.target.closest("[data-radix-menu-content]")===D.currentTarget,z=D.ctrlKey||D.altKey||D.metaKey,$=D.key.length===1;j&&(D.key==="Tab"&&D.preventDefault(),!z&&$&&R(D.key));const H=T.current;if(D.target!==H||!pue.includes(D.key))return;D.preventDefault();const Y=x().filter(W=>!W.disabled).map(W=>W.ref.current);D6.includes(D.key)&&Y.reverse(),kue(Y)}),onBlur:le(r.onBlur,D=>{D.currentTarget.contains(D.target)||(window.clearTimeout(C.current),P.current="")}),onPointerMove:le(r.onPointerMove,W_(D=>{const F=D.target,j=k.current!==D.clientX;if(D.currentTarget.contains(F)&&j){const z=D.clientX>k.current?"right":"left";N.current=z,k.current=D.clientX}}))})})})})})})});B6.displayName=nn;var Cue="MenuGroup",uO=E.forwardRef((r,e)=>{const{__scopeMenu:t,...i}=r;return b.jsx(Ee.div,{role:"group",...i,ref:e})});uO.displayName=Cue;var Pue="MenuLabel",U6=E.forwardRef((r,e)=>{const{__scopeMenu:t,...i}=r;return b.jsx(Ee.div,{...i,ref:e})});U6.displayName=Pue;var Jx="MenuItem",RB="menu.itemSelect",KT=E.forwardRef((r,e)=>{const{disabled:t=!1,onSelect:i,...s}=r,n=E.useRef(null),a=dy(Jx,r.__scopeMenu),o=lO(Jx,r.__scopeMenu),l=Ze(e,n),c=E.useRef(!1),u=()=>{const h=n.current;if(!t&&h){const d=new CustomEvent(RB,{bubbles:!0,cancelable:!0});h.addEventListener(RB,f=>i==null?void 0:i(f),{once:!0}),RL(h,d),d.defaultPrevented?c.current=!1:a.onClose()}};return b.jsx(z6,{...s,ref:l,disabled:t,onClick:le(r.onClick,u),onPointerDown:h=>{var d;(d=r.onPointerDown)==null||d.call(r,h),c.current=!0},onPointerUp:le(r.onPointerUp,h=>{var d;c.current||(d=h.currentTarget)==null||d.click()}),onKeyDown:le(r.onKeyDown,h=>{const d=o.searchRef.current!=="";t||d&&h.key===" "||QI.includes(h.key)&&(h.currentTarget.click(),h.preventDefault())})})});KT.displayName=Jx;var z6=E.forwardRef((r,e)=>{const{__scopeMenu:t,disabled:i=!1,textValue:s,...n}=r,a=lO(Jx,t),o=O6(t),l=E.useRef(null),c=Ze(e,l),[u,h]=E.useState(!1),[d,f]=E.useState("");return E.useEffect(()=>{const p=l.current;p&&f((p.textContent??"").trim())},[n.children]),b.jsx(G_.ItemSlot,{scope:t,disabled:i,textValue:s??d,children:b.jsx(Cce,{asChild:!0,...o,focusable:!i,children:b.jsx(Ee.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":i||void 0,"data-disabled":i?"":void 0,...n,ref:c,onPointerMove:le(r.onPointerMove,W_(p=>{i?a.onItemLeave(p):(a.onItemEnter(p),p.defaultPrevented||p.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:le(r.onPointerLeave,W_(p=>a.onItemLeave(p))),onFocus:le(r.onFocus,()=>h(!0)),onBlur:le(r.onBlur,()=>h(!1))})})})}),Iue="MenuCheckboxItem",V6=E.forwardRef((r,e)=>{const{checked:t=!1,onCheckedChange:i,...s}=r;return b.jsx(W6,{scope:r.__scopeMenu,checked:t,children:b.jsx(KT,{role:"menuitemcheckbox","aria-checked":eb(t)?"mixed":t,...s,ref:e,"data-state":dO(t),onSelect:le(s.onSelect,()=>i==null?void 0:i(eb(t)?!0:!t),{checkForDefaultPrevented:!1})})})});V6.displayName=Iue;var j6="MenuRadioGroup",[Mue,Rue]=Dh(j6,{value:void 0,onValueChange:()=>{}}),$6=E.forwardRef((r,e)=>{const{value:t,onValueChange:i,...s}=r,n=is(i);return b.jsx(Mue,{scope:r.__scopeMenu,value:t,onValueChange:n,children:b.jsx(uO,{...s,ref:e})})});$6.displayName=j6;var H6="MenuRadioItem",G6=E.forwardRef((r,e)=>{const{value:t,...i}=r,s=Rue(H6,r.__scopeMenu),n=t===s.value;return b.jsx(W6,{scope:r.__scopeMenu,checked:n,children:b.jsx(KT,{role:"menuitemradio","aria-checked":n,...i,ref:e,"data-state":dO(n),onSelect:le(i.onSelect,()=>{var a;return(a=s.onValueChange)==null?void 0:a.call(s,t)},{checkForDefaultPrevented:!1})})})});G6.displayName=H6;var hO="MenuItemIndicator",[W6,Due]=Dh(hO,{checked:!1}),X6=E.forwardRef((r,e)=>{const{__scopeMenu:t,forceMount:i,...s}=r,n=Due(hO,t);return b.jsx(Jn,{present:i||eb(n.checked)||n.checked===!0,children:b.jsx(Ee.span,{...s,ref:e,"data-state":dO(n.checked)})})});X6.displayName=hO;var Lue="MenuSeparator",q6=E.forwardRef((r,e)=>{const{__scopeMenu:t,...i}=r;return b.jsx(Ee.div,{role:"separator","aria-orientation":"horizontal",...i,ref:e})});q6.displayName=Lue;var Oue="MenuArrow",Y6=E.forwardRef((r,e)=>{const{__scopeMenu:t,...i}=r,s=YT(t);return b.jsx(ZL,{...s,...i,ref:e})});Y6.displayName=Oue;var Nue="MenuSub",[wit,K6]=Dh(Nue),Cg="MenuSubTrigger",Z6=E.forwardRef((r,e)=>{const t=Lh(Cg,r.__scopeMenu),i=dy(Cg,r.__scopeMenu),s=K6(Cg,r.__scopeMenu),n=lO(Cg,r.__scopeMenu),a=E.useRef(null),{pointerGraceTimerRef:o,onPointerGraceIntentChange:l}=n,c={__scopeMenu:r.__scopeMenu},u=E.useCallback(()=>{a.current&&window.clearTimeout(a.current),a.current=null},[]);return E.useEffect(()=>u,[u]),E.useEffect(()=>{const h=o.current;return()=>{window.clearTimeout(h),l(null)}},[o,l]),b.jsx(aO,{asChild:!0,...c,children:b.jsx(z6,{id:s.triggerId,"aria-haspopup":"menu","aria-expanded":t.open,"aria-controls":s.contentId,"data-state":eX(t.open),...r,ref:DT(e,s.onTriggerChange),onClick:h=>{var d;(d=r.onClick)==null||d.call(r,h),!(r.disabled||h.defaultPrevented)&&(h.currentTarget.focus(),t.open||t.onOpenChange(!0))},onPointerMove:le(r.onPointerMove,W_(h=>{n.onItemEnter(h),!h.defaultPrevented&&!r.disabled&&!t.open&&!a.current&&(n.onPointerGraceIntentChange(null),a.current=window.setTimeout(()=>{t.onOpenChange(!0),u()},100))})),onPointerLeave:le(r.onPointerLeave,W_(h=>{var f,p;u();const d=(f=t.content)==null?void 0:f.getBoundingClientRect();if(d){const m=(p=t.content)==null?void 0:p.dataset.side,g=m==="right",_=g?-5:5,v=d[g?"left":"right"],y=d[g?"right":"left"];n.onPointerGraceIntentChange({area:[{x:h.clientX+_,y:h.clientY},{x:v,y:d.top},{x:y,y:d.top},{x:y,y:d.bottom},{x:v,y:d.bottom}],side:m}),window.clearTimeout(o.current),o.current=window.setTimeout(()=>n.onPointerGraceIntentChange(null),300)}else{if(n.onTriggerLeave(h),h.defaultPrevented)return;n.onPointerGraceIntentChange(null)}})),onKeyDown:le(r.onKeyDown,h=>{var f;const d=n.searchRef.current!=="";r.disabled||d&&h.key===" "||mue[i.dir].includes(h.key)&&(t.onOpenChange(!0),(f=t.content)==null||f.focus(),h.preventDefault())})})})});Z6.displayName=Cg;var Q6="MenuSubContent",J6=E.forwardRef((r,e)=>{const t=k6(nn,r.__scopeMenu),{forceMount:i=t.forceMount,...s}=r,n=Lh(nn,r.__scopeMenu),a=dy(nn,r.__scopeMenu),o=K6(Q6,r.__scopeMenu),l=E.useRef(null),c=Ze(e,l);return b.jsx(G_.Provider,{scope:r.__scopeMenu,children:b.jsx(Jn,{present:i||n.open,children:b.jsx(G_.Slot,{scope:r.__scopeMenu,children:b.jsx(cO,{id:o.contentId,"aria-labelledby":o.triggerId,...s,ref:c,align:"start",side:a.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{var h;a.isUsingKeyboardRef.current&&((h=l.current)==null||h.focus()),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:le(r.onFocusOutside,u=>{u.target!==o.trigger&&n.onOpenChange(!1)}),onEscapeKeyDown:le(r.onEscapeKeyDown,u=>{a.onClose(),u.preventDefault()}),onKeyDown:le(r.onKeyDown,u=>{var f;const h=u.currentTarget.contains(u.target),d=gue[a.dir].includes(u.key);h&&d&&(n.onOpenChange(!1),(f=o.trigger)==null||f.focus(),u.preventDefault())})})})})})});J6.displayName=Q6;function eX(r){return r?"open":"closed"}function eb(r){return r==="indeterminate"}function dO(r){return eb(r)?"indeterminate":r?"checked":"unchecked"}function kue(r){const e=document.activeElement;for(const t of r)if(t===e||(t.focus(),document.activeElement!==e))return}function Fue(r,e){return r.map((t,i)=>r[(e+i)%r.length])}function Bue(r,e,t){const s=e.length>1&&Array.from(e).every(c=>c===e[0])?e[0]:e,n=t?r.indexOf(t):-1;let a=Fue(r,Math.max(n,0));s.length===1&&(a=a.filter(c=>c!==t));const l=a.find(c=>c.toLowerCase().startsWith(s.toLowerCase()));return l!==t?l:void 0}function Uue(r,e){const{x:t,y:i}=r;let s=!1;for(let n=0,a=e.length-1;n<e.length;a=n++){const o=e[n],l=e[a],c=o.x,u=o.y,h=l.x,d=l.y;u>i!=d>i&&t<(h-c)*(i-u)/(d-u)+c&&(s=!s)}return s}function zue(r,e){if(!e)return!1;const t={x:r.clientX,y:r.clientY};return Uue(t,e)}function W_(r){return e=>e.pointerType==="mouse"?r(e):void 0}var Vue=N6,jue=aO,$ue=F6,Hue=B6,Gue=uO,Wue=U6,Xue=KT,que=V6,Yue=$6,Kue=G6,Zue=X6,Que=q6,Jue=Y6,ehe=Z6,the=J6,ZT="DropdownMenu",[ihe,Tit]=Ga(ZT,[L6]),Vr=L6(),[rhe,tX]=ihe(ZT),iX=r=>{const{__scopeDropdownMenu:e,children:t,dir:i,open:s,defaultOpen:n,onOpenChange:a,modal:o=!0}=r,l=Vr(e),c=E.useRef(null),[u,h]=rh({prop:s,defaultProp:n??!1,onChange:a,caller:ZT});return b.jsx(rhe,{scope:e,triggerId:Fo(),triggerRef:c,contentId:Fo(),open:u,onOpenChange:h,onOpenToggle:E.useCallback(()=>h(d=>!d),[h]),modal:o,children:b.jsx(Vue,{...l,open:u,onOpenChange:h,dir:i,modal:o,children:t})})};iX.displayName=ZT;var rX="DropdownMenuTrigger",sX=E.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,disabled:i=!1,...s}=r,n=tX(rX,t),a=Vr(t);return b.jsx(jue,{asChild:!0,...a,children:b.jsx(Ee.button,{type:"button",id:n.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":n.open?n.contentId:void 0,"data-state":n.open?"open":"closed","data-disabled":i?"":void 0,disabled:i,...s,ref:DT(e,n.triggerRef),onPointerDown:le(r.onPointerDown,o=>{!i&&o.button===0&&o.ctrlKey===!1&&(n.onOpenToggle(),n.open||o.preventDefault())}),onKeyDown:le(r.onKeyDown,o=>{i||(["Enter"," "].includes(o.key)&&n.onOpenToggle(),o.key==="ArrowDown"&&n.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(o.key)&&o.preventDefault())})})})});sX.displayName=rX;var she="DropdownMenuPortal",nX=r=>{const{__scopeDropdownMenu:e,...t}=r,i=Vr(e);return b.jsx($ue,{...i,...t})};nX.displayName=she;var aX="DropdownMenuContent",oX=E.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...i}=r,s=tX(aX,t),n=Vr(t),a=E.useRef(!1);return b.jsx(Hue,{id:s.contentId,"aria-labelledby":s.triggerId,...n,...i,ref:e,onCloseAutoFocus:le(r.onCloseAutoFocus,o=>{var l;a.current||(l=s.triggerRef.current)==null||l.focus(),a.current=!1,o.preventDefault()}),onInteractOutside:le(r.onInteractOutside,o=>{const l=o.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,u=l.button===2||c;(!s.modal||u)&&(a.current=!0)}),style:{...r.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});oX.displayName=aX;var nhe="DropdownMenuGroup",ahe=E.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...i}=r,s=Vr(t);return b.jsx(Gue,{...s,...i,ref:e})});ahe.displayName=nhe;var ohe="DropdownMenuLabel",lX=E.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...i}=r,s=Vr(t);return b.jsx(Wue,{...s,...i,ref:e})});lX.displayName=ohe;var lhe="DropdownMenuItem",cX=E.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...i}=r,s=Vr(t);return b.jsx(Xue,{...s,...i,ref:e})});cX.displayName=lhe;var che="DropdownMenuCheckboxItem",uX=E.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...i}=r,s=Vr(t);return b.jsx(que,{...s,...i,ref:e})});uX.displayName=che;var uhe="DropdownMenuRadioGroup",hhe=E.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...i}=r,s=Vr(t);return b.jsx(Yue,{...s,...i,ref:e})});hhe.displayName=uhe;var dhe="DropdownMenuRadioItem",hX=E.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...i}=r,s=Vr(t);return b.jsx(Kue,{...s,...i,ref:e})});hX.displayName=dhe;var fhe="DropdownMenuItemIndicator",dX=E.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...i}=r,s=Vr(t);return b.jsx(Zue,{...s,...i,ref:e})});dX.displayName=fhe;var phe="DropdownMenuSeparator",fX=E.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...i}=r,s=Vr(t);return b.jsx(Que,{...s,...i,ref:e})});fX.displayName=phe;var mhe="DropdownMenuArrow",ghe=E.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...i}=r,s=Vr(t);return b.jsx(Jue,{...s,...i,ref:e})});ghe.displayName=mhe;var _he="DropdownMenuSubTrigger",pX=E.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...i}=r,s=Vr(t);return b.jsx(ehe,{...s,...i,ref:e})});pX.displayName=_he;var vhe="DropdownMenuSubContent",mX=E.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...i}=r,s=Vr(t);return b.jsx(the,{...s,...i,ref:e,style:{...r.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});mX.displayName=vhe;var yhe=iX,She=sX,xhe=nX,gX=oX,_X=lX,vX=cX,yX=uX,SX=hX,xX=dX,bX=fX,wX=pX,TX=mX;const EX=yhe,AX=She,bhe=E.forwardRef(({className:r,inset:e,children:t,...i},s)=>b.jsxs(wX,{ref:s,className:ye("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",e&&"pl-8",r),...i,children:[t,b.jsx(cse,{className:"ml-auto h-4 w-4"})]}));bhe.displayName=wX.displayName;const whe=E.forwardRef(({className:r,...e},t)=>b.jsx(TX,{ref:t,className:ye("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...e}));whe.displayName=TX.displayName;const fO=E.forwardRef(({className:r,sideOffset:e=4,...t},i)=>b.jsx(xhe,{children:b.jsx(gX,{ref:i,sideOffset:e,className:ye("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...t})}));fO.displayName=gX.displayName;const The=E.forwardRef(({className:r,inset:e,...t},i)=>b.jsx(vX,{ref:i,className:ye("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e&&"pl-8",r),...t}));The.displayName=vX.displayName;const Ehe=E.forwardRef(({className:r,children:e,checked:t,...i},s)=>b.jsxs(yX,{ref:s,className:ye("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),checked:t,...i,children:[b.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:b.jsx(xX,{children:b.jsx(NL,{className:"h-4 w-4"})})}),e]}));Ehe.displayName=yX.displayName;const Ahe=E.forwardRef(({className:r,children:e,...t},i)=>b.jsxs(SX,{ref:i,className:ye("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...t,children:[b.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:b.jsx(xX,{children:b.jsx(hse,{className:"h-2 w-2 fill-current"})})}),e]}));Ahe.displayName=SX.displayName;const pO=E.forwardRef(({className:r,inset:e,...t},i)=>b.jsx(_X,{ref:i,className:ye("px-2 py-1.5 text-sm font-semibold",e&&"pl-8",r),...t}));pO.displayName=_X.displayName;const mO=E.forwardRef(({className:r,...e},t)=>b.jsx(bX,{ref:t,className:ye("-mx-1 my-1 h-px bg-muted",r),...e}));mO.displayName=bX.displayName;const Che=kT("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),tt=E.forwardRef(({className:r,variant:e,size:t,asChild:i=!1,...s},n)=>{const a=i?gre:"button";return b.jsx(a,{className:ye(Che({variant:e,size:t,className:r})),ref:n,...s})});tt.displayName="Button";function CX(r){const e=E.useRef({value:r,previous:r});return E.useMemo(()=>(e.current.value!==r&&(e.current.previous=e.current.value,e.current.value=r),e.current.previous),[r])}var QT="Checkbox",[Phe,Eit]=Ga(QT),[Ihe,gO]=Phe(QT);function Mhe(r){const{__scopeCheckbox:e,checked:t,children:i,defaultChecked:s,disabled:n,form:a,name:o,onCheckedChange:l,required:c,value:u="on",internal_do_not_use_render:h}=r,[d,f]=rh({prop:t,defaultProp:s??!1,onChange:l,caller:QT}),[p,m]=E.useState(null),[g,_]=E.useState(null),v=E.useRef(!1),y=p?!!a||!!p.closest("form"):!0,x={checked:d,disabled:n,setChecked:f,control:p,setControl:m,name:o,form:a,value:u,hasConsumerStoppedPropagationRef:v,required:c,defaultChecked:dc(s)?!1:s,isFormControl:y,bubbleInput:g,setBubbleInput:_};return b.jsx(Ihe,{scope:e,...x,children:Rhe(h)?h(x):i})}var PX="CheckboxTrigger",IX=E.forwardRef(({__scopeCheckbox:r,onKeyDown:e,onClick:t,...i},s)=>{const{control:n,value:a,disabled:o,checked:l,required:c,setControl:u,setChecked:h,hasConsumerStoppedPropagationRef:d,isFormControl:f,bubbleInput:p}=gO(PX,r),m=Ze(s,u),g=E.useRef(l);return E.useEffect(()=>{const _=n==null?void 0:n.form;if(_){const v=()=>h(g.current);return _.addEventListener("reset",v),()=>_.removeEventListener("reset",v)}},[n,h]),b.jsx(Ee.button,{type:"button",role:"checkbox","aria-checked":dc(l)?"mixed":l,"aria-required":c,"data-state":OX(l),"data-disabled":o?"":void 0,disabled:o,value:a,...i,ref:m,onKeyDown:le(e,_=>{_.key==="Enter"&&_.preventDefault()}),onClick:le(t,_=>{h(v=>dc(v)?!0:!v),p&&f&&(d.current=_.isPropagationStopped(),d.current||_.stopPropagation())})})});IX.displayName=PX;var _O=E.forwardRef((r,e)=>{const{__scopeCheckbox:t,name:i,checked:s,defaultChecked:n,required:a,disabled:o,value:l,onCheckedChange:c,form:u,...h}=r;return b.jsx(Mhe,{__scopeCheckbox:t,checked:s,defaultChecked:n,disabled:o,required:a,onCheckedChange:c,name:i,form:u,value:l,internal_do_not_use_render:({isFormControl:d})=>b.jsxs(b.Fragment,{children:[b.jsx(IX,{...h,ref:e,__scopeCheckbox:t}),d&&b.jsx(LX,{__scopeCheckbox:t})]})})});_O.displayName=QT;var MX="CheckboxIndicator",RX=E.forwardRef((r,e)=>{const{__scopeCheckbox:t,forceMount:i,...s}=r,n=gO(MX,t);return b.jsx(Jn,{present:i||dc(n.checked)||n.checked===!0,children:b.jsx(Ee.span,{"data-state":OX(n.checked),"data-disabled":n.disabled?"":void 0,...s,ref:e,style:{pointerEvents:"none",...r.style}})})});RX.displayName=MX;var DX="CheckboxBubbleInput",LX=E.forwardRef(({__scopeCheckbox:r,...e},t)=>{const{control:i,hasConsumerStoppedPropagationRef:s,checked:n,defaultChecked:a,required:o,disabled:l,name:c,value:u,form:h,bubbleInput:d,setBubbleInput:f}=gO(DX,r),p=Ze(t,f),m=CX(n),g=D8(i);E.useEffect(()=>{const v=d;if(!v)return;const y=window.HTMLInputElement.prototype,S=Object.getOwnPropertyDescriptor(y,"checked").set,w=!s.current;if(m!==n&&S){const T=new Event("click",{bubbles:w});v.indeterminate=dc(n),S.call(v,dc(n)?!1:n),v.dispatchEvent(T)}},[d,m,n,s]);const _=E.useRef(dc(n)?!1:n);return b.jsx(Ee.input,{type:"checkbox","aria-hidden":!0,defaultChecked:a??_.current,required:o,disabled:l,name:c,value:u,form:h,...e,tabIndex:-1,ref:p,style:{...e.style,...g,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});LX.displayName=DX;function Rhe(r){return typeof r=="function"}function dc(r){return r==="indeterminate"}function OX(r){return dc(r)?"indeterminate":r?"checked":"unchecked"}const vO=E.forwardRef(({className:r,...e},t)=>b.jsx(_O,{ref:t,className:ye("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",r),...e,children:b.jsx(RX,{className:ye("flex items-center justify-center text-current"),children:b.jsx(NL,{className:"h-4 w-4"})})}));vO.displayName=_O.displayName;const Do={DEFAULT_CATEGORY:"all",PERFORMANCE_THRESHOLDS:{LOW_MEMORY_GB:4,SLOW_CONNECTION_TYPES:["slow-2g","2g"]},INTERSECTION_OBSERVER:{THRESHOLD:.2,ROOT_MARGIN:"50px"},DELAYS:{VIEW_TRACKING_MS:1e3,MODEL_PRELOAD_MS:500}},Dhe={DIETARY_OPTIONS:[{key:"vegetarian",label:"🌱 Vegetarian",emoji:"🌱"},{key:"vegan",label:"🥬 Vegan",emoji:"🥬"},{key:"glutenFree",label:"🌾 Gluten-Free",emoji:"🌾"},{key:"nutFree",label:"🥜 Nut-Free",emoji:"🥜"}]},Lhe=({categories:r,activeCategory:e,onCategoryChange:t})=>{const i=e===Do.DEFAULT_CATEGORY?[]:[e],s=o=>{o===Do.DEFAULT_CATEGORY?t(Do.DEFAULT_CATEGORY):t(o)},a=i.length>0?r.filter(o=>i.includes(o.id)).map(o=>o.name):["All"];return b.jsxs("div",{className:"flex items-center space-x-4",children:[b.jsx("span",{className:"text-sm font-medium text-foreground whitespace-nowrap",children:"Category:"}),b.jsxs(EX,{children:[b.jsx(AX,{asChild:!0,children:b.jsxs(tt,{variant:"outline",className:"w-48 justify-between","aria-label":"Select category filter",children:[b.jsx("span",{children:a.length>0?a.join(", "):"Select categories"}),b.jsx(FT,{className:"h-4 w-4 opacity-50","aria-hidden":"true"})]})}),b.jsxs(fO,{className:"w-56",align:"start",children:[b.jsx(pO,{children:"Categories"}),b.jsx(mO,{}),b.jsx("div",{className:"p-2 space-y-2",role:"group","aria-label":"Category options",children:r.map(o=>b.jsxs("div",{className:"flex items-center space-x-3 p-2 hover:bg-muted rounded-sm cursor-pointer",onClick:()=>s(o.id),role:"button",tabIndex:0,onKeyDown:l=>{(l.key==="Enter"||l.key===" ")&&s(o.id)},children:[b.jsx(vO,{id:o.id,checked:e===o.id,onCheckedChange:()=>s(o.id),"aria-label":`Filter by ${o.name}`}),b.jsxs("label",{htmlFor:o.id,className:"text-sm cursor-pointer flex-1 flex items-center",children:[b.jsx("span",{className:"mr-2","aria-hidden":"true",children:o.icon}),o.name]})]},o.id))})]})]})]})},NX=r=>`$${r.toFixed(2)}`,JI=(r,e,t)=>r===1?e:t||`${e}s`,Ohe=({filters:r,onFilterChange:e})=>{const t=Dhe.DIETARY_OPTIONS.map(n=>({...n,checked:r[n.key]})),i=t.filter(n=>n.checked).length,s=(n,a)=>{e(n,a)};return b.jsxs("div",{className:"flex items-center space-x-4",children:[b.jsx("span",{className:"text-sm font-medium text-foreground whitespace-nowrap",children:"Dietary:"}),b.jsxs(EX,{children:[b.jsx(AX,{asChild:!0,children:b.jsxs(tt,{variant:"outline",className:"w-48 justify-between","aria-label":"Select dietary filters",children:[b.jsx("span",{children:i>0?`${i} ${JI(i,"filter")} selected`:"Select dietary options"}),b.jsx(FT,{className:"h-4 w-4 opacity-50","aria-hidden":"true"})]})}),b.jsxs(fO,{className:"w-56",align:"start",children:[b.jsx(pO,{children:"Dietary Options"}),b.jsx(mO,{}),b.jsx("div",{className:"p-2 space-y-2",role:"group","aria-label":"Dietary filter options",children:t.map(n=>b.jsxs("div",{className:"flex items-center space-x-3 p-2 hover:bg-muted rounded-sm cursor-pointer",onClick:()=>s(n.key,!n.checked),role:"button",tabIndex:0,onKeyDown:a=>{(a.key==="Enter"||a.key===" ")&&s(n.key,!n.checked)},children:[b.jsx(vO,{id:n.key,checked:n.checked,onCheckedChange:a=>s(n.key,!!a),"aria-label":`Filter by ${n.label}`}),b.jsx("label",{htmlFor:n.key,className:"text-sm cursor-pointer flex-1",children:n.label})]},n.key))})]})]})]})},yO=()=>b.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:b.jsxs("div",{className:"text-center",children:[b.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto"}),b.jsx("p",{className:"mt-4 text-gray-600",children:"Loading menu..."})]})}),Nhe=()=>{const{theme:r,setTheme:e}=y8(),[t,i]=E.useState(!1);return E.useEffect(()=>{i(!0)},[]),t?b.jsxs(tt,{variant:"outline",size:"sm",onClick:()=>e(r==="dark"?"light":"dark"),className:"w-9 h-9 p-0",children:[r==="dark"?b.jsx(Tse,{className:"h-4 w-4"}):b.jsx(vse,{className:"h-4 w-4"}),b.jsx("span",{className:"sr-only",children:"Toggle theme"})]}):null};var khe={};const Fhe=r=>{const t=khe.REACT_APP_BACKEND_URL||`${window.location.origin}/`,s=`Check out ${r||"Our Menu"}'s digital menu! Visit: ${t}`;navigator.share?navigator.share({text:s}).catch(n=>{console.log("Share failed:",n),DB(s)}):DB(s)},DB=r=>{const t=`sms:?body=${encodeURIComponent(r)}`;window.open(t,"_self")},Bhe=({restaurant:r})=>{const e=()=>{Fhe(r==null?void 0:r.name)};return b.jsx("div",{className:"bg-background border-b border-border",children:b.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[b.jsxs("div",{className:"flex justify-between items-center py-3",children:[b.jsx("div",{className:"flex items-center space-x-2",children:b.jsx(Nhe,{})}),b.jsxs("div",{className:"flex items-center space-x-2",children:[b.jsxs(tt,{onClick:e,variant:"outline",size:"sm",children:[b.jsx(l8,{className:"w-4 h-4 mr-1"}),"Share"]}),b.jsx(ace,{to:"/admin",children:b.jsxs(tt,{variant:"outline",size:"sm",children:[b.jsx(xse,{className:"w-4 h-4 mr-1"}),"Admin"]})})]})]}),b.jsx("div",{className:"pb-6",children:b.jsxs("div",{className:"flex items-start space-x-4",children:[(r==null?void 0:r.logo_url)&&b.jsx("img",{src:r.logo_url,alt:"Restaurant Logo",className:"w-20 h-20 rounded-lg object-cover flex-shrink-0"}),b.jsxs("div",{className:"flex-1 min-w-0",children:[b.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:(r==null?void 0:r.name)||"Our Menu"}),b.jsx("div",{className:"flex items-center space-x-4 text-sm text-muted-foreground mb-2",children:b.jsxs("div",{className:"flex items-center",children:[b.jsx(ip,{className:"w-4 h-4 text-yellow-500 mr-1"}),b.jsx("span",{children:"4.6 (500+ ratings)"})]})}),b.jsx("p",{className:"text-muted-foreground",children:(r==null?void 0:r.description)||"Explore our delicious offerings"})]})]})})]})})},Uhe=kT("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Eo({className:r,variant:e,...t}){return b.jsx("div",{className:ye(Uhe({variant:e}),r),...t})}const Vt=E.forwardRef(({className:r,...e},t)=>b.jsx("div",{ref:t,className:ye("rounded-lg border bg-card text-card-foreground shadow-sm",r),...e}));Vt.displayName="Card";const Dr=E.forwardRef(({className:r,...e},t)=>b.jsx("div",{ref:t,className:ye("flex flex-col space-y-1.5 p-6",r),...e}));Dr.displayName="CardHeader";const Lr=E.forwardRef(({className:r,...e},t)=>b.jsx("h3",{ref:t,className:ye("text-2xl font-semibold leading-none tracking-tight",r),...e}));Lr.displayName="CardTitle";const Or=E.forwardRef(({className:r,...e},t)=>b.jsx("p",{ref:t,className:ye("text-sm text-muted-foreground",r),...e}));Or.displayName="CardDescription";const jt=E.forwardRef(({className:r,...e},t)=>b.jsx("div",{ref:t,className:ye("p-6 pt-0",r),...e}));jt.displayName="CardContent";const zhe=E.forwardRef(({className:r,...e},t)=>b.jsx("div",{ref:t,className:ye("flex items-center p-6 pt-0",r),...e}));zhe.displayName="CardFooter";var JT="Dialog",[kX,Ait]=Ga(JT),[Vhe,ea]=kX(JT),FX=r=>{const{__scopeDialog:e,children:t,open:i,defaultOpen:s,onOpenChange:n,modal:a=!0}=r,o=E.useRef(null),l=E.useRef(null),[c,u]=rh({prop:i,defaultProp:s??!1,onChange:n,caller:JT});return b.jsx(Vhe,{scope:e,triggerRef:o,contentRef:l,contentId:Fo(),titleId:Fo(),descriptionId:Fo(),open:c,onOpenChange:u,onOpenToggle:E.useCallback(()=>u(h=>!h),[u]),modal:a,children:t})};FX.displayName=JT;var BX="DialogTrigger",UX=E.forwardRef((r,e)=>{const{__scopeDialog:t,...i}=r,s=ea(BX,t),n=Ze(e,s.triggerRef);return b.jsx(Ee.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":bO(s.open),...i,ref:n,onClick:le(r.onClick,s.onOpenToggle)})});UX.displayName=BX;var SO="DialogPortal",[jhe,zX]=kX(SO,{forceMount:void 0}),VX=r=>{const{__scopeDialog:e,forceMount:t,children:i,container:s}=r,n=ea(SO,e);return b.jsx(jhe,{scope:e,forceMount:t,children:E.Children.map(i,a=>b.jsx(Jn,{present:t||n.open,children:b.jsx(ny,{asChild:!0,container:s,children:a})}))})};VX.displayName=SO;var tb="DialogOverlay",jX=E.forwardRef((r,e)=>{const t=zX(tb,r.__scopeDialog),{forceMount:i=t.forceMount,...s}=r,n=ea(tb,r.__scopeDialog);return n.modal?b.jsx(Jn,{present:i||n.open,children:b.jsx(Hhe,{...s,ref:e})}):null});jX.displayName=tb;var $he=ih("DialogOverlay.RemoveScroll"),Hhe=E.forwardRef((r,e)=>{const{__scopeDialog:t,...i}=r,s=ea(tb,t);return b.jsx(qT,{as:$he,allowPinchZoom:!0,shards:[s.contentRef],children:b.jsx(Ee.div,{"data-state":bO(s.open),...i,ref:e,style:{pointerEvents:"auto",...i.style}})})}),nh="DialogContent",$X=E.forwardRef((r,e)=>{const t=zX(nh,r.__scopeDialog),{forceMount:i=t.forceMount,...s}=r,n=ea(nh,r.__scopeDialog);return b.jsx(Jn,{present:i||n.open,children:n.modal?b.jsx(Ghe,{...s,ref:e}):b.jsx(Whe,{...s,ref:e})})});$X.displayName=nh;var Ghe=E.forwardRef((r,e)=>{const t=ea(nh,r.__scopeDialog),i=E.useRef(null),s=Ze(e,t.contentRef,i);return E.useEffect(()=>{const n=i.current;if(n)return nO(n)},[]),b.jsx(HX,{...r,ref:s,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:le(r.onCloseAutoFocus,n=>{var a;n.preventDefault(),(a=t.triggerRef.current)==null||a.focus()}),onPointerDownOutside:le(r.onPointerDownOutside,n=>{const a=n.detail.originalEvent,o=a.button===0&&a.ctrlKey===!0;(a.button===2||o)&&n.preventDefault()}),onFocusOutside:le(r.onFocusOutside,n=>n.preventDefault())})}),Whe=E.forwardRef((r,e)=>{const t=ea(nh,r.__scopeDialog),i=E.useRef(!1),s=E.useRef(!1);return b.jsx(HX,{...r,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:n=>{var a,o;(a=r.onCloseAutoFocus)==null||a.call(r,n),n.defaultPrevented||(i.current||(o=t.triggerRef.current)==null||o.focus(),n.preventDefault()),i.current=!1,s.current=!1},onInteractOutside:n=>{var l,c;(l=r.onInteractOutside)==null||l.call(r,n),n.defaultPrevented||(i.current=!0,n.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const a=n.target;((c=t.triggerRef.current)==null?void 0:c.contains(a))&&n.preventDefault(),n.detail.originalEvent.type==="focusin"&&s.current&&n.preventDefault()}})}),HX=E.forwardRef((r,e)=>{const{__scopeDialog:t,trapFocus:i,onOpenAutoFocus:s,onCloseAutoFocus:n,...a}=r,o=ea(nh,t),l=E.useRef(null),c=Ze(e,l);return sO(),b.jsxs(b.Fragment,{children:[b.jsx(WT,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:s,onUnmountAutoFocus:n,children:b.jsx(rm,{role:"dialog",id:o.contentId,"aria-describedby":o.descriptionId,"aria-labelledby":o.titleId,"data-state":bO(o.open),...a,ref:c,onDismiss:()=>o.onOpenChange(!1)})}),b.jsxs(b.Fragment,{children:[b.jsx(qhe,{titleId:o.titleId}),b.jsx(Khe,{contentRef:l,descriptionId:o.descriptionId})]})]})}),xO="DialogTitle",GX=E.forwardRef((r,e)=>{const{__scopeDialog:t,...i}=r,s=ea(xO,t);return b.jsx(Ee.h2,{id:s.titleId,...i,ref:e})});GX.displayName=xO;var WX="DialogDescription",XX=E.forwardRef((r,e)=>{const{__scopeDialog:t,...i}=r,s=ea(WX,t);return b.jsx(Ee.p,{id:s.descriptionId,...i,ref:e})});XX.displayName=WX;var qX="DialogClose",Xhe=E.forwardRef((r,e)=>{const{__scopeDialog:t,...i}=r,s=ea(qX,t);return b.jsx(Ee.button,{type:"button",...i,ref:e,onClick:le(r.onClick,()=>s.onOpenChange(!1))})});Xhe.displayName=qX;function bO(r){return r?"open":"closed"}var YX="DialogTitleWarning",[Cit,KX]=pre(YX,{contentName:nh,titleName:xO,docsSlug:"dialog"}),qhe=({titleId:r})=>{const e=KX(YX),t=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return E.useEffect(()=>{r&&(document.getElementById(r)||console.error(t))},[t,r]),null},Yhe="DialogDescriptionWarning",Khe=({contentRef:r,descriptionId:e})=>{const i=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${KX(Yhe).contentName}}.`;return E.useEffect(()=>{var n;const s=(n=r.current)==null?void 0:n.getAttribute("aria-describedby");e&&s&&(document.getElementById(e)||console.warn(i))},[i,r,e]),null},Zhe=FX,Qhe=UX,Jhe=VX,ZX=jX,QX=$X,JX=GX,eq=XX;const wO=Zhe,ede=Qhe,tde=Jhe,tq=E.forwardRef(({className:r,...e},t)=>b.jsx(ZX,{ref:t,className:ye("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...e}));tq.displayName=ZX.displayName;const eE=E.forwardRef(({className:r,children:e,...t},i)=>b.jsxs(tde,{children:[b.jsx(tq,{}),b.jsx(QX,{ref:i,className:ye("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...t,children:e})]}));eE.displayName=QX.displayName;const tE=({className:r,...e})=>b.jsx("div",{className:ye("flex flex-col space-y-1.5 text-center sm:text-left",r),...e});tE.displayName="DialogHeader";const iq=({className:r,...e})=>b.jsx("div",{className:ye("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...e});iq.displayName="DialogFooter";const iE=E.forwardRef(({className:r,...e},t)=>b.jsx(JX,{ref:t,className:ye("text-lg font-semibold leading-none tracking-tight",r),...e}));iE.displayName=JX.displayName;const TO=E.forwardRef(({className:r,...e},t)=>b.jsx(eq,{ref:t,className:ye("text-sm text-muted-foreground",r),...e}));TO.displayName=eq.displayName;const LB=()=>{const r=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),e=navigator.deviceMemory&&navigator.deviceMemory<Do.PERFORMANCE_THRESHOLDS.LOW_MEMORY_GB,t=navigator.connection&&Do.PERFORMANCE_THRESHOLDS.SLOW_CONNECTION_TYPES.includes(navigator.connection.effectiveType);return{isMobile:r,hasLowMemory:e,hasSlowConnection:t,performanceMode:r||e||t}},rq=({isVegetarian:r,isVegan:e,isGlutenFree:t,isNutFree:i,variant:s="compact"})=>{const a=(()=>{const o=[];return r&&o.push({icon:VF,label:"Vegetarian",color:"text-green-600"}),e&&o.push({icon:VF,label:"Vegan",color:"text-green-700"}),t&&o.push({icon:Mse,label:"Gluten Free",color:"text-amber-600"}),i&&o.push({icon:yse,label:"Nut Free",color:"text-orange-600"}),o})();return a.length===0?null:s==="compact"?b.jsx("div",{className:"flex flex-wrap gap-1",role:"list","aria-label":"Dietary information",children:a.map((o,l)=>{const c=o.icon;return b.jsxs("div",{className:`flex items-center ${o.color}`,role:"listitem",title:o.label,children:[b.jsx(c,{className:"w-3 h-3 mr-1","aria-hidden":"true"}),b.jsx("span",{className:"text-xs",children:o.label})]},l)})}):b.jsx("div",{className:"flex flex-wrap gap-2",role:"list","aria-label":"Dietary information",children:a.map((o,l)=>{const c=o.icon;return b.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg bg-muted ${o.color}`,role:"listitem",children:[b.jsx(c,{className:"w-4 h-4","aria-hidden":"true"}),b.jsx("span",{className:"font-medium",children:o.label})]},l)})})},ide="GpuTimings",sq="2.9.0",rde="80e0289";function ib(r,e){for(const t in e){const i=e[t];Array.isArray(i)?r[t]=ib([],i):i&&typeof i=="object"?r[t]=ib({},i):r[t]=i}return r}const sde={create(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)})}},Ne={delimiter:"/",join(...r){let e=r[0];for(let t=0;t<r.length-1;t++){const i=r[t],s=r[t+1];if(s[0]===Ne.delimiter){e=s;continue}i&&s&&i[i.length-1]!==Ne.delimiter&&s[0]!==Ne.delimiter?e+=Ne.delimiter+s:e+=s}return e},normalize(r){const e=r.startsWith(Ne.delimiter),t=r.endsWith(Ne.delimiter),i=r.split("/");let s="",n=[];for(let a=0;a<i.length;a++)if(i[a]!==""&&i[a]!=="."){if(i[a]===".."&&n.length>0){n=n.slice(0,n.length-2);continue}a>0&&n.push(Ne.delimiter),n.push(i[a])}return s=n.join(""),!e&&s[0]===Ne.delimiter&&(s=s.slice(1)),t&&s[s.length-1]!==Ne.delimiter&&(s+=Ne.delimiter),s},split(r){const e=r.lastIndexOf(Ne.delimiter);return e!==-1?[r.substring(0,e),r.substring(e+1)]:["",r]},getBasename(r){return Ne.split(r)[1]},getDirectory(r){return Ne.split(r)[0]},getExtension(r){const e=r.split("?")[0].split(".").pop();return e!==r?`.${e}`:""},isRelativePath(r){return r.charAt(0)!=="/"&&r.match(/:\/\//)===null},extractPath(r){let e="";const t=r.split("/");let i=0;if(t.length>1)if(Ne.isRelativePath(r))if(t[0]===".")for(i=0;i<t.length-1;++i)e+=i===0?t[i]:`/${t[i]}`;else if(t[0]==="..")for(i=0;i<t.length-1;++i)e+=i===0?t[i]:`/${t[i]}`;else for(e=".",i=0;i<t.length-1;++i)e+=`/${t[i]}`;else for(i=0;i<t.length-1;++i)e+=i===0?t[i]:`/${t[i]}`;return e}},nde=()=>{let r=!1;try{const e=Object.defineProperty({},"passive",{get:function(){return r=!0,!1}});window.addEventListener("testpassive",null,e),window.removeEventListener("testpassive",null,e)}catch{}return r},Ao=typeof navigator<"u"?navigator.userAgent:"",Hg=typeof window<"u"?"browser":typeof global<"u"?"node":"worker",OB=/android/i.test(Ao)?"android":/ip(?:[ao]d|hone)/i.test(Ao)?"ios":/windows/i.test(Ao)?"windows":/mac os/i.test(Ao)?"osx":/linux/i.test(Ao)?"linux":/cros/i.test(Ao)?"cros":null,ade=Hg!=="browser"?null:/Chrome\/|Chromium\/|Edg.*\//.test(Ao)?"chrome":/Safari\//.test(Ao)?"safari":/Firefox\//.test(Ao)?"firefox":"other",ode=Hg==="browser"&&("ontouchstart"in window||"maxTouchPoints"in navigator&&navigator.maxTouchPoints>0),lde=nde(),Ye={name:OB,environment:Hg,browser:Hg==="browser",worker:Hg==="worker",android:OB==="android",touch:ode,passiveEvents:lde,browserName:ade},nq="abcdefghijklmnopqrstuvwxyz",aq="ABCDEFGHIJKLMNOPQRSTUVWXYZ",cde=nq+aq,eM=55296,oq=56319,NB=56320,ude=57343,hde=8205,kB=127462,FB=127487,dde=127995,fde=127999,pde=8400,mde=8447,tM=65024,iM=65039;function rM(r,e=0){const t=r.length;if(e<0||e>=t)return null;const i=r.charCodeAt(e);if(t>1&&i>=eM&&i<=oq){const s=r.charCodeAt(e+1);if(s>=NB&&s<=ude)return{code:(i-eM)*1024+s-NB+65536,long:!0}}return{code:i,long:!1}}function Pl(r,e,t){if(!r)return!1;const i=rM(r);if(i){const s=i.code;return s>=e&&s<=t}return!1}function gde(r,e){if(e===r.length-1)return 1;if(Pl(r[e],eM,oq)){const t=r.substring(e,e+2),i=r.substring(e+2,e+4);return Pl(i,dde,fde)||Pl(t,kB,FB)&&Pl(i,kB,FB)?4:Pl(i,tM,iM)?3:2}return Pl(r[e+1],tM,iM)?2:1}const ix={ASCII_LOWERCASE:nq,ASCII_UPPERCASE:aq,ASCII_LETTERS:cde,format(r,...e){for(let t=0;t<e.length;t++)r=r.replace(`{${t}}`,e[t]);return r},getCodePoint(r,e){const t=rM(r,e);return t&&t.code},getCodePoints(r){if(typeof r!="string")throw new TypeError("Not a string");let e=0;const t=[];let i;for(;i=rM(r,e);)t.push(i.code),e+=i.long?2:1;return t},getSymbols(r){if(typeof r!="string")throw new TypeError("Not a string");let e=0;const t=r.length,i=[];let s=0,n;for(;e<t;){if(s+=gde(r,e+s),n=r[e+s],Pl(n,pde,mde)&&(n=r[e+s++]),Pl(n,tM,iM)&&(n=r[e+s++]),n&&n.charCodeAt(0)===hde){n=r[e+s++];continue}const a=r.substring(e,e+s);i.push(a),e+=s,s=0}return i},fromCodePoint(...r){return r.map(e=>e>65535?(e-=65536,String.fromCharCode((e>>10)+55296,e%1024+56320)):String.fromCharCode(e)).join("")}};class _de{constructor(e,t,i,s,n=!1){this._removed=!1,this.handler=e,this.name=t,this.callback=i,this.scope=s,this._once=n}off(){this._removed||this.handler.offByHandle(this)}on(e,t,i=this){return this.handler._addCallback(e,t,i,!1)}once(e,t,i=this){return this.handler._addCallback(e,t,i,!0)}set removed(e){e&&(this._removed=!0)}get removed(){return this._removed}toJSON(e){}}class Te{initEventHandler(){this._callbacks=new Map,this._callbackActive=new Map}_addCallback(e,t,i,s){if(this._callbacks.has(e)||this._callbacks.set(e,[]),this._callbackActive.has(e)){const a=this._callbackActive.get(e);a&&a===this._callbacks.get(e)&&this._callbackActive.set(e,a.slice())}const n=new _de(this,e,t,i,s);return this._callbacks.get(e).push(n),n}on(e,t,i=this){return this._addCallback(e,t,i,!1)}once(e,t,i=this){return this._addCallback(e,t,i,!0)}off(e,t,i){if(e)this._callbackActive.has(e)&&this._callbackActive.get(e)===this._callbacks.get(e)&&this._callbackActive.set(e,this._callbackActive.get(e).slice());else for(const[s,n]of this._callbackActive)this._callbacks.has(s)&&this._callbacks.get(s)===n&&this._callbackActive.set(s,n.slice());if(e)if(t){const s=this._callbacks.get(e);if(!s)return this;for(let n=0;n<s.length;n++)s[n].callback===t&&(i&&s[n].scope!==i||(s[n].removed=!0,s.splice(n,1),n--));s.length===0&&this._callbacks.delete(e)}else{const s=this._callbacks.get(e);if(s){for(let n=0;n<s.length;n++)s[n].removed=!0;this._callbacks.delete(e)}}else{for(const s of this._callbacks.values())for(let n=0;n<s.length;n++)s[n].removed=!0;this._callbacks.clear()}return this}offByHandle(e){const t=e.name;e.removed=!0,this._callbackActive.has(t)&&this._callbackActive.get(t)===this._callbacks.get(t)&&this._callbackActive.set(t,this._callbackActive.get(t).slice());const i=this._callbacks.get(t);if(!i)return this;const s=i.indexOf(e);return s!==-1&&(i.splice(s,1),i.length===0&&this._callbacks.delete(t)),this}fire(e,t,i,s,n,a,o,l,c){if(!e)return this;const u=this._callbacks.get(e);if(!u)return this;let h;this._callbackActive.has(e)?this._callbackActive.get(e)!==u&&(h=u.slice()):this._callbackActive.set(e,u);for(let d=0;(h||this._callbackActive.get(e))&&d<(h||this._callbackActive.get(e)).length;d++){const f=(h||this._callbackActive.get(e))[d];if(f.callback&&(f.callback.call(f.scope,t,i,s,n,a,o,l,c),f._once)){const p=this._callbacks.get(e),m=p?p.indexOf(f):-1;if(m!==-1){this._callbackActive.get(e)===p&&this._callbackActive.set(e,this._callbackActive.get(e).slice());const g=this._callbacks.get(e);if(!g)continue;g[m].removed=!0,g.splice(m,1),g.length===0&&this._callbacks.delete(e)}}}return h||this._callbackActive.delete(e),this}hasEvent(e){var t;return!!((t=this._callbacks.get(e))!=null&&t.length)}constructor(){this._callbacks=new Map,this._callbackActive=new Map}}class vde{push(e,t){if(this._index[e])throw Error(`Key already in index ${e}`);const i=this._list.push(t)-1;this._index[e]=i}has(e){return this._index[e]!==void 0}get(e){const t=this._index[e];return t!==void 0?this._list[t]:null}remove(e){const t=this._index[e];if(t!==void 0){this._list.splice(t,1),delete this._index[e];for(e in this._index){const i=this._index[e];i>t&&(this._index[e]=i-1)}return!0}return!1}list(){return this._list}clear(){this._list.length=0;for(const e in this._index)delete this._index[e]}constructor(){this._list=[],this._index={}}}const yde=r=>{const e={};let t=e;return()=>(t===e&&(t=r()),t)},ca=class ca{static loadScript(e,t){const i=document.createElement("script");i.setAttribute("src",e),i.onload=()=>{t(null)},i.onerror=()=>{t(`Failed to load script='${e}'`)},document.body.appendChild(i)}static loadWasm(e,t,i){const s=ca.wasmSupported()&&t.glueUrl&&t.wasmUrl?t.glueUrl:t.fallbackUrl;s?ca.loadScript(s,n=>{if(n)i(n,null);else{const a=window[e];window[e]=void 0,a({locateFile:()=>t.wasmUrl,onAbort:()=>{i("wasm module aborted.")}}).then(o=>{i(null,o)})}}):i("No supported wasm modules found.",null)}static getModule(e){return ca.modules.hasOwnProperty(e)||(ca.modules[e]={config:null,initializing:!1,instance:null,callbacks:[]}),ca.modules[e]}static initialize(e,t){if(t.initializing)return;const i=t.config;(i.glueUrl||i.wasmUrl||i.fallbackUrl)&&(t.initializing=!0,ca.loadWasm(e,i,(s,n)=>{s?i.errorHandler?i.errorHandler(s):console.error(`failed to initialize module=${e} error=${s}`):(t.instance=n,t.callbacks.forEach(a=>{a(n)}))}))}};ca.modules={},ca.wasmSupported=yde(()=>{try{if(typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function"){const e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof WebAssembly.Module)return new WebAssembly.Instance(e)instanceof WebAssembly.Instance}}catch{}return!1});let hu=ca;class lq{static setConfig(e,t){const i=hu.getModule(e);i.config=t,i.callbacks.length>0&&hu.initialize(e,i)}static getConfig(e){var t,i;return(i=(t=hu.modules)==null?void 0:t[e])==null?void 0:i.config}static getInstance(e,t){const i=hu.getModule(e);i.instance?t(i.instance):(i.callbacks.push(t),i.config&&hu.initialize(e,i))}}class cq{constructor(e){this.offset=0,this.arraybuffer=e,this.dataView=new DataView(e)}get remainingBytes(){return this.dataView.byteLength-this.offset}reset(e=0){this.offset=e}skip(e){this.offset+=e}align(e){this.offset=this.offset+e-1&~(e-1)}_inc(e){return this.offset+=e,this.offset-e}readChar(){return String.fromCharCode(this.dataView.getUint8(this.offset++))}readChars(e){let t="";for(let i=0;i<e;++i)t+=this.readChar();return t}readU8(){return this.dataView.getUint8(this.offset++)}readU16(){return this.dataView.getUint16(this._inc(2),!0)}readU32(){return this.dataView.getUint32(this._inc(4),!0)}readU64(){return this.readU32()+2**32*this.readU32()}readU32be(){return this.dataView.getUint32(this._inc(4),!1)}readArray(e){for(let t=0;t<e.length;++t)e[t]=this.readU8()}readLine(){const e=this.dataView;let t="";for(;!(this.offset>=e.byteLength);){const i=String.fromCharCode(this.readU8());if(i===`
`)break;t+=i}return t}}class rb{constructor(e){this.items=[],this.length=0,this.loopIndex=-1,this._sortBy=e.sortBy,this._sortHandler=this._doSort.bind(this)}_binarySearch(e){let t=0,i=this.items.length-1;const s=e[this._sortBy];let n,a;for(;t<=i;)n=Math.floor((t+i)/2),a=this.items[n][this._sortBy],a<=s?t=n+1:a>s&&(i=n-1);return t}_doSort(e,t){const i=this._sortBy;return e[i]-t[i]}insert(e){const t=this._binarySearch(e);this.items.splice(t,0,e),this.length++,this.loopIndex>=t&&this.loopIndex++}append(e){this.items.push(e),this.length++}remove(e){const t=this.items.indexOf(e);t<0||(this.items.splice(t,1),this.length--,this.loopIndex>=t&&this.loopIndex--)}sort(){const e=this.loopIndex>=0?this.items[this.loopIndex]:null;this.items.sort(this._sortHandler),e!==null&&(this.loopIndex=this.items.indexOf(e))}}const v_=class v_ extends Te{constructor(e){super(),this._index={},this._list=[],this._parent=e}add(...e){let t=!1;const i=this._processArguments(e,!0);if(!i.length)return t;for(let s=0;s<i.length;s++)this._index[i[s]]||(t=!0,this._index[i[s]]=!0,this._list.push(i[s]),this.fire("add",i[s],this._parent));return t&&this.fire("change",this._parent),t}remove(...e){let t=!1;if(!this._list.length)return t;const i=this._processArguments(e,!0);if(!i.length)return t;for(let s=0;s<i.length;s++)this._index[i[s]]&&(t=!0,delete this._index[i[s]],this._list.splice(this._list.indexOf(i[s]),1),this.fire("remove",i[s],this._parent));return t&&this.fire("change",this._parent),t}clear(){if(!this._list.length)return;const e=this._list.slice(0);this._list=[],this._index={};for(let t=0;t<e.length;t++)this.fire("remove",e[t],this._parent);this.fire("change",this._parent)}has(...e){return this._list.length?this._has(this._processArguments(e)):!1}_has(e){if(!this._list.length||!e.length)return!1;for(let t=0;t<e.length;t++)if(e[t].length===1){if(this._index[e[t][0]])return!0}else{let i=!0;for(let s=0;s<e[t].length;s++)if(!this._index[e[t][s]]){i=!1;break}if(i)return!0}return!1}list(){return this._list.slice(0)}_processArguments(e,t){const i=[];let s=[];if(!e||!e.length)return i;for(let n=0;n<e.length;n++)if(e[n]instanceof Array){t||(s=[]);for(let a=0;a<e[n].length;a++)typeof e[n][a]=="string"&&(t?i.push(e[n][a]):s.push(e[n][a]));!t&&s.length&&i.push(s)}else typeof e[n]=="string"&&(t?i.push(e[n]):i.push([e[n]]));return i}get size(){return this._list.length}};v_.EVENT_ADD="add",v_.EVENT_REMOVE="remove",v_.EVENT_CHANGE="change";let sb=v_;const Qo=typeof window<"u"&&window.performance&&window.performance.now?performance.now.bind(performance):Date.now,Sde=/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/;class Q1{constructor(e){const t=e.match(Sde);this.scheme=t[2],this.authority=t[4],this.path=t[5],this.query=t[7],this.fragment=t[9]}toString(){let e="";return this.scheme&&(e+=`${this.scheme}:`),this.authority&&(e+=`//${this.authority}`),e+=this.path,this.query&&(e+=`?${this.query}`),this.fragment&&(e+=`#${this.fragment}`),e}getQuery(){const e={};if(this.query){const t=decodeURIComponent(this.query).split("&");for(const i of t){const s=i.split("=");e[s[0]]=s[1]}}return e}setQuery(e){let t="";for(const i in e)e.hasOwnProperty(i)&&(t!==""&&(t+="&"),t+=`${encodeURIComponent(i)}=${encodeURIComponent(e[i])}`);this.query=t}}const y_=class y_{static set(e,t=!0){}static get(e){return y_._traceChannels.has(e)}};y_._traceChannels=new Set,y_.stack=!1;let sM=y_;const xde=0,EO=1,BB=4,bde=5,Q={DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,clamp(r,e,t){return r>=t?t:r<=e?e:r},intToBytes24(r){const e=r>>16&255,t=r>>8&255,i=r&255;return[e,t,i]},intToBytes32(r){const e=r>>24&255,t=r>>16&255,i=r>>8&255,s=r&255;return[e,t,i,s]},bytesToInt24(r,e,t){return r.length&&(t=r[2],e=r[1],r=r[0]),r<<16|e<<8|t},bytesToInt32(r,e,t,i){return r.length&&(i=r[3],t=r[2],e=r[1],r=r[0]),(r<<24|e<<16|t<<8|i)>>>0},lerp(r,e,t){return r+(e-r)*Q.clamp(t,0,1)},lerpAngle(r,e,t){return e-r>180&&(e-=360),e-r<-180&&(e+=360),Q.lerp(r,e,Q.clamp(t,0,1))},powerOfTwo(r){return r!==0&&!(r&r-1)},nextPowerOfTwo(r){return r--,r|=r>>1,r|=r>>2,r|=r>>4,r|=r>>8,r|=r>>16,r++,r},nearestPowerOfTwo(r){return Math.pow(2,Math.round(Math.log2(r)))},random(r,e){const t=e-r;return Math.random()*t+r},smoothstep(r,e,t){return t<=r?0:t>=e?1:(t=(t-r)/(e-r),t*t*(3-2*t))},smootherstep(r,e,t){return t<=r?0:t>=e?1:(t=(t-r)/(e-r),t*t*t*(t*(t*6-15)+10))},roundUp(r,e){return e===0?r:Math.ceil(r/e)*e},between(r,e,t,i){const s=Math.min(e,t),n=Math.max(e,t);return i?r>=s&&r<=n:r>s&&r<n}};var Jt;let ae=(Jt=class{constructor(e=0,t=0,i=0,s=1){const n=e.length;n===3||n===4?(this.r=e[0],this.g=e[1],this.b=e[2],this.a=e[3]??1):(this.r=e,this.g=t,this.b=i,this.a=s)}clone(){const e=this.constructor;return new e(this.r,this.g,this.b,this.a)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this}equals(e){return this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}set(e,t,i,s=1){return this.r=e,this.g=t,this.b=i,this.a=s,this}lerp(e,t,i){return this.r=e.r+i*(t.r-e.r),this.g=e.g+i*(t.g-e.g),this.b=e.b+i*(t.b-e.b),this.a=e.a+i*(t.a-e.a),this}linear(e=this){return this.r=Math.pow(e.r,2.2),this.g=Math.pow(e.g,2.2),this.b=Math.pow(e.b,2.2),this.a=e.a,this}gamma(e=this){return this.r=Math.pow(e.r,1/2.2),this.g=Math.pow(e.g,1/2.2),this.b=Math.pow(e.b,1/2.2),this.a=e.a,this}mulScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}fromString(e){const t=parseInt(e.replace("#","0x"),16);let i;return e.length>7?i=Q.intToBytes32(t):(i=Q.intToBytes24(t),i[3]=255),this.set(i[0]/255,i[1]/255,i[2]/255,i[3]/255),this}fromArray(e,t=0){return this.r=e[t]??this.r,this.g=e[t+1]??this.g,this.b=e[t+2]??this.b,this.a=e[t+3]??this.a,this}toString(e,t){const{r:i,g:s,b:n,a}=this;if(t||i>1||s>1||n>1)return`${i.toFixed(3)}, ${s.toFixed(3)}, ${n.toFixed(3)}, ${a.toFixed(3)}`;let o=`#${((1<<24)+(Math.round(i*255)<<16)+(Math.round(s*255)<<8)+Math.round(n*255)).toString(16).slice(1)}`;if(e===!0){const l=Math.round(a*255).toString(16);this.a<16/255?o+=`0${l}`:o+=l}return o}toArray(e=[],t=0,i=!0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,i&&(e[t+3]=this.a),e}},Jt.BLACK=Object.freeze(new Jt(0,0,0,1)),Jt.BLUE=Object.freeze(new Jt(0,0,1,1)),Jt.CYAN=Object.freeze(new Jt(0,1,1,1)),Jt.GRAY=Object.freeze(new Jt(.5,.5,.5,1)),Jt.GREEN=Object.freeze(new Jt(0,1,0,1)),Jt.MAGENTA=Object.freeze(new Jt(1,0,1,1)),Jt.RED=Object.freeze(new Jt(1,0,0,1)),Jt.WHITE=Object.freeze(new Jt(1,1,1,1)),Jt.YELLOW=Object.freeze(new Jt(1,1,0,1)),Jt);class uq{constructor(e,t=0){this._left=-1/0,this._right=1/0,this._recip=0,this._p0=0,this._p1=0,this._m0=0,this._m1=0,this._curve=e,this._reset(t)}evaluate(e,t=!1){(t||e<this._left||e>=this._right)&&this._reset(e);let i;const s=this._curve.type;if(s===bde)i=this._p0;else{const n=this._recip===0?0:(e-this._left)*this._recip;s===xde?i=Q.lerp(this._p0,this._p1,n):s===EO?i=Q.lerp(this._p0,this._p1,n*n*(3-2*n)):i=this._evaluateHermite(this._p0,this._p1,this._m0,this._m1,n)}return i}_reset(e){const t=this._curve.keys,i=t.length;if(!i)this._left=-1/0,this._right=1/0,this._recip=0,this._p0=this._p1=this._m0=this._m1=0;else if(e<t[0][0])this._left=-1/0,this._right=t[0][0],this._recip=0,this._p0=this._p1=t[0][1],this._m0=this._m1=0;else if(e>=t[i-1][0])this._left=t[i-1][0],this._right=1/0,this._recip=0,this._p0=this._p1=t[i-1][1],this._m0=this._m1=0;else{let s=0;for(;e>=t[s+1][0];)s++;this._left=t[s][0],this._right=t[s+1][0];const n=1/(this._right-this._left);this._recip=isFinite(n)?n:0,this._p0=t[s][1],this._p1=t[s+1][1],this._curve.type===BB&&this._calcTangents(t,s)}}_calcTangents(e,t){let i;const s=e[t],n=e[t+1];let a;if(t===0?i=[e[0][0]+(e[0][0]-e[1][0]),e[0][1]+(e[0][1]-e[1][1])]:i=e[t-1],t===e.length-2?a=[e[t+1][0]+(e[t+1][0]-e[t][0]),e[t+1][1]+(e[t+1][1]-e[t][1])]:a=e[t+2],this._curve.type===BB){const o=2*(n[0]-s[0])/(n[0]-i[0]),l=2*(n[0]-s[0])/(a[0]-s[0]);this._m0=this._curve.tension*(isFinite(o)?o:0)*(n[1]-i[1]),this._m1=this._curve.tension*(isFinite(l)?l:0)*(a[1]-s[1])}else{const o=(n[0]-s[0])/(s[0]-i[0]),l=(n[0]-s[0])/(a[0]-n[0]),c=s[1]+(i[1]-s[1])*(isFinite(o)?o:0),u=n[1]+(a[1]-n[1])*(isFinite(l)?l:0),h=this._curve.tension;this._m0=h*(n[1]-c),this._m1=h*(u-s[1])}}_evaluateHermite(e,t,i,s,n){const a=n*n,o=n+n,l=1-n,c=l*l;return e*((1+o)*c)+i*(n*c)+t*(a*(3-o))+s*(a*(n-1))}}let jn=class{constructor(e){if(this.keys=[],this.type=EO,this.tension=.5,this._eval=new uq(this),e)for(let t=0;t<e.length-1;t+=2)this.keys.push([e[t],e[t+1]]);this.sort()}get length(){return this.keys.length}add(e,t){const i=this.keys,s=i.length;let n=0;for(;n<s&&!(i[n][0]>e);n++);const a=[e,t];return this.keys.splice(n,0,a),a}get(e){return this.keys[e]}sort(){this.keys.sort((e,t)=>e[0]-t[0])}value(e){return this._eval.evaluate(e,!0)}closest(e){const t=this.keys,i=t.length;let s=2,n=null;for(let a=0;a<i;a++){const o=Math.abs(e-t[a][0]);if(s>=o)s=o,n=t[a];else break}return n}clone(){const e=new this.constructor;return e.keys=this.keys.map(t=>[...t]),e.type=this.type,e.tension=this.tension,e}quantize(e){e=Math.max(e,2);const t=new Float32Array(e),i=1/(e-1);t[0]=this._eval.evaluate(0,!0);for(let s=1;s<e;s++)t[s]=this._eval.evaluate(i*s);return t}quantizeClamped(e,t,i){const s=this.quantize(e);for(let n=0;n<s.length;++n)s[n]=Math.min(i,Math.max(t,s[n]));return s}};class Uu{constructor(...e){if(this.curves=[],this._type=EO,e.length>1)for(let t=0;t<e.length;t++)this.curves.push(new jn(e[t]));else if(e.length===0)this.curves.push(new jn);else{const t=e[0];if(typeof t=="number")for(let i=0;i<t;i++)this.curves.push(new jn);else for(let i=0;i<t.length;i++)this.curves.push(new jn(t[i]))}}get length(){return this.curves.length}set type(e){this._type=e;for(let t=0;t<this.curves.length;t++)this.curves[t].type=e}get type(){return this._type}get(e){return this.curves[e]}value(e,t=[]){const i=this.curves.length;t.length=i;for(let s=0;s<i;s++)t[s]=this.curves[s].value(e);return t}clone(){const e=new this.constructor;e.curves=[];for(let t=0;t<this.curves.length;t++)e.curves.push(this.curves[t].clone());return e._type=this._type,e}quantize(e){e=Math.max(e,2);const t=this.curves.length,i=new Float32Array(e*t),s=1/(e-1);for(let n=0;n<t;n++){const a=new uq(this.curves[n]);for(let o=0;o<e;o++)i[o*t+n]=a.evaluate(s*o)}return i}quantizeClamped(e,t,i){const s=this.quantize(e);for(let n=0;n<s.length;++n)s[n]=Math.min(i,Math.max(t,s[n]));return s}}const nM=new Float32Array(1),UB=new Int32Array(nM.buffer);class ah{static float2Half(e){nM[0]=e;const t=UB[0];let i=t>>16&32768,s=t>>12&2047;const n=t>>23&255;return n<103?i:n>142?(i|=31744,i|=(n===255?0:1)&&t&8388607,i):n<113?(s|=2048,i|=(s>>114-n)+(s>>113-n&1),i):(i|=n-112<<10|s>>1,i+=s&1,i)}static float2RGBA8(e,t){nM[0]=e;const i=UB[0];t.r=(i>>24&255)/255,t.g=(i>>16&255)/255,t.b=(i>>8&255)/255,t.a=(i&255)/255}}const Si=class Si{constructor(e=0,t=0,i=0){e.length===3?(this.x=e[0],this.y=e[1],this.z=e[2]):(this.x=e,this.y=t,this.z=i)}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}add2(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addScaled(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}clone(){const e=this.constructor;return new e(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}cross(e,t){const i=e.x,s=e.y,n=e.z,a=t.x,o=t.y,l=t.z;return this.x=s*l-o*n,this.y=n*a-l*i,this.z=i*o-a*s,this}distance(e){const t=this.x-e.x,i=this.y-e.y,s=this.z-e.z;return Math.sqrt(t*t+i*i+s*s)}div(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}div2(e,t){return this.x=e.x/t.x,this.y=e.y/t.y,this.z=e.z/t.z,this}divScalar(e){return this.x/=e,this.y/=e,this.z/=e,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z}equalsApprox(e,t=1e-6){return Math.abs(this.x-e.x)<t&&Math.abs(this.y-e.y)<t&&Math.abs(this.z-e.z)<t}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}lerp(e,t,i){return this.x=e.x+i*(t.x-e.x),this.y=e.y+i*(t.y-e.y),this.z=e.z+i*(t.z-e.z),this}mul(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}mul2(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}mulScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}normalize(e=this){const t=e.x*e.x+e.y*e.y+e.z*e.z;if(t>0){const i=1/Math.sqrt(t);this.x=e.x*i,this.y=e.y*i,this.z=e.z*i}return this}floor(e=this){return this.x=Math.floor(e.x),this.y=Math.floor(e.y),this.z=Math.floor(e.z),this}ceil(e=this){return this.x=Math.ceil(e.x),this.y=Math.ceil(e.y),this.z=Math.ceil(e.z),this}round(e=this){return this.x=Math.round(e.x),this.y=Math.round(e.y),this.z=Math.round(e.z),this}min(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),this}max(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),this}project(e){const t=this.x*e.x+this.y*e.y+this.z*e.z,i=e.x*e.x+e.y*e.y+e.z*e.z,s=t/i;return this.x=e.x*s,this.y=e.y*s,this.z=e.z*s,this}set(e,t,i){return this.x=e,this.y=t,this.z=i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}sub2(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}fromArray(e,t=0){return this.x=e[t]??this.x,this.y=e[t+1]??this.y,this.z=e[t+2]??this.z,this}toString(){return`[${this.x}, ${this.y}, ${this.z}]`}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}};Si.ZERO=Object.freeze(new Si(0,0,0)),Si.HALF=Object.freeze(new Si(.5,.5,.5)),Si.ONE=Object.freeze(new Si(1,1,1)),Si.UP=Object.freeze(new Si(0,1,0)),Si.DOWN=Object.freeze(new Si(0,-1,0)),Si.RIGHT=Object.freeze(new Si(1,0,0)),Si.LEFT=Object.freeze(new Si(-1,0,0)),Si.FORWARD=Object.freeze(new Si(0,0,-1)),Si.BACK=Object.freeze(new Si(0,0,1));let O=Si;const sf=class sf{constructor(){this.data=new Float32Array(9),this.data[0]=this.data[4]=this.data[8]=1}clone(){const e=this.constructor;return new e().copy(this)}copy(e){const t=e.data,i=this.data;return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],this}set(e){const t=this.data;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],this}getX(e=new O){return e.set(this.data[0],this.data[1],this.data[2])}getY(e=new O){return e.set(this.data[3],this.data[4],this.data[5])}getZ(e=new O){return e.set(this.data[6],this.data[7],this.data[8])}equals(e){const t=this.data,i=e.data;return t[0]===i[0]&&t[1]===i[1]&&t[2]===i[2]&&t[3]===i[3]&&t[4]===i[4]&&t[5]===i[5]&&t[6]===i[6]&&t[7]===i[7]&&t[8]===i[8]}isIdentity(){const e=this.data;return e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===1&&e[5]===0&&e[6]===0&&e[7]===0&&e[8]===1}setIdentity(){const e=this.data;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,this}toString(){return`[${this.data.join(", ")}]`}transpose(e=this){const t=e.data,i=this.data;if(t===i){let s;s=t[1],i[1]=t[3],i[3]=s,s=t[2],i[2]=t[6],i[6]=s,s=t[5],i[5]=t[7],i[7]=s}else i[0]=t[0],i[1]=t[3],i[2]=t[6],i[3]=t[1],i[4]=t[4],i[5]=t[7],i[6]=t[2],i[7]=t[5],i[8]=t[8];return this}setFromMat4(e){const t=e.data,i=this.data;return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[4],i[4]=t[5],i[5]=t[6],i[6]=t[8],i[7]=t[9],i[8]=t[10],this}setFromQuat(e){const t=e.x,i=e.y,s=e.z,n=e.w,a=t+t,o=i+i,l=s+s,c=t*a,u=t*o,h=t*l,d=i*o,f=i*l,p=s*l,m=n*a,g=n*o,_=n*l,v=this.data;return v[0]=1-(d+p),v[1]=u+_,v[2]=h-g,v[3]=u-_,v[4]=1-(c+p),v[5]=f+m,v[6]=h+g,v[7]=f-m,v[8]=1-(c+d),this}invertMat4(e){const t=e.data,i=t[0],s=t[1],n=t[2],a=t[4],o=t[5],l=t[6],c=t[8],u=t[9],h=t[10],d=h*o-l*u,f=-h*s+n*u,p=l*s-n*o,m=-h*a+l*c,g=h*i-n*c,_=-l*i+n*a,v=u*a-o*c,y=-u*i+s*c,x=o*i-s*a,S=i*d+s*m+n*v;if(S===0)this.setIdentity();else{const w=1/S,T=this.data;T[0]=d*w,T[1]=f*w,T[2]=p*w,T[3]=m*w,T[4]=g*w,T[5]=_*w,T[6]=v*w,T[7]=y*w,T[8]=x*w}return this}transformVector(e,t=new O){const i=this.data,{x:s,y:n,z:a}=e;return t.x=s*i[0]+n*i[3]+a*i[6],t.y=s*i[1]+n*i[4]+a*i[7],t.z=s*i[2]+n*i[5]+a*i[8],t}};sf.IDENTITY=Object.freeze(new sf),sf.ZERO=Object.freeze(new sf().set([0,0,0,0,0,0,0,0,0]));let Ba=sf;const mr=class mr{constructor(e=0,t=0){e.length===2?(this.x=e[0],this.y=e[1]):(this.x=e,this.y=t)}add(e){return this.x+=e.x,this.y+=e.y,this}add2(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addScaled(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}clone(){const e=this.constructor;return new e(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}cross(e){return this.x*e.y-this.y*e.x}distance(e){const t=this.x-e.x,i=this.y-e.y;return Math.sqrt(t*t+i*i)}div(e){return this.x/=e.x,this.y/=e.y,this}div2(e,t){return this.x=e.x/t.x,this.y=e.y/t.y,this}divScalar(e){return this.x/=e,this.y/=e,this}dot(e){return this.x*e.x+this.y*e.y}equals(e){return this.x===e.x&&this.y===e.y}equalsApprox(e,t=1e-6){return Math.abs(this.x-e.x)<t&&Math.abs(this.y-e.y)<t}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSq(){return this.x*this.x+this.y*this.y}lerp(e,t,i){return this.x=e.x+i*(t.x-e.x),this.y=e.y+i*(t.y-e.y),this}mul(e){return this.x*=e.x,this.y*=e.y,this}mul2(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this}mulScalar(e){return this.x*=e,this.y*=e,this}normalize(e=this){const t=e.x*e.x+e.y*e.y;if(t>0){const i=1/Math.sqrt(t);this.x=e.x*i,this.y=e.y*i}return this}rotate(e){const t=Math.atan2(this.x,this.y)+e*Q.DEG_TO_RAD,i=Math.sqrt(this.x*this.x+this.y*this.y);return this.x=Math.sin(t)*i,this.y=Math.cos(t)*i,this}angle(){return Math.atan2(this.x,this.y)*Q.RAD_TO_DEG}angleTo(e){return Math.atan2(this.x*e.y+this.y*e.x,this.x*e.x+this.y*e.y)*Q.RAD_TO_DEG}floor(e=this){return this.x=Math.floor(e.x),this.y=Math.floor(e.y),this}ceil(e=this){return this.x=Math.ceil(e.x),this.y=Math.ceil(e.y),this}round(e=this){return this.x=Math.round(e.x),this.y=Math.round(e.y),this}min(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),this}max(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),this}set(e,t){return this.x=e,this.y=t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}sub2(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}subScalar(e){return this.x-=e,this.y-=e,this}fromArray(e,t=0){return this.x=e[t]??this.x,this.y=e[t+1]??this.y,this}toString(){return`[${this.x}, ${this.y}]`}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}static angleRad(e,t){return Math.atan2(e.x*t.y-e.y*t.x,e.x*t.x+e.y*t.y)}};mr.ZERO=Object.freeze(new mr(0,0)),mr.HALF=Object.freeze(new mr(.5,.5)),mr.ONE=Object.freeze(new mr(1,1)),mr.UP=Object.freeze(new mr(0,1)),mr.DOWN=Object.freeze(new mr(0,-1)),mr.RIGHT=Object.freeze(new mr(1,0)),mr.LEFT=Object.freeze(new mr(-1,0));let ee=mr;const Ll=class Ll{constructor(e=0,t=0,i=0,s=0){e.length===4?(this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3]):(this.x=e,this.y=t,this.z=i,this.w=s)}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}add2(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addScaled(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}clone(){const e=this.constructor;return new e(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}div(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}div2(e,t){return this.x=e.x/t.x,this.y=e.y/t.y,this.z=e.z/t.z,this.w=e.w/t.w,this}divScalar(e){return this.x/=e,this.y/=e,this.z/=e,this.w/=e,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w}equalsApprox(e,t=1e-6){return Math.abs(this.x-e.x)<t&&Math.abs(this.y-e.y)<t&&Math.abs(this.z-e.z)<t&&Math.abs(this.w-e.w)<t}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}lerp(e,t,i){return this.x=e.x+i*(t.x-e.x),this.y=e.y+i*(t.y-e.y),this.z=e.z+i*(t.z-e.z),this.w=e.w+i*(t.w-e.w),this}mul(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}mul2(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this.w=e.w*t.w,this}mulScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}normalize(e=this){const t=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w;if(t>0){const i=1/Math.sqrt(t);this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=e.w*i}return this}floor(e=this){return this.x=Math.floor(e.x),this.y=Math.floor(e.y),this.z=Math.floor(e.z),this.w=Math.floor(e.w),this}ceil(e=this){return this.x=Math.ceil(e.x),this.y=Math.ceil(e.y),this.z=Math.ceil(e.z),this.w=Math.ceil(e.w),this}round(e=this){return this.x=Math.round(e.x),this.y=Math.round(e.y),this.z=Math.round(e.z),this.w=Math.round(e.w),this}min(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),e.w<this.w&&(this.w=e.w),this}max(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),e.w>this.w&&(this.w=e.w),this}set(e,t,i,s){return this.x=e,this.y=t,this.z=i,this.w=s,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}sub2(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}fromArray(e,t=0){return this.x=e[t]??this.x,this.y=e[t+1]??this.y,this.z=e[t+2]??this.z,this.w=e[t+3]??this.w,this}toString(){return`[${this.x}, ${this.y}, ${this.z}, ${this.w}]`}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}};Ll.ZERO=Object.freeze(new Ll(0,0,0,0)),Ll.HALF=Object.freeze(new Ll(.5,.5,.5,.5)),Ll.ONE=Object.freeze(new Ll(1,1,1,1));let ce=Ll;const Hm=new ee,vn=new O,sa=new O,na=new O,P0=new O,pu=class pu{constructor(){this.data=new Float32Array(16),this.data[0]=this.data[5]=this.data[10]=this.data[15]=1}static _getPerspectiveHalfSize(e,t,i,s,n){n?(e.x=s*Math.tan(t*Math.PI/360),e.y=e.x/i):(e.y=s*Math.tan(t*Math.PI/360),e.x=e.y*i)}add2(e,t){const i=e.data,s=t.data,n=this.data;return n[0]=i[0]+s[0],n[1]=i[1]+s[1],n[2]=i[2]+s[2],n[3]=i[3]+s[3],n[4]=i[4]+s[4],n[5]=i[5]+s[5],n[6]=i[6]+s[6],n[7]=i[7]+s[7],n[8]=i[8]+s[8],n[9]=i[9]+s[9],n[10]=i[10]+s[10],n[11]=i[11]+s[11],n[12]=i[12]+s[12],n[13]=i[13]+s[13],n[14]=i[14]+s[14],n[15]=i[15]+s[15],this}add(e){return this.add2(this,e)}clone(){const e=this.constructor;return new e().copy(this)}copy(e){const t=e.data,i=this.data;return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],this}equals(e){const t=this.data,i=e.data;return t[0]===i[0]&&t[1]===i[1]&&t[2]===i[2]&&t[3]===i[3]&&t[4]===i[4]&&t[5]===i[5]&&t[6]===i[6]&&t[7]===i[7]&&t[8]===i[8]&&t[9]===i[9]&&t[10]===i[10]&&t[11]===i[11]&&t[12]===i[12]&&t[13]===i[13]&&t[14]===i[14]&&t[15]===i[15]}isIdentity(){const e=this.data;return e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[7]===0&&e[8]===0&&e[9]===0&&e[10]===1&&e[11]===0&&e[12]===0&&e[13]===0&&e[14]===0&&e[15]===1}mul2(e,t){const i=e.data,s=t.data,n=this.data,a=i[0],o=i[1],l=i[2],c=i[3],u=i[4],h=i[5],d=i[6],f=i[7],p=i[8],m=i[9],g=i[10],_=i[11],v=i[12],y=i[13],x=i[14],S=i[15];let w,T,A,C;return w=s[0],T=s[1],A=s[2],C=s[3],n[0]=a*w+u*T+p*A+v*C,n[1]=o*w+h*T+m*A+y*C,n[2]=l*w+d*T+g*A+x*C,n[3]=c*w+f*T+_*A+S*C,w=s[4],T=s[5],A=s[6],C=s[7],n[4]=a*w+u*T+p*A+v*C,n[5]=o*w+h*T+m*A+y*C,n[6]=l*w+d*T+g*A+x*C,n[7]=c*w+f*T+_*A+S*C,w=s[8],T=s[9],A=s[10],C=s[11],n[8]=a*w+u*T+p*A+v*C,n[9]=o*w+h*T+m*A+y*C,n[10]=l*w+d*T+g*A+x*C,n[11]=c*w+f*T+_*A+S*C,w=s[12],T=s[13],A=s[14],C=s[15],n[12]=a*w+u*T+p*A+v*C,n[13]=o*w+h*T+m*A+y*C,n[14]=l*w+d*T+g*A+x*C,n[15]=c*w+f*T+_*A+S*C,this}mulAffine2(e,t){const i=e.data,s=t.data,n=this.data,a=i[0],o=i[1],l=i[2],c=i[4],u=i[5],h=i[6],d=i[8],f=i[9],p=i[10],m=i[12],g=i[13],_=i[14];let v,y,x;return v=s[0],y=s[1],x=s[2],n[0]=a*v+c*y+d*x,n[1]=o*v+u*y+f*x,n[2]=l*v+h*y+p*x,n[3]=0,v=s[4],y=s[5],x=s[6],n[4]=a*v+c*y+d*x,n[5]=o*v+u*y+f*x,n[6]=l*v+h*y+p*x,n[7]=0,v=s[8],y=s[9],x=s[10],n[8]=a*v+c*y+d*x,n[9]=o*v+u*y+f*x,n[10]=l*v+h*y+p*x,n[11]=0,v=s[12],y=s[13],x=s[14],n[12]=a*v+c*y+d*x+m,n[13]=o*v+u*y+f*x+g,n[14]=l*v+h*y+p*x+_,n[15]=1,this}mul(e){return this.mul2(this,e)}transformPoint(e,t=new O){const i=this.data,{x:s,y:n,z:a}=e;return t.x=s*i[0]+n*i[4]+a*i[8]+i[12],t.y=s*i[1]+n*i[5]+a*i[9]+i[13],t.z=s*i[2]+n*i[6]+a*i[10]+i[14],t}transformVector(e,t=new O){const i=this.data,{x:s,y:n,z:a}=e;return t.x=s*i[0]+n*i[4]+a*i[8],t.y=s*i[1]+n*i[5]+a*i[9],t.z=s*i[2]+n*i[6]+a*i[10],t}transformVec4(e,t=new ce){const i=this.data,{x:s,y:n,z:a,w:o}=e;return t.x=s*i[0]+n*i[4]+a*i[8]+o*i[12],t.y=s*i[1]+n*i[5]+a*i[9]+o*i[13],t.z=s*i[2]+n*i[6]+a*i[10]+o*i[14],t.w=s*i[3]+n*i[7]+a*i[11]+o*i[15],t}setLookAt(e,t,i){na.sub2(e,t).normalize(),sa.copy(i).normalize(),vn.cross(sa,na).normalize(),sa.cross(na,vn);const s=this.data;return s[0]=vn.x,s[1]=vn.y,s[2]=vn.z,s[3]=0,s[4]=sa.x,s[5]=sa.y,s[6]=sa.z,s[7]=0,s[8]=na.x,s[9]=na.y,s[10]=na.z,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}setFrustum(e,t,i,s,n,a){const o=2*n,l=t-e,c=s-i,u=a-n,h=this.data;return h[0]=o/l,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=o/c,h[6]=0,h[7]=0,h[8]=(t+e)/l,h[9]=(s+i)/c,h[10]=(-a-n)/u,h[11]=-1,h[12]=0,h[13]=0,h[14]=-o*a/u,h[15]=0,this}setPerspective(e,t,i,s,n){return pu._getPerspectiveHalfSize(Hm,e,t,i,n),this.setFrustum(-Hm.x,Hm.x,-Hm.y,Hm.y,i,s)}setOrtho(e,t,i,s,n,a){const o=this.data;return o[0]=2/(t-e),o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/(s-i),o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=-2/(a-n),o[11]=0,o[12]=-(t+e)/(t-e),o[13]=-(s+i)/(s-i),o[14]=-(a+n)/(a-n),o[15]=1,this}setFromAxisAngle(e,t){t*=Q.DEG_TO_RAD;const{x:i,y:s,z:n}=e,a=Math.cos(t),o=Math.sin(t),l=1-a,c=l*i,u=l*s,h=this.data;return h[0]=c*i+a,h[1]=c*s+o*n,h[2]=c*n-o*s,h[3]=0,h[4]=c*s-o*n,h[5]=u*s+a,h[6]=u*n+o*i,h[7]=0,h[8]=c*n+o*s,h[9]=u*n-i*o,h[10]=l*n*n+a,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,this}setTranslate(e,t,i){const s=this.data;return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=e,s[13]=t,s[14]=i,s[15]=1,this}setScale(e,t,i){const s=this.data;return s[0]=e,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=t,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=i,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,this}setViewport(e,t,i,s){const n=this.data;return n[0]=i*.5,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s*.5,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=.5,n[11]=0,n[12]=e+i*.5,n[13]=t+s*.5,n[14]=.5,n[15]=1,this}setReflection(e,t){const i=e.x,s=e.y,n=e.z,a=this.data;return a[0]=1-2*i*i,a[1]=-2*i*s,a[2]=-2*i*n,a[3]=0,a[4]=-2*i*s,a[5]=1-2*s*s,a[6]=-2*s*n,a[7]=0,a[8]=-2*i*n,a[9]=-2*s*n,a[10]=1-2*n*n,a[11]=0,a[12]=-2*i*t,a[13]=-2*s*t,a[14]=-2*n*t,a[15]=1,this}invert(e=this){const t=e.data,i=t[0],s=t[1],n=t[2],a=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],f=t[10],p=t[11],m=t[12],g=t[13],_=t[14],v=t[15],y=i*l-s*o,x=i*c-n*o,S=i*u-a*o,w=s*c-n*l,T=s*u-a*l,A=n*u-a*c,C=h*g-d*m,P=h*_-f*m,I=h*v-p*m,M=d*_-f*g,N=d*v-p*g,k=f*v-p*_,V=y*k-x*N+S*M+w*I-T*P+A*C;if(V===0)this.setIdentity();else{const B=1/V,R=this.data;R[0]=(l*k-c*N+u*M)*B,R[1]=(-s*k+n*N-a*M)*B,R[2]=(g*A-_*T+v*w)*B,R[3]=(-d*A+f*T-p*w)*B,R[4]=(-o*k+c*I-u*P)*B,R[5]=(i*k-n*I+a*P)*B,R[6]=(-m*A+_*S-v*x)*B,R[7]=(h*A-f*S+p*x)*B,R[8]=(o*N-l*I+u*C)*B,R[9]=(-i*N+s*I-a*C)*B,R[10]=(m*T-g*S+v*y)*B,R[11]=(-h*T+d*S-p*y)*B,R[12]=(-o*M+l*P-c*C)*B,R[13]=(i*M-s*P+n*C)*B,R[14]=(-m*w+g*x-_*y)*B,R[15]=(h*w-d*x+f*y)*B}return this}set(e){const t=this.data;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],this}setIdentity(){const e=this.data;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}setTRS(e,t,i){const s=t.x,n=t.y,a=t.z,o=t.w,l=i.x,c=i.y,u=i.z,h=s+s,d=n+n,f=a+a,p=s*h,m=s*d,g=s*f,_=n*d,v=n*f,y=a*f,x=o*h,S=o*d,w=o*f,T=this.data;return T[0]=(1-(_+y))*l,T[1]=(m+w)*l,T[2]=(g-S)*l,T[3]=0,T[4]=(m-w)*c,T[5]=(1-(p+y))*c,T[6]=(v+x)*c,T[7]=0,T[8]=(g+S)*u,T[9]=(v-x)*u,T[10]=(1-(p+_))*u,T[11]=0,T[12]=e.x,T[13]=e.y,T[14]=e.z,T[15]=1,this}transpose(e=this){const t=e.data,i=this.data;if(t===i){let s;s=t[1],i[1]=t[4],i[4]=s,s=t[2],i[2]=t[8],i[8]=s,s=t[3],i[3]=t[12],i[12]=s,s=t[6],i[6]=t[9],i[9]=s,s=t[7],i[7]=t[13],i[13]=s,s=t[11],i[11]=t[14],i[14]=s}else i[0]=t[0],i[1]=t[4],i[2]=t[8],i[3]=t[12],i[4]=t[1],i[5]=t[5],i[6]=t[9],i[7]=t[13],i[8]=t[2],i[9]=t[6],i[10]=t[10],i[11]=t[14],i[12]=t[3],i[13]=t[7],i[14]=t[11],i[15]=t[15];return this}getTranslation(e=new O){return e.set(this.data[12],this.data[13],this.data[14])}getX(e=new O){return e.set(this.data[0],this.data[1],this.data[2])}getY(e=new O){return e.set(this.data[4],this.data[5],this.data[6])}getZ(e=new O){return e.set(this.data[8],this.data[9],this.data[10])}getScale(e=new O){return this.getX(vn),this.getY(sa),this.getZ(na),e.set(vn.length(),sa.length(),na.length()),e}get scaleSign(){return this.getX(vn),this.getY(sa),this.getZ(na),vn.cross(vn,sa),vn.dot(na)<0?-1:1}setFromEulerAngles(e,t,i){e*=Q.DEG_TO_RAD,t*=Q.DEG_TO_RAD,i*=Q.DEG_TO_RAD;const s=Math.sin(-e),n=Math.cos(-e),a=Math.sin(-t),o=Math.cos(-t),l=Math.sin(-i),c=Math.cos(-i),u=this.data;return u[0]=o*c,u[1]=-o*l,u[2]=a,u[3]=0,u[4]=n*l+c*s*a,u[5]=n*c-s*a*l,u[6]=-o*s,u[7]=0,u[8]=s*l-n*c*a,u[9]=c*s+n*a*l,u[10]=n*o,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,this}getEulerAngles(e=new O){this.getScale(P0);const t=P0.x,i=P0.y,s=P0.z;if(t===0||i===0||s===0)return e.set(0,0,0);const n=this.data,a=Math.asin(-n[2]/t),o=Math.PI*.5;let l,c;return a<o?a>-o?(l=Math.atan2(n[6]/i,n[10]/s),c=Math.atan2(n[1]/t,n[0]/t)):(c=0,l=-Math.atan2(n[4]/i,n[5]/i)):(c=0,l=Math.atan2(n[4]/i,n[5]/i)),e.set(l,a,c).mulScalar(Q.RAD_TO_DEG)}toString(){return`[${this.data.join(", ")}]`}};pu.IDENTITY=Object.freeze(new pu),pu.ZERO=Object.freeze(new pu().set([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]));let se=pu;const nf=class nf{constructor(e=0,t=0,i=0,s=1){e.length===4?(this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3]):(this.x=e,this.y=t,this.z=i,this.w=s)}clone(){const e=this.constructor;return new e(this.x,this.y,this.z,this.w)}conjugate(e=this){return this.x=e.x*-1,this.y=e.y*-1,this.z=e.z*-1,this.w=e.w,this}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w}equalsApprox(e,t=1e-6){return Math.abs(this.x-e.x)<t&&Math.abs(this.y-e.y)<t&&Math.abs(this.z-e.z)<t&&Math.abs(this.w-e.w)<t}getAxisAngle(e){let t=Math.acos(this.w)*2;const i=Math.sin(t/2);return i!==0?(e.x=this.x/i,e.y=this.y/i,e.z=this.z/i,(e.x<0||e.y<0||e.z<0)&&(e.x*=-1,e.y*=-1,e.z*=-1,t*=-1)):(e.x=1,e.y=0,e.z=0),t*Q.RAD_TO_DEG}getEulerAngles(e=new O){let t,i,s;const n=this.x,a=this.y,o=this.z,l=this.w,c=2*(l*a-n*o);return c<=-.99999?(t=2*Math.atan2(n,l),i=-Math.PI/2,s=0):c>=.99999?(t=2*Math.atan2(n,l),i=Math.PI/2,s=0):(t=Math.atan2(2*(l*n+a*o),1-2*(n*n+a*a)),i=Math.asin(c),s=Math.atan2(2*(l*o+n*a),1-2*(a*a+o*o))),e.set(t,i,s).mulScalar(Q.RAD_TO_DEG)}invert(e=this){return this.conjugate(e).normalize()}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}lerp(e,t,i){const s=(1-i)*(e.dot(t)<0?-1:1);return this.x=e.x*s+t.x*i,this.y=e.y*s+t.y*i,this.z=e.z*s+t.z*i,this.w=e.w*s+t.w*i,this.normalize()}mul(e){const t=this.x,i=this.y,s=this.z,n=this.w,a=e.x,o=e.y,l=e.z,c=e.w;return this.x=n*a+t*c+i*l-s*o,this.y=n*o+i*c+s*a-t*l,this.z=n*l+s*c+t*o-i*a,this.w=n*c-t*a-i*o-s*l,this}mulScalar(e,t=this){return this.x=t.x*e,this.y=t.y*e,this.z=t.z*e,this.w=t.w*e,this}mul2(e,t){const i=e.x,s=e.y,n=e.z,a=e.w,o=t.x,l=t.y,c=t.z,u=t.w;return this.x=a*o+i*u+s*c-n*l,this.y=a*l+s*u+n*o-i*c,this.z=a*c+n*u+i*l-s*o,this.w=a*u-i*o-s*l-n*c,this}normalize(e=this){let t=e.length();return t===0?(this.x=this.y=this.z=0,this.w=1):(t=1/t,this.x=e.x*t,this.y=e.y*t,this.z=e.z*t,this.w=e.w*t),this}set(e,t,i,s){return this.x=e,this.y=t,this.z=i,this.w=s,this}setFromAxisAngle(e,t){t*=.5*Q.DEG_TO_RAD;const i=Math.sin(t),s=Math.cos(t);return this.x=i*e.x,this.y=i*e.y,this.z=i*e.z,this.w=s,this}setFromEulerAngles(e,t,i){if(e instanceof O){const h=e;e=h.x,t=h.y,i=h.z}const s=.5*Q.DEG_TO_RAD;e*=s,t*=s,i*=s;const n=Math.sin(e),a=Math.cos(e),o=Math.sin(t),l=Math.cos(t),c=Math.sin(i),u=Math.cos(i);return this.x=n*l*u-a*o*c,this.y=a*o*u+n*l*c,this.z=a*l*c-n*o*u,this.w=a*l*u+n*o*c,this}setFromMat4(e){const t=e.data;let i=t[0],s=t[1],n=t[2],a=t[4],o=t[5],l=t[6],c=t[8],u=t[9],h=t[10],d;return d=i*i+s*s+n*n,d===0?this.set(0,0,0,1):(d=1/Math.sqrt(d),i*=d,s*=d,n*=d,d=a*a+o*o+l*l,d===0?this.set(0,0,0,1):(d=1/Math.sqrt(d),a*=d,o*=d,l*=d,d=c*c+u*u+h*h,d===0?this.set(0,0,0,1):(d=1/Math.sqrt(d),c*=d,u*=d,h*=d,h<0?i>o?this.set(1+i-o-h,s+a,c+n,l-u):this.set(s+a,1-i+o-h,l+u,c-n):i<-o?this.set(c+n,l+u,1-i-o+h,s-a):this.set(l-u,c-n,s-a,1+i+o+h),this.mulScalar(1/this.length()))))}setFromDirections(e,t){const i=1+e.dot(t);return i<Number.EPSILON?Math.abs(e.x)>Math.abs(e.y)?(this.x=-e.z,this.y=0,this.z=e.x,this.w=0):(this.x=0,this.y=-e.z,this.z=e.y,this.w=0):(this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this.w=i),this.normalize()}slerp(e,t,i){const s=e.x,n=e.y,a=e.z,o=e.w;let l=t.x,c=t.y,u=t.z,h=t.w,d=o*h+s*l+n*c+a*u;if(d<0&&(h=-h,l=-l,c=-c,u=-u,d=-d),Math.abs(d)>=1)return this.w=o,this.x=s,this.y=n,this.z=a,this;const f=Math.acos(d),p=Math.sqrt(1-d*d);if(Math.abs(p)<.001)return this.w=o*.5+h*.5,this.x=s*.5+l*.5,this.y=n*.5+c*.5,this.z=a*.5+u*.5,this;const m=Math.sin((1-i)*f)/p,g=Math.sin(i*f)/p;return this.w=o*m+h*g,this.x=s*m+l*g,this.y=n*m+c*g,this.z=a*m+u*g,this}transformVector(e,t=new O){const i=e.x,s=e.y,n=e.z,a=this.x,o=this.y,l=this.z,c=this.w,u=c*i+o*n-l*s,h=c*s+l*i-a*n,d=c*n+a*s-o*i,f=-a*i-o*s-l*n;return t.x=u*c+f*-a+h*-l-d*-o,t.y=h*c+f*-o+d*-a-u*-l,t.z=d*c+f*-l+u*-o-h*-a,t}fromArray(e,t=0){return this.x=e[t]??this.x,this.y=e[t+1]??this.y,this.z=e[t+2]??this.z,this.w=e[t+3]??this.w,this}toString(){return`[${this.x}, ${this.y}, ${this.z}, ${this.w}]`}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}};nf.IDENTITY=Object.freeze(new nf(0,0,0,1)),nf.ZERO=Object.freeze(new nf(0,0,0,0));let de=nf;const Yh=new O,Kh=new O,zB=new O,VB=new O,wde=new O;class We{constructor(e,t){this.center=new O,this.halfExtents=new O(.5,.5,.5),this._min=new O,this._max=new O,e&&this.center.copy(e),t&&this.halfExtents.copy(t)}add(e){const t=this.center,i=t.x,s=t.y,n=t.z,a=this.halfExtents,o=a.x,l=a.y,c=a.z;let u=i-o,h=i+o,d=s-l,f=s+l,p=n-c,m=n+c;const g=e.center,_=g.x,v=g.y,y=g.z,x=e.halfExtents,S=x.x,w=x.y,T=x.z,A=_-S,C=_+S,P=v-w,I=v+w,M=y-T,N=y+T;A<u&&(u=A),C>h&&(h=C),P<d&&(d=P),I>f&&(f=I),M<p&&(p=M),N>m&&(m=N),t.x=(u+h)*.5,t.y=(d+f)*.5,t.z=(p+m)*.5,a.x=(h-u)*.5,a.y=(f-d)*.5,a.z=(m-p)*.5}copy(e){this.center.copy(e.center),this.halfExtents.copy(e.halfExtents)}clone(){return new We(this.center,this.halfExtents)}intersects(e){const t=this.getMax(),i=this.getMin(),s=e.getMax(),n=e.getMin();return i.x<=s.x&&t.x>=n.x&&i.y<=s.y&&t.y>=n.y&&i.z<=s.z&&t.z>=n.z}_intersectsRay(e,t){const i=Yh.copy(this.getMin()).sub(e.origin),s=Kh.copy(this.getMax()).sub(e.origin),n=e.direction;n.x===0?(i.x=i.x<0?-Number.MAX_VALUE:Number.MAX_VALUE,s.x=s.x<0?-Number.MAX_VALUE:Number.MAX_VALUE):(i.x/=n.x,s.x/=n.x),n.y===0?(i.y=i.y<0?-Number.MAX_VALUE:Number.MAX_VALUE,s.y=s.y<0?-Number.MAX_VALUE:Number.MAX_VALUE):(i.y/=n.y,s.y/=n.y),n.z===0?(i.z=i.z<0?-Number.MAX_VALUE:Number.MAX_VALUE,s.z=s.z<0?-Number.MAX_VALUE:Number.MAX_VALUE):(i.z/=n.z,s.z/=n.z);const a=zB.set(Math.min(i.x,s.x),Math.min(i.y,s.y),Math.min(i.z,s.z)),o=VB.set(Math.max(i.x,s.x),Math.max(i.y,s.y),Math.max(i.z,s.z)),l=Math.min(Math.min(o.x,o.y),o.z),c=Math.max(Math.max(a.x,a.y),a.z),u=l>=c&&c>=0;return u&&t.copy(e.direction).mulScalar(c).add(e.origin),u}_fastIntersectsRay(e){const t=Yh,i=Kh,s=zB,n=VB,a=wde,o=e.direction;return t.sub2(e.origin,this.center),n.set(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z)),s.mul2(t,o),!(n.x>this.halfExtents.x&&s.x>=0||n.y>this.halfExtents.y&&s.y>=0||n.z>this.halfExtents.z&&s.z>=0||(a.set(Math.abs(o.x),Math.abs(o.y),Math.abs(o.z)),i.cross(o,t),i.set(Math.abs(i.x),Math.abs(i.y),Math.abs(i.z)),i.x>this.halfExtents.y*a.z+this.halfExtents.z*a.y)||i.y>this.halfExtents.x*a.z+this.halfExtents.z*a.x||i.z>this.halfExtents.x*a.y+this.halfExtents.y*a.x)}intersectsRay(e,t){return t?this._intersectsRay(e,t):this._fastIntersectsRay(e)}setMinMax(e,t){this.center.add2(t,e).mulScalar(.5),this.halfExtents.sub2(t,e).mulScalar(.5)}getMin(){return this._min.copy(this.center).sub(this.halfExtents)}getMax(){return this._max.copy(this.center).add(this.halfExtents)}containsPoint(e){const t=this.getMin(),i=this.getMax();return!(e.x<t.x||e.x>i.x||e.y<t.y||e.y>i.y||e.z<t.z||e.z>i.z)}setFromTransformedAabb(e,t,i=!1){const s=e.center,n=e.halfExtents,a=t.data;let o=a[0],l=a[4],c=a[8],u=a[1],h=a[5],d=a[9],f=a[2],p=a[6],m=a[10];if(i){let g=o*o+l*l+c*c;if(g>0){const _=1/Math.sqrt(g);o*=_,l*=_,c*=_}if(g=u*u+h*h+d*d,g>0){const _=1/Math.sqrt(g);u*=_,h*=_,d*=_}if(g=f*f+p*p+m*m,g>0){const _=1/Math.sqrt(g);f*=_,p*=_,m*=_}}this.center.set(a[12]+o*s.x+l*s.y+c*s.z,a[13]+u*s.x+h*s.y+d*s.z,a[14]+f*s.x+p*s.y+m*s.z),this.halfExtents.set(Math.abs(o)*n.x+Math.abs(l)*n.y+Math.abs(c)*n.z,Math.abs(u)*n.x+Math.abs(h)*n.y+Math.abs(d)*n.z,Math.abs(f)*n.x+Math.abs(p)*n.y+Math.abs(m)*n.z)}static computeMinMax(e,t,i,s=e.length/3){if(s>0){let n=e[0],a=e[1],o=e[2],l=n,c=a,u=o;const h=s*3;for(let d=3;d<h;d+=3){const f=e[d],p=e[d+1],m=e[d+2];f<n&&(n=f),p<a&&(a=p),m<o&&(o=m),f>l&&(l=f),p>c&&(c=p),m>u&&(u=m)}t.set(n,a,o),i.set(l,c,u)}}compute(e,t){We.computeMinMax(e,Yh,Kh,t),this.setMinMax(Yh,Kh)}intersectsBoundingSphere(e){return this._distanceToBoundingSphereSq(e)<=e.radius*e.radius}_distanceToBoundingSphereSq(e){const t=this.getMin(),i=this.getMax();let s=0;const n=["x","y","z"];for(let a=0;a<3;++a){let o=0;const l=e.center[n[a]],c=t[n[a]],u=i[n[a]];let h=0;l<c&&(h=c-l,o+=h*h),l>u&&(h=l-u,o+=h*h),s+=o}return s}_expand(e,t){Yh.add2(this.getMin(),e),Kh.add2(this.getMax(),t),this.setMinMax(Yh,Kh)}}const I0=new O,Tde=new O;class AO{constructor(e=new O,t=.5){this.center=e,this.radius=t}containsPoint(e){const t=I0.sub2(e,this.center).lengthSq(),i=this.radius;return t<i*i}intersectsRay(e,t){const i=I0.copy(e.origin).sub(this.center),s=i.dot(Tde.copy(e.direction).normalize()),n=i.dot(i)-this.radius*this.radius;if(n>0&&s>0)return!1;const a=s*s-n;if(a<0)return!1;const o=Math.abs(-s-Math.sqrt(a));return t&&t.copy(e.direction).mulScalar(o).add(e.origin),!0}intersectsBoundingSphere(e){I0.sub2(e.center,this.center);const t=e.radius+this.radius;return I0.lengthSq()<=t*t}}class hq{constructor(e=O.UP,t=0){this.normal=new O,this.normal.copy(e),this.distance=t}clone(){const e=this.constructor;return new e().copy(this)}copy(e){return this.normal.copy(e.normal),this.distance=e.distance,this}intersectsLine(e,t,i){const s=this.distance,n=this.normal.dot(e)+s,a=this.normal.dot(t)+s,o=n/(n-a),l=o>=0&&o<=1;return l&&i&&i.lerp(e,t,o),l}intersectsRay(e,t){const i=this.normal.dot(e.direction);if(i===0)return!1;const s=-(this.normal.dot(e.origin)+this.distance)/i;return s>=0&&t&&t.copy(e.direction).mulScalar(s).add(e.origin),s>=0}normalize(){const e=1/this.normal.length();return this.normal.mulScalar(e),this.distance*=e,this}set(e,t,i,s){return this.normal.set(e,t,i),this.distance=s,this}setFromPointNormal(e,t){return this.normal.copy(t),this.distance=-this.normal.dot(e),this}}class Ede{constructor(){this.planes=[];for(let e=0;e<6;e++)this.planes[e]=new hq}clone(){const e=this.constructor;return new e().copy(this)}copy(e){for(let t=0;t<6;t++)this.planes[t].copy(e.planes[t]);return this}setFromMat4(e){const[t,i,s,n,a,o,l,c,u,h,d,f,p,m,g,_]=e.data,v=this.planes;v[0].set(n-t,c-a,f-u,_-p).normalize(),v[1].set(n+t,c+a,f+u,_+p).normalize(),v[2].set(n+i,c+o,f+h,_+m).normalize(),v[3].set(n-i,c-o,f-h,_-m).normalize(),v[4].set(n-s,c-l,f-d,_-g).normalize(),v[5].set(n+s,c+l,f+d,_+g).normalize()}containsPoint(e){for(let t=0;t<6;t++){const{normal:i,distance:s}=this.planes[t];if(i.dot(e)+s<=0)return!1}return!0}containsSphere(e){const{center:t,radius:i}=e;let s=0;for(let n=0;n<6;n++){const{normal:a,distance:o}=this.planes[n],l=a.dot(t)+o;if(l<=-i)return 0;l>i&&s++}return s===6?2:1}}class aM{constructor(e,t){this.origin=new O,this.direction=O.FORWARD.clone(),e&&this.origin.copy(e),t&&this.direction.copy(t)}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.set(e.origin,e.direction)}clone(){return new this.constructor(this.origin,this.direction)}}const zi=0,ge=1,CO=2,PO=0,br=1,Ade=2,dq=4,Cde=5,IO=6,MO=8,Gn=0,Pde=2,Ide=3,Mde=4,Kn=0,nb=1,Rde=2,Dde=3,X_=1,q_=2,ab=4,Vi=0,oh=1,Gg=2,Lde=3,qe=0,_i=1,rE=2,sE=3,nE=4,lh=5,Ode=0,ob=1,lb=2,oM=3,Nde=4,kde=5,Fde=6,Lo=7,lM=0,xc=1,bc=2,fq=0,pq=1,RO=2,aE=3,DO=4,oE=5,Ic=6,ct=7,lE=8,LO=9,fy=10,cE=11,wi=12,OO=13,or=14,sl=15,Bo=16,uE=17,np=18,NO=19,Ms=20,hE=21,kO=22,FO=23,py=24,my=25,dE=26,fE=27,mq=28,gq=29,_q=30,vq=31,BO=32,yq=33,UO=34,zO=35,VO=36,cm=37,jO=38,Sq=39,$O=40,HO=41,GO=42,WO=43,XO=44,xq=45,qO=46,pE=47,YO=48,Qs=49,mE=50,KO=51,ZO=52,QO=53,cM=54,uM=55,hM=56,dM=61,fM=62,pM=63,bq=64,wq=65,Tq=66,Eq=67,mM=68,Af=69,Ua=new Map([[fq,{name:"A8",size:1,ldr:!0}],[ZO,{name:"R8",size:1,ldr:!0}],[pq,{name:"L8",size:1,ldr:!0}],[RO,{name:"LA8",size:2,ldr:!0}],[QO,{name:"RG8",size:2,ldr:!0}],[aE,{name:"RGB565",size:2,ldr:!0}],[DO,{name:"RGBA5551",size:2,ldr:!0}],[oE,{name:"RGBA4",size:2,ldr:!0}],[Ic,{name:"RGB8",size:4,ldr:!0}],[ct,{name:"RGBA8",size:4,ldr:!0,srgbFormat:Ms}],[mE,{name:"R16F",size:2}],[KO,{name:"RG16F",size:4}],[cE,{name:"RGB16F",size:8}],[wi,{name:"RGBA16F",size:8}],[OO,{name:"RGB32F",size:16}],[or,{name:"RGBA32F",size:16}],[sl,{name:"R32F",size:4}],[Bo,{name:"DEPTH",size:4}],[Af,{name:"DEPTH16",size:2}],[uE,{name:"DEPTHSTENCIL",size:4}],[np,{name:"111110F",size:4}],[NO,{name:"SRGB8",size:4,ldr:!0,srgb:!0}],[Ms,{name:"SRGBA8",size:4,ldr:!0,srgb:!0}],[vq,{name:"BGRA8",size:4,ldr:!0}],[bq,{name:"SBGRA8",size:4,ldr:!0,srgb:!0}],[lE,{name:"DXT1",blockSize:8,ldr:!0,srgbFormat:cM}],[LO,{name:"DXT3",blockSize:16,ldr:!0,srgbFormat:uM}],[fy,{name:"DXT5",blockSize:16,ldr:!0,srgbFormat:hM}],[hE,{name:"ETC1",blockSize:8,ldr:!0}],[kO,{name:"ETC2_RGB",blockSize:8,ldr:!0,srgbFormat:dM}],[FO,{name:"ETC2_RGBA",blockSize:16,ldr:!0,srgbFormat:fM}],[py,{name:"PVRTC_2BPP_RGB_1",ldr:!0,blockSize:8}],[my,{name:"PVRTC_2BPP_RGBA_1",ldr:!0,blockSize:8}],[dE,{name:"PVRTC_4BPP_RGB_1",ldr:!0,blockSize:8}],[fE,{name:"PVRTC_4BPP_RGBA_1",ldr:!0,blockSize:8}],[mq,{name:"ASTC_4x4",blockSize:16,ldr:!0,srgbFormat:pM}],[gq,{name:"ATC_RGB",blockSize:8,ldr:!0}],[_q,{name:"ATC_RGBA",blockSize:16,ldr:!0}],[wq,{name:"BC6H_RGBF",blockSize:16}],[Tq,{name:"BC6H_RGBUF",blockSize:16}],[Eq,{name:"BC7_RGBA",blockSize:16,ldr:!0,srgbFormat:mM}],[cM,{name:"DXT1_SRGB",blockSize:8,ldr:!0,srgb:!0}],[uM,{name:"DXT3_SRGBA",blockSize:16,ldr:!0,srgb:!0}],[hM,{name:"DXT5_SRGBA",blockSize:16,ldr:!0,srgb:!0}],[dM,{name:"ETC2_SRGB",blockSize:8,ldr:!0,srgb:!0}],[fM,{name:"ETC2_SRGBA",blockSize:16,ldr:!0,srgb:!0}],[pM,{name:"ASTC_4x4_SRGB",blockSize:16,ldr:!0,srgb:!0}],[mM,{name:"BC7_SRGBA",blockSize:16,ldr:!0,srgb:!0}],[BO,{name:"R8I",size:1,isInt:!0}],[yq,{name:"R8U",size:1,isInt:!0}],[UO,{name:"R16I",size:2,isInt:!0}],[zO,{name:"R16U",size:2,isInt:!0}],[VO,{name:"R32I",size:4,isInt:!0}],[cm,{name:"R32U",size:4,isInt:!0}],[jO,{name:"RG8I",size:2,isInt:!0}],[Sq,{name:"RG8U",size:2,isInt:!0}],[$O,{name:"RG16I",size:4,isInt:!0}],[HO,{name:"RG16U",size:4,isInt:!0}],[GO,{name:"RG32I",size:8,isInt:!0}],[WO,{name:"RG32U",size:8,isInt:!0}],[XO,{name:"RGBA8I",size:4,isInt:!0}],[xq,{name:"RGBA8U",size:4,isInt:!0}],[qO,{name:"RGBA16I",size:8,isInt:!0}],[pE,{name:"RGBA16U",size:8,isInt:!0}],[YO,{name:"RGBA32I",size:16,isInt:!0}],[Qs,{name:"RGBA32U",size:16,isInt:!0}]]),Bde=r=>{var e;return((e=Ua.get(r))==null?void 0:e.blockSize)!==void 0},cb=r=>{var e;return((e=Ua.get(r))==null?void 0:e.srgb)===!0},Xd=r=>{var e;return((e=Ua.get(r))==null?void 0:e.isInt)===!0},gE=r=>{var e;return((e=Ua.get(r))==null?void 0:e.srgbFormat)||r},Ude=r=>{for(const[e,t]of Ua)if(t.srgbFormat===r)return e;return r},zde=r=>{const e=Ua.get(r);return!!(e!=null&&e.ldr&&!(e!=null&&e.srgb))},Aq=r=>{switch(r){case sl:case OO:case or:return Float32Array;case VO:case GO:case YO:return Int32Array;case cm:case WO:case Qs:return Uint32Array;case UO:case $O:case qO:return Int16Array;case QO:case zO:case HO:case pE:case aE:case DO:case oE:case mE:case KO:case cE:case wi:return Uint16Array;case BO:case jO:case XO:return Int8Array;default:return Uint8Array}},_E=0,vE=1,Cq=2,Pq=3,Uo=4,wc=5,zu=6,Xe="POSITION",Rs="NORMAL",Xa="TANGENT",za="BLENDWEIGHT",Es="BLENDINDICES",wr="COLOR",jB="TEXCOORD",un="TEXCOORD0",Oh="TEXCOORD1",gy="TEXCOORD2",_y="TEXCOORD3",vy="TEXCOORD4",yy="TEXCOORD5",Sy="TEXCOORD6",xy="TEXCOORD7",gM="ATTR0",_M="ATTR1",Iq="ATTR2",Mq="ATTR3",Rq="ATTR4",Vde="ATTR5",jde="ATTR6",$de="ATTR7",Y_="ATTR8",K_="ATTR9",Hde="ATTR10",Gde="ATTR11",JO="ATTR12",by="ATTR13",e3="ATTR14",ap="ATTR15",Wde=1,Cf=0,Xde=2,qde=3,Yde=5,J1=0,Dq=1,$B=2,qa="default",ch="rgbm",ub="rgbe",Z_="rgbp",t3="swizzleGGGR",Lq="2d",Kde=0,Zde="none",vM="cube",HB="equirect",Qde="octahedral",dt="glsl",Gt="wgsl",yE=0,Vu=1,SE=2,wy=3,Oq=4,xE=5,bt=6,Pf=0,uh=1,zn=2,hh=3,vs=4,op=5,ju=6,$u=7,Hu=8,Q_=9,J_=10,ev=11,hb=12,lp=13,Aa=14,Jde=15,efe=16,bE=17,tfe=18,ife=19,rfe=20,wE=21,TE=22,i3=23,Nq=24,sfe=25,cp=26,up=27,hp=28,dp=29,fp=30,EE=31,AE=32,pp=33,CE=34,PE=35,mp=36,IE=37,ME=38,db=39,r3=40,s3=41,nfe=42,afe=43,ofe=44,lfe=45,cfe=46,ufe=47,hfe=48,dfe=49,ffe=[["bool"],["i32"],["f32"],["vec2f","vec2<f32>"],["vec3f","vec3<f32>"],["vec4f","vec4<f32>"],["vec2i","vec2<i32>"],["vec3i","vec3<i32>"],["vec4i","vec4<i32>"],["vec2<bool>"],["vec3<bool>"],["vec4<bool>"],["mat2x2f","mat2x2<f32>"],["mat3x3f","mat3x3<f32>"],["mat4x4f","mat4x4<f32>"],["texture_2d<f32>"],["texture_cube<f32>"],["array<f32>"],["texture_depth_2d"],["texture_depth_cube"],["texture_3d<f32>"],["array<vec2<f32>>"],["array<vec3<f32>>"],["array<vec4<f32>>"],["array<mat4x4<f32>>"],["texture_2d_array<f32>"],["u32"],["vec2u","vec2<u32>"],["vec3u","vec3<u32>"],["vec4u","vec4<u32>"],["array<i32>"],["array<u32>"],["array<bool>"],["array<vec2i>","array<vec2<i32>>"],["array<vec2u>","array<vec2<u32>>"],["array<vec2b>","array<vec2<bool>>"],["array<vec3i>","array<vec3<i32>>"],["array<vec3u>","array<vec3<u32>>"],["array<vec3b>","array<vec3<bool>>"],["array<vec4i>","array<vec4<i32>>"],["array<vec4u>","array<vec4<u32>>"],["array<vec4b>","array<vec4<bool>>"],["texture_2d<i32>"],["texture_2d<u32>"],["texture_cube<i32>"],["texture_cube<u32>"],["texture_3d<i32>"],["texture_3d<u32>"],["texture_2d_array<i32>"],["texture_2d_array<u32>"]],pfe=new Map;ffe.forEach((r,e)=>{r.forEach(t=>pfe.set(t,e))});const mfe="webgl2",kq=1,Fq=2,gfe=4,_fe="ldr",Bq=1,Uq=2,zq=4,Vq=8,jq=16,$q=32,Hq=64,Gq=128,vfe=255,tv=0,Wq=1,yM=2,n3="default",If=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Uint16Array],Wg=[1,1,2,2,4,4,4,2],fb=[Uint8Array,Uint16Array,Uint32Array],yfe=[1,2,4],rt={};rt[Xe]=0;rt[Rs]=1;rt[za]=2;rt[Es]=3;rt[wr]=4;rt[un]=5;rt[Oh]=6;rt[gy]=7;rt[_y]=8;rt[vy]=9;rt[yy]=10;rt[Sy]=11;rt[xy]=12;rt[Xa]=13;rt[gM]=0;rt[_M]=1;rt[Iq]=2;rt[Mq]=3;rt[Rq]=4;rt[Vde]=5;rt[jde]=6;rt[$de]=7;rt[Y_]=8;rt[K_]=9;rt[Hde]=10;rt[Gde]=11;rt[JO]=12;rt[by]=13;rt[e3]=14;rt[ap]=15;const Sfe="modulepreload",xfe=function(r){return"/"+r},GB={},Ty=function(e,t,i){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=Promise.allSettled(t.map(l=>{if(l=xfe(l),l in GB)return;GB[l]=!0;const c=l.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const h=document.createElement("link");if(h.rel=c?"stylesheet":Sfe,c||(h.as="script"),h.crossOrigin="",h.href=l,o&&h.setAttribute("nonce",o),document.head.appendChild(h),c)return new Promise((d,f)=>{h.addEventListener("load",d),h.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}function n(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return s.then(a=>{for(const o of a||[])o.status==="rejected"&&n(o.reason);return e().catch(n)})};let bfe=0;class RE{constructor(e,t){this.slot=-1,this.scopeId=null,this.name=e,this.visibility=t}}class a3 extends RE{}class wfe extends RE{constructor(e,t,i=!1){super(e,t),this.format="",this.readOnly=i}}class WB extends RE{constructor(e,t,i=Lq,s=Kde,n=!0,a=null){super(e,t),this.textureDimension=i,this.sampleType=s,this.hasSampler=n,this.samplerName=a??`${e}_sampler`}}class Tfe extends RE{constructor(e,t=ct,i=Lq,s=!0,n=!1){super(e,gfe),this.format=t,this.textureDimension=i,this.write=s,this.read=n}}class Xq{constructor(e,t){this.uniformBufferFormats=[],this.textureFormats=[],this.storageTextureFormats=[],this.storageBufferFormats=[],this.id=bfe++;let i=0;t.forEach(n=>{n.slot=i++,n instanceof WB&&n.hasSampler&&i++,n instanceof a3?this.uniformBufferFormats.push(n):n instanceof WB?this.textureFormats.push(n):n instanceof Tfe?this.storageTextureFormats.push(n):n instanceof wfe&&this.storageBufferFormats.push(n)}),this.device=e;const s=e.scope;this.bufferFormatsMap=new Map,this.uniformBufferFormats.forEach((n,a)=>this.bufferFormatsMap.set(n.name,a)),this.textureFormatsMap=new Map,this.textureFormats.forEach((n,a)=>{this.textureFormatsMap.set(n.name,a),n.scopeId=s.resolve(n.name)}),this.storageTextureFormatsMap=new Map,this.storageTextureFormats.forEach((n,a)=>{this.storageTextureFormatsMap.set(n.name,a),n.scopeId=s.resolve(n.name)}),this.storageBufferFormatsMap=new Map,this.storageBufferFormats.forEach((n,a)=>{this.storageBufferFormatsMap.set(n.name,a),n.scopeId=s.resolve(n.name)}),this.impl=e.createBindGroupFormatImpl(this)}destroy(){this.impl.destroy()}getTexture(e){const t=this.textureFormatsMap.get(e);return t!==void 0?this.textureFormats[t]:null}getStorageTexture(e){const t=this.storageTextureFormatsMap.get(e);return t!==void 0?this.storageTextureFormats[t]:null}loseContext(){}}class jr{get(e,t){return this._cache.has(e)||(this._cache.set(e,t()),e.on("destroy",()=>{this.remove(e)}),e.on("devicelost",()=>{var i,s;(s=(i=this._cache.get(e))==null?void 0:i.loseContext)==null||s.call(i,e)})),this._cache.get(e)}remove(e){var t,i;(i=(t=this._cache.get(e))==null?void 0:t.destroy)==null||i.call(t,e),this._cache.delete(e)}constructor(){this._cache=new Map}}class zo{static calcLevelDimension(e,t){return Math.max(e>>t,1)}static calcMipLevelsCount(e,t,i=1){return 1+Math.floor(Math.log2(Math.max(e,t,i)))}static calcLevelGpuSize(e,t,i,s){var h;const n=Ua.get(s),a=((h=Ua.get(s))==null?void 0:h.size)??0;if(a>0)return e*t*i*a;const o=n.blockSize??0;let l=Math.floor((e+3)/4);const c=Math.floor((t+3)/4),u=Math.floor((i+3)/4);return(s===py||s===my)&&(l=Math.max(Math.floor(l/2),1)),l*c*u*o}static calcGpuSize(e,t,i,s,n,a){let o=0;for(;o+=zo.calcLevelGpuSize(e,t,i,s),!(!n||e===1&&t===1&&i===1);)e=Math.max(e>>1,1),t=Math.max(t>>1,1),i=Math.max(i>>1,1);return o*(a?6:1)}}let Efe=0;class we{constructor(e,t={}){this._gpuSize=0,this.id=Efe++,this._invalid=!1,this._lockedLevel=-1,this._lockedMode=J1,this.renderVersionDirty=0,this._storage=!1,this._numLevels=0,this.device=e,this.name=t.name??"",this._width=Math.floor(t.width??4),this._height=Math.floor(t.height??4),this._format=t.format??ct,this._compressed=Bde(this._format),this._integerFormat=Xd(this._format),this._integerFormat&&(t.minFilter=qe,t.magFilter=qe),this._volume=t.volume??!1,this._depth=Math.floor(t.depth??1),this._arrayLength=Math.floor(t.arrayLength??0),this._storage=t.storage??!1,this._cubemap=t.cubemap??!1,this._flipY=t.flipY??!1,this._premultiplyAlpha=t.premultiplyAlpha??!1,this._mipmaps=t.mipmaps??!0,this._numLevelsRequested=t.numLevels,t.numLevels!==void 0&&(this._numLevels=t.numLevels),this._updateNumLevel(),this._minFilter=t.minFilter??lh,this._magFilter=t.magFilter??_i,this._anisotropy=t.anisotropy??1,this._addressU=t.addressU??zi,this._addressV=t.addressV??zi,this._addressW=t.addressW??zi,this._compareOnRead=t.compareOnRead??!1,this._compareFunc=t.compareFunc??ob,this._type=t.type??qa,this.projection=Zde,this._cubemap?this.projection=vM:t.projection&&t.projection!==vM&&(this.projection=t.projection),this._levels=t.levels;const i=!!t.levels;this._levels||this._clearLevels(),this.recreateImpl(i),e.textures.push(this)}destroy(){const e=this.device;if(e){const t=e.textures.indexOf(this);t!==-1&&e.textures.splice(t,1),e.scope.removeValue(this),this.impl.destroy(e),this.adjustVramSizeTracking(e._vram,-this._gpuSize),this._levels=null,this.device=null}}recreateImpl(e=!0){var i;const{device:t}=this;(i=this.impl)==null||i.destroy(t),this.impl=null,this.impl=t.createTextureImpl(this),this.dirtyAll(),e&&this.upload()}_clearLevels(){this._levels=this._cubemap?[[null,null,null,null,null,null]]:[null]}resize(e,t,i=1){const s=this.device;this.adjustVramSizeTracking(s._vram,-this._gpuSize),this.impl.destroy(s),this._clearLevels(),this._width=Math.floor(e),this._height=Math.floor(t),this._depth=Math.floor(i),this._updateNumLevel(),this.impl=s.createTextureImpl(this),this.dirtyAll()}loseContext(){this.impl.loseContext(),this.dirtyAll()}adjustVramSizeTracking(e,t){e.tex+=t}propertyChanged(e){this.impl.propertyChanged(e),this.renderVersionDirty=this.device.renderVersion}_updateNumLevel(){const e=this.mipmaps?zo.calcMipLevelsCount(this.width,this.height):1,t=this._numLevelsRequested;this._numLevels=Math.min(t??e,e),this._mipmaps=this._numLevels>1}get lockedMode(){return this._lockedMode}set minFilter(e){this._minFilter!==e&&(Xd(this._format)||(this._minFilter=e,this.propertyChanged(Bq)))}get minFilter(){return this._minFilter}set magFilter(e){this._magFilter!==e&&(Xd(this._format)||(this._magFilter=e,this.propertyChanged(Uq)))}get magFilter(){return this._magFilter}set addressU(e){this._addressU!==e&&(this._addressU=e,this.propertyChanged(zq))}get addressU(){return this._addressU}set addressV(e){this._addressV!==e&&(this._addressV=e,this.propertyChanged(Vq))}get addressV(){return this._addressV}set addressW(e){this._volume&&e!==this._addressW&&(this._addressW=e,this.propertyChanged(jq))}get addressW(){return this._addressW}set compareOnRead(e){this._compareOnRead!==e&&(this._compareOnRead=e,this.propertyChanged($q))}get compareOnRead(){return this._compareOnRead}set compareFunc(e){this._compareFunc!==e&&(this._compareFunc=e,this.propertyChanged(Hq))}get compareFunc(){return this._compareFunc}set anisotropy(e){this._anisotropy!==e&&(this._anisotropy=e,this.propertyChanged(Gq))}get anisotropy(){return this._anisotropy}set mipmaps(e){this._mipmaps!==e&&(this.device.isWebGPU||Xd(this._format)||(this._mipmaps=e),e&&(this._needsMipmapsUpload=!0))}get mipmaps(){return this._mipmaps}get numLevels(){return this._numLevels}get storage(){return this._storage}get width(){return this._width}get height(){return this._height}get depth(){return this._depth}get format(){return this._format}get cubemap(){return this._cubemap}get gpuSize(){const e=this.pot&&this._mipmaps&&!(this._compressed&&this._levels.length===1);return zo.calcGpuSize(this._width,this._height,this._depth,this._format,e,this._cubemap)}get array(){return this._arrayLength>0}get arrayLength(){return this._arrayLength}get volume(){return this._volume}set type(e){this._type!==e&&(this._type=e,this.device._shadersDirty=!0)}get type(){return this._type}set srgb(e){const t=cb(this.format);if(e!==t)if(e){const i=gE(this.format);this._format!==i&&(this._format=i,this.recreateImpl(),this.device._shadersDirty=!0)}else{const i=Ude(this.format);this._format!==i&&(this._format=i,this.recreateImpl(),this.device._shadersDirty=!0)}}get srgb(){return cb(this.format)}set flipY(e){this._flipY!==e&&(this._flipY=e,this._needsUpload=!0)}get flipY(){return this._flipY}set premultiplyAlpha(e){this._premultiplyAlpha!==e&&(this._premultiplyAlpha=e,this._needsUpload=!0)}get premultiplyAlpha(){return this._premultiplyAlpha}get pot(){return Q.powerOfTwo(this._width)&&Q.powerOfTwo(this._height)}get encoding(){switch(this.type){case ch:return"rgbm";case ub:return"rgbe";case Z_:return"rgbp"}return zde(this.format)?"srgb":"linear"}dirtyAll(){this._levelsUpdated=this._cubemap?[[!0,!0,!0,!0,!0,!0]]:[!0],this._needsUpload=!0,this._needsMipmapsUpload=this._mipmaps,this._mipmapsUploaded=!1,this.propertyChanged(vfe)}lock(e={}){e.level??(e.level=0),e.face??(e.face=0),e.mode??(e.mode=$B),this._lockedMode=e.mode,this._lockedLevel=e.level;const t=this.cubemap?this._levels[e.face]:this._levels;if(t[e.level]===null){const i=Math.max(1,this._width>>e.level),s=Math.max(1,this._height>>e.level),n=Math.max(1,this._depth>>e.level),a=new ArrayBuffer(zo.calcLevelGpuSize(i,s,n,this._format));t[e.level]=new(Aq(this._format))(a)}return t[e.level]}setSource(e,t=0){let i=!1,s,n;if(this._cubemap){if(e[0]){s=e[0].width||0,n=e[0].height||0;for(let a=0;a<6;a++){const o=e[a];if(!o||o.width!==s||o.height!==n||!this.device._isBrowserInterface(o)){i=!0;break}}}else i=!0;if(!i)for(let a=0;a<6;a++)this._levels[t][a]!==e[a]&&(this._levelsUpdated[t][a]=!0)}else this.device._isBrowserInterface(e)||(i=!0),i||(e!==this._levels[t]&&(this._levelsUpdated[t]=!0),e instanceof HTMLVideoElement?(s=e.videoWidth,n=e.videoHeight):(s=e.width,n=e.height));if(i)if(this._width=4,this._height=4,this._cubemap)for(let a=0;a<6;a++)this._levels[t][a]=null,this._levelsUpdated[t][a]=!0;else this._levels[t]=null,this._levelsUpdated[t]=!0;else t===0&&(this._width=s,this._height=n),this._levels[t]=e;(this._invalid!==i||!i)&&(this._invalid=i,this.upload())}getSource(e=0){return this._levels[e]}unlock(){this._lockedMode,this._lockedMode===$B&&this.upload(),this._lockedLevel=-1,this._lockedMode=J1}upload(){var e,t;this._needsUpload=!0,this._needsMipmapsUpload=this._mipmaps,(t=(e=this.impl).uploadImmediate)==null||t.call(e,this.device,this)}read(e,t,i,s,n={}){var a,o;return(o=(a=this.impl).read)==null?void 0:o.call(a,e,t,i,s,n)}write(e,t,i,s,n){var a,o;return(o=(a=this.impl).write)==null?void 0:o.call(a,e,t,i,s,n)}}const Afe={white:[255,255,255,255],gray:[128,128,128,255],black:[0,0,0,255],normal:[128,128,255,255],pink:[255,128,255,255]};class Cfe{destroy(){this.map.forEach(e=>{e.destroy()})}constructor(){this.map=new Map}}const Pfe=new jr,Gu=(r,e)=>{const t=Pfe.get(r,()=>new Cfe);if(!t.map.has(e)){const i=new we(r,{name:`built-in-texture-${e}`,width:1,height:1,format:ct}),s=i.lock(),n=Afe[e];s.set(n),i.unlock(),t.map.set(e,i)}return t.map.get(e)};let Ife=0;class qq{constructor(){this.offsets=[]}}class o3{constructor(e,t,i){this.renderVersionUpdated=-1,this.uniformBufferOffsets=[],this.id=Ife++,this.device=e,this.format=t,this.dirty=!0,this.impl=e.createBindGroupImpl(this),this.textures=[],this.storageTextures=[],this.storageBuffers=[],this.uniformBuffers=[],this.defaultUniformBuffer=i,i&&this.setUniformBuffer(n3,i)}destroy(){this.impl.destroy(),this.impl=null,this.format=null,this.defaultUniformBuffer=null}setUniformBuffer(e,t){const i=this.format.bufferFormatsMap.get(e);this.uniformBuffers[i]!==t&&(this.uniformBuffers[i]=t,this.dirty=!0)}setStorageBuffer(e,t){const i=this.format.storageBufferFormatsMap.get(e);this.storageBuffers[i]!==t&&(this.storageBuffers[i]=t,this.dirty=!0)}setTexture(e,t){const i=this.format.textureFormatsMap.get(e);this.textures[i]!==t?(this.textures[i]=t,this.dirty=!0):this.renderVersionUpdated<t.renderVersionDirty&&(this.dirty=!0)}setStorageTexture(e,t){const i=this.format.storageTextureFormatsMap.get(e);this.storageTextures[i]!==t?(this.storageTextures[i]=t,this.dirty=!0):this.renderVersionUpdated<t.renderVersionDirty&&(this.dirty=!0)}updateUniformBuffers(){for(let e=0;e<this.uniformBuffers.length;e++)this.uniformBuffers[e].update()}update(){const{textureFormats:e,storageTextureFormats:t,storageBufferFormats:i}=this.format;for(let s=0;s<e.length;s++){const n=e[s];let a=n.scopeId.value;a||(n.name==="uSceneDepthMap"&&(a=Gu(this.device,"white")),n.name==="uSceneColorMap"&&(a=Gu(this.device,"pink")),a||(a=Gu(this.device,"pink"))),this.setTexture(n.name,a)}for(let s=0;s<t.length;s++){const n=t[s],a=n.scopeId.value;this.setStorageTexture(n.name,a)}for(let s=0;s<i.length;s++){const n=i[s],a=n.scopeId.value;this.setStorageBuffer(n.name,a)}this.uniformBufferOffsets.length=this.uniformBuffers.length;for(let s=0;s<this.uniformBuffers.length;s++){const n=this.uniformBuffers[s];this.uniformBufferOffsets[s]=n.offset,this.renderVersionUpdated<n.renderVersionDirty&&(this.dirty=!0)}this.dirty&&(this.dirty=!1,this.renderVersionUpdated=this.device.renderVersion,this.impl.update(this))}}const St={set(r,e,t,i=1){return r&~(i<<t)|e<<t},get(r,e,t=1){return r>>e&t},all(r,e,t=1){const i=t<<e;return(r&i)===i},any(r,e,t=1){return(r&t<<e)!==0}},M0=7,_l=15,XB=0,qB=3,YB=7,KB=11,ZB=14,QB=18,SM=22,JB=23,eU=24,tU=25,iU=26,Mfe=15,Rfe=SM,ua=class ua{constructor(e=!1,t=Gn,i=br,s=PO,n,a,o,l=!0,c=!0,u=!0,h=!0){this.target0=0,this.setColorBlend(t,i,s),this.setAlphaBlend(n??t,a??i,o??s),this.setColorWrite(l,c,u,h),this.blend=e}set blend(e){this.target0=St.set(this.target0,e?1:0,iU)}get blend(){return St.all(this.target0,iU)}setColorBlend(e,t,i){this.target0=St.set(this.target0,e,XB,M0),this.target0=St.set(this.target0,t,qB,_l),this.target0=St.set(this.target0,i,YB,_l)}setAlphaBlend(e,t,i){this.target0=St.set(this.target0,e,KB,M0),this.target0=St.set(this.target0,t,ZB,_l),this.target0=St.set(this.target0,i,QB,_l)}setColorWrite(e,t,i,s){this.redWrite=e,this.greenWrite=t,this.blueWrite=i,this.alphaWrite=s}get colorOp(){return St.get(this.target0,XB,M0)}get colorSrcFactor(){return St.get(this.target0,qB,_l)}get colorDstFactor(){return St.get(this.target0,YB,_l)}get alphaOp(){return St.get(this.target0,KB,M0)}get alphaSrcFactor(){return St.get(this.target0,ZB,_l)}get alphaDstFactor(){return St.get(this.target0,QB,_l)}set redWrite(e){this.target0=St.set(this.target0,e?1:0,SM)}get redWrite(){return St.all(this.target0,SM)}set greenWrite(e){this.target0=St.set(this.target0,e?1:0,JB)}get greenWrite(){return St.all(this.target0,JB)}set blueWrite(e){this.target0=St.set(this.target0,e?1:0,eU)}get blueWrite(){return St.all(this.target0,eU)}set alphaWrite(e){this.target0=St.set(this.target0,e?1:0,tU)}get alphaWrite(){return St.all(this.target0,tU)}get allWrite(){return St.get(this.target0,Rfe,Mfe)}copy(e){return this.target0=e.target0,this}clone(){return new this.constructor().copy(this)}get key(){return this.target0}equals(e){return this.target0===e.target0}};ua.NOBLEND=Object.freeze(new ua),ua.NOWRITE=Object.freeze(new ua(void 0,void 0,void 0,void 0,void 0,void 0,void 0,!1,!1,!1,!1)),ua.ALPHABLEND=Object.freeze(new ua(!0,Gn,IO,MO)),ua.ADDBLEND=Object.freeze(new ua(!0,Gn,br,br));let sr=ua;class l3{get(e){let t=this.map.get(e);return t===void 0&&(t=this.id++,this.map.set(e,t)),t}constructor(){this.map=new Map,this.id=0}}const Dfe=new l3,rU=7,sU=0,nU=3,Ol=class Ol{constructor(e=oM,t=!0){this.data=0,this._depthBias=0,this._depthBiasSlope=0,this.key=0,this.func=e,this.write=t}set test(e){this.func=e?oM:Lo,this.updateKey()}get test(){return this.func!==Lo}set write(e){this.data=St.set(this.data,e?1:0,nU),this.updateKey()}get write(){return St.all(this.data,nU)}set func(e){this.data=St.set(this.data,e,sU,rU),this.updateKey()}get func(){return St.get(this.data,sU,rU)}set depthBias(e){this._depthBias=e,this.updateKey()}get depthBias(){return this._depthBias}set depthBiasSlope(e){this._depthBiasSlope=e,this.updateKey()}get depthBiasSlope(){return this._depthBiasSlope}copy(e){return this.data=e.data,this._depthBias=e._depthBias,this._depthBiasSlope=e._depthBiasSlope,this.key=e.key,this}clone(){return new this.constructor().copy(this)}updateKey(){const{data:e,_depthBias:t,_depthBiasSlope:i}=this,s=`${e}-${t}-${i}`;this.key=Dfe.get(s)}equals(e){return this.key===e.key}};Ol.DEFAULT=Object.freeze(new Ol),Ol.NODEPTH=Object.freeze(new Ol(Lo,!1)),Ol.WRITEDEPTH=Object.freeze(new Ol(Lo,!0));let Ds=Ol,Yq=class{equals(e){return this.globalId===e.globalId&&this.revision===e.revision}copy(e){this.globalId=e.globalId,this.revision=e.revision}reset(){this.globalId=0,this.revision=0}constructor(){this.globalId=0,this.revision=0}},aU=0;class Lfe{constructor(){aU++,this.version=new Yq,this.version.globalId=aU}increment(){this.version.revision++}}class Ofe{constructor(e){this.name=e,this.value=null,this.versionObject=new Lfe}toJSON(e){}setValue(e){this.value=e,this.versionObject.increment()}getValue(){return this.value}}class Nfe{constructor(e){this.name=e,this.variables=new Map}resolve(e){return this.variables.has(e)||this.variables.set(e,new Ofe(e)),this.variables.get(e)}removeValue(e){for(const t in this.variables){const i=this.variables[t];i.value===e&&(i.value=null)}}}let kfe=0;class Ya{constructor(e,t,i,s){this.usage=Kn,this.usage=(s==null?void 0:s.usage)??Kn,this.device=e,this.format=t,this.numVertices=i,this.id=kfe++,this.impl=e.createVertexBufferImpl(this,t,s),this.numBytes=t.verticesByteSize?t.verticesByteSize:t.size*i,this.adjustVramSizeTracking(e._vram,this.numBytes);const n=s==null?void 0:s.data;n?this.setData(n):this.storage=new ArrayBuffer(this.numBytes),this.device.buffers.push(this)}destroy(){const e=this.device,t=e.buffers.indexOf(this);t!==-1&&e.buffers.splice(t,1),this.impl.initialized&&(this.impl.destroy(e),this.adjustVramSizeTracking(e._vram,-this.storage.byteLength))}adjustVramSizeTracking(e,t){e.vb+=t}loseContext(){this.impl.loseContext()}getFormat(){return this.format}getUsage(){return this.usage}getNumVertices(){return this.numVertices}lock(){return this.storage}unlock(){this.impl.unlock(this)}setData(e){return e.byteLength!==this.numBytes?!1:(this.storage=e,this.unlock(),!0)}}function Ia(r){if(r==null)return 0;let e=0;for(let t=0,i=r.length;t<i;t++)e=(e<<5)-e+r.charCodeAt(t),e|=0;return e}function Kq(r){let t=2166136261;for(let i=0;i<r.length;i++)t^=r[i],t*=16777619;return t>>>0}const Ffe=new l3,Bfe=[2,4,8,12,16],Ufe=new jr;class Ls{constructor(e,t,i){this.device=e,this._elements=[],this.hasUv0=!1,this.hasUv1=!1,this.hasColor=!1,this.hasTangents=!1,this.verticesByteSize=0,this.vertexCount=i,this.interleaved=i===void 0,this.instancing=!1,this.size=t.reduce((a,o)=>a+Math.ceil(o.components*Wg[o.type]/4)*4,0);let s=0,n;for(let a=0,o=t.length;a<o;a++){const l=t[a];n=l.components*Wg[l.type],i&&(s=Q.roundUp(s,n));const c=l.asInt??!1,u=c?!1:l.normalize??!1,h={name:l.semantic,offset:i?s:l.hasOwnProperty("offset")?l.offset:s,stride:i?n:l.hasOwnProperty("stride")?l.stride:this.size,dataType:l.type,numComponents:l.components,normalize:u,size:n,asInt:c};this._elements.push(h),i?s+=n*i:s+=Math.ceil(n/4)*4,l.semantic===un?this.hasUv0=!0:l.semantic===Oh?this.hasUv1=!0:l.semantic===wr?this.hasColor=!0:l.semantic===Xa&&(this.hasTangents=!0)}i&&(this.verticesByteSize=s),this._evaluateHash()}get elements(){return this._elements}static getDefaultInstancingFormat(e){return Ufe.get(e,()=>new Ls(e,[{semantic:JO,components:4,type:bt},{semantic:by,components:4,type:bt},{semantic:e3,components:4,type:bt},{semantic:ap,components:4,type:bt}]))}static isElementValid(e,t){const i=t.components*Wg[t.type];return!(e.isWebGPU&&!Bfe.includes(i))}update(){this._evaluateHash()}_evaluateHash(){const e=[],t=[],i=this._elements.length;for(let n=0;n<i;n++){const{name:a,dataType:o,numComponents:l,normalize:c,offset:u,stride:h,size:d,asInt:f}=this._elements[n],p=a+o+l+c+f;e.push(p);const m=p+u+h+d;t.push(m)}e.sort();const s=e.join();this.batchingHash=Ia(s),this.shaderProcessingHashString=s,this.renderingHashString=t.join("_"),this.renderingHash=Ffe.get(this.renderingHashString)}}const zfe=new l3,Jw=class Jw{set func(e){this._func=e,this._dirty=!0}get func(){return this._func}set ref(e){this._ref=e,this._dirty=!0}get ref(){return this._ref}set fail(e){this._fail=e,this._dirty=!0}get fail(){return this._fail}set zfail(e){this._zfail=e,this._dirty=!0}get zfail(){return this._zfail}set zpass(e){this._zpass=e,this._dirty=!0}get zpass(){return this._zpass}set readMask(e){this._readMask=e,this._dirty=!0}get readMask(){return this._readMask}set writeMask(e){this._writeMask=e,this._dirty=!0}get writeMask(){return this._writeMask}constructor(e={}){this._dirty=!0,this._func=e.func??Lo,this._ref=e.ref??0,this._readMask=e.readMask??255,this._writeMask=e.writeMask??255,this._fail=e.fail??Cf,this._zfail=e.zfail??Cf,this._zpass=e.zpass??Cf,this._evalKey()}_evalKey(){const{_func:e,_ref:t,_fail:i,_zfail:s,_zpass:n,_readMask:a,_writeMask:o}=this,l=`${e},${t},${i},${s},${n},${a},${o}`;this._key=zfe.get(l),this._dirty=!1}get key(){return this._dirty&&this._evalKey(),this._key}copy(e){return this._func=e._func,this._ref=e._ref,this._readMask=e._readMask,this._writeMask=e._writeMask,this._fail=e._fail,this._zfail=e._zfail,this._zpass=e._zpass,this._dirty=e._dirty,this._key=e._key,this}clone(){return new this.constructor().copy(this)}};Jw.DEFAULT=Object.freeze(new Jw);let Oa=Jw;const eT=class eT extends Te{constructor(e,t){var i,s,n,a,o,l;super(),this.backBuffer=null,this.backBufferSize=new ee,this.backBufferAntialias=!1,this.isWebGPU=!1,this.isWebGL2=!1,this.isHdr=!1,this.maxIndirectDrawCount=1024,this.maxColorAttachments=1,this.maxSamples=1,this.supportsCompute=!1,this.supportsStorageTextureRead=!1,this.renderTarget=null,this.shaders=[],this.textures=[],this.targets=new Set,this.renderVersion=0,this.insideRenderPass=!1,this.supportsUniformBuffers=!1,this.supportsClipDistances=!1,this.textureRG11B10Renderable=!1,this.textureFloatFilterable=!1,this.blendState=new sr,this.depthState=new Ds,this.stencilEnabled=!1,this.stencilFront=new Oa,this.stencilBack=new Oa,this.defaultClearOptions={color:[0,0,0,1],depth:1,stencil:0,flags:X_|q_},this.clientRect={width:0,height:0},this._shadersDirty=!1,this.capsDefines=new Map,this.mapsToClear=new Set,this.canvas=e,"setAttribute"in e&&e.setAttribute("data-engine",`PlayCanvas ${sq}`),this.initOptions={...t},(i=this.initOptions).alpha??(i.alpha=!0),(s=this.initOptions).depth??(s.depth=!0),(n=this.initOptions).stencil??(n.stencil=!0),(a=this.initOptions).antialias??(a.antialias=!0),(o=this.initOptions).powerPreference??(o.powerPreference="high-performance"),(l=this.initOptions).displayFormat??(l.displayFormat=_fe),this._maxPixelRatio=Ye.browser?Math.min(1,window.devicePixelRatio):1,this.buffers=[],this._vram={tex:0,vb:0,ib:0,ub:0,sb:0},this._shaderStats={vsCompiled:0,fsCompiled:0,linked:0,materialShaders:0,compileTime:0},this.initializeContextCaches(),this._drawCallsPerFrame=0,this._shaderSwitchesPerFrame=0,this._primsPerFrame=[];for(let c=_E;c<=zu;c++)this._primsPerFrame[c]=0;this._renderTargetCreationTime=0,this.scope=new Nfe("Device"),this.textureBias=this.scope.resolve("textureBias"),this.textureBias.setValue(0)}postInit(){const e=new Ls(this,[{semantic:Xe,components:2,type:bt}]),t=new Float32Array([-1,-1,1,-1,-1,1,1,1]);this.quadVertexBuffer=new Ya(this,e,4,{data:t})}initCapsDefines(){const{capsDefines:e}=this;e.clear(),this.textureFloatFilterable&&e.set("CAPS_TEXTURE_FLOAT_FILTERABLE",""),this.textureFloatRenderable&&e.set("CAPS_TEXTURE_FLOAT_RENDERABLE","")}destroy(){var e,t,i;this.fire("destroy"),(e=this.quadVertexBuffer)==null||e.destroy(),this.quadVertexBuffer=null,(t=this.dynamicBuffers)==null||t.destroy(),this.dynamicBuffers=null,(i=this.gpuProfiler)==null||i.destroy(),this.gpuProfiler=null}onDestroyShader(e){this.fire("destroy:shader",e);const t=this.shaders.indexOf(e);t!==-1&&this.shaders.splice(t,1)}postDestroy(){this.scope=null,this.canvas=null}loseContext(){var e;this.contextLost=!0,this.backBufferSize.set(-1,-1);for(const t of this.textures)t.loseContext();for(const t of this.buffers)t.loseContext();for(const t of this.targets)t.loseContext();(e=this.gpuProfiler)==null||e.loseContext()}restoreContext(){var e,t;this.contextLost=!1,this.initializeRenderState(),this.initializeContextCaches();for(const i of this.buffers)i.unlock();(t=(e=this.gpuProfiler)==null?void 0:e.restoreContext)==null||t.call(e)}toJSON(e){}initializeContextCaches(){this.vertexBuffers=[],this.shader=null,this.shaderValid=void 0,this.shaderAsyncCompile=!1,this.renderTarget=null}initializeRenderState(){this.blendState=new sr,this.depthState=new Ds,this.cullMode=oh,this.vx=this.vy=this.vw=this.vh=0,this.sx=this.sy=this.sw=this.sh=0,this.blendColor=new ae(0,0,0,0)}setStencilState(e,t){}setBlendState(e){}setBlendColor(e,t,i,s){}setDepthState(e){}setCullMode(e){}setRenderTarget(e){this.renderTarget=e}setVertexBuffer(e){e&&this.vertexBuffers.push(e)}clearVertexBuffer(){this.vertexBuffers.length=0}getIndirectDrawSlot(){return 0}get indirectDrawBuffer(){return null}getRenderTarget(){return this.renderTarget}initRenderTarget(e){e.initialized||(e.init(),this.targets.add(e))}draw(e,t,i,s,n=!0,a=!0){}_isBrowserInterface(e){return this._isImageBrowserInterface(e)||this._isImageCanvasInterface(e)||this._isImageVideoInterface(e)}_isImageBrowserInterface(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement}_isImageCanvasInterface(e){return typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement}_isImageVideoInterface(e){return typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement}resizeCanvas(e,t){const i=Math.min(this._maxPixelRatio,Ye.browser?window.devicePixelRatio:1),s=Math.floor(e*i),n=Math.floor(t*i);(s!==this.canvas.width||n!==this.canvas.height)&&this.setResolution(s,n)}setResolution(e,t){this.canvas.width=e,this.canvas.height=t,this.fire(eT.EVENT_RESIZE,e,t)}update(){this.updateClientRect()}updateClientRect(){if(Ye.worker)this.clientRect.width=this.canvas.width,this.clientRect.height=this.canvas.height;else{const e=this.canvas.getBoundingClientRect();this.clientRect.width=e.width,this.clientRect.height=e.height}}get width(){return this.canvas.width}get height(){return this.canvas.height}set fullscreen(e){}get fullscreen(){return!1}set maxPixelRatio(e){this._maxPixelRatio=e}get maxPixelRatio(){return this._maxPixelRatio}get deviceType(){return this._deviceType}startRenderPass(e){}endRenderPass(e){}startComputePass(e){}endComputePass(){}frameStart(){this.renderPassIndex=0,this.renderVersion++}frameEnd(){this.mapsToClear.forEach(e=>e.clear()),this.mapsToClear.clear()}computeDispatch(e,t="Unnamed"){}getRenderableHdrFormat(e=[np,wi,or],t=!0,i=1){for(let s=0;s<e.length;s++){const n=e[s];switch(n){case np:{if(this.textureRG11B10Renderable)return n;break}case wi:if(this.textureHalfFloatRenderable)return n;break;case or:if(this.isWebGPU&&i>1)continue;if(this.textureFloatRenderable&&(!t||this.textureFloatFilterable))return n;break}}}validateAttributes(e,t,i){}};eT.EVENT_RESIZE="resizecanvas";let xM=eT,Vfe=0;class Zi{constructor(e={}){var s,n,a,o,l;this.id=Vfe++;const t=((s=e.colorBuffer)==null?void 0:s.device)??((n=e.colorBuffers)==null?void 0:n[0].device)??((a=e.depthBuffer)==null?void 0:a.device)??e.graphicsDevice;this._device=t;const{maxSamples:i}=this._device;if(this._samples=Math.min(e.samples??1,i),t.isWebGPU&&(this._samples=this._samples>1?i:1),this._colorBuffer=e.colorBuffer,e.colorBuffer&&(this._colorBuffers=[e.colorBuffer]),this._depthBuffer=e.depthBuffer,this._face=e.face??0,this._depthBuffer){const c=this._depthBuffer._format;c===Bo||c===Af?(this._depth=!0,this._stencil=!1):c===uE?(this._depth=!0,this._stencil=!0):c===sl&&this._depthBuffer.device.isWebGPU&&this._samples>1?(this._depth=!0,this._stencil=!1):(this._depth=!1,this._stencil=!1)}else this._depth=e.depth??!0,this._stencil=e.stencil??!1;e.colorBuffers&&(this._colorBuffers||(this._colorBuffers=[...e.colorBuffers],this._colorBuffer=e.colorBuffers[0])),this.autoResolve=e.autoResolve??!0,this.name=e.name,this.name||(this.name=(o=this._colorBuffer)==null?void 0:o.name),this.name||(this.name=(l=this._depthBuffer)==null?void 0:l.name),this.name||(this.name="Untitled"),this.flipY=e.flipY??!1,this._mipLevel=e.mipLevel??0,this._mipLevel>0&&this._depth&&(this._mipLevel=0),this._mipmaps=e.mipLevel===void 0,this.validateMrt(),this.impl=t.createRenderTargetImpl(this)}destroy(){const e=this._device;e&&(e.targets.delete(this),e.renderTarget===this&&e.setRenderTarget(null),this.destroyFrameBuffers())}destroyFrameBuffers(){const e=this._device;e&&this.impl.destroy(e)}destroyTextureBuffers(){var e,t;(e=this._depthBuffer)==null||e.destroy(),this._depthBuffer=null,(t=this._colorBuffers)==null||t.forEach(i=>{i.destroy()}),this._colorBuffers=null,this._colorBuffer=null}resize(e,t){var i,s;if(this.width!==e||this.height!==t){if(this.mipLevel>0)return;const n=this._device;this.destroyFrameBuffers(),n.renderTarget===this&&n.setRenderTarget(null),(i=this._depthBuffer)==null||i.resize(e,t),(s=this._colorBuffers)==null||s.forEach(a=>{a.resize(e,t)}),this.validateMrt(),this.impl=n.createRenderTargetImpl(this)}}validateMrt(){}init(){this.impl.init(this._device,this)}get initialized(){return this.impl.initialized}get device(){return this._device}loseContext(){this.impl.loseContext()}resolve(e=!0,t=!!this._depthBuffer){this._device&&this._samples>1&&this.impl.resolve(this._device,this,e,t)}copy(e,t,i){if(!this._device)if(e._device)this._device=e._device;else return!1;return this._device.copyRenderTarget(e,this,t,i)}get samples(){return this._samples}get depth(){return this._depth}get stencil(){return this._stencil}get colorBuffer(){return this._colorBuffer}getColorBuffer(e){var t;return(t=this._colorBuffers)==null?void 0:t[e]}get depthBuffer(){return this._depthBuffer}get face(){return this._face}get mipLevel(){return this._mipLevel}get mipmaps(){return this._mipmaps}get width(){var t,i;let e=((t=this._colorBuffer)==null?void 0:t.width)||((i=this._depthBuffer)==null?void 0:i.width)||this._device.width;return this._mipLevel>0&&(e=zo.calcLevelDimension(e,this._mipLevel)),e}get height(){var t,i;let e=((t=this._colorBuffer)==null?void 0:t.height)||((i=this._depthBuffer)==null?void 0:i.height)||this._device.height;return this._mipLevel>0&&(e=zo.calcLevelDimension(e,this._mipLevel)),e}isColorBufferSrgb(e=0){if(this.device.backBuffer===this)return cb(this.device.backBufferFormat);const t=this.getColorBuffer(e);return t?cb(t.format):!1}}class DE{incRefCount(){this._refCount++}decRefCount(){this._refCount--}get refCount(){return this._refCount}constructor(){this._refCount=0}}class jfe extends DE{constructor(e){super(),this.object=e,this.incRefCount()}}class $fe{destroy(){this.cache.forEach(e=>{var t;(t=e.object)==null||t.destroy()}),this.cache.clear()}clear(){this.cache.clear()}get(e){const t=this.cache.get(e);return t?(t.incRefCount(),t.object):null}set(e,t){this.cache.set(e,new jfe(t))}release(e){var i;const t=this.cache.get(e);t&&(t.decRefCount(),t.refCount===0&&(this.cache.delete(e),(i=t.object)==null||i.destroy()))}constructor(){this.cache=new Map}}class Hfe extends $fe{loseContext(e){this.clear()}}const Gfe=new jr,eC=r=>Gfe.get(r,()=>new Hfe),Ai=[];Ai[zn]=1;Ai[hh]=2;Ai[vs]=3;Ai[op]=4;Ai[uh]=1;Ai[ju]=2;Ai[$u]=3;Ai[Hu]=4;Ai[Pf]=1;Ai[Q_]=2;Ai[J_]=3;Ai[ev]=4;Ai[hb]=8;Ai[lp]=12;Ai[Aa]=16;Ai[cp]=1;Ai[up]=2;Ai[hp]=3;Ai[dp]=4;class ci{get isArrayType(){return this.count>0}constructor(e,t,i=0){if(this.shortName=e,this.name=i?`${e}[0]`:e,this.type=t,this.numComponents=Ai[t],this.updateType=t,i>0)switch(t){case zn:this.updateType=bE;break;case uh:this.updateType=fp;break;case cp:this.updateType=EE;break;case Pf:this.updateType=AE;break;case hh:this.updateType=wE;break;case ju:this.updateType=pp;break;case up:this.updateType=CE;break;case Q_:this.updateType=PE;break;case vs:this.updateType=TE;break;case $u:this.updateType=mp;break;case hp:this.updateType=IE;break;case J_:this.updateType=ME;break;case op:this.updateType=i3;break;case Hu:this.updateType=db;break;case dp:this.updateType=r3;break;case ev:this.updateType=s3;break;case Aa:this.updateType=Nq;break}this.count=i;let s=this.numComponents;i&&(s=Q.roundUp(s,4)),this.byteSize=s*4,i&&(this.byteSize*=i)}calculateOffset(e){let t=this.byteSize<=8?this.byteSize:16;this.count&&(t=16),e=Q.roundUp(e,t),this.offset=e/4}}class Zq{constructor(e,t){this.byteSize=0,this.map=new Map,this.scope=e.scope,this.uniforms=t;let i=0;for(let s=0;s<t.length;s++){const n=t[s];n.calculateOffset(i),i=n.offset*4+n.byteSize,n.scopeId=this.scope.resolve(n.name),this.map.set(n.name,n)}this.byteSize=Q.roundUp(i,16)}get(e){return this.map.get(e)}}const yn=/[ \t]*#(ifn?def|if|endif|else|elif|define|undef|extension|include)/g,tC=/define[ \t]+([^\n]+)\r?(?:\n|$)/g,oU=/extension[ \t]+([\w-]+)[ \t]*:[ \t]*(enable|require)/g,iC=/undef[ \t]+([^\n]+)\r?(?:\n|$)/g,rC=/(ifdef|ifndef|if)[ \t]*([^\r\n]+)\r?\n/g,sC=/(endif|else|elif)(?:[ \t]+([^\r\n]*))?\r?\n?/g,lU=/\{?[\w-]+\}?/,Wfe=/(!|\s)?defined\(([\w-]+)\)/,Xfe=/([a-z_]\w*)\s*(==|!=|<|<=|>|>=)\s*([\w"']+)/i,qfe=/[+\-]/g,nC=/include[ \t]+"([\w-]+)(?:\s*,\s*([\w-]+))?"/g,Yfe=/\{i\}/g,cU=/(pcFragColor[1-8])\b/g;class _r{static run(e,t=new Map,i={}){_r.sourceName=i.sourceName,e=this.stripComments(e),e=e.split(/\r?\n/).map(o=>o.trimEnd()).join(`
`);const s=new Map,n=new Map;if(e=this._preprocess(e,s,n,t,i.stripDefines),e===null)return null;const a=new Map;return s.forEach((o,l)=>{Number.isInteger(parseFloat(o))&&!o.includes(".")&&a.set(l,o)}),e=this.stripComments(e),e=this.stripUnusedColorAttachments(e,i),e=this.RemoveEmptyLines(e),e=this.processArraySize(e,a),e=this.injectDefines(e,n),e}static stripUnusedColorAttachments(e,t){if(t.stripUnusedColorAttachments){const i=new Map,s=e.match(cU);if(s==null||s.forEach(a=>{const o=parseInt(a.charAt(a.length-1),10);i.set(o,(i.get(o)??0)+1)}),Array.from(i.values()).some(a=>a===1)){const a=e.split(`
`),o=[];for(let l=0;l<a.length;l++){const c=a[l].match(cU);if(c){const u=parseInt(c[0].charAt(c[0].length-1),10);if(u>0&&i.get(u)===1)continue}o.push(a[l])}e=o.join(`
`)}}return e}static stripComments(e){return e.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,"$1")}static processArraySize(e,t){return e!==null&&t.forEach((i,s)=>{e=e.replace(new RegExp(`\\[${s}\\]`,"g"),`[${i}]`)}),e}static injectDefines(e,t){if(e!==null&&t.size>0){const i=e.split(`
`);t.forEach((s,n)=>{const a=new RegExp(n,"g");for(let o=0;o<i.length;o++)i[o].includes("#")||(i[o]=i[o].replace(a,s))}),e=i.join(`
`)}return e}static RemoveEmptyLines(e){return e!==null&&(e=e.split(/\r?\n/).map(t=>t.trim()===""?"":t).join(`
`),e=e.replace(/(\n\n){3,}/g,`

`)),e}static _preprocess(e,t=new Map,i,s,n){var u;const a=e,o=[];let l=!1,c;for(;(c=yn.exec(e))!==null&&!l;){const h=c[1];switch(h){case"define":{tC.lastIndex=c.index;const d=tC.exec(e);l||(l=d===null);const f=d[1];lU.lastIndex=d.index;const m=lU.exec(f)[0];let g=f.substring(m.length).trim();g===""&&(g="true");const _=_r._keep(o);let v=n;if(_){const y=m.startsWith("{")&&m.endsWith("}");y&&(v=!0),y?i.set(m,g):t.set(m,g),v&&(e=e.substring(0,d.index-1)+e.substring(tC.lastIndex),yn.lastIndex=d.index-1)}v||(yn.lastIndex=d.index+d[0].length);break}case"undef":{iC.lastIndex=c.index;const d=iC.exec(e),f=d[1].trim();_r._keep(o)&&(t.delete(f),n&&(e=e.substring(0,d.index-1)+e.substring(iC.lastIndex),yn.lastIndex=d.index-1)),n||(yn.lastIndex=d.index+d[0].length);break}case"extension":{oU.lastIndex=c.index;const d=oU.exec(e);if(l||(l=d===null),d){const f=d[1];_r._keep(o)&&t.set(f,"true")}yn.lastIndex=d.index+d[0].length;break}case"ifdef":case"ifndef":case"if":{rC.lastIndex=c.index;const d=rC.exec(e),f=d[2],p=_r.evaluate(f,t);l||(l=p.error);let m=p.result;h==="ifndef"&&(m=!m),o.push({anyKeep:m,keep:m,start:c.index,end:rC.lastIndex}),yn.lastIndex=d.index+d[0].length;break}case"endif":case"else":case"elif":{sC.lastIndex=c.index;const d=sC.exec(e),f=o.pop();if(!f){console.error(`Shader preprocessing encountered "#${d[1]}" without a preceding #if #ifdef #ifndef while preprocessing ${_r.sourceName} on line:
 ${e.substring(c.index,c.index+100)}...`,{source:a}),l=!0;continue}const p=f.keep?e.substring(f.end,c.index):"";e=e.substring(0,f.start)+p+e.substring(sC.lastIndex),yn.lastIndex=f.start+p.length;const m=d[1];if(m==="else"||m==="elif"){let g=!1;if(!f.anyKeep)if(m==="else")g=!f.keep;else{const _=_r.evaluate(d[2],t);g=_.result,l||(l=_.error)}o.push({anyKeep:f.anyKeep||g,keep:g,start:yn.lastIndex,end:yn.lastIndex})}break}case"include":{nC.lastIndex=c.index;const d=nC.exec(e);if(l||(l=d===null),!d){l=!0;continue}const f=d[1].trim(),p=(u=d[2])==null?void 0:u.trim();if(_r._keep(o)){let g=s==null?void 0:s.get(f);if(g!==void 0){if(g=this.stripComments(g),p){const _=t.get(p),v=parseFloat(_);if(Number.isInteger(v)){let y="";for(let x=0;x<v;x++)y+=g.replace(Yfe,String(x));g=y}else console.error(`Include Count identifier "${p}" not resolved while preprocessing ${_r.sourceName} on line:
 ${e.substring(c.index,c.index+100)}...`,{originalSource:a,source:e}),l=!0}e=e.substring(0,d.index-1)+g+e.substring(nC.lastIndex),yn.lastIndex=d.index-1}else{console.error(`Include "${f}" not resolved while preprocessing ${_r.sourceName}`,{originalSource:a,source:e}),l=!0;continue}}break}}}return o.length>0&&(console.error(`Shader preprocessing reached the end of the file without encountering the necessary #endif to close a preceding #if, #ifdef, or #ifndef block. ${_r.sourceName}`),l=!0),l?(console.error("Failed to preprocess shader: ",{source:a}),null):e}static _keep(e){for(let t=0;t<e.length;t++)if(!e[t].keep)return!1;return!0}static evaluateAtomicExpression(e,t){let i=!1;e=e.trim();let s=!1;const n=Wfe.exec(e);if(n){s=n[1]==="!",e=n[2].trim();const l=t.has(e);return{result:s?!l:l,error:i}}const a=Xfe.exec(e);if(a){const l=t.get(a[1].trim())??a[1].trim(),c=t.get(a[3].trim())??a[3].trim(),u=a[2].trim();let h=!1;switch(u){case"==":h=l===c;break;case"!=":h=l!==c;break;case"<":h=l<c;break;case"<=":h=l<=c;break;case">":h=l>c;break;case">=":h=l>=c;break;default:i=!0}return{result:h,error:i}}return{result:t.has(e),error:i}}static evaluate(e,t){const i=qfe.exec(e)===null,s=e.split("||");for(const n of s){const a=n.split("&&");let o=!0;for(const l of a){const{result:c,error:u}=_r.evaluateAtomicExpression(l.trim(),t);if(!c||u){o=!1;break}}if(o)return{result:!0,error:!i}}return{result:!1,error:!i}}}var Qq=`
#ifndef outType_0
#define outType_0 vec4
#endif
layout(location = 0) out highp outType_0 pcFragColor0;
#if COLOR_ATTACHMENT_1
layout(location = 1) out highp outType_1 pcFragColor1;
#endif
#if COLOR_ATTACHMENT_2
layout(location = 2) out highp outType_2 pcFragColor2;
#endif
#if COLOR_ATTACHMENT_3
layout(location = 3) out highp outType_3 pcFragColor3;
#endif
#if COLOR_ATTACHMENT_4
layout(location = 4) out highp outType_4 pcFragColor4;
#endif
#if COLOR_ATTACHMENT_5
layout(location = 5) out highp outType_5 pcFragColor5;
#endif
#if COLOR_ATTACHMENT_6
layout(location = 6) out highp outType_6 pcFragColor6;
#endif
#if COLOR_ATTACHMENT_7
layout(location = 7) out highp outType_7 pcFragColor7;
#endif
#define gl_FragColor pcFragColor0
#define varying in
#define texture2D texture
#define texture2DBias texture
#define textureCube texture
#define texture2DProj textureProj
#define texture2DLod textureLod
#define texture2DProjLod textureProjLod
#define textureCubeLod textureLod
#define texture2DGrad textureGrad
#define texture2DProjGrad textureProjGrad
#define textureCubeGrad textureGrad
#define utexture2D texture
#define itexture2D texture
#define texture2DLodEXT texture2DLodEXT_is_no_longer_supported_use_texture2DLod_instead
#define texture2DProjLodEXT texture2DProjLodEXT_is_no_longer_supported_use_texture2DProjLod
#define textureCubeLodEXT textureCubeLodEXT_is_no_longer_supported_use_textureCubeLod_instead
#define texture2DGradEXT texture2DGradEXT_is_no_longer_supported_use_texture2DGrad_instead
#define texture2DProjGradEXT texture2DProjGradEXT_is_no_longer_supported_use_texture2DProjGrad_instead
#define textureCubeGradEXT textureCubeGradEXT_is_no_longer_supported_use_textureCubeGrad_instead
#define textureShadow(res, uv) textureGrad(res, uv, vec2(1, 1), vec2(1, 1))
#define SHADOWMAP_PASS(name) name
#define SHADOWMAP_ACCEPT(name) sampler2DShadow name
#define TEXTURE_PASS(name) name
#define TEXTURE_ACCEPT(name) sampler2D name
#define TEXTURE_ACCEPT_HIGHP(name) highp sampler2D name
#define GL2
`,Jq=`
#define attribute in
#define varying out
#define texture2D texture
#define utexture2D texture
#define itexture2D texture
#define GL2
#define VERTEXSHADER
#define TEXTURE_PASS(name) name
#define TEXTURE_ACCEPT(name) sampler2D name
#define TEXTURE_ACCEPT_HIGHP(name) highp sampler2D name
`,e9=`
#extension GL_EXT_samplerless_texture_functions : require
#ifndef outType_0
#define outType_0 vec4
#endif
#ifndef outType_1
#define outType_1 vec4
#endif
#ifndef outType_2
#define outType_2 vec4
#endif
#ifndef outType_3
#define outType_3 vec4
#endif
#ifndef outType_4
#define outType_4 vec4
#endif
#ifndef outType_5
#define outType_5 vec4
#endif
#ifndef outType_6
#define outType_6 vec4
#endif
#ifndef outType_7
#define outType_7 vec4
#endif
layout(location = 0) out highp outType_0 pcFragColor0;
layout(location = 1) out highp outType_1 pcFragColor1;
layout(location = 2) out highp outType_2 pcFragColor2;
layout(location = 3) out highp outType_3 pcFragColor3;
layout(location = 4) out highp outType_4 pcFragColor4;
layout(location = 5) out highp outType_5 pcFragColor5;
layout(location = 6) out highp outType_6 pcFragColor6;
layout(location = 7) out highp outType_7 pcFragColor7;
#define gl_FragColor pcFragColor0
#define texture2D(res, uv) texture(sampler2D(res, res ## _sampler), uv)
#define texture2DBias(res, uv, bias) texture(sampler2D(res, res ## _sampler), uv, bias)
#define texture2DLod(res, uv, lod) textureLod(sampler2D(res, res ## _sampler), uv, lod)
#define textureCube(res, uv) texture(samplerCube(res, res ## _sampler), uv)
#define textureCubeLod(res, uv, lod) textureLod(samplerCube(res, res ## _sampler), uv, lod)
#define textureShadow(res, uv) textureLod(sampler2DShadow(res, res ## _sampler), uv, 0.0)
#define itexture2D(res, uv) texture(isampler2D(res, res ## _sampler), uv)
#define utexture2D(res, uv) texture(usampler2D(res, res ## _sampler), uv)
#define texture2DLodEXT texture2DLodEXT_is_no_longer_supported_use_texture2DLod_instead
#define texture2DProjLodEXT texture2DProjLodEXT_is_no_longer_supported_use_texture2DProjLod
#define textureCubeLodEXT textureCubeLodEXT_is_no_longer_supported_use_textureCubeLod_instead
#define texture2DGradEXT texture2DGradEXT_is_no_longer_supported_use_texture2DGrad_instead
#define texture2DProjGradEXT texture2DProjGradEXT_is_no_longer_supported_use_texture2DProjGrad_instead
#define textureCubeGradEXT textureCubeGradEXT_is_no_longer_supported_use_textureCubeGrad_instead
#define SHADOWMAP_PASS(name) name, name ## _sampler
#define SHADOWMAP_ACCEPT(name) texture2D name, sampler name ## _sampler
#define TEXTURE_PASS(name) name, name ## _sampler
#define TEXTURE_ACCEPT(name) texture2D name, sampler name ## _sampler
#define TEXTURE_ACCEPT_HIGHP TEXTURE_ACCEPT
#define GL2
#define WEBGPU
`,t9=`
#extension GL_EXT_samplerless_texture_functions : require
#define texture2D(res, uv) texture(sampler2D(res, res ## _sampler), uv)
#define itexture2D(res, uv) texture(isampler2D(res, res ## _sampler), uv)
#define utexture2D(res, uv) texture(usampler2D(res, res ## _sampler), uv)
#define TEXTURE_PASS(name) name, name ## _sampler
#define TEXTURE_ACCEPT(name) texture2D name, sampler name ## _sampler
#define TEXTURE_ACCEPT_HIGHP TEXTURE_ACCEPT
#define GL2
#define WEBGPU
#define VERTEXSHADER
#define gl_VertexID gl_VertexIndex
#define gl_InstanceID gl_InstanceIndex
`,i9=`
`,r9=`
#define VERTEXSHADER
`,uU=`
vec2 getGrabScreenPos(vec4 clipPos) {
	vec2 uv = (clipPos.xy / clipPos.w) * 0.5 + 0.5;
	#ifdef WEBGPU
		uv.y = 1.0 - uv.y;
	#endif
	return uv;
}
vec2 getImageEffectUV(vec2 uv) {
	#ifdef WEBGPU
		uv.y = 1.0 - uv.y;
	#endif
	return uv;
}
`,hU=`
fn getGrabScreenPos(clipPos: vec4<f32>) -> vec2<f32> {
	var uv: vec2<f32> = (clipPos.xy / clipPos.w) * 0.5 + vec2<f32>(0.5);
	uv.y = 1.0 - uv.y;
	return uv;
}
fn getImageEffectUV(uv: vec2<f32>) -> vec2<f32> {
	var modifiedUV: vec2<f32> = uv;
	modifiedUV.y = 1.0 - modifiedUV.y;
	return modifiedUV;
}
struct WrappedF32 { @size(16) element: f32 }
struct WrappedI32 { @size(16) element: i32 }
struct WrappedU32 { @size(16) element: u32 }
struct WrappedVec2F { @size(16) element: vec2f }
struct WrappedVec2I { @size(16) element: vec2i }
struct WrappedVec2U { @size(16) element: vec2u }
`;const Kfe={vertex_position:Xe,vertex_normal:Rs,vertex_tangent:Xa,vertex_texCoord0:un,vertex_texCoord1:Oh,vertex_texCoord2:gy,vertex_texCoord3:_y,vertex_texCoord4:vy,vertex_texCoord5:yy,vertex_texCoord6:Sy,vertex_texCoord7:xy,vertex_color:wr,vertex_boneIndices:Es,vertex_boneWeights:za};class Wr{static createDefinition(e,t){const i=(u,h,d,f)=>{const p=e.isWebGPU?u:h;let m="";if(!d){let g=f.fragmentOutputTypes??"vec4";Array.isArray(g)||(g=[g]);for(let _=0;_<e.maxColorAttachments;_++){m+=`#define COLOR_ATTACHMENT_${_}
`;const v=g[_]??"vec4";m+=`#define outType_${_} ${v}
`}}return m+p},s=t.name??"Untitled";let n,a;const o=Wr.getDefinesCode(e,t.vertexDefines),l=Wr.getDefinesCode(e,t.fragmentDefines);return t.shaderLanguage===Gt?(n=`
								${r9}
								${hU}
								${o}
								${t.vertexCode}
						`,a=`
								${i9}
								${hU}
								${l}
								${t.fragmentCode}
						`):(n=`${Wr.versionCode(e)+i(t9,Jq,!0,t)+o+Wr.precisionCode(e)}
								${uU}
								${Wr.getShaderNameCode(s)}
								${t.vertexCode}`,a=`${(t.fragmentPreamble||"")+Wr.versionCode(e)+i(e9,Qq,!1,t)+l+Wr.precisionCode(e)}
								${uU}
								${Wr.getShaderNameCode(s)}
								${t.fragmentCode}`),{name:s,shaderLanguage:t.shaderLanguage??dt,attributes:t.attributes,vshader:n,vincludes:t.vertexIncludes,fincludes:t.fragmentIncludes,fshader:a,useTransformFeedback:t.useTransformFeedback,meshUniformBufferFormat:t.meshUniformBufferFormat,meshBindGroupFormat:t.meshBindGroupFormat}}static getDefinesCode(e,t){let i="";return e.capsDefines.forEach((s,n)=>{i+=`#define ${n} ${s}
`}),i+=`
`,t==null||t.forEach((s,n)=>{i+=`#define ${n} ${s}
`}),i+=`
`,i}static getShaderNameCode(e){return`#define SHADER_NAME ${e}
`}static versionCode(e){return e.isWebGPU?`#version 450
`:`#version 300 es
`}static precisionCode(e,t){t&&t!=="highp"&&t!=="mediump"&&t!=="lowp"&&(t=null),t&&(t==="highp"&&e.maxPrecision!=="highp"&&(t="mediump"),t==="mediump"&&e.maxPrecision==="lowp"&&(t="lowp"));const i=t||e.precision;return`
						precision ${i} float;
						precision ${i} int;
						precision ${i} usampler2D;
						precision ${i} isampler2D;
						precision ${i} sampler2DShadow;
						precision ${i} samplerCubeShadow;
						precision ${i} sampler2DArray;
				`}static collectAttributes(e){const t={};let i=0,s=e.indexOf("attribute");for(;s>=0&&!(s>0&&e[s-1]==="/");){let n=!1;if(s>0){let a=e.lastIndexOf(`
`,s);a=a!==-1?a+1:0,e.substring(a,s).includes("#")&&(n=!0)}if(!n){const a=e.indexOf(";",s),o=e.lastIndexOf(" ",a),l=e.substring(o+1,a);if(!t[l]){const c=Kfe[l];c!==void 0?t[l]=c:(t[l]=`ATTR${i}`,i++)}}s=e.indexOf("attribute",s+1)}return t}}let Zfe=0;class s9{constructor(e,t){if(this.attributes=new Map,this.id=Zfe++,this.device=e,this.definition=t,this.name=t.name||"Untitled",this.init(),t.cshader)t.cshader=_r.run(t.cshader,t.cincludes,{sourceName:`compute shader for ${this.label}`,stripDefines:!0});else{const i=t.shaderLanguage===Gt;t.vshader=_r.run(t.vshader,t.vincludes,{sourceName:`vertex shader for ${this.label}`,stripDefines:i}),t.shaderLanguage===dt&&(t.attributes??(t.attributes=Wr.collectAttributes(t.vshader)));const s=e.isWebGL2&&(Ye.name==="osx"||Ye.name==="ios");if(t.fshader=_r.run(t.fshader,t.fincludes,{stripUnusedColorAttachments:s,stripDefines:i,sourceName:`fragment shader for ${this.label}`}),!t.vshader||!t.fshader){this.failed=!0;return}}this.impl=e.createShaderImpl(this)}init(){this.ready=!1,this.failed=!1}get label(){return`Shader Id ${this.id} (${this.definition.shaderLanguage===Gt?"WGSL":"GLSL"}) ${this.name}`}destroy(){this.device.onDestroyShader(this),this.impl.destroy(this)}loseContext(){this.init(),this.impl.loseContext()}restoreContext(){this.impl.restoreContext(this.device,this)}}class Qfe{}const ut=[];ut[zn]=function(r,e,t){const i=r.storageFloat32;i[t]=e};ut[hh]=(r,e,t)=>{const i=r.storageFloat32;i[t]=e[0],i[t+1]=e[1]};ut[vs]=(r,e,t)=>{const i=r.storageFloat32;i[t]=e[0],i[t+1]=e[1],i[t+2]=e[2]};ut[op]=(r,e,t)=>{const i=r.storageFloat32;i[t]=e[0],i[t+1]=e[1],i[t+2]=e[2],i[t+3]=e[3]};ut[uh]=function(r,e,t){const i=r.storageInt32;i[t]=e};ut[ju]=function(r,e,t){const i=r.storageInt32;i[t]=e[0],i[t+1]=e[1]};ut[$u]=function(r,e,t){const i=r.storageInt32;i[t]=e[0],i[t+1]=e[1],i[t+2]=e[2]};ut[Hu]=function(r,e,t){const i=r.storageInt32;i[t]=e[0],i[t+1]=e[1],i[t+2]=e[2],i[t+3]=e[3]};ut[hb]=(r,e,t)=>{const i=r.storageFloat32;i[t]=e[0],i[t+1]=e[1],i[t+4]=e[2],i[t+5]=e[3],i[t+8]=e[4],i[t+9]=e[5]};ut[lp]=(r,e,t)=>{const i=r.storageFloat32;i[t]=e[0],i[t+1]=e[1],i[t+2]=e[2],i[t+4]=e[3],i[t+5]=e[4],i[t+6]=e[5],i[t+8]=e[6],i[t+9]=e[7],i[t+10]=e[8]};ut[bE]=function(r,e,t,i){const s=r.storageFloat32;for(let n=0;n<i;n++)s[t+n*4]=e[n]};ut[wE]=(r,e,t,i)=>{const s=r.storageFloat32;for(let n=0;n<i;n++)s[t+n*4]=e[n*2],s[t+n*4+1]=e[n*2+1]};ut[TE]=(r,e,t,i)=>{const s=r.storageFloat32;for(let n=0;n<i;n++)s[t+n*4]=e[n*3],s[t+n*4+1]=e[n*3+1],s[t+n*4+2]=e[n*3+2]};ut[cp]=(r,e,t,i)=>{const s=r.storageUint32;s[t]=e};ut[up]=(r,e,t,i)=>{const s=r.storageUint32;s[t]=e[0],s[t+1]=e[1]};ut[hp]=(r,e,t,i)=>{const s=r.storageUint32;s[t]=e[0],s[t+1]=e[1],s[t+2]=e[2]};ut[dp]=(r,e,t,i)=>{const s=r.storageUint32;s[t]=e[0],s[t+1]=e[1],s[t+2]=e[2],s[t+3]=e[3]};ut[fp]=function(r,e,t,i){const s=r.storageInt32;for(let n=0;n<i;n++)s[t+n*4]=e[n]};ut[AE]=ut[fp];ut[EE]=function(r,e,t,i){const s=r.storageUint32;for(let n=0;n<i;n++)s[t+n*4]=e[n]};ut[pp]=(r,e,t,i)=>{const s=r.storageInt32;for(let n=0;n<i;n++)s[t+n*4]=e[n*2],s[t+n*4+1]=e[n*2+1]};ut[PE]=ut[pp];ut[CE]=(r,e,t,i)=>{const s=r.storageUint32;for(let n=0;n<i;n++)s[t+n*4]=e[n*2],s[t+n*4+1]=e[n*2+1]};ut[mp]=(r,e,t,i)=>{const s=r.storageInt32;for(let n=0;n<i;n++)s[t+n*4]=e[n*3],s[t+n*4+1]=e[n*3+1],s[t+n*4+2]=e[n*3+2]};ut[ME]=ut[mp];ut[IE]=(r,e,t,i)=>{const s=r.storageUint32;for(let n=0;n<i;n++)s[t+n*4]=e[n*3],s[t+n*4+1]=e[n*3+1],s[t+n*4+2]=e[n*3+2]};class c3{constructor(e,t,i=!0){if(this.renderVersionDirty=0,this.device=e,this.format=t,this.persistent=i,i){this.impl=e.createUniformBufferImpl(this);const s=new ArrayBuffer(t.byteSize);this.assignStorage(new Int32Array(s)),e._vram.ub+=this.format.byteSize}else this.allocation=new Qfe}destroy(){if(this.persistent){const e=this.device;this.impl.destroy(e),e._vram.ub-=this.format.byteSize}}get offset(){return this.persistent?0:this.allocation.offset}assignStorage(e){this.storageInt32=e,this.storageUint32=new Uint32Array(e.buffer,e.byteOffset,e.byteLength/4),this.storageFloat32=new Float32Array(e.buffer,e.byteOffset,e.byteLength/4)}loseContext(){var e;(e=this.impl)==null||e.loseContext()}setUniform(e,t){const i=e.offset;if(t!=null){const s=ut[e.updateType];s?s(this,t,i,e.count):this.storageFloat32.set(t,i)}}set(e,t){const i=this.format.map.get(e);i&&this.setUniform(i,t)}startUpdate(e){if(!this.persistent){const t=this.allocation,i=t.gpuBuffer;this.device.dynamicBuffers.alloc(t,this.format.byteSize),this.assignStorage(t.storage),e&&(e.bindGroup=t.gpuBuffer.getBindGroup(this),e.offsets[0]=t.offset),i!==t.gpuBuffer&&(this.renderVersionDirty=this.device.renderVersion)}}endUpdate(){this.persistent?this.impl.unlock(this):(this.storageFloat32=null,this.storageInt32=null)}update(e){this.startUpdate(e);const t=this.format.uniforms;for(let i=0;i<t.length;i++){const s=t[i].scopeId.value;this.setUniform(t[i],s)}this.endUpdate()}}class Jfe{loseContext(){this.pastFrameAllocations.clear()}set enabled(e){this._enableRequest=e}get enabled(){return this._enableRequest}processEnableRequest(){this._enableRequest!==this._enabled&&(this._enabled=this._enableRequest,this._enabled||(this._frameTime=0))}request(e){this.pastFrameAllocations.set(e,this.frameAllocations),this.frameAllocations=[]}report(e,t){if(t){const i=this.pastFrameAllocations.get(e);if(t.length>0&&(this._frameTime=t.reduce((s,n)=>s+n,0)),sM.get(ide)){let s=0;for(let n=0;n<i.length;++n)i[n],s+=t[n]}}this.pastFrameAllocations.delete(e)}getSlot(e){const t=this.frameAllocations.length;return this.frameAllocations.push(e),t}get slotCount(){return this.frameAllocations.length}constructor(){this.frameAllocations=[],this.pastFrameAllocations=new Map,this._enabled=!1,this._enableRequest=!1,this._frameTime=0}}class n9{destroy(e){this.bufferId&&(e.gl.deleteBuffer(this.bufferId),this.bufferId=null)}get initialized(){return!!this.bufferId}loseContext(){this.bufferId=null}unlock(e,t,i,s){const n=e.gl;if(this.bufferId)n.bindBuffer(i,this.bufferId),n.bufferSubData(i,0,s);else{let a;switch(t){case Kn:a=n.STATIC_DRAW;break;case nb:a=n.DYNAMIC_DRAW;break;case Rde:a=n.STREAM_DRAW;break;case Dde:a=n.DYNAMIC_COPY;break}this.bufferId=n.createBuffer(),n.bindBuffer(i,this.bufferId),n.bufferData(i,s,a)}}constructor(){this.bufferId=null}}class epe extends n9{destroy(e){super.destroy(e),e.unbindVertexArray()}loseContext(){super.loseContext(),this.vao=null}unlock(e){const t=e.device;super.unlock(t,e.usage,t.gl.ARRAY_BUFFER,e.storage)}constructor(...e){super(...e),this.vao=null}}class tpe extends n9{constructor(e){super();const t=e.device.gl,i=e.format;i===lM?this.glFormat=t.UNSIGNED_BYTE:i===xc?this.glFormat=t.UNSIGNED_SHORT:i===bc&&(this.glFormat=t.UNSIGNED_INT)}unlock(e){const t=e.device;super.unlock(t,e.usage,t.gl.ELEMENT_ARRAY_BUFFER,e.storage)}}class ipe{constructor(e,t,i,s){if(this.locationId=s,this.scopeId=e.scope.resolve(t),this.version=new Yq,t.substring(t.length-3)==="[0]")switch(i){case zn:i=bE;break;case uh:i=fp;break;case cp:i=EE;break;case Pf:i=AE;break;case hh:i=wE;break;case ju:i=pp;break;case up:i=CE;break;case Q_:i=PE;break;case vs:i=TE;break;case $u:i=mp;break;case hp:i=IE;break;case J_:i=ME;break;case op:i=i3;break;case Hu:i=db;break;case dp:i=r3;break;case ev:i=s3;break}this.dataType=i,this.value=[null,null,null,null],this.array=[]}}const rpe=new Set(["gl_VertexID","gl_InstanceID","gl_DrawID","gl_BaseVertex","gl_BaseInstance"]);class spe{destroy(e){this.map.forEach(t=>{e.gl.deleteShader(t)})}loseContext(e){this.map.clear()}constructor(){this.map=new Map}}const npe=new jr,ape=new jr;class ope{constructor(e){this.compileDuration=0,this.init(),this.compile(e.device,e),this.link(e.device,e),e.device.shaders.push(e)}destroy(e){this.glProgram&&(e.device.gl.deleteProgram(this.glProgram),this.glProgram=null)}init(){this.uniforms=[],this.samplers=[],this.attributes=[],this.glProgram=null,this.glVertexShader=null,this.glFragmentShader=null}loseContext(){this.init()}restoreContext(e,t){this.compile(e,t),this.link(e,t)}compile(e,t){const i=t.definition;this.glVertexShader=this._compileShaderSource(e,i.vshader,!0),this.glFragmentShader=this._compileShaderSource(e,i.fshader,!1)}link(e,t){if(this.glProgram)return;const i=e.gl;if(i.isContextLost())return;const s=i.createProgram();this.glProgram=s,i.attachShader(s,this.glVertexShader),i.attachShader(s,this.glFragmentShader);const n=t.definition,a=n.attributes;if(n.useTransformFeedback){const o=[];for(const l in a)a.hasOwnProperty(l)&&o.push(`out_${l}`);i.transformFeedbackVaryings(s,o,i.INTERLEAVED_ATTRIBS)}for(const o in a)if(a.hasOwnProperty(o)){const l=a[o],c=rt[l];i.bindAttribLocation(s,c,o)}i.linkProgram(s)}_compileShaderSource(e,t,i){const s=e.gl;if(s.isContextLost())return null;const a=(i?npe:ape).get(e,()=>new spe);let o=a.map.get(t);return o||(o=s.createShader(i?s.VERTEX_SHADER:s.FRAGMENT_SHADER),s.shaderSource(o,t),s.compileShader(o),a.map.set(t,o)),o}finalize(e,t){const i=e.gl;if(i.isContextLost())return!0;const s=this.glProgram,n=t.definition;if(!i.getProgramParameter(s,i.LINK_STATUS)){if(!this._isCompiled(e,t,this.glVertexShader,n.vshader,"vertex")||!this._isCompiled(e,t,this.glFragmentShader,n.fshader,"fragment"))return!1;const u=`Failed to link shader program. Error: ${i.getProgramInfoLog(s)}`;return console.error(u),!1}const o=i.getProgramParameter(s,i.ACTIVE_ATTRIBUTES);t.attributes.clear();for(let u=0;u<o;u++){const h=i.getActiveAttrib(s,u),d=i.getAttribLocation(s,h.name);rpe.has(h.name)||(n.attributes[h.name]===void 0?(console.error(`Vertex shader attribute "${h.name}" is not mapped to a semantic in shader definition, shader [${t.label}]`,t),t.failed=!0):t.attributes.set(d,h.name))}const l=e._samplerTypes,c=i.getProgramParameter(s,i.ACTIVE_UNIFORMS);for(let u=0;u<c;u++){const h=i.getActiveUniform(s,u),d=i.getUniformLocation(s,h.name),f=new ipe(e,h.name,e.pcUniformType[h.type],d);l.has(h.type)?this.samplers.push(f):this.uniforms.push(f)}return t.ready=!0,!0}_isCompiled(e,t,i,s,n){const a=e.gl;if(!a.getShaderParameter(i,a.COMPILE_STATUS)){const o=a.getShaderInfoLog(i),[l,c]=this._processError(s,o),u=`Failed to compile ${n} shader:

${o}
${l} while rendering undefined`;return console.error(u),!1}return!0}isLinked(e){const{extParallelShaderCompile:t}=e;return t?e.gl.getProgramParameter(this.glProgram,t.COMPLETION_STATUS_KHR):!0}_processError(e,t){const i={};let s="";if(e){const n=e.split(`
`);let a=0,o=n.length;if(t&&t.startsWith("ERROR:")){const l=t.match(/^ERROR:\s(\d+):(\d+):\s*(.+)/);l&&(i.message=l[3],i.line=parseInt(l[2],10),a=Math.max(0,i.line-6),o=Math.min(n.length,i.line+5))}for(let l=a;l<o;l++){const c=l+1===i.line?"> ":"  ";s+=`${c}${l+1}:	${n[l]}
`}i.source=e}return[s,i]}}function dU(r,e){const t=r.width,i=r.height;if(t>e||i>e){const s=e/Math.max(t,i),n=Math.floor(t*s),a=Math.floor(i*s),o=document.createElement("canvas");return o.width=n,o.height=a,o.getContext("2d").drawImage(r,0,0,t,i,0,0,n,a),o}return r}class lpe{constructor(e){this._glTexture=null,this.dirtyParameterFlags=0,this.texture=e}destroy(e){if(this._glTexture){for(let t=0;t<e.textureUnits.length;t++){const i=e.textureUnits[t];for(let s=0;s<i.length;s++)i[s]===this._glTexture&&(i[s]=null)}e.gl.deleteTexture(this._glTexture),this._glTexture=null}}loseContext(){this._glTexture=null}propertyChanged(e){this.dirtyParameterFlags|=e}initialize(e,t){const i=e.gl;switch(this._glTexture=i.createTexture(),this._glTarget=t._cubemap?i.TEXTURE_CUBE_MAP:t._volume?i.TEXTURE_3D:t.array?i.TEXTURE_2D_ARRAY:i.TEXTURE_2D,t._format){case fq:this._glFormat=i.ALPHA,this._glInternalFormat=i.ALPHA,this._glPixelType=i.UNSIGNED_BYTE;break;case pq:this._glFormat=i.LUMINANCE,this._glInternalFormat=i.LUMINANCE,this._glPixelType=i.UNSIGNED_BYTE;break;case RO:this._glFormat=i.LUMINANCE_ALPHA,this._glInternalFormat=i.LUMINANCE_ALPHA,this._glPixelType=i.UNSIGNED_BYTE;break;case ZO:this._glFormat=i.RED,this._glInternalFormat=i.R8,this._glPixelType=i.UNSIGNED_BYTE;break;case QO:this._glFormat=i.RG,this._glInternalFormat=i.RG8,this._glPixelType=i.UNSIGNED_BYTE;break;case aE:this._glFormat=i.RGB,this._glInternalFormat=i.RGB565,this._glPixelType=i.UNSIGNED_SHORT_5_6_5;break;case DO:this._glFormat=i.RGBA,this._glInternalFormat=i.RGB5_A1,this._glPixelType=i.UNSIGNED_SHORT_5_5_5_1;break;case oE:this._glFormat=i.RGBA,this._glInternalFormat=i.RGBA4,this._glPixelType=i.UNSIGNED_SHORT_4_4_4_4;break;case Ic:this._glFormat=i.RGB,this._glInternalFormat=i.RGB8,this._glPixelType=i.UNSIGNED_BYTE;break;case ct:this._glFormat=i.RGBA,this._glInternalFormat=i.RGBA8,this._glPixelType=i.UNSIGNED_BYTE;break;case vq:case bq:break;case lE:this._glFormat=i.RGB,this._glInternalFormat=e.extCompressedTextureS3TC.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case LO:this._glFormat=i.RGBA,this._glInternalFormat=e.extCompressedTextureS3TC.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case fy:this._glFormat=i.RGBA,this._glInternalFormat=e.extCompressedTextureS3TC.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case hE:this._glFormat=i.RGB,this._glInternalFormat=e.extCompressedTextureETC1.COMPRESSED_RGB_ETC1_WEBGL;break;case py:this._glFormat=i.RGB,this._glInternalFormat=e.extCompressedTexturePVRTC.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;break;case my:this._glFormat=i.RGBA,this._glInternalFormat=e.extCompressedTexturePVRTC.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;break;case dE:this._glFormat=i.RGB,this._glInternalFormat=e.extCompressedTexturePVRTC.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;break;case fE:this._glFormat=i.RGBA,this._glInternalFormat=e.extCompressedTexturePVRTC.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;break;case kO:this._glFormat=i.RGB,this._glInternalFormat=e.extCompressedTextureETC.COMPRESSED_RGB8_ETC2;break;case FO:this._glFormat=i.RGBA,this._glInternalFormat=e.extCompressedTextureETC.COMPRESSED_RGBA8_ETC2_EAC;break;case mq:this._glFormat=i.RGBA,this._glInternalFormat=e.extCompressedTextureASTC.COMPRESSED_RGBA_ASTC_4x4_KHR;break;case gq:this._glFormat=i.RGB,this._glInternalFormat=e.extCompressedTextureATC.COMPRESSED_RGB_ATC_WEBGL;break;case _q:this._glFormat=i.RGBA,this._glInternalFormat=e.extCompressedTextureATC.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL;break;case wq:this._glFormat=i.RGB,this._glInternalFormat=e.extTextureCompressionBPTC.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;break;case Tq:this._glFormat=i.RGB,this._glInternalFormat=e.extTextureCompressionBPTC.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT;break;case Eq:this._glFormat=i.RGBA,this._glInternalFormat=e.extTextureCompressionBPTC.COMPRESSED_RGBA_BPTC_UNORM_EXT;break;case cM:this._glFormat=i.SRGB,this._glInternalFormat=e.extCompressedTextureS3TC_SRGB.COMPRESSED_SRGB_S3TC_DXT1_EXT;break;case uM:this._glFormat=i.SRGB_ALPHA,this._glInternalFormat=e.extCompressedTextureS3TC_SRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;break;case hM:this._glFormat=i.SRGB_ALPHA,this._glInternalFormat=e.extCompressedTextureS3TC_SRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;break;case dM:this._glFormat=i.SRGB,this._glInternalFormat=e.extCompressedTextureETC.COMPRESSED_SRGB8_ETC2;break;case fM:this._glFormat=i.SRGB_ALPHA,this._glInternalFormat=e.extCompressedTextureETC.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;break;case pM:this._glFormat=i.SRGB_ALPHA,this._glInternalFormat=e.extCompressedTextureASTC.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case mM:this._glFormat=i.RGBA,this._glInternalFormat=e.extTextureCompressionBPTC.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case mE:this._glFormat=i.RED,this._glInternalFormat=i.R16F,this._glPixelType=i.HALF_FLOAT;break;case KO:this._glFormat=i.RG,this._glInternalFormat=i.RG16F,this._glPixelType=i.HALF_FLOAT;break;case cE:this._glFormat=i.RGB,this._glInternalFormat=i.RGB16F,this._glPixelType=i.HALF_FLOAT;break;case wi:this._glFormat=i.RGBA,this._glInternalFormat=i.RGBA16F,this._glPixelType=i.HALF_FLOAT;break;case OO:this._glFormat=i.RGB,this._glInternalFormat=i.RGB32F,this._glPixelType=i.FLOAT;break;case or:this._glFormat=i.RGBA,this._glInternalFormat=i.RGBA32F,this._glPixelType=i.FLOAT;break;case sl:this._glFormat=i.RED,this._glInternalFormat=i.R32F,this._glPixelType=i.FLOAT;break;case Bo:this._glFormat=i.DEPTH_COMPONENT,this._glInternalFormat=i.DEPTH_COMPONENT32F,this._glPixelType=i.FLOAT;break;case Af:this._glFormat=i.DEPTH_COMPONENT,this._glInternalFormat=i.DEPTH_COMPONENT16,this._glPixelType=i.UNSIGNED_SHORT;break;case uE:this._glFormat=i.DEPTH_STENCIL,this._glInternalFormat=i.DEPTH24_STENCIL8,this._glPixelType=i.UNSIGNED_INT_24_8;break;case np:this._glFormat=i.RGB,this._glInternalFormat=i.R11F_G11F_B10F,this._glPixelType=i.UNSIGNED_INT_10F_11F_11F_REV;break;case NO:this._glFormat=i.RGB,this._glInternalFormat=i.SRGB8,this._glPixelType=i.UNSIGNED_BYTE;break;case Ms:this._glFormat=i.RGBA,this._glInternalFormat=i.SRGB8_ALPHA8,this._glPixelType=i.UNSIGNED_BYTE;break;case BO:this._glFormat=i.RED_INTEGER,this._glInternalFormat=i.R8I,this._glPixelType=i.BYTE;break;case yq:this._glFormat=i.RED_INTEGER,this._glInternalFormat=i.R8UI,this._glPixelType=i.UNSIGNED_BYTE;break;case UO:this._glFormat=i.RED_INTEGER,this._glInternalFormat=i.R16I,this._glPixelType=i.SHORT;break;case zO:this._glFormat=i.RED_INTEGER,this._glInternalFormat=i.R16UI,this._glPixelType=i.UNSIGNED_SHORT;break;case VO:this._glFormat=i.RED_INTEGER,this._glInternalFormat=i.R32I,this._glPixelType=i.INT;break;case cm:this._glFormat=i.RED_INTEGER,this._glInternalFormat=i.R32UI,this._glPixelType=i.UNSIGNED_INT;break;case jO:this._glFormat=i.RG_INTEGER,this._glInternalFormat=i.RG8I,this._glPixelType=i.BYTE;break;case Sq:this._glFormat=i.RG_INTEGER,this._glInternalFormat=i.RG8UI,this._glPixelType=i.UNSIGNED_BYTE;break;case $O:this._glFormat=i.RG_INTEGER,this._glInternalFormat=i.RG16I,this._glPixelType=i.SHORT;break;case HO:this._glFormat=i.RG_INTEGER,this._glInternalFormat=i.RG16UI,this._glPixelType=i.UNSIGNED_SHORT;break;case GO:this._glFormat=i.RG_INTEGER,this._glInternalFormat=i.RG32I,this._glPixelType=i.INT;break;case WO:this._glFormat=i.RG_INTEGER,this._glInternalFormat=i.RG32UI,this._glPixelType=i.UNSIGNED_INT;break;case XO:this._glFormat=i.RGBA_INTEGER,this._glInternalFormat=i.RGBA8I,this._glPixelType=i.BYTE;break;case xq:this._glFormat=i.RGBA_INTEGER,this._glInternalFormat=i.RGBA8UI,this._glPixelType=i.UNSIGNED_BYTE;break;case qO:this._glFormat=i.RGBA_INTEGER,this._glInternalFormat=i.RGBA16I,this._glPixelType=i.SHORT;break;case pE:this._glFormat=i.RGBA_INTEGER,this._glInternalFormat=i.RGBA16UI,this._glPixelType=i.UNSIGNED_SHORT;break;case YO:this._glFormat=i.RGBA_INTEGER,this._glInternalFormat=i.RGBA32I,this._glPixelType=i.INT;break;case Qs:this._glFormat=i.RGBA_INTEGER,this._glInternalFormat=i.RGBA32UI,this._glPixelType=i.UNSIGNED_INT;break}this._glCreated=!1}upload(e,t){const i=e.gl;if(!t._needsUpload&&(t._needsMipmapsUpload&&t._mipmapsUploaded||!t.pot))return;let s=0,n,a;const o=t.numLevels;for(t.array&&i.texStorage3D(i.TEXTURE_2D_ARRAY,o,this._glInternalFormat,t._width,t._height,t._arrayLength);t._levels[s]||s===0;){if(!t._needsUpload&&s===0){s++;continue}else if(s&&(!t._needsMipmapsUpload||!t._mipmaps))break;if(n=t._levels[s],a=1/Math.pow(2,s),s===1&&!t._compressed&&!t._integerFormat&&t._levels.length<o&&(i.generateMipmap(this._glTarget),t._mipmapsUploaded=!0),t._cubemap){let l;if(e._isBrowserInterface(n[0]))for(l=0;l<6;l++){if(!t._levelsUpdated[0][l])continue;let c=n[l];e._isImageBrowserInterface(c)&&(c.width>e.maxCubeMapSize||c.height>e.maxCubeMapSize)&&(c=dU(c,e.maxCubeMapSize),s===0&&(t._width=c.width,t._height=c.height)),e.setUnpackFlipY(!1),e.setUnpackPremultiplyAlpha(t._premultiplyAlpha),this._glCreated?i.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+l,s,0,0,this._glFormat,this._glPixelType,c):i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+l,s,this._glInternalFormat,this._glFormat,this._glPixelType,c)}else for(a=1/Math.pow(2,s),l=0;l<6;l++){if(!t._levelsUpdated[0][l])continue;const c=n[l];t._compressed?this._glCreated&&c?i.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+l,s,0,0,Math.max(t._width*a,1),Math.max(t._height*a,1),this._glInternalFormat,c):i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+l,s,this._glInternalFormat,Math.max(t._width*a,1),Math.max(t._height*a,1),0,c):(e.setUnpackFlipY(!1),e.setUnpackPremultiplyAlpha(t._premultiplyAlpha),this._glCreated&&c?i.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+l,s,0,0,Math.max(t._width*a,1),Math.max(t._height*a,1),this._glFormat,this._glPixelType,c):i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+l,s,this._glInternalFormat,Math.max(t._width*a,1),Math.max(t._height*a,1),0,this._glFormat,this._glPixelType,c))}}else if(t._volume)t._compressed?i.compressedTexImage3D(i.TEXTURE_3D,s,this._glInternalFormat,Math.max(t._width*a,1),Math.max(t._height*a,1),Math.max(t._depth*a,1),0,n):(e.setUnpackFlipY(!1),e.setUnpackPremultiplyAlpha(t._premultiplyAlpha),i.texImage3D(i.TEXTURE_3D,s,this._glInternalFormat,Math.max(t._width*a,1),Math.max(t._height*a,1),Math.max(t._depth*a,1),0,this._glFormat,this._glPixelType,n));else if(t.array&&typeof n=="object"){if(t._arrayLength===n.length)if(t._compressed)for(let l=0;l<t._arrayLength;l++)i.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,s,0,0,l,Math.max(Math.floor(t._width*a),1),Math.max(Math.floor(t._height*a),1),1,this._glInternalFormat,n[l]);else for(let l=0;l<t._arrayLength;l++)i.texSubImage3D(i.TEXTURE_2D_ARRAY,s,0,0,l,Math.max(Math.floor(t._width*a),1),Math.max(Math.floor(t._height*a),1),1,this._glFormat,this._glPixelType,n[l])}else{if(e._isBrowserInterface(n)){e._isImageBrowserInterface(n)&&(n.width>e.maxTextureSize||n.height>e.maxTextureSize)&&(n=dU(n,e.maxTextureSize),s===0&&(t._width=n.width,t._height=n.height));const l=n.width||n.videoWidth,c=n.height||n.videoHeight;e.setUnpackFlipY(t._flipY),e.setUnpackPremultiplyAlpha(t._premultiplyAlpha),this._glCreated&&t._width===l&&t._height===c&&!e._isImageVideoInterface(n)?i.texSubImage2D(i.TEXTURE_2D,s,0,0,this._glFormat,this._glPixelType,n):(i.texImage2D(i.TEXTURE_2D,s,this._glInternalFormat,this._glFormat,this._glPixelType,n),s===0&&(t._width=l,t._height=c))}else a=1/Math.pow(2,s),t._compressed?this._glCreated&&n?i.compressedTexSubImage2D(i.TEXTURE_2D,s,0,0,Math.max(Math.floor(t._width*a),1),Math.max(Math.floor(t._height*a),1),this._glInternalFormat,n):i.compressedTexImage2D(i.TEXTURE_2D,s,this._glInternalFormat,Math.max(Math.floor(t._width*a),1),Math.max(Math.floor(t._height*a),1),0,n):(e.setUnpackFlipY(!1),e.setUnpackPremultiplyAlpha(t._premultiplyAlpha),this._glCreated&&n?i.texSubImage2D(i.TEXTURE_2D,s,0,0,Math.max(t._width*a,1),Math.max(t._height*a,1),this._glFormat,this._glPixelType,n):i.texImage2D(i.TEXTURE_2D,s,this._glInternalFormat,Math.max(t._width*a,1),Math.max(t._height*a,1),0,this._glFormat,this._glPixelType,n));s===0?t._mipmapsUploaded=!1:t._mipmapsUploaded=!0}s++}if(t._needsUpload)if(t._cubemap)for(let l=0;l<6;l++)t._levelsUpdated[0][l]=!1;else t._levelsUpdated[0]=!1;!t._compressed&&!t._integerFormat&&t._mipmaps&&t._needsMipmapsUpload&&t._levels.length===1&&(i.generateMipmap(this._glTarget),t._mipmapsUploaded=!0),t._gpuSize&&t.adjustVramSizeTracking(e._vram,-t._gpuSize),t._gpuSize=t.gpuSize,t.adjustVramSizeTracking(e._vram,t._gpuSize),this._glCreated=!0}read(e,t,i,s,n){const a=this.texture;return a.device.readTextureAsync(a,e,t,i,s,n)}write(e,t,i,s,n){const{texture:a}=this,{device:o}=a;return o.setTexture(a,0),o.writeTextureAsync(a,e,t,i,s,n)}}class cpe{constructor(e,t){this.msaaFB=e,this.resolveFB=t}destroy(e){this.msaaFB&&(e.deleteRenderbuffer(this.msaaFB),this.msaaFB=null),this.resolveFB&&(e.deleteRenderbuffer(this.resolveFB),this.resolveFB=null)}}class upe{destroy(e){var i;const t=e.gl;this._isInitialized=!1,this._glFrameBuffer&&(this._glFrameBuffer!==this.suppliedColorFramebuffer&&t.deleteFramebuffer(this._glFrameBuffer),this._glFrameBuffer=null),this._glDepthBuffer&&(t.deleteRenderbuffer(this._glDepthBuffer),this._glDepthBuffer=null),this._glResolveFrameBuffer&&(this._glResolveFrameBuffer!==this.suppliedColorFramebuffer&&t.deleteFramebuffer(this._glResolveFrameBuffer),this._glResolveFrameBuffer=null),this._glMsaaColorBuffers.forEach(s=>{t.deleteRenderbuffer(s)}),this._glMsaaColorBuffers.length=0,(i=this.colorMrtFramebuffers)==null||i.forEach(s=>{s.destroy(t)}),this.colorMrtFramebuffers=null,this._glMsaaDepthBuffer&&(this._glMsaaDepthBuffer=null,this.msaaDepthBufferKey&&eC(e).release(this.msaaDepthBufferKey)),this.suppliedColorFramebuffer=void 0}get initialized(){return this._isInitialized}init(e,t){var n,a;const i=e.gl;this._isInitialized=!0;const s=[];if(this.suppliedColorFramebuffer!==void 0)this._glFrameBuffer=this.suppliedColorFramebuffer;else{this._glFrameBuffer=i.createFramebuffer(),e.setFramebuffer(this._glFrameBuffer);const o=((n=t._colorBuffers)==null?void 0:n.length)??0,l=i.COLOR_ATTACHMENT0;for(let u=0;u<o;++u){const h=t.getColorBuffer(u);h&&(h.impl._glTexture||(h._width=Math.min(h.width,e.maxRenderBufferSize),h._height=Math.min(h.height,e.maxRenderBufferSize),e.setTexture(h,0)),i.framebufferTexture2D(i.FRAMEBUFFER,l+u,h._cubemap?i.TEXTURE_CUBE_MAP_POSITIVE_X+t._face:i.TEXTURE_2D,h.impl._glTexture,t.mipLevel),s.push(l+u))}i.drawBuffers(s);const c=t._depthBuffer;if(c||t._depth){const u=t._stencil?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;if(c)c.impl._glTexture||(c._width=Math.min(c.width,e.maxRenderBufferSize),c._height=Math.min(c.height,e.maxRenderBufferSize),e.setTexture(c,0)),i.framebufferTexture2D(i.FRAMEBUFFER,u,c._cubemap?i.TEXTURE_CUBE_MAP_POSITIVE_X+t._face:i.TEXTURE_2D,t._depthBuffer.impl._glTexture,t.mipLevel);else if(!(t._samples>1)){this._glDepthBuffer||(this._glDepthBuffer=i.createRenderbuffer());const d=t._stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT32F;i.bindRenderbuffer(i.RENDERBUFFER,this._glDepthBuffer),i.renderbufferStorage(i.RENDERBUFFER,d,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,u,i.RENDERBUFFER,this._glDepthBuffer),i.bindRenderbuffer(i.RENDERBUFFER,null)}}}if(t._samples>1){this._glResolveFrameBuffer=this._glFrameBuffer,this._glFrameBuffer=i.createFramebuffer(),e.setFramebuffer(this._glFrameBuffer);const o=((a=t._colorBuffers)==null?void 0:a.length)??0;if(this.suppliedColorFramebuffer!==void 0){const l=i.createRenderbuffer();this._glMsaaColorBuffers.push(l);const c=e.backBufferFormat===ct?i.RGBA8:i.RGB8;i.bindRenderbuffer(i.RENDERBUFFER,l),i.renderbufferStorageMultisample(i.RENDERBUFFER,t._samples,c,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,l)}else for(let l=0;l<o;++l){const c=t.getColorBuffer(l);if(c){const u=i.createRenderbuffer();this._glMsaaColorBuffers.push(u),i.bindRenderbuffer(i.RENDERBUFFER,u),i.renderbufferStorageMultisample(i.RENDERBUFFER,t._samples,c.impl._glInternalFormat,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+l,i.RENDERBUFFER,u)}}if(t._depth){const l=t._stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT32F,c=t._stencil?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;let u;const h=t._depthBuffer;h&&(u=`${h.id}:${t.width}:${t.height}:${t._samples}:${l}:${c}`,this._glMsaaDepthBuffer=eC(e).get(u)),this._glMsaaDepthBuffer||(this._glMsaaDepthBuffer=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,this._glMsaaDepthBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,t._samples,l,t.width,t.height),this._glMsaaDepthBuffer.destroy=function(){i.deleteRenderbuffer(this)},h&&eC(e).set(u,this._glMsaaDepthBuffer)),this.msaaDepthBufferKey=u,i.framebufferRenderbuffer(i.FRAMEBUFFER,c,i.RENDERBUFFER,this._glMsaaDepthBuffer)}o>1&&(this._createMsaaMrtFramebuffers(e,t,o),e.setFramebuffer(this._glFrameBuffer),i.drawBuffers(s))}}_createMsaaMrtFramebuffers(e,t,i){const s=e.gl;this.colorMrtFramebuffers=[];for(let n=0;n<i;++n){const a=t.getColorBuffer(n),o=s.createFramebuffer();e.setFramebuffer(o);const l=this._glMsaaColorBuffers[n];s.bindRenderbuffer(s.RENDERBUFFER,l),s.renderbufferStorageMultisample(s.RENDERBUFFER,t._samples,a.impl._glInternalFormat,t.width,t.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.RENDERBUFFER,l),s.drawBuffers([s.COLOR_ATTACHMENT0]);const c=s.createFramebuffer();e.setFramebuffer(c),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,a._cubemap?s.TEXTURE_CUBE_MAP_POSITIVE_X+t._face:s.TEXTURE_2D,a.impl._glTexture,0),this.colorMrtFramebuffers[n]=new cpe(o,c)}}_checkFbo(e,t,i=""){const s=e.gl;switch(s.checkFramebufferStatus(s.FRAMEBUFFER)){case s.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:break;case s.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:break;case s.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:break;case s.FRAMEBUFFER_UNSUPPORTED:break}}loseContext(){this._glFrameBuffer=null,this._glDepthBuffer=null,this._glResolveFrameBuffer=null,this._glMsaaColorBuffers.length=0,this._glMsaaDepthBuffer=null,this.msaaDepthBufferKey=void 0,this.colorMrtFramebuffers=null,this.suppliedColorFramebuffer=void 0,this._isInitialized=!1}internalResolve(e,t,i,s,n){e.setScissor(0,0,s.width,s.height);const a=e.gl;a.bindFramebuffer(a.READ_FRAMEBUFFER,t),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,i),a.blitFramebuffer(0,0,s.width,s.height,0,0,s.width,s.height,n,a.NEAREST)}resolve(e,t,i,s){const n=e.gl;if(this.colorMrtFramebuffers){if(i)for(let a=0;a<this.colorMrtFramebuffers.length;a++){const o=this.colorMrtFramebuffers[a];this.internalResolve(e,o.msaaFB,o.resolveFB,t,n.COLOR_BUFFER_BIT)}s&&this.internalResolve(e,this._glFrameBuffer,this._glResolveFrameBuffer,t,n.DEPTH_BUFFER_BIT)}else this.internalResolve(e,this._glFrameBuffer,this._glResolveFrameBuffer,t,(i?n.COLOR_BUFFER_BIT:0)|(s?n.DEPTH_BUFFER_BIT:0));n.bindFramebuffer(n.FRAMEBUFFER,this._glFrameBuffer)}constructor(){this._glFrameBuffer=null,this._glDepthBuffer=null,this._glResolveFrameBuffer=null,this.colorMrtFramebuffers=null,this._glMsaaColorBuffers=[],this._glMsaaDepthBuffer=null,this._isInitialized=!1}}class hpe{destroy(e){this.queries.forEach(t=>e.deleteQuery(t)),this.queries=null}constructor(){this.queries=[]}}class dpe extends Jfe{constructor(e){super(),this.freeQueries=[],this.frameQueries=[],this.previousFrameQueries=[],this.timings=[],this.device=e,this.ext=e.extDisjointTimerQuery}destroy(){this.freeQueries.forEach(e=>this.device.gl.deleteQuery(e)),this.frameQueries.forEach(e=>this.device.gl.deleteQuery(e)),this.previousFrameQueries.forEach(e=>e.destroy(this.device.gl)),this.freeQueries=null,this.frameQueries=null,this.previousFrameQueries=null}loseContext(){super.loseContext(),this.freeQueries=[],this.frameQueries=[],this.previousFrameQueries=[]}restoreContext(){this.ext=this.device.extDisjointTimerQuery}getQuery(){return this.freeQueries.pop()??this.device.gl.createQuery()}start(e){if(this.ext){const t=this.getSlot(e),i=this.getQuery();return this.frameQueries[t]=i,this.device.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,i),t}}end(e){e!==void 0&&this.device.gl.endQuery(this.ext.TIME_ELAPSED_EXT)}frameStart(){this.processEnableRequest(),this._enabled&&(this.frameGPUMarkerSlot=this.start("GpuFrame"))}frameEnd(){this._enabled&&this.end(this.frameGPUMarkerSlot)}request(){if(this._enabled){const e=this.ext,t=this.device.gl,i=this.device.renderVersion,s=this.frameQueries;if(s.length>0){this.frameQueries=[];const n=new hpe;n.queries=s,n.renderVersion=i,this.previousFrameQueries.push(n)}if(this.previousFrameQueries.length>0){const n=this.previousFrameQueries[0],a=n.queries,o=a[a.length-1],l=t.getQueryParameter(o,t.QUERY_RESULT_AVAILABLE),c=t.getParameter(e.GPU_DISJOINT_EXT);if(l&&!c){this.previousFrameQueries.shift();const u=this.timings;u.length=0;for(let h=0;h<a.length;h++){const d=a[h],f=t.getQueryParameter(d,t.QUERY_RESULT);u[h]=f*1e-6,this.freeQueries.push(d)}this.report(n.renderVersion,u)}c&&(this.previousFrameQueries.forEach(u=>{this.report(u.renderVersion,null),u.destroy(t)}),this.previousFrameQueries.length=0)}super.request(i)}}}const Zh=[];class fpe extends xM{constructor(e,t={}){super(e,t),this._defaultFramebuffer=null,this._defaultFramebufferChanged=!1,t=this.initOptions,this.updateClientRect(),this.initTextureUnits(),this.contextLost=!1,this._contextLostHandler=f=>{f.preventDefault(),this.loseContext(),this.fire("devicelost")},this._contextRestoredHandler=()=>{this.restoreContext(),this.fire("devicerestored")};const i=typeof navigator<"u"&&navigator.userAgent;if(this.forceDisableMultisampling=i&&i.includes("AppleWebKit")&&(i.includes("15.4")||i.includes("15_4")),this.forceDisableMultisampling&&(t.antialias=!1),Ye.browserName==="firefox"){const p=(typeof navigator<"u"?navigator.userAgent:"").match(/Firefox\/(\d+(\.\d+)*)/),m=p?p[1]:null;if(m){const g=parseFloat(m);(Ye.name==="windows"&&(g>=120||g===115)||Ye.name==="android"&&g>=132)&&(t.antialias=!1)}}this.backBufferAntialias=t.antialias??!1,t.antialias=!1;const s=t.gl??e.getContext("webgl2",t);if(!s)throw new Error("WebGL not supported");this.gl=s,this.isWebGL2=!0,this._deviceType=mfe,this.updateBackbufferFormat(null);const n=Ye.browserName==="chrome",a=Ye.browserName==="safari",o=Ye.browser&&navigator.appVersion.indexOf("Mac")!==-1;this._tempEnableSafariTextureUnitWorkaround=a,this._tempMacChromeBlitFramebufferWorkaround=o&&n&&!t.alpha,e.addEventListener("webglcontextlost",this._contextLostHandler,!1),e.addEventListener("webglcontextrestored",this._contextRestoredHandler,!1),this.initializeExtensions(),this.initializeCapabilities(),this.initializeRenderState(),this.initializeContextCaches(),this.createBackbuffer(null),this.supportsImageBitmap=!a&&typeof ImageBitmap<"u",this._samplerTypes=new Set([s.SAMPLER_2D,s.SAMPLER_CUBE,s.UNSIGNED_INT_SAMPLER_2D,s.INT_SAMPLER_2D,s.SAMPLER_2D_SHADOW,s.SAMPLER_CUBE_SHADOW,s.SAMPLER_3D,s.INT_SAMPLER_3D,s.UNSIGNED_INT_SAMPLER_3D,s.SAMPLER_2D_ARRAY,s.INT_SAMPLER_2D_ARRAY,s.UNSIGNED_INT_SAMPLER_2D_ARRAY]),this.glAddress=[s.REPEAT,s.CLAMP_TO_EDGE,s.MIRRORED_REPEAT],this.glBlendEquation=[s.FUNC_ADD,s.FUNC_SUBTRACT,s.FUNC_REVERSE_SUBTRACT,s.MIN,s.MAX],this.glBlendFunctionColor=[s.ZERO,s.ONE,s.SRC_COLOR,s.ONE_MINUS_SRC_COLOR,s.DST_COLOR,s.ONE_MINUS_DST_COLOR,s.SRC_ALPHA,s.SRC_ALPHA_SATURATE,s.ONE_MINUS_SRC_ALPHA,s.DST_ALPHA,s.ONE_MINUS_DST_ALPHA,s.CONSTANT_COLOR,s.ONE_MINUS_CONSTANT_COLOR],this.glBlendFunctionAlpha=[s.ZERO,s.ONE,s.SRC_COLOR,s.ONE_MINUS_SRC_COLOR,s.DST_COLOR,s.ONE_MINUS_DST_COLOR,s.SRC_ALPHA,s.SRC_ALPHA_SATURATE,s.ONE_MINUS_SRC_ALPHA,s.DST_ALPHA,s.ONE_MINUS_DST_ALPHA,s.CONSTANT_ALPHA,s.ONE_MINUS_CONSTANT_ALPHA],this.glComparison=[s.NEVER,s.LESS,s.EQUAL,s.LEQUAL,s.GREATER,s.NOTEQUAL,s.GEQUAL,s.ALWAYS],this.glStencilOp=[s.KEEP,s.ZERO,s.REPLACE,s.INCR,s.INCR_WRAP,s.DECR,s.DECR_WRAP,s.INVERT],this.glClearFlag=[0,s.COLOR_BUFFER_BIT,s.DEPTH_BUFFER_BIT,s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT,s.STENCIL_BUFFER_BIT,s.STENCIL_BUFFER_BIT|s.COLOR_BUFFER_BIT,s.STENCIL_BUFFER_BIT|s.DEPTH_BUFFER_BIT,s.STENCIL_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT],this.glCull=[0,s.BACK,s.FRONT,s.FRONT_AND_BACK],this.glFilter=[s.NEAREST,s.LINEAR,s.NEAREST_MIPMAP_NEAREST,s.NEAREST_MIPMAP_LINEAR,s.LINEAR_MIPMAP_NEAREST,s.LINEAR_MIPMAP_LINEAR],this.glPrimitive=[s.POINTS,s.LINES,s.LINE_LOOP,s.LINE_STRIP,s.TRIANGLES,s.TRIANGLE_STRIP,s.TRIANGLE_FAN],this.glType=[s.BYTE,s.UNSIGNED_BYTE,s.SHORT,s.UNSIGNED_SHORT,s.INT,s.UNSIGNED_INT,s.FLOAT,s.HALF_FLOAT],this.pcUniformType={},this.pcUniformType[s.BOOL]=Pf,this.pcUniformType[s.INT]=uh,this.pcUniformType[s.FLOAT]=zn,this.pcUniformType[s.FLOAT_VEC2]=hh,this.pcUniformType[s.FLOAT_VEC3]=vs,this.pcUniformType[s.FLOAT_VEC4]=op,this.pcUniformType[s.INT_VEC2]=ju,this.pcUniformType[s.INT_VEC3]=$u,this.pcUniformType[s.INT_VEC4]=Hu,this.pcUniformType[s.BOOL_VEC2]=Q_,this.pcUniformType[s.BOOL_VEC3]=J_,this.pcUniformType[s.BOOL_VEC4]=ev,this.pcUniformType[s.FLOAT_MAT2]=hb,this.pcUniformType[s.FLOAT_MAT3]=lp,this.pcUniformType[s.FLOAT_MAT4]=Aa,this.pcUniformType[s.SAMPLER_2D]=Jde,this.pcUniformType[s.SAMPLER_CUBE]=efe,this.pcUniformType[s.UNSIGNED_INT]=cp,this.pcUniformType[s.UNSIGNED_INT_VEC2]=up,this.pcUniformType[s.UNSIGNED_INT_VEC3]=hp,this.pcUniformType[s.UNSIGNED_INT_VEC4]=dp,this.pcUniformType[s.SAMPLER_2D_SHADOW]=tfe,this.pcUniformType[s.SAMPLER_CUBE_SHADOW]=ife,this.pcUniformType[s.SAMPLER_2D_ARRAY]=sfe,this.pcUniformType[s.SAMPLER_3D]=rfe,this.pcUniformType[s.INT_SAMPLER_2D]=nfe,this.pcUniformType[s.UNSIGNED_INT_SAMPLER_2D]=afe,this.pcUniformType[s.INT_SAMPLER_CUBE]=ofe,this.pcUniformType[s.UNSIGNED_INT_SAMPLER_2D]=lfe,this.pcUniformType[s.INT_SAMPLER_3D]=cfe,this.pcUniformType[s.UNSIGNED_INT_SAMPLER_3D]=ufe,this.pcUniformType[s.INT_SAMPLER_2D_ARRAY]=hfe,this.pcUniformType[s.UNSIGNED_INT_SAMPLER_2D_ARRAY]=dfe,this.targetToSlot={},this.targetToSlot[s.TEXTURE_2D]=0,this.targetToSlot[s.TEXTURE_CUBE_MAP]=1,this.targetToSlot[s.TEXTURE_3D]=2;let l,c,u,h,d;this.commitFunction=[],this.commitFunction[Pf]=function(f,p){f.value!==p&&(s.uniform1i(f.locationId,p),f.value=p)},this.commitFunction[uh]=this.commitFunction[Pf],this.commitFunction[zn]=function(f,p){f.value!==p&&(s.uniform1f(f.locationId,p),f.value=p)},this.commitFunction[hh]=function(f,p){d=f.value,l=p[0],c=p[1],(d[0]!==l||d[1]!==c)&&(s.uniform2fv(f.locationId,p),d[0]=l,d[1]=c)},this.commitFunction[vs]=function(f,p){d=f.value,l=p[0],c=p[1],u=p[2],(d[0]!==l||d[1]!==c||d[2]!==u)&&(s.uniform3fv(f.locationId,p),d[0]=l,d[1]=c,d[2]=u)},this.commitFunction[op]=function(f,p){d=f.value,l=p[0],c=p[1],u=p[2],h=p[3],(d[0]!==l||d[1]!==c||d[2]!==u||d[3]!==h)&&(s.uniform4fv(f.locationId,p),d[0]=l,d[1]=c,d[2]=u,d[3]=h)},this.commitFunction[ju]=function(f,p){d=f.value,l=p[0],c=p[1],(d[0]!==l||d[1]!==c)&&(s.uniform2iv(f.locationId,p),d[0]=l,d[1]=c)},this.commitFunction[Q_]=this.commitFunction[ju],this.commitFunction[$u]=function(f,p){d=f.value,l=p[0],c=p[1],u=p[2],(d[0]!==l||d[1]!==c||d[2]!==u)&&(s.uniform3iv(f.locationId,p),d[0]=l,d[1]=c,d[2]=u)},this.commitFunction[J_]=this.commitFunction[$u],this.commitFunction[Hu]=function(f,p){d=f.value,l=p[0],c=p[1],u=p[2],h=p[3],(d[0]!==l||d[1]!==c||d[2]!==u||d[3]!==h)&&(s.uniform4iv(f.locationId,p),d[0]=l,d[1]=c,d[2]=u,d[3]=h)},this.commitFunction[ev]=this.commitFunction[Hu],this.commitFunction[hb]=function(f,p){s.uniformMatrix2fv(f.locationId,!1,p)},this.commitFunction[lp]=function(f,p){s.uniformMatrix3fv(f.locationId,!1,p)},this.commitFunction[Aa]=function(f,p){s.uniformMatrix4fv(f.locationId,!1,p)},this.commitFunction[bE]=function(f,p){s.uniform1fv(f.locationId,p)},this.commitFunction[wE]=function(f,p){s.uniform2fv(f.locationId,p)},this.commitFunction[TE]=function(f,p){s.uniform3fv(f.locationId,p)},this.commitFunction[i3]=function(f,p){s.uniform4fv(f.locationId,p)},this.commitFunction[cp]=function(f,p){f.value!==p&&(s.uniform1ui(f.locationId,p),f.value=p)},this.commitFunction[up]=function(f,p){d=f.value,l=p[0],c=p[1],(d[0]!==l||d[1]!==c)&&(s.uniform2uiv(f.locationId,p),d[0]=l,d[1]=c)},this.commitFunction[hp]=function(f,p){d=f.value,l=p[0],c=p[1],u=p[2],(d[0]!==l||d[1]!==c||d[2]!==u)&&(s.uniform3uiv(f.locationId,p),d[0]=l,d[1]=c,d[2]=u)},this.commitFunction[dp]=function(f,p){d=f.value,l=p[0],c=p[1],u=p[2],h=p[3],(d[0]!==l||d[1]!==c||d[2]!==u||d[3]!==h)&&(s.uniform4uiv(f.locationId,p),d[0]=l,d[1]=c,d[2]=u,d[3]=h)},this.commitFunction[fp]=function(f,p){s.uniform1iv(f.locationId,p)},this.commitFunction[EE]=function(f,p){s.uniform1uiv(f.locationId,p)},this.commitFunction[AE]=this.commitFunction[fp],this.commitFunction[pp]=function(f,p){s.uniform2iv(f.locationId,p)},this.commitFunction[CE]=function(f,p){s.uniform2uiv(f.locationId,p)},this.commitFunction[PE]=this.commitFunction[pp],this.commitFunction[mp]=function(f,p){s.uniform3iv(f.locationId,p)},this.commitFunction[IE]=function(f,p){s.uniform3uiv(f.locationId,p)},this.commitFunction[ME]=this.commitFunction[mp],this.commitFunction[db]=function(f,p){s.uniform4iv(f.locationId,p)},this.commitFunction[r3]=function(f,p){s.uniform4uiv(f.locationId,p)},this.commitFunction[s3]=this.commitFunction[db],this.commitFunction[Nq]=function(f,p){s.uniformMatrix4fv(f.locationId,!1,p)},this.constantTexSource=this.scope.resolve("source"),this.postInit()}postInit(){super.postInit(),this.gpuProfiler=new dpe(this)}destroy(){super.destroy();const e=this.gl;this.feedback&&e.deleteTransformFeedback(this.feedback),this.clearVertexArrayObjectCache(),this.canvas.removeEventListener("webglcontextlost",this._contextLostHandler,!1),this.canvas.removeEventListener("webglcontextrestored",this._contextRestoredHandler,!1),this._contextLostHandler=null,this._contextRestoredHandler=null,this.gl=null,super.postDestroy()}createBackbuffer(e){this.supportsStencil=this.initOptions.stencil,this.backBuffer=new Zi({name:"WebglFramebuffer",graphicsDevice:this,depth:this.initOptions.depth,stencil:this.supportsStencil,samples:this.samples}),this.backBuffer.impl.suppliedColorFramebuffer=e}updateBackbufferFormat(e){const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e);const i=this.gl.getParameter(this.gl.ALPHA_BITS);this.backBufferFormat=i?ct:Ic}updateBackbuffer(){const e=this.canvas.width!==this.backBufferSize.x||this.canvas.height!==this.backBufferSize.y;(this._defaultFramebufferChanged||e)&&(this._defaultFramebufferChanged&&this.updateBackbufferFormat(this._defaultFramebuffer),this._defaultFramebufferChanged=!1,this.backBufferSize.set(this.canvas.width,this.canvas.height),this.backBuffer.destroy(),this.createBackbuffer(this._defaultFramebuffer))}createVertexBufferImpl(e,t){return new epe}createIndexBufferImpl(e){return new tpe(e)}createShaderImpl(e){return new ope(e)}createTextureImpl(e){return new lpe(e)}createRenderTargetImpl(e){return new upe}getPrecision(){const e=this.gl;let t="highp";if(e.getShaderPrecisionFormat){const i=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT),s=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT),n=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT),a=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT);if(i&&s&&n&&a){const o=i.precision>0&&n.precision>0,l=s.precision>0&&a.precision>0;o||(l?t="mediump":t="lowp")}}return t}getExtension(){for(let e=0;e<arguments.length;e++)if(this.supportedExtensions.indexOf(arguments[e])!==-1)return this.gl.getExtension(arguments[e]);return null}get extDisjointTimerQuery(){return this._extDisjointTimerQuery||(this._extDisjointTimerQuery=this.getExtension("EXT_disjoint_timer_query_webgl2","EXT_disjoint_timer_query")),this._extDisjointTimerQuery}initializeExtensions(){const e=this.gl;this.supportedExtensions=e.getSupportedExtensions()??[],this._extDisjointTimerQuery=null,this.textureRG11B10Renderable=!0,this.extColorBufferFloat=this.getExtension("EXT_color_buffer_float"),this.textureFloatRenderable=!!this.extColorBufferFloat,this.extColorBufferHalfFloat=this.getExtension("EXT_color_buffer_half_float"),this.textureHalfFloatRenderable=!!this.extColorBufferHalfFloat||!!this.extColorBufferFloat,this.extDebugRendererInfo=this.getExtension("WEBGL_debug_renderer_info"),this.extTextureFloatLinear=this.getExtension("OES_texture_float_linear"),this.textureFloatFilterable=!!this.extTextureFloatLinear,this.extFloatBlend=this.getExtension("EXT_float_blend"),this.extTextureFilterAnisotropic=this.getExtension("EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic"),this.extParallelShaderCompile=this.getExtension("KHR_parallel_shader_compile"),this.extCompressedTextureETC1=this.getExtension("WEBGL_compressed_texture_etc1"),this.extCompressedTextureETC=this.getExtension("WEBGL_compressed_texture_etc"),this.extCompressedTexturePVRTC=this.getExtension("WEBGL_compressed_texture_pvrtc","WEBKIT_WEBGL_compressed_texture_pvrtc"),this.extCompressedTextureS3TC=this.getExtension("WEBGL_compressed_texture_s3tc","WEBKIT_WEBGL_compressed_texture_s3tc"),this.extCompressedTextureS3TC_SRGB=this.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.extCompressedTextureATC=this.getExtension("WEBGL_compressed_texture_atc"),this.extCompressedTextureASTC=this.getExtension("WEBGL_compressed_texture_astc"),this.extTextureCompressionBPTC=this.getExtension("EXT_texture_compression_bptc")}initializeCapabilities(){const e=this.gl;let t;const i=typeof navigator<"u"?navigator.userAgent:"";this.maxPrecision=this.precision=this.getPrecision();const s=e.getContextAttributes();this.supportsMsaa=(s==null?void 0:s.antialias)??!1,this.supportsStencil=(s==null?void 0:s.stencil)??!1,this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxCubeMapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxRenderBufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxTextures=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxCombinedTextures=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.maxVertexTextures=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.vertexUniformsCount=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),this.fragmentUniformsCount=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),this.maxColorAttachments=e.getParameter(e.MAX_COLOR_ATTACHMENTS),this.maxVolumeSize=e.getParameter(e.MAX_3D_TEXTURE_SIZE),t=this.extDebugRendererInfo,this.unmaskedRenderer=t?e.getParameter(t.UNMASKED_RENDERER_WEBGL):"",this.unmaskedVendor=t?e.getParameter(t.UNMASKED_VENDOR_WEBGL):"";const n=/\bMali-G52+/,a=/SM-[a-zA-Z0-9]+/;this.supportsGpuParticles=!(this.unmaskedVendor==="ARM"&&i.match(a))&&!this.unmaskedRenderer.match(n),t=this.extTextureFilterAnisotropic,this.maxAnisotropy=t?e.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1;const o=!this.forceDisableMultisampling;this.maxSamples=o?e.getParameter(e.MAX_SAMPLES):1,this.maxSamples=Math.min(this.maxSamples,4),this.samples=o&&this.backBufferAntialias?this.maxSamples:1,this.supportsAreaLights=!Ye.android,this.maxTextures<=8&&(this.supportsAreaLights=!1),this.initCapsDefines()}initializeRenderState(){super.initializeRenderState();const e=this.gl;e.disable(e.BLEND),e.blendFunc(e.ONE,e.ZERO),e.blendEquation(e.FUNC_ADD),e.colorMask(!0,!0,!0,!0),e.blendColor(0,0,0,0),e.enable(e.CULL_FACE),this.cullFace=e.BACK,e.cullFace(e.BACK),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.depthMask(!0),this.stencil=!1,e.disable(e.STENCIL_TEST),this.stencilFuncFront=this.stencilFuncBack=Lo,this.stencilRefFront=this.stencilRefBack=0,this.stencilMaskFront=this.stencilMaskBack=255,e.stencilFunc(e.ALWAYS,0,255),this.stencilFailFront=this.stencilFailBack=Cf,this.stencilZfailFront=this.stencilZfailBack=Cf,this.stencilZpassFront=this.stencilZpassBack=Cf,this.stencilWriteMaskFront=255,this.stencilWriteMaskBack=255,e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.stencilMask(255),this.alphaToCoverage=!1,this.raster=!0,e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.disable(e.RASTERIZER_DISCARD),this.depthBiasEnabled=!1,e.disable(e.POLYGON_OFFSET_FILL),this.clearDepth=1,e.clearDepth(1),this.clearColor=new ae(0,0,0,0),e.clearColor(0,0,0,0),this.clearStencil=0,e.clearStencil(0),e.hint(e.FRAGMENT_SHADER_DERIVATIVE_HINT,e.NICEST),e.enable(e.SCISSOR_TEST),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),this.unpackFlipY=!1,e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),this.unpackPremultiplyAlpha=!1,e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_ALIGNMENT,1)}initTextureUnits(e=16){this.textureUnits=[];for(let t=0;t<e;t++)this.textureUnits.push([null,null,null])}initializeContextCaches(){super.initializeContextCaches(),this._vaoMap=new Map,this.boundVao=null,this.activeFramebuffer=null,this.feedback=null,this.transformFeedbackBuffer=null,this.textureUnit=0,this.initTextureUnits(this.maxCombinedTextures)}loseContext(){super.loseContext();for(const e of this.shaders)e.loseContext()}restoreContext(){this.initializeExtensions(),this.initializeCapabilities(),super.restoreContext();for(const e of this.shaders)e.restoreContext()}setViewport(e,t,i,s){(this.vx!==e||this.vy!==t||this.vw!==i||this.vh!==s)&&(this.gl.viewport(e,t,i,s),this.vx=e,this.vy=t,this.vw=i,this.vh=s)}setScissor(e,t,i,s){(this.sx!==e||this.sy!==t||this.sw!==i||this.sh!==s)&&(this.gl.scissor(e,t,i,s),this.sx=e,this.sy=t,this.sw=i,this.sh=s)}setFramebuffer(e){if(this.activeFramebuffer!==e){const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.activeFramebuffer=e}}copyRenderTarget(e,t,i,s){var h,d;const n=this.gl;if(e===this.backBuffer&&(e=null),i){if(t){if(e&&(!e._colorBuffer||!t._colorBuffer||e._colorBuffer._format!==t._colorBuffer._format))return!1}else if(!e._colorBuffer)return!1}if(s&&e&&!e._depth&&(!e._depthBuffer||!t._depthBuffer||e._depthBuffer._format!==t._depthBuffer._format))return!1;const a=this.renderTarget;this.renderTarget=t,this.updateBegin();const o=e?e.impl._glFrameBuffer:(h=this.backBuffer)==null?void 0:h.impl._glFrameBuffer,l=t?t.impl._glFrameBuffer:(d=this.backBuffer)==null?void 0:d.impl._glFrameBuffer;n.bindFramebuffer(n.READ_FRAMEBUFFER,o),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,l);const c=e?e.width:t?t.width:this.width,u=e?e.height:t?t.height:this.height;return n.blitFramebuffer(0,0,c,u,0,0,c,u,(i?n.COLOR_BUFFER_BIT:0)|(s?n.DEPTH_BUFFER_BIT:0),n.NEAREST),this.renderTarget=a,n.bindFramebuffer(n.FRAMEBUFFER,a?a.impl._glFrameBuffer:null),!0}frameStart(){super.frameStart(),this.updateBackbuffer(),this.gpuProfiler.frameStart()}frameEnd(){super.frameEnd(),this.gpuProfiler.frameEnd(),this.gpuProfiler.request()}startRenderPass(e){const t=e.renderTarget??this.backBuffer;this.renderTarget=t,this.updateBegin();const{width:i,height:s}=t;this.setViewport(0,0,i,s),this.setScissor(0,0,i,s);const n=e.colorOps,a=e.depthStencilOps;if(n!=null&&n.clear||a.clearDepth||a.clearStencil){let o=0;const l={};n!=null&&n.clear&&(o|=X_,l.color=[n.clearValue.r,n.clearValue.g,n.clearValue.b,n.clearValue.a]),a.clearDepth&&(o|=q_,l.depth=a.clearDepthValue),a.clearStencil&&(o|=ab,l.stencil=a.clearStencilValue),l.flags=o,this.clear(l)}this.insideRenderPass=!0}endRenderPass(e){var s;this.unbindVertexArray();const t=this.renderTarget,i=e.colorArrayOps.length;if(t){Zh.length=0;const n=this.gl;for(let a=0;a<i;a++){const o=e.colorArrayOps[a];o.store||o.resolve||Zh.push(n.COLOR_ATTACHMENT0+a)}t!==this.backBuffer&&(e.depthStencilOps.storeDepth||Zh.push(n.DEPTH_ATTACHMENT),e.depthStencilOps.storeStencil||Zh.push(n.STENCIL_ATTACHMENT)),Zh.length>0&&e.fullSizeClearRect&&n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,Zh),i&&((s=e.colorOps)!=null&&s.resolve)&&e.samples>1&&t.autoResolve&&t.resolve(!0,!1),t.depthBuffer&&e.depthStencilOps.resolveDepth&&e.samples>1&&t.autoResolve&&t.resolve(!1,!0);for(let a=0;a<i;a++)if(e.colorArrayOps[a].genMipmaps){const l=t._colorBuffers[a];l&&l.impl._glTexture&&l.mipmaps&&(this.activeTexture(this.maxCombinedTextures-1),this.bindTexture(l),this.gl.generateMipmap(l.impl._glTarget))}}this.insideRenderPass=!1}set defaultFramebuffer(e){this._defaultFramebuffer!==e&&(this._defaultFramebuffer=e,this._defaultFramebufferChanged=!0)}get defaultFramebuffer(){return this._defaultFramebuffer}updateBegin(){if(this.boundVao=null,this._tempEnableSafariTextureUnitWorkaround)for(let i=0;i<this.textureUnits.length;++i)for(let s=0;s<3;++s)this.textureUnits[i][s]=null;const e=this.renderTarget??this.backBuffer,t=e.impl;t.initialized||this.initRenderTarget(e),this.setFramebuffer(t._glFrameBuffer)}updateEnd(){this.unbindVertexArray();const e=this.renderTarget;if(e&&e!==this.backBuffer){e._samples>1&&e.autoResolve&&e.resolve();const t=e._colorBuffer;t&&t.impl._glTexture&&t.mipmaps&&(this.activeTexture(this.maxCombinedTextures-1),this.bindTexture(t),this.gl.generateMipmap(t.impl._glTarget))}}setUnpackFlipY(e){if(this.unpackFlipY!==e){this.unpackFlipY=e;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e)}}setUnpackPremultiplyAlpha(e){if(this.unpackPremultiplyAlpha!==e){this.unpackPremultiplyAlpha=e;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e)}}activeTexture(e){this.textureUnit!==e&&(this.gl.activeTexture(this.gl.TEXTURE0+e),this.textureUnit=e)}bindTexture(e){const t=e.impl,i=t._glTarget,s=t._glTexture,n=this.textureUnit,a=this.targetToSlot[i];this.textureUnits[n][a]!==s&&(this.gl.bindTexture(i,s),this.textureUnits[n][a]=s)}bindTextureOnUnit(e,t){const i=e.impl,s=i._glTarget,n=i._glTexture,a=this.targetToSlot[s];this.textureUnits[t][a]!==n&&(this.activeTexture(t),this.gl.bindTexture(s,n),this.textureUnits[t][a]=n)}setTextureParameters(e){const t=this.gl,i=e.impl.dirtyParameterFlags,s=e.impl._glTarget;if(i&Bq){let n=e._minFilter;(!e._mipmaps||e._compressed&&e._levels.length===1)&&(n===rE||n===sE?n=qe:(n===nE||n===lh)&&(n=_i)),t.texParameteri(s,t.TEXTURE_MIN_FILTER,this.glFilter[n])}if(i&Uq&&t.texParameteri(s,t.TEXTURE_MAG_FILTER,this.glFilter[e._magFilter]),i&zq&&t.texParameteri(s,t.TEXTURE_WRAP_S,this.glAddress[e._addressU]),i&Vq&&t.texParameteri(s,t.TEXTURE_WRAP_T,this.glAddress[e._addressV]),i&jq&&t.texParameteri(s,t.TEXTURE_WRAP_R,this.glAddress[e._addressW]),i&$q&&t.texParameteri(s,t.TEXTURE_COMPARE_MODE,e._compareOnRead?t.COMPARE_REF_TO_TEXTURE:t.NONE),i&Hq&&t.texParameteri(s,t.TEXTURE_COMPARE_FUNC,this.glComparison[e._compareFunc]),i&Gq){const n=this.extTextureFilterAnisotropic;n&&t.texParameterf(s,n.TEXTURE_MAX_ANISOTROPY_EXT,Q.clamp(Math.round(e._anisotropy),1,this.maxAnisotropy))}}setTexture(e,t){const i=e.impl;i._glTexture||i.initialize(this,e),i.dirtyParameterFlags>0||e._needsUpload||e._needsMipmapsUpload?(this.activeTexture(t),this.bindTexture(e),i.dirtyParameterFlags&&(this.setTextureParameters(e),i.dirtyParameterFlags=0),(e._needsUpload||e._needsMipmapsUpload)&&(i.upload(this,e),e._needsUpload=!1,e._needsMipmapsUpload=!1)):this.bindTextureOnUnit(e,t)}createVertexArray(e){let t,i;const s=e.length>1;if(s){t="";for(let n=0;n<e.length;n++){const a=e[n];t+=a.id+a.format.renderingHash}i=this._vaoMap.get(t)}if(!i){const n=this.gl;i=n.createVertexArray(),n.bindVertexArray(i),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null);for(let a=0;a<e.length;a++){const o=e[a];n.bindBuffer(n.ARRAY_BUFFER,o.impl.bufferId);const l=o.format.elements;for(let c=0;c<l.length;c++){const u=l[c],h=rt[u.name];u.asInt?n.vertexAttribIPointer(h,u.numComponents,this.glType[u.dataType],u.stride,u.offset):n.vertexAttribPointer(h,u.numComponents,this.glType[u.dataType],u.normalize,u.stride,u.offset),n.enableVertexAttribArray(h),o.format.instancing&&n.vertexAttribDivisor(h,1)}}n.bindVertexArray(null),n.bindBuffer(n.ARRAY_BUFFER,null),s&&this._vaoMap.set(t,i)}return i}unbindVertexArray(){this.boundVao&&(this.boundVao=null,this.gl.bindVertexArray(null))}setBuffers(e){const t=this.gl;let i;if(this.vertexBuffers.length===1){const n=this.vertexBuffers[0];n.impl.vao||(n.impl.vao=this.createVertexArray(this.vertexBuffers)),i=n.impl.vao}else i=this.createVertexArray(this.vertexBuffers);this.boundVao!==i&&(this.boundVao=i,t.bindVertexArray(i));const s=e?e.impl.bufferId:null;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s)}draw(e,t,i,s,n=!0,a=!0){const o=this.shader;if(o&&(this.activateShader(),this.shaderValid)){const l=this.gl;n&&this.setBuffers(t);let c=0;const u=o.impl.samplers;for(let p=0,m=u.length;p<m;p++){const g=u[p];let _=g.scopeId.value;if(!_){const v=g.scopeId.name;v==="uSceneDepthMap"&&(_=Gu(this,"white")),v==="uSceneColorMap"&&(_=Gu(this,"pink")),_||(_=Gu(this,"pink"))}if(_ instanceof we){const v=_;this.setTexture(v,c),g.slot!==c&&(l.uniform1i(g.locationId,c),g.slot=c),c++}else{g.array.length=0;const v=_.length;for(let y=0;y<v;y++){const x=_[y];this.setTexture(x,c),g.array[y]=c,c++}l.uniform1iv(g.locationId,g.array)}}const h=o.impl.uniforms;for(let p=0,m=h.length;p<m;p++){const g=h[p],_=g.scopeId,v=g.version,y=_.versionObject.version;if(v.globalId!==y.globalId||v.revision!==y.revision){v.globalId=y.globalId,v.revision=y.revision;const x=_.value;x!=null&&this.commitFunction[g.dataType](g,x)}}this.transformFeedbackBuffer&&(l.bindBufferBase(l.TRANSFORM_FEEDBACK_BUFFER,0,this.transformFeedbackBuffer.impl.bufferId),l.beginTransformFeedback(l.POINTS));const d=this.glPrimitive[e.type],f=e.count;if(e.indexed){const p=t.impl.glFormat,m=e.base*t.bytesPerIndex;i>0?l.drawElementsInstanced(d,f,p,m,i):l.drawElements(d,f,p,m)}else{const p=e.base;i>0?l.drawArraysInstanced(d,p,f,i):l.drawArrays(d,p,f)}this.transformFeedbackBuffer&&(l.endTransformFeedback(),l.bindBufferBase(l.TRANSFORM_FEEDBACK_BUFFER,0,null)),this._drawCallsPerFrame++}a&&this.clearVertexBuffer()}clear(e){const t=this.defaultClearOptions;e=e||t;const i=e.flags??t.flags;if(i!==0){const s=this.gl;if(i&X_){const n=e.color??t.color,a=n[0],o=n[1],l=n[2],c=n[3],u=this.clearColor;(a!==u.r||o!==u.g||l!==u.b||c!==u.a)&&(this.gl.clearColor(a,o,l,c),this.clearColor.set(a,o,l,c)),this.setBlendState(sr.NOBLEND)}if(i&q_){const n=e.depth??t.depth;n!==this.clearDepth&&(this.gl.clearDepth(n),this.clearDepth=n),this.setDepthState(Ds.WRITEDEPTH)}if(i&ab){const n=e.stencil??t.stencil;n!==this.clearStencil&&(this.gl.clearStencil(n),this.clearStencil=n),s.stencilMask(255),this.stencilWriteMaskFront=255,this.stencilWriteMaskBack=255}s.clear(this.glClearFlag[i])}}submit(){this.gl.flush()}readPixels(e,t,i,s,n){const a=this.gl;a.readPixels(e,t,i,s,a.RGBA,a.UNSIGNED_BYTE,n)}clientWaitAsync(e,t){const i=this.gl,s=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);return this.submit(),new Promise((n,a)=>{function o(){const l=i.clientWaitSync(s,e,0);l===i.TIMEOUT_EXPIRED?setTimeout(o,t):(i.deleteSync(s),l===i.WAIT_FAILED?a(new Error("webgl clientWaitSync sync failed")):n())}o()})}async readPixelsAsync(e,t,i,s,n){var h;const a=this.gl,o=(h=this.renderTarget.colorBuffer)==null?void 0:h.impl,l=(o==null?void 0:o._glFormat)??a.RGBA,c=(o==null?void 0:o._glPixelType)??a.UNSIGNED_BYTE,u=a.createBuffer();return a.bindBuffer(a.PIXEL_PACK_BUFFER,u),a.bufferData(a.PIXEL_PACK_BUFFER,n.byteLength,a.STREAM_READ),a.readPixels(e,t,i,s,l,c,0),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),await this.clientWaitAsync(0,16),a.bindBuffer(a.PIXEL_PACK_BUFFER,u),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,n),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),a.deleteBuffer(u),n}readTextureAsync(e,t,i,s,n,a){const o=a.face??0,l=a.renderTarget??new Zi({colorBuffer:e,depth:!1,face:o}),c=new ArrayBuffer(zo.calcLevelGpuSize(s,n,1,e._format)),u=a.data??new(Aq(e._format))(c);return this.setRenderTarget(l),this.initRenderTarget(l),new Promise((h,d)=>{this.readPixelsAsync(t,i,s,n,u).then(f=>{a.renderTarget||l.destroy(),h(f)}).catch(d)})}async writeTextureAsync(e,t,i,s,n,a){const o=this.gl,l=e.impl,c=(l==null?void 0:l._glFormat)??o.RGBA,u=(l==null?void 0:l._glPixelType)??o.UNSIGNED_BYTE,h=o.createBuffer();o.bindBuffer(o.PIXEL_UNPACK_BUFFER,h),o.bufferData(o.PIXEL_UNPACK_BUFFER,a,o.STREAM_DRAW),o.bindTexture(o.TEXTURE_2D,l._glTexture),o.texSubImage2D(o.TEXTURE_2D,0,t,i,s,n,c,u,0),o.bindBuffer(o.PIXEL_UNPACK_BUFFER,null),e._needsUpload=!1,e._mipmapsUploaded=!1,await this.clientWaitAsync(0,16)}setAlphaToCoverage(e){this.alphaToCoverage!==e&&(this.alphaToCoverage=e,e?this.gl.enable(this.gl.SAMPLE_ALPHA_TO_COVERAGE):this.gl.disable(this.gl.SAMPLE_ALPHA_TO_COVERAGE))}setTransformFeedbackBuffer(e){if(this.transformFeedbackBuffer!==e){this.transformFeedbackBuffer=e;const t=this.gl;e?(this.feedback||(this.feedback=t.createTransformFeedback()),t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,this.feedback)):t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}}setRaster(e){this.raster!==e&&(this.raster=e,e?this.gl.disable(this.gl.RASTERIZER_DISCARD):this.gl.enable(this.gl.RASTERIZER_DISCARD))}setStencilTest(e){if(this.stencil!==e){const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.stencil=e}}setStencilFunc(e,t,i){(this.stencilFuncFront!==e||this.stencilRefFront!==t||this.stencilMaskFront!==i||this.stencilFuncBack!==e||this.stencilRefBack!==t||this.stencilMaskBack!==i)&&(this.gl.stencilFunc(this.glComparison[e],t,i),this.stencilFuncFront=this.stencilFuncBack=e,this.stencilRefFront=this.stencilRefBack=t,this.stencilMaskFront=this.stencilMaskBack=i)}setStencilFuncFront(e,t,i){if(this.stencilFuncFront!==e||this.stencilRefFront!==t||this.stencilMaskFront!==i){const s=this.gl;s.stencilFuncSeparate(s.FRONT,this.glComparison[e],t,i),this.stencilFuncFront=e,this.stencilRefFront=t,this.stencilMaskFront=i}}setStencilFuncBack(e,t,i){if(this.stencilFuncBack!==e||this.stencilRefBack!==t||this.stencilMaskBack!==i){const s=this.gl;s.stencilFuncSeparate(s.BACK,this.glComparison[e],t,i),this.stencilFuncBack=e,this.stencilRefBack=t,this.stencilMaskBack=i}}setStencilOperation(e,t,i,s){(this.stencilFailFront!==e||this.stencilZfailFront!==t||this.stencilZpassFront!==i||this.stencilFailBack!==e||this.stencilZfailBack!==t||this.stencilZpassBack!==i)&&(this.gl.stencilOp(this.glStencilOp[e],this.glStencilOp[t],this.glStencilOp[i]),this.stencilFailFront=this.stencilFailBack=e,this.stencilZfailFront=this.stencilZfailBack=t,this.stencilZpassFront=this.stencilZpassBack=i),(this.stencilWriteMaskFront!==s||this.stencilWriteMaskBack!==s)&&(this.gl.stencilMask(s),this.stencilWriteMaskFront=s,this.stencilWriteMaskBack=s)}setStencilOperationFront(e,t,i,s){(this.stencilFailFront!==e||this.stencilZfailFront!==t||this.stencilZpassFront!==i)&&(this.gl.stencilOpSeparate(this.gl.FRONT,this.glStencilOp[e],this.glStencilOp[t],this.glStencilOp[i]),this.stencilFailFront=e,this.stencilZfailFront=t,this.stencilZpassFront=i),this.stencilWriteMaskFront!==s&&(this.gl.stencilMaskSeparate(this.gl.FRONT,s),this.stencilWriteMaskFront=s)}setStencilOperationBack(e,t,i,s){(this.stencilFailBack!==e||this.stencilZfailBack!==t||this.stencilZpassBack!==i)&&(this.gl.stencilOpSeparate(this.gl.BACK,this.glStencilOp[e],this.glStencilOp[t],this.glStencilOp[i]),this.stencilFailBack=e,this.stencilZfailBack=t,this.stencilZpassBack=i),this.stencilWriteMaskBack!==s&&(this.gl.stencilMaskSeparate(this.gl.BACK,s),this.stencilWriteMaskBack=s)}setBlendState(e){const t=this.blendState;if(!t.equals(e)){const i=this.gl,{blend:s,colorOp:n,alphaOp:a,colorSrcFactor:o,colorDstFactor:l,alphaSrcFactor:c,alphaDstFactor:u}=e;if(t.blend!==s&&(s?i.enable(i.BLEND):i.disable(i.BLEND)),t.colorOp!==n||t.alphaOp!==a){const h=this.glBlendEquation;i.blendEquationSeparate(h[n],h[a])}(t.colorSrcFactor!==o||t.colorDstFactor!==l||t.alphaSrcFactor!==c||t.alphaDstFactor!==u)&&i.blendFuncSeparate(this.glBlendFunctionColor[o],this.glBlendFunctionColor[l],this.glBlendFunctionAlpha[c],this.glBlendFunctionAlpha[u]),t.allWrite!==e.allWrite&&this.gl.colorMask(e.redWrite,e.greenWrite,e.blueWrite,e.alphaWrite),t.copy(e)}}setBlendColor(e,t,i,s){const n=this.blendColor;(e!==n.r||t!==n.g||i!==n.b||s!==n.a)&&(this.gl.blendColor(e,t,i,s),n.set(e,t,i,s))}setStencilState(e,t){e||t?(this.setStencilTest(!0),e===t?(this.setStencilFunc(e.func,e.ref,e.readMask),this.setStencilOperation(e.fail,e.zfail,e.zpass,e.writeMask)):(e??(e=Oa.DEFAULT),this.setStencilFuncFront(e.func,e.ref,e.readMask),this.setStencilOperationFront(e.fail,e.zfail,e.zpass,e.writeMask),t??(t=Oa.DEFAULT),this.setStencilFuncBack(t.func,t.ref,t.readMask),this.setStencilOperationBack(t.fail,t.zfail,t.zpass,t.writeMask))):this.setStencilTest(!1)}setDepthState(e){const t=this.depthState;if(!t.equals(e)){const i=this.gl,s=e.write;t.write!==s&&i.depthMask(s);let{func:n,test:a}=e;!a&&s&&(a=!0,n=Lo),t.func!==n&&i.depthFunc(this.glComparison[n]),t.test!==a&&(a?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST));const{depthBias:o,depthBiasSlope:l}=e;o||l?(this.depthBiasEnabled||(this.depthBiasEnabled=!0,this.gl.enable(this.gl.POLYGON_OFFSET_FILL)),i.polygonOffset(l,o)):this.depthBiasEnabled&&(this.depthBiasEnabled=!1,this.gl.disable(this.gl.POLYGON_OFFSET_FILL)),t.copy(e)}}setCullMode(e){if(this.cullMode!==e){if(e===Vi)this.gl.disable(this.gl.CULL_FACE);else{this.cullMode===Vi&&this.gl.enable(this.gl.CULL_FACE);const t=this.glCull[e];this.cullFace!==t&&(this.gl.cullFace(t),this.cullFace=t)}this.cullMode=e}}setShader(e,t=!1){e!==this.shader&&(this.shader=e,this.shaderAsyncCompile=t,this.shaderValid=void 0)}activateShader(){const{shader:e}=this,{impl:t}=e;this.shaderValid===void 0&&(e.failed?this.shaderValid=!1:e.ready||(this.shaderAsyncCompile?t.isLinked(this)?t.finalize(this,e)||(e.failed=!0,this.shaderValid=!1):this.shaderValid=!1:t.finalize(this,e)||(e.failed=!0,this.shaderValid=!1))),this.shaderValid===void 0&&(this.gl.useProgram(t.glProgram),this.shaderValid=!0)}clearVertexArrayObjectCache(){const e=this.gl;this._vaoMap.forEach((t,i,s)=>{e.deleteVertexArray(t)}),this._vaoMap.clear()}set fullscreen(e){e?this.gl.canvas.requestFullscreen():document.exitFullscreen()}get fullscreen(){return!!document.fullscreenElement}}let ppe=0;class dh{constructor(e,t,i,s=Kn,n,a){this.device=e,this.format=t,this.numIndices=i,this.usage=s,this.id=ppe++,this.impl=e.createIndexBufferImpl(this,a);const o=yfe[t];this.bytesPerIndex=o,this.numBytes=this.numIndices*o,n?this.setData(n):this.storage=new ArrayBuffer(this.numBytes),this.adjustVramSizeTracking(e._vram,this.numBytes),this.device.buffers.push(this)}destroy(){const e=this.device,t=e.buffers.indexOf(this);t!==-1&&e.buffers.splice(t,1),this.device.indexBuffer===this&&(this.device.indexBuffer=null),this.impl.initialized&&(this.impl.destroy(e),this.adjustVramSizeTracking(e._vram,-this.storage.byteLength))}adjustVramSizeTracking(e,t){e.ib+=t}loseContext(){this.impl.loseContext()}getFormat(){return this.format}getNumIndices(){return this.numIndices}lock(){return this.storage}unlock(){this.impl.unlock(this)}setData(e){return e.byteLength!==this.numBytes?!1:(this.storage=e,this.unlock(),!0)}_lockTypedArray(){const e=this.lock();return this.format===bc?new Uint32Array(e):this.format===xc?new Uint16Array(e):new Uint8Array(e)}writeData(e,t){const i=this._lockTypedArray();if(e.length>t)if(ArrayBuffer.isView(e))e=e.subarray(0,t),i.set(e);else for(let s=0;s<t;s++)i[s]=e[s];else i.set(e);this.unlock()}readData(e){const t=this._lockTypedArray(),i=this.numIndices;if(ArrayBuffer.isView(e))e.set(t);else{e.length=0;for(let s=0;s<i;s++)e[s]=t[s]}return i}}class mpe{constructor(){this.clearValue=new ae(0,0,0,1),this.clearValueLinear=new ae(0,0,0,1),this.clear=!1,this.store=!1,this.resolve=!0,this.genMipmaps=!1}}class gpe{constructor(){this.clearDepthValue=1,this.clearStencilValue=0,this.clearDepth=!1,this.clearStencil=!1,this.storeDepth=!1,this.resolveDepth=!1,this.storeStencil=!1}}class dn{get colorOps(){return this.colorArrayOps[0]}constructor(e){this._enabled=!0,this._skipStart=!1,this._skipEnd=!1,this.executeEnabled=!0,this.samples=0,this.colorArrayOps=[],this.requiresCubemaps=!0,this.fullSizeClearRect=!0,this.beforePasses=[],this.afterPasses=[],this.device=e}set name(e){this._name=e}get name(){return this._name||(this._name=this.constructor.name),this._name}set scaleX(e){this._options.scaleX=e}get scaleX(){return this._options.scaleX}set scaleY(e){this._options.scaleY=e}get scaleY(){return this._options.scaleY}set options(e){this._options=e,e&&(this.scaleX=this.scaleX??1,this.scaleY=this.scaleY??1)}get options(){return this._options}init(e=null,t){this.options=t,this.renderTarget=e,this.samples=Math.max(this.renderTarget?this.renderTarget.samples:this.device.samples,1),this.allocateAttachments(),this.postInit()}allocateAttachments(){var i,s,n,a;const e=this.renderTarget;this.depthStencilOps=new gpe,e!=null&&e.depthBuffer&&(this.depthStencilOps.storeDepth=!0);const t=e?((i=e._colorBuffers)==null?void 0:i.length)??0:1;this.colorArrayOps.length=0;for(let o=0;o<t;o++){const l=new mpe;this.colorArrayOps[o]=l,this.samples===1&&(l.store=!0,l.resolve=!1);const c=(n=(s=this.renderTarget)==null?void 0:s._colorBuffers)==null?void 0:n[o];if((a=this.renderTarget)!=null&&a.mipmaps&&(c!=null&&c.mipmaps)){const u=Xd(c._format);l.genMipmaps=!u}}}destroy(){}postInit(){}frameUpdate(){if(this._options&&this.renderTarget){const e=this._options.resizeSource??this.device.backBuffer,t=Math.floor(e.width*this.scaleX),i=Math.floor(e.height*this.scaleY);this.renderTarget.resize(t,i)}}before(){}execute(){}after(){}onEnable(){}onDisable(){}set enabled(e){this._enabled!==e&&(this._enabled=e,e?this.onEnable():this.onDisable())}get enabled(){return this._enabled}setClearColor(e){const t=this.colorArrayOps.length;for(let i=0;i<t;i++){const s=this.colorArrayOps[i];e&&(s.clearValue.copy(e),s.clearValueLinear.linear(e)),s.clear=!!e}}setClearDepth(e){e&&(this.depthStencilOps.clearDepthValue=e),this.depthStencilOps.clearDepth=e!==void 0}setClearStencil(e){e&&(this.depthStencilOps.clearStencilValue=e),this.depthStencilOps.clearStencil=e!==void 0}render(){if(this.enabled){const e=this.device,t=this.renderTarget!==void 0;this.before(),this.executeEnabled&&(t&&!this._skipStart&&e.startRenderPass(this),this.execute(),t&&!this._skipEnd&&e.endRenderPass(this)),this.after(),e.renderPassIndex++}}}function _pe(r){this.array[this.index]=r}function vpe(r,e){this.array[this.index]=r,this.array[this.index+1]=e}function ype(r,e,t){this.array[this.index]=r,this.array[this.index+1]=e,this.array[this.index+2]=t}function Spe(r,e,t,i){this.array[this.index]=r,this.array[this.index+1]=e,this.array[this.index+2]=t,this.array[this.index+3]=i}function xpe(r,e,t){this.array[r]=e[t]}function bpe(r,e,t){this.array[r]=e[t],this.array[r+1]=e[t+1]}function wpe(r,e,t){this.array[r]=e[t],this.array[r+1]=e[t+1],this.array[r+2]=e[t+2]}function Tpe(r,e,t){this.array[r]=e[t],this.array[r+1]=e[t+1],this.array[r+2]=e[t+2],this.array[r+3]=e[t+3]}function Epe(r,e,t){e[t]=this.array[r]}function Ape(r,e,t){e[t]=this.array[r],e[t+1]=this.array[r+1]}function Cpe(r,e,t){e[t]=this.array[r],e[t+1]=this.array[r+1],e[t+2]=this.array[r+2]}function Ppe(r,e,t){e[t]=this.array[r],e[t+1]=this.array[r+1],e[t+2]=this.array[r+2],e[t+3]=this.array[r+3]}class Ipe{constructor(e,t,i){switch(this.index=0,this.numComponents=t.numComponents,i.interleaved?this.array=new If[t.dataType](e,t.offset):this.array=new If[t.dataType](e,t.offset,i.vertexCount*t.numComponents),this.stride=t.stride/this.array.constructor.BYTES_PER_ELEMENT,t.numComponents){case 1:this.set=_pe,this.getToArray=Epe,this.setFromArray=xpe;break;case 2:this.set=vpe,this.getToArray=Ape,this.setFromArray=bpe;break;case 3:this.set=ype,this.getToArray=Cpe,this.setFromArray=wpe;break;case 4:this.set=Spe,this.getToArray=Ppe,this.setFromArray=Tpe;break}}get(e){return this.array[this.index+e]}set(e,t,i,s){}getToArray(e,t,i){}setFromArray(e,t,i){}}class Xg{constructor(e){this.vertexBuffer=e,this.vertexFormatSize=e.getFormat().size,this.buffer=this.vertexBuffer.lock(),this.accessors=[],this.element={};const t=this.vertexBuffer.getFormat();for(let i=0;i<t.elements.length;i++){const s=t.elements[i];this.accessors[i]=new Ipe(this.buffer,s,t),this.element[s.name]=this.accessors[i]}}next(e=1){let t=0;const i=this.accessors,s=this.accessors.length;for(;t<s;){const n=i[t++];n.index+=e*n.stride}}end(){this.vertexBuffer.unlock()}writeData(e,t,i){const s=this.element[e];if(s){i>this.vertexBuffer.numVertices&&(i=this.vertexBuffer.numVertices);const n=s.numComponents;if(this.vertexBuffer.getFormat().interleaved){let a=0;for(let o=0;o<i;o++)s.setFromArray(a,t,o*n),a+=s.stride}else if(t.length>i*n){const a=i*n;if(ArrayBuffer.isView(t))t=t.subarray(0,a),s.array.set(t);else for(let o=0;o<a;o++)s.array[o]=t[o]}else s.array.set(t)}}readData(e,t){const i=this.element[e];let s=0;if(i){s=this.vertexBuffer.numVertices;let n;const a=i.numComponents;if(this.vertexBuffer.getFormat().interleaved){Array.isArray(t)&&(t.length=0),i.index=0;let o=0;for(n=0;n<s;n++)i.getToArray(o,t,n*a),o+=i.stride}else if(ArrayBuffer.isView(t))t.set(i.array);else{t.length=0;const o=s*a;for(n=0;n<o;n++)t[n]=i.array[n]}}return s}}const Mpe=-1;class Rpe{constructor(e,t){this.key=null,this.element=null,this.event=null,t&&(this.key=t.keyCode,this.element=t.target,this.event=t)}}const R0=new Rpe;function aC(r){return R0.key=r.keyCode,R0.element=r.target,R0.event=r,R0}function D0(r){return typeof r=="string"?r.toUpperCase().charCodeAt(0):r}const Dpe={9:"Tab",13:"Enter",16:"Shift",17:"Control",18:"Alt",27:"Escape",37:"Left",38:"Up",39:"Right",40:"Down",46:"Delete",91:"Win"},tT=class tT extends Te{constructor(e,t={}){super(),this._element=null,this._keymap={},this._lastmap={},this._keyDownHandler=this._handleKeyDown.bind(this),this._keyUpHandler=this._handleKeyUp.bind(this),this._keyPressHandler=this._handleKeyPress.bind(this),this._visibilityChangeHandler=this._handleVisibilityChange.bind(this),this._windowBlurHandler=this._handleWindowBlur.bind(this),e&&this.attach(e),this.preventDefault=t.preventDefault||!1,this.stopPropagation=t.stopPropagation||!1}attach(e){this._element&&this.detach(),this._element=e,this._element.addEventListener("keydown",this._keyDownHandler,!1),this._element.addEventListener("keypress",this._keyPressHandler,!1),this._element.addEventListener("keyup",this._keyUpHandler,!1),document.addEventListener("visibilitychange",this._visibilityChangeHandler,!1),window.addEventListener("blur",this._windowBlurHandler,!1)}detach(){this._element&&(this._element.removeEventListener("keydown",this._keyDownHandler),this._element.removeEventListener("keypress",this._keyPressHandler),this._element.removeEventListener("keyup",this._keyUpHandler),this._element=null,document.removeEventListener("visibilitychange",this._visibilityChangeHandler,!1),window.removeEventListener("blur",this._windowBlurHandler,!1))}toKeyIdentifier(e){e=D0(e);const t=Dpe[e.toString()];if(t)return t;let i=e.toString(16).toUpperCase();const s=i.length;for(let n=0;n<4-s;n++)i=`0${i}`;return`U+${i}`}_handleKeyDown(e){const t=e.keyCode||e.charCode;if(t===void 0)return;const i=this.toKeyIdentifier(t);this._keymap[i]=!0,this.fire("keydown",aC(e)),this.preventDefault&&e.preventDefault(),this.stopPropagation&&e.stopPropagation()}_handleKeyUp(e){const t=e.keyCode||e.charCode;if(t===void 0)return;const i=this.toKeyIdentifier(t);delete this._keymap[i],this.fire("keyup",aC(e)),this.preventDefault&&e.preventDefault(),this.stopPropagation&&e.stopPropagation()}_handleKeyPress(e){this.fire("keypress",aC(e)),this.preventDefault&&e.preventDefault(),this.stopPropagation&&e.stopPropagation()}_handleVisibilityChange(){document.visibilityState==="hidden"&&this._handleWindowBlur()}_handleWindowBlur(){this._keymap={},this._lastmap={}}update(){for(const e in this._lastmap)delete this._lastmap[e];for(const e in this._keymap)this._keymap.hasOwnProperty(e)&&(this._lastmap[e]=this._keymap[e])}isPressed(e){const t=D0(e),i=this.toKeyIdentifier(t);return!!this._keymap[i]}wasPressed(e){const t=D0(e),i=this.toKeyIdentifier(t);return!!this._keymap[i]&&!this._lastmap[i]}wasReleased(e){const t=D0(e),i=this.toKeyIdentifier(t);return!this._keymap[i]&&!!this._lastmap[i]}};tT.EVENT_KEYDOWN="keydown",tT.EVENT_KEYUP="keyup";let bM=tT;function wM(){return!!(document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement)}class qd{constructor(e,t){this.x=0,this.y=0,this.dx=0,this.dy=0,this.button=Mpe,this.wheelDelta=0,this.ctrlKey=!1,this.altKey=!1,this.shiftKey=!1,this.metaKey=!1;let i={x:0,y:0};if(t){if(t instanceof qd)throw Error("Expected MouseEvent");i=e._getTargetCoords(t)}else t={};if(i)this.x=i.x,this.y=i.y;else if(wM())this.x=0,this.y=0;else return;t.type==="wheel"&&(t.deltaY>0?this.wheelDelta=1:t.deltaY<0&&(this.wheelDelta=-1)),wM()?(this.dx=t.movementX||t.webkitMovementX||t.mozMovementX||0,this.dy=t.movementY||t.webkitMovementY||t.mozMovementY||0):(this.dx=this.x-e._lastX,this.dy=this.y-e._lastY),(t.type==="mousedown"||t.type==="mouseup")&&(this.button=t.button),this.buttons=e._buttons.slice(0),this.element=t.target,this.ctrlKey=t.ctrlKey??!1,this.altKey=t.altKey??!1,this.shiftKey=t.shiftKey??!1,this.metaKey=t.metaKey??!1,this.event=t}}const af=class af extends Te{constructor(e){super(),this._lastX=0,this._lastY=0,this._buttons=[!1,!1,!1],this._lastbuttons=[!1,!1,!1],this._target=null,this._attached=!1,this._upHandler=this._handleUp.bind(this),this._downHandler=this._handleDown.bind(this),this._moveHandler=this._handleMove.bind(this),this._wheelHandler=this._handleWheel.bind(this),this._contextMenuHandler=t=>{t.preventDefault()},this.attach(e)}static isPointerLocked(){return wM()}attach(e){if(this._target=e,this._attached)return;this._attached=!0;const t={passive:!1},i=Ye.passiveEvents?t:!1;window.addEventListener("mouseup",this._upHandler,i),window.addEventListener("mousedown",this._downHandler,i),window.addEventListener("mousemove",this._moveHandler,i),window.addEventListener("wheel",this._wheelHandler,i)}detach(){if(!this._attached)return;this._attached=!1,this._target=null;const e={passive:!1},t=Ye.passiveEvents?e:!1;window.removeEventListener("mouseup",this._upHandler,t),window.removeEventListener("mousedown",this._downHandler,t),window.removeEventListener("mousemove",this._moveHandler,t),window.removeEventListener("wheel",this._wheelHandler,t)}disableContextMenu(){this._target&&this._target.addEventListener("contextmenu",this._contextMenuHandler)}enableContextMenu(){this._target&&this._target.removeEventListener("contextmenu",this._contextMenuHandler)}enablePointerLock(e,t){if(!document.body.requestPointerLock){t&&t();return}const i=()=>{e(),document.removeEventListener("pointerlockchange",i)},s=()=>{t(),document.removeEventListener("pointerlockerror",s)};e&&document.addEventListener("pointerlockchange",i,!1),t&&document.addEventListener("pointerlockerror",s,!1),document.body.requestPointerLock()}disablePointerLock(e){if(!document.exitPointerLock)return;const t=()=>{e(),document.removeEventListener("pointerlockchange",t)};e&&document.addEventListener("pointerlockchange",t,!1),document.exitPointerLock()}update(){this._lastbuttons[0]=this._buttons[0],this._lastbuttons[1]=this._buttons[1],this._lastbuttons[2]=this._buttons[2]}isPressed(e){return this._buttons[e]}wasPressed(e){return this._buttons[e]&&!this._lastbuttons[e]}wasReleased(e){return!this._buttons[e]&&this._lastbuttons[e]}_handleUp(e){this._buttons[e.button]=!1;const t=new qd(this,e);t.event&&this.fire("mouseup",t)}_handleDown(e){this._buttons[e.button]=!0;const t=new qd(this,e);t.event&&this.fire("mousedown",t)}_handleMove(e){const t=new qd(this,e);t.event&&(this.fire("mousemove",t),this._lastX=t.x,this._lastY=t.y)}_handleWheel(e){const t=new qd(this,e);t.event&&this.fire("mousewheel",t)}_getTargetCoords(e){const t=this._target.getBoundingClientRect(),i=Math.floor(t.left),s=Math.floor(t.top);return e.clientX<i||e.clientX>=i+this._target.clientWidth||e.clientY<s||e.clientY>=s+this._target.clientHeight?null:{x:e.clientX-i,y:e.clientY-s}}};af.EVENT_MOUSEMOVE="mousemove",af.EVENT_MOUSEDOWN="mousedown",af.EVENT_MOUSEUP="mouseup",af.EVENT_MOUSEWHEEL="mousewheel";let pb=af;function Lpe(r){let e=0,t=0,i=r.target;for(;!(i instanceof HTMLElement)&&i;)i=i.parentNode;for(;i;)e+=i.offsetLeft-i.scrollLeft,t+=i.offsetTop-i.scrollTop,i=i.offsetParent;return{x:r.pageX-e,y:r.pageY-t}}class fU{constructor(e){const t=Lpe(e);this.id=e.identifier,this.x=t.x,this.y=t.y,this.target=e.target,this.touch=e}}class L0{constructor(e,t){this.touches=[],this.changedTouches=[],this.element=t.target,this.event=t,this.touches=Array.from(t.touches).map(i=>new fU(i)),this.changedTouches=Array.from(t.changedTouches).map(i=>new fU(i))}getTouchById(e,t){return t.find(i=>i.id===e)||null}}const of=class of extends Te{constructor(e){super(),this._element=null,this._startHandler=this._handleTouchStart.bind(this),this._endHandler=this._handleTouchEnd.bind(this),this._moveHandler=this._handleTouchMove.bind(this),this._cancelHandler=this._handleTouchCancel.bind(this),this.attach(e)}attach(e){this._element&&this.detach(),this._element=e,this._element.addEventListener("touchstart",this._startHandler,!1),this._element.addEventListener("touchend",this._endHandler,!1),this._element.addEventListener("touchmove",this._moveHandler,!1),this._element.addEventListener("touchcancel",this._cancelHandler,!1)}detach(){this._element&&(this._element.removeEventListener("touchstart",this._startHandler,!1),this._element.removeEventListener("touchend",this._endHandler,!1),this._element.removeEventListener("touchmove",this._moveHandler,!1),this._element.removeEventListener("touchcancel",this._cancelHandler,!1)),this._element=null}_handleTouchStart(e){this.fire("touchstart",new L0(this,e))}_handleTouchEnd(e){this.fire("touchend",new L0(this,e))}_handleTouchMove(e){e.preventDefault(),this.fire("touchmove",new L0(this,e))}_handleTouchCancel(e){this.fire("touchcancel",new L0(this,e))}};of.EVENT_TOUCHSTART="touchstart",of.EVENT_TOUCHEND="touchend",of.EVENT_TOUCHMOVE="touchmove",of.EVENT_TOUCHCANCEL="touchcancel";let mb=of;const st=class st{get(e,t,i){return typeof t=="function"&&(i=t,t={}),this.request("GET",e,t,i)}post(e,t,i,s){return typeof i=="function"&&(s=i,i={}),i.postdata=t,this.request("POST",e,i,s)}put(e,t,i,s){return typeof i=="function"&&(s=i,i={}),i.postdata=t,this.request("PUT",e,i,s)}del(e,t,i){return typeof t=="function"&&(i=t,t={}),this.request("DELETE",e,t,i)}request(e,t,i,s){let n,a,o,l=!1;if(typeof i=="function"&&(s=i,i={}),i.retry&&(i=Object.assign({retries:0,maxRetries:5},i)),i.callback=s,i.async==null&&(i.async=!0),i.headers==null&&(i.headers={}),i.postdata!=null)if(i.postdata instanceof Document)o=i.postdata;else if(i.postdata instanceof FormData)o=i.postdata;else if(i.postdata instanceof Object){let u=i.headers["Content-Type"];switch(u===void 0&&(i.headers["Content-Type"]=st.ContentType.FORM_URLENCODED,u=i.headers["Content-Type"]),u){case st.ContentType.FORM_URLENCODED:{o="";let h=!0;for(const d in i.postdata)if(i.postdata.hasOwnProperty(d)){h?h=!1:o+="&";const f=encodeURIComponent(d),p=encodeURIComponent(i.postdata[d]);o+=`${f}=${p}`}break}default:case st.ContentType.JSON:u==null&&(i.headers["Content-Type"]=st.ContentType.JSON),o=JSON.stringify(i.postdata);break}}else o=i.postdata;if(i.cache===!1){const u=Qo();n=new Q1(t),n.query?n.query=`${n.query}&ts=${u}`:n.query=`ts=${u}`,t=n.toString()}i.query&&(n=new Q1(t),a=ib(n.getQuery(),i.query),n.setQuery(a),t=n.toString());const c=new XMLHttpRequest;c.open(e,t,i.async),c.withCredentials=i.withCredentials!==void 0?i.withCredentials:!1,c.responseType=i.responseType||this._guessResponseType(t);for(const u in i.headers)i.headers.hasOwnProperty(u)&&c.setRequestHeader(u,i.headers[u]);c.onreadystatechange=()=>{this._onReadyStateChange(e,t,i,c)},c.onerror=()=>{this._onError(e,t,i,c),l=!0};try{c.send(o)}catch(u){l||i.error(c.status,c,u)}return c}_guessResponseType(e){const t=new Q1(e),i=Ne.getExtension(t.path).toLowerCase();return st.binaryExtensions.indexOf(i)>=0?st.ResponseType.ARRAY_BUFFER:i===".json"?st.ResponseType.JSON:i===".xml"?st.ResponseType.DOCUMENT:st.ResponseType.TEXT}_isBinaryContentType(e){return[st.ContentType.BASIS,st.ContentType.BIN,st.ContentType.DDS,st.ContentType.GLB,st.ContentType.MP3,st.ContentType.MP4,st.ContentType.OGG,st.ContentType.OPUS,st.ContentType.WAV].indexOf(e)>=0}_isBinaryResponseType(e){return e===st.ResponseType.ARRAY_BUFFER||e===st.ResponseType.BLOB||e===st.ResponseType.JSON}_onReadyStateChange(e,t,i,s){if(s.readyState===4)switch(s.status){case 0:{s.responseURL&&s.responseURL.startsWith("file:///")?this._onSuccess(e,t,i,s):this._onError(e,t,i,s);break}case 200:case 201:case 206:case 304:{this._onSuccess(e,t,i,s);break}default:{this._onError(e,t,i,s);break}}}_onSuccess(e,t,i,s){let n,a;const o=s.getResponseHeader("Content-Type");o&&(a=o.split(";")[0].trim());try{this._isBinaryContentType(a)||this._isBinaryResponseType(s.responseType)?n=s.response:a===st.ContentType.JSON||t.split("?")[0].endsWith(".json")?n=JSON.parse(s.responseText):s.responseType===st.ResponseType.DOCUMENT||a===st.ContentType.XML?n=s.responseXML:n=s.responseText,i.callback(null,n)}catch(l){i.callback(l)}}_onError(e,t,i,s){if(!i.retrying)if(i.retry&&i.retries<i.maxRetries){i.retries++,i.retrying=!0;const n=Q.clamp(Math.pow(2,i.retries)*st.retryDelay,0,i.maxRetryDelay||5e3);console.log(`${e}: ${t} - Error ${s.status}. Retrying in ${n} ms`),setTimeout(()=>{i.retrying=!1,this.request(e,t,i,i.callback)},n)}else i.callback(s.status===0?"Network error":s.status,null)}};st.ContentType={AAC:"audio/aac",BASIS:"image/basis",BIN:"application/octet-stream",DDS:"image/dds",FORM_URLENCODED:"application/x-www-form-urlencoded",GIF:"image/gif",GLB:"model/gltf-binary",JPEG:"image/jpeg",JSON:"application/json",MP3:"audio/mpeg",MP4:"audio/mp4",OGG:"audio/ogg",OPUS:'audio/ogg; codecs="opus"',PNG:"image/png",TEXT:"text/plain",WAV:"audio/x-wav",XML:"application/xml"},st.ResponseType={TEXT:"text",ARRAY_BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json"},st.binaryExtensions=[".model",".wav",".ogg",".mp3",".mp4",".m4a",".aac",".dds",".basis",".glb",".opus"],st.retryDelay=100;let Os=st;const qt=new Os,u3="linear",Ope="inverse",Npe="exponential";class kpe{constructor(e){this.position=new O,this.orientation=new se,this._manager=e}getPosition(){return this.position}setPosition(e){this.position.copy(e);const t=this.listener;t&&("positionX"in t?(t.positionX.value=e.x,t.positionY.value=e.y,t.positionZ.value=e.z):t.setPosition&&t.setPosition(e.x,e.y,e.z))}setOrientation(e){this.orientation.copy(e);const t=this.listener;if(t){const i=e.data;"forwardX"in t?(t.forwardX.value=-i[8],t.forwardY.value=-i[9],t.forwardZ.value=-i[10],t.upX.value=i[4],t.upY.value=i[5],t.upZ.value=i[6]):t.setOrientation&&t.setOrientation(-i[8],-i[9],-i[10],i[4],i[5],i[6])}}getOrientation(){return this.orientation}get listener(){const e=this._manager.context;return e?e.listener:null}}const O0="running",pU=["click","touchstart","mousedown"];class Fpe extends Te{constructor(){super(),this._context=null,this.AudioContext=typeof AudioContext<"u"&&AudioContext||typeof webkitAudioContext<"u"&&webkitAudioContext,this.AudioContext,this._unlockHandlerFunc=this._unlockHandler.bind(this),this._userSuspended=!1,this.listener=new kpe(this),this._volume=1}set volume(e){e=Q.clamp(e,0,1),this._volume=e,this.fire("volumechange",e)}get volume(){return this._volume}get suspended(){return this._userSuspended}get context(){return!this._context&&this.AudioContext&&(this._context=new this.AudioContext,this._context.state!==O0&&this._registerUnlockListeners()),this._context}suspend(){this._userSuspended||(this._userSuspended=!0,this._context&&this._context.state===O0&&this._suspend())}resume(){this._userSuspended&&(this._userSuspended=!1,this._context&&this._context.state!==O0&&this._resume())}destroy(){var e;this.fire("destroy"),this._context&&(this._removeUnlockListeners(),(e=this._context)==null||e.close(),this._context=null)}_resume(){this._context.resume().then(()=>{const e=this._context.createBufferSource();e.buffer=this._context.createBuffer(1,1,this._context.sampleRate),e.connect(this._context.destination),e.start(0),e.onended=t=>{e.disconnect(0),this.fire("resume")}},e=>{}).catch(e=>{})}_suspend(){this._context.suspend().then(()=>{this.fire("suspend")},e=>{}).catch(e=>{})}_unlockHandler(){this._removeUnlockListeners(),!this._userSuspended&&this._context.state!==O0&&this._resume()}_registerUnlockListeners(){pU.forEach(e=>{window.addEventListener(e,this._unlockHandlerFunc,!1)})}_removeUnlockListeners(){pU.forEach(e=>{window.removeEventListener(e,this._unlockHandlerFunc,!1)})}}class Bpe{constructor(e){e instanceof Audio?this.audio=e:this.buffer=e}get duration(){let e=0;return this.buffer?e=this.buffer.duration:this.audio&&(e=this.audio.duration),e||0}}function Ey(){return typeof AudioContext<"u"||typeof webkitAudioContext<"u"}const Hr=0,Yd=1,Ln=2;function Xr(r,e){return r%e||0}const mu=class mu extends Te{constructor(e,t,i){super(),this.source=null,this._manager=e,this._volume=i.volume!==void 0?Q.clamp(Number(i.volume)||0,0,1):1,this._pitch=i.pitch!==void 0?Math.max(.01,Number(i.pitch)||0):1,this._loop=!!(i.loop!==void 0&&i.loop),this._sound=t,this._state=Ln,this._suspended=!1,this._suspendEndEvent=0,this._suspendInstanceEvents=!1,this._playWhenLoaded=!0,this._startTime=Math.max(0,Number(i.startTime)||0),this._duration=Math.max(0,Number(i.duration)||0),this._startOffset=null,this._onPlayCallback=i.onPlay,this._onPauseCallback=i.onPause,this._onResumeCallback=i.onResume,this._onStopCallback=i.onStop,this._onEndCallback=i.onEnd,Ey()?(this._startedAt=0,this._currentTime=0,this._currentOffset=0,this._inputNode=null,this._connectorNode=null,this._firstNode=null,this._lastNode=null,this._waitingContextSuspension=!1,this._initializeNodes(),this._endedHandler=this._onEnded.bind(this)):(this._isReady=!1,this._loadedMetadataHandler=this._onLoadedMetadata.bind(this),this._timeUpdateHandler=this._onTimeUpdate.bind(this),this._endedHandler=this._onEnded.bind(this),this._createSource())}set currentTime(e){if(!(e<0))if(this._state===Hr){const t=this._suspendInstanceEvents;this._suspendInstanceEvents=!0,this.stop(),this._startOffset=e,this.play(),this._suspendInstanceEvents=t}else this._startOffset=e,this._currentTime=e}get currentTime(){return this._startOffset!==null?this._startOffset:this._state===Yd?this._currentTime:this._state===Ln||!this.source?0:(this._updateCurrentTime(),this._currentTime)}set duration(e){this._duration=Math.max(0,Number(e)||0);const t=this._state===Hr;this.stop(),t&&this.play()}get duration(){return this._sound?this._duration?Xr(this._duration,this._sound.duration):this._sound.duration:0}get isPaused(){return this._state===Yd}get isPlaying(){return this._state===Hr}get isStopped(){return this._state===Ln}get isSuspended(){return this._suspended}set loop(e){this._loop=!!e,this.source&&(this.source.loop=this._loop)}get loop(){return this._loop}set pitch(e){this._currentOffset=this.currentTime,this._startedAt=this._manager.context.currentTime,this._pitch=Math.max(Number(e)||0,.01),this.source&&(this.source.playbackRate.value=this._pitch)}get pitch(){return this._pitch}set sound(e){this._sound=e,this._state!==Ln?this.stop():this._createSource()}get sound(){return this._sound}set startTime(e){this._startTime=Math.max(0,Number(e)||0);const t=this._state===Hr;this.stop(),t&&this.play()}get startTime(){return this._startTime}set volume(e){e=Q.clamp(e,0,1),this._volume=e,this.gain&&(this.gain.gain.value=e*this._manager.volume)}get volume(){return this._volume}_onPlay(){this.fire("play"),this._onPlayCallback&&this._onPlayCallback(this)}_onPause(){this.fire("pause"),this._onPauseCallback&&this._onPauseCallback(this)}_onResume(){this.fire("resume"),this._onResumeCallback&&this._onResumeCallback(this)}_onStop(){this.fire("stop"),this._onStopCallback&&this._onStopCallback(this)}_onEnded(){if(this._suspendEndEvent>0){this._suspendEndEvent--;return}this.fire("end"),this._onEndCallback&&this._onEndCallback(this),this.stop()}_onManagerVolumeChange(){this.volume=this._volume}_onManagerSuspend(){this._state===Hr&&!this._suspended&&(this._suspended=!0,this.pause())}_onManagerResume(){this._suspended&&(this._suspended=!1,this.resume())}_initializeNodes(){this.gain=this._manager.context.createGain(),this._inputNode=this.gain,this._connectorNode=this.gain,this._connectorNode.connect(this._manager.context.destination)}play(){return this._state!==Ln&&this.stop(),this._state=Hr,this._playWhenLoaded=!1,this._waitingContextSuspension?!1:this._manager.suspended?(this._manager.once("resume",this._playAudioImmediate,this),this._waitingContextSuspension=!0,!1):(this._playAudioImmediate(),!0)}_playAudioImmediate(){if(this._waitingContextSuspension=!1,this._state!==Hr)return;this.source||this._createSource();let e=Xr(this._startOffset,this.duration);e=Xr(this._startTime+e,this._sound.duration),this._startOffset=null,this._duration?this.source.start(0,e,this._duration):this.source.start(0,e),this._startedAt=this._manager.context.currentTime,this._currentTime=0,this._currentOffset=e,this.volume=this._volume,this.loop=this._loop,this.pitch=this._pitch,this._manager.on("volumechange",this._onManagerVolumeChange,this),this._manager.on("suspend",this._onManagerSuspend,this),this._manager.on("resume",this._onManagerResume,this),this._manager.on("destroy",this._onManagerDestroy,this),this._suspendInstanceEvents||this._onPlay()}pause(){return this._playWhenLoaded=!1,this._state!==Hr?!1:(this._state=Yd,this._waitingContextSuspension||(this._updateCurrentTime(),this._suspendEndEvent++,this.source.stop(0),this.source=null,this._startOffset=null,this._suspendInstanceEvents||this._onPause()),!0)}resume(){if(this._state!==Yd)return!1;let e=this.currentTime;return this._state=Hr,this._waitingContextSuspension||(this.source||this._createSource(),this._startOffset!==null&&(e=Xr(this._startOffset,this.duration),e=Xr(this._startTime+e,this._sound.duration),this._startOffset=null),this._duration?this.source.start(0,e,this._duration):this.source.start(0,e),this._startedAt=this._manager.context.currentTime,this._currentOffset=e,this.volume=this._volume,this.loop=this._loop,this.pitch=this._pitch,this._playWhenLoaded=!1,this._suspendInstanceEvents||this._onResume()),!0}stop(){if(this._playWhenLoaded=!1,this._state===Ln)return!1;const e=this._state===Hr;return this._state=Ln,this._waitingContextSuspension||(this._manager.off("volumechange",this._onManagerVolumeChange,this),this._manager.off("suspend",this._onManagerSuspend,this),this._manager.off("resume",this._onManagerResume,this),this._manager.off("destroy",this._onManagerDestroy,this),this._startedAt=0,this._currentTime=0,this._currentOffset=0,this._startOffset=null,this._suspendEndEvent++,e&&this.source&&this.source.stop(0),this.source=null,this._suspendInstanceEvents||this._onStop()),!0}setExternalNodes(e,t){if(!e){console.error("The firstNode must be a valid Audio Node");return}t||(t=e);const i=this._manager.context.destination;this._firstNode!==e&&(this._firstNode?this._connectorNode.disconnect(this._firstNode):this._connectorNode.disconnect(i),this._firstNode=e,this._connectorNode.connect(e)),this._lastNode!==t&&(this._lastNode&&this._lastNode.disconnect(i),this._lastNode=t,this._lastNode.connect(i))}clearExternalNodes(){const e=this._manager.context.destination;this._firstNode&&(this._connectorNode.disconnect(this._firstNode),this._firstNode=null),this._lastNode&&(this._lastNode.disconnect(e),this._lastNode=null),this._connectorNode.connect(e)}getExternalNodes(){return[this._firstNode,this._lastNode]}_createSource(){if(!this._sound)return null;const e=this._manager.context;return this._sound.buffer&&(this.source=e.createBufferSource(),this.source.buffer=this._sound.buffer,this.source.connect(this._inputNode),this.source.onended=this._endedHandler,this.source.loopStart=Xr(this._startTime,this.source.buffer.duration),this._duration&&(this.source.loopEnd=Math.max(this.source.loopStart,Xr(this._startTime+this._duration,this.source.buffer.duration)))),this.source}_updateCurrentTime(){this._currentTime=Xr((this._manager.context.currentTime-this._startedAt)*this._pitch+this._currentOffset,this.duration)}_onManagerDestroy(){this.source&&this._state===Hr&&(this.source.stop(0),this.source=null)}};mu.EVENT_PLAY="play",mu.EVENT_PAUSE="pause",mu.EVENT_RESUME="resume",mu.EVENT_STOP="stop",mu.EVENT_END="end";let Io=mu;Ey()||(Object.assign(Io.prototype,{play:function(){return this._state!==Ln&&this.stop(),!this.source&&!this._createSource()?!1:(this.volume=this._volume,this.pitch=this._pitch,this.loop=this._loop,this.source.play(),this._state=Hr,this._playWhenLoaded=!1,this._manager.on("volumechange",this._onManagerVolumeChange,this),this._manager.on("suspend",this._onManagerSuspend,this),this._manager.on("resume",this._onManagerResume,this),this._manager.on("destroy",this._onManagerDestroy,this),this._manager.suspended&&this._onManagerSuspend(),this._suspendInstanceEvents||this._onPlay(),!0)},pause:function(){return!this.source||this._state!==Hr?!1:(this._suspendEndEvent++,this.source.pause(),this._playWhenLoaded=!1,this._state=Yd,this._startOffset=null,this._suspendInstanceEvents||this._onPause(),!0)},resume:function(){return!this.source||this._state!==Yd?!1:(this._state=Hr,this._playWhenLoaded=!1,this.source.paused&&(this.source.play(),this._suspendInstanceEvents||this._onResume()),!0)},stop:function(){return!this.source||this._state===Ln?!1:(this._manager.off("volumechange",this._onManagerVolumeChange,this),this._manager.off("suspend",this._onManagerSuspend,this),this._manager.off("resume",this._onManagerResume,this),this._manager.off("destroy",this._onManagerDestroy,this),this._suspendEndEvent++,this.source.pause(),this._playWhenLoaded=!1,this._state=Ln,this._startOffset=null,this._suspendInstanceEvents||this._onStop(),!0)},setExternalNodes:function(){},clearExternalNodes:function(){},getExternalNodes:function(){return[null,null]},_onLoadedMetadata:function(){this.source.removeEventListener("loadedmetadata",this._loadedMetadataHandler),this._isReady=!0;let r=Xr(this._startOffset,this.duration);r=Xr(this._startTime+r,this._sound.duration),this._startOffset=null,this.source.currentTime=r},_createSource:function(){return this._sound&&this._sound.audio&&(this._isReady=!1,this.source=this._sound.audio.cloneNode(!0),this.source.addEventListener("loadedmetadata",this._loadedMetadataHandler),this.source.addEventListener("timeupdate",this._timeUpdateHandler),this.source.onended=this._endedHandler),this.source},_onTimeUpdate:function(){this._duration&&this.source.currentTime>Xr(this._startTime+this._duration,this.source.duration)&&(this.loop?this.source.currentTime=Xr(this._startTime,this.source.duration):(this.source.removeEventListener("timeupdate",this._timeUpdateHandler),this.source.pause(),this._onEnded()))},_onManagerDestroy:function(){this.source&&this.source.pause()}}),Object.defineProperty(Io.prototype,"volume",{get:function(){return this._volume},set:function(r){r=Q.clamp(r,0,1),this._volume=r,this.source&&(this.source.volume=r*this._manager.volume)}}),Object.defineProperty(Io.prototype,"pitch",{get:function(){return this._pitch},set:function(r){this._pitch=Math.max(Number(r)||0,.01),this.source&&(this.source.playbackRate=this._pitch)}}),Object.defineProperty(Io.prototype,"sound",{get:function(){return this._sound},set:function(r){this.stop(),this._sound=r}}),Object.defineProperty(Io.prototype,"currentTime",{get:function(){return this._startOffset!==null?this._startOffset:this._state===Ln||!this.source?0:this.source.currentTime-this._startTime},set:function(r){r<0||(this._startOffset=r,this.source&&this._isReady&&(this.source.currentTime=Xr(this._startTime+Xr(r,this.duration),this._sound.duration),this._startOffset=null))}}));const Upe=1e4;class Md extends Io{constructor(e,t,i={}){super(e,t,i),this._position=new O,this._velocity=new O,i.position&&(this.position=i.position),this.maxDistance=i.maxDistance!==void 0?Number(i.maxDistance):Upe,this.refDistance=i.refDistance!==void 0?Number(i.refDistance):1,this.rollOffFactor=i.rollOffFactor!==void 0?Number(i.rollOffFactor):1,this.distanceModel=i.distanceModel!==void 0?i.distanceModel:u3}_initializeNodes(){this.gain=this._manager.context.createGain(),this.panner=this._manager.context.createPanner(),this.panner.connect(this.gain),this._inputNode=this.panner,this._connectorNode=this.gain,this._connectorNode.connect(this._manager.context.destination)}set position(e){this._position.copy(e);const t=this.panner;"positionX"in t?(t.positionX.value=e.x,t.positionY.value=e.y,t.positionZ.value=e.z):t.setPosition&&t.setPosition(e.x,e.y,e.z)}get position(){return this._position}set velocity(e){this._velocity.copy(e)}get velocity(){return this._velocity}set maxDistance(e){this.panner.maxDistance=e}get maxDistance(){return this.panner.maxDistance}set refDistance(e){this.panner.refDistance=e}get refDistance(){return this.panner.refDistance}set rollOffFactor(e){this.panner.rolloffFactor=e}get rollOffFactor(){return this.panner.rolloffFactor}set distanceModel(e){this.panner.distanceModel=e}get distanceModel(){return this.panner.distanceModel}}if(!Ey()){let r=new O;const e=function(t,i,s,n,a,o){r=r.sub2(t,i);const l=r.length();if(l<s)return 1;if(l>n)return 0;let c=0;return o===u3?c=1-a*(l-s)/(n-s):o===Ope?c=s/(s+a*(l-s)):o===Npe&&(c=Math.pow(l/s,-a)),Q.clamp(c,0,1)};Object.defineProperty(Md.prototype,"position",{get:function(){return this._position},set:function(t){if(this._position.copy(t),this.source){const s=this._manager.listener.getPosition(),n=e(s,this._position,this.refDistance,this.maxDistance,this.rollOffFactor,this.distanceModel),a=this.volume;this.source.volume=a*n*this._manager.volume}}}),Object.defineProperty(Md.prototype,"maxDistance",{get:function(){return this._maxDistance},set:function(t){this._maxDistance=t}}),Object.defineProperty(Md.prototype,"refDistance",{get:function(){return this._refDistance},set:function(t){this._refDistance=t}}),Object.defineProperty(Md.prototype,"rollOffFactor",{get:function(){return this._rollOffFactor},set:function(t){this._rollOffFactor=t}}),Object.defineProperty(Md.prototype,"distanceModel",{get:function(){return this._distanceModel},set:function(t){this._distanceModel=t}})}const h3=0,d3=1,Ka=2,an=3,fh=4,f3=5,p3=6,m3=7,g3=8,_3=9,v3=10,a9={[h3]:"SUBTRACTIVE",[d3]:"ADDITIVE",[Ka]:"NORMAL",[an]:"NONE",[fh]:"PREMULTIPLIED",[f3]:"MULTIPLICATIVE",[p3]:"ADDITIVEALPHA",[m3]:"MULTIPLICATIVE2X",[g3]:"SCREEN",[_3]:"MIN",[v3]:"MAX"},um="none",zpe="linear",Vpe=0,y3=2,jpe={[Vpe]:"NONE",[y3]:"SCHLICK"},$pe=0,o9=15,nl=0,As=1,S3=2,x3=3,LE=4,Me=0,Pt=1,Rt=2,mU={[Me]:"DIRECTIONAL",[Pt]:"OMNI",[Rt]:"SPOT"},rx=100,Wn=0,l9=1,c9=2,u9=3,Hpe={[Wn]:"PUNCTUAL",[l9]:"RECT",[c9]:"DISK",[u9]:"SPHERE"},b3=0,h9=1,Gpe={[b3]:"LINEAR",[h9]:"INVERSESQUARED"},Un=0,TM=2,w3=3,Wpe=4,d9=5,iv=6,f9=7,p9=8,Xpe=9,Vo=new Map([[d9,{name:"PCF1_32F",kind:"PCF1",format:Bo,pcf:!0}],[Un,{name:"PCF3_32F",kind:"PCF3",format:Bo,pcf:!0}],[Wpe,{name:"PCF5_32F",kind:"PCF5",format:Bo,pcf:!0}],[f9,{name:"PCF1_16F",kind:"PCF1",format:Af,pcf:!0}],[p9,{name:"PCF3_16F",kind:"PCF3",format:Af,pcf:!0}],[Xpe,{name:"PCF5_16F",kind:"PCF5",format:Af,pcf:!0}],[TM,{name:"VSM_16F",kind:"VSM",format:wi,vsm:!0}],[w3,{name:"VSM_32F",kind:"VSM",format:or,vsm:!0}],[iv,{name:"PCSS_32F",kind:"PCSS",format:sl,pcss:!0}]]),T3=1,EM=0,m9=0,_a=0,qpe=1,gb=0,Ype=1,ba=0,Mf=1,qg=0,su=1,N0=2,E3=0,g9=1,Kpe={[E3]:"NONE",[g9]:"BOX"},gU="mul",Ay=0,sx=1,Zpe={[Ay]:"NONE",[sx]:"SRGB"},A3=0,_9=6,v9=["LINEAR","FILMIC","HEJL","ACES","ACES2","NEUTRAL","NONE"],y9=0,OE=1,S9=2,Qpe={[y9]:"NONE",[OE]:"AO",[S9]:"GLOSSDEPENDENT"},fc="none",_b="envAtlas",vb="envAtlasHQ",yb="cubeMap",x9="sphereMap",Jpe={[fc]:"NONE",[_b]:"ENVATLAS",[vb]:"ENVATLASHQ",[yb]:"CUBEMAP",[x9]:"SPHEREMAP"},C3="ambientSH",P3="envAtlas",I3="constant",eme={[C3]:"AMBIENTSH",[P3]:"ENVALATLAS",[I3]:"CONSTANT"},M3=1,NE=2,R3=4,b9=8,w9=16,kE=32,AM=64,T9=128,D3=256,L3=512,FE=1024,BE=2048,E9=4096,UE=8192,CM=16384,on=0,pc=1,O3=2,Zn=1,ph=2,Wu=4,Nh=0,zE=1,A9=2,VE=3,Ca=0,Li=1,Oi=2,tme={[Ca]:"SIMPLE",[Li]:"SLICED",[Oi]:"TILED"},nx=1,k0=0,ax=0,ime=1,rme=2,_U=3,sme=4,nme=5,N3=0,PM=1,Ue=0,xt=1,ox="infinite",ame="box",ome="dome",mh="none",lme="bayer8",cme="bluenoise",ume="ignnoise",hme={[mh]:"NONE",[lme]:"BAYER8",[cme]:"BLUENOISE",[ume]:"IGNNOISE"},dme="prerender",fme="postrender",pme="prerender:layer",mme="postrender:layer",C9="precull",P9="postcull",gme="cull:end";class jE{constructor(e,t,i){this.uniformFormats=[],this.bindGroupFormats=[],this.uniformFormats[tv]=e,this.bindGroupFormats[tv]=t,this.vertexFormat=i}hasUniform(e){for(let t=0;t<this.uniformFormats.length;t++){const i=this.uniformFormats[t];if(i!=null&&i.get(e))return!0}return!1}hasTexture(e){for(let t=0;t<this.bindGroupFormats.length;t++){const i=this.bindGroupFormats[t];if(i!=null&&i.getTexture(e))return!0}return!1}getVertexElement(e){var t;return(t=this.vertexFormat)==null?void 0:t.elements.find(i=>i.name===e)}generateKey(e){var i;let t=JSON.stringify(this.uniformFormats)+JSON.stringify(this.bindGroupFormats);return e.isWebGPU&&(t+=(i=this.vertexFormat)==null?void 0:i.shaderProcessingHashString),t}}const I9=new jr;function gp(r){return I9.get(r)}function _me(r,e){I9.get(r,()=>e)}class gh{static definesHash(e){const t=Array.from(e).sort((i,s)=>i[0]>s[0]?1:-1);return Ia(JSON.stringify(t))}}const vme=new jr;class yme{constructor(e,t,i={}){this.defines=new Map,this.name=e,this.index=t,Object.assign(this,i),this.buildShaderDefines()}buildShaderDefines(){let e;this.isShadow?e="SHADOW":this.isForward?e="FORWARD":this.index===VE&&(e="PICK"),this.defines.set(`${e}_PASS`,""),this.defines.set(`${this.name.toUpperCase()}_PASS`,"")}}class Va{constructor(){this.passesNamed=new Map,this.passesIndexed=[],this.nextIndex=0;const e=(t,i,s)=>{this.allocate(t,s)};e("forward",Nh,{isForward:!0}),e("prepass"),e("shadow"),e("pick")}static get(e){return vme.get(e,()=>new Va)}allocate(e,t){let i=this.passesNamed.get(e);return i===void 0&&(i=new yme(e,this.nextIndex,t),this.passesNamed.set(i.name,i),this.passesIndexed[i.index]=i,this.nextIndex++),i}getByIndex(e){return this.passesIndexed[e]}getByName(e){return this.passesNamed.get(e)}}class vU extends Map{set(e,t){return(!this.has(e)||this.get(e)!==t)&&this.markDirty(),super.set(e,t)}add(e){for(const[t,i]of Object.entries(e))this.set(t,i);return this}delete(e){const t=this.has(e),i=super.delete(e);return t&&i&&this.markDirty(),i}clear(){this.size>0&&this.markDirty(),super.clear()}markDirty(){this._dirty=!0,this._keyDirty=!0}isDirty(){return this._dirty}resetDirty(){this._dirty=!1}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=Array.from(this.entries()).sort(([e],[t])=>e<t?-1:e>t?1:0).map(([e,t])=>`${e}=${Ia(t)}`).join(",")),this._key}copy(e){this.clear();for(const[t,i]of e)this.set(t,i);return this}constructor(...e){super(...e),this._keyDirty=!1,this._key=""}}const Sme=new jr;class $e{static get(e,t=dt){const i=Sme.get(e,()=>new $e);return t===dt?i.glsl:i.wgsl}get useWGSL(){return this.glsl.size===0||this.wgsl.size>0}get key(){return`GLSL:${this.glsl.key}|WGSL:${this.wgsl.key}|API:${this.version}`}isDirty(){return this.glsl.isDirty()||this.wgsl.isDirty()}resetDirty(){this.glsl.resetDirty(),this.wgsl.resetDirty()}copy(e){return this.version=e.version,this.glsl.copy(e.glsl),this.wgsl.copy(e.wgsl),this}constructor(){this.glsl=new vU,this.wgsl=new vU,this.version=""}}class Sb{static merge(...e){const t=new Map(e[0]??[]);for(let i=1;i<e.length;i++){const s=e[i];if(s)for(const[n,a]of s)t.set(n,a)}return t}}class xme extends gh{constructor(e,t){super(),this.key=e,this.shaderDefinition=t}generateKey(e){return this.key}createShaderDefinition(e,t){return this.shaderDefinition}}class Tr{static createShader(e,t){const i=gp(e);let s=i.getCachedShader(t.uniqueName);if(!s){const n=e.isWebGPU&&(!!t.vertexWGSL||!!t.vertexChunk)&&(!!t.fragmentWGSL||!!t.fragmentChunk),a=$e.get(e,n?Gt:dt),o=t.vertexChunk?a.get(t.vertexChunk):n?t.vertexWGSL:t.vertexGLSL,l=t.fragmentChunk?a.get(t.fragmentChunk):n?t.fragmentWGSL:t.fragmentGLSL,c=Sb.merge(a,t.fragmentIncludes),u=Sb.merge(a,t.vertexIncludes);s=new s9(e,Wr.createDefinition(e,{name:t.uniqueName,shaderLanguage:n?Gt:dt,attributes:t.attributes,vertexCode:o,fragmentCode:l,useTransformFeedback:t.useTransformFeedback,vertexIncludes:u,vertexDefines:t.vertexDefines,fragmentIncludes:c,fragmentDefines:t.fragmentDefines,fragmentOutputTypes:t.fragmentOutputTypes})),i.setCachedShader(t.uniqueName,s)}return s}static getCoreDefines(e,t){const i=new Map(e.defines);return t.cameraShaderParams.defines.forEach((n,a)=>i.set(a,n)),Va.get(t.device).getByIndex(t.pass).defines.forEach((n,a)=>i.set(a,n)),i}static processShader(e,t){const i=e.definition,n=`${i.name??"shader"}-id-${e.id}`,a=new xme(n,i),o="shader",l=gp(e.device);l.register(o,a);const c=l.getProgram(o,{},t);return l.unregister(o),c}static addScreenDepthChunkDefines(e,t,i){t.sceneDepthMapLinear&&i.set("SCENE_DEPTHMAP_LINEAR",""),e.textureFloatRenderable&&i.set("SCENE_DEPTHMAP_FLOAT","")}}const bme={type:wc,base:0,baseVertex:0,count:4,indexed:!1},Gm=new ce,Wm=new ce,oC=new qq;class xb{constructor(e){const t=e.device;if(this.shader=e,t.supportsUniformBuffers){const i=new jE;this.shader=Tr.processShader(e,i);const s=this.shader.meshUniformBufferFormat;s&&(this.uniformBuffer=new c3(t,s,!1));const n=this.shader.meshBindGroupFormat;this.bindGroup=new o3(t,n)}}destroy(){var e,t;(e=this.uniformBuffer)==null||e.destroy(),this.uniformBuffer=null,(t=this.bindGroup)==null||t.destroy(),this.bindGroup=null}render(e,t){const i=this.shader.device;e&&(Gm.set(i.vx,i.vy,i.vw,i.vh),Wm.set(i.sx,i.sy,i.sw,i.sh),t=t??e,i.setViewport(e.x,e.y,e.z,e.w),i.setScissor(t.x,t.y,t.z,t.w)),i.setVertexBuffer(i.quadVertexBuffer,0);const s=this.shader;if(i.setShader(s),i.supportsUniformBuffers){i.setBindGroup(tv,i.emptyBindGroup);const n=this.bindGroup;n.update(),i.setBindGroup(Wq,n);const a=this.uniformBuffer;a?(a.update(oC),i.setBindGroup(yM,oC.bindGroup,oC.offsets)):i.setBindGroup(yM,i.emptyBindGroup)}i.draw(bme),e&&(i.setViewport(Gm.x,Gm.y,Gm.z,Gm.w),i.setScissor(Wm.x,Wm.y,Wm.z,Wm.w))}}class wme extends dn{constructor(e,t,i,s){super(e),this.quad=t,this.rect=i,this.scissorRect=s}execute(){const{device:e}=this;e.setCullMode(Vi),e.setDepthState(Ds.NODEPTH),e.setStencilState(null,null),this.quad.render(this.rect,this.scissorRect)}}const Tme=new ce;function Tc(r,e,t,i,s){const n=new xb(t);i||(i=Tme,i.x=0,i.y=0,i.z=e?e.width:r.width,i.w=e?e.height:r.height);const a=new wme(r,n,i,s);a.init(e),a.colorOps.clear=!1,a.depthStencilOps.clearDepth=!1,r.isWebGPU&&e===null&&r.samples>1&&(a.colorOps.store=!0),a.render(),n.destroy()}class yU{constructor(e,t,i){this._aabb=new We,this.meshInstance=null,this.origMeshInstances=e,this.dynamic=t,this.batchGroupId=i}destroy(e,t){this.meshInstance&&(this.removeFromLayers(e,t),this.meshInstance.destroy(),this.meshInstance=null)}addToLayers(e,t){for(let i=0;i<t.length;i++){const s=e.layers.getLayerById(t[i]);s&&s.addMeshInstances([this.meshInstance])}}removeFromLayers(e,t){for(let i=0;i<t.length;i++){const s=e.layers.getLayerById(t[i]);s&&s.removeMeshInstances([this.meshInstance])}}updateBoundingBox(){this._aabb.copy(this.origMeshInstances[0].aabb);for(let e=1;e<this.origMeshInstances.length;e++)this._aabb.add(this.origMeshInstances[e].aabb);this.meshInstance.aabb=this._aabb,this.meshInstance._aabbVer=0}get model(){}}const lf=class lf{constructor(e,t,i,s,n=[nl]){this._ui=!1,this._sprite=!1,this._obj={model:[],element:[],sprite:[],render:[]},this.id=e,this.name=t,this.dynamic=i,this.maxAabbSize=s,this.layers=n}};lf.MODEL="model",lf.ELEMENT="element",lf.SPRITE="sprite",lf.RENDER="render";let Bi=lf;const SU=new se;class Cy{constructor(e){this._dirty=!0,this._rootBone=null,this._skinUpdateIndex=-1,this._updateBeforeCull=!0,e&&this.initSkin(e)}set rootBone(e){this._rootBone=e}get rootBone(){return this._rootBone}init(e,t){const i=t*3;let s=Math.ceil(Math.sqrt(i));s=Q.roundUp(s,3);const n=Math.ceil(i/s);this.boneTexture=new we(e,{width:s,height:n,format:or,mipmaps:!1,minFilter:qe,magFilter:qe,name:"skin"}),this.matrixPalette=this.boneTexture.lock({mode:Dq}),this.boneTexture.unlock()}destroy(){this.boneTexture&&(this.boneTexture.destroy(),this.boneTexture=null)}resolve(e,t){this.rootBone=e;const i=this.skin,s=[];for(let n=0;n<i.boneNames.length;n++){const a=i.boneNames[n];let o=e.findByName(a);o||(o=t),s.push(o)}this.bones=s}initSkin(e){this.skin=e,this.bones=[];const t=e.inverseBindPose.length;this.init(e.device,t),this.matrices=[];for(let i=0;i<t;i++)this.matrices[i]=new se}uploadBones(e){this.boneTexture.upload()}_updateMatrices(e,t){if(this._skinUpdateIndex!==t){this._skinUpdateIndex=t,SU.copy(e.getWorldTransform()).invert();for(let i=this.bones.length-1;i>=0;i--)this.matrices[i].mulAffine2(SU,this.bones[i].getWorldTransform()),this.matrices[i].mulAffine2(this.matrices[i],this.skin.inverseBindPose[i])}}updateMatrices(e,t){this._updateBeforeCull&&this._updateMatrices(e,t)}updateMatrixPalette(e,t){this._updateMatrices(e,t);const i=this.matrixPalette,s=this.bones.length;for(let n=0;n<s;n++){const a=this.matrices[n].data,o=n*12;i[o]=a[0],i[o+1]=a[4],i[o+2]=a[8],i[o+3]=a[12],i[o+4]=a[1],i[o+5]=a[5],i[o+6]=a[9],i[o+7]=a[13],i[o+8]=a[2],i[o+9]=a[6],i[o+10]=a[10],i[o+11]=a[14]}this.uploadBones(this.skin.device)}}class xU extends Cy{constructor(e,t,i){super();const s=t.length;this.init(e,s),this.device=e,this.rootNode=i,this.bones=t}updateMatrices(e,t){}updateMatrixPalette(e,t){const i=this.matrixPalette,s=this.bones.length;for(let n=0;n<s;n++){const a=this.bones[n].getWorldTransform().data,o=n*12;i[o]=a[0],i[o+1]=a[4],i[o+2]=a[8],i[o+3]=a[12],i[o+4]=a[1],i[o+5]=a[5],i[o+6]=a[9],i[o+7]=a[13],i[o+8]=a[2],i[o+9]=a[6],i[o+10]=a[10],i[o+11]=a[14]}this.uploadBones(this.device)}}let Eme=0;const cf=class cf{constructor(){this.initDefaults()}initDefaults(){this.recreate=!1,this.verticesUsage=Kn,this.indicesUsage=Kn,this.maxVertices=0,this.maxIndices=0,this.vertexCount=0,this.indexCount=0,this.vertexStreamsUpdated=!1,this.indexStreamUpdated=!1,this.vertexStreamDictionary={},this.indices=null}_changeVertexCount(e,t){this.vertexCount||(this.vertexCount=e)}};cf.DEFAULT_COMPONENTS_POSITION=3,cf.DEFAULT_COMPONENTS_NORMAL=3,cf.DEFAULT_COMPONENTS_UV=2,cf.DEFAULT_COMPONENTS_COLORS=4;let Il=cf;class Ame{constructor(e,t,i,s,n){this.data=e,this.componentCount=t,this.dataType=i,this.dataTypeNormalize=s,this.asInt=n}}class It extends DE{constructor(e,t){super(),this.indexBuffer=[null],this.vertexBuffer=null,this.primitive=[{type:0,base:0,baseVertex:0,count:0}],this.skin=null,this.boneAabb=null,this._aabbVer=0,this._aabb=new We,this._geometryData=null,this._morph=null,this._storageIndex=!1,this._storageVertex=!1,this.id=Eme++,this.device=e,this._storageIndex=(t==null?void 0:t.storageIndex)||!1,this._storageVertex=(t==null?void 0:t.storageVertex)||!1}static fromGeometry(e,t,i={}){const s=new It(e,i),{positions:n,normals:a,tangents:o,colors:l,uvs:c,uvs1:u,blendIndices:h,blendWeights:d,indices:f}=t;return n&&s.setPositions(n),a&&s.setNormals(a),o&&s.setVertexStream(Xa,o,4),l&&s.setColors32(l),c&&s.setUvs(0,c),u&&s.setUvs(1,u),h&&s.setVertexStream(Es,h,4,h.length/4,Vu),d&&s.setVertexStream(za,d,4),f&&s.setIndices(f),s.update(),s}set morph(e){e!==this._morph&&(this._morph&&this._morph.decRefCount(),this._morph=e,e&&e.incRefCount())}get morph(){return this._morph}set aabb(e){this._aabb=e,this._aabbVer++}get aabb(){return this._aabb}destroy(){const e=this.morph;e&&(this.morph=null,e.refCount<1&&e.destroy()),this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBuffer=null);for(let t=0;t<this.indexBuffer.length;t++)this._destroyIndexBuffer(t);this.indexBuffer.length=0,this._geometryData=null}_destroyIndexBuffer(e){this.indexBuffer[e]&&(this.indexBuffer[e].destroy(),this.indexBuffer[e]=null)}_initBoneAabbs(e){this.boneAabb=[],this.boneUsed=[];let t,i,s,n,a;const o=[],l=[],c=this.boneUsed,u=this.skin.boneNames.length;let h,d,f;for(let x=0;x<u;x++)o[x]=new O(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),l[x]=new O(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);const p=new Xg(this.vertexBuffer),m=p.element[Xe],g=p.element[za],_=p.element[Es],v=this.vertexBuffer.numVertices;for(let x=0;x<v;x++){for(let S=0;S<4;S++)if(g.array[g.index+S]>0){const T=_.array[_.index+S];if(c[T]=!0,t=m.array[m.index],i=m.array[m.index+1],s=m.array[m.index+2],n=l[T],a=o[T],a.x>t&&(a.x=t),a.y>i&&(a.y=i),a.z>s&&(a.z=s),n.x<t&&(n.x=t),n.y<i&&(n.y=i),n.z<s&&(n.z=s),e){let A=h=t,C=d=i,P=f=s;for(let I=0;I<e.length;I++){const M=e[I],N=M.deltaPositions[x*3],k=M.deltaPositions[x*3+1],V=M.deltaPositions[x*3+2];N<0?A+=N:h+=N,k<0?C+=k:d+=k,V<0?P+=V:f+=V}a.x>A&&(a.x=A),a.y>C&&(a.y=C),a.z>P&&(a.z=P),n.x<h&&(n.x=h),n.y<d&&(n.y=d),n.z<f&&(n.z=f)}}p.next()}const y=this.vertexBuffer.getFormat().elements.find(x=>x.name===Xe);if(y&&y.normalize){const x=(()=>{switch(y.dataType){case yE:return S=>Math.max(S/127,-1);case Vu:return S=>S/255;case SE:return S=>Math.max(S/32767,-1);case wy:return S=>S/65535;default:return S=>S}})();for(let S=0;S<u;S++)if(c[S]){const w=o[S],T=l[S];w.set(x(w.x),x(w.y),x(w.z)),T.set(x(T.x),x(T.y),x(T.z))}}for(let x=0;x<u;x++){const S=new We;S.setMinMax(o[x],l[x]),this.boneAabb.push(S)}}_initGeometryData(){this._geometryData||(this._geometryData=new Il,this.vertexBuffer&&(this._geometryData.vertexCount=this.vertexBuffer.numVertices,this._geometryData.maxVertices=this.vertexBuffer.numVertices),this.indexBuffer.length>0&&this.indexBuffer[0]&&(this._geometryData.indexCount=this.indexBuffer[0].numIndices,this._geometryData.maxIndices=this.indexBuffer[0].numIndices))}clear(e,t,i=0,s=0){this._initGeometryData(),this._geometryData.initDefaults(),this._geometryData.recreate=!0,this._geometryData.maxVertices=i,this._geometryData.maxIndices=s,this._geometryData.verticesUsage=e?Kn:nb,this._geometryData.indicesUsage=t?Kn:nb}setVertexStream(e,t,i,s,n=bt,a=!1,o=!1){this._initGeometryData();const l=s||t.length/i;this._geometryData._changeVertexCount(l,e),this._geometryData.vertexStreamsUpdated=!0,this._geometryData.vertexStreamDictionary[e]=new Ame(t,i,n,a,o)}getVertexStream(e,t){let i=0,s=!1;if(this._geometryData){const n=this._geometryData.vertexStreamDictionary[e];n&&(s=!0,i=this._geometryData.vertexCount,ArrayBuffer.isView(t)?t.set(n.data):(t.length=0,t.push(n.data)))}return s||this.vertexBuffer&&(i=new Xg(this.vertexBuffer).readData(e,t)),i}setPositions(e,t=Il.DEFAULT_COMPONENTS_POSITION,i){this.setVertexStream(Xe,e,t,i,bt,!1)}setNormals(e,t=Il.DEFAULT_COMPONENTS_NORMAL,i){this.setVertexStream(Rs,e,t,i,bt,!1)}setUvs(e,t,i=Il.DEFAULT_COMPONENTS_UV,s){this.setVertexStream(jB+e,t,i,s,bt,!1)}setColors(e,t=Il.DEFAULT_COMPONENTS_COLORS,i){this.setVertexStream(wr,e,t,i,bt,!1)}setColors32(e,t){this.setVertexStream(wr,e,Il.DEFAULT_COMPONENTS_COLORS,t,Vu,!0)}setIndices(e,t){this._initGeometryData(),this._geometryData.indexStreamUpdated=!0,this._geometryData.indices=e,this._geometryData.indexCount=t||e.length}getPositions(e){return this.getVertexStream(Xe,e)}getNormals(e){return this.getVertexStream(Rs,e)}getUvs(e,t){return this.getVertexStream(jB+e,t)}getColors(e){return this.getVertexStream(wr,e)}getIndices(e){let t=0;if(this._geometryData&&this._geometryData.indices){const i=this._geometryData.indices;if(t=this._geometryData.indexCount,ArrayBuffer.isView(e))e.set(i);else{e.length=0;for(let s=0,n=i.length;s<n;s++)e.push(i[s])}}else this.indexBuffer.length>0&&this.indexBuffer[0]&&(t=this.indexBuffer[0].readData(e));return t}update(e=Uo,t=!0){if(this._geometryData){if(t){const n=this._geometryData.vertexStreamDictionary[Xe];n&&n.componentCount===3&&(this._aabb.compute(n.data,this._geometryData.vertexCount),this._aabbVer++)}let i=this._geometryData.recreate;this._geometryData.vertexCount>this._geometryData.maxVertices&&(i=!0,this._geometryData.maxVertices=this._geometryData.vertexCount),i&&this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBuffer=null);let s=this._geometryData.recreate;this._geometryData.indexCount>this._geometryData.maxIndices&&(s=!0,this._geometryData.maxIndices=this._geometryData.indexCount),s&&this.indexBuffer.length>0&&this.indexBuffer[0]&&(this.indexBuffer[0].destroy(),this.indexBuffer[0]=null),this._geometryData.vertexStreamsUpdated&&this._updateVertexBuffer(),this._geometryData.indexStreamUpdated&&this._updateIndexBuffer(),this.primitive[0].type=e,this.indexBuffer.length>0&&this.indexBuffer[0]?this._geometryData.indexStreamUpdated&&(this.primitive[0].count=this._geometryData.indexCount,this.primitive[0].indexed=!0):this._geometryData.vertexStreamsUpdated&&(this.primitive[0].count=this._geometryData.vertexCount,this.primitive[0].indexed=!1),this._geometryData.vertexCount=0,this._geometryData.indexCount=0,this._geometryData.vertexStreamsUpdated=!1,this._geometryData.indexStreamUpdated=!1,this._geometryData.recreate=!1,this.updateRenderStates()}}_buildVertexFormat(e){const t=[];for(const i in this._geometryData.vertexStreamDictionary){const s=this._geometryData.vertexStreamDictionary[i];t.push({semantic:i,components:s.componentCount,type:s.dataType,normalize:s.dataTypeNormalize,asInt:s.asInt})}return new Ls(this.device,t,e)}_updateVertexBuffer(){if(!this.vertexBuffer){const i=this._geometryData.maxVertices,s=this._buildVertexFormat(i);this.vertexBuffer=new Ya(this.device,s,i,{usage:this._geometryData.verticesUsage,storage:this._storageVertex})}const e=new Xg(this.vertexBuffer),t=this._geometryData.vertexCount;for(const i in this._geometryData.vertexStreamDictionary){const s=this._geometryData.vertexStreamDictionary[i];e.writeData(i,s.data,t),delete this._geometryData.vertexStreamDictionary[i]}e.end()}_updateIndexBuffer(){if(this.indexBuffer.length<=0||!this.indexBuffer[0]){const t=this._geometryData.maxVertices,i=t>65535||t===0?bc:xc,s=this._storageIndex?{storage:!0}:void 0;this.indexBuffer[0]=new dh(this.device,i,this._geometryData.maxIndices,this._geometryData.indicesUsage,void 0,s)}const e=this._geometryData.indices;e&&(this.indexBuffer[0].writeData(e,this._geometryData.indexCount),this._geometryData.indices=null)}prepareRenderState(e){e===su?this.generateWireframe():e===N0&&(this.primitive[N0]={type:_E,base:0,baseVertex:0,count:this.vertexBuffer?this.vertexBuffer.numVertices:0,indexed:!1})}updateRenderStates(){this.primitive[N0]&&this.prepareRenderState(N0),this.primitive[su]&&this.prepareRenderState(su)}generateWireframe(){this._destroyIndexBuffer(su);const e=this.vertexBuffer.numVertices,t=[];let i;if(this.indexBuffer.length>0&&this.indexBuffer[0]){const a=[[0,1],[1,2],[2,0]],o=this.primitive[qg].base,l=this.primitive[qg].count,c=this.indexBuffer[qg],u=new fb[c.format](c.storage),h=new Set;for(let d=o;d<o+l;d+=3)for(let f=0;f<3;f++){const p=u[d+a[f][0]],m=u[d+a[f][1]],g=p>m?m*e+p:p*e+m;h.has(g)||(h.add(g),t.push(p,m))}i=c.format}else{for(let a=0;a<e;a+=3)t.push(a,a+1,a+1,a+2,a+2,a);i=t.length>65535?bc:xc}const s=new dh(this.vertexBuffer.device,i,t.length);new fb[s.format](s.storage).set(t),s.unlock(),this.primitive[su]={type:vE,base:0,baseVertex:0,count:t.length,indexed:!0},this.indexBuffer[su]=s}}const M9=new jr;function Py(r){return M9.get(r)}function Cme(r,e){M9.get(r,()=>e)}class Pme{destroy(){this.cache.forEach((e,t)=>{t.destroy()}),this.cache.clear()}incRef(e){const t=(this.cache.get(e)||0)+1;this.cache.set(e,t)}decRef(e){if(e){let t=this.cache.get(e);t&&(t--,t===0?(this.cache.delete(e),e.destroy()):this.cache.set(e,t))}}constructor(){this.cache=new Map}}const _k=class _k{static incRef(e){this.cache.incRef(e)}static decRef(e){this.cache.decRef(e)}static destroy(){this.cache.destroy()}};_k.cache=new Pme;let wa=_k,Ime=0;const Mme=new We,F0=new We,lC=new AO,cC=new Set,Qh=new Uint32Array(4);class Rme{constructor(e){this.vertexBuffer=null,this._destroyVertexBuffer=!1,this.count=e}destroy(){var e;this._destroyVertexBuffer&&((e=this.vertexBuffer)==null||e.destroy()),this.vertexBuffer=null}}class Dme{get(e){return this.map.get(e)??this.map.get(null)}constructor(){this.map=new Map,this.meshMetaData=new Int32Array(4)}}class Lme{getBindGroup(e){if(!this.bindGroup){const i=this.shader.meshBindGroupFormat;this.bindGroup=new o3(e,i)}return this.bindGroup}getUniformBuffer(e){if(!this.uniformBuffer){const i=this.shader.meshUniformBufferFormat;this.uniformBuffer=new c3(e,i,!1)}return this.uniformBuffer}destroy(){var e,t;(e=this.bindGroup)==null||e.destroy(),this.bindGroup=null,(t=this.uniformBuffer)==null||t.destroy(),this.uniformBuffer=null}constructor(){this.bindGroup=null,this.uniformBuffer=null}}const gu=class gu{constructor(e,t,i=null){if(this.castShadow=!1,this.cull=!0,this.drawOrder=0,this._drawBucket=127,this.visible=!0,this.visibleThisFrame=!1,this.flipFacesFactor=1,this.gsplatInstance=null,this.id=Ime++,this.isVisibleFunc=null,this.instancingData=null,this.indirectData=null,this.parameters={},this.pick=!0,this.stencilFront=null,this.stencilBack=null,this.transparent=!1,this._aabb=new We,this._aabbVer=-1,this._aabbMeshVer=-1,this._customAabb=null,this._updateAabb=!0,this._updateAabbFunc=null,this._sortKeyShadow=0,this._sortKeyForward=0,this._sortKeyDynamic=0,this._layer=o9,this._material=null,this._skinInstance=null,this._morphInstance=null,this._receiveShadow=!0,this._renderStyle=qg,this._screenSpace=!1,this._shaderCache=new Map,this._shaderDefs=Zn<<16,this._calculateSortDistance=null,this.node=i,this._mesh=e,e.incRefCount(),this.material=t,e.vertexBuffer){const s=e.vertexBuffer.format;this._shaderDefs|=s.hasUv0?R3:0,this._shaderDefs|=s.hasUv1?b9:0,this._shaderDefs|=s.hasColor?w9:0,this._shaderDefs|=s.hasTangents?L3:0}this.updateKey()}set drawBucket(e){this._drawBucket=Math.floor(e)&255,this.updateKey()}get drawBucket(){return this._drawBucket}set renderStyle(e){this._renderStyle=e,this.mesh.prepareRenderState(e)}get renderStyle(){return this._renderStyle}set mesh(e){e!==this._mesh&&(this._mesh&&this._mesh.decRefCount(),this._mesh=e,e&&e.incRefCount())}get mesh(){return this._mesh}set aabb(e){this._aabb=e}get aabb(){if(!this._updateAabb)return this._aabb;if(this._updateAabbFunc)return this._updateAabbFunc(this._aabb);let e=this._customAabb,t=!!e;if(!e){if(e=Mme,this.skinInstance){if(!this.mesh.boneAabb){const n=this._morphInstance?this._morphInstance.morph._targets:null;this.mesh._initBoneAabbs(n)}const i=this.mesh.boneUsed;let s=!0;for(let n=0;n<this.mesh.boneAabb.length;n++)i[n]&&(F0.setFromTransformedAabb(this.mesh.boneAabb[n],this.skinInstance.matrices[n]),s?(s=!1,e.center.copy(F0.center),e.halfExtents.copy(F0.halfExtents)):e.add(F0));t=!0}else if(this.node._aabbVer!==this._aabbVer||this.mesh._aabbVer!==this._aabbMeshVer){if(this.mesh?(e.center.copy(this.mesh.aabb.center),e.halfExtents.copy(this.mesh.aabb.halfExtents)):(e.center.set(0,0,0),e.halfExtents.set(0,0,0)),this.mesh&&this.mesh.morph){const i=this.mesh.morph.aabb;e._expand(i.getMin(),i.getMax())}t=!0,this._aabbVer=this.node._aabbVer,this._aabbMeshVer=this.mesh._aabbVer}}return t&&this._aabb.setFromTransformedAabb(e,this.node.getWorldTransform()),this._aabb}clearShaders(){this._shaderCache.forEach(e=>{e.destroy()}),this._shaderCache.clear()}getShaderInstance(e,t,i,s,n,a,o){var h;const l=this._shaderDefs;Qh[0]=e,Qh[1]=t,Qh[2]=l,Qh[3]=s.hash;const c=Kq(Qh);let u=this._shaderCache.get(c);if(!u){const d=this._material;if(u=new Lme,u.shader=d.variants.get(c),u.hashes=new Uint32Array(Qh),!u.shader){const f=d.getShaderVariant({device:this.mesh.device,scene:i,objDefs:l,cameraShaderParams:s,pass:e,sortedLights:o,viewUniformFormat:n,viewBindGroupFormat:a,vertexFormat:(h=this.mesh.vertexBuffer)==null?void 0:h.format});d.variants.set(c,f),u.shader=f}this._shaderCache.set(c,u)}return u}set material(e){this.clearShaders();const t=this._material;t&&t.removeMeshInstanceRef(this),this._material=e,e&&(e.addMeshInstanceRef(this),this.transparent=e.transparent,this.updateKey())}get material(){return this._material}_updateShaderDefs(e){e!==this._shaderDefs&&(this._shaderDefs=e,this.clearShaders())}set calculateSortDistance(e){this._calculateSortDistance=e}get calculateSortDistance(){return this._calculateSortDistance}set receiveShadow(e){this._receiveShadow!==e&&(this._receiveShadow=e,this._updateShaderDefs(e?this._shaderDefs&-2:this._shaderDefs|M3))}get receiveShadow(){return this._receiveShadow}set batching(e){this._updateShaderDefs(e?this._shaderDefs|CM:this._shaderDefs&-16385)}get batching(){return(this._shaderDefs&CM)!==0}set skinInstance(e){this._skinInstance=e,this._updateShaderDefs(e?this._shaderDefs|NE:this._shaderDefs&-3),this._setupSkinUpdate()}get skinInstance(){return this._skinInstance}set morphInstance(e){var i;(i=this._morphInstance)==null||i.destroy(),this._morphInstance=e;let t=this._shaderDefs;t=e&&e.morph.morphPositions?t|FE:t&-1025,t=e&&e.morph.morphNormals?t|BE:t&-2049,t=e&&e.morph.intRenderFormat?t|UE:t&-8193,this._updateShaderDefs(t)}get morphInstance(){return this._morphInstance}set screenSpace(e){this._screenSpace!==e&&(this._screenSpace=e,this._updateShaderDefs(e?this._shaderDefs|D3:this._shaderDefs&-257))}get screenSpace(){return this._screenSpace}set key(e){this._sortKeyForward=e}get key(){return this._sortKeyForward}set mask(e){const t=this._shaderDefs&65535;this._updateShaderDefs(t|e<<16)}get mask(){return this._shaderDefs>>16}set instancingCount(e){this.instancingData&&(this.instancingData.count=e)}get instancingCount(){return this.instancingData?this.instancingData.count:0}destroy(){var t,i,s;const e=this.mesh;e&&(this.mesh=null,e.refCount<1&&e.destroy()),this.setRealtimeLightmap(gu.lightmapParamNames[0],null),this.setRealtimeLightmap(gu.lightmapParamNames[1],null),(t=this._skinInstance)==null||t.destroy(),this._skinInstance=null,(i=this.morphInstance)==null||i.destroy(),this.morphInstance=null,this.clearShaders(),this.material=null,(s=this.instancingData)==null||s.destroy()}static _prepareRenderStyleForArray(e,t){if(e){for(let i=0;i<e.length;i++){e[i]._renderStyle=t;const s=e[i].mesh;cC.has(s)||(cC.add(s),s.prepareRenderState(t))}cC.clear()}}_isVisible(e){return this.visible?this.isVisibleFunc?this.isVisibleFunc(e):(lC.center=this.aabb.center,lC.radius=this._aabb.halfExtents.length(),e.frustum.containsSphere(lC)>0):!1}updateKey(){const{material:e}=this;this._sortKeyForward=this._drawBucket<<25|(e.alphaToCoverage||e.alphaTest?16777216:0)|e.id&16777215}setInstancing(e,t=!1){e?(this.instancingData=new Rme(e.numVertices),this.instancingData.vertexBuffer=e,e.format.instancing=!0,this.cull=t):(this.instancingData=null,this.cull=!0),this._updateShaderDefs(e?this._shaderDefs|kE:this._shaderDefs&-33)}setIndirect(e,t){this._allocIndirectData(),this.indirectData.map.set((e==null?void 0:e.camera)??null,t),this.mesh.device.mapsToClear.add(this.indirectData.map)}getIndirectMetaData(){var i;this._allocIndirectData();const e=(i=this.mesh)==null?void 0:i.primitive[this.renderStyle],t=this.indirectData.meshMetaData;return t[0]=e.count,t[1]=e.base,t[2]=e.baseVertex,t}_allocIndirectData(){this.indirectData||(this.indirectData=new Dme)}ensureMaterial(e){this.material||(this.material=Py(e))}clearParameters(){this.parameters={}}getParameters(){return this.parameters}getParameter(e){return this.parameters[e]}setParameter(e,t,i=4294967295){const s=this.parameters[e];s?(s.data=t,s.passFlags=i):this.parameters[e]={scopeId:null,data:t,passFlags:i}}setRealtimeLightmap(e,t){const i=this.getParameter(e);i!==t&&(i&&wa.decRef(i.data),t?(wa.incRef(t),this.setParameter(e,t)):this.deleteParameter(e))}deleteParameter(e){this.parameters[e]&&delete this.parameters[e]}setParameters(e,t){const i=this.parameters;for(const s in i){const n=i[s];n.passFlags&t&&(n.scopeId||(n.scopeId=e.scope.resolve(s)),n.scopeId.setValue(n.data))}}setLightmapped(e){e?this.mask=(this.mask|ph)&-6:(this.setRealtimeLightmap(gu.lightmapParamNames[0],null),this.setRealtimeLightmap(gu.lightmapParamNames[1],null),this._shaderDefs&=-4289,this.mask=(this.mask|Zn)&-7)}setCustomAabb(e){e?this._customAabb?this._customAabb.copy(e):this._customAabb=e.clone():(this._customAabb=null,this._aabbVer=-1),this._setupSkinUpdate()}_setupSkinUpdate(){this._skinInstance&&(this._skinInstance._updateBeforeCull=!this._customAabb)}};gu.lightmapParamNames=["texture_lightMap","texture_dirLightMap"];let Dt=gu;const Ome=[0,1,3,2,3,1],Nme=[0,1,3,0,3,2],bU=new Ba;function wU(r,e){if(r&&!e||!r&&e)return!1;if(r=r.data,e=e.data,r===e)return!0;if(r instanceof Float32Array&&e instanceof Float32Array){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}return!1}function kme(r,e){for(const t in r)if(r.hasOwnProperty(t)&&!wU(r[t],e[t]))return!1;for(const t in e)if(e.hasOwnProperty(t)&&!wU(e[t],r[t]))return!1;return!0}function uC(r){return r.node.worldTransform.scaleSign}class Fme{constructor(e,t,i){this.device=e,this.rootNode=t,this.scene=i,this._init=!1,this._batchGroups={},this._batchGroupCounter=0,this._batchList=[],this._dirtyGroups=[]}destroy(){this.device=null,this.rootNode=null,this.scene=null,this._batchGroups={},this._batchList=[],this._dirtyGroups=[]}addGroup(e,t,i,s,n){if(s===void 0&&(s=this._batchGroupCounter,this._batchGroupCounter++),this._batchGroups[s])return;const a=new Bi(s,e,t,i,n);return this._batchGroups[s]=a,a}removeGroup(e){if(!this._batchGroups[e])return;const t=[];for(let i=0;i<this._batchList.length;i++)this._batchList[i].batchGroupId===e?this.destroyBatch(this._batchList[i]):t.push(this._batchList[i]);this._batchList=t,this._removeModelsFromBatchGroup(this.rootNode,e),delete this._batchGroups[e]}markGroupDirty(e){this._dirtyGroups.indexOf(e)<0&&this._dirtyGroups.push(e)}getGroupByName(e){const t=this._batchGroups;for(const i in t)if(t.hasOwnProperty(i)&&t[i].name===e)return t[i];return null}getBatches(e){const t=[],i=this._batchList.length;for(let s=0;s<i;s++){const n=this._batchList[s];n.batchGroupId===e&&t.push(n)}return t}_removeModelsFromBatchGroup(e,t){if(e.enabled){e.model&&e.model.batchGroupId===t&&(e.model.batchGroupId=-1),e.render&&e.render.batchGroupId===t&&(e.render.batchGroupId=-1),e.element&&e.element.batchGroupId===t&&(e.element.batchGroupId=-1),e.sprite&&e.sprite.batchGroupId===t&&(e.sprite.batchGroupId=-1);for(let i=0;i<e._children.length;i++)this._removeModelsFromBatchGroup(e._children[i],t)}}insert(e,t,i){const s=this._batchGroups[t];s&&s._obj[e].indexOf(i)<0&&(s._obj[e].push(i),this.markGroupDirty(t))}remove(e,t,i){const s=this._batchGroups[t];if(s){const n=s._obj[e].indexOf(i);n>=0&&(s._obj[e].splice(n,1),this.markGroupDirty(t))}}_extractRender(e,t,i,s){return e.render&&(t=s[e.render.batchGroupId]=t.concat(e.render.meshInstances),e.render.removeFromLayers()),t}_extractModel(e,t,i,s){return e.model&&e.model.model&&(t=s[e.model.batchGroupId]=t.concat(e.model.meshInstances),e.model.removeModelFromLayers()),t}_extractElement(e,t,i){if(!e.element)return;let s=!1;e.element._text&&e.element._text._model.meshInstances.length>0?(t.push(e.element._text._model.meshInstances[0]),e.element.removeModelFromLayers(e.element._text._model),s=!0):e.element._image&&(t.push(e.element._image._renderable.meshInstance),e.element.removeModelFromLayers(e.element._image._renderable.model),e.element._image._renderable.unmaskMeshInstance&&(t.push(e.element._image._renderable.unmaskMeshInstance),(!e.element._image._renderable.unmaskMeshInstance.stencilFront||!e.element._image._renderable.unmaskMeshInstance.stencilBack)&&(e.element._dirtifyMask(),e.element._onPrerender())),s=!0),s&&(i._ui=!0)}_collectAndRemoveMeshInstances(e,t){for(let i=0;i<t.length;i++){const s=t[i],n=this._batchGroups[s];if(!n)continue;let a=e[s];a||(a=e[s]=[]);for(let o=0;o<n._obj.model.length;o++)a=this._extractModel(n._obj.model[o],a,n,e);for(let o=0;o<n._obj.render.length;o++)a=this._extractRender(n._obj.render[o],a,n,e);for(let o=0;o<n._obj.element.length;o++)this._extractElement(n._obj.element[o],a,n);for(let o=0;o<n._obj.sprite.length;o++){const l=n._obj.sprite[o];l.sprite&&l.sprite._meshInstance&&(n.dynamic||l.sprite.sprite._renderMode===Ca)&&(a.push(l.sprite._meshInstance),l.sprite.removeModelFromLayers(),n._sprite=!0,l.sprite._batchGroup=n)}}}generate(e){const t={};e||(e=Object.keys(this._batchGroups));const i=[];for(let l=0;l<this._batchList.length;l++){if(e.indexOf(this._batchList[l].batchGroupId)<0){i.push(this._batchList[l]);continue}this.destroyBatch(this._batchList[l])}if(this._batchList=i,this._collectAndRemoveMeshInstances(t,e),e===this._dirtyGroups)this._dirtyGroups.length=0;else{const l=[];for(let c=0;c<this._dirtyGroups.length;c++)e.indexOf(this._dirtyGroups[c])<0&&l.push(this._dirtyGroups[c]);this._dirtyGroups=l}let s,n,a,o;for(const l in t)if(t.hasOwnProperty(l)&&(s=t[l],a=this._batchGroups[l],!!a)){n=this.prepare(s,a.dynamic,a.maxAabbSize,a._ui||a._sprite);for(let c=0;c<n.length;c++)o=this.create(n[c],a.dynamic,parseInt(l,10)),o&&o.addToLayers(this.scene,a.layers)}}prepare(e,t,i=Number.POSITIVE_INFINITY,s){if(e.length===0)return[];const n=i*.5,a=1024,o=4294967295,l=new We,c=new We;let u=null,h;const d=[];let f=0;s&&e.sort((_,v)=>_.drawOrder-v.drawOrder);let p=e,m;const g=s?function(_){u?u.add(_.aabb):u=_.aabb.clone(),m.push(_)}:function(_){m.push(_)};for(;p.length>0;){d[f]=[p[0]],m=[];const _=p[0].material,v=p[0].layer,y=p[0]._shaderDefs,x=p[0].parameters,S=p[0].stencilFront;let w=p[0].mesh.vertexBuffer.getNumVertices();const T=p[0].drawOrder;l.copy(p[0].aabb);const A=uC(p[0]),C=p[0].mesh.vertexBuffer.format.batchingHash,P=p[0].mesh.primitive[0].indexed;u=null;for(let I=1;I<p.length;I++){const M=p[I];if(t&&d[f].length>=a){m=m.concat(p.slice(I));break}if(_!==M.material||v!==M.layer||C!==M.mesh.vertexBuffer.format.batchingHash||P!==M.mesh.primitive[0].indexed||y!==M._shaderDefs||w+M.mesh.vertexBuffer.getNumVertices()>o){g(M);continue}if(c.copy(l),c.add(M.aabb),c.halfExtents.x>n||c.halfExtents.y>n||c.halfExtents.z>n){g(M);continue}if(S&&(!(h=M.stencilFront)||S.func!==h.func||S.zpass!==h.zpass)){g(M);continue}if(A!==uC(M)){g(M);continue}if(!kme(x,M.parameters)){g(M);continue}if(s&&u&&u.intersects(M.aabb)&&M.drawOrder!==T){g(M);continue}l.add(M.aabb),w+=M.mesh.vertexBuffer.getNumVertices(),d[f].push(M)}f++,p=m}return d}collectBatchedMeshData(e,t){let i=null,s=0,n=0,a=null;for(let o=0;o<e.length;o++)if(e[o].visible){const l=e[o].mesh,c=l.vertexBuffer.numVertices;if(s+=c,l.primitive[0].indexed)n+=l.primitive[0].count;else{const u=l.primitive[0].type;(u===zu||u===wc)&&l.primitive[0].count===4&&(n+=6)}if(!i){a=e[o].material,i={};const u=l.vertexBuffer.format.elements;for(let h=0;h<u.length;h++){const d=u[h].name;i[d]={numComponents:u[h].numComponents,dataType:u[h].dataType,normalize:u[h].normalize,count:0}}t&&(i[Es]={numComponents:1,dataType:bt,normalize:!1,count:0})}}return{streams:i,batchNumVerts:s,batchNumIndices:n,material:a}}create(e,t,i){this._init||(this.vertexFormats={},this._init=!0);let s=null,n,a,o,l=null;const c=this.collectBatchedMeshData(e,t);if(c.streams){const u=c.streams;let h=c.material;const d=c.batchNumVerts,f=c.batchNumIndices;l=new yU(e,t,i),this._batchList.push(l);let p,m,g,_,v=0,y=0,x;const S=d<=65535?Uint16Array:Uint32Array,w=new S(f);for(n in u)s=u[n],s.typeArrayType=If[s.dataType],s.elementByteSize=Wg[s.dataType],s.buffer=new s.typeArrayType(d*s.numComponents);for(let C=0;C<e.length;C++)if(e[C].visible){a=e[C].mesh,o=a.vertexBuffer.numVertices,t||(x=e[C].node.getWorldTransform());for(n in u)if(n!==Es){s=u[n];const P=new s.typeArrayType(s.buffer.buffer,s.elementByteSize*s.count),I=a.getVertexStream(n,P)*s.numComponents;if(s.count+=I,!t&&s.numComponents>=3){if(n===Xe){const M=x.data,N=M[0],k=M[1],V=M[2],B=M[4],R=M[5],L=M[6],D=M[8],F=M[9],j=M[10],z=M[12],$=M[13],H=M[14];let G,Y,W;for(let ie=0;ie<I;ie+=s.numComponents)G=P[ie],Y=P[ie+1],W=P[ie+2],P[ie]=G*N+Y*B+W*D+z,P[ie+1]=G*k+Y*R+W*F+$,P[ie+2]=G*V+Y*L+W*j+H}else if(n===Rs||n===Xa){bU.invertMat4(x).transpose();const[M,N,k,V,B,R,L,D,F]=bU.data;let j,z,$;for(let H=0;H<I;H+=s.numComponents)j=P[H],z=P[H+1],$=P[H+2],P[H]=j*M+z*V+$*L,P[H+1]=j*N+z*B+$*D,P[H+2]=j*k+z*R+$*F}}}if(t){s=u[Es];for(let P=0;P<o;P++)s.buffer[s.count++]=C}if(a.primitive[0].indexed){p=a.primitive[0].base,m=a.primitive[0].baseVertex||0,g=a.primitive[0].count;const P=a.indexBuffer[0].getFormat();_=new fb[P](a.indexBuffer[0].storage)}else{m=0;const P=a.primitive[0].type;if(P===zu||P===wc)if(a.primitive[0].count===4)p=0,g=6,_=P===zu?Ome:Nme;else{g=0;continue}}for(let P=0;P<g;P++)w[P+y]=_[p+P]+m+v;y+=g,v+=o}a=new It(this.device);for(n in u)s=u[n],a.setVertexStream(n,s.buffer,s.numComponents,void 0,s.dataType,s.normalize);w.length>0&&a.setIndices(w),a.update(Uo,!1),t&&(h=h.clone(),h.update());const T=new Dt(a,h,this.rootNode);T.castShadow=l.origMeshInstances[0].castShadow,T.parameters=l.origMeshInstances[0].parameters,T.layer=l.origMeshInstances[0].layer,T._shaderDefs=l.origMeshInstances[0]._shaderDefs,T.batching=!0,T.cull=l.origMeshInstances[0].cull;const A=this._batchGroups[i];if(A&&A._ui&&(T.cull=!1),t){const C=[];for(let P=0;P<l.origMeshInstances.length;P++)C.push(l.origMeshInstances[P].node);T.skinInstance=new xU(this.device,C,this.rootNode)}T._updateAabb=!1,T.drawOrder=l.origMeshInstances[0].drawOrder,T.stencilFront=l.origMeshInstances[0].stencilFront,T.stencilBack=l.origMeshInstances[0].stencilBack,T.flipFacesFactor=uC(l.origMeshInstances[0]),T.castShadow=l.origMeshInstances[0].castShadow,l.meshInstance=T,l.updateBoundingBox()}return l}updateAll(){this._dirtyGroups.length>0&&this.generate(this._dirtyGroups);for(let e=0;e<this._batchList.length;e++)this._batchList[e].dynamic&&this._batchList[e].updateBoundingBox()}clone(e,t){const i=new yU(t,e.dynamic,e.batchGroupId);this._batchList.push(i);const s=[];for(let n=0;n<t.length;n++)s.push(t[n].node);return i.meshInstance=new Dt(e.meshInstance.mesh,e.meshInstance.material,e.meshInstance.node),i.meshInstance._updateAabb=!1,i.meshInstance.parameters=t[0].parameters,i.meshInstance.cull=t[0].cull,i.meshInstance.layer=t[0].layer,e.dynamic&&(i.meshInstance.skinInstance=new xU(this.device,s,this.rootNode)),i.meshInstance.castShadow=e.meshInstance.castShadow,i}destroyBatch(e){e.destroy(this.scene,this._batchGroups[e.batchGroupId].layers)}}const TU="uSceneColorMap";class Bme extends dn{destroy(){super.destroy(),this.releaseRenderTarget(this.colorRenderTarget)}shouldReallocate(e,t,i){if((e==null?void 0:e.colorBuffer.format)!==i)return!0;const n=(t==null?void 0:t.width)||this.device.width,a=(t==null?void 0:t.height)||this.device.height;return!e||n!==e.width||a!==e.height}allocateRenderTarget(e,t,i,s){const n=new we(i,{name:TU,format:s,width:t?t.colorBuffer.width:i.width,height:t?t.colorBuffer.height:i.height,mipmaps:!0,minFilter:lh,magFilter:_i,addressU:ge,addressV:ge});return e?(e.destroyFrameBuffers(),e._colorBuffer=n,e._colorBuffers=[n]):e=new Zi({name:"ColorGrabRT",colorBuffer:n,depth:!1,stencil:!1,autoResolve:!1}),e}releaseRenderTarget(e){e&&(e.destroyTextureBuffers(),e.destroy())}frameUpdate(){const e=this.device,t=this.source,i=(t==null?void 0:t.colorBuffer.format)??this.device.backBufferFormat;this.shouldReallocate(this.colorRenderTarget,t==null?void 0:t.colorBuffer,i)&&(this.releaseRenderTarget(this.colorRenderTarget),this.colorRenderTarget=this.allocateRenderTarget(this.colorRenderTarget,t,e,i));const s=this.colorRenderTarget.colorBuffer;e.scope.resolve(TU).setValue(s)}execute(){const e=this.device,t=this.source,i=this.colorRenderTarget.colorBuffer;e.isWebGPU?(e.copyRenderTarget(t,this.colorRenderTarget,!0,!1),e.mipmapRenderer.generate(this.colorRenderTarget.colorBuffer.impl)):(e.copyRenderTarget(t,this.colorRenderTarget,!0,!1),e.activeTexture(e.maxCombinedTextures-1),e.bindTexture(i),e.gl.generateMipmap(i.impl._glTarget))}constructor(...e){super(...e),this.colorRenderTarget=null,this.source=null}}const EU="uSceneDepthMap";class Ume extends dn{constructor(e,t){super(e),this.depthRenderTarget=null,this.camera=null,this.camera=t}destroy(){super.destroy(),this.releaseRenderTarget(this.depthRenderTarget)}shouldReallocate(e,t){const i=(t==null?void 0:t.width)||this.device.width,s=(t==null?void 0:t.height)||this.device.height;return!e||i!==e.width||s!==e.height}allocateRenderTarget(e,t,i,s,n){const a=new we(i,{name:EU,format:s,width:t?t.colorBuffer.width:i.width,height:t?t.colorBuffer.height:i.height,mipmaps:!1,minFilter:qe,magFilter:qe,addressU:ge,addressV:ge});return e?(e.destroyFrameBuffers(),n?e._depthBuffer=a:(e._colorBuffer=a,e._colorBuffers=[a])):e=new Zi({name:"DepthGrabRT",colorBuffer:n?null:a,depthBuffer:n?a:null,depth:!n,stencil:i.supportsStencil,autoResolve:!1}),e}releaseRenderTarget(e){e&&(e.destroyTextureBuffers(),e.destroy())}before(){var l,c;const e=this.camera,t=this.device,i=(e==null?void 0:e.renderTarget)??t.backBuffer;let s=!0,n=i.stencil?uE:Bo;t.isWebGPU&&i.samples>1&&(n=sl,s=!1);const a=((l=e.renderTarget)==null?void 0:l.depthBuffer)??((c=e.renderTarget)==null?void 0:c.colorBuffer);this.shouldReallocate(this.depthRenderTarget,a)&&(this.releaseRenderTarget(this.depthRenderTarget),this.depthRenderTarget=this.allocateRenderTarget(this.depthRenderTarget,e.renderTarget,t,n,s));const o=s?this.depthRenderTarget.depthBuffer:this.depthRenderTarget.colorBuffer;t.scope.resolve(EU).setValue(o)}execute(){const e=this.device;if(e.isWebGL2&&e.renderTarget.samples>1){const t=e.renderTarget.impl._glFrameBuffer,i=this.depthRenderTarget;e.renderTarget=i,e.updateBegin(),this.depthRenderTarget.impl.internalResolve(e,t,i.impl._glFrameBuffer,this.depthRenderTarget,e.gl.DEPTH_BUFFER_BIT)}else e.copyRenderTarget(e.renderTarget,this.depthRenderTarget,!1,!0)}}class R9{get hash(){if(this._hash===void 0){const e=`${this.gammaCorrection}_${this.toneMapping}_${this.srgbRenderTarget}_${this.fog}_${this.ssaoEnabled}_${this.sceneDepthMapLinear}`;this._hash=Ia(e)}return this._hash}get defines(){const e=this._defines;return this._definesDirty&&(this._definesDirty=!1,e.clear(),this._sceneDepthMapLinear&&e.set("SCENE_DEPTHMAP_LINEAR",!0),e.set("FOG",this._fog.toUpperCase()),e.set("TONEMAP",v9[this._toneMapping]),e.set("GAMMA",Zpe[this.shaderOutputGamma])),e}markDirty(){this._hash=void 0,this._definesDirty=!0}set fog(e){this._fog!==e&&(this._fog=e,this.markDirty())}get fog(){return this._fog}set ssaoEnabled(e){this._ssaoEnabled!==e&&(this._ssaoEnabled=e,this.markDirty())}get ssaoEnabled(){return this._ssaoEnabled}set gammaCorrection(e){this._gammaCorrectionAssigned=!0,this._gammaCorrection!==e&&(this._gammaCorrection=e,this.markDirty())}get gammaCorrection(){return this._gammaCorrection}set toneMapping(e){this._toneMapping!==e&&(this._toneMapping=e,this.markDirty())}get toneMapping(){return this._toneMapping}set srgbRenderTarget(e){this._srgbRenderTarget!==e&&(this._srgbRenderTarget=e,this.markDirty())}get srgbRenderTarget(){return this._srgbRenderTarget}set sceneDepthMapLinear(e){this._sceneDepthMapLinear!==e&&(this._sceneDepthMapLinear=e,this.markDirty())}get sceneDepthMapLinear(){return this._sceneDepthMapLinear}get shaderOutputGamma(){return this._gammaCorrection===sx&&!this._srgbRenderTarget?sx:Ay}constructor(){this._gammaCorrection=sx,this._toneMapping=A3,this._srgbRenderTarget=!1,this._ssaoEnabled=!1,this._fog=um,this._sceneDepthMapLinear=!1,this._defines=new Map,this._definesDirty=!0}}const Jh=new O,Xm=new O,AU=new O,CU=new se,zme=[new O,new O,new O,new O,new O,new O,new O,new O];class Iy{constructor(){this.shaderPassInfo=null,this.renderPassColorGrab=null,this.renderPassDepthGrab=null,this.fogParams=null,this.shaderParams=new R9,this.renderPasses=[],this.jitter=0,this._aspectRatio=16/9,this._aspectRatioMode=N3,this._calculateProjection=null,this._calculateTransform=null,this._clearColor=new ae(.75,.75,.75,1),this._clearColorBuffer=!0,this._clearDepth=1,this._clearDepthBuffer=!0,this._clearStencil=0,this._clearStencilBuffer=!0,this._cullFaces=!0,this._farClip=1e3,this._flipFaces=!1,this._fov=45,this._frustumCulling=!0,this._horizontalFov=!1,this._layers=[nl,As,S3,LE,x3],this._layersSet=new Set(this._layers),this._nearClip=.1,this._node=null,this._orthoHeight=10,this._projection=ba,this._rect=new ce(0,0,1,1),this._renderTarget=null,this._scissorRect=new ce(0,0,1,1),this._scissorRectClear=!1,this._aperture=16,this._shutter=1/1e3,this._sensitivity=1e3,this._projMat=new se,this._projMatDirty=!0,this._projMatSkybox=new se,this._viewMat=new se,this._viewMatDirty=!0,this._viewProjMat=new se,this._viewProjMatDirty=!0,this._shaderMatricesVersion=0,this._viewProjInverse=new se,this._viewProjCurrent=null,this._viewProjPrevious=new se,this._jitters=[0,0,0,0],this.frustum=new Ede,this._xr=null,this._xrProperties={horizontalFov:this._horizontalFov,fov:this._fov,aspectRatio:this._aspectRatio,farClip:this._farClip,nearClip:this._nearClip}}destroy(){var e,t;(e=this.renderPassColorGrab)==null||e.destroy(),this.renderPassColorGrab=null,(t=this.renderPassDepthGrab)==null||t.destroy(),this.renderPassDepthGrab=null,this.renderPasses.length=0}_storeShaderMatrices(e,t,i,s){this._shaderMatricesVersion!==s&&(this._shaderMatricesVersion=s,this._viewProjPrevious.copy(this._viewProjCurrent??e),this._viewProjCurrent??(this._viewProjCurrent=new se),this._viewProjCurrent.copy(e),this._viewProjInverse.invert(e),this._jitters[2]=this._jitters[0],this._jitters[3]=this._jitters[1],this._jitters[0]=t,this._jitters[1]=i)}get fullSizeClearRect(){const e=this._scissorRectClear?this.scissorRect:this._rect;return e.x===0&&e.y===0&&e.z===1&&e.w===1}set aspectRatio(e){this._aspectRatio!==e&&(this._aspectRatio=e,this._projMatDirty=!0)}get aspectRatio(){var e;return(e=this.xr)!=null&&e.active?this._xrProperties.aspectRatio:this._aspectRatio}set aspectRatioMode(e){this._aspectRatioMode!==e&&(this._aspectRatioMode=e,this._projMatDirty=!0)}get aspectRatioMode(){return this._aspectRatioMode}set calculateProjection(e){this._calculateProjection=e,this._projMatDirty=!0}get calculateProjection(){return this._calculateProjection}set calculateTransform(e){this._calculateTransform=e}get calculateTransform(){return this._calculateTransform}set clearColor(e){this._clearColor.copy(e)}get clearColor(){return this._clearColor}set clearColorBuffer(e){this._clearColorBuffer=e}get clearColorBuffer(){return this._clearColorBuffer}set clearDepth(e){this._clearDepth=e}get clearDepth(){return this._clearDepth}set clearDepthBuffer(e){this._clearDepthBuffer=e}get clearDepthBuffer(){return this._clearDepthBuffer}set clearStencil(e){this._clearStencil=e}get clearStencil(){return this._clearStencil}set clearStencilBuffer(e){this._clearStencilBuffer=e}get clearStencilBuffer(){return this._clearStencilBuffer}set cullFaces(e){this._cullFaces=e}get cullFaces(){return this._cullFaces}set farClip(e){this._farClip!==e&&(this._farClip=e,this._projMatDirty=!0)}get farClip(){var e;return(e=this.xr)!=null&&e.active?this._xrProperties.farClip:this._farClip}set flipFaces(e){this._flipFaces=e}get flipFaces(){return this._flipFaces}set fov(e){this._fov!==e&&(this._fov=e,this._projMatDirty=!0)}get fov(){var e;return(e=this.xr)!=null&&e.active?this._xrProperties.fov:this._fov}set frustumCulling(e){this._frustumCulling=e}get frustumCulling(){return this._frustumCulling}set horizontalFov(e){this._horizontalFov!==e&&(this._horizontalFov=e,this._projMatDirty=!0)}get horizontalFov(){var e;return(e=this.xr)!=null&&e.active?this._xrProperties.horizontalFov:this._horizontalFov}set layers(e){this._layers=e.slice(0),this._layersSet=new Set(this._layers)}get layers(){return this._layers}get layersSet(){return this._layersSet}set nearClip(e){this._nearClip!==e&&(this._nearClip=e,this._projMatDirty=!0)}get nearClip(){var e;return(e=this.xr)!=null&&e.active?this._xrProperties.nearClip:this._nearClip}set node(e){this._node=e}get node(){return this._node}set orthoHeight(e){this._orthoHeight!==e&&(this._orthoHeight=e,this._projMatDirty=!0)}get orthoHeight(){return this._orthoHeight}set projection(e){this._projection!==e&&(this._projection=e,this._projMatDirty=!0)}get projection(){return this._projection}get projectionMatrix(){return this._evaluateProjectionMatrix(),this._projMat}set rect(e){this._rect.copy(e)}get rect(){return this._rect}set renderTarget(e){this._renderTarget=e}get renderTarget(){return this._renderTarget}set scissorRect(e){this._scissorRect.copy(e)}get scissorRect(){return this._scissorRect}get viewMatrix(){if(this._viewMatDirty){const e=this._node.getWorldTransform();this._viewMat.copy(e).invert(),this._viewMatDirty=!1}return this._viewMat}set aperture(e){this._aperture=e}get aperture(){return this._aperture}set sensitivity(e){this._sensitivity=e}get sensitivity(){return this._sensitivity}set shutter(e){this._shutter=e}get shutter(){return this._shutter}set xr(e){this._xr!==e&&(this._xr=e,this._projMatDirty=!0)}get xr(){return this._xr}clone(){return new Iy().copy(this)}copy(e){return this._aspectRatio=e._aspectRatio,this._farClip=e._farClip,this._fov=e._fov,this._horizontalFov=e._horizontalFov,this._nearClip=e._nearClip,this._xrProperties.aspectRatio=e._xrProperties.aspectRatio,this._xrProperties.farClip=e._xrProperties.farClip,this._xrProperties.fov=e._xrProperties.fov,this._xrProperties.horizontalFov=e._xrProperties.horizontalFov,this._xrProperties.nearClip=e._xrProperties.nearClip,this.aspectRatioMode=e.aspectRatioMode,this.calculateProjection=e.calculateProjection,this.calculateTransform=e.calculateTransform,this.clearColor=e.clearColor,this.clearColorBuffer=e.clearColorBuffer,this.clearDepth=e.clearDepth,this.clearDepthBuffer=e.clearDepthBuffer,this.clearStencil=e.clearStencil,this.clearStencilBuffer=e.clearStencilBuffer,this.cullFaces=e.cullFaces,this.flipFaces=e.flipFaces,this.frustumCulling=e.frustumCulling,this.layers=e.layers,this.orthoHeight=e.orthoHeight,this.projection=e.projection,this.rect=e.rect,this.renderTarget=e.renderTarget,this.scissorRect=e.scissorRect,this.aperture=e.aperture,this.shutter=e.shutter,this.sensitivity=e.sensitivity,this.shaderPassInfo=e.shaderPassInfo,this.jitter=e.jitter,this._projMatDirty=!0,this}_enableRenderPassColorGrab(e,t){var i;t?this.renderPassColorGrab||(this.renderPassColorGrab=new Bme(e)):((i=this.renderPassColorGrab)==null||i.destroy(),this.renderPassColorGrab=null)}_enableRenderPassDepthGrab(e,t,i){var s;i?this.renderPassDepthGrab||(this.renderPassDepthGrab=new Ume(e,this)):((s=this.renderPassDepthGrab)==null||s.destroy(),this.renderPassDepthGrab=null)}_updateViewProjMat(){(this._projMatDirty||this._viewMatDirty||this._viewProjMatDirty)&&(this._viewProjMat.mul2(this.projectionMatrix,this.viewMatrix),this._viewProjMatDirty=!1)}worldToScreen(e,t,i,s=new O){this._updateViewProjMat(),this._viewProjMat.transformPoint(e,s);const n=this._viewProjMat.data,a=e.x*n[3]+e.y*n[7]+e.z*n[11]+1*n[15];s.x=(s.x/a+1)*.5,s.y=(1-s.y/a)*.5;const{x:o,y:l,z:c,w:u}=this._rect;return s.x=s.x*c*t+o*t,s.y=s.y*u*i+(1-l-u)*i,s}screenToWorld(e,t,i,s,n,a=new O){const{x:o,y:l,z:c,w:u}=this._rect,h=this.farClip-this.nearClip;if(Jh.set((e-o*s)/(c*s),1-(t-(1-l-u)*n)/(u*n),i/h),Jh.mulScalar(2),Jh.sub(O.ONE),this._projection===ba){se._getPerspectiveHalfSize(Xm,this.fov,this.aspectRatio,this.nearClip,this.horizontalFov),Xm.x*=Jh.x,Xm.y*=Jh.y;const d=this._node.getWorldTransform();Xm.z=-this.nearClip,d.transformPoint(Xm,AU);const f=this._node.getPosition();a.sub2(AU,f),a.normalize(),a.mulScalar(i),a.add(f)}else this._updateViewProjMat(),CU.copy(this._viewProjMat).invert(),CU.transformPoint(Jh,a);return a}_evaluateProjectionMatrix(){if(this._projMatDirty){if(this._projection===ba)this._projMat.setPerspective(this.fov,this.aspectRatio,this.nearClip,this.farClip,this.horizontalFov),this._projMatSkybox.copy(this._projMat);else{const e=this._orthoHeight,t=e*this.aspectRatio;this._projMat.setOrtho(-t,t,-e,e,this.nearClip,this.farClip),this._projMatSkybox.setPerspective(this.fov,this.aspectRatio,this.nearClip,this.farClip)}this._projMatDirty=!1}}getProjectionMatrixSkybox(){return this._evaluateProjectionMatrix(),this._projMatSkybox}getExposure(){const e=Math.log2(this._aperture*this._aperture/this._shutter*100/this._sensitivity);return 1/(Math.pow(2,e)*1.2)}getScreenSize(e){if(this._projection===ba){const t=this._node.getPosition().distance(e.center);if(t<e.radius)return 1;const i=Math.asin(e.radius/t),s=Math.tan(i),n=Math.tan(this.fov/2*Q.DEG_TO_RAD);return Math.min(s/n,1)}return Q.clamp(e.radius/this._orthoHeight,0,1)}getFrustumCorners(e=this.nearClip,t=this.farClip){const i=this.fov*Math.PI/180;let s,n;this.projection===ba?this.horizontalFov?(s=e*Math.tan(i/2),n=s/this.aspectRatio):(n=e*Math.tan(i/2),s=n*this.aspectRatio):(n=this._orthoHeight,s=n*this.aspectRatio);const a=zme;return a[0].x=s,a[0].y=-n,a[0].z=-e,a[1].x=s,a[1].y=n,a[1].z=-e,a[2].x=-s,a[2].y=n,a[2].z=-e,a[3].x=-s,a[3].y=-n,a[3].z=-e,this._projection===ba&&(this.horizontalFov?(s=t*Math.tan(i/2),n=s/this.aspectRatio):(n=t*Math.tan(i/2),s=n*this.aspectRatio)),a[4].x=s,a[4].y=-n,a[4].z=-t,a[5].x=s,a[5].y=n,a[5].z=-t,a[6].x=-s,a[6].y=n,a[6].z=-t,a[7].x=-s,a[7].y=-n,a[7].z=-t,a}setXrProperties(e){Object.assign(this._xrProperties,e),this._projMatDirty=!0}}const PU=new se,hC=new O,IU=new de,dC=new de,MU=new O,RU=new O,Vme=new se,jme=new de,os=new O,qm=new se,ls=new de,ed=new de,DU=new se,fC=new O,B0=new O;function LU(r,e){return r instanceof Function?r:t=>{let i=t[r];return i instanceof Function&&(i=i()),i===e}}function D9(r,e){if(e(r))return r;const t=r._children,i=t.length;for(let s=0;s<i;++s){const n=D9(t[s],e);if(n)return n}return null}class Xt extends Te{constructor(e="Untitled"){super(),this.tags=new sb(this),this.localPosition=new O,this.localRotation=new de,this.localScale=new O(1,1,1),this.localEulerAngles=new O,this.position=new O,this.rotation=new de,this.eulerAngles=new O,this._scale=null,this.localTransform=new se,this._dirtyLocal=!1,this._aabbVer=0,this._frozen=!1,this.worldTransform=new se,this._dirtyWorld=!1,this._worldScaleSign=0,this._normalMatrix=new Ba,this._dirtyNormal=!0,this._right=null,this._up=null,this._forward=null,this._parent=null,this._children=[],this._graphDepth=0,this._enabled=!0,this._enabledInHierarchy=!1,this.scaleCompensation=!1,this.name=e}get right(){return this._right||(this._right=new O),this.getWorldTransform().getX(this._right).normalize()}get up(){return this._up||(this._up=new O),this.getWorldTransform().getY(this._up).normalize()}get forward(){return this._forward||(this._forward=new O),this.getWorldTransform().getZ(this._forward).normalize().mulScalar(-1)}get normalMatrix(){const e=this._normalMatrix;return this._dirtyNormal&&(e.invertMat4(this.getWorldTransform()).transpose(),this._dirtyNormal=!1),e}set enabled(e){var t;this._enabled!==e&&(this._enabled=e,(e&&((t=this._parent)!=null&&t.enabled)||!e)&&this._notifyHierarchyStateChanged(this,e))}get enabled(){return this._enabled&&this._enabledInHierarchy}get parent(){return this._parent}get path(){let e=this._parent;if(!e)return"";let t=this.name;for(;e&&e._parent;)t=`${e.name}/${t}`,e=e._parent;return t}get root(){let e=this;for(;e._parent;)e=e._parent;return e}get children(){return this._children}get graphDepth(){return this._graphDepth}_notifyHierarchyStateChanged(e,t){e._onHierarchyStateChanged(t);const i=e._children;for(let s=0,n=i.length;s<n;s++)i[s]._enabled&&this._notifyHierarchyStateChanged(i[s],t)}_onHierarchyStateChanged(e){this._enabledInHierarchy=e,e&&!this._frozen&&this._unfreezeParentToRoot()}_cloneInternal(e){e.name=this.name;const t=this.tags._list;e.tags.clear();for(let i=0;i<t.length;i++)e.tags.add(t[i]);e.localPosition.copy(this.localPosition),e.localRotation.copy(this.localRotation),e.localScale.copy(this.localScale),e.localEulerAngles.copy(this.localEulerAngles),e.position.copy(this.position),e.rotation.copy(this.rotation),e.eulerAngles.copy(this.eulerAngles),e.localTransform.copy(this.localTransform),e._dirtyLocal=this._dirtyLocal,e.worldTransform.copy(this.worldTransform),e._dirtyWorld=this._dirtyWorld,e._dirtyNormal=this._dirtyNormal,e._aabbVer=this._aabbVer+1,e._enabled=this._enabled,e.scaleCompensation=this.scaleCompensation,e._enabledInHierarchy=!1}clone(){const e=new this.constructor;return this._cloneInternal(e),e}copy(e){return e._cloneInternal(this),this}destroy(){this.remove();const e=this._children;for(;e.length;){const t=e.pop();t._parent=null,t.destroy()}this.fire("destroy",this),this.off()}find(e,t){const i=[],s=LU(e,t);return this.forEach(n=>{s(n)&&i.push(n)}),i}findOne(e,t){const i=LU(e,t);return D9(this,i)}findByTag(...e){const t=[],i=(s,n)=>{n&&s.tags.has(...e)&&t.push(s);for(let a=0;a<s._children.length;a++)i(s._children[a],!0)};return i(this,!1),t}findByName(e){return this.findOne("name",e)}findByPath(e){const t=Array.isArray(e)?e:e.split("/");let i=this;for(let s=0,n=t.length;s<n;++s)if(i=i.children.find(a=>a.name===t[s]),!i)return null;return i}forEach(e,t){e.call(t,this);const i=this._children,s=i.length;for(let n=0;n<s;++n)i[n].forEach(e,t)}isDescendantOf(e){let t=this._parent;for(;t;){if(t===e)return!0;t=t._parent}return!1}isAncestorOf(e){return e.isDescendantOf(this)}getEulerAngles(){return this.getWorldTransform().getEulerAngles(this.eulerAngles),this.eulerAngles}getLocalEulerAngles(){return this.localRotation.getEulerAngles(this.localEulerAngles),this.localEulerAngles}getLocalPosition(){return this.localPosition}getLocalRotation(){return this.localRotation}getLocalScale(){return this.localScale}getLocalTransform(){return this._dirtyLocal&&(this.localTransform.setTRS(this.localPosition,this.localRotation,this.localScale),this._dirtyLocal=!1),this.localTransform}getPosition(){return this.getWorldTransform().getTranslation(this.position),this.position}getRotation(){return this.rotation.setFromMat4(this.getWorldTransform()),this.rotation}getScale(){return this._scale||(this._scale=new O),this.getWorldTransform().getScale(this._scale)}getWorldTransform(){return!this._dirtyLocal&&!this._dirtyWorld?this.worldTransform:(this._parent&&this._parent.getWorldTransform(),this._sync(),this.worldTransform)}get worldScaleSign(){return this._worldScaleSign===0&&(this._worldScaleSign=this.getWorldTransform().scaleSign),this._worldScaleSign}remove(){var e;(e=this._parent)==null||e.removeChild(this)}reparent(e,t){this.remove(),e&&(t>=0?e.insertChild(this,t):e.addChild(this))}setLocalEulerAngles(e,t,i){this.localRotation.setFromEulerAngles(e,t,i),this._dirtyLocal||this._dirtifyLocal()}setLocalPosition(e,t,i){e instanceof O?this.localPosition.copy(e):this.localPosition.set(e,t,i),this._dirtyLocal||this._dirtifyLocal()}setLocalRotation(e,t,i,s){e instanceof de?this.localRotation.copy(e):this.localRotation.set(e,t,i,s),this._dirtyLocal||this._dirtifyLocal()}setLocalScale(e,t,i){e instanceof O?this.localScale.copy(e):this.localScale.set(e,t,i),this._dirtyLocal||this._dirtifyLocal()}_dirtifyLocal(){this._dirtyLocal||(this._dirtyLocal=!0,this._dirtyWorld||this._dirtifyWorld())}_unfreezeParentToRoot(){let e=this._parent;for(;e;)e._frozen=!1,e=e._parent}_dirtifyWorld(){this._dirtyWorld||this._unfreezeParentToRoot(),this._dirtifyWorldInternal()}_dirtifyWorldInternal(){if(!this._dirtyWorld){this._frozen=!1,this._dirtyWorld=!0;for(let e=0;e<this._children.length;e++)this._children[e]._dirtyWorld||this._children[e]._dirtifyWorldInternal()}this._dirtyNormal=!0,this._worldScaleSign=0,this._aabbVer++}setPosition(e,t,i){e instanceof O?os.copy(e):os.set(e,t,i),this._parent===null?this.localPosition.copy(os):(qm.copy(this._parent.getWorldTransform()).invert(),qm.transformPoint(os,this.localPosition)),this._dirtyLocal||this._dirtifyLocal()}setRotation(e,t,i,s){if(e instanceof de?ls.copy(e):ls.set(e,t,i,s),this._parent===null)this.localRotation.copy(ls);else{const n=this._parent.getRotation();ed.copy(n).invert(),this.localRotation.copy(ed).mul(ls)}this._dirtyLocal||this._dirtifyLocal()}setPositionAndRotation(e,t){if(this._parent===null)this.localPosition.copy(e),this.localRotation.copy(t);else{const i=this._parent.getWorldTransform();qm.copy(i).invert(),qm.transformPoint(e,this.localPosition),this.localRotation.setFromMat4(qm).mul(t)}this._dirtyLocal||this._dirtifyLocal()}setEulerAngles(e,t,i){if(this.localRotation.setFromEulerAngles(e,t,i),this._parent!==null){const s=this._parent.getRotation();ed.copy(s).invert(),this.localRotation.mul2(ed,this.localRotation)}this._dirtyLocal||this._dirtifyLocal()}addChild(e){this._prepareInsertChild(e),this._children.push(e),this._onInsertChild(e)}addChildAndSaveTransform(e){const t=e.getPosition(),i=e.getRotation();this._prepareInsertChild(e),e.setPosition(Vme.copy(this.worldTransform).invert().transformPoint(t)),e.setRotation(jme.copy(this.getRotation()).invert().mul(i)),this._children.push(e),this._onInsertChild(e)}insertChild(e,t){this._prepareInsertChild(e),this._children.splice(t,0,e),this._onInsertChild(e)}_prepareInsertChild(e){e.remove()}_fireOnHierarchy(e,t,i){this.fire(e,i);for(let s=0;s<this._children.length;s++)this._children[s]._fireOnHierarchy(t,t,i)}_onInsertChild(e){e._parent=this;const t=e._enabled&&this.enabled;e._enabledInHierarchy!==t&&(e._enabledInHierarchy=t,e._notifyHierarchyStateChanged(e,t)),e._updateGraphDepth(),e._dirtifyWorld(),this._frozen&&e._unfreezeParentToRoot(),e._fireOnHierarchy("insert","inserthierarchy",this),this.fire&&this.fire("childinsert",e)}_updateGraphDepth(){this._graphDepth=this._parent?this._parent._graphDepth+1:0;for(let e=0,t=this._children.length;e<t;e++)this._children[e]._updateGraphDepth()}removeChild(e){const t=this._children.indexOf(e);t!==-1&&(this._children.splice(t,1),e._parent=null,e._fireOnHierarchy("remove","removehierarchy",this),this.fire("childremove",e))}_sync(){if(this._dirtyLocal&&(this.localTransform.setTRS(this.localPosition,this.localRotation,this.localScale),this._dirtyLocal=!1),this._dirtyWorld){if(this._parent===null)this.worldTransform.copy(this.localTransform);else if(this.scaleCompensation){let e;const t=this._parent;let i=this.localScale,s=t;if(s){for(;s&&s.scaleCompensation;)s=s._parent;s&&(s=s._parent,s&&(e=s.worldTransform.getScale(),MU.mul2(e,this.localScale),i=MU))}dC.setFromMat4(t.worldTransform),IU.mul2(dC,this.localRotation);let n=t.worldTransform;t.scaleCompensation&&(RU.mul2(e,t.getLocalScale()),PU.setTRS(t.worldTransform.getTranslation(hC),dC,RU),n=PU),n.transformPoint(this.localPosition,hC),this.worldTransform.setTRS(hC,IU,i)}else this.worldTransform.mulAffine2(this._parent.worldTransform,this.localTransform);this._dirtyWorld=!1}}syncHierarchy(){if(!this._enabled||this._frozen)return;this._frozen=!0,(this._dirtyLocal||this._dirtyWorld)&&this._sync();const e=this._children;for(let t=0,i=e.length;t<i;t++)e[t].syncHierarchy()}lookAt(e,t,i,s=0,n=1,a=0){if(e instanceof O)fC.copy(e),t instanceof O?B0.copy(t):B0.copy(O.UP);else{if(i===void 0)return;fC.set(e,t,i),B0.set(s,n,a)}DU.setLookAt(this.getPosition(),fC,B0),ls.setFromMat4(DU),this.setRotation(ls)}translate(e,t,i){e instanceof O?os.copy(e):os.set(e,t,i),os.add(this.getPosition()),this.setPosition(os)}translateLocal(e,t,i){e instanceof O?os.copy(e):os.set(e,t,i),this.localRotation.transformVector(os,os),this.localPosition.add(os),this._dirtyLocal||this._dirtifyLocal()}rotate(e,t,i){if(ls.setFromEulerAngles(e,t,i),this._parent===null)this.localRotation.mul2(ls,this.localRotation);else{const s=this.getRotation(),n=this._parent.getRotation();ed.copy(n).invert(),ls.mul2(ed,ls),this.localRotation.mul2(ls,s)}this._dirtyLocal||this._dirtifyLocal()}rotateLocal(e,t,i){ls.setFromEulerAngles(e,t,i),this.localRotation.mul(ls),this._dirtyLocal||this._dirtifyLocal()}}const OU=new se,NU=new se,kU=new se,Nl=class Nl{static create(e,t,i){const s=new Iy;switch(s.node=new Xt(e),s.aspectRatio=1,s.aspectRatioMode=PM,s._scissorRectClear=!0,t){case Pt:s.node.setRotation(Nl.pointLightRotations[i]),s.fov=90,s.projection=ba;break;case Rt:s.projection=ba;break;case Me:s.projection=Mf;break}return s}static evalSpotCookieMatrix(e){let t=Nl._spotCookieCamera;t||(t=Nl.create("SpotCookieCamera",Rt),Nl._spotCookieCamera=t),t.fov=e._outerConeAngle*2;const i=t._node;i.setPosition(e._node.getPosition()),i.setRotation(e._node.getRotation()),i.rotateLocal(-90,0,0),OU.setTRS(i.getPosition(),i.getRotation(),O.ONE).invert(),NU.mul2(t.projectionMatrix,OU);const s=e.cookieMatrix,n=e.atlasViewport;return kU.setViewport(n.x,n.y,n.z,n.w),s.mul2(kU,NU),s}};Nl.pointLightRotations=[new de().setFromEulerAngles(0,90,180),new de().setFromEulerAngles(0,-90,180),new de().setFromEulerAngles(90,0,0),new de().setFromEulerAngles(-90,0,0),new de().setFromEulerAngles(0,180,180),new de().setFromEulerAngles(0,0,180)],Nl._spotCookieCamera=null;let _p=Nl;const Us=new O,Vc=new Float32Array(6),$me=new O(-.5,0,0),Hme=new O(0,0,.5),Kt={POSITION_RANGE:0,DIRECTION_FLAGS:1,COLOR_ANGLES_BIAS:2,PROJ_MAT_0:3,ATLAS_VIEWPORT:3,PROJ_MAT_1:4,PROJ_MAT_2:5,PROJ_MAT_3:6,AREA_DATA_WIDTH:7,AREA_DATA_HEIGHT:8,COUNT:9},Gme={LIGHTSHAPE_PUNCTUAL:`${Wn}u`,LIGHTSHAPE_RECT:`${l9}u`,LIGHTSHAPE_DISK:`${c9}u`,LIGHTSHAPE_SPHERE:`${u9}u`,LIGHT_COLOR_DIVIDER:`${rx}.0`},FU=(r,e)=>Object.keys(r).map(t=>`#define {${e}${t}} ${r[t]}`).join(`
`),BU=`

		${FU(Kt,"CLUSTER_TEXTURE_")}
		${FU(Gme,"")}
`;class Wme{constructor(e){this.areaLightsEnabled=!1,this.device=e,$e.get(e,dt).set("lightBufferDefinesPS",BU),$e.get(e,Gt).set("lightBufferDefinesPS",BU),this.cookiesEnabled=!1,this.shadowsEnabled=!1,this.areaLightsEnabled=!1,this.maxLights=255;const t=Kt.COUNT;this.lightsFloat=new Float32Array(4*t*this.maxLights),this.lightsUint=new Uint32Array(this.lightsFloat.buffer),this.lightsTexture=this.createTexture(this.device,t,this.maxLights,or,"LightsTexture"),this._lightsTextureId=this.device.scope.resolve("lightsTexture"),this.invMaxColorValue=0,this.invMaxAttenuation=0,this.boundsMin=new O,this.boundsDelta=new O}destroy(){var e;(e=this.lightsTexture)==null||e.destroy(),this.lightsTexture=null}createTexture(e,t,i,s,n){return new we(e,{name:n,width:t,height:i,mipmaps:!1,format:s,addressU:ge,addressV:ge,type:qa,magFilter:qe,minFilter:qe,anisotropy:1})}setBounds(e,t){this.boundsMin.copy(e),this.boundsDelta.copy(t)}uploadTextures(){this.lightsTexture.lock().set(this.lightsFloat),this.lightsTexture.unlock()}updateUniforms(){this._lightsTextureId.setValue(this.lightsTexture)}getSpotDirection(e,t){t._node.getWorldTransform().getY(e).mulScalar(-1),e.normalize()}getLightAreaSizes(e){const t=e._node.getWorldTransform();return t.transformVector($me,Us),Vc[0]=Us.x,Vc[1]=Us.y,Vc[2]=Us.z,t.transformVector(Hme,Us),Vc[3]=Us.x,Vc[4]=Us.y,Vc[5]=Us.z,Vc}addLightData(e,t){const i=e._type===Rt,s=e.atlasViewportAllocated,n=this.cookiesEnabled&&!!e._cookie&&s,a=this.areaLightsEnabled&&e.shape!==Wn,o=this.shadowsEnabled&&e.castShadows&&s,l=e._node.getPosition();let c=null,u=null;i?o?c=e.getRenderData(null,0).shadowMatrix:n&&(c=_p.evalSpotCookieMatrix(e)):(o||n)&&(u=e.atlasViewport);const h=this.lightsFloat,d=this.lightsUint,f=t*this.lightsTexture.width*4;h[f+4*Kt.POSITION_RANGE+0]=l.x,h[f+4*Kt.POSITION_RANGE+1]=l.y,h[f+4*Kt.POSITION_RANGE+2]=l.z,h[f+4*Kt.POSITION_RANGE+3]=e.attenuationEnd;const p=e.clusteredData;if(d[f+4*Kt.COLOR_ANGLES_BIAS+0]=p[0],d[f+4*Kt.COLOR_ANGLES_BIAS+1]=p[1],d[f+4*Kt.COLOR_ANGLES_BIAS+2]=p[2],e.castShadows){const m=e.getRenderData(null,0),g=e._getUniformBiasValues(m),_=ah.float2Half(g.bias),v=ah.float2Half(g.normalBias);d[f+4*Kt.COLOR_ANGLES_BIAS+3]=_|v<<16}if(i&&(this.getSpotDirection(Us,e),h[f+4*Kt.DIRECTION_FLAGS+0]=Us.x,h[f+4*Kt.DIRECTION_FLAGS+1]=Us.y,h[f+4*Kt.DIRECTION_FLAGS+2]=Us.z),d[f+4*Kt.DIRECTION_FLAGS+3]=e.getClusteredFlags(o,n),c){const m=c.data;for(let g=0;g<16;g++)h[f+4*Kt.PROJ_MAT_0+g]=m[g]}if(u&&(h[f+4*Kt.ATLAS_VIEWPORT+0]=u.x,h[f+4*Kt.ATLAS_VIEWPORT+1]=u.y,h[f+4*Kt.ATLAS_VIEWPORT+2]=u.z/3),a){const m=this.getLightAreaSizes(e);h[f+4*Kt.AREA_DATA_WIDTH+0]=m[0],h[f+4*Kt.AREA_DATA_WIDTH+1]=m[1],h[f+4*Kt.AREA_DATA_WIDTH+2]=m[2],h[f+4*Kt.AREA_DATA_HEIGHT+0]=m[3],h[f+4*Kt.AREA_DATA_HEIGHT+1]=m[4],h[f+4*Kt.AREA_DATA_HEIGHT+2]=m[5]}}}const U0=new O,z0=new O,V0=new O,pC=new We;class UU{constructor(){this.light=null,this.min=new O,this.max=new O}}class IM{constructor(e){this.device=e,this.name="Untitled",this.reportCount=0,this.boundsMin=new O,this.boundsMax=new O,this.boundsDelta=new O,this._cells=new O(1,1,1),this._cellsLimit=new O,this.cells=this._cells,this.maxCellLightCount=4,this._usedLights=[],this._usedLights.push(new UU),this.lightsBuffer=new Wme(e),this.registerUniforms(e)}set maxCellLightCount(e){e!==this._maxCellLightCount&&(this._maxCellLightCount=e,this._cellsDirty=!0)}get maxCellLightCount(){return this._maxCellLightCount}set cells(e){U0.copy(e).floor(),this._cells.equals(U0)||(this._cells.copy(U0),this._cellsLimit.copy(U0).sub(O.ONE),this._cellsDirty=!0)}get cells(){return this._cells}destroy(){this.lightsBuffer.destroy(),this.releaseClusterTexture()}releaseClusterTexture(){this.clusterTexture&&(this.clusterTexture.destroy(),this.clusterTexture=null)}registerUniforms(e){this._clusterSkipId=e.scope.resolve("clusterSkip"),this._clusterMaxCellsId=e.scope.resolve("clusterMaxCells"),this._clusterWorldTextureId=e.scope.resolve("clusterWorldTexture"),this._clusterTextureSizeId=e.scope.resolve("clusterTextureSize"),this._clusterTextureSizeData=new Float32Array(3),this._clusterBoundsMinId=e.scope.resolve("clusterBoundsMin"),this._clusterBoundsMinData=new Float32Array(3),this._clusterBoundsDeltaId=e.scope.resolve("clusterBoundsDelta"),this._clusterBoundsDeltaData=new Float32Array(3),this._clusterCellsCountByBoundsSizeId=e.scope.resolve("clusterCellsCountByBoundsSize"),this._clusterCellsCountByBoundsSizeData=new Float32Array(3),this._clusterCellsDotId=e.scope.resolve("clusterCellsDot"),this._clusterCellsDotData=new Float32Array(3),this._clusterCellsMaxId=e.scope.resolve("clusterCellsMax"),this._clusterCellsMaxData=new Float32Array(3)}updateParams(e){e&&(this.cells=e.cells,this.maxCellLightCount=e.maxLightsPerCell,this.lightsBuffer.cookiesEnabled=e.cookiesEnabled,this.lightsBuffer.shadowsEnabled=e.shadowsEnabled,this.lightsBuffer.areaLightsEnabled=e.areaLightsEnabled)}updateCells(){if(this._cellsDirty){this._cellsDirty=!1;const e=this._cells.x,t=this._cells.y,i=this._cells.z,s=e*t*i,n=this.maxCellLightCount*s;let a=Math.ceil(Math.sqrt(n));a=Q.roundUp(a,this.maxCellLightCount);const o=Math.ceil(n/a);this._clusterCellsMaxData[0]=e,this._clusterCellsMaxData[1]=t,this._clusterCellsMaxData[2]=i,this._clusterCellsDotData[0]=this.maxCellLightCount,this._clusterCellsDotData[1]=e*i*this.maxCellLightCount,this._clusterCellsDotData[2]=e*this.maxCellLightCount,this.clusters=new Uint8ClampedArray(n),this.counts=new Int32Array(s),this._clusterTextureSizeData[0]=a,this._clusterTextureSizeData[1]=1/a,this._clusterTextureSizeData[2]=1/o,this.releaseClusterTexture(),this.clusterTexture=this.lightsBuffer.createTexture(this.device,a,o,ZO,"ClusterTexture")}}uploadTextures(){this.clusterTexture.lock().set(this.clusters),this.clusterTexture.unlock(),this.lightsBuffer.uploadTextures()}updateUniforms(){this._clusterSkipId.setValue(this._usedLights.length>1?0:1),this.lightsBuffer.updateUniforms(),this._clusterWorldTextureId.setValue(this.clusterTexture),this._clusterMaxCellsId.setValue(this.maxCellLightCount);const e=this.boundsDelta;this._clusterCellsCountByBoundsSizeData[0]=this._cells.x/e.x,this._clusterCellsCountByBoundsSizeData[1]=this._cells.y/e.y,this._clusterCellsCountByBoundsSizeData[2]=this._cells.z/e.z,this._clusterCellsCountByBoundsSizeId.setValue(this._clusterCellsCountByBoundsSizeData),this._clusterBoundsMinData[0]=this.boundsMin.x,this._clusterBoundsMinData[1]=this.boundsMin.y,this._clusterBoundsMinData[2]=this.boundsMin.z,this._clusterBoundsDeltaData[0]=e.x,this._clusterBoundsDeltaData[1]=e.y,this._clusterBoundsDeltaData[2]=e.z,this._clusterTextureSizeId.setValue(this._clusterTextureSizeData),this._clusterBoundsMinId.setValue(this._clusterBoundsMinData),this._clusterBoundsDeltaId.setValue(this._clusterBoundsDeltaData),this._clusterCellsDotId.setValue(this._clusterCellsDotData),this._clusterCellsMaxId.setValue(this._clusterCellsMaxData)}evalLightCellMinMax(e,t,i){t.copy(e.min),t.sub(this.boundsMin),t.div(this.boundsDelta),t.mul2(t,this.cells),t.floor(),i.copy(e.max),i.sub(this.boundsMin),i.div(this.boundsDelta),i.mul2(i,this.cells),i.ceil(),t.max(O.ZERO),i.min(this._cellsLimit)}collectLights(e){const t=this.lightsBuffer.maxLights,i=this._usedLights;let s=1;e.forEach(n=>{const a=!!(n.mask&(Zn|ph)),o=n.type===Rt&&n._outerConeAngle===0;if(n.enabled&&n.type!==Me&&n.visibleThisFrame&&n.intensity>0&&a&&!o&&s<t){let l;s<i.length?l=i[s]:(l=new UU,i.push(l)),l.light=n,n.getBoundingBox(pC),l.min.copy(pC.getMin()),l.max.copy(pC.getMax()),s++}}),i.length=s}evaluateBounds(){const e=this._usedLights,t=this.boundsMin,i=this.boundsMax;if(e.length>1){t.copy(e[1].min),i.copy(e[1].max);for(let s=2;s<e.length;s++)t.min(e[s].min),i.max(e[s].max)}else t.set(0,0,0),i.set(1,1,1);this.boundsDelta.sub2(i,t),this.lightsBuffer.setBounds(t,this.boundsDelta)}updateClusters(e){this.counts.fill(0),this.clusters.fill(0),this.lightsBuffer.areaLightsEnabled=e?e.areaLightsEnabled:!1;const t=this._cells.x,i=this._cells.z,s=this.counts,n=this._maxCellLightCount,a=this.clusters,o=this.maxCellLightCount,l=this._usedLights;for(let c=1;c<l.length;c++){const u=l[c],h=u.light;this.lightsBuffer.addLightData(h,c),this.evalLightCellMinMax(u,z0,V0);const d=z0.x,f=V0.x,p=z0.y,m=V0.y,g=z0.z,_=V0.z;for(let v=d;v<=f;v++)for(let y=g;y<=_;y++)for(let x=p;x<=m;x++){const S=v+t*(y+x*i),w=s[S];w<n&&(a[o*S+w]=c,s[S]=w+1)}}}update(e,t=null){this.updateParams(t),this.updateCells(),this.collectLights(e),this.evaluateBounds(),this.updateClusters(t),this.uploadTextures()}activate(){this.updateUniforms()}}const Xme="muPIHORMLNDCz4DxVR/ZvYfAUVEFR47KRIC4nwAAAAAP7WxlhD6Ci+2HCe7BF8jRAPZwdH2UPpI5PdLCJdkvG4UTaNDJ/0crAzne71GCrb4kbdMjjCEGzdX6fNxDMLJq5xkeoIVTdfiZkodEeArmZmp/FQzFjD4x8iOW7Dg64n+3mWqyEwLxXT8zoJXfbw8QJKDCaarUYyTlMzNFHbgUe9IQV7g4YOgtSKpIFZJ0qERm7u4PpmiF89ktHWCywaGmD6h+hfh2/Zd8KYlKqqo4Cem4T42bT/Z9FpCQF1hhSjfBzZ5XFn/y3jegWC6u86KuELRundQS/1Rp+XuKKGIgRv3CvP5y749yqLlFO495JOT3+f2CXgd71npU0/KjjpkZucbJ5m78IVyuSrSozc9jgBUhDrz0hFsyb7LFUH9//wJbBgLdNWJZObfKxrNt8TliLA9w9sXFv6g26iXpf6r/BqcAusj/QzGBZuoUGeEtw8BCXCZ3jUiw4hvM18ZVqlUD3C40LAFXW6FRjuAZGRNstb0/qVk4skwyT+MHrvRorI4rKHVMWZmKyAkzL/78u/9pMQuX14pZN50b2PHn6fRxeaCQLsfT4dpvIkWWFuFVENZIh+8xgR6lU+85W0PPdAu1j99kcCG40JBQa4JMyRzq6qriOBLtqF87vpCJan0WEduVr/mOYkS00urVA0mA6M3031+GmGmW48PaJDYOEIb3bIXWPaLoAOEinX1TN3+/vwhG6nqJu0TdHpedS7QsGZIoxH3nQYYjQP1jmbahlbNngw5ogsGk1y50XZyUmQBY+/JBJ3Unu4dApm+WmPwHPU9gLb+4mHh4BiY6M86pq+WeTyWdI3s0CXPEtHGXZ8zMZgUoyRomBi1VdazzuN+WOmQ9Pa0Z0tlNopUi8AJ4x2Xn4mmOKEbXLxlbVsWu8XhuDGYFOGCRVdSqDPXrHU5SDdUlti3k5///SBwzTMwK3L4a1H7w4lnpEas6////AfX8asyIBfeFXVJ3tgvxQ/blZuUKyIODIfr/UzdWNu7pciLBpdZRZ4pIfZ1R6szq+XNxkGG///8EZFpu7VHAhFWqHEOrB9unw+YQa5o8/9IR/V5/zq+986rJSyfgJKt2u9hxU1wzyQWPjJGvzG9+eWWxGFOHVKqI4jBQALwZZswesnvZ2UmmkEXdiRpz8B+oWE7PY70ZTMndisYSXg2TqoI+3y9BxbnY2Y4EfbdcRhAvG59NqDENNYbxKvK5HJfPG5M+Wi2AcpLVJrD6caiEOzgSoVNSgQK8fm2M3zGcF4xtClv/8Hs9oD7C3jitTATYNQxmKqKf1LhIxzf1bmfiNn7UKFmcJu4sLqVLwxGSue3taBEyknkw5hXTsUCvqmmL/f8n/w0giR7Hu/9EHvpkz3yuu64TioMkzdTJ30i0+hFnQqW1+v9mMwq+z9qGX0UFu9MomvVG2xod6vc12AAAAACq7sGa5qptFR0jF3nQt/D+7PibKYahaxP3hEixPbGi9nwNf2LAa7LkEZRKxzXeCD64Xpii5n+8Kpg8eHIv7AWXZltgMoGltmoJ0XGdOCL8WkzphvR9N2o3ARSZ42l5e5Pe4B58MCRlP3EKv+mcloknH+fto5BWsmEutW6KvjOVsznFCktkSczVk4aGvj9VXlRcLeDoKG8RkBgdcNG2bf8HUL4MT2DM+ar7NImJhKpxakX4Vk0CnP+/XNhl5UsP0lXgeZXPoDBMSW5An+DXlTCO5FQGwSPYwHLKYVIimEdAoVe49rQLaaNcye5LxU2/c5TijTgJtD5eQQIe1snxauj5jZsxJBUJdoP/zqpjqv8qBruoPsVsP8N44PCUW5Dd0DzqjSS/Dl5mI9cn1w2ndN/0KAEm1QAAAACwu6KM/083IBbH5bPa/9oHUwcU8I9v3j6/v18QYammrf+P6VL///8BrpuM3fOLCxaLNOFNF1zPbPYTP65ni6njft4eVcyrVXRQFrs52tr35StiSp55edVDCBC0H5rIfac6nzUwxQSt7y15QoKb+5zebEQUmVbrPjXuUa19Ey7sqXMiSUKHaw72PJKDdrutJoQr3u6lEYJ8K0MakWKj9zjTFi4X94TsKYco0GrLeB60M6D8M/80rhXUW8iMequg8y5F838WI0+gp3GBN5Kj/xIOxTWQuUaPV/LwvARr1VH93BFgGZR1MFW0Ua30GbYmdnAgo9VWy8SQtpDUgGE2r2zq2eTEMCL7sMKmE1hchVhuF/TCq9iXKEm86kzOf3Rp9ZnCxbpDUj+FKNxVyXe6pVZkRXv/m95SnB/EB8aME29N85MtAcDoXWlor8De2Q5Dg1tar+8wgiZufbMam81j//ASUohoR/zSh2KG4bvT6mkIPz6C5/98DC3LaWlaEZ1zA5JORZRu6J/a0GY285sEYzw71YqOT1ihAG0z5SDt1xNiDQWZdFpndArp6xWhqSDkRb4kSJEHb9liPvw7uLV/6i5MVf//A9Qjr8xkAEUh+KDI+zdtJ68d6MBOktg1iyp/SCq8O9f5pbamn1VVVQPRTWqNBvhQKa07s6P0lc9Luu/3gw4HeyOUfz8MxMwV4UQhua+t9cr4bz/nIB2wnDSK1K7I94M+s6C84htaX/CNlMQUSs2KJO+yaebfTbkNX5yWcqEJevo0vbKUiETuFXiL019A3E+lmsyZMwXrXLLiQAZ5t9+jI3JobhJTMiDH5ZOQ+8Jau5555NMjHSscP9qCVaa40doh+1a3Ukf6jqBmLddgh79/fwTfCyqiuldNkUoy+nUp+4nerwg0OjtGv2x485PJOJvUEokNhYIdWjpx7BWk0VZGWOp3jSFTJ2bnu6KCduZtG/UcBC9RZ3W/jMSfSMw4Etr/DoD/XYP2V5Ovw+YoM3F5g2dGLdvuG6ZkVGLE6Dk5Zr+sdSyGliJP1y2OFf/KFO0RWO+3gsGhesTnfZVpTd8/HwgO216gwaqo+vY3TljfJWowY+i0p0Os4SLn/1wLqDHMlszggmT/D8MRFzs+pLv6LNJSsNZ/r41mWi/rF6ZcKp/yzJdK0VU44hskq3RGpgO6mIpJDsf/mZkFrz0yYOMLbuaj/wp1v7JMFM5eqvBhmTd7U8frQAtHtys4zgpjZmzUhOVTfNNLifElGXADlqHGKrkBT/nYwX8ZRm3RjvyPvjKyEqEGKUpVnvOGx+NKPHiWM//ZDpDVGvvrjmk8RPF/wiYZD3+Us8YCXjrVOfjdd1UPAfjLp8jgSn4me7DPTpz1Ggy9XL80guFO7ECT10AvILKfD18Qx+KY/f8aRqu0oOO8hfKRFZa9PUJwCsp6VdZz6LFkm2b9Pl2LIifCwzRy7TpdG2uAtOxP2OemY26bJMa9ZGSLIRlMsgpDpnDJwd0oa5pQ13x1hrHf52HpulUWonGWsfXZbSQYKu9bnEN76ciQih0opN3deDVrbrxorfVlnCmL1R9zq3ePGWIv21c7pW8kEiFTM5JX8dAw867s/60cf79/BH+MDFCZBHlz1L+qGOJf/1txhhmrf3//As+RIJwevDb+fgNXVeHw67QptZegayhrEwr5Gy+EPo1RLaMtPbqOZYoVzXzwzjMFWZxyUG9YUIf6////AQWy84iAygLk9COtXt92+0mT/xg0zMzMBeLkb8y9SL2TDXgSX422hDgpGNLJyuPioA+YJ91G8znrpNqHkwYyscaJDEc9Vc+j4cXle3hvcd2JqDQH2lBZxDn6mUTs0b75raMvbs727codX01Anj8f3wir9P2xQaQ22v/TxCMglKDFoTjaP01XTLgxnTvPv02JgEUrW6UDgOnobFpLdvKdlypgIzPcq14fgXU5tvVW0FEs7VRlsG1IyA69fN4n+awHhT34cE+xUvdj86C8LgAsFheTjI9Ht9EyYAAAAAAVBVKRx2wLgUTI0/2QfyJo2riRw3JDqzEShmx/Lifo6mRkQVbS7X53t+EvKxcXogtdts31e9MRHdcHgsA8rt4/mt2unlzQ/wsU8Gu7+W6Oj7eD8EQdDp5XlCsVaS/AV/t5ZpPOHR3rGpyAJe9IPV+xMrBL1Oz/8MQhFs31h0N1cVnq371uqIJYHyafKH1jteAK3VpMXBcuC+yt0ZeKyRUY4QhdrJJ4tJ1wg3Hu6kDsbovxupTMkGdRrm8oZSoYPbJ+PwH/xotgTdkA1205vUEfnqkI04T/fnnd1fiZW5AwNcggd7fi4j5zasmcntZexIxqFZQMzMJpfndmI5jn17cgn5EV5t9XN0C///8Q9wlJpMGXdoiaMTG2sVyHQsn8mWRISCLNG777S0OuDRP2GlLcJ2UeOg7Fo8hTNPeJ//iTJhyqxhKRUntdXOihq2wfKfH///8B0GGrwT+fSOQRdctKxjjGCSS11d6BlQ9BDfE0J6Z25FaNTKGpFKNCMr2G/041KpWwBLVe1k08vncseQbKZdXi8x1t9XA45U/Wd43D9wAh3Tal0aiLVzGPusOZ1F+W3TWoqlX/A95+dNef11TsuGful+ctGssldk3fqpfqh+43XTxL42+leSHoF/dWHYGX6maqUEuLX7UB+r/6Llr4LKocbVIeu+hB9QTPfz9fCP8RyWmX4SmbhMFsNtCijV7lVcwejLKlvl0GfCndnWV7/39VBrtTRuUx92oke3GBgKkC5fdGK0YvNK+xenKaDmsHDjNFUM3NMz3ZiXXFuLgojosPVCDEl2W5BjX3Ms+j0GSqACHmh0+RPWyuNm/Qe8vFf9AW7N1uRaxWirrUytqEJnJ4/Flm8hSoiZ2NQBsS6w/yQlC4gCaFo8q4nyY6AFdo4hiwhBXzbNKKvZvktCjSCukRR/BbYVbNwZi2Yh3hGodEacLW8qijiWJODf0P2bhfaiPspPT4lYJBgi/KfcFwCfvyUIgkJOv///8CG/JEepRBLaMFE+2TgrqsJXOVOWHt6g/bFwVLLMVBsMR50dis/39/AlBX+/rMTJkUQrnlxpR2iu0Tp8tATkRYGmDIrcAiRP8PjoWIlb7/0ecTdSCE9Y58+a+n/FovJQTVF4F2jAxMZhTgrM/KVS5BQu6bVbkWY5HXnxRshks3urDdW4RkWp4M4TeLmFK5KF/uHkkiO5Kv96RioH984v/CSDBnG+BwlnU9B+o7Y+0X0Nob+0pLsStxjvPXMy2eCpzhOWV4XbObBHN4UE2sLQ/DIqXhOzxVf38GlTi6aG7EnePO7TRJm9yOfUUcqq1I2iQHrVDqn3TUNRi/lMw8KbMW/3/nqCz/Ef8PoW5Qxcz2yHR/f78EPB2Stbd+ZFmfNTUYILzsb9YNhpaHcaymYrBiNHmFE3Y4ccYJ25Prqm7zHobGHED8/93ZNlWro9vcKivGZs31UiK1k5zjUhexUgbqJb+fUTjxce/7Zly8a5KMC1fX5nfjPgibdvzbXV1jRT2asXvmSAusaLdq1TSIJ8fXINk5AtT34EWPAsfP9IFQqM5K11O6saoHJA==";let Co=null;const L9=()=>{if(!Co){const r=atob(Xme);Co=Uint8Array.from(r,e=>e.charCodeAt(0))}},qme=()=>(L9(),Co);class Yme{constructor(e=0){this.seed=0,this.seed=e*4,L9()}_next(){this.seed=(this.seed+4)%Co.length}value(){return this._next(),Co[this.seed]/255}vec4(e=new ce){return this._next(),e.set(Co[this.seed],Co[this.seed+1],Co[this.seed+2],Co[this.seed+3]).mulScalar(1/255)}}const Kme=[new O(-1,0,0),new O(1,0,0),new O(0,-1,0),new O(0,1,0),new O(0,0,-1),new O(0,0,1)];class Zme{update(e,t){const i=this.colors,{r:s,g:n,b:a}=e;for(let o=0;o<6;o++)i[o*3]=s,i[o*3+1]=n,i[o*3+2]=a;for(let o=0;o<t.length;o++){const l=t[o];if(l._type===Me)for(let c=0;c<6;c++){const u=Math.max(Kme[c].dot(l._direction),0)*l._intensity,h=l._color;i[c*3]+=h.r*u,i[c*3+1]+=h.g*u,i[c*3+2]+=h.b*u}}}constructor(){this.colors=new Float32Array(6*3)}}const Qme=(r,e,t,i)=>{const s=new we(r,{name:`${e}${t}`,width:t,height:t,format:ct,addressU:zi,addressV:zi,type:qa,magFilter:qe,minFilter:qe,anisotropy:1,mipmaps:!1});return s.lock().set(i),s.unlock(),s},Jme=new jr,ege=r=>Jme.get(r,()=>{const e=qme(),t=Math.sqrt(e.length/4);return Qme(r,"BlueNoise",t,e)});class _h{constructor(e,t){this.texture=e,this.cached=!1,this.renderTargets=t}destroy(){this.texture&&(this.texture.destroy(),this.texture=null);const e=this.renderTargets;for(let t=0;t<e.length;t++)e[t].destroy();this.renderTargets.length=0}static create(e,t){let i=null;return t._type===Pt?i=this.createCubemap(e,t._shadowResolution,t._shadowType):i=this.create2dMap(e,t._shadowResolution,t._shadowType),i}static createAtlas(e,t,i){const s=this.create2dMap(e,t,i),n=s.renderTargets,a=n[0];for(let o=0;o<5;o++)n.push(a);return s}static create2dMap(e,t,i){var u;const s=Vo.get(i);let n=s.format;n===sl&&!e.textureFloatRenderable&&e.textureHalfFloatRenderable&&(n=mE);const a=(u=Ua.get(n))==null?void 0:u.name;let o=_i;i===w3&&(o=e.extTextureFloatLinear?_i:qe),i===iv&&(o=qe);const l=new we(e,{format:n,width:t,height:t,mipmaps:!1,minFilter:o,magFilter:o,addressU:ge,addressV:ge,name:`ShadowMap2D_${a}`});let c=null;return s!=null&&s.pcf?(l.compareOnRead=!0,l.compareFunc=ob,c=new Zi({depthBuffer:l})):c=new Zi({colorBuffer:l,depth:!0}),e.isWebGPU&&(c.flipY=!0),new _h(l,[c])}static createCubemap(e,t,i){var u;const s=Vo.get(i),n=(u=Ua.get(s.format))==null?void 0:u.name,a=i===iv,o=a?qe:_i,l=new we(e,{format:s==null?void 0:s.format,width:t,height:t,cubemap:!0,mipmaps:!1,minFilter:o,magFilter:o,addressU:ge,addressV:ge,name:`ShadowMapCube_${n}`});a||(l.compareOnRead=!0,l.compareFunc=ob);const c=[];for(let h=0;h<6;h++)a?c.push(new Zi({colorBuffer:l,face:h,depth:!0})):c.push(new Zi({depthBuffer:l,face:h}));return new _h(l,c)}}const tge=[],ige=[],io=new ce,mC=new ce;let gC=class{constructor(e){this.size=Math.floor(e.w*1024),this.used=!1,this.lightId=-1,this.rect=e}};class rge{constructor(e){this.device=e,this.version=1,this.shadowAtlasResolution=2048,this.shadowAtlas=null,this.shadowEdgePixels=3,this.cookieAtlasResolution=4,this.cookieAtlas=new we(this.device,{name:"CookieAtlas",width:this.cookieAtlasResolution,height:this.cookieAtlasResolution,format:Ms,cubemap:!1,mipmaps:!1,minFilter:qe,magFilter:qe,addressU:ge,addressV:ge}),this.cookieRenderTarget=new Zi({colorBuffer:this.cookieAtlas,depth:!1,flipY:!0}),this.slots=[],this.atlasSplit=[],this.cubeSlotsOffsets=[new ee(0,0),new ee(0,1),new ee(1,0),new ee(1,1),new ee(2,0),new ee(2,1)],this.scissorVec=new ce,this.allocateShadowAtlas(1),this.allocateCookieAtlas(1),this.allocateUniforms()}destroy(){this.destroyShadowAtlas(),this.destroyCookieAtlas()}destroyShadowAtlas(){var e;(e=this.shadowAtlas)==null||e.destroy(),this.shadowAtlas=null}destroyCookieAtlas(){var e,t;(e=this.cookieAtlas)==null||e.destroy(),this.cookieAtlas=null,(t=this.cookieRenderTarget)==null||t.destroy(),this.cookieRenderTarget=null}allocateShadowAtlas(e,t=Un){var n;const i=(n=this.shadowAtlas)==null?void 0:n.texture.format,s=Vo.get(t).format;if(!this.shadowAtlas||this.shadowAtlas.texture.width!==e||i!==s){this.version++,this.destroyShadowAtlas(),this.shadowAtlas=_h.createAtlas(this.device,e,t),this.shadowAtlas.cached=!0;const a=4/this.shadowAtlasResolution;this.scissorVec.set(a,a,-2*a,-2*a)}}allocateCookieAtlas(e){this.cookieAtlas.width!==e&&(this.cookieRenderTarget.resize(e,e),this.version++)}allocateUniforms(){this._shadowAtlasTextureId=this.device.scope.resolve("shadowAtlasTexture"),this._shadowAtlasParamsId=this.device.scope.resolve("shadowAtlasParams"),this._shadowAtlasParams=new Float32Array(2),this._cookieAtlasTextureId=this.device.scope.resolve("cookieAtlasTexture")}updateUniforms(){const t=this.shadowAtlas.renderTargets[0].depthBuffer;this._shadowAtlasTextureId.setValue(t),this._shadowAtlasParams[0]=this.shadowAtlasResolution,this._shadowAtlasParams[1]=this.shadowEdgePixels,this._shadowAtlasParamsId.setValue(this._shadowAtlasParams),this._cookieAtlasTextureId.setValue(this.cookieAtlas)}subdivide(e,t){let i=t.atlasSplit;if(!i){const n=Math.ceil(Math.sqrt(e));i=ige,i[0]=n,i.length=1}if(!((n,a)=>n.length===a.length&&n.every((o,l)=>o===a[l]))(i,this.atlasSplit)){this.version++,this.slots.length=0,this.atlasSplit.length=0,this.atlasSplit.push(...i);const n=this.atlasSplit[0];if(n>1){const a=1/n;for(let o=0;o<n;o++)for(let l=0;l<n;l++){const c=new ce(o*a,l*a,a,a),u=this.atlasSplit[1+o*n+l];if(u>1)for(let h=0;h<u;h++)for(let d=0;d<u;d++){const f=a/u,p=new ce(c.x+h*f,c.y+d*f,f,f);this.slots.push(new gC(p))}else this.slots.push(new gC(c))}}else this.slots.push(new gC(new ce(0,0,1,1)));this.slots.sort((a,o)=>o.size-a.size)}}collectLights(e,t){const i=t.cookiesEnabled,s=t.shadowsEnabled;let n=!1,a=!1;const o=tge;return o.length=0,(i||s)&&(c=>{for(let u=0;u<c.length;u++){const h=c[u];if(h.visibleThisFrame){const d=s&&h.castShadows,f=i&&!!h.cookie;n||(n=d),a||(a=f),(d||f)&&o.push(h)}}})(e),o.sort((c,u)=>u.maxScreenSize-c.maxScreenSize),n&&this.allocateShadowAtlas(this.shadowAtlasResolution,t.shadowType),a&&this.allocateCookieAtlas(this.cookieAtlasResolution),(n||a)&&this.subdivide(o.length,t),o}setupSlot(e,t){e.atlasViewport.copy(t);const i=e.numShadowFaces;for(let s=0;s<i;s++)if(e.castShadows||e._cookie){if(io.copy(t),mC.copy(t),e._type===Rt&&io.add(this.scissorVec),e._type===Pt){const n=io.z/3,a=this.cubeSlotsOffsets[s];io.x+=n*a.x,io.y+=n*a.y,io.z=n,io.w=n,mC.copy(io)}if(e.castShadows){const n=e.getRenderData(null,s);n.shadowViewport.copy(io),n.shadowScissor.copy(mC)}}}assignSlot(e,t,i){e.atlasViewportAllocated=!0;const s=this.slots[t];s.lightId=e.id,s.used=!0,i&&(e.atlasSlotUpdated=!0,e.atlasVersion=this.version,e.atlasSlotIndex=t)}update(e,t){this.shadowAtlasResolution=t.shadowAtlasResolution,this.cookieAtlasResolution=t.cookieAtlasResolution;const i=this.collectLights(e,t);if(i.length>0){const s=this.slots;for(let o=0;o<s.length;o++)s[o].used=!1;const n=Math.min(i.length,s.length);for(let o=0;o<n;o++){const l=i[o];l.castShadows&&(l._shadowMap=this.shadowAtlas);const c=s[l.atlasSlotIndex];if(l.atlasVersion===this.version&&l.id===(c==null?void 0:c.lightId)){const u=s[l.atlasSlotIndex];u.size===s[o].size&&!u.used&&this.assignSlot(l,l.atlasSlotIndex,!1)}}let a=0;for(let o=0;o<n;o++){for(;a<s.length&&s[a].used;)a++;const l=i[o];l.atlasViewportAllocated||this.assignSlot(l,a,!0);const c=s[l.atlasSlotIndex];this.setupSlot(l,c.rect)}}this.updateUniforms()}}const ts=[];ts[h3]={src:br,dst:br,op:Pde};ts[an]={src:br,dst:PO,op:Gn};ts[Ka]={src:IO,dst:MO,op:Gn,alphaSrc:br};ts[fh]={src:br,dst:MO,op:Gn};ts[d3]={src:br,dst:br,op:Gn};ts[p3]={src:IO,dst:br,op:Gn};ts[m3]={src:dq,dst:Ade,op:Gn};ts[g3]={src:Cde,dst:br,op:Gn};ts[f3]={src:dq,dst:PO,op:Gn};ts[_3]={src:br,dst:br,op:Ide};ts[v3]={src:br,dst:br,op:Mde};let sge=0;class My{constructor(){this.meshInstances=[],this.name="Untitled",this.userId="",this.id=sge++,this.variants=new Map,this.defines=new Map,this._definesDirty=!1,this.parameters={},this.alphaTest=0,this.alphaToCoverage=!1,this._blendState=new sr,this._depthState=new Ds,this.cull=oh,this.stencilFront=null,this.stencilBack=null,this._shaderChunks=null,this._oldChunks={},this._dirtyShader=!0,this._shaderVersion=0,this._scene=null,this.dirty=!0}get hasShaderChunks(){return this._shaderChunks!=null}get shaderChunks(){return this._shaderChunks||(this._shaderChunks=new $e),this._shaderChunks}getShaderChunks(e=dt){const t=this.shaderChunks;return e===dt?t.glsl:t.wgsl}set shaderChunksVersion(e){this.shaderChunks.version=e}get shaderChunksVersion(){return this.shaderChunks.version}set chunks(e){this._oldChunks=e}get chunks(){return Object.assign(this._oldChunks,Object.fromEntries(this.shaderChunks.glsl)),this._oldChunks}set depthBias(e){this._depthState.depthBias=e}get depthBias(){return this._depthState.depthBias}set slopeDepthBias(e){this._depthState.depthBiasSlope=e}get slopeDepthBias(){return this._depthState.depthBiasSlope}set redWrite(e){this._blendState.redWrite=e}get redWrite(){return this._blendState.redWrite}set greenWrite(e){this._blendState.greenWrite=e}get greenWrite(){return this._blendState.greenWrite}set blueWrite(e){this._blendState.blueWrite=e}get blueWrite(){return this._blendState.blueWrite}set alphaWrite(e){this._blendState.alphaWrite=e}get alphaWrite(){return this._blendState.alphaWrite}get transparent(){return this._blendState.blend}_updateTransparency(){const e=this.transparent,t=this.meshInstances;for(let i=0;i<t.length;i++)t[i].transparent=e}set blendState(e){this._blendState.copy(e),this._updateTransparency()}get blendState(){return this._blendState}set blendType(e){const t=ts[e];this._blendState.setColorBlend(t.op,t.src,t.dst),this._blendState.setAlphaBlend(t.alphaOp??t.op,t.alphaSrc??t.src,t.alphaDst??t.dst);const i=e!==an;this._blendState.blend!==i&&(this._blendState.blend=i,this._updateTransparency()),this._updateMeshInstanceKeys()}get blendType(){if(!this.transparent)return an;const{colorOp:e,colorSrcFactor:t,colorDstFactor:i,alphaOp:s,alphaSrcFactor:n,alphaDstFactor:a}=this._blendState;for(let o=0;o<ts.length;o++){const l=ts[o];if(l.src===t&&l.dst===i&&l.op===e&&l.src===n&&l.dst===a&&l.op===s)return o}return Ka}set depthState(e){this._depthState.copy(e)}get depthState(){return this._depthState}set depthTest(e){this._depthState.test=e}get depthTest(){return this._depthState.test}set depthFunc(e){this._depthState.func=e}get depthFunc(){return this._depthState.func}set depthWrite(e){this._depthState.write=e}get depthWrite(){return this._depthState.write}copy(e){var t,i;this.name=e.name,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this._blendState.copy(e._blendState),this._depthState.copy(e._depthState),this.cull=e.cull,this.stencilFront=(t=e.stencilFront)==null?void 0:t.clone(),e.stencilBack&&(this.stencilBack=e.stencilFront===e.stencilBack?this.stencilFront:e.stencilBack.clone()),this.clearParameters();for(const s in e.parameters)e.parameters.hasOwnProperty(s)&&this._setParameterSimple(s,e.parameters[s].data);return this.defines.clear(),e.defines.forEach((s,n)=>this.defines.set(n,s)),this._shaderChunks=e.hasShaderChunks?new $e:null,(i=this._shaderChunks)==null||i.copy(e._shaderChunks),this}clone(){return new this.constructor().copy(this)}_updateMeshInstanceKeys(){const e=this.meshInstances;for(let t=0;t<e.length;t++)e[t].updateKey()}updateUniforms(e,t){this._dirtyShader&&this.clearVariants()}getShaderVariant(e){}update(){var e,t;if(Object.keys(this._oldChunks).length>0)for(const[i,s]of Object.entries(this._oldChunks))this.shaderChunks.glsl.set(i,s),delete this._oldChunks[i];(this._definesDirty||(e=this._shaderChunks)!=null&&e.isDirty())&&(this._definesDirty=!1,(t=this._shaderChunks)==null||t.resetDirty(),this.clearVariants()),this.dirty=!0}clearParameters(){this.parameters={}}getParameters(){return this.parameters}clearVariants(){this.variants.clear();const e=this.meshInstances,t=e.length;for(let i=0;i<t;i++)e[i].clearShaders()}getParameter(e){return this.parameters[e]}_setParameterSimple(e,t){const i=this.parameters[e];i?i.data=t:this.parameters[e]={scopeId:null,data:t}}setParameter(e,t){if(t===void 0&&typeof e=="object"){const i=e;if(i.length){for(let s=0;s<i.length;s++)this.setParameter(i[s]);return}e=i.name,t=i.value}this._setParameterSimple(e,t)}deleteParameter(e){this.parameters[e]&&delete this.parameters[e]}setParameters(e,t){const i=this.parameters;t===void 0&&(t=i);for(const s in t){const n=i[s];n&&(n.scopeId||(n.scopeId=e.scope.resolve(s)),n.scopeId.setValue(n.data))}}setDefine(e,t){let i=!1;const{defines:s}=this;t!==void 0&&t!==!1?(i=!s.has(e)||s.get(e)!==t,s.set(e,t)):(i=s.has(e),s.delete(e)),this._definesDirty||(this._definesDirty=i)}getDefine(e){return this.defines.has(e)}destroy(){this.variants.clear();for(let e=0;e<this.meshInstances.length;e++){const t=this.meshInstances[e];if(t.clearShaders(),t._material=null,t.mesh){const i=Py(t.mesh.device);this!==i&&(t.material=i)}}this.meshInstances.length=0}addMeshInstanceRef(e){this.meshInstances.push(e)}removeMeshInstanceRef(e){const t=this.meshInstances,i=t.indexOf(e);i!==-1&&t.splice(i,1)}}class nge{constructor(){this.cache=new Map}destroy(){this.clear(),this.cache=null}clear(){this.cache.forEach(e=>{e.forEach(t=>{t.destroy()})}),this.cache.clear()}getKey(e){const t=e._type===Pt,i=e._shadowType,s=e._shadowResolution;return`${t}-${i}-${s}`}get(e,t){const i=this.getKey(t),s=this.cache.get(i);if(s&&s.length)return s.pop();const n=_h.create(e,t);return n.cached=!0,n}add(e,t){const i=this.getKey(e),s=this.cache.get(i);s?s.push(t):this.cache.set(i,[t])}}class age extends dn{constructor(e,t,i,s,n){super(e),this.requiresCubemaps=!1,this.shadowRenderer=t,this.light=i,this.face=s,this.applyVsm=n,this.shadowCamera=t.prepareFace(i,null,s),t.setupRenderPass(this,this.shadowCamera,!0)}execute(){this.shadowRenderer.renderFace(this.light,null,this.face,!1)}after(){this.applyVsm&&this.shadowRenderer.renderVsm(this.light,this.shadowCamera)}}class oge{constructor(e,t){this.shadowLights=[],this.renderer=e,this.shadowRenderer=t,this.device=e.device}cull(e,t,i=null){const s=this.renderer.scene.clusteredLightingEnabled;e.visibleThisFrame=!0,s||e._shadowMap||(e._shadowMap=_h.create(this.device,e));const n=e._type,a=n===Rt?1:6;for(let o=0;o<a;o++){const l=e.getRenderData(null,o),c=l.shadowCamera;c.nearClip=e.attenuationEnd/1e3,c.farClip=e.attenuationEnd;const u=c._node,h=e._node;if(u.setPosition(h.getPosition()),n===Rt)c.fov=e._outerConeAngle*2,u.setRotation(h.getRotation()),u.rotateLocal(-90,0,0);else if(n===Pt)if(s){const p=2/(this.shadowRenderer.lightTextureAtlas.shadowAtlasResolution*e.atlasViewport.z/3)*this.shadowRenderer.lightTextureAtlas.shadowEdgePixels;c.fov=Math.atan(1+p)*Q.RAD_TO_DEG*2}else c.fov=90;this.renderer.updateCameraFrustum(c),this.shadowRenderer.cullShadowCasters(t,e,l.visibleCasters,c,i)}}prepareLights(e,t){let i;for(let s=0;s<t.length;s++){const n=t[s];if(this.shadowRenderer.needsShadowRendering(n)&&n.atlasViewportAllocated){e.push(n);for(let a=0;a<n.numShadowFaces;a++)i=this.shadowRenderer.prepareFace(n,null,a)}}return i}buildNonClusteredRenderPasses(e,t){for(let i=0;i<t.length;i++){const s=t[i];if(this.shadowRenderer.needsShadowRendering(s)){const n=s._type===Rt,a=s.numShadowFaces;for(let o=0;o<a;o++){const l=new age(this.device,this.shadowRenderer,s,o,n);e.addRenderPass(l)}}}}}class lge extends dn{constructor(e,t,i,s,n){super(e),this.shadowRenderer=t,this.light=i,this.camera=s,this.allCascadesRendering=n}execute(){const{light:e,camera:t,shadowRenderer:i,allCascadesRendering:s}=this,n=e.numShadowFaces,a=e.shadowUpdateOverrides;for(let o=0;o<n;o++)(a==null?void 0:a[o])!==on&&i.renderFace(e,t,o,!s),(a==null?void 0:a[o])===pc&&(a[o]=on)}after(){this.shadowRenderer.renderVsm(this.light,this.camera)}}const j0=new We,ro=new O,zU=new se,yt=[new O,new O,new O,new O,new O,new O,new O,new O],_C={min:0,max:0};function cge(r,e,t){yt[0].x=yt[1].x=yt[2].x=yt[3].x=e.x,yt[1].y=yt[3].y=yt[7].y=yt[5].y=e.y,yt[2].z=yt[3].z=yt[6].z=yt[7].z=e.z,yt[4].x=yt[5].x=yt[6].x=yt[7].x=t.x,yt[0].y=yt[2].y=yt[4].y=yt[6].y=t.y,yt[0].z=yt[1].z=yt[4].z=yt[5].z=t.z;let i=9999999999,s=-9999999999;for(let n=0;n<8;++n){r.transformPoint(yt[n],yt[n]);const a=yt[n].z;a<i&&(i=a),a>s&&(s=a)}return _C.min=i,_C.max=s,_C}class uge{constructor(e,t){this.renderer=e,this.shadowRenderer=t,this.device=e.device}cull(e,t,i,s=null){e.visibleThisFrame=!0,e._shadowMap||(e._shadowMap=_h.create(this.device,e));const n=i._nearClip;this.generateSplitDistances(e,n,Math.min(i._farClip,e.shadowDistance));const a=e.shadowUpdateOverrides;for(let o=0;o<e.numCascades&&(a==null?void 0:a[o])!==on;o++){const l=e.getRenderData(i,o),c=l.shadowCamera;c.renderTarget=e._shadowMap.renderTargets[0],l.shadowViewport.copy(e.cascades[o]),l.shadowScissor.copy(e.cascades[o]);const u=c._node,h=e._node;u.setPosition(h.getPosition()),u.setRotation(h.getRotation()),u.rotateLocal(-90,0,0);const d=o===0?n:e._shadowCascadeDistances[o-1],f=e._shadowCascadeDistances[o],p=i.getFrustumCorners(d,f);ro.set(0,0,0);const m=i.node.getWorldTransform();for(let k=0;k<8;k++)m.transformPoint(p[k],p[k]),ro.add(p[k]);ro.mulScalar(1/8);let g=0;for(let k=0;k<8;k++){const V=p[k].sub(ro).length();V>g&&(g=V)}const _=u.right,v=u.up,y=u.forward,x=.25*e._shadowResolution/g,S=Math.ceil(ro.dot(v)*x)/x,w=Math.ceil(ro.dot(_)*x)/x,T=v.mulScalar(S),A=_.mulScalar(w),C=ro.dot(y),P=y.mulScalar(C);ro.add2(T,A).add(P),u.setPosition(ro),u.translateLocal(0,0,1e6),c.nearClip=.01,c.farClip=2e6,c.orthoHeight=g,this.renderer.updateCameraFrustum(c),this.shadowRenderer.cullShadowCasters(t,e,l.visibleCasters,c,s);let I=!0;const M=l.visibleCasters;for(let k=0;k<M.length;k++){const V=M[k];I?(I=!1,j0.copy(V.aabb)):j0.add(V.aabb)}zU.copy(u.getWorldTransform()).invert();const N=cge(zU,j0.getMin(),j0.getMax());u.translateLocal(0,0,N.max+.1),c.farClip=N.max-N.min+.2,l.projectionCompensation=g}}generateSplitDistances(e,t,i){e._shadowCascadeDistances.fill(i);for(let s=1;s<e.numCascades;s++){const n=s/e.numCascades,a=t+(i-t)*n,o=t*(i/t)**n,l=Q.lerp(a,o,e.cascadeDistribution);e._shadowCascadeDistances[s-1]=l}}getLightRenderPass(e,t){let i=null;if(this.shadowRenderer.needsShadowRendering(e)){const s=e.numShadowFaces,n=e.shadowUpdateOverrides;let a=!0,o;for(let l=0;l<s;l++)(n==null?void 0:n[l])===on&&(a=!1),o=this.shadowRenderer.prepareFace(e,t,l);i=new lge(this.device,this.shadowRenderer,e,t,a),this.shadowRenderer.setupRenderPass(i,o,a)}return i}}const vC=new Set,VU=new se,jU=new se,jc=new Float32Array(2),Ym=new ce(1,1,0,0),$U=new se;function hge(r,e){return Math.exp(-(r*r)/(2*e*e))}function dge(r){const e=(r-1)/6,t=(r-1)*.5,i=new Array(r);let s=0;for(let n=0;n<r;++n)i[n]=hge(n-t,e),s+=i[n];for(let n=0;n<r;++n)i[n]/=s;return i}class O9{constructor(e,t){this.shadowPassCache=[],this.device=e.device,this.renderer=e,this.lightTextureAtlas=t;const i=this.device.scope;this.sourceId=i.resolve("source"),this.pixelOffsetId=i.resolve("pixelOffset"),this.weightId=i.resolve("weight[0]"),this.blurVsmShader=[{},{}],this.blurVsmWeights={},this.shadowMapLightRadiusId=i.resolve("light_radius"),this.viewUniformFormat=null,this.viewBindGroupFormat=null,this.blendStateWrite=new sr,this.blendStateNoWrite=new sr,this.blendStateNoWrite.setColorWrite(!1,!1,!1,!1)}static createShadowCamera(e,t,i){const s=_p.create("ShadowCamera",t,i),n=Vo.get(e),a=(n==null?void 0:n.vsm)??!1,o=(n==null?void 0:n.pcf)??!1;return a?s.clearColor=new ae(0,0,0,0):s.clearColor=new ae(1,1,1,1),s.clearDepthBuffer=!0,s.clearStencilBuffer=!1,s.clearColorBuffer=!o,s}_cullShadowCastersInternal(e,t,i){const s=e.length;for(let n=0;n<s;n++){const a=e[n];a.castShadow&&(!a.cull||a._isVisible(i))&&(a.visibleThisFrame=!0,t.push(a))}}cullShadowCasters(e,t,i,s,n){var a,o;if((a=this.renderer.scene)==null||a.fire(C9,s),i.length=0,n)this._cullShadowCastersInternal(n,i,s);else{const l=e.layerList,c=l.length;for(let u=0;u<c;u++){const h=l[u];h._lightsSet.has(t)&&(vC.has(h)||(vC.add(h),this._cullShadowCastersInternal(h.shadowCasters,i,s)))}vC.clear()}i.sort(this.sortCompareShader),(o=this.renderer.scene)==null||o.fire(P9,s)}sortCompareShader(e,t){const i=e._sortKeyShadow,s=t._sortKeyShadow;return i===s?t.mesh.id-e.mesh.id:s-i}setupRenderState(e,t){const s=this.renderer.scene.clusteredLightingEnabled?t._isPcf:t._isPcf&&t._type!==Pt;e.setBlendState(s?this.blendStateNoWrite:this.blendStateWrite),e.setDepthState(t.shadowDepthState),e.setStencilState(null,null)}dispatchUniforms(e,t,i,s){const n=t._node;e._type!==Me&&(this.renderer.dispatchViewPos(n.getPosition()),this.shadowMapLightRadiusId.setValue(e.attenuationEnd)),VU.setTRS(n.getPosition(),n.getRotation(),O.ONE).invert(),jU.mul2(t.projectionMatrix,VU);const a=i.shadowViewport;t.rect=a,t.scissorRect=i.shadowScissor,$U.setViewport(a.x,a.y,a.z,a.w),i.shadowMatrix.mul2($U,jU),e._type===Me&&e._shadowMatrixPalette.set(i.shadowMatrix.data,s*16)}getShadowPass(e){var n;const t=e._type,i=e._shadowType;let s=(n=this.shadowPassCache[t])==null?void 0:n[i];if(!s){const a=`ShadowPass_${t}_${i}`;s=Va.get(this.device).allocate(a,{isShadow:!0,lightType:t,shadowType:i}),this.shadowPassCache[t]||(this.shadowPassCache[t]=[]),this.shadowPassCache[t][i]=s}return s.index}submitCasters(e,t,i){var d;const s=this.device,n=this.renderer,a=n.scene,o=1<<A9,l=this.getShadowPass(t),c=i.shaderParams,u=i.renderTarget.flipY?-1:1,h=e.length;for(let f=0;f<h;f++){const p=e[f],m=p.mesh,g=p.instancingData;if(g&&g.count<=0)continue;p.ensureMaterial(s);const _=p.material;n.setBaseConstants(s,_),n.setSkinning(s,p),_.dirty&&(_.updateUniforms(s,a),_.dirty=!1),n.setupCullMode(!0,u,p),_.setParameters(s),p.setParameters(s,o);const v=p.getShaderInstance(l,0,a,c,this.viewUniformFormat,this.viewBindGroupFormat),y=v.shader;if(y.failed)continue;p._sortKeyShadow=y.id,s.setShader(y),n.setVertexBuffers(s,m),n.setMorphing(s,p.morphInstance),g&&s.setVertexBuffer(g.vertexBuffer),n.setMeshInstanceMatrices(p),n.setupMeshUniformBuffers(v);const x=p.renderStyle,S=(d=p.indirectData)==null?void 0:d.get(i);s.draw(m.primitive[x],m.indexBuffer[x],g==null?void 0:g.count,S),n._shadowDrawCalls++,g&&n._instancedDrawCalls++}}needsShadowRendering(e){const t=e.enabled&&e.castShadows&&e.shadowUpdateMode!==on&&e.visibleThisFrame;return e.shadowUpdateMode===pc&&(e.shadowUpdateMode=on),t&&(this.renderer._shadowMapUpdates+=e.numShadowFaces),t}getLightRenderData(e,t,i){return e.getRenderData(e._type===Me?t:null,i)}setupRenderPass(e,t,i){const s=t.renderTarget;e.init(s),e.depthStencilOps.clearDepthValue=1,e.depthStencilOps.clearDepth=i,s.depthBuffer?e.depthStencilOps.storeDepth=!0:(e.colorOps.clearValue.copy(t.clearColor),e.colorOps.clear=i,e.depthStencilOps.storeDepth=!1),e.requiresCubemaps=!1}prepareFace(e,t,i){const s=e._type,a=this.getLightRenderData(e,t,i).shadowCamera,o=s===Me?0:i;return a.renderTarget=e._shadowMap.renderTargets[o],a}renderFace(e,t,i,s,n=!0){const a=this.device,o=this.getLightRenderData(e,t,i),l=o.shadowCamera;this.dispatchUniforms(e,l,o,i);const c=l.renderTarget,u=this.renderer;u.setCameraUniforms(l,c),a.supportsUniformBuffers&&u.setupViewUniformBuffers(o.viewBindGroups,this.viewUniformFormat,this.viewBindGroupFormat,null),n?(u.setupViewport(l,c),s&&u.clear(l)):u.clearView(l,c,!0,!1),this.setupRenderState(a,e),this.submitCasters(o.visibleCasters,e,l)}render(e,t,i=!0){if(this.needsShadowRendering(e)){const s=e.numShadowFaces;for(let n=0;n<s;n++)this.prepareFace(e,t,n),this.renderFace(e,t,n,!0,i);this.renderVsm(e,t)}}renderVsm(e,t){e._isVsm&&e._vsmBlurSize>1&&(!this.renderer.scene.clusteredLightingEnabled||e._type===Me)&&this.applyVsmBlur(e,t)}getVsmBlurShader(e,t){const i=this.blurVsmShader;let s=i[e][t];if(!s){this.blurVsmWeights[t]=dge(t);const n=new Map;n.set("{SAMPLES}",t),e===1&&n.set("GAUSS",""),s=Tr.createShader(this.device,{uniqueName:`blurVsm${e}${t}`,attributes:{vertex_position:Xe},vertexChunk:"fullscreenQuadVS",fragmentChunk:"blurVSMPS",fragmentDefines:n}),i[e][t]=s}return s}applyVsmBlur(e,t){const i=this.device;i.setBlendState(sr.NOBLEND);const a=e.getRenderData(e._type===Me?t:null,0).shadowCamera.renderTarget,o=this.renderer.shadowMapCache.get(i,e),l=o.renderTargets[0],c=e.vsmBlurMode,u=e._vsmBlurSize,h=this.getVsmBlurShader(c,u);Ym.z=e._shadowResolution-2,Ym.w=Ym.z,this.sourceId.setValue(a.colorBuffer),jc[0]=1/e._shadowResolution,jc[1]=0,this.pixelOffsetId.setValue(jc),c===T3&&this.weightId.setValue(this.blurVsmWeights[u]),Tc(i,l,h,null,Ym),this.sourceId.setValue(l.colorBuffer),jc[1]=jc[0],jc[0]=0,this.pixelOffsetId.setValue(jc),Tc(i,a,h,null,Ym),this.renderer.shadowMapCache.add(e,o)}initViewBindGroupFormat(){this.device.supportsUniformBuffers&&!this.viewUniformFormat&&(this.viewUniformFormat=new Zq(this.device,[new ci("matrix_viewProjection",Aa)]),this.viewBindGroupFormat=new Xq(this.device,[new a3(n3,kq|Fq)]))}frameUpdate(){this.initViewBindGroupFormat()}}const $0=[];class fge{constructor(e){this._empty=null,this._allocated=[],this._clusters=new Map,this.device=e}destroy(){this._empty&&(this._empty.destroy(),this._empty=null),this._allocated.forEach(e=>{e.destroy()}),this._allocated.length=0}get count(){return this._allocated.length}get empty(){if(!this._empty){const e=new IM(this.device);e.name="ClusterEmpty",e.update([]),this._empty=e}return this._empty}assign(e){const t=this.empty;$0.push(...this._allocated),this._allocated.length=0,this._clusters.clear();const i=e.length;for(let s=0;s<i;s++){const a=e[s].renderActions;if(a){const o=a.length;for(let l=0;l<o;l++){const c=a[l];c.lightClusters=null;const u=c.layer;if(u.hasClusteredLights&&u.meshInstances.length){const h=u.getLightIdHash(),d=this._clusters.get(h);let f=d==null?void 0:d.lightClusters;f||(f=$0.pop()??new IM(this.device),this._allocated.push(f),this._clusters.set(h,c)),c.lightClusters=f}c.lightClusters||(c.lightClusters=t)}}}$0.forEach(s=>s.destroy()),$0.length=0}update(e,t){this.assign(e),this._clusters.forEach(i=>{const s=i.layer;i.lightClusters.update(s.clusteredLightsSet,t)})}}const vl=new ce,yC=[];class k3 extends dn{constructor(e,t){super(e),this._quadRenderer2D=null,this._quadRendererCube=null,this._filteredLights=[],this._forceCopy=!1,this._evtDeviceRestored=null,this._cubeSlotsOffsets=t,this.requiresCubemaps=!1,this.blitTextureId=e.scope.resolve("blitTexture"),this.invViewProjId=e.scope.resolve("invViewProj"),this._evtDeviceRestored=e.on("devicerestored",this.onDeviceRestored,this)}destroy(){var e,t,i;(e=this._quadRenderer2D)==null||e.destroy(),this._quadRenderer2D=null,(t=this._quadRendererCube)==null||t.destroy(),this._quadRendererCube=null,(i=this._evtDeviceRestored)==null||i.off(),this._evtDeviceRestored=null}static create(e,t){const i=new k3(e.device,t);return i.init(e),i.colorOps.clear=!1,i.depthStencilOps.clearDepth=!1,i}onDeviceRestored(){this._forceCopy=!0}update(e){const t=this._filteredLights;this.filter(e,t),this.executeEnabled=t.length>0}filter(e,t){for(let i=0;i<e.length;i++){const s=e[i];s._type!==Me&&s.atlasViewportAllocated&&(!s.atlasSlotUpdated&&!this._forceCopy||s.enabled&&s.cookie&&s.visibleThisFrame&&t.push(s))}this._forceCopy=!1}initInvViewProjMatrices(){if(!yC.length)for(let e=0;e<6;e++){const t=_p.create(null,Pt,e),i=t.projectionMatrix,s=t.node.getLocalTransform().clone().invert();yC[e]=new se().mul2(i,s).invert()}}get quadRenderer2D(){if(!this._quadRenderer2D){const e=Tr.createShader(this.device,{uniqueName:"cookieRenderer2d",attributes:{vertex_position:Xe},vertexChunk:"cookieBlitVS",fragmentChunk:"cookieBlit2DPS"});this._quadRenderer2D=new xb(e)}return this._quadRenderer2D}get quadRendererCube(){if(!this._quadRendererCube){const e=Tr.createShader(this.device,{uniqueName:"cookieRendererCube",attributes:{vertex_position:Xe},vertexChunk:"cookieBlitVS",fragmentChunk:"cookieBlitCubePS"});this._quadRendererCube=new xb(e)}return this._quadRendererCube}execute(){const e=this.device;e.setBlendState(sr.NOBLEND),e.setCullMode(Vi),e.setDepthState(Ds.NODEPTH),e.setStencilState();const t=this.renderTarget.colorBuffer.width,i=this._cubeSlotsOffsets,s=this._filteredLights;for(let n=0;n<s.length;n++){const a=s[n],o=a.numShadowFaces,l=o>1?this.quadRendererCube:this.quadRenderer2D;o>1&&this.initInvViewProjMatrices(),this.blitTextureId.setValue(a.cookie);for(let c=0;c<o;c++){if(vl.copy(a.atlasViewport),o>1){const u=vl.z/3,h=i[c];vl.x+=u*h.x,vl.y+=u*h.y,vl.z=u,vl.w=u,this.invViewProjId.setValue(yC[c].data)}vl.mulScalar(t),l.render(vl)}}s.length=0}}class pge extends dn{constructor(e,t,i){super(e),this.requiresCubemaps=!1,this.shadowRenderer=t,this.shadowRendererLocal=i}update(e){const t=this.shadowRendererLocal.shadowLights,i=this.shadowRendererLocal.prepareLights(t,e),s=t.length;this.enabled=s>0,s&&this.shadowRenderer.setupRenderPass(this,i,!1)}execute(){const e=this.shadowRendererLocal.shadowLights,t=e.length;for(let i=0;i<t;i++){const s=e[i];for(let n=0;n<s.numShadowFaces;n++)this.shadowRenderer.renderFace(s,null,n,!0)}e.length=0}}class mge extends dn{constructor(e,t,i,s,n){super(e),this.renderer=t,this.frameGraph=null,this.cookiesRenderPass=k3.create(n.cookieRenderTarget,n.cubeSlotsOffsets),this.beforePasses.push(this.cookiesRenderPass),this.shadowRenderPass=new pge(e,i,s),this.beforePasses.push(this.shadowRenderPass)}update(e,t,i,s,n){this.frameGraph=e,this.cookiesRenderPass.enabled=i,i&&this.cookiesRenderPass.update(s),this.shadowRenderPass.enabled=t,t&&this.shadowRenderPass.update(n)}destroy(){this.cookiesRenderPass.destroy(),this.cookiesRenderPass=null}execute(){const{renderer:e}=this,{scene:t}=e;e.worldClustersAllocator.update(this.frameGraph.renderPasses,t.lighting)}}let SC=0;const yl=new se,Sl=new se,td=new se,HU=new Ba,xC=new AO,GU=new se().setScale(1,-1,1),bC=new Set,wC=new Set,TC=new qq,WU=new se().set([1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1]),XU=[new ee(.5,.333333),new ee(.25,.666667),new ee(.75,.111111),new ee(.125,.444444),new ee(.625,.777778),new ee(.375,.222222),new ee(.875,.555556),new ee(.0625,.888889),new ee(.5625,.037037),new ee(.3125,.37037),new ee(.8125,.703704),new ee(.1875,.148148),new ee(.6875,.481481),new ee(.4375,.814815),new ee(.9375,.259259),new ee(.03125,.592593)],gge=new se,_ge=new se,vge=new se,yge=new se,Sge=new se,xge=new se,id=new Set,EC=[],AC=[];class bge{constructor(e){this.clustersDebugRendered=!1,this.processingMeshInstances=new Set,this.lights=[],this.localLights=[],this.cameraDirShadowLights=new Map,this.dirLightShadows=new Map,this.blueNoise=new Yme(123),this.device=e,this.scene=null,this.worldClustersAllocator=new fge(e),this.lightTextureAtlas=new rge(e),this.shadowMapCache=new nge,this.shadowRenderer=new O9(this,this.lightTextureAtlas),this._shadowRendererLocal=new oge(this,this.shadowRenderer),this._shadowRendererDirectional=new uge(this,this.shadowRenderer),this._renderPassUpdateClustered=new mge(this.device,this,this.shadowRenderer,this._shadowRendererLocal,this.lightTextureAtlas),this.viewUniformFormat=null,this.viewBindGroupFormat=null,this._skinTime=0,this._morphTime=0,this._cullTime=0,this._shadowMapTime=0,this._lightClustersTime=0,this._layerCompositionUpdateTime=0,this._shadowDrawCalls=0,this._skinDrawCalls=0,this._instancedDrawCalls=0,this._shadowMapUpdates=0,this._numDrawCallsCulled=0,this._camerasRendered=0,this._lightClusters=0;const t=e.scope;this.boneTextureId=t.resolve("texture_poseMap"),this.modelMatrixId=t.resolve("matrix_model"),this.normalMatrixId=t.resolve("matrix_normal"),this.viewInvId=t.resolve("matrix_viewInverse"),this.viewPos=new Float32Array(3),this.viewPosId=t.resolve("view_position"),this.projId=t.resolve("matrix_projection"),this.projSkyboxId=t.resolve("matrix_projectionSkybox"),this.viewId=t.resolve("matrix_view"),this.viewId3=t.resolve("matrix_view3"),this.viewProjId=t.resolve("matrix_viewProjection"),this.flipYId=t.resolve("projectionFlipY"),this.tbnBasis=t.resolve("tbnBasis"),this.nearClipId=t.resolve("camera_near"),this.farClipId=t.resolve("camera_far"),this.cameraParams=new Float32Array(4),this.cameraParamsId=t.resolve("camera_params"),this.viewIndexId=t.resolve("view_index"),this.viewIndexId.setValue(0),this.blueNoiseJitterVersion=0,this.blueNoiseJitterVec=new ce,this.blueNoiseJitterData=new Float32Array(4),this.blueNoiseJitterId=t.resolve("blueNoiseJitter"),this.blueNoiseTextureId=t.resolve("blueNoiseTex32"),this.alphaTestId=t.resolve("alpha_ref"),this.opacityMapId=t.resolve("texture_opacityMap"),this.exposureId=t.resolve("exposure"),this.twoSidedLightingNegScaleFactorId=t.resolve("twoSidedLightingNegScaleFactor"),this.twoSidedLightingNegScaleFactorId.setValue(0),this.morphPositionTex=t.resolve("morphPositionTex"),this.morphNormalTex=t.resolve("morphNormalTex"),this.morphTexParams=t.resolve("morph_tex_params"),this.lightCube=new Zme,this.constantLightCube=t.resolve("lightCube[0]")}destroy(){this.shadowRenderer=null,this._shadowRendererLocal=null,this._shadowRendererDirectional=null,this.shadowMapCache.destroy(),this.shadowMapCache=null,this._renderPassUpdateClustered.destroy(),this._renderPassUpdateClustered=null,this.lightTextureAtlas.destroy(),this.lightTextureAtlas=null}setupViewport(e,t){const i=this.device,s=t?t.width:i.width,n=t?t.height:i.height,a=e.rect;let o=Math.floor(a.x*s),l=Math.floor(a.y*n),c=Math.floor(a.z*s),u=Math.floor(a.w*n);if(i.setViewport(o,l,c,u),e._scissorRectClear){const h=e.scissorRect;o=Math.floor(h.x*s),l=Math.floor(h.y*n),c=Math.floor(h.z*s),u=Math.floor(h.w*n)}i.setScissor(o,l,c,u)}setCameraUniforms(e,t){var o,l;const i=t==null?void 0:t.flipY;let s=null;if(e.xr&&e.xr.session){const c=((l=(o=e._node)==null?void 0:o.parent)==null?void 0:l.getWorldTransform())||null;s=e.xr.views.list;for(let h=0;h<s.length;h++){const d=s[h];d.updateTransforms(c),e.frustum.setFromMat4(d.projViewOffMat)}}else{let c=e.projectionMatrix;e.calculateProjection&&e.calculateProjection(c,k0);let u=e.getProjectionMatrixSkybox();i&&(c=gge.mul2(GU,c),u=_ge.mul2(GU,u)),this.device.isWebGPU&&(c=vge.mul2(WU,c),u=yge.mul2(WU,u));const{jitter:h}=e;let d=0,f=0;if(h>0){const m=t?t.width:this.device.width,g=t?t.height:this.device.height,_=XU[this.device.renderVersion%XU.length];d=h*(_.x*2-1)/m,f=h*(_.y*2-1)/g,c=Sge.copy(c),c.data[8]=d,c.data[9]=f,u=xge.copy(u),u.data[8]=d,u.data[9]=f,this.blueNoiseJitterVersion!==this.device.renderVersion&&(this.blueNoiseJitterVersion=this.device.renderVersion,this.blueNoise.vec4(this.blueNoiseJitterVec))}const p=h>0?this.blueNoiseJitterVec:ce.ZERO;if(this.blueNoiseJitterData[0]=p.x,this.blueNoiseJitterData[1]=p.y,this.blueNoiseJitterData[2]=p.z,this.blueNoiseJitterData[3]=p.w,this.blueNoiseJitterId.setValue(this.blueNoiseJitterData),this.projId.setValue(c.data),this.projSkyboxId.setValue(u.data),e.calculateTransform)e.calculateTransform(Sl,k0);else{const m=e._node.getPosition(),g=e._node.getRotation();Sl.setTRS(m,g,O.ONE)}this.viewInvId.setValue(Sl.data),td.copy(Sl).invert(),this.viewId.setValue(td.data),HU.setFromMat4(td),this.viewId3.setValue(HU.data),yl.mul2(c,td),this.viewProjId.setValue(yl.data),e._storeShaderMatrices(yl,d,f,this.device.renderVersion),this.flipYId.setValue(i?-1:1),this.dispatchViewPos(e._node.getPosition()),e.frustum.setFromMat4(yl)}this.tbnBasis.setValue(i?-1:1);const n=e._nearClip,a=e._farClip;return this.nearClipId.setValue(n),this.farClipId.setValue(a),this.cameraParams[0]=1/a,this.cameraParams[1]=a,this.cameraParams[2]=n,this.cameraParams[3]=e.projection===Mf?1:0,this.cameraParamsId.setValue(this.cameraParams),this.exposureId.setValue(this.scene.physicalUnits?e.getExposure():this.scene.exposure),s}clear(e,t,i,s){const n=(t??e._clearColorBuffer?X_:0)|(i??e._clearDepthBuffer?q_:0)|(s??e._clearStencilBuffer?ab:0);n&&this.device.clear({color:[e._clearColor.r,e._clearColor.g,e._clearColor.b,e._clearColor.a],depth:e._clearDepth,stencil:e._clearStencil,flags:n})}setCamera(e,t,i,s=null){this.setCameraUniforms(e,t),this.clearView(e,t,i,!1)}clearView(e,t,i,s){const n=this.device;if(n.setRenderTarget(t),n.updateBegin(),s&&(n.setColorWrite(!0,!0,!0,!0),n.setDepthWrite(!0)),this.setupViewport(e,t),i){const a=e._clearOptions;n.clear(a||{color:[e._clearColor.r,e._clearColor.g,e._clearColor.b,e._clearColor.a],depth:e._clearDepth,flags:(e._clearColorBuffer?X_:0)|(e._clearDepthBuffer?q_:0)|(e._clearStencilBuffer?ab:0),stencil:e._clearStencil})}}setupCullMode(e,t,i){const s=i.material;let n=Vi;if(e){let a=1;(s.cull===Gg||s.cull===oh)&&(a=t*i.flipFacesFactor*i.node.worldScaleSign),a<0?n=s.cull===Gg?oh:Gg:n=s.cull}this.device.setCullMode(n),n===Vi&&s.cull===Vi&&this.twoSidedLightingNegScaleFactorId.setValue(i.node.worldScaleSign)}updateCameraFrustum(e){if(e.xr&&e.xr.views.list.length){const i=e.xr.views.list[0];yl.mul2(i.projMat,i.viewOffMat),e.frustum.setFromMat4(yl);return}const t=e.projectionMatrix;if(e.calculateProjection&&e.calculateProjection(t,k0),e.calculateTransform)e.calculateTransform(Sl,k0);else{const i=e._node.getPosition(),s=e._node.getRotation();Sl.setTRS(i,s,O.ONE),this.viewInvId.setValue(Sl.data)}td.copy(Sl).invert(),yl.mul2(t,td),e.frustum.setFromMat4(yl)}setBaseConstants(e,t){e.setCullMode(t.cull),t.opacityMap&&this.opacityMapId.setValue(t.opacityMap),(t.opacityMap||t.alphaTest>0)&&this.alphaTestId.setValue(t.alphaTest)}updateCpuSkinMatrices(e){SC++;const t=e.length;if(t!==0)for(let i=0;i<t;i++){const s=e[i].skinInstance;s&&(s.updateMatrices(e[i].node,SC),s._dirty=!0)}}updateGpuSkinMatrices(e){for(const t of e){const i=t.skinInstance;i&&i._dirty&&(i.updateMatrixPalette(t.node,SC),i._dirty=!1)}}updateMorphing(e){for(const t of e){const i=t.morphInstance;i&&i._dirty&&i.update()}}updateGSplats(e){var t;for(const i of e)(t=i.gsplatInstance)==null||t.update()}gpuUpdate(e){this.updateGpuSkinMatrices(e),this.updateMorphing(e),this.updateGSplats(e)}setVertexBuffers(e,t){e.setVertexBuffer(t.vertexBuffer)}setMorphing(e,t){t&&(t.prepareRendering(e),e.setVertexBuffer(t.morph.vertexBufferIds),this.morphPositionTex.setValue(t.texturePositions),this.morphNormalTex.setValue(t.textureNormals),this.morphTexParams.setValue(t._textureParams))}setSkinning(e,t){const i=t.skinInstance;if(i){this._skinDrawCalls++;const s=i.boneTexture;this.boneTextureId.setValue(s)}}dispatchViewPos(e){const t=this.viewPos;t[0]=e.x,t[1]=e.y,t[2]=e.z,this.viewPosId.setValue(t)}initViewBindGroupFormat(e){if(this.device.supportsUniformBuffers&&!this.viewUniformFormat){const t=[new ci("matrix_view",Aa),new ci("matrix_viewInverse",Aa),new ci("matrix_projection",Aa),new ci("matrix_projectionSkybox",Aa),new ci("matrix_viewProjection",Aa),new ci("matrix_view3",lp),new ci("cubeMapRotationMatrix",lp),new ci("view_position",vs),new ci("skyboxIntensity",zn),new ci("exposure",zn),new ci("textureBias",zn),new ci("view_index",zn)];e&&t.push(new ci("clusterCellsCountByBoundsSize",vs),new ci("clusterTextureSize",vs),new ci("clusterBoundsMin",vs),new ci("clusterBoundsDelta",vs),new ci("clusterCellsDot",vs),new ci("clusterCellsMax",vs),new ci("shadowAtlasParams",hh),new ci("clusterMaxCells",uh),new ci("clusterSkip",zn)),this.viewUniformFormat=new Zq(this.device,t);const i=[new a3(n3,kq|Fq)];this.viewBindGroupFormat=new Xq(this.device,i)}}setupViewUniforms(e,t){this.projId.setValue(e.projMat.data),this.projSkyboxId.setValue(e.projMat.data),this.viewId.setValue(e.viewOffMat.data),this.viewInvId.setValue(e.viewInvOffMat.data),this.viewId3.setValue(e.viewMat3.data),this.viewProjId.setValue(e.projViewOffMat.data),this.viewPosId.setValue(e.positionData),this.viewIndexId.setValue(t)}setupViewUniformBuffers(e,t,i,s){const{device:n}=this,a=(s==null?void 0:s.length)??1;for(;e.length<a;){const o=new c3(n,t,!1),l=new o3(n,i,o);e.push(l)}if(s)for(let o=0;o<a;o++){const l=s[o];this.setupViewUniforms(l,o);const c=e[o];c.defaultUniformBuffer.update(),c.update()}else{const o=e[0];o.defaultUniformBuffer.update(),o.update()}s||n.setBindGroup(tv,e[0])}setupMeshUniformBuffers(e){const t=this.device;if(t.supportsUniformBuffers){const i=e.getBindGroup(t);i.update(),t.setBindGroup(Wq,i),e.getUniformBuffer(t).update(TC),t.setBindGroup(yM,TC.bindGroup,TC.offsets)}}setMeshInstanceMatrices(e,t=!1){const i=e.node.worldTransform;this.modelMatrixId.setValue(i.data),t&&this.normalMatrixId.setValue(e.node.normalMatrix.data)}cull(e,t,i){const s=i.opaque;s.length=0;const n=i.transparent;n.length=0;const a=e.frustumCulling,o=t.length;for(let l=0;l<o;l++){const c=t[l];c.visible&&(!a||!c.cull||c._isVisible(e))&&(c.visibleThisFrame=!0,(c.transparent?n:s).push(c),(c.skinInstance||c.morphInstance||c.gsplatInstance)&&(this.processingMeshInstances.add(c),c.gsplatInstance&&c.gsplatInstance.cameras.push(e)))}}collectLights(e){this.lights.length=0,this.localLights.length=0;const t=this.scene._stats,i=e.layerList.length;for(let s=0;s<i;s++){const n=e.layerList[s];if(!wC.has(n)){wC.add(n);const a=n._lights;for(let o=0;o<a.length;o++){const l=a[o];bC.has(l)||(bC.add(l),this.lights.push(l),l._type!==Me&&this.localLights.push(l))}}}t.lights=this.lights.length,bC.clear(),wC.clear()}cullLights(e,t){const i=this.scene.clusteredLightingEnabled,s=this.scene.physicalUnits;for(let n=0;n<t.length;n++){const a=t[n];if(a.enabled)if(a._type!==Me)if(a.getBoundingSphere(xC),e.frustum.containsSphere(xC)){a.visibleThisFrame=!0,a.usePhysicalUnits=s;const o=e.getScreenSize(xC);a.maxScreenSize=Math.max(a.maxScreenSize,o)}else i||a.castShadows&&!a.shadowMap&&(a.visibleThisFrame=!0);else a.usePhysicalUnits=this.scene.physicalUnits}}cullShadowmaps(e){const t=this.scene.clusteredLightingEnabled;for(let s=0;s<this.localLights.length;s++){const n=this.localLights[s];n._type!==Me&&(t?n.atlasSlotUpdated&&n.shadowUpdateMode===on&&(n.shadowUpdateMode=pc):n.shadowUpdateMode===on&&n.castShadows&&(n.getRenderData(null,0).shadowCamera.renderTarget||(n.shadowUpdateMode=pc)),n.visibleThisFrame&&n.castShadows&&n.shadowUpdateMode!==on&&this._shadowRendererLocal.cull(n,e))}this.cameraDirShadowLights.clear();const i=e.cameras;for(let s=0;s<i.length;s++){const n=i[s];if(n.enabled){const a=n.camera;let o;const l=a.layers;for(let c=0;c<l.length;c++){const u=e.getLayerById(l[c]);if(u){const h=u.splitLights[Me];for(let d=0;d<h.length;d++){const f=h[d];f.castShadows&&!id.has(f)&&(id.add(f),o=o??[],o.push(f),this._shadowRendererDirectional.cull(f,e,a))}}}o&&this.cameraDirShadowLights.set(a,o),id.clear()}}}cullComposition(e){const{scene:t}=this;this.processingMeshInstances.clear();const i=e.cameras.length;this._camerasRendered+=i;for(let s=0;s<i;s++){const n=e.cameras[s];t==null||t.fire(C9,n);const a=n.renderTarget;n.frameUpdate(a),this.updateCameraFrustum(n.camera);const o=n.layers;for(let l=0;l<o.length;l++){const c=e.getLayerById(o[l]);if(c&&c.enabled){this.cullLights(n.camera,c._lights);const u=c.getCulledInstances(n.camera);this.cull(n.camera,c.meshInstances,u)}}t==null||t.fire(P9,n)}t.clusteredLightingEnabled&&this.updateLightTextureAtlas(),this.cullShadowmaps(e),t==null||t.fire(gme)}updateShaders(e,t){const i=e.length;for(let s=0;s<i;s++){const n=e[s].material;if(n&&!id.has(n)&&(id.add(n),n.getShaderVariant!==My.prototype.getShaderVariant)){if(t&&(!n.useLighting||n.emitter&&!n.emitter.lighting))continue;n.clearVariants()}}id.clear()}updateFrameUniforms(){this.blueNoiseTextureId.setValue(ege(this.device))}beginFrame(e){const t=this.scene,i=t.updateShaders||this.device._shadersDirty,s=e.layerList,n=s.length;for(let l=0;l<n;l++){const u=s[l].meshInstances,h=u.length;for(let d=0;d<h;d++){const f=u[d];f.visibleThisFrame=!1,i&&EC.push(f),f.skinInstance&&AC.push(f)}}if(i){const l=!t.updateShaders||!this.device._shadersDirty;this.updateShaders(EC,l),t.updateShaders=!1,this.device._shadersDirty=!1,t._shaderVersion++}this.updateFrameUniforms(),this.updateCpuSkinMatrices(AC),EC.length=0,AC.length=0;const a=this.lights,o=a.length;for(let l=0;l<o;l++)a[l].beginFrame()}updateLightTextureAtlas(){this.lightTextureAtlas.update(this.localLights,this.scene.lighting)}updateLayerComposition(e){const t=e.layerList.length,s=this.scene._shaderVersion;for(let n=0;n<t;n++){const a=e.layerList[n];a._shaderVersion=s}e._update()}frameUpdate(){this.clustersDebugRendered=!1,this.initViewBindGroupFormat(this.scene.clusteredLightingEnabled),this.dirLightShadows.clear()}}class N9{constructor(){this.camera=null,this.layer=null,this.transparent=!1,this.renderTarget=null,this.lightClusters=null,this.clearColor=!1,this.clearDepth=!1,this.clearStencil=!1,this.triggerPostprocess=!1,this.firstCameraUse=!1,this.lastCameraUse=!1,this.viewBindGroups=[],this.useCameraPasses=!1}destroy(){this.viewBindGroups.forEach(e=>{e.defaultUniformBuffer.destroy(),e.destroy()}),this.viewBindGroups.length=0}setupClears(e,t){this.clearColor=(e==null?void 0:e.clearColorBuffer)||t.clearColorBuffer,this.clearDepth=(e==null?void 0:e.clearDepthBuffer)||t.clearDepthBuffer,this.clearStencil=(e==null?void 0:e.clearStencilBuffer)||t.clearStencilBuffer}}class wge extends dn{constructor(e,t,i,s){super(e),this.renderActions=[],this.noDepthClear=!1,this.layerComposition=t,this.scene=i,this.renderer=s}get rendersAnything(){return this.renderActions.length>0}addRenderAction(e){this.renderActions.push(e)}addLayer(e,t,i,s=!0){const n=new N9;if(n.renderTarget=this.renderTarget,n.camera=e,n.layer=t,n.transparent=i,s){const a=this.renderActions.length===0;n.setupClears(a?e:void 0,t)}this.addRenderAction(n)}addLayers(e,t,i,s,n,a=!0){const{layerList:o,subLayerList:l}=e;let c=s,u=i;for(;u<o.length;){const h=o[u],d=l[u];if(t.camera.layersSet.has(h.id)&&(this.addLayer(t,h,d,c),c=!1),u++,h.id===n&&d===a)break}return u}updateDirectionalShadows(){const{renderer:e,renderActions:t}=this;for(let i=0;i<t.length;i++){const a=t[i].camera.camera,o=this.renderer.cameraDirShadowLights.get(a);if(o)for(let l=0;l<o.length;l++){const c=o[l];if(e.dirLightShadows.get(c)!==a){e.dirLightShadows.set(c,a);const u=e._shadowRendererDirectional.getLightRenderPass(c,a);u&&this.beforePasses.push(u)}}}}updateClears(){const e=this.renderActions[0];if(e){const i=e.camera.camera,s=i.fullSizeClearRect;this.setClearColor(s&&e.clearColor?i.clearColor:void 0),this.setClearDepth(s&&e.clearDepth&&!this.noDepthClear?i.clearDepth:void 0),this.setClearStencil(s&&e.clearStencil?i.clearStencil:void 0)}}frameUpdate(){super.frameUpdate(),this.updateDirectionalShadows(),this.updateClears()}before(){const{renderActions:e}=this;for(let t=0;t<e.length;t++){const i=e[t];i.firstCameraUse&&this.scene.fire(dme,i.camera)}}execute(){const{layerComposition:e,renderActions:t}=this;for(let i=0;i<t.length;i++){const s=t[i],n=s.layer;e.isEnabled(n,s.transparent)&&this.renderRenderAction(s,i===0)}}after(){for(let e=0;e<this.renderActions.length;e++){const t=this.renderActions[e];t.lastCameraUse&&this.scene.fire(fme,t.camera)}this.beforePasses.length=0}renderRenderAction(e,t){var c;const{renderer:i,scene:s}=this,n=i.device,{layer:a,transparent:o,camera:l}=e;if(l){const u=l.gammaCorrection,h=l.toneMapping;this.gammaCorrection!==void 0&&(l.gammaCorrection=this.gammaCorrection),this.toneMapping!==void 0&&(l.toneMapping=this.toneMapping),s.fire(pme,l,a,o);const d={lightClusters:e.lightClusters},f=((c=l.camera.shaderPassInfo)==null?void 0:c.index)??Nh;(!t||!l.camera.fullSizeClearRect)&&(d.clearColor=e.clearColor,d.clearDepth=e.clearDepth,d.clearStencil=e.clearStencil);const p=e.renderTarget??n.backBuffer;i.renderForwardLayer(l.camera,p,a,o,f,e.viewBindGroups,d),n.setBlendState(sr.NOBLEND),n.setStencilState(null,null),n.setAlphaToCoverage(!1),s.fire(mme,l,a,o),this.gammaCorrection!==void 0&&(l.gammaCorrection=u),this.toneMapping!==void 0&&(l.toneMapping=h)}}}class Tge extends dn{constructor(e,t,i){super(e),this.renderer=t,this.renderAction=i,this.requiresCubemaps=!1}execute(){this.renderAction.camera.onPostprocessing()}}const Ege=[[],[],[]],xl=new ae,$c={drawCalls:[],shaderInstances:[],isNewMaterial:[],lightMaskChanged:[],clear:function(){this.drawCalls.length=0,this.shaderInstances.length=0,this.isNewMaterial.length=0,this.lightMaskChanged.length=0}};function Age(r){const e=[];for(let t=0;t<r;++t){const i=Math.sqrt(t+.5)/Math.sqrt(r);e.push(i)}return e}function Cge(r){const e=[];for(let t=0;t<r;t++){const i=t/r,s=Math.sqrt(i*i);e.push(s)}return e}class Pge extends bge{constructor(e){super(e);const t=this.device;this._forwardDrawCalls=0,this._materialSwitches=0,this._depthMapTime=0,this._forwardTime=0,this._sortTime=0;const i=t.scope;this.fogColorId=i.resolve("fog_color"),this.fogStartId=i.resolve("fog_start"),this.fogEndId=i.resolve("fog_end"),this.fogDensityId=i.resolve("fog_density"),this.ambientId=i.resolve("light_globalAmbient"),this.skyboxIntensityId=i.resolve("skyboxIntensity"),this.cubeMapRotationMatrixId=i.resolve("cubeMapRotationMatrix"),this.pcssDiskSamplesId=i.resolve("pcssDiskSamples[0]"),this.pcssSphereSamplesId=i.resolve("pcssSphereSamples[0]"),this.lightColorId=[],this.lightDir=[],this.lightDirId=[],this.lightShadowMapId=[],this.lightShadowMatrixId=[],this.lightShadowParamsId=[],this.lightShadowIntensity=[],this.lightRadiusId=[],this.lightPos=[],this.lightPosId=[],this.lightWidth=[],this.lightWidthId=[],this.lightHeight=[],this.lightHeightId=[],this.lightInAngleId=[],this.lightOutAngleId=[],this.lightCookieId=[],this.lightCookieIntId=[],this.lightCookieMatrixId=[],this.lightCookieOffsetId=[],this.lightShadowSearchAreaId=[],this.lightCameraParamsId=[],this.lightSoftShadowParamsId=[],this.shadowMatrixPaletteId=[],this.shadowCascadeDistancesId=[],this.shadowCascadeCountId=[],this.shadowCascadeBlendId=[],this.screenSizeId=i.resolve("uScreenSize"),this._screenSize=new Float32Array(4),this.fogColor=new Float32Array(3),this.ambientColor=new Float32Array(3),this.pcssDiskSamples=Age(16),this.pcssSphereSamples=Cge(16)}destroy(){super.destroy()}dispatchGlobalLights(e){const t=this.ambientColor;if(xl.linear(e.ambientLight),t[0]=xl.r,t[1]=xl.g,t[2]=xl.b,e.physicalUnits)for(let i=0;i<3;i++)t[i]*=e.ambientLuminance;this.ambientId.setValue(t),this.skyboxIntensityId.setValue(e.physicalUnits?e.skyboxLuminance:e.skyboxIntensity),this.cubeMapRotationMatrixId.setValue(e._skyboxRotationMat3.data)}_resolveLight(e,t){const i=`light${t}`;this.lightColorId[t]=e.resolve(`${i}_color`),this.lightDir[t]=new Float32Array(3),this.lightDirId[t]=e.resolve(`${i}_direction`),this.lightShadowMapId[t]=e.resolve(`${i}_shadowMap`),this.lightShadowMatrixId[t]=e.resolve(`${i}_shadowMatrix`),this.lightShadowParamsId[t]=e.resolve(`${i}_shadowParams`),this.lightShadowIntensity[t]=e.resolve(`${i}_shadowIntensity`),this.lightShadowSearchAreaId[t]=e.resolve(`${i}_shadowSearchArea`),this.lightRadiusId[t]=e.resolve(`${i}_radius`),this.lightPos[t]=new Float32Array(3),this.lightPosId[t]=e.resolve(`${i}_position`),this.lightWidth[t]=new Float32Array(3),this.lightWidthId[t]=e.resolve(`${i}_halfWidth`),this.lightHeight[t]=new Float32Array(3),this.lightHeightId[t]=e.resolve(`${i}_halfHeight`),this.lightInAngleId[t]=e.resolve(`${i}_innerConeAngle`),this.lightOutAngleId[t]=e.resolve(`${i}_outerConeAngle`),this.lightCookieId[t]=e.resolve(`${i}_cookie`),this.lightCookieIntId[t]=e.resolve(`${i}_cookieIntensity`),this.lightCookieMatrixId[t]=e.resolve(`${i}_cookieMatrix`),this.lightCookieOffsetId[t]=e.resolve(`${i}_cookieOffset`),this.lightCameraParamsId[t]=e.resolve(`${i}_cameraParams`),this.lightSoftShadowParamsId[t]=e.resolve(`${i}_softShadowParams`),this.shadowMatrixPaletteId[t]=e.resolve(`${i}_shadowMatrixPalette[0]`),this.shadowCascadeDistancesId[t]=e.resolve(`${i}_shadowCascadeDistances`),this.shadowCascadeCountId[t]=e.resolve(`${i}_shadowCascadeCount`),this.shadowCascadeBlendId[t]=e.resolve(`${i}_shadowCascadeBlend`)}setLTCDirectionalLight(e,t,i,s,n){this.lightPos[t][0]=s.x-i.x*n,this.lightPos[t][1]=s.y-i.y*n,this.lightPos[t][2]=s.z-i.z*n,this.lightPosId[t].setValue(this.lightPos[t]);const a=e.transformVector(new O(-.5,0,0));this.lightWidth[t][0]=a.x*n,this.lightWidth[t][1]=a.y*n,this.lightWidth[t][2]=a.z*n,this.lightWidthId[t].setValue(this.lightWidth[t]);const o=e.transformVector(new O(0,0,.5));this.lightHeight[t][0]=o.x*n,this.lightHeight[t][1]=o.y*n,this.lightHeight[t][2]=o.z*n,this.lightHeightId[t].setValue(this.lightHeight[t])}dispatchDirectLights(e,t,i){let s=0;const n=this.device.scope;for(let a=0;a<e.length;a++){if(!(e[a].mask&t))continue;const o=e[a],l=o._node.getWorldTransform();if(this.lightColorId[s]||this._resolveLight(n,s),this.lightColorId[s].setValue(o._colorLinear),l.getY(o._direction).mulScalar(-1),o._direction.normalize(),this.lightDir[s][0]=o._direction.x,this.lightDir[s][1]=o._direction.y,this.lightDir[s][2]=o._direction.z,this.lightDirId[s].setValue(this.lightDir[s]),o.shape!==Wn&&this.setLTCDirectionalLight(l,s,o._direction,i._node.getPosition(),i.farClip),o.castShadows){const c=o.getRenderData(i,0),u=o._getUniformBiasValues(c);this.lightShadowMapId[s].setValue(c.shadowBuffer),this.lightShadowMatrixId[s].setValue(c.shadowMatrix.data),this.shadowMatrixPaletteId[s].setValue(o._shadowMatrixPalette),this.shadowCascadeDistancesId[s].setValue(o._shadowCascadeDistances),this.shadowCascadeCountId[s].setValue(o.numCascades),this.shadowCascadeBlendId[s].setValue(1-o.cascadeBlend),this.lightShadowIntensity[s].setValue(o.shadowIntensity),this.lightSoftShadowParamsId[s].setValue(o._softShadowParams),c.shadowCamera.renderTarget&&this.lightShadowSearchAreaId[s].setValue(o.penumbraSize/c.shadowCamera.renderTarget.width*c.projectionCompensation);const d=o._shadowCameraParams;d.length=4,d[0]=0,d[1]=c.shadowCamera._farClip,d[2]=c.shadowCamera._nearClip,d[3]=1,this.lightCameraParamsId[s].setValue(d);const f=o._shadowRenderParams;f.length=4,f[0]=o._shadowResolution,f[1]=u.normalBias,f[2]=u.bias,f[3]=0,this.lightShadowParamsId[s].setValue(f)}s++}return s}setLTCPositionalLight(e,t){const i=e.transformVector(new O(-.5,0,0));this.lightWidth[t][0]=i.x,this.lightWidth[t][1]=i.y,this.lightWidth[t][2]=i.z,this.lightWidthId[t].setValue(this.lightWidth[t]);const s=e.transformVector(new O(0,0,.5));this.lightHeight[t][0]=s.x,this.lightHeight[t][1]=s.y,this.lightHeight[t][2]=s.z,this.lightHeightId[t].setValue(this.lightHeight[t])}dispatchOmniLight(e,t,i){const s=t._node.getWorldTransform();if(this.lightColorId[i]||this._resolveLight(e,i),this.lightRadiusId[i].setValue(t.attenuationEnd),this.lightColorId[i].setValue(t._colorLinear),s.getTranslation(t._position),this.lightPos[i][0]=t._position.x,this.lightPos[i][1]=t._position.y,this.lightPos[i][2]=t._position.z,this.lightPosId[i].setValue(this.lightPos[i]),t.shape!==Wn&&this.setLTCPositionalLight(s,i),t.castShadows){const n=t.getRenderData(null,0);this.lightShadowMapId[i].setValue(n.shadowBuffer);const a=t._getUniformBiasValues(n),o=t._shadowRenderParams;o.length=4,o[0]=t._shadowResolution,o[1]=a.normalBias,o[2]=a.bias,o[3]=1/t.attenuationEnd,this.lightShadowParamsId[i].setValue(o),this.lightShadowIntensity[i].setValue(t.shadowIntensity);const l=t.penumbraSize/n.shadowCamera.renderTarget.width;this.lightShadowSearchAreaId[i].setValue(l);const c=t._shadowCameraParams;c.length=4,c[0]=0,c[1]=n.shadowCamera._farClip,c[2]=n.shadowCamera._nearClip,c[3]=0,this.lightCameraParamsId[i].setValue(c)}t._cookie&&(this.lightCookieId[i].setValue(t._cookie),this.lightShadowMatrixId[i].setValue(s.data),this.lightCookieIntId[i].setValue(t.cookieIntensity))}dispatchSpotLight(e,t,i){const s=t._node.getWorldTransform();if(this.lightColorId[i]||this._resolveLight(e,i),this.lightInAngleId[i].setValue(t._innerConeAngleCos),this.lightOutAngleId[i].setValue(t._outerConeAngleCos),this.lightRadiusId[i].setValue(t.attenuationEnd),this.lightColorId[i].setValue(t._colorLinear),s.getTranslation(t._position),this.lightPos[i][0]=t._position.x,this.lightPos[i][1]=t._position.y,this.lightPos[i][2]=t._position.z,this.lightPosId[i].setValue(this.lightPos[i]),t.shape!==Wn&&this.setLTCPositionalLight(s,i),s.getY(t._direction).mulScalar(-1),t._direction.normalize(),this.lightDir[i][0]=t._direction.x,this.lightDir[i][1]=t._direction.y,this.lightDir[i][2]=t._direction.z,this.lightDirId[i].setValue(this.lightDir[i]),t.castShadows){const n=t.getRenderData(null,0);this.lightShadowMapId[i].setValue(n.shadowBuffer),this.lightShadowMatrixId[i].setValue(n.shadowMatrix.data);const a=t._getUniformBiasValues(n),o=t._shadowRenderParams;o.length=4,o[0]=t._shadowResolution,o[1]=a.normalBias,o[2]=a.bias,o[3]=1/t.attenuationEnd,this.lightShadowParamsId[i].setValue(o),this.lightShadowIntensity[i].setValue(t.shadowIntensity);const l=t.penumbraSize/n.shadowCamera.renderTarget.width,c=n.shadowCamera._fov*Math.PI/180,u=1/Math.tan(c/2);this.lightShadowSearchAreaId[i].setValue(l*u);const h=t._shadowCameraParams;h.length=4,h[0]=0,h[1]=n.shadowCamera._farClip,h[2]=n.shadowCamera._nearClip,h[3]=0,this.lightCameraParamsId[i].setValue(h)}if(t._cookie){if(!t.castShadows){const n=_p.evalSpotCookieMatrix(t);this.lightShadowMatrixId[i].setValue(n.data)}this.lightCookieId[i].setValue(t._cookie),this.lightCookieIntId[i].setValue(t.cookieIntensity),t._cookieTransform&&(t._cookieTransformUniform[0]=t._cookieTransform.x,t._cookieTransformUniform[1]=t._cookieTransform.y,t._cookieTransformUniform[2]=t._cookieTransform.z,t._cookieTransformUniform[3]=t._cookieTransform.w,this.lightCookieMatrixId[i].setValue(t._cookieTransformUniform),t._cookieOffsetUniform[0]=t._cookieOffset.x,t._cookieOffsetUniform[1]=t._cookieOffset.y,this.lightCookieOffsetId[i].setValue(t._cookieOffsetUniform))}}dispatchLocalLights(e,t,i){let s=i;const n=this.device.scope,a=e[Pt],o=a.length;for(let u=0;u<o;u++){const h=a[u];h.mask&t&&(this.dispatchOmniLight(n,h,s),s++)}const l=e[Rt],c=l.length;for(let u=0;u<c;u++){const h=l[u];h.mask&t&&(this.dispatchSpotLight(n,h,s),s++)}}renderForwardPrepareMaterials(e,t,i,s,n,a){const o=e.fogParams??this.scene.fog,l=e.shaderParams;l.fog=o.type,l.srgbRenderTarget=(t==null?void 0:t.isColorBufferSrgb(0))??!1;const c=(v,y,x,S)=>{$c.drawCalls.push(v),$c.shaderInstances.push(y),$c.isNewMaterial.push(x),$c.lightMaskChanged.push(S)};$c.clear();const u=this.device,h=this.scene,d=h.clusteredLightingEnabled,f=(n==null?void 0:n.getLightHash(d))??0;let p=null,m,g;const _=i.length;for(let v=0;v<_;v++){const y=i[v],x=y.instancingData;if(x&&x.count<=0)continue;y.ensureMaterial(u);const S=y.material,w=y._shaderDefs,T=y.mask;S&&S===p&&w!==m&&(p=null),S!==p&&(this._materialSwitches++,S._scene=h,S.dirty&&(S.updateUniforms(u,h),S.dirty=!1));const A=y.getShaderInstance(a,f,h,l,this.viewUniformFormat,this.viewBindGroupFormat,s);c(y,A,S!==p,!p||T!==g),p=S,m=w,g=T}return $c}renderForwardInternal(e,t,i,s,n,a,o){var m,g;const l=this.device,c=this.scene,u=1<<s,h=a?-1:1,d=c.clusteredLightingEnabled,f=(m=e.xr)!=null&&m.session&&e.xr.views.list.length?e.xr.views.list:null,p=t.drawCalls.length;for(let _=0;_<p;_++){const v=t.drawCalls[_],y=t.isNewMaterial[_],x=t.lightMaskChanged[_],S=t.shaderInstances[_],w=v.material,T=v.mask;if(S.shader.failed)continue;if(y){if(l.setShader(S.shader,!1),w.setParameters(l),x){const B=this.dispatchDirectLights(i[Me],T,e);d||this.dispatchLocalLights(i,T,B)}this.alphaTestId.setValue(w.alphaTest),l.setBlendState(w.blendState),l.setDepthState(w.depthState),l.setAlphaToCoverage(w.alphaToCoverage)}this.setupCullMode(e._cullFaces,h,v);const A=v.stencilFront??w.stencilFront,C=v.stencilBack??w.stencilBack;l.setStencilState(A,C),v.setParameters(l,u),l.scope.resolve("meshInstanceId").setValue(v.id);const P=v.mesh;this.setVertexBuffers(l,P),this.setMorphing(l,v.morphInstance),this.setSkinning(l,v);const I=v.instancingData;I&&l.setVertexBuffer(I.vertexBuffer),this.setMeshInstanceMatrices(v,!0),this.setupMeshUniformBuffers(S);const M=v.renderStyle,N=P.indexBuffer[M];n==null||n(v,_);const k=(g=v.indirectData)==null?void 0:g.get(e);if(f)for(let V=0;V<f.length;V++){const B=f[V];if(l.setViewport(B.viewport.x,B.viewport.y,B.viewport.z,B.viewport.w),l.supportsUniformBuffers){const D=o[V];l.setBindGroup(tv,D)}else this.setupViewUniforms(B,V);const R=V===0,L=V===f.length-1;l.draw(P.primitive[M],N,I==null?void 0:I.count,k,R,L),this._forwardDrawCalls++,v.instancingData&&this._instancedDrawCalls++}else l.draw(P.primitive[M],N,I==null?void 0:I.count,k),this._forwardDrawCalls++,v.instancingData&&this._instancedDrawCalls++;_<p-1&&!t.isNewMaterial[_+1]&&w.setParameters(l,v.parameters)}}renderForward(e,t,i,s,n,a,o,l,c){const u=this.renderForwardPrepareMaterials(e,t,i,s,o,n);this.renderForwardInternal(e,u,s,n,a,l,c),$c.clear()}renderForwardLayer(e,t,i,s,n,a,o={}){const{scene:l,device:c}=this,u=l.clusteredLightingEnabled;this.setupViewport(e,t);let h,d;if(i){i.sortVisible(e,s);const x=i.getCulledInstances(e);h=s?x.transparent:x.opaque,l.immediate.onPreRenderLayer(i,h,s),i.requiresLightCube&&(this.lightCube.update(l.ambientLight,i._lights),this.constantLightCube.setValue(this.lightCube.colors)),d=i.splitLights}else h=o.meshInstances,d=o.splitLights??Ege;u&&((o.lightClusters??this.worldClustersAllocator.empty).activate(),i&&!this.clustersDebugRendered&&l.lighting.debugLayer===i.id&&(this.clustersDebugRendered=!0)),l._activeCamera=e;const f=e.fogParams??this.scene.fog;this.setFogConstants(f);const p=this.setCameraUniforms(e,t);c.supportsUniformBuffers&&this.setupViewUniformBuffers(a,this.viewUniformFormat,this.viewBindGroupFormat,p);const m=o.clearColor??!1,g=o.clearDepth??!1,_=o.clearStencil??!1;(m||g||_)&&this.clear(e,m,g,_);const v=!!(e._flipFaces^(t==null?void 0:t.flipY)),y=this._forwardDrawCalls;this.renderForward(e,t,h,d,n,null,i,v,a),i&&(i._forwardDrawCalls+=this._forwardDrawCalls-y)}setFogConstants(e){if(e.type!==um){xl.linear(e.color);const t=this.fogColor;t[0]=xl.r,t[1]=xl.g,t[2]=xl.b,this.fogColorId.setValue(t),e.type===zpe?(this.fogStartId.setValue(e.start),this.fogEndId.setValue(e.end)):this.fogDensityId.setValue(e.density)}}setSceneConstants(){const e=this.scene;this.dispatchGlobalLights(e);const t=this.device;this._screenSize[0]=t.width,this._screenSize[1]=t.height,this._screenSize[2]=1/t.width,this._screenSize[3]=1/t.height,this.screenSizeId.setValue(this._screenSize),this.pcssDiskSamplesId.setValue(this.pcssDiskSamples),this.pcssSphereSamplesId.setValue(this.pcssSphereSamples)}buildFrameGraph(e,t){const i=this.scene;if(e.reset(),i.clusteredLightingEnabled){const{shadowsEnabled:l,cookiesEnabled:c}=i.lighting;this._renderPassUpdateClustered.update(e,l,c,this.lights,this.localLights),e.addRenderPass(this._renderPassUpdateClustered)}else this._shadowRendererLocal.buildNonClusteredRenderPasses(e,this.localLights);let s=0,n=!0,a=null;const o=t._renderActions;for(let l=s;l<o.length;l++){const c=o[l],{layer:u,camera:h}=c;if(c.useCameraPasses)h.camera.renderPasses.forEach(d=>{e.addRenderPass(d)});else{const d=u.id===As,f=d&&(h.renderSceneColorMap||h.renderSceneDepthMap);n&&(n=!1,s=l,a=c.renderTarget);const p=o[l+1],g=(p?!p.useCameraPasses&&p.layer.id===As:!1)&&(h.renderSceneColorMap||h.renderSceneDepthMap),_=p?p.firstCameraUse&&this.cameraDirShadowLights.has(p.camera.camera):!1;if(!p||p.renderTarget!==a||_||g||f){if(d&&s===l||this.addMainRenderPass(e,t,a,s,l),d){if(h.renderSceneColorMap){const y=h.camera.renderPassColorGrab;y.source=h.renderTarget,e.addRenderPass(y)}h.renderSceneDepthMap&&e.addRenderPass(h.camera.renderPassDepthGrab)}if(c.triggerPostprocess&&(h!=null&&h.onPostprocessing)){const y=new Tge(this.device,this,c);e.addRenderPass(y)}n=!0}}}}addMainRenderPass(e,t,i,s,n){const a=new wge(this.device,t,this.scene,this);a.init(i);const o=t._renderActions;for(let l=s;l<=n;l++)a.addRenderAction(o[l]);e.addRenderPass(a)}update(e){this.frameUpdate(),this.shadowRenderer.frameUpdate(),this.scene._updateSkyMesh(),this.updateLayerComposition(e),this.collectLights(e),this.beginFrame(e),this.setSceneConstants(),this.cullComposition(e),this.gpuUpdate(this.processingMeshInstances)}}let CC=0;const Km=[],H0=new Set;function Ige(r,e){return r.drawOrder-e.drawOrder}function Mge(r,e){const t=r._sortKeyForward,i=e._sortKeyForward;return t===i?e.mesh.id-r.mesh.id:i-t}function Rge(r,e){return e._sortKeyDynamic-r._sortKeyDynamic}function Dge(r,e){return r._sortKeyDynamic-e._sortKeyDynamic}const Lge=[null,Ige,Mge,Rge,Dge];class Oge{constructor(){this.opaque=[],this.transparent=[]}}let rd=class{constructor(e={}){this.meshInstances=[],this.meshInstancesSet=new Set,this.shadowCasters=[],this.shadowCastersSet=new Set,this._visibleInstances=new WeakMap,this._lights=[],this._lightsSet=new Set,this._clusteredLightsSet=new Set,this._splitLights=[[],[],[]],this._splitLightsDirty=!0,this.requiresLightCube=!1,this.cameras=[],this.camerasSet=new Set,this._dirtyComposition=!1,e.id!==void 0?(this.id=e.id,CC=Math.max(this.id+1,CC)):this.id=CC++,this.name=e.name,this._enabled=e.enabled??!0,this._refCounter=this._enabled?1:0,this.opaqueSortMode=e.opaqueSortMode??rme,this.transparentSortMode=e.transparentSortMode??_U,e.renderTarget&&(this.renderTarget=e.renderTarget),this._clearColorBuffer=!!e.clearColorBuffer,this._clearDepthBuffer=!!e.clearDepthBuffer,this._clearStencilBuffer=!!e.clearStencilBuffer,this.onEnable=e.onEnable,this.onDisable=e.onDisable,this._enabled&&this.onEnable&&this.onEnable(),this.customSortCallback=null,this.customCalculateSortValues=null,this._lightHash=0,this._lightHashDirty=!1,this._lightIdHash=0,this._lightIdHashDirty=!1,this._shaderVersion=-1}set enabled(e){e!==this._enabled&&(this._dirtyComposition=!0,this._enabled=e,e?(this.incrementCounter(),this.onEnable&&this.onEnable()):(this.decrementCounter(),this.onDisable&&this.onDisable()))}get enabled(){return this._enabled}set clearColorBuffer(e){this._clearColorBuffer=e,this._dirtyComposition=!0}get clearColorBuffer(){return this._clearColorBuffer}set clearDepthBuffer(e){this._clearDepthBuffer=e,this._dirtyComposition=!0}get clearDepthBuffer(){return this._clearDepthBuffer}set clearStencilBuffer(e){this._clearStencilBuffer=e,this._dirtyComposition=!0}get clearStencilBuffer(){return this._clearStencilBuffer}get hasClusteredLights(){return this._clusteredLightsSet.size>0}get clusteredLightsSet(){return this._clusteredLightsSet}incrementCounter(){this._refCounter===0&&(this._enabled=!0,this.onEnable&&this.onEnable()),this._refCounter++}decrementCounter(){if(this._refCounter===1)this._enabled=!1,this.onDisable&&this.onDisable();else if(this._refCounter===0)return;this._refCounter--}addMeshInstances(e,t){const i=this.meshInstances,s=this.meshInstancesSet;for(let n=0;n<e.length;n++){const a=e[n];s.has(a)||(i.push(a),s.add(a),H0.add(a.material))}if(t||this.addShadowCasters(e),H0.size>0){const n=this._shaderVersion;H0.forEach(a=>{n>=0&&a._shaderVersion!==n&&(a.getShaderVariant!==My.prototype.getShaderVariant&&a.clearVariants(),a._shaderVersion=n)}),H0.clear()}}removeMeshInstances(e,t){const i=this.meshInstances,s=this.meshInstancesSet;for(let n=0;n<e.length;n++){const a=e[n];if(s.has(a)){s.delete(a);const o=i.indexOf(a);o>=0&&i.splice(o,1)}}t||this.removeShadowCasters(e)}addShadowCasters(e){const t=this.shadowCasters,i=this.shadowCastersSet;for(let s=0;s<e.length;s++){const n=e[s];n.castShadow&&!i.has(n)&&(i.add(n),t.push(n))}}removeShadowCasters(e){const t=this.shadowCasters,i=this.shadowCastersSet;for(let s=0;s<e.length;s++){const n=e[s];if(i.has(n)){i.delete(n);const a=t.indexOf(n);a>=0&&t.splice(a,1)}}}clearMeshInstances(e=!1){this.meshInstances.length=0,this.meshInstancesSet.clear(),e||(this.shadowCasters.length=0,this.shadowCastersSet.clear())}markLightsDirty(){this._lightHashDirty=!0,this._lightIdHashDirty=!0,this._splitLightsDirty=!0}hasLight(e){return this._lightsSet.has(e)}addLight(e){const t=e.light;this._lightsSet.has(t)||(this._lightsSet.add(t),this._lights.push(t),this.markLightsDirty()),t.type!==Me&&this._clusteredLightsSet.add(t)}removeLight(e){const t=e.light;this._lightsSet.has(t)&&(this._lightsSet.delete(t),this._lights.splice(this._lights.indexOf(t),1),this.markLightsDirty()),t.type!==Me&&this._clusteredLightsSet.delete(t)}clearLights(){this._lightsSet.forEach(e=>e.removeLayer(this)),this._lightsSet.clear(),this._clusteredLightsSet.clear(),this._lights.length=0,this.markLightsDirty()}get splitLights(){if(this._splitLightsDirty){this._splitLightsDirty=!1;const e=this._splitLights;for(let i=0;i<e.length;i++)e[i].length=0;const t=this._lights;for(let i=0;i<t.length;i++){const s=t[i];s.enabled&&e[s._type].push(s)}for(let i=0;i<e.length;i++)e[i].sort((s,n)=>s.key-n.key)}return this._splitLights}evaluateLightHash(e,t,i){let s=0;const n=this._lights;for(let a=0;a<n.length;a++){const o=n[a].type!==Me;(e&&o||t&&!o)&&Km.push(i?n[a].id:n[a].key)}return Km.length>0&&(Km.sort(),s=Kq(Km),Km.length=0),s}getLightHash(e){return this._lightHashDirty&&(this._lightHashDirty=!1,this._lightHash=this.evaluateLightHash(!e,!0,!1)),this._lightHash}getLightIdHash(){return this._lightIdHashDirty&&(this._lightIdHashDirty=!1,this._lightIdHash=this.evaluateLightHash(!0,!1,!0)),this._lightIdHash}addCamera(e){this.camerasSet.has(e.camera)||(this.camerasSet.add(e.camera),this.cameras.push(e),this._dirtyComposition=!0)}removeCamera(e){if(this.camerasSet.has(e.camera)){this.camerasSet.delete(e.camera);const t=this.cameras.indexOf(e);this.cameras.splice(t,1),this._dirtyComposition=!0}}clearCameras(){this.cameras.length=0,this.camerasSet.clear(),this._dirtyComposition=!0}_calculateSortDistances(e,t,i){const s=e.length,{x:n,y:a,z:o}=t,{x:l,y:c,z:u}=i;for(let h=0;h<s;h++){const d=e[h];let f;if(d.calculateSortDistance)f=d.calculateSortDistance(d,t,i);else{const m=d.aabb.center;f=(m.x-n)*l+(m.y-a)*c+(m.z-o)*u}const p=d._drawBucket*1e9;d._sortKeyDynamic=p+f}}getCulledInstances(e){let t=this._visibleInstances.get(e);return t||(t=new Oge,this._visibleInstances.set(e,t)),t}sortVisible(e,t){const i=t?this.transparentSortMode:this.opaqueSortMode;if(i===ax)return;const s=this.getCulledInstances(e),n=t?s.transparent:s.opaque,a=e.node;if(i===nme){const o=a.getPosition(),l=a.forward;this.customCalculateSortValues&&this.customCalculateSortValues(n,n.length,o,l),this.customSortCallback&&n.sort(this.customSortCallback)}else{if(i===_U||i===sme){const o=a.getPosition(),l=a.forward;this._calculateSortDistances(n,o,l)}n.sort(Lge[i])}}};const Nge=(r,e)=>r.priority-e.priority,rv=r=>r.sort(Nge);class qU extends Te{constructor(e="Untitled"){super(),this.layerList=[],this.layerIdMap=new Map,this.layerNameMap=new Map,this.layerOpaqueIndexMap=new Map,this.layerTransparentIndexMap=new Map,this.subLayerList=[],this.subLayerEnabled=[],this.cameras=[],this._renderActions=[],this._dirty=!1,this.name=e,this._opaqueOrder={},this._transparentOrder={}}destroy(){this.destroyRenderActions()}destroyRenderActions(){this._renderActions.forEach(e=>e.destroy()),this._renderActions.length=0}markDirty(){this._dirty=!0}_update(){const e=this.layerList.length;if(!this._dirty){for(let t=0;t<e;t++)if(this.layerList[t]._dirtyComposition){this._dirty=!0;break}}if(this._dirty){this._dirty=!1,this.cameras.length=0;for(let i=0;i<e;i++){const s=this.layerList[i];s._dirtyComposition=!1;for(let n=0;n<s.cameras.length;n++){const a=s.cameras[n];this.cameras.indexOf(a)<0&&this.cameras.push(a)}}this.cameras.length>1&&rv(this.cameras);let t=0;this.destroyRenderActions();for(let i=0;i<this.cameras.length;i++){const s=this.cameras[i];if(s.camera.renderPasses.length>0){this.addDummyRenderAction(t,s),t++;continue}let n=!0;const a=t;let o=null,l=!1;for(let c=0;c<e;c++){const u=this.layerList[c];if(u.enabled&&this.subLayerEnabled[c]&&u.cameras.length>0&&s.layers.indexOf(u.id)>=0){!l&&u.id===s.disablePostEffectsLayer&&(l=!0,o&&(o.triggerPostprocess=!0));const d=this.subLayerList[c];o=this.addRenderAction(t,u,d,s,n,l),t++,n=!1}}a<t&&(o.lastCameraUse=!0),!l&&o&&(o.triggerPostprocess=!0),s.renderTarget&&s.postEffectsEnabled&&this.propagateRenderTarget(a-1,s)}this._logRenderActions()}}getNextRenderAction(e){const t=new N9;return this._renderActions.push(t),t}addDummyRenderAction(e,t){const i=this.getNextRenderAction(e);i.camera=t,i.useCameraPasses=!0}addRenderAction(e,t,i,s,n,a){let o=t.id!==As?s.renderTarget:null,l=!1;const c=this._renderActions;for(let f=e-1;f>=0;f--)if(c[f].camera===s&&c[f].renderTarget===o){l=!0;break}a&&s.postEffectsEnabled&&(o=null);const u=this.getNextRenderAction(e);u.triggerPostprocess=!1,u.layer=t,u.transparent=i,u.camera=s,u.renderTarget=o,u.firstCameraUse=n,u.lastCameraUse=!1;const h=n||!l,d=t.clearColorBuffer||t.clearDepthBuffer||t.clearStencilBuffer;return(h||d)&&u.setupClears(h?s:void 0,t),u}propagateRenderTarget(e,t){for(let i=e;i>=0;i--){const s=this._renderActions[i],n=s.layer;if(s.renderTarget&&n.id!==As)break;if(n.id===As)continue;if(s.useCameraPasses)break;const a=s==null?void 0:s.camera.camera;if(a&&(!t.camera.rect.equals(a.rect)||!t.camera.scissorRect.equals(a.scissorRect)))break;s.renderTarget=t.renderTarget}}_logRenderActions(){}_isLayerAdded(e){return this.layerIdMap.get(e.id)===e}_isSublayerAdded(e,t){return(t?this.layerTransparentIndexMap:this.layerOpaqueIndexMap).get(e)!==void 0}push(e){this._isLayerAdded(e)||(this.layerList.push(e),this.layerList.push(e),this._opaqueOrder[e.id]=this.subLayerList.push(!1)-1,this._transparentOrder[e.id]=this.subLayerList.push(!0)-1,this.subLayerEnabled.push(!0),this.subLayerEnabled.push(!0),this._updateLayerMaps(),this._dirty=!0,this.fire("add",e))}insert(e,t){if(this._isLayerAdded(e))return;this.layerList.splice(t,0,e,e),this.subLayerList.splice(t,0,!1,!0);const i=this.layerList.length;this._updateOpaqueOrder(t,i-1),this._updateTransparentOrder(t,i-1),this.subLayerEnabled.splice(t,0,!0,!0),this._updateLayerMaps(),this._dirty=!0,this.fire("add",e)}remove(e){let t=this.layerList.indexOf(e);for(delete this._opaqueOrder[t],delete this._transparentOrder[t];t>=0;)this.layerList.splice(t,1),this.subLayerList.splice(t,1),this.subLayerEnabled.splice(t,1),t=this.layerList.indexOf(e),this._dirty=!0,this.fire("remove",e);const i=this.layerList.length;this._updateOpaqueOrder(0,i-1),this._updateTransparentOrder(0,i-1),this._updateLayerMaps()}pushOpaque(e){this._isSublayerAdded(e,!1)||(this.layerList.push(e),this._opaqueOrder[e.id]=this.subLayerList.push(!1)-1,this.subLayerEnabled.push(!0),this._updateLayerMaps(),this._dirty=!0,this.fire("add",e))}insertOpaque(e,t){if(this._isSublayerAdded(e,!1))return;this.layerList.splice(t,0,e),this.subLayerList.splice(t,0,!1);const i=this.subLayerList.length;this._updateOpaqueOrder(t,i-1),this.subLayerEnabled.splice(t,0,!0),this._updateLayerMaps(),this._dirty=!0,this.fire("add",e)}removeOpaque(e){for(let t=0,i=this.layerList.length;t<i;t++)if(this.layerList[t]===e&&!this.subLayerList[t]){this.layerList.splice(t,1),this.subLayerList.splice(t,1),i--,this._updateOpaqueOrder(t,i-1),this.subLayerEnabled.splice(t,1),this._dirty=!0,this.layerList.indexOf(e)<0&&this.fire("remove",e);break}this._updateLayerMaps()}pushTransparent(e){this._isSublayerAdded(e,!0)||(this.layerList.push(e),this._transparentOrder[e.id]=this.subLayerList.push(!0)-1,this.subLayerEnabled.push(!0),this._updateLayerMaps(),this._dirty=!0,this.fire("add",e))}insertTransparent(e,t){if(this._isSublayerAdded(e,!0))return;this.layerList.splice(t,0,e),this.subLayerList.splice(t,0,!0);const i=this.subLayerList.length;this._updateTransparentOrder(t,i-1),this.subLayerEnabled.splice(t,0,!0),this._updateLayerMaps(),this._dirty=!0,this.fire("add",e)}removeTransparent(e){for(let t=0,i=this.layerList.length;t<i;t++)if(this.layerList[t]===e&&this.subLayerList[t]){this.layerList.splice(t,1),this.subLayerList.splice(t,1),i--,this._updateTransparentOrder(t,i-1),this.subLayerEnabled.splice(t,1),this._dirty=!0,this.layerList.indexOf(e)<0&&this.fire("remove",e);break}this._updateLayerMaps()}getOpaqueIndex(e){return this.layerOpaqueIndexMap.get(e)??-1}getTransparentIndex(e){return this.layerTransparentIndexMap.get(e)??-1}isEnabled(e,t){if(e.enabled){const i=t?this.getTransparentIndex(e):this.getOpaqueIndex(e);if(i>=0)return this.subLayerEnabled[i]}return!1}_updateLayerMaps(){this.layerIdMap.clear(),this.layerNameMap.clear(),this.layerOpaqueIndexMap.clear(),this.layerTransparentIndexMap.clear();for(let e=0;e<this.layerList.length;e++){const t=this.layerList[e];this.layerIdMap.set(t.id,t),this.layerNameMap.set(t.name,t),(this.subLayerList[e]?this.layerTransparentIndexMap:this.layerOpaqueIndexMap).set(t,e)}}getLayerById(e){return this.layerIdMap.get(e)??null}getLayerByName(e){return this.layerNameMap.get(e)??null}_updateOpaqueOrder(e,t){for(let i=e;i<=t;i++)this.subLayerList[i]===!1&&(this._opaqueOrder[this.layerList[i].id]=i)}_updateTransparentOrder(e,t){for(let i=e;i<=t;i++)this.subLayerList[i]===!0&&(this._transparentOrder[this.layerList[i].id]=i)}_sortLayersDescending(e,t,i){let s=-1,n=-1;for(let a=0,o=e.length;a<o;a++){const l=e[a];i.hasOwnProperty(l)&&(s=Math.max(s,i[l]))}for(let a=0,o=t.length;a<o;a++){const l=t[a];i.hasOwnProperty(l)&&(n=Math.max(n,i[l]))}return s===-1&&n!==-1?1:n===-1&&s!==-1?-1:n-s}sortTransparentLayers(e,t){return this._sortLayersDescending(e,t,this._transparentOrder)}sortOpaqueLayers(e,t){return this._sortLayersDescending(e,t,this._opaqueOrder)}}const G0=new O,so={bias:0,normalBias:0},Zm=new ae,PC={r:0,g:1,b:2,a:3},MM={directional:Me,omni:Pt,point:Pt,spot:Rt},kge=[[new ce(0,0,1,1)],[new ce(0,0,.5,.5),new ce(0,.5,.5,.5)],[new ce(0,0,.5,.5),new ce(0,.5,.5,.5),new ce(.5,0,.5,.5)],[new ce(0,0,.5,.5),new ce(0,.5,.5,.5),new ce(.5,0,.5,.5),new ce(.5,.5,.5,.5)]],Fge={rrr:1,ggg:2,bbb:4,aaa:8,rgb:7};let Bge=0;class Uge{constructor(e,t,i){this.light=i,this.camera=e,this.shadowCamera=O9.createShadowCamera(i._shadowType,i._type,t),this.shadowMatrix=new se,this.shadowViewport=new ce(0,0,1,1),this.shadowScissor=new ce(0,0,1,1),this.projectionCompensation=0,this.face=t,this.visibleCasters=[],this.viewBindGroups=[]}destroy(){this.viewBindGroups.forEach(e=>{e.defaultUniformBuffer.destroy(),e.destroy()}),this.viewBindGroups.length=0}get shadowBuffer(){const e=this.shadowCamera.renderTarget;return e?this.light._isPcf?e.depthBuffer:e.colorBuffer:null}}class sv{constructor(e,t){this.layers=new Set,this.shadowDepthState=Ds.DEFAULT.clone(),this.clusteredFlags=0,this.clusteredData=new Uint32Array(3),this.clusteredData16=new Uint16Array(this.clusteredData.buffer),this._evtDeviceRestored=null,this.device=e,this.clusteredLighting=t,this.id=Bge++,this._evtDeviceRestored=e.on("devicerestored",this.onDeviceRestored,this),this._type=Me,this._color=new ae(.8,.8,.8),this._intensity=1,this._affectSpecularity=!0,this._luminance=0,this._castShadows=!1,this._enabled=!1,this._mask=Zn,this.isStatic=!1,this.key=0,this.bakeDir=!0,this.bakeNumSamples=1,this.bakeArea=0,this.attenuationStart=10,this.attenuationEnd=10,this._falloffMode=b3,this._shadowType=Un,this._vsmBlurSize=11,this.vsmBlurMode=T3,this.vsmBias=.01*.25,this._cookie=null,this.cookieIntensity=1,this._cookieFalloff=!0,this._cookieChannel="rgb",this._cookieTransform=null,this._cookieTransformUniform=new Float32Array(4),this._cookieOffset=null,this._cookieOffsetUniform=new Float32Array(2),this._cookieTransformSet=!1,this._cookieOffsetSet=!1,this._innerConeAngle=40,this._outerConeAngle=45,this.cascades=null,this._shadowMatrixPalette=null,this._shadowCascadeDistances=null,this.numCascades=1,this._cascadeBlend=0,this.cascadeDistribution=.5,this._shape=Wn,this._colorLinear=new Float32Array(3),this._updateLinearColor(),this._position=new O(0,0,0),this._direction=new O(0,0,0),this._innerConeAngleCos=Math.cos(this._innerConeAngle*Math.PI/180),this._updateOuterAngle(this._outerConeAngle),this._usePhysicalUnits=void 0,this._shadowMap=null,this._shadowRenderParams=[],this._shadowCameraParams=[],this.shadowDistance=40,this._shadowResolution=1024,this._shadowBias=-5e-4,this._shadowIntensity=1,this._normalOffsetBias=0,this.shadowUpdateMode=O3,this.shadowUpdateOverrides=null,this._isVsm=!1,this._isPcf=!0,this._softShadowParams=new Float32Array(4),this.shadowSamples=16,this.shadowBlockerSamples=16,this.penumbraSize=1,this.penumbraFalloff=1,this._cookieMatrix=null,this._atlasViewport=null,this.atlasViewportAllocated=!1,this.atlasVersion=0,this.atlasSlotIndex=0,this.atlasSlotUpdated=!1,this._node=null,this._renderData=[],this.visibleThisFrame=!1,this.maxScreenSize=0,this._updateShadowBias()}destroy(){var e;(e=this._evtDeviceRestored)==null||e.off(),this._evtDeviceRestored=null,this._destroyShadowMap(),this.releaseRenderData(),this._renderData=null}onDeviceRestored(){this.shadowUpdateMode===on&&(this.shadowUpdateMode=pc)}releaseRenderData(){if(this._renderData){for(let e=0;e<this._renderData.length;e++)this._renderData[e].destroy();this._renderData.length=0}}addLayer(e){this.layers.add(e)}removeLayer(e){this.layers.delete(e)}set shadowSamples(e){this._softShadowParams[0]=e}get shadowSamples(){return this._softShadowParams[0]}set shadowBlockerSamples(e){this._softShadowParams[1]=e}get shadowBlockerSamples(){return this._softShadowParams[1]}set shadowBias(e){this._shadowBias!==e&&(this._shadowBias=e,this._updateShadowBias())}get shadowBias(){return this._shadowBias}set numCascades(e){(!this.cascades||this.numCascades!==e)&&(this.cascades=kge[e-1],this._shadowMatrixPalette=new Float32Array(4*16),this._shadowCascadeDistances=new Float32Array(4),this._destroyShadowMap(),this.updateKey())}get numCascades(){return this.cascades.length}set cascadeBlend(e){this._cascadeBlend!==e&&(this._cascadeBlend=e,this.updateKey())}get cascadeBlend(){return this._cascadeBlend}set shadowMap(e){this._shadowMap!==e&&(this._destroyShadowMap(),this._shadowMap=e)}get shadowMap(){return this._shadowMap}set mask(e){this._mask!==e&&(this._mask=e,this.updateKey(),this.updateClusteredFlags())}get mask(){return this._mask}get numShadowFaces(){const e=this._type;return e===Me?this.numCascades:e===Pt?6:1}set type(e){if(this._type===e)return;this._type=e,this._destroyShadowMap(),this._updateShadowBias(),this.updateKey(),this.updateClusteredFlags();const t=this._shadowType;this._shadowType=null,this.shadowUpdateOverrides=null,this.shadowType=t}get type(){return this._type}set shape(e){if(this._shape===e)return;this._shape=e,this._destroyShadowMap(),this.updateKey(),this.updateClusteredFlags();const t=this._shadowType;this._shadowType=null,this.shadowType=t}get shape(){return this._shape}set usePhysicalUnits(e){this._usePhysicalUnits!==e&&(this._usePhysicalUnits=e,this._updateLinearColor())}get usePhysicalUnits(){return this._usePhysicalUnits}set shadowType(e){if(this._shadowType===e)return;let t=Vo.get(e);t||(e=Un);const i=this.device;e===iv&&!i.textureFloatRenderable&&!i.textureHalfFloatRenderable&&(e=Un),this._type===Pt&&e!==d9&&e!==Un&&e!==f9&&e!==p9&&e!==iv&&(e=Un),e===w3&&(!i.textureFloatRenderable||!i.textureFloatFilterable)&&(e=TM),e===TM&&!i.textureHalfFloatRenderable&&(e=Un),t=Vo.get(e),this._isVsm=(t==null?void 0:t.vsm)??!1,this._isPcf=(t==null?void 0:t.pcf)??!1,this._shadowType=e,this._destroyShadowMap(),this.updateKey()}get shadowType(){return this._shadowType}set enabled(e){this._enabled!==e&&(this._enabled=e,this.layersDirty())}get enabled(){return this._enabled}set castShadows(e){this._castShadows!==e&&(this._castShadows=e,this._destroyShadowMap(),this.layersDirty(),this.updateKey())}get castShadows(){return this._castShadows&&this._mask!==Wu&&this._mask!==0}set shadowIntensity(e){this._shadowIntensity!==e&&(this._shadowIntensity=e,this.updateKey())}get shadowIntensity(){return this._shadowIntensity}get bakeShadows(){return this._castShadows&&this._mask===Wu}set shadowResolution(e){this._shadowResolution!==e&&(this._type===Pt?e=Math.min(e,this.device.maxCubeMapSize):e=Math.min(e,this.device.maxTextureSize),this._shadowResolution=e,this._destroyShadowMap())}get shadowResolution(){return this._shadowResolution}set vsmBlurSize(e){this._vsmBlurSize!==e&&(e%2===0&&e++,this._vsmBlurSize=e)}get vsmBlurSize(){return this._vsmBlurSize}set normalOffsetBias(e){if(this._normalOffsetBias!==e){const t=!this._normalOffsetBias&&e||this._normalOffsetBias&&!e;this._normalOffsetBias=e,t&&this.updateKey()}}get normalOffsetBias(){return this._normalOffsetBias}set falloffMode(e){this._falloffMode!==e&&(this._falloffMode=e,this.updateKey(),this.updateClusteredFlags())}get falloffMode(){return this._falloffMode}set innerConeAngle(e){this._innerConeAngle!==e&&(this._innerConeAngle=e,this._innerConeAngleCos=Math.cos(e*Math.PI/180),this.updateClusterData(!1,!0),this._usePhysicalUnits&&this._updateLinearColor())}get innerConeAngle(){return this._innerConeAngle}set outerConeAngle(e){this._outerConeAngle!==e&&(this._outerConeAngle=e,this._updateOuterAngle(e),this._usePhysicalUnits&&this._updateLinearColor())}get outerConeAngle(){return this._outerConeAngle}set penumbraSize(e){this._penumbraSize=e,this._softShadowParams[2]=e}get penumbraSize(){return this._penumbraSize}set penumbraFalloff(e){this._softShadowParams[3]=e}get penumbraFalloff(){return this._softShadowParams[3]}_updateOuterAngle(e){const t=e*Math.PI/180;this._outerConeAngleCos=Math.cos(t),this._outerConeAngleSin=Math.sin(t),this.updateClusterData(!1,!0)}set intensity(e){this._intensity!==e&&(this._intensity=e,this._updateLinearColor())}get intensity(){return this._intensity}set affectSpecularity(e){this._type===Me&&(this._affectSpecularity=e,this.updateKey())}get affectSpecularity(){return this._affectSpecularity}set luminance(e){this._luminance!==e&&(this._luminance=e,this._updateLinearColor())}get luminance(){return this._luminance}get cookieMatrix(){return this._cookieMatrix||(this._cookieMatrix=new se),this._cookieMatrix}get atlasViewport(){return this._atlasViewport||(this._atlasViewport=new ce(0,0,1,1)),this._atlasViewport}set cookie(e){this._cookie!==e&&(this._cookie=e,this.updateKey())}get cookie(){return this._cookie}set cookieFalloff(e){this._cookieFalloff!==e&&(this._cookieFalloff=e,this.updateKey())}get cookieFalloff(){return this._cookieFalloff}set cookieChannel(e){if(this._cookieChannel!==e){if(e.length<3){const t=e.charAt(e.length-1),i=3-e.length;for(let s=0;s<i;s++)e+=t}this._cookieChannel=e,this.updateKey(),this.updateClusteredFlags()}}get cookieChannel(){return this._cookieChannel}set cookieTransform(e){this._cookieTransform!==e&&(this._cookieTransform=e,this._cookieTransformSet=!!e,e&&!this._cookieOffset&&(this.cookieOffset=new ee,this._cookieOffsetSet=!1),this.updateKey())}get cookieTransform(){return this._cookieTransform}set cookieOffset(e){if(this._cookieOffset===e)return;!!(this._cookieTransformSet||e)&&!e&&this._cookieOffset?this._cookieOffset.set(0,0):this._cookieOffset=e,this._cookieOffsetSet=!!e,e&&!this._cookieTransform&&(this.cookieTransform=new ce(1,1,0,0),this._cookieTransformSet=!1),this.updateKey()}get cookieOffset(){return this._cookieOffset}beginFrame(){this.visibleThisFrame=this._type===Me&&this._enabled,this.maxScreenSize=0,this.atlasViewportAllocated=!1,this.atlasSlotUpdated=!1}_destroyShadowMap(){if(this.releaseRenderData(),this._shadowMap&&(this._shadowMap.cached||this._shadowMap.destroy(),this._shadowMap=null),this.shadowUpdateMode===on&&(this.shadowUpdateMode=pc),this.shadowUpdateOverrides)for(let e=0;e<this.shadowUpdateOverrides.length;e++)this.shadowUpdateOverrides[e]===on&&(this.shadowUpdateOverrides[e]=pc)}getRenderData(e,t){for(let s=0;s<this._renderData.length;s++){const n=this._renderData[s];if(n.camera===e&&n.face===t)return n}const i=new Uge(e,t,this);return this._renderData.push(i),i}clone(){const e=new sv(this.device,this.clusteredLighting);return e.type=this._type,e.setColor(this._color),e.intensity=this._intensity,e.affectSpecularity=this._affectSpecularity,e.luminance=this._luminance,e.castShadows=this.castShadows,e._enabled=this._enabled,e.attenuationStart=this.attenuationStart,e.attenuationEnd=this.attenuationEnd,e.falloffMode=this._falloffMode,e.shadowType=this._shadowType,e.vsmBlurSize=this._vsmBlurSize,e.vsmBlurMode=this.vsmBlurMode,e.vsmBias=this.vsmBias,e.shadowUpdateMode=this.shadowUpdateMode,e.mask=this.mask,this.shadowUpdateOverrides&&(e.shadowUpdateOverrides=this.shadowUpdateOverrides.slice()),e.innerConeAngle=this._innerConeAngle,e.outerConeAngle=this._outerConeAngle,e.numCascades=this.numCascades,e.cascadeDistribution=this.cascadeDistribution,e.cascadeBlend=this._cascadeBlend,e.shape=this._shape,e.shadowDepthState.copy(this.shadowDepthState),e.shadowBias=this.shadowBias,e.normalOffsetBias=this._normalOffsetBias,e.shadowResolution=this._shadowResolution,e.shadowDistance=this.shadowDistance,e.shadowIntensity=this.shadowIntensity,e.shadowSamples=this.shadowSamples,e.shadowBlockerSamples=this.shadowBlockerSamples,e.penumbraSize=this.penumbraSize,e.penumbraFalloff=this.penumbraFalloff,e}static getLightUnitConversion(e,t=Math.PI/4,i=0){switch(e){case Rt:{const s=Math.cos(t),n=Math.cos(i);return 2*Math.PI*(1-n+(n-s)/2)}case Pt:return 4*Math.PI;case Me:return 1}}_getUniformBiasValues(e){const t=e.shadowCamera._farClip;switch(this._type){case Pt:so.bias=this.shadowBias,so.normalBias=this._normalOffsetBias;break;case Rt:this._isVsm?so.bias=-1e-5*20:so.bias=this.shadowBias*20,so.normalBias=this._isVsm?this.vsmBias/(this.attenuationEnd/7):this._normalOffsetBias;break;case Me:this._isVsm?so.bias=-1e-5*20:so.bias=this.shadowBias/t*100,so.normalBias=this._isVsm?this.vsmBias/(t/7):this._normalOffsetBias;break}return so}getColor(){return this._color}getBoundingSphere(e){if(this._type===Rt){const t=this.attenuationEnd,i=this._outerConeAngle,s=this._outerConeAngleCos,n=this._node;G0.copy(n.up),i>45?(e.radius=t*this._outerConeAngleSin,G0.mulScalar(-t*s)):(e.radius=t/(2*s),G0.mulScalar(-e.radius)),e.center.add2(n.getPosition(),G0)}else this._type===Pt&&(e.center=this._node.getPosition(),e.radius=this.attenuationEnd)}getBoundingBox(e){if(this._type===Rt){const t=this.attenuationEnd,i=this._outerConeAngle,s=this._node,n=Math.abs(Math.sin(i*Q.DEG_TO_RAD)*t);e.center.set(0,-t*.5,0),e.halfExtents.set(n,t*.5,n),e.setFromTransformedAabb(e,s.getWorldTransform(),!0)}else this._type===Pt&&(e.center.copy(this._node.getPosition()),e.halfExtents.set(this.attenuationEnd,this.attenuationEnd,this.attenuationEnd))}_updateShadowBias(){if(this._type===Pt&&!this.clusteredLighting)this.shadowDepthState.depthBias=0,this.shadowDepthState.depthBiasSlope=0;else{const e=this.shadowBias*-1e3;this.shadowDepthState.depthBias=e,this.shadowDepthState.depthBiasSlope=e}}_updateLinearColor(){let e=this._intensity;this._usePhysicalUnits&&(e=this._luminance/sv.getLightUnitConversion(this._type,this._outerConeAngle*Q.DEG_TO_RAD,this._innerConeAngle*Q.DEG_TO_RAD));const t=this._color,i=this._colorLinear;e>=1?Zm.linear(t).mulScalar(e):Zm.copy(t).mulScalar(e).linear(),i[0]=Zm.r,i[1]=Zm.g,i[2]=Zm.b,this.updateClusterData(!0)}setColor(){arguments.length===1?this._color.set(arguments[0].r,arguments[0].g,arguments[0].b):arguments.length===3&&this._color.set(arguments[0],arguments[1],arguments[2]),this._updateLinearColor()}layersDirty(){this.layers.forEach(e=>{e.hasLight(this)&&e.markLightsDirty()})}updateKey(){let e=this._type<<29|this._shadowType<<25|this._falloffMode<<23|(this._normalOffsetBias!==0?1:0)<<22|(this._cookie?1:0)<<21|(this._cookieFalloff?1:0)<<20|PC[this._cookieChannel.charAt(0)]<<18|(this._cookieTransform?1:0)<<12|this._shape<<10|(this.numCascades>0?1:0)<<9|(this._cascadeBlend>0?1:0)<<8|(this.affectSpecularity?1:0)<<7|this.mask<<6|(this._castShadows?1:0)<<3;this._cookieChannel.length===3&&(e|=PC[this._cookieChannel.charAt(1)]<<16,e|=PC[this._cookieChannel.charAt(2)]<<14),e!==this.key&&this.layersDirty(),this.key=e}updateClusteredFlags(){const e=!!(this.mask&Zn),t=!!(this.mask&ph);this.clusteredFlags=(this.type===Rt?1:0)<<30|(this._shape&3)<<28|(this._falloffMode&1)<<27|(Fge[this._cookieChannel]??0)<<23|(e?1:0)<<22|(t?1:0)<<21}getClusteredFlags(e,t){return this.clusteredFlags|((e?Math.floor(this.shadowIntensity*255):0)&255)<<0|((t?Math.floor(this.cookieIntensity*255):0)&255)<<8}updateClusterData(e,t){const{clusteredData16:i}=this,s=ah.float2Half;e&&(i[0]=s(Q.clamp(this._colorLinear[0]/rx,0,65504)),i[1]=s(Q.clamp(this._colorLinear[1]/rx,0,65504)),i[2]=s(Q.clamp(this._colorLinear[2]/rx,0,65504))),t&&(i[4]=s(this._innerConeAngleCos),i[5]=s(this._outerConeAngleCos))}}class k9{constructor(e,t,i){this._areaLightsEnabled=!1,this._cells=new O(10,3,10),this._maxLightsPerCell=255,this._shadowsEnabled=!0,this._shadowType=Un,this._shadowAtlasResolution=2048,this._cookiesEnabled=!1,this._cookieAtlasResolution=2048,this.atlasSplit=null,this._supportsAreaLights=e,this._maxTextureSize=t,this._dirtyLightsFnc=i}applySettings(e){this.shadowsEnabled=e.lightingShadowsEnabled??this.shadowsEnabled,this.cookiesEnabled=e.lightingCookiesEnabled??this.cookiesEnabled,this.areaLightsEnabled=e.lightingAreaLightsEnabled??this.areaLightsEnabled,this.shadowAtlasResolution=e.lightingShadowAtlasResolution??this.shadowAtlasResolution,this.cookieAtlasResolution=e.lightingCookieAtlasResolution??this.cookieAtlasResolution,this.maxLightsPerCell=e.lightingMaxLightsPerCell??this.maxLightsPerCell,this.shadowType=e.lightingShadowType??this.shadowType,e.lightingCells&&(this.cells=new O(e.lightingCells))}set cells(e){this._cells.copy(e)}get cells(){return this._cells}set maxLightsPerCell(e){this._maxLightsPerCell=Q.clamp(e,1,255)}get maxLightsPerCell(){return this._maxLightsPerCell}set cookieAtlasResolution(e){this._cookieAtlasResolution=Q.clamp(e,32,this._maxTextureSize)}get cookieAtlasResolution(){return this._cookieAtlasResolution}set shadowAtlasResolution(e){this._shadowAtlasResolution=Q.clamp(e,32,this._maxTextureSize)}get shadowAtlasResolution(){return this._shadowAtlasResolution}set shadowType(e){this._shadowType!==e&&(this._shadowType=e,this._dirtyLightsFnc())}get shadowType(){return this._shadowType}set cookiesEnabled(e){this._cookiesEnabled!==e&&(this._cookiesEnabled=e,this._dirtyLightsFnc())}get cookiesEnabled(){return this._cookiesEnabled}set areaLightsEnabled(e){this._supportsAreaLights&&this._areaLightsEnabled!==e&&(this._areaLightsEnabled=e,this._dirtyLightsFnc())}get areaLightsEnabled(){return this._areaLightsEnabled}set shadowsEnabled(e){this._shadowsEnabled!==e&&(this._shadowsEnabled=e,this._dirtyLightsFnc())}get shadowsEnabled(){return this._shadowsEnabled}}class vh{constructor(e){this.morph=e,e.incRefCount(),this.device=e.device;const t=e._targets.length;this.shader=this._createShader(t),this._weights=[],this._weightMap=new Map;for(let a=0;a<e._targets.length;a++){const o=e._targets[a];o.name&&this._weightMap.set(o.name,a),this.setWeight(a,o.defaultWeight)}this._shaderMorphWeights=new Float32Array(t),this._shaderMorphIndex=new Uint32Array(t);const i=(a,o)=>(this[o]=e._createTexture(a,e._renderTextureFormat),new Zi({colorBuffer:this[o],depth:!1}));e.morphPositions&&(this.rtPositions=i("MorphRTPos","texturePositions")),e.morphNormals&&(this.rtNormals=i("MorphRTNrm","textureNormals")),this._textureParams=new Float32Array([e.morphTextureWidth,e.morphTextureHeight]);const s=e.aabb.halfExtents;this._aabbSize=new Float32Array([s.x*4,s.y*4,s.z*4]);const n=e.aabb.getMin();this._aabbMin=new Float32Array([n.x*2,n.y*2,n.z*2]),this._aabbNrmSize=new Float32Array([2,2,2]),this._aabbNrmMin=new Float32Array([-1,-1,-1]),this.aabbSizeId=this.device.scope.resolve("aabbSize"),this.aabbMinId=this.device.scope.resolve("aabbMin"),this.morphTextureId=this.device.scope.resolve("morphTexture"),this.morphFactor=this.device.scope.resolve("morphFactor[0]"),this.morphIndex=this.device.scope.resolve("morphIndex[0]"),this.countId=this.device.scope.resolve("count"),this.zeroTextures=!1}destroy(){var t,i,s,n;this.shader=null;const e=this.morph;e&&(this.morph=null,e.decRefCount(),e.refCount<1&&e.destroy()),(t=this.rtPositions)==null||t.destroy(),this.rtPositions=null,(i=this.texturePositions)==null||i.destroy(),this.texturePositions=null,(s=this.rtNormals)==null||s.destroy(),this.rtNormals=null,(n=this.textureNormals)==null||n.destroy(),this.textureNormals=null}clone(){return new vh(this.morph)}_getWeightIndex(e){return typeof e=="string"?this._weightMap.get(e):e}getWeight(e){const t=this._getWeightIndex(e);return this._weights[t]}setWeight(e,t){const i=this._getWeightIndex(e);this._weights[i]=t,this._dirty=!0}_createShader(e){const t=new Map;t.set("{MORPH_TEXTURE_MAX_COUNT}",e),this.morph.intRenderFormat&&t.set("MORPH_INT","");const i=this.morph.intRenderFormat?"uvec4":"vec4";return Tr.createShader(this.device,{uniqueName:"TextureMorphShader",attributes:{vertex_position:Xe},vertexChunk:"morphVS",fragmentChunk:"morphPS",fragmentDefines:t,fragmentOutputTypes:[i]})}_updateTextureRenderTarget(e,t,i){const{morph:s,device:n}=this;this.setAabbUniforms(i),this.morphTextureId.setValue(i?s.targetsTexturePositions:s.targetsTextureNormals),n.setBlendState(sr.NOBLEND),this.countId.setValue(t),this.morphFactor.setValue(this._shaderMorphWeights),this.morphIndex.setValue(this._shaderMorphIndex),Tc(n,e,this.shader)}_updateTextureMorph(e){this.device,(e>0||!this.zeroTextures)&&(this.rtPositions&&this._updateTextureRenderTarget(this.rtPositions,e,!0),this.rtNormals&&this._updateTextureRenderTarget(this.rtNormals,e,!1),this.zeroTextures=e===0)}setAabbUniforms(e=!0){this.aabbSizeId.setValue(e?this._aabbSize:this._aabbNrmSize),this.aabbMinId.setValue(e?this._aabbMin:this._aabbNrmMin)}prepareRendering(e){this.setAabbUniforms()}update(){this._dirty=!1;const e=this.morph._targets,t=1e-5,i=this._shaderMorphWeights,s=this._shaderMorphIndex;let n=0;for(let a=0;a<e.length;a++)Math.abs(this.getWeight(a))>t&&(i[n]=this.getWeight(a),s[n]=a,n++);this._updateTextureMorph(n)}}class al{constructor(){this.graph=null,this.meshInstances=[],this.skinInstances=[],this.morphInstances=[],this.cameras=[],this.lights=[],this._shadersVersion=0,this._immutable=!1}getGraph(){return this.graph}setGraph(e){this.graph=e}getCameras(){return this.cameras}setCameras(e){this.cameras=e}getLights(){return this.lights}setLights(e){this.lights=e}getMaterials(){const e=[];for(let t=0;t<this.meshInstances.length;t++){const i=this.meshInstances[t];e.indexOf(i.material)===-1&&e.push(i.material)}return e}clone(){const e=[],t=[],i=function(c){const u=c.clone();e.push(c),t.push(u);for(let h=0;h<c._children.length;h++)u.addChild(i(c._children[h]));return u},s=i(this.graph),n=[],a=[],o=[];for(let c=0;c<this.skinInstances.length;c++){const u=this.skinInstances[c].skin,h=new Cy(u),d=[];for(let f=0;f<u.boneNames.length;f++){const p=u.boneNames[f],m=s.findByName(p);d.push(m)}h.bones=d,a.push(h)}for(let c=0;c<this.morphInstances.length;c++){const u=this.morphInstances[c].morph,h=new vh(u);o.push(h)}for(let c=0;c<this.meshInstances.length;c++){const u=this.meshInstances[c],h=e.indexOf(u.node),d=new Dt(u.mesh,u.material,t[h]);if(u.skinInstance){const f=this.skinInstances.indexOf(u.skinInstance);d.skinInstance=a[f]}if(u.morphInstance){const f=this.morphInstances.indexOf(u.morphInstance);d.morphInstance=o[f]}n.push(d)}const l=new al;return l.graph=s,l.meshInstances=n,l.skinInstances=a,l.morphInstances=o,l.getGraph().syncHierarchy(),l}destroy(){const e=this.meshInstances;for(let t=0;t<e.length;t++)e[t].destroy();this.meshInstances.length=0}generateWireframe(){Dt._prepareRenderStyleForArray(this.meshInstances,su)}}class F9 extends DE{constructor(e,t,{preferHighPrecision:i=!1}={}){super(),this.device=t;const s=t;this.preferHighPrecision=i,this._targets=e.slice();const n=s.textureHalfFloatRenderable?wi:void 0,a=s.textureFloatRenderable?or:void 0;this._renderTextureFormat=this.preferHighPrecision?a??n:n??a,this._renderTextureFormat=this._renderTextureFormat??pE,this.intRenderFormat=Xd(this._renderTextureFormat),this._textureFormat=this.preferHighPrecision?or:wi,this._init(),this._updateMorphFlags()}destroy(){var e,t,i;(e=this.vertexBufferIds)==null||e.destroy(),this.vertexBufferIds=null,(t=this.targetsTexturePositions)==null||t.destroy(),this.targetsTexturePositions=null,(i=this.targetsTextureNormals)==null||i.destroy(),this.targetsTextureNormals=null}get aabb(){if(!this._aabb){const e=new O,t=new O;for(let i=0;i<this._targets.length;i++){const s=this._targets[i].aabb;e.min(s.getMin()),t.max(s.getMax())}this._aabb=new We,this._aabb.setMinMax(e,t)}return this._aabb}get morphPositions(){return this._morphPositions}get morphNormals(){return this._morphNormals}_init(){this._initTextureBased();for(let e=0;e<this._targets.length;e++)this._targets[e]._postInit()}_findSparseSet(e,t,i){let s=1;const n=e[0].length;for(let a=0;a<n;a+=3){let o=!1;for(let l=0;l<e.length;l++){const c=e[l];if(c[a]!==0||c[a+1]!==0||c[a+2]!==0){o=!0;break}}o?(t.push(s),i.push(a/3),s++):t.push(0)}return s}_initTextureBased(){const e=[],t=[],i=this._targets;for(let g=0;g<i.length;g++){const _=i[g];_.options.deltaPositions&&(e.push(_.options.deltaPositions),t.push(!0)),_.options.deltaNormals&&(e.push(_.options.deltaNormals),t.push(!1))}const s=[],n=[],a=this._findSparseSet(e,s,n),o=this.device.maxTextureSize;let l=Math.ceil(Math.sqrt(a));l=Math.min(l,o);const c=Math.ceil(a/l);if(c>o)return;this.morphTextureWidth=l,this.morphTextureHeight=c;let u=!1;const h=ah.float2Half;this._textureFormat===wi&&(u=!0);const d=[],f=[],p=l*c*4;for(let g=0;g<e.length;g++){const _=e[g],v=this._textureFormat===wi?new Uint16Array(p):new Float32Array(p);if((t[g]?d:f).push(v),u)for(let y=0;y<n.length;y++){const x=n[y]*3,S=y*4+4;v[S]=h(_[x]),v[S+1]=h(_[x+1]),v[S+2]=h(_[x+2])}else for(let y=0;y<n.length;y++){const x=n[y]*3,S=y*4+4;v[S]=_[x],v[S+1]=_[x+1],v[S+2]=_[x+2]}}d.length>0&&(this.targetsTexturePositions=this._createTexture("MorphPositionsTexture",this._textureFormat,i.length,[d]),this.targetsTexturePositions.upload()),f.length>0&&(this.targetsTextureNormals=this._createTexture("MorphNormalsTexture",this._textureFormat,i.length,[f]),this.targetsTextureNormals.upload());const m=[{semantic:ap,components:1,type:xE,asInt:!0}];return this.vertexBufferIds=new Ya(this.device,new Ls(this.device,m,s.length),s.length,{data:new Uint32Array(s)}),!0}get targets(){return this._targets}_updateMorphFlags(){this._morphPositions=!1,this._morphNormals=!1;for(let e=0;e<this._targets.length;e++){const t=this._targets[e];t.morphPositions&&(this._morphPositions=!0),t.morphNormals&&(this._morphNormals=!0)}}_createTexture(e,t,i,s){return new we(this.device,{levels:s,arrayLength:i,width:this.morphTextureWidth,height:this.morphTextureHeight,format:t,cubemap:!1,mipmaps:!1,minFilter:qe,magFilter:qe,addressU:ge,addressV:ge,name:e})}}class $E{constructor(e){this.used=!1,this.options=e,this._name=e.name,this._defaultWeight=e.defaultWeight||0,this._aabb=e.aabb,this.deltaPositions=e.deltaPositions,this.morphPositions=!!e.deltaPositions,this.morphNormals=!!e.deltaNormals}get name(){return this._name}get defaultWeight(){return this._defaultWeight}get aabb(){return this._aabb||(this._aabb=new We,this.deltaPositions&&this._aabb.compute(this.deltaPositions)),this._aabb}clone(){return new $E(this.options)}_postInit(){this.options.preserveData||(this.options=null),this.used=!0}}let no,YU=1;const fe=4,IC=new se,MC=new se,aa=new O,kt=new O,Sn=new O,sd=new O,cs=new O,mi=new O,nd=new O,ad=new O,Qm=new O,KU=new O,fr=new O,W0=new O,Hc=new O;function Kd(r){return r-Math.floor(r)}function zge(r){return Math.max(Math.min(r,1),0)}function RC(r,e){return r-e*Math.floor(r/e)}function Vge(r){let e=Kd(r),t=Kd(255*r),i=Kd(65025*r),s=Kd(160581375*r);return e-=t/255,t-=i/255,i-=s/255,s-=s/255,[e,t,i,s]}function X0(r){let e=Kd(r),t=Kd(255*r);return e-=t/255,t-=t/255,[e,t]}class jge{constructor(e){this._emitter=e}calcSpawnPosition(e,t,i,s,n){const a=this._emitter,o=Math.random(),l=Math.random(),c=Math.random(),u=Math.random();if(a.useCpu&&(e[n*fe+0+a.numParticlesPot*2*fe]=o,e[n*fe+1+a.numParticlesPot*2*fe]=l,e[n*fe+2+a.numParticlesPot*2*fe]=c),kt.x=o-.5,kt.y=l-.5,kt.z=c-.5,a.emitterShape===_a){const f=Math.max(Math.abs(kt.x),Math.max(Math.abs(kt.y),Math.abs(kt.z))),p=f+(.5-f)*i[0],m=f+(.5-f)*i[1],g=f+(.5-f)*i[2];kt.x=p*(f===Math.abs(kt.x)?Math.sign(kt.x):2*kt.x),kt.y=m*(f===Math.abs(kt.y)?Math.sign(kt.y):2*kt.y),kt.z=g*(f===Math.abs(kt.z)?Math.sign(kt.z):2*kt.z),a.localSpace?aa.copy(t.transformPoint(kt)):aa.copy(s).add(t.transformPoint(kt))}else{kt.normalize();const f=a.emitterRadius===0?0:a.emitterRadiusInner/a.emitterRadius,p=u*(1-f)+f;a.localSpace?aa.copy(kt.mulScalar(p*a.emitterRadius)):aa.copy(s).add(kt.mulScalar(p*a.emitterRadius))}let d=-Q.lerp(a.rate,a.rate2,o)*n;if(a.pack8){const f=(aa.x-a.worldBounds.center.x)/a.worldBoundsSize.x+.5,p=(aa.y-a.worldBounds.center.y)/a.worldBoundsSize.y+.5,m=(aa.z-a.worldBounds.center.z)/a.worldBoundsSize.z+.5;let g=Q.lerp(a.startAngle*Q.DEG_TO_RAD,a.startAngle2*Q.DEG_TO_RAD,o);g=g%(Math.PI*2)/(Math.PI*2);const _=X0(f);e[n*fe]=_[0],e[n*fe+1]=_[1];const v=X0(p);e[n*fe+2]=v[0],e[n*fe+3]=v[1];const y=X0(m);e[n*fe+0+a.numParticlesPot*fe]=y[0],e[n*fe+1+a.numParticlesPot*fe]=y[1];const x=X0(g);e[n*fe+2+a.numParticlesPot*fe]=x[0],e[n*fe+3+a.numParticlesPot*fe]=x[1];const S=1;e[n*fe+3+a.numParticlesPot*fe*2]=S;const w=Math.max(a.lifetime,(a.numParticles-1)*Math.max(a.rate,a.rate2)),T=a.lifetime+1;d=(d+w)/(w+T);const A=Vge(d);e[n*fe+0+a.numParticlesPot*fe*3]=A[0],e[n*fe+1+a.numParticlesPot*fe*3]=A[1],e[n*fe+2+a.numParticlesPot*fe*3]=A[2],e[n*fe+3+a.numParticlesPot*fe*3]=A[3]}else e[n*fe]=aa.x,e[n*fe+1]=aa.y,e[n*fe+2]=aa.z,e[n*fe+3]=Q.lerp(a.startAngle*Q.DEG_TO_RAD,a.startAngle2*Q.DEG_TO_RAD,o),e[n*fe+3+a.numParticlesPot*fe]=d}update(e,t,i,s,n,a,o,l){let c,u,h;const d=this._emitter;if(d.meshInstance.node){const C=d.meshInstance.node.worldTransform;for(let P=0;P<12;P++)IC.data[P]=C.data[P];MC.copy(IC),MC.invert(),no=d.meshInstance.node.localScale,YU=Math.max(Math.max(no.x,no.y),no.z)}a=d.meshInstance.node===null||d.localSpace?O.ZERO:d.meshInstance.node.getPosition();const f=d.camera?d.camera._node.getPosition():O.ZERO,p=d.useMesh?17:15;let m,g,_,v,y,x,S,w,T;const A=d.precision-1;for(let C=0;C<d.numParticles;C++){const P=Math.floor(d.vbCPU[C*d.numParticleVerts*(d.useMesh?6:4)+3]),I=i[P*fe+0+d.numParticlesPot*2*fe];Sn.x=I,Sn.y=i[P*fe+1+d.numParticlesPot*2*fe],Sn.z=i[P*fe+2+d.numParticlesPot*2*fe];const M=d.rate+(d.rate2-d.rate)*I,N=d.lifetime;let k=i[P*fe+3+d.numParticlesPot*fe]+o;const V=zge(k/N);let B=0,R=0;const L=0;(k-o<=0||k>=N)&&this.calcSpawnPosition(i,s,n,a,P);let F=k>0&&k<N;F&&(h=V*A,m=Math.floor(h),g=Math.ceil(h),h%=1,c=d.qRotSpeed[m],u=d.qRotSpeed[g],_=c+(u-c)*h,c=d.qRotSpeed2[m],u=d.qRotSpeed2[g],v=c+(u-c)*h,c=d.qScale[m],u=d.qScale[g],B=c+(u-c)*h,c=d.qScale2[m],u=d.qScale2[g],y=c+(u-c)*h,c=d.qAlpha[m],u=d.qAlpha[g],x=c+(u-c)*h,c=d.qAlpha2[m],u=d.qAlpha2[g],S=c+(u-c)*h,c=d.qRadialSpeed[m],u=d.qRadialSpeed[g],w=c+(u-c)*h,c=d.qRadialSpeed2[m],u=d.qRadialSpeed2[g],T=c+(u-c)*h,w+=(T-w)*(I*100%1),sd.x=i[P*fe],sd.y=i[P*fe+1],sd.z=i[P*fe+2],d.localSpace?Qm.copy(sd):Qm.copy(sd).sub(a),Qm.normalize().mulScalar(w),m*=3,g*=3,c=d.qLocalVelocity[m],u=d.qLocalVelocity[g],mi.x=c+(u-c)*h,c=d.qLocalVelocity[m+1],u=d.qLocalVelocity[g+1],mi.y=c+(u-c)*h,c=d.qLocalVelocity[m+2],u=d.qLocalVelocity[g+2],mi.z=c+(u-c)*h,c=d.qLocalVelocity2[m],u=d.qLocalVelocity2[g],ad.x=c+(u-c)*h,c=d.qLocalVelocity2[m+1],u=d.qLocalVelocity2[g+1],ad.y=c+(u-c)*h,c=d.qLocalVelocity2[m+2],u=d.qLocalVelocity2[g+2],ad.z=c+(u-c)*h,c=d.qVelocity[m],u=d.qVelocity[g],cs.x=c+(u-c)*h,c=d.qVelocity[m+1],u=d.qVelocity[g+1],cs.y=c+(u-c)*h,c=d.qVelocity[m+2],u=d.qVelocity[g+2],cs.z=c+(u-c)*h,c=d.qVelocity2[m],u=d.qVelocity2[g],nd.x=c+(u-c)*h,c=d.qVelocity2[m+1],u=d.qVelocity2[g+1],nd.y=c+(u-c)*h,c=d.qVelocity2[m+2],u=d.qVelocity2[g+2],nd.z=c+(u-c)*h,mi.x+=(ad.x-mi.x)*Sn.x,mi.y+=(ad.y-mi.y)*Sn.y,mi.z+=(ad.z-mi.z)*Sn.z,d.initialVelocity>0&&(d.emitterShape===qpe?(kt.copy(Sn).mulScalar(2).sub(O.ONE).normalize(),mi.add(kt.mulScalar(d.initialVelocity))):mi.add(O.FORWARD.mulScalar(d.initialVelocity))),cs.x+=(nd.x-cs.x)*Sn.x,cs.y+=(nd.y-cs.y)*Sn.y,cs.z+=(nd.z-cs.z)*Sn.z,_+=(v-_)*Sn.y,B=(B+(y-B)*(I*1e4%1))*YU,R=(S-x)*(I*1e3%1),d.meshInstance.node&&(d.localSpace?(mi.x/=no.x,mi.y/=no.y,mi.z/=no.z):IC.transformPoint(mi,mi)),d.localSpace?(MC.transformPoint(cs,cs),mi.add(cs).add(Qm)):(mi.add(cs.mul(no)),mi.add(Qm.mul(no))),W0.copy(mi),KU.copy(sd).add(mi.mulScalar(o)),fr.copy(KU),i[P*fe]=fr.x,i[P*fe+1]=fr.y,i[P*fe+2]=fr.z,i[P*fe+3]+=_*o,d.wrap&&d.wrapBounds&&(d.localSpace||fr.sub(a),fr.x=RC(fr.x,d.wrapBounds.x)-d.wrapBounds.x*.5,fr.y=RC(fr.y,d.wrapBounds.y)-d.wrapBounds.y*.5,fr.z=RC(fr.z,d.wrapBounds.z)-d.wrapBounds.z*.5,d.localSpace||fr.add(a)),d.sort>0&&(d.sort===1?(Hc.copy(fr).sub(f),d.particleDistance[P]=-(Hc.x*Hc.x+Hc.y*Hc.y+Hc.z*Hc.z)):d.sort===2?d.particleDistance[P]=k:d.sort===3&&(d.particleDistance[P]=-k))),l?k<0&&(i[P*fe+3+d.numParticlesPot*2*fe]=-1):(k>=N&&(k-=Math.max(N,(d.numParticles-1)*M),i[P*fe+3+d.numParticlesPot*2*fe]=d.loop?1:-1),k<0&&d.loop&&(i[P*fe+3+d.numParticlesPot*2*fe]=1)),i[P*fe+3+d.numParticlesPot*2*fe]<0&&(F=!1),i[P*fe+3+d.numParticlesPot*fe]=k;for(let j=0;j<d.numParticleVerts;j++){const z=(C*d.numParticleVerts+j)*(d.useMesh?6:4);let $=d.vbCPU[z],H=d.vbCPU[z+1],G=d.vbCPU[z+2];F||($=H=G=0);const Y=C*d.numParticleVerts*p+j*p;e[Y]=fr.x,e[Y+1]=fr.y,e[Y+2]=fr.z,e[Y+3]=V,e[Y+4]=d.alignToMotion?L:i[P*fe+3],e[Y+5]=B,e[Y+6]=R,e[Y+7]=W0.x,e[Y+8]=$,e[Y+9]=H,e[Y+10]=G,e[Y+11]=W0.y,e[Y+12]=P,e[Y+13]=W0.z,e[Y+14]=d.vbCPU[z+3],d.useMesh&&(e[Y+15]=d.vbCPU[z+4],e[Y+16]=d.vbCPU[z+5])}}if(d.sort>EM&&d.camera){const C=d.useMesh?6:4,P=d.particleDistance;for(let I=0;I<d.numParticles;I++)t[I][0]=I,t[I][1]=P[Math.floor(d.vbCPU[I*d.numParticleVerts*C+3])];d.vbOld.set(d.vbCPU),t.sort((I,M)=>I[1]-M[1]);for(let I=0;I<d.numParticles;I++){const M=t[I][0]*d.numParticleVerts*C,N=I*d.numParticleVerts*C;for(let k=0;k<d.numParticleVerts*C;k++)d.vbCPU[N+k]=d.vbOld[M+k]}}}}const ZU=new Ba,QU=new Ba,JU=new Ba;class $ge{constructor(e,t){this._emitter=e,this.frameRandomUniform=new Float32Array(3),this.emitterPosUniform=new Float32Array(3),this.emitterScaleUniform=new Float32Array([1,1,1]),this.worldBoundsMulUniform=new Float32Array(3),this.worldBoundsAddUniform=new Float32Array(3),this.inBoundsSizeUniform=new Float32Array(3),this.inBoundsCenterUniform=new Float32Array(3),this.constantParticleTexIN=t.scope.resolve("particleTexIN"),this.constantParticleTexOUT=t.scope.resolve("particleTexOUT"),this.constantEmitterPos=t.scope.resolve("emitterPos"),this.constantEmitterScale=t.scope.resolve("emitterScale"),this.constantSpawnBounds=t.scope.resolve("spawnBounds"),this.constantSpawnPosInnerRatio=t.scope.resolve("spawnPosInnerRatio"),this.constantSpawnBoundsSphere=t.scope.resolve("spawnBoundsSphere"),this.constantSpawnBoundsSphereInnerRatio=t.scope.resolve("spawnBoundsSphereInnerRatio"),this.constantInitialVelocity=t.scope.resolve("initialVelocity"),this.constantFrameRandom=t.scope.resolve("frameRandom"),this.constantDelta=t.scope.resolve("delta"),this.constantRate=t.scope.resolve("rate"),this.constantRateDiv=t.scope.resolve("rateDiv"),this.constantLifetime=t.scope.resolve("lifetime"),this.constantGraphSampleSize=t.scope.resolve("graphSampleSize"),this.constantGraphNumSamples=t.scope.resolve("graphNumSamples"),this.constantInternalTex0=t.scope.resolve("internalTex0"),this.constantInternalTex1=t.scope.resolve("internalTex1"),this.constantInternalTex2=t.scope.resolve("internalTex2"),this.constantInternalTex3=t.scope.resolve("internalTex3"),this.constantEmitterMatrix=t.scope.resolve("emitterMatrix"),this.constantEmitterMatrixInv=t.scope.resolve("emitterMatrixInv"),this.constantNumParticles=t.scope.resolve("numParticles"),this.constantNumParticlesPot=t.scope.resolve("numParticlesPot"),this.constantLocalVelocityDivMult=t.scope.resolve("localVelocityDivMult"),this.constantVelocityDivMult=t.scope.resolve("velocityDivMult"),this.constantRotSpeedDivMult=t.scope.resolve("rotSpeedDivMult"),this.constantSeed=t.scope.resolve("seed"),this.constantStartAngle=t.scope.resolve("startAngle"),this.constantStartAngle2=t.scope.resolve("startAngle2"),this.constantOutBoundsMul=t.scope.resolve("outBoundsMul"),this.constantOutBoundsAdd=t.scope.resolve("outBoundsAdd"),this.constantInBoundsSize=t.scope.resolve("inBoundsSize"),this.constantInBoundsCenter=t.scope.resolve("inBoundsCenter"),this.constantMaxVel=t.scope.resolve("maxVel"),this.constantFaceTangent=t.scope.resolve("faceTangent"),this.constantFaceBinorm=t.scope.resolve("faceBinorm")}_setInputBounds(){this.inBoundsSizeUniform[0]=this._emitter.prevWorldBoundsSize.x,this.inBoundsSizeUniform[1]=this._emitter.prevWorldBoundsSize.y,this.inBoundsSizeUniform[2]=this._emitter.prevWorldBoundsSize.z,this.constantInBoundsSize.setValue(this.inBoundsSizeUniform),this.inBoundsCenterUniform[0]=this._emitter.prevWorldBoundsCenter.x,this.inBoundsCenterUniform[1]=this._emitter.prevWorldBoundsCenter.y,this.inBoundsCenterUniform[2]=this._emitter.prevWorldBoundsCenter.z,this.constantInBoundsCenter.setValue(this.inBoundsCenterUniform)}randomize(){this.frameRandomUniform[0]=Math.random(),this.frameRandomUniform[1]=Math.random(),this.frameRandomUniform[2]=Math.random()}update(e,t,i,s,n){const a=this._emitter;e.setBlendState(sr.NOBLEND),e.setDepthState(Ds.NODEPTH),e.setCullMode(Vi),this.randomize(),this.constantGraphSampleSize.setValue(1/a.precision),this.constantGraphNumSamples.setValue(a.precision),this.constantNumParticles.setValue(a.numParticles),this.constantNumParticlesPot.setValue(a.numParticlesPot),this.constantInternalTex0.setValue(a.internalTex0),this.constantInternalTex1.setValue(a.internalTex1),this.constantInternalTex2.setValue(a.internalTex2),this.constantInternalTex3.setValue(a.internalTex3);const o=a.meshInstance.node,l=o===null?O.ONE:o.localScale;if(a.pack8){this.worldBoundsMulUniform[0]=a.worldBoundsMul.x,this.worldBoundsMulUniform[1]=a.worldBoundsMul.y,this.worldBoundsMulUniform[2]=a.worldBoundsMul.z,this.constantOutBoundsMul.setValue(this.worldBoundsMulUniform),this.worldBoundsAddUniform[0]=a.worldBoundsAdd.x,this.worldBoundsAddUniform[1]=a.worldBoundsAdd.y,this.worldBoundsAddUniform[2]=a.worldBoundsAdd.z,this.constantOutBoundsAdd.setValue(this.worldBoundsAddUniform),this._setInputBounds();let f=a.maxVel*Math.max(Math.max(l.x,l.y),l.z);f=Math.max(f,1),this.constantMaxVel.setValue(f)}const c=o===null||a.localSpace?O.ZERO:o.getPosition(),u=o===null?se.IDENTITY:o.getWorldTransform();a.emitterShape===_a?(ZU.setFromMat4(t),this.constantSpawnBounds.setValue(ZU.data),this.constantSpawnPosInnerRatio.setValue(i)):(this.constantSpawnBoundsSphere.setValue(a.emitterRadius),this.constantSpawnBoundsSphereInnerRatio.setValue(a.emitterRadius===0?0:a.emitterRadiusInner/a.emitterRadius)),this.constantInitialVelocity.setValue(a.initialVelocity),QU.setFromMat4(u),JU.invertMat4(u),this.emitterPosUniform[0]=c.x,this.emitterPosUniform[1]=c.y,this.emitterPosUniform[2]=c.z,this.constantEmitterPos.setValue(this.emitterPosUniform),this.constantFrameRandom.setValue(this.frameRandomUniform),this.constantDelta.setValue(s),this.constantRate.setValue(a.rate),this.constantRateDiv.setValue(a.rate2-a.rate),this.constantStartAngle.setValue(a.startAngle*Q.DEG_TO_RAD),this.constantStartAngle2.setValue(a.startAngle2*Q.DEG_TO_RAD),this.constantSeed.setValue(a.seed),this.constantLifetime.setValue(a.lifetime),this.emitterScaleUniform[0]=l.x,this.emitterScaleUniform[1]=l.y,this.emitterScaleUniform[2]=l.z,this.constantEmitterScale.setValue(this.emitterScaleUniform),this.constantEmitterMatrix.setValue(QU.data),this.constantEmitterMatrixInv.setValue(JU.data),this.constantLocalVelocityDivMult.setValue(a.localVelocityUMax),this.constantVelocityDivMult.setValue(a.velocityUMax),this.constantRotSpeedDivMult.setValue(a.rotSpeedUMax[0]);let h=a.swapTex?a.particleTexOUT:a.particleTexIN;h=a.beenReset?a.particleTexStart:h;const d=a.swapTex?a.particleTexIN:a.particleTexOUT;this.constantParticleTexIN.setValue(h),Tc(e,a.swapTex?a.rtParticleTexIN:a.rtParticleTexOUT,n?a.shaderParticleUpdateOnStop:a.loop?a.shaderParticleUpdateRespawn:a.shaderParticleUpdateNoRespawn),a.material.setParameter("particleTexOUT",h),a.material.setParameter("particleTexIN",d),a.beenReset=!1,a.swapTex=!a.swapTex,a.prevWorldBoundsSize.copy(a.worldBoundsSize),a.prevWorldBoundsCenter.copy(a.worldBounds.center),a.pack8&&this._setInputBounds()}}const ez=["NONE","VERTEX","MAP"];class Hge extends gh{generateKey(e){let i=`particle_${gh.definesHash(e.defines)}_`;for(const s in e)e.hasOwnProperty(s)&&(i+=e[s]);return i}createVertexDefines(e,t){const i=new Map(e.defines);return e.mesh&&i.set("USE_MESH",""),e.meshUv&&i.set("USE_MESH_UV",""),e.localSpace&&i.set("LOCAL_SPACE",""),e.screenSpace&&i.set("SCREEN_SPACE",""),e.animTex&&i.set("ANIMTEX",""),e.soft>0&&i.set("SOFT",""),e.stretch>0&&i.set("STRETCH",""),e.customFace&&i.set("CUSTOM_FACE",""),e.pack8&&i.set("PACK8",""),e.localSpace&&i.set("LOCAL_SPACE",""),e.animTexLoop&&i.set("ANIMTEX_LOOP",""),e.wrap&&i.set("WRAP",""),e.alignToMotion&&i.set("ALIGN_TO_MOTION",""),i.set("NORMAL",ez[e.normal]),t.particle_vertexData=Xe,e.mesh&&e.meshUv&&(t.particle_uv=un),i}createFragmentDefines(e){const t=new Map(e.defines);return e.soft>0&&t.set("SOFT",""),e.halflambert&&t.set("HALF_LAMBERT",""),t.set("NORMAL",ez[e.normal]),t.set("BLEND",a9[e.blend]),t}createShaderDefinition(e,t){const i=e.isWebGPU?Gt:dt,s=$e.get(e,i),n={},a=this.createVertexDefines(t,n),o=this.createFragmentDefines(t),l=`PARTICLE_${t.useCpu?"CPU":"GPU"}
`;a.set(l,""),o.set(l,"");const c=new Map(s);return Wr.createDefinition(e,{name:"ParticleShader",shaderLanguage:i,attributes:n,vertexCode:s.get("particle_shaderVS"),fragmentCode:s.get("particle_shaderPS"),fragmentDefines:o,fragmentIncludes:c,vertexIncludes:c,vertexDefines:a})}}const Gge=new Hge;class Wge extends My{constructor(e){super(),this.emitter=null,this.emitter=e}getShaderVariant(e){const{device:t,scene:i,cameraShaderParams:s,objDefs:n}=e,{emitter:a}=this,o={defines:Tr.getCoreDefines(this,e),pass:Nh,useCpu:this.emitter.useCpu,normal:a.lighting?a.normalMap!==null?2:1:0,halflambert:this.emitter.halfLambert,stretch:this.emitter.stretch,alignToMotion:this.emitter.alignToMotion,soft:this.emitter.depthSoftening,mesh:this.emitter.useMesh,meshUv:n&R3,gamma:(s==null?void 0:s.shaderOutputGamma)??Ay,toneMap:(s==null?void 0:s.toneMapping)??A3,fog:i&&!this.emitter.noFog?i.fog.type:"none",wrap:this.emitter.wrap&&this.emitter.wrapBounds,localSpace:this.emitter.localSpace,screenSpace:a.inTools?!1:this.emitter.screenSpace,blend:this.emitter.blendType,animTex:this.emitter._isAnimated(),animTexLoop:this.emitter.animLoop,pack8:this.emitter.pack8,customFace:this.emitter.orientation!==gb},l=new jE(e.viewUniformFormat,e.viewBindGroupFormat,e.vertexFormat),c=gp(t);return c.register("particle",Gge),c.getProgram("particle",o,l,this.userId)}}const tz=[[-1,-1],[1,-1],[1,1],[-1,1]];function zs(r,e,t,i,s=or,n,a){let o=qe;a&&(s===ct||s===Ms)&&(o=_i);const l=new we(r,{width:e,height:t,format:s,cubemap:!1,mipmaps:!1,minFilter:o,magFilter:o,addressU:ge,addressV:ge,name:"ParticleSystemTexture"}),c=l.lock();if(s===ct||s===Ms){const u=new Uint8Array(i.length);for(let h=0;h<i.length;h++)u[h]=i[h]*n*255;i=u}return c.set(i),l.unlock(),l}function iz(r){return Math.max(Math.min(r,1),0)}const rz=new jn([0,0,1,0]),sz=new jn([0,1,1,1]),nz=new Uu([0,0,1,0],[0,0,1,0],[0,0,1,0]),Xge=new Uu([0,1,1,1],[0,1,1,1],[0,1,1,1]);let ao=2;const q0=4,oo=new Float32Array(3),Gc=new se,az=new O,Y0=new O,K0=new O;let RM,lx;function me(r,e){lx[r]!==void 0&&lx[r]!==null?RM[r]=lx[r]:RM[r]=e}function B9(r,e,t){return(r*255<<16|e*255<<8|t*255)/(1<<24)}function oz(r,e){const t=r.length/3,i=new Array(t*4);for(let s=0;s<t;s++)i[s*4]=r[s*3],i[s*4+1]=r[s*3+1],i[s*4+2]=r[s*3+2],i[s*4+3]=B9(e[s*3],e[s*3+1],e[s*3+2]);return i}function qge(r,e){const t=new Array(e.length*4);for(let i=0;i<e.length;i++)t[i*4]=r[i*3],t[i*4+1]=r[i*3+1],t[i*4+2]=r[i*3+2],t[i*4+3]=e[i];return t}function Yge(r,e,t,i,s){const n=new Array(r.length*4);for(let a=0;a<r.length;a++)n[a*4]=r[a],n[a*4+1]=e[a],n[a*4+2]=0,n[a*4+3]=B9(t[a],i[a],s[a]);return n}function Kge(r,e){const t=new Array(r.length*4);for(let i=0;i<r.length;i++)t[i*4]=r[i],t[i*4+1]=e[i],t[i*4+2]=0,t[i*4+3]=0;return t}function Zge(r){const e=Math.max(r.rate,r.rate2)*r.numParticles+r.lifetime;return Date.now()+e*1e3}function Qge(r,e){const t=new Float32Array(r.length);for(let i=0;i<r.length;i++)t[i]=r[i]-e[i];return t}function nu(r,e){const t=e.length,i=r.length/t;for(let s=0;s<i;s++)for(let n=0;n<t;n++){const a=Math.abs(r[s*t+n]);e[n]=Math.max(e[n],a)}}function Jge(r,e){const t=e.length,i=r.length/t;for(let s=0;s<i;s++)for(let n=0;n<t;n++)r[s*t+n]/=e[n]===0?1:e[n],r[s*t+n]*=.5,r[s*t+n]+=.5}function Wc(r,e,t){const i=Qge(e,r);return nu(i,t),Jge(i,t),i}const e_e=new jr;class t_e{constructor(e,t){this.material=null,this.internalTex0=null,this.internalTex1=null,this.internalTex2=null,this.colorParam=null,this.graphicsDevice=e;const i=e,s=32;this.precision=s,this._addTimeTime=0,RM=this,lx=t,me("numParticles",1),this.numParticles>e.maxTextureSize&&(this.numParticles=e.maxTextureSize),me("rate",1),me("rate2",this.rate),me("lifetime",50),me("emitterExtents",new O(0,0,0)),me("emitterExtentsInner",new O(0,0,0)),me("emitterRadius",0),me("emitterRadiusInner",0),me("emitterShape",_a),me("initialVelocity",1),me("wrap",!1),me("localSpace",!1),me("screenSpace",!1),me("wrapBounds",null),me("colorMap",this.defaultParamTexture),me("normalMap",null),me("loop",!0),me("preWarm",!1),me("sort",EM),me("mode",m9),me("scene",null),me("lighting",!1),me("halfLambert",!1),me("intensity",1),me("stretch",0),me("alignToMotion",!1),me("depthSoftening",0),me("mesh",null),me("particleNormal",new O(0,1,0)),me("orientation",gb),me("depthWrite",!1),me("noFog",!1),me("blendType",Ka),me("node",null),me("startAngle",0),me("startAngle2",this.startAngle),me("animTilesX",1),me("animTilesY",1),me("animStartFrame",0),me("animNumFrames",1),me("animNumAnimations",1),me("animIndex",0),me("randomizeAnimIndex",!1),me("animSpeed",1),me("animLoop",!0),this._gpuUpdater=new $ge(this,i),this._cpuUpdater=new jge(this),this.emitterPosUniform=new Float32Array(3),this.wrapBoundsUniform=new Float32Array(3),this.emitterScaleUniform=new Float32Array([1,1,1]),me("colorGraph",Xge),me("colorGraph2",this.colorGraph),me("scaleGraph",sz),me("scaleGraph2",this.scaleGraph),me("alphaGraph",sz),me("alphaGraph2",this.alphaGraph),me("localVelocityGraph",nz),me("localVelocityGraph2",this.localVelocityGraph),me("velocityGraph",nz),me("velocityGraph2",this.velocityGraph),me("rotationSpeedGraph",rz),me("rotationSpeedGraph2",this.rotationSpeedGraph),me("radialSpeedGraph",rz),me("radialSpeedGraph2",this.radialSpeedGraph),this.animTilesParams=new Float32Array(2),this.animParams=new Float32Array(4),this.animIndexParams=new Float32Array(2),this.vbToSort=null,this.vbOld=null,this.particleDistance=null,this.camera=null,this.swapTex=!1,this.useMesh=!0,this.useCpu=!e.supportsGpuParticles,this.pack8=!0,this.localBounds=new We,this.worldBoundsNoTrail=new We,this.worldBoundsTrail=[new We,new We],this.worldBounds=new We,this.worldBoundsSize=new O,this.prevWorldBoundsSize=new O,this.prevWorldBoundsCenter=new O,this.prevEmitterExtents=this.emitterExtents,this.prevEmitterRadius=this.emitterRadius,this.worldBoundsMul=new O,this.worldBoundsAdd=new O,this.timeToSwitchBounds=0,this.shaderParticleUpdateRespawn=null,this.shaderParticleUpdateNoRespawn=null,this.shaderParticleUpdateOnStop=null,this.numParticleVerts=0,this.numParticleIndices=0,this.material=null,this.meshInstance=null,this.drawOrder=0,this.seed=Math.random(),this.fixedTimeStep=1/60,this.maxSubSteps=10,this.simTime=0,this.simTimeTotal=0,this.beenReset=!1,this._layer=null,this.rebuild()}get defaultParamTexture(){return e_e.get(this.graphicsDevice,()=>{const i=new Float32Array(1024);for(let n=0;n<16;n++)for(let a=0;a<16;a++){const o=a+1-8.5,l=n+1-8.5,c=iz(1-iz(Math.sqrt(o*o+l*l)/16)-.5),u=n*16+a;i[u*4]=1,i[u*4+1]=1,i[u*4+2]=1,i[u*4+3]=c}const s=zs(this.graphicsDevice,16,16,i,Ms,1,!0);return s.minFilter=_i,s.magFilter=_i,s})}onChangeCamera(){this.resetMaterial()}calculateBoundsMad(){this.worldBoundsMul.x=1/this.worldBoundsSize.x,this.worldBoundsMul.y=1/this.worldBoundsSize.y,this.worldBoundsMul.z=1/this.worldBoundsSize.z,this.worldBoundsAdd.copy(this.worldBounds.center).mul(this.worldBoundsMul).mulScalar(-1),this.worldBoundsAdd.x+=.5,this.worldBoundsAdd.y+=.5,this.worldBoundsAdd.z+=.5}calculateWorldBounds(){if(!this.node)return;if(this.prevWorldBoundsSize.copy(this.worldBoundsSize),this.prevWorldBoundsCenter.copy(this.worldBounds.center),!this.useCpu){let i=!1;this.emitterShape===_a?i=!this.emitterExtents.equals(this.prevEmitterExtents):i=this.emitterRadius!==this.prevEmitterRadius,i&&this.calculateLocalBounds()}const e=this.node.getWorldTransform();this.localSpace?this.worldBoundsNoTrail.copy(this.localBounds):this.worldBoundsNoTrail.setFromTransformedAabb(this.localBounds,e),this.worldBoundsTrail[0].add(this.worldBoundsNoTrail),this.worldBoundsTrail[1].add(this.worldBoundsNoTrail);const t=this.simTimeTotal;t>=this.timeToSwitchBounds&&(this.worldBoundsTrail[0].copy(this.worldBoundsTrail[1]),this.worldBoundsTrail[1].copy(this.worldBoundsNoTrail),this.timeToSwitchBounds=t+this.lifetime),this.worldBounds.copy(this.worldBoundsTrail[0]),this.worldBoundsSize.copy(this.worldBounds.halfExtents).mulScalar(2),this.localSpace?(this.meshInstance.aabb.setFromTransformedAabb(this.worldBounds,e),this.meshInstance.mesh.aabb.setFromTransformedAabb(this.worldBounds,e)):(this.meshInstance.aabb.copy(this.worldBounds),this.meshInstance.mesh.aabb.copy(this.worldBounds)),this.meshInstance._aabbVer=1-this.meshInstance._aabbVer,this.pack8&&this.calculateBoundsMad()}resetWorldBounds(){this.node&&(this.worldBoundsNoTrail.setFromTransformedAabb(this.localBounds,this.localSpace?se.IDENTITY:this.node.getWorldTransform()),this.worldBoundsTrail[0].copy(this.worldBoundsNoTrail),this.worldBoundsTrail[1].copy(this.worldBoundsNoTrail),this.worldBounds.copy(this.worldBoundsTrail[0]),this.worldBoundsSize.copy(this.worldBounds.halfExtents).mulScalar(2),this.prevWorldBoundsSize.copy(this.worldBoundsSize),this.prevWorldBoundsCenter.copy(this.worldBounds.center),this.simTimeTotal=0,this.timeToSwitchBounds=0)}calculateLocalBounds(){let e=Number.MAX_VALUE,t=Number.MAX_VALUE,i=Number.MAX_VALUE,s=-Number.MAX_VALUE,n=-Number.MAX_VALUE,a=-Number.MAX_VALUE,o=0,l=0;const c=this.lifetime/this.precision,u=[this.qVelocity,this.qVelocity2],h=[this.qLocalVelocity,this.qLocalVelocity2],d=[0,0],f=[0,0],p=[0,0],m=[0,0],g=[0,0];let _,v,y;for(let S=0;S<this.precision+1;S++){const w=Math.min(S,this.precision-1);for(let T=0;T<2;T++)_=h[T][w*3+0]*c+d[T],v=h[T][w*3+1]*c+f[T],y=h[T][w*3+2]*c+p[T],e=Math.min(_,e),t=Math.min(v,t),i=Math.min(y,i),s=Math.max(_,s),n=Math.max(v,n),a=Math.max(y,a),d[T]=_,f[T]=v,p[T]=y;for(let T=0;T<2;T++)g[T]+=c*Math.sqrt(u[T][w*3+0]*u[T][w*3+0]+u[T][w*3+1]*u[T][w*3+1]+u[T][w*3+2]*u[T][w*3+2]);m[0]+=this.qRadialSpeed[w]*c,m[1]+=this.qRadialSpeed2[w]*c,o=Math.max(o,Math.max(Math.abs(m[0]),Math.abs(m[1]))),l=Math.max(l,this.qScale[w])}this.emitterShape===_a?(_=this.emitterExtents.x*.5,v=this.emitterExtents.y*.5,y=this.emitterExtents.z*.5):(_=this.emitterRadius,v=this.emitterRadius,y=this.emitterRadius);const x=Math.max(g[0],g[1]);Y0.x=e-l-_-o-x,Y0.y=t-l-v-o-x,Y0.z=i-l-y-o-x,K0.x=s+l+_+o+x,K0.y=n+l+v+o+x,K0.z=a+l+y+o+x,this.localBounds.setMinMax(Y0,K0)}rebuild(){const e=this.graphicsDevice;this.colorMap===null&&(this.colorMap=this.defaultParamTexture),this.spawnBounds=this.emitterShape===_a?this.emitterExtents:this.emitterRadius,this.useCpu=this.useCpu||this.sort>EM||e.maxVertexTextures<=1||e.fragmentUniformsCount<64||e.forceCpuParticles,this._destroyResources(),this.pack8=(this.pack8||!e.textureFloatRenderable)&&!this.useCpu,ao=this.useCpu||this.pack8?4:2,this.useMesh=!!this.mesh,this.numParticlesPot=Q.nextPowerOfTwo(this.numParticles),this.rebuildGraphs(),this.calculateLocalBounds(),this.resetWorldBounds(),this.node&&(this.worldBounds.setFromTransformedAabb(this.localBounds,this.localSpace?se.IDENTITY:this.node.getWorldTransform()),this.worldBoundsTrail[0].copy(this.worldBounds),this.worldBoundsTrail[1].copy(this.worldBounds),this.worldBoundsSize.copy(this.worldBounds.halfExtents).mulScalar(2),this.prevWorldBoundsSize.copy(this.worldBoundsSize),this.prevWorldBoundsCenter.copy(this.worldBounds.center),this.pack8&&this.calculateBoundsMad()),this.vbToSort=new Array(this.numParticles);for(let u=0;u<this.numParticles;u++)this.vbToSort[u]=[0,0];this.particleDistance=new Float32Array(this.numParticles),this._gpuUpdater.randomize(),this.particleTex=new Float32Array(this.numParticlesPot*ao*q0);const t=this.node===null||this.localSpace?O.ZERO:this.node.getPosition();this.emitterShape===_a&&(this.node===null||this.localSpace?Gc.setTRS(O.ZERO,de.IDENTITY,this.spawnBounds):Gc.setTRS(O.ZERO,this.node.getRotation(),az.copy(this.spawnBounds).mul(this.node.localScale)),oo[0]=this.emitterExtents.x!==0?this.emitterExtentsInner.x/this.emitterExtents.x:0,oo[1]=this.emitterExtents.y!==0?this.emitterExtentsInner.y/this.emitterExtents.y:0,oo[2]=this.emitterExtents.z!==0?this.emitterExtentsInner.z/this.emitterExtents.z:0);for(let u=0;u<this.numParticles;u++)this._cpuUpdater.calcSpawnPosition(this.particleTex,Gc,oo,t,u),this.useCpu&&(this.particleTex[u*q0+3+this.numParticlesPot*2*q0]=1);this.particleTexStart=new Float32Array(this.numParticlesPot*ao*q0);for(let u=0;u<this.particleTexStart.length;u++)this.particleTexStart[u]=this.particleTex[u];this.useCpu||(this.pack8?(this.particleTexIN=zs(e,this.numParticlesPot,ao,this.particleTex,ct,1,!1),this.particleTexOUT=zs(e,this.numParticlesPot,ao,this.particleTex,ct,1,!1),this.particleTexStart=zs(e,this.numParticlesPot,ao,this.particleTexStart,ct,1,!1)):(this.particleTexIN=zs(e,this.numParticlesPot,ao,this.particleTex),this.particleTexOUT=zs(e,this.numParticlesPot,ao,this.particleTex),this.particleTexStart=zs(e,this.numParticlesPot,ao,this.particleTexStart)),this.rtParticleTexIN=new Zi({colorBuffer:this.particleTexIN,depth:!1}),this.rtParticleTexOUT=new Zi({colorBuffer:this.particleTexOUT,depth:!1}),this.swapTex=!1);const i=new Map;this.localSpace&&i.set("LOCAL_SPACE",""),this.pack8&&i.set("PACK8",""),this.emitterShape===_a&&i.set("EMITTERSHAPE_BOX","");const s=`Shape:${this.emitterShape}-Pack:${this.pack8}-Local:${this.localSpace}`,n=$e.get(e,e.isWebGPU?Gt:dt),a=new Map(n),o={attributes:{vertex_position:Xe},vertexChunk:"fullscreenQuadVS",fragmentChunk:"particle_simulationPS",fragmentDefines:i,fragmentIncludes:a};o.uniqueName=`ParticleUpdateRespawn-${s}`,i.set("RESPAWN",""),this.shaderParticleUpdateRespawn=Tr.createShader(e,o),i.delete("RESPAWN"),o.uniqueName=`ParticleUpdateNoRespawn-${s}`,i.set("NO_RESPAWN",""),this.shaderParticleUpdateNoRespawn=Tr.createShader(e,o),i.delete("NO_RESPAWN"),o.uniqueName=`ParticleUpdateStop-${s}`,i.set("ON_STOP",""),this.shaderParticleUpdateOnStop=Tr.createShader(e,o),this.numParticleVerts=this.useMesh?this.mesh.vertexBuffer.numVertices:4,this.numParticleIndices=this.useMesh?this.mesh.indexBuffer[0].numIndices:6,this._allocate(this.numParticles);const l=new It(e);l.vertexBuffer=this.vertexBuffer,l.indexBuffer[0]=this.indexBuffer,l.primitive[0].type=Uo,l.primitive[0].base=0,l.primitive[0].count=this.numParticles*this.numParticleIndices,l.primitive[0].indexed=!0,this.material=this._createMaterial(),this.resetMaterial();const c=this.meshInstance?this.meshInstance.visible:!0;this.meshInstance=new Dt(l,this.material,this.node),this.meshInstance.pick=!1,this.meshInstance.updateKey(),this.meshInstance.cull=!0,this.localSpace?this.meshInstance.aabb.setFromTransformedAabb(this.worldBounds,this.node.getWorldTransform()):this.meshInstance.aabb.copy(this.worldBounds),this.meshInstance._updateAabb=!1,this.meshInstance.visible=c,this._setMaterialTextures(),this.resetTime(),this.addTime(0,!1),this.preWarm&&this.prewarm(this.lifetime)}_isAnimated(){return this.animNumFrames>=1&&(this.animTilesX>1||this.animTilesY>1)&&(this.colorMap&&this.colorMap!==this.defaultParamTexture||this.normalMap)}rebuildGraphs(){const e=this.precision,t=this.graphicsDevice;this.qLocalVelocity=this.localVelocityGraph.quantize(e),this.qVelocity=this.velocityGraph.quantize(e),this.qColor=this.colorGraph.quantizeClamped(e,0,1),this.qRotSpeed=this.rotationSpeedGraph.quantize(e),this.qScale=this.scaleGraph.quantize(e),this.qAlpha=this.alphaGraph.quantize(e),this.qRadialSpeed=this.radialSpeedGraph.quantize(e),this.qLocalVelocity2=this.localVelocityGraph2.quantize(e),this.qVelocity2=this.velocityGraph2.quantize(e),this.qColor2=this.colorGraph2.quantizeClamped(e,0,1),this.qRotSpeed2=this.rotationSpeedGraph2.quantize(e),this.qScale2=this.scaleGraph2.quantize(e),this.qAlpha2=this.alphaGraph2.quantize(e),this.qRadialSpeed2=this.radialSpeedGraph2.quantize(e);for(let i=0;i<e;i++)this.qRotSpeed[i]*=Q.DEG_TO_RAD,this.qRotSpeed2[i]*=Q.DEG_TO_RAD;if(this.localVelocityUMax=new Float32Array(3),this.velocityUMax=new Float32Array(3),this.colorUMax=new Float32Array(3),this.rotSpeedUMax=[0],this.scaleUMax=[0],this.alphaUMax=[0],this.radialSpeedUMax=[0],this.qLocalVelocityDiv=Wc(this.qLocalVelocity,this.qLocalVelocity2,this.localVelocityUMax),this.qVelocityDiv=Wc(this.qVelocity,this.qVelocity2,this.velocityUMax),this.qColorDiv=Wc(this.qColor,this.qColor2,this.colorUMax),this.qRotSpeedDiv=Wc(this.qRotSpeed,this.qRotSpeed2,this.rotSpeedUMax),this.qScaleDiv=Wc(this.qScale,this.qScale2,this.scaleUMax),this.qAlphaDiv=Wc(this.qAlpha,this.qAlpha2,this.alphaUMax),this.qRadialSpeedDiv=Wc(this.qRadialSpeed,this.qRadialSpeed2,this.radialSpeedUMax),this.pack8){const i=[0,0,0];nu(this.qVelocity,i);const s=[0,0,0];nu(this.qVelocity2,s);const n=[0,0,0];nu(this.qLocalVelocity,n);const a=[0,0,0];nu(this.qLocalVelocity2,a);const o=[0];nu(this.qRadialSpeed,o);const l=[0];nu(this.qRadialSpeed2,l);let c=Math.max(i[0],s[0]);c=Math.max(c,i[1]),c=Math.max(c,s[1]),c=Math.max(c,i[2]),c=Math.max(c,s[2]);let u=Math.max(n[0],a[0]);u=Math.max(u,n[1]),u=Math.max(u,a[1]),u=Math.max(u,n[2]),u=Math.max(u,a[2]);const h=Math.max(o[0],l[0]);this.maxVel=c+u+h}this.useCpu||(this.internalTex0=zs(t,e,1,oz(this.qLocalVelocity,this.qLocalVelocityDiv)),this.internalTex1=zs(t,e,1,oz(this.qVelocity,this.qVelocityDiv)),this.internalTex2=zs(t,e,1,Yge(this.qRotSpeed,this.qScale,this.qScaleDiv,this.qRotSpeedDiv,this.qAlphaDiv)),this.internalTex3=zs(t,e,1,Kge(this.qRadialSpeed,this.qRadialSpeedDiv))),this.colorParam=zs(t,e,1,qge(this.qColor,this.qAlpha),Ms,1,!0)}_setMaterialTextures(){this.colorMap&&(this.material.setParameter("colorMap",this.colorMap),this.lighting&&this.normalMap&&this.material.setParameter("normalMap",this.normalMap))}_createMaterial(){const e=new Wge(this);return e.name=`EmitterMaterial:${this.node.name}`,e.cull=Vi,e.alphaWrite=!1,e.blendType=this.blendType,e.depthWrite=this.depthWrite,e}resetMaterial(){const e=this.material;e.setParameter("stretch",this.stretch),this._isAnimated()&&(e.setParameter("animTexTilesParams",this.animTilesParams),e.setParameter("animTexParams",this.animParams),e.setParameter("animTexIndexParams",this.animIndexParams)),e.setParameter("colorMult",this.intensity),this.useCpu||(e.setParameter("internalTex0",this.internalTex0),e.setParameter("internalTex1",this.internalTex1),e.setParameter("internalTex2",this.internalTex2),e.setParameter("internalTex3",this.internalTex3)),e.setParameter("colorParam",this.colorParam),e.setParameter("numParticles",this.numParticles),e.setParameter("numParticlesPot",this.numParticlesPot),e.setParameter("lifetime",this.lifetime),e.setParameter("rate",this.rate),e.setParameter("rateDiv",this.rate2-this.rate),e.setParameter("seed",this.seed),e.setParameter("scaleDivMult",this.scaleUMax[0]),e.setParameter("alphaDivMult",this.alphaUMax[0]),e.setParameter("radialSpeedDivMult",this.radialSpeedUMax[0]),e.setParameter("graphNumSamples",this.precision),e.setParameter("graphSampleSize",1/this.precision),e.setParameter("emitterScale",new Float32Array([1,1,1])),this.pack8&&(this._gpuUpdater._setInputBounds(),e.setParameter("inBoundsSize",this._gpuUpdater.inBoundsSizeUniform),e.setParameter("inBoundsCenter",this._gpuUpdater.inBoundsCenterUniform),e.setParameter("maxVel",this.maxVel)),this.wrap&&this.wrapBounds&&(this.wrapBoundsUniform[0]=this.wrapBounds.x,this.wrapBoundsUniform[1]=this.wrapBounds.y,this.wrapBoundsUniform[2]=this.wrapBounds.z,e.setParameter("wrapBounds",this.wrapBoundsUniform)),this._setMaterialTextures(),this.depthSoftening>0&&e.setParameter("softening",1/(this.depthSoftening*this.depthSoftening*100)),this.stretch>0&&(e.cull=Vi),this._compParticleFaceParams()}_compParticleFaceParams(){let e,t;if(this.orientation===gb)e=new Float32Array([1,0,0]),t=new Float32Array([0,0,1]);else{let i;this.orientation===Ype?i=this.particleNormal.normalize():i=(this.node===null?se.IDENTITY:this.node.getWorldTransform()).transformVector(this.particleNormal).normalize();const s=new O(1,0,0);Math.abs(s.dot(i))===1&&s.set(0,0,1);const n=new O().cross(i,s).normalize();s.cross(n,i).normalize(),e=new Float32Array([s.x,s.y,s.z]),t=new Float32Array([n.x,n.y,n.z])}this.material.setParameter("faceTangent",e),this.material.setParameter("faceBinorm",t)}getVertexInfo(){const e=[];return this.useCpu?e.push({semantic:gM,components:4,type:bt},{semantic:_M,components:4,type:bt},{semantic:Iq,components:4,type:bt},{semantic:Mq,components:1,type:bt},{semantic:Rq,components:this.useMesh?4:2,type:bt}):(e.push({semantic:gM,components:4,type:bt}),this.useMesh&&e.push({semantic:_M,components:2,type:bt})),e}_allocate(e){const t=e*this.numParticleVerts,i=e*this.numParticleIndices;if(this.vertexBuffer===void 0||this.vertexBuffer.getNumVertices()!==t){const s=this.getVertexInfo(),n=new Ls(this.graphicsDevice,s);this.vertexBuffer=new Ya(this.graphicsDevice,n,t,{usage:nb}),this.indexBuffer=new dh(this.graphicsDevice,bc,i);const a=new Float32Array(this.vertexBuffer.lock());let o,l,c;if(this.useMesh){o=new Float32Array(this.mesh.vertexBuffer.lock()),l=o.length/this.mesh.vertexBuffer.numVertices;for(let d=0;d<this.mesh.vertexBuffer.format.elements.length;d++)if(this.mesh.vertexBuffer.format.elements[d].name===un){c=this.mesh.vertexBuffer.format.elements[d].offset/4;break}}for(let d=0;d<t;d++){const f=Math.floor(d/this.numParticleVerts);if(this.useMesh){const p=d%this.numParticleVerts;a[d*6]=o[p*l],a[d*6+1]=o[p*l+1],a[d*6+2]=o[p*l+2],a[d*6+3]=f,a[d*6+4]=o[p*l+c+0],a[d*6+5]=1-o[p*l+c+1]}else{const p=d%4;a[d*4]=tz[p][0],a[d*4+1]=tz[p][1],a[d*4+2]=0,a[d*4+3]=f}}this.useCpu&&(this.vbCPU=new Float32Array(a),this.vbOld=new Float32Array(this.vbCPU.length)),this.vertexBuffer.unlock(),this.useMesh&&this.mesh.vertexBuffer.unlock();let u=0;const h=new Uint32Array(this.indexBuffer.lock());if(this.useMesh){const d=this.mesh.indexBuffer[0];o=new fb[d.format](d.lock())}for(let d=0;d<e;d++)if(this.useMesh)for(let f=0;f<this.numParticleIndices;f++)h[d*this.numParticleIndices+f]=o[f]+d*this.numParticleVerts;else{const f=d*4;h[u++]=f,h[u++]=f+1,h[u++]=f+2,h[u++]=f,h[u++]=f+2,h[u++]=f+3}this.indexBuffer.unlock(),this.useMesh&&this.mesh.indexBuffer[0].unlock()}}reset(){if(this.beenReset=!0,this.seed=Math.random(),this.material.setParameter("seed",this.seed),this.useCpu)for(let t=0;t<this.particleTexStart.length;t++)this.particleTex[t]=this.particleTexStart[t];else this._setMaterialTextures();this.resetWorldBounds(),this.resetTime();const e=this.loop;this.loop=!0,this.addTime(0,!1),this.loop=e,this.preWarm&&this.prewarm(this.lifetime)}prewarm(e){const t=e/this.lifetime,i=Math.min(Math.floor(t*this.precision),this.precision),s=e/i;for(let n=0;n<i;n++)this.addTime(s,!1)}resetTime(){this.endTime=Zge(this)}finishFrame(){this.useCpu&&this.vertexBuffer.unlock()}addTime(e,t){const i=this.graphicsDevice;if(this.simTimeTotal+=e,this.calculateWorldBounds(),this._isAnimated()){const a=this.animTilesParams;a[0]=1/this.animTilesX,a[1]=1/this.animTilesY;const o=this.animParams;o[0]=this.animStartFrame,o[1]=this.animNumFrames*this.animSpeed,o[2]=this.animNumFrames-1,o[3]=this.animNumAnimations-1;const l=this.animIndexParams;l[0]=this.animIndex,l[1]=this.randomizeAnimIndex}this.scene&&this.camera!==this.scene._activeCamera&&(this.camera=this.scene._activeCamera,this.onChangeCamera()),this.emitterShape===_a&&(oo[0]=this.emitterExtents.x!==0?this.emitterExtentsInner.x/this.emitterExtents.x:0,oo[1]=this.emitterExtents.y!==0?this.emitterExtentsInner.y/this.emitterExtents.y:0,oo[2]=this.emitterExtents.z!==0?this.emitterExtentsInner.z/this.emitterExtents.z:0,this.meshInstance.node===null?Gc.setTRS(O.ZERO,de.IDENTITY,this.emitterExtents):Gc.setTRS(O.ZERO,this.meshInstance.node.getRotation(),az.copy(this.emitterExtents).mul(this.meshInstance.node.localScale)));let s;const n=this.meshInstance.node===null?O.ONE:this.meshInstance.node.localScale;if(this.emitterScaleUniform[0]=n.x,this.emitterScaleUniform[1]=n.y,this.emitterScaleUniform[2]=n.z,this.material.setParameter("emitterScale",this.emitterScaleUniform),this.localSpace&&this.meshInstance.node&&(s=this.meshInstance.node.getPosition(),this.emitterPosUniform[0]=s.x,this.emitterPosUniform[1]=s.y,this.emitterPosUniform[2]=s.z,this.material.setParameter("emitterPos",this.emitterPosUniform)),this._compParticleFaceParams(),!this.useCpu)this._gpuUpdater.update(i,Gc,oo,e,t);else{const a=new Float32Array(this.vertexBuffer.lock());this._cpuUpdater.update(a,this.vbToSort,this.particleTex,Gc,oo,s,e,t)}this.loop||Date.now()>this.endTime&&(this.onFinished&&this.onFinished(),this.meshInstance.visible=!1),this.meshInstance&&(this.meshInstance.drawOrder=this.drawOrder)}_destroyResources(){var e,t,i,s,n,a,o,l,c,u,h,d;(e=this.particleTexIN)==null||e.destroy(),this.particleTexIN=null,(t=this.particleTexOUT)==null||t.destroy(),this.particleTexOUT=null,this.particleTexStart&&this.particleTexStart.destroy&&(this.particleTexStart.destroy(),this.particleTexStart=null),(i=this.rtParticleTexIN)==null||i.destroy(),this.rtParticleTexIN=null,(s=this.rtParticleTexOUT)==null||s.destroy(),this.rtParticleTexOUT=null,(n=this.internalTex0)==null||n.destroy(),this.internalTex0=null,(a=this.internalTex1)==null||a.destroy(),this.internalTex1=null,(o=this.internalTex2)==null||o.destroy(),this.internalTex2=null,(l=this.internalTex3)==null||l.destroy(),this.internalTex3=null,(c=this.colorParam)==null||c.destroy(),this.colorParam=null,(u=this.vertexBuffer)==null||u.destroy(),this.vertexBuffer=void 0,(h=this.indexBuffer)==null||h.destroy(),this.indexBuffer=void 0,(d=this.material)==null||d.destroy(),this.material=null}destroy(){this.camera=null,this._destroyResources()}}class i_e extends gh{generateKey(e){var u;const t=e.shaderDesc,i=t.vertexGLSL?Ia(t.vertexGLSL):0,s=t.fragmentGLSL?Ia(t.fragmentGLSL):0,n=t.vertexWGSL?Ia(t.vertexWGSL):0,a=t.fragmentWGSL?Ia(t.fragmentWGSL):0,o=gh.definesHash(e.defines),l=((u=e.shaderChunks)==null?void 0:u.key)??"";let c=`${t.uniqueName}_${o}_${i}_${s}_${n}_${a}_${l}`;return e.skin&&(c+="_skin"),e.useInstancing&&(c+="_inst"),e.useMorphPosition&&(c+="_morphp"),e.useMorphNormal&&(c+="_morphn"),e.useMorphTextureBasedInt&&(c+="_morphi"),c}createAttributesDefinition(e,t){const i=t.shaderDesc.attributes,s=i?{...i}:void 0;t.skin&&(s.vertex_boneWeights=za,s.vertex_boneIndices=Es),(t.useMorphPosition||t.useMorphNormal)&&(s.morph_vertex_id=ap),e.attributes=s}createVertexDefinition(e,t,i,s){const n=t.shaderDesc,a=new Map(i);a.set("transformInstancingVS","");const o=new Map(t.defines);t.skin&&o.set("SKIN",!0),t.useInstancing&&o.set("INSTANCING",!0),(t.useMorphPosition||t.useMorphNormal)&&(o.set("MORPHING",!0),t.useMorphTextureBasedInt&&o.set("MORPHING_INT",!0),t.useMorphPosition&&o.set("MORPHING_POSITION",!0),t.useMorphNormal&&o.set("MORPHING_NORMAL",!0)),e.vertexCode=s?n.vertexWGSL:n.vertexGLSL,e.vertexIncludes=a,e.vertexDefines=o}createFragmentDefinition(e,t,i,s){const n=t.shaderDesc,a=new Map(i),o=new Map(t.defines);e.fragmentCode=s?n.fragmentWGSL:n.fragmentGLSL,e.fragmentIncludes=a,e.fragmentDefines=o}createShaderDefinition(e,t){var l;const i=t.shaderDesc,s=e.isWebGPU&&!!i.vertexWGSL&&!!i.fragmentWGSL&&(((l=t.shaderChunks)==null?void 0:l.useWGSL)??!0),n={name:`ShaderMaterial-${i.uniqueName}`,shaderLanguage:s?Gt:dt,fragmentOutputTypes:i.fragmentOutputTypes,meshUniformBufferFormat:i.meshUniformBufferFormat,meshBindGroupFormat:i.meshBindGroupFormat},a=s?Gt:dt,o=Sb.merge($e.get(e,a),t.shaderChunks[a]);return this.createAttributesDefinition(n,t),this.createVertexDefinition(n,t,o,s),this.createFragmentDefinition(n,t,o,s),Wr.createDefinition(e,n)}}const r_e=new i_e;class nv extends My{constructor(e){super(),this.shaderDesc=e}set shaderDesc(e){if(this._shaderDesc=void 0,e&&(this._shaderDesc={uniqueName:e.uniqueName,attributes:e.attributes,fragmentOutputTypes:e.fragmentOutputTypes,vertexGLSL:e.vertexGLSL,fragmentGLSL:e.fragmentGLSL,vertexWGSL:e.vertexWGSL,fragmentWGSL:e.fragmentWGSL},e.vertexCode||e.fragmentCode||e.shaderLanguage)){const t=e.shaderLanguage??dt;t===dt?(this._shaderDesc.vertexGLSL=e.vertexCode,this._shaderDesc.fragmentGLSL=e.fragmentCode):t===Gt&&(this._shaderDesc.vertexWGSL=e.vertexCode,this._shaderDesc.fragmentWGSL=e.fragmentCode)}this.clearVariants()}get shaderDesc(){return this._shaderDesc}copy(e){return super.copy(e),this.shaderDesc=e.shaderDesc,this}getShaderVariant(e){const{objDefs:t}=e,i={defines:Tr.getCoreDefines(this,e),skin:(t&NE)!==0,useInstancing:(t&kE)!==0,useMorphPosition:(t&FE)!==0,useMorphNormal:(t&BE)!==0,useMorphTextureBasedInt:(t&UE)!==0,pass:e.pass,gamma:e.cameraShaderParams.shaderOutputGamma,toneMapping:e.cameraShaderParams.toneMapping,fog:e.cameraShaderParams.fog,shaderDesc:this.shaderDesc,shaderChunks:this.shaderChunks},s=new jE(e.viewUniformFormat,e.viewBindGroupFormat,e.vertexFormat),n=gp(e.device);return n.register("shader-material",r_e),n.getProgram("shader-material",i,s,this.userId)}}const s_e={linear:"decodeLinear",srgb:"decodeGamma",rgbm:"decodeRGBM",rgbe:"decodeRGBE",rgbp:"decodeRGBP",xy:"unpackNormalXY",xyz:"unpackNormalXYZ"},n_e={linear:"encodeLinear",srgb:"encodeGamma",rgbm:"encodeRGBM",rgbe:"encodeRGBE",rgbp:"encodeRGBP"};class mc{static decodeFunc(e){return s_e[e]??"decodeGamma"}static encodeFunc(e){return n_e[e]??"encodeGamma"}}const U9=(r,e)=>{const t=e.length/3,i=r.length/3,s=new O,n=new O,a=new O,o=new O,l=new O,c=new O,u=[];for(let h=0;h<r.length;h++)u[h]=0;for(let h=0;h<t;h++){const d=e[h*3],f=e[h*3+1],p=e[h*3+2];s.set(r[d*3],r[d*3+1],r[d*3+2]),n.set(r[f*3],r[f*3+1],r[f*3+2]),a.set(r[p*3],r[p*3+1],r[p*3+2]),o.sub2(n,s),l.sub2(a,s),c.cross(o,l).normalize(),u[d*3]+=c.x,u[d*3+1]+=c.y,u[d*3+2]+=c.z,u[f*3]+=c.x,u[f*3+1]+=c.y,u[f*3+2]+=c.z,u[p*3]+=c.x,u[p*3+1]+=c.y,u[p*3+2]+=c.z}for(let h=0;h<i;h++){const d=u[h*3],f=u[h*3+1],p=u[h*3+2],m=1/Math.sqrt(d*d+f*f+p*p);u[h*3]*=m,u[h*3+1]*=m,u[h*3+2]*=m}return u},Mc=(r,e,t,i)=>{const s=i.length/3,n=r.length/3,a=new O,o=new O,l=new O,c=new ee,u=new ee,h=new ee,d=new O,f=new O,p=new Float32Array(n*3),m=new Float32Array(n*3),g=[];for(let S=0;S<s;S++){const w=i[S*3],T=i[S*3+1],A=i[S*3+2];a.set(r[w*3],r[w*3+1],r[w*3+2]),o.set(r[T*3],r[T*3+1],r[T*3+2]),l.set(r[A*3],r[A*3+1],r[A*3+2]),c.set(t[w*2],t[w*2+1]),u.set(t[T*2],t[T*2+1]),h.set(t[A*2],t[A*2+1]);const C=o.x-a.x,P=l.x-a.x,I=o.y-a.y,M=l.y-a.y,N=o.z-a.z,k=l.z-a.z,V=u.x-c.x,B=h.x-c.x,R=u.y-c.y,L=h.y-c.y,D=V*L-B*R;if(D===0)d.set(0,1,0),f.set(1,0,0);else{const F=1/D;d.set((L*C-R*P)*F,(L*I-R*M)*F,(L*N-R*k)*F),f.set((V*P-B*C)*F,(V*M-B*I)*F,(V*k-B*N)*F)}p[w*3+0]+=d.x,p[w*3+1]+=d.y,p[w*3+2]+=d.z,p[T*3+0]+=d.x,p[T*3+1]+=d.y,p[T*3+2]+=d.z,p[A*3+0]+=d.x,p[A*3+1]+=d.y,p[A*3+2]+=d.z,m[w*3+0]+=f.x,m[w*3+1]+=f.y,m[w*3+2]+=f.z,m[T*3+0]+=f.x,m[T*3+1]+=f.y,m[T*3+2]+=f.z,m[A*3+0]+=f.x,m[A*3+1]+=f.y,m[A*3+2]+=f.z}const _=new O,v=new O,y=new O,x=new O;for(let S=0;S<n;S++){y.set(e[S*3],e[S*3+1],e[S*3+2]),_.set(p[S*3],p[S*3+1],p[S*3+2]),v.set(m[S*3],m[S*3+1],m[S*3+2]);const w=y.dot(_);x.copy(y).mulScalar(w),x.sub2(_,x).normalize(),g[S*4]=x.x,g[S*4+1]=x.y,g[S*4+2]=x.z,x.cross(y,_),g[S*4+3]=x.dot(v)<0?-1:1}return g};class yh{calculateNormals(){this.normals=U9(this.positions,this.indices)}calculateTangents(){this.tangents=Mc(this.positions,this.normals,this.uvs,this.indices)}}const DM=4/64,lz=1-DM*2;class LM extends yh{constructor(e={}){super();const t=e.halfExtents??new O(.5,.5,.5),i=e.widthSegments??1,s=e.lengthSegments??1,n=e.heightSegments??1,a=e.yOffset??0,o=-t.y+a,l=t.y+a,c=[new O(-t.x,o,t.z),new O(t.x,o,t.z),new O(t.x,l,t.z),new O(-t.x,l,t.z),new O(t.x,o,-t.z),new O(-t.x,o,-t.z),new O(-t.x,l,-t.z),new O(t.x,l,-t.z)],u=[[0,1,3],[4,5,7],[3,2,6],[1,0,4],[1,4,2],[5,0,6]],h=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],d={FRONT:0,BACK:1,TOP:2,BOTTOM:3,RIGHT:4,LEFT:5},f=[],p=[],m=[],g=[];let _=0;const v=(y,x,S)=>{const w=new O,T=new O,A=new O,C=new O;for(let P=0;P<=x;P++)for(let I=0;I<=S;I++){w.lerp(c[u[y][0]],c[u[y][1]],P/x),T.lerp(c[u[y][0]],c[u[y][2]],I/S),A.sub2(T,c[u[y][0]]),C.add2(w,A);let M=P/x,N=I/S;f.push(C.x,C.y,C.z),p.push(h[y][0],h[y][1],h[y][2]),m.push(M,1-N),M=M*lz+DM,N=N*lz+DM,M/=3,N/=3,M+=y%3/3,N+=Math.floor(y/3)/3,P<x&&I<S&&(g.push(_+S+1,_+1,_),g.push(_+S+1,_+S+2,_+1)),_++}};v(d.FRONT,i,n),v(d.BACK,i,n),v(d.TOP,i,s),v(d.BOTTOM,i,s),v(d.RIGHT,s,n),v(d.LEFT,s,n),this.positions=f,this.normals=p,this.uvs=m,this.uvs1=m,this.indices=g,e.calculateTangents&&(this.tangents=Mc(f,p,m,g))}}class z9 extends yh{constructor(e={}){super();const t=e.radius??.5,i=e.latitudeBands??16,s=e.longitudeBands??16,n=[],a=[],o=[],l=[];for(let c=0;c<=i;c++){const u=c*Math.PI/i,h=Math.sin(u),d=Math.cos(u);for(let f=0;f<=s;f++){const p=f*2*Math.PI/s-Math.PI/2,m=Math.sin(p),_=Math.cos(p)*h,v=d,y=m*h,x=1-f/s,S=1-c/i;n.push(_*t,v*t,y*t),a.push(_,v,y),o.push(x,1-S)}}for(let c=0;c<i;++c)for(let u=0;u<s;++u){const h=c*(s+1)+u,d=h+s+1;l.push(h+1,d,h),l.push(h+1,d+1,d)}this.positions=n,this.normals=a,this.uvs=o,this.uvs1=o,this.indices=l,e.calculateTangents&&(this.tangents=Mc(n,a,o,l))}}class a_e extends z9{constructor(e={}){const i=e.latitudeBands??16,s=e.longitudeBands??16;super({radius:.5,latitudeBands:i,longitudeBands:s});const n=.1,a=.95,o=a*a,l=this.positions;for(let c=0;c<l.length;c+=3){const u=l[c]/.5;let h=l[c+1]/.5;const d=l[c+2]/.5;h<0&&(h*=.3,u*u+d*d<o&&(h=-.1)),h+=n,h*=.5,l[c+1]=h}}}class Yg{static create(e,t){switch(t){case ame:return Yg.box(e);case ome:return Yg.dome(e)}return Yg.infinite(e)}static infinite(e){return It.fromGeometry(e,new LM(e))}static box(e){return It.fromGeometry(e,new LM({yOffset:.5}))}static dome(e){const t=new a_e({latitudeBands:50,longitudeBands:50});return t.normals=void 0,t.uvs=void 0,It.fromGeometry(e,t)}}class o_e{constructor(e,t,i,s,n){this.meshInstance=null,this._depthWrite=!1;const a=new nv({uniqueName:"SkyMaterial",vertexGLSL:$e.get(e,dt).get("skyboxVS"),fragmentGLSL:$e.get(e,dt).get("skyboxPS"),vertexWGSL:$e.get(e,Gt).get("skyboxVS"),fragmentWGSL:$e.get(e,Gt).get("skyboxPS"),attributes:{aPosition:Xe}});a.setDefine("{SKYBOX_DECODE_FNC}",mc.decodeFunc(s.encoding)),n!==ox&&a.setDefine("SKYMESH",""),s.cubemap&&a.setDefine("SKY_CUBEMAP",""),a.setParameter("skyboxHighlightMultiplier",t.skyboxHighlightMultiplier),s.cubemap?a.setParameter("texture_cubeMap",s):(a.setParameter("texture_envAtlas",s),a.setParameter("mipLevel",t.skyboxMip)),a.cull=Gg,a.depthWrite=this._depthWrite;const o=t.layers.getLayerById(S3);if(o){const l=Yg.create(e,n),c=new Dt(l,a,i);this.meshInstance=c,c.cull=!1,c.pick=!1,o.addMeshInstances([c]),this.skyLayer=o}}destroy(){this.meshInstance&&(this.skyLayer&&this.skyLayer.removeMeshInstances([this.meshInstance]),this.meshInstance.destroy(),this.meshInstance=null)}set depthWrite(e){this._depthWrite=e,this.meshInstance&&(this.meshInstance.material.depthWrite=e)}get depthWrite(){return this._depthWrite}}class l_e{constructor(e){this._type=ox,this._center=new O(0,1,0),this.skyMesh=null,this._depthWrite=!1,this.node=new Xt("SkyMeshNode"),this.device=e.device,this.scene=e,this.center=new O(0,1,0),this.centerArray=new Float32Array(3),this.projectedSkydomeCenterId=this.device.scope.resolve("projectedSkydomeCenter")}applySettings(e){this.type=e.skyType??ox,this.node.setLocalPosition(new O(e.skyMeshPosition??[0,0,0])),this.node.setLocalEulerAngles(new O(e.skyMeshRotation??[0,0,0])),this.node.setLocalScale(new O(e.skyMeshScale??[1,1,1])),e.skyCenter&&(this._center=new O(e.skyCenter))}set type(e){this._type!==e&&(this._type=e,this.scene.updateShaders=!0,this.updateSkyMesh())}get type(){return this._type}set center(e){this._center.copy(e)}get center(){return this._center}set depthWrite(e){this._depthWrite!==e&&(this._depthWrite=e,this.skyMesh&&(this.skyMesh.depthWrite=e))}get depthWrite(){return this._depthWrite}updateSkyMesh(){const e=this.scene._getSkyboxTex();e&&(this.resetSkyMesh(),this.skyMesh=new o_e(this.device,this.scene,this.node,e,this.type),this.skyMesh.depthWrite=this._depthWrite,this.scene.fire("set:skybox",e))}resetSkyMesh(){var e;(e=this.skyMesh)==null||e.destroy(),this.skyMesh=null}update(){if(this.type!==ox){const{center:e,centerArray:t}=this,i=new O;this.node.getWorldTransform().transformPoint(e,i),t[0]=i.x,t[1]=i.y,t[2]=i.z,this.projectedSkydomeCenterId.setValue(t)}}}const bb=new Xt;bb.worldTransform=se.IDENTITY;bb._dirtyWorld=bb._dirtyNormal=!1;class c_e{constructor(e,t,i){this.material=t,this.layer=i,this.positions=[],this.colors=[],this.mesh=new It(e),this.meshInstance=null}addLines(e,t){const i=this.positions,s=e.length;for(let a=0;a<s;a++){const o=e[a];i.push(o.x,o.y,o.z)}const n=this.colors;if(t.length)for(let a=0;a<s;a++){const o=t[a];n.push(o.r,o.g,o.b,o.a)}else for(let a=0;a<s;a++)n.push(t.r,t.g,t.b,t.a)}addLinesArrays(e,t){const i=this.positions;for(let n=0;n<e.length;n+=3)i.push(e[n],e[n+1],e[n+2]);const s=this.colors;if(t.length)for(let n=0;n<t.length;n+=4)s.push(t[n],t[n+1],t[n+2],t[n+3]);else{const n=e.length/3;for(let a=0;a<n;a++)s.push(t.r,t.g,t.b,t.a)}}onPreRender(e,t){this.positions.length>0&&this.material.transparent===t&&(this.mesh.setPositions(this.positions),this.mesh.setColors(this.colors),this.mesh.update(vE,!1),this.meshInstance||(this.meshInstance=new Dt(this.mesh,this.material,bb)),e.push(this.meshInstance))}clear(){this.positions.length=0,this.colors.length=0}}class u_e{constructor(e){this.device=e,this.map=new Map}getBatch(e,t){let i=this.map.get(e);return i||(i=new c_e(this.device,e,t),this.map.set(e,i)),i}onPreRender(e,t){this.map.forEach(i=>{i.onPreRender(e,t)})}clear(){this.map.forEach(e=>e.clear())}}const Vs=[],od=new O;class h_e{constructor(e){this.shaderDescs=new Map,this.device=e,this.quadMesh=null,this.textureShader=null,this.depthTextureShader=null,this.cubeLocalPos=null,this.cubeWorldPos=null,this.batchesMap=new Map,this.allBatches=new Set,this.updatedLayers=new Set,this._materialDepth=null,this._materialNoDepth=null,this.layerMeshInstances=new Map}createMaterial(e){const t=new nv({uniqueName:"ImmediateLine",vertexGLSL:$e.get(this.device,dt).get("immediateLineVS"),fragmentGLSL:$e.get(this.device,dt).get("immediateLinePS"),vertexWGSL:$e.get(this.device,Gt).get("immediateLineVS"),fragmentWGSL:$e.get(this.device,Gt).get("immediateLinePS"),attributes:{vertex_position:Xe,vertex_color:wr}});return t.blendType=Ka,t.depthTest=e,t.update(),t}get materialDepth(){return this._materialDepth||(this._materialDepth=this.createMaterial(!0)),this._materialDepth}get materialNoDepth(){return this._materialNoDepth||(this._materialNoDepth=this.createMaterial(!1)),this._materialNoDepth}getBatch(e,t){let i=this.batchesMap.get(e);i||(i=new u_e(this.device),this.batchesMap.set(e,i)),this.allBatches.add(i);const s=t?this.materialDepth:this.materialNoDepth;return i.getBatch(s,e)}getShaderDesc(e,t,i){return this.shaderDescs.has(e)||this.shaderDescs.set(e,{uniqueName:`DebugShader:${e}`,vertexGLSL:`
					attribute vec2 vertex_position;
					uniform mat4 matrix_model;
					varying vec2 uv0;
					void main(void) {
						gl_Position = matrix_model * vec4(vertex_position, 0, 1);
						uv0 = vertex_position.xy + 0.5;
					}
				`,vertexWGSL:`
					attribute vertex_position: vec2f;
					uniform matrix_model: mat4x4f;
					varying uv0: vec2f;
					@vertex fn vertexMain(input: VertexInput) -> VertexOutput {
						var output: VertexOutput;
						output.position = uniform.matrix_model * vec4f(input.vertex_position, 0.0, 1.0);
						output.uv0 = input.vertex_position.xy + vec2f(0.5);
						return output;
					}
				`,fragmentGLSL:t,fragmentWGSL:i,attributes:{vertex_position:Xe}}),this.shaderDescs.get(e)}getTextureShaderDesc(e){const t=mc.decodeFunc(e);return this.getShaderDesc(`textureShader-${e}`,`
			#include "gammaPS"
			varying vec2 uv0;
			uniform sampler2D colorMap;
			void main (void) {
				vec3 linearColor = ${t}(texture2D(colorMap, uv0));
				gl_FragColor = vec4(gammaCorrectOutput(linearColor), 1);
			}
		`,`
			#include "gammaPS"
			varying uv0: vec2f;
			var colorMap: texture_2d<f32>;
			var colorMapSampler: sampler;
			@fragment fn fragmentMain(input : FragmentInput) -> FragmentOutput {
				var output: FragmentOutput;
				let sampledTex = textureSample(colorMap, colorMapSampler, input.uv0);
				let linearColor: vec3f = ${t}(sampledTex);
				output.color = vec4f(gammaCorrectOutput(linearColor), 1.0);
				return output;
			}
		`)}getUnfilterableTextureShaderDesc(){return this.getShaderDesc("textureShaderUnfilterable",`
			varying vec2 uv0;
			uniform highp sampler2D colorMap;
			void main (void) {
				ivec2 uv = ivec2(uv0 * textureSize(colorMap, 0));
				gl_FragColor = vec4(texelFetch(colorMap, uv, 0).xyz, 1);
			}
		`,`
			varying uv0: vec2f;
			var colorMap: texture_2d<uff>;
			@fragment fn fragmentMain(input : FragmentInput) -> FragmentOutput {
				var output: FragmentOutput;
				let uv : vec2<i32> = vec2<i32>(input.uv0 * vec2f(textureDimensions(colorMap, 0)));
				let fetchedColor : vec4f = textureLoad(colorMap, uv, 0);
				output.color = vec4f(fetchedColor.xyz, 1.0);
				return output;
			}
		`)}getDepthTextureShaderDesc(){return this.getShaderDesc("depthTextureShader",`
			#include "screenDepthPS"
			#include "gammaPS"
			varying vec2 uv0;
			void main() {
				float depth = getLinearScreenDepth(getImageEffectUV(uv0)) * camera_params.x;
				gl_FragColor = vec4(gammaCorrectOutput(vec3(depth)), 1.0);
			}
		`,`
			#include "screenDepthPS"
			#include "gammaPS"
			varying uv0: vec2f;
			@fragment fn fragmentMain(input: FragmentInput) -> FragmentOutput {
				var output: FragmentOutput;
				let depth: f32 = getLinearScreenDepth(getImageEffectUV(input.uv0)) * uniform.camera_params.x;
				output.color = vec4f(gammaCorrectOutput(vec3f(depth)), 1.0);
				return output;
			}
		`)}getQuadMesh(){return this.quadMesh||(this.quadMesh=new It(this.device),this.quadMesh.setPositions([-.5,-.5,0,.5,-.5,0,-.5,.5,0,.5,.5,0]),this.quadMesh.update(wc)),this.quadMesh}drawMesh(e,t,i,s,n){if(!s){const o=this.getGraphNode(t);s=new Dt(i,e,o)}let a=this.layerMeshInstances.get(n);a||(a=[],this.layerMeshInstances.set(n,a)),a.push(s)}drawWireAlignedBox(e,t,i,s,n,a){if(a){const l=(c,u,h)=>{od.set(c,u,h),a.transformPoint(od,od),Vs.push(od.x,od.y,od.z)};l(e.x,e.y,e.z),l(e.x,t.y,e.z),l(e.x,t.y,e.z),l(t.x,t.y,e.z),l(t.x,t.y,e.z),l(t.x,e.y,e.z),l(t.x,e.y,e.z),l(e.x,e.y,e.z),l(e.x,e.y,t.z),l(e.x,t.y,t.z),l(e.x,t.y,t.z),l(t.x,t.y,t.z),l(t.x,t.y,t.z),l(t.x,e.y,t.z),l(t.x,e.y,t.z),l(e.x,e.y,t.z),l(e.x,e.y,e.z),l(e.x,e.y,t.z),l(e.x,t.y,e.z),l(e.x,t.y,t.z),l(t.x,t.y,e.z),l(t.x,t.y,t.z),l(t.x,e.y,e.z),l(t.x,e.y,t.z)}else Vs.push(e.x,e.y,e.z,e.x,t.y,e.z,e.x,t.y,e.z,t.x,t.y,e.z,t.x,t.y,e.z,t.x,e.y,e.z,t.x,e.y,e.z,e.x,e.y,e.z,e.x,e.y,t.z,e.x,t.y,t.z,e.x,t.y,t.z,t.x,t.y,t.z,t.x,t.y,t.z,t.x,e.y,t.z,t.x,e.y,t.z,e.x,e.y,t.z,e.x,e.y,e.z,e.x,e.y,t.z,e.x,t.y,e.z,e.x,t.y,t.z,t.x,t.y,e.z,t.x,t.y,t.z,t.x,e.y,e.z,t.x,e.y,t.z);this.getBatch(n,s).addLinesArrays(Vs,i),Vs.length=0}drawWireSphere(e,t,i,s,n,a){const o=2*Math.PI/s;let l=0;for(let u=0;u<s;u++){const h=Math.sin(l),d=Math.cos(l);l+=o;const f=Math.sin(l),p=Math.cos(l);Vs.push(e.x+t*h,e.y,e.z+t*d),Vs.push(e.x+t*f,e.y,e.z+t*p),Vs.push(e.x+t*h,e.y+t*d,e.z),Vs.push(e.x+t*f,e.y+t*p,e.z),Vs.push(e.x,e.y+t*h,e.z+t*d),Vs.push(e.x,e.y+t*f,e.z+t*p)}this.getBatch(a,n).addLinesArrays(Vs,i),Vs.length=0}getGraphNode(e){const t=new Xt("ImmediateDebug");return t.worldTransform=e,t._dirtyWorld=t._dirtyNormal=!1,t}onPreRenderLayer(e,t,i){if(this.batchesMap.forEach((s,n)=>{n===e&&s.onPreRender(t,i)}),!this.updatedLayers.has(e)){this.updatedLayers.add(e);const s=this.layerMeshInstances.get(e);if(s){for(let n=0;n<s.length;n++)t.push(s[n]);s.length=0}}}onPostRender(){this.allBatches.forEach(e=>e.clear()),this.allBatches.clear(),this.updatedLayers.clear()}}const cz=2.399963229728653,Ry={circlePoint(r){const e=Math.sqrt(Math.random()),t=Math.random()*2*Math.PI;r.x=e*Math.cos(t),r.y=e*Math.sin(t)},circlePointDeterministic(r,e,t){const i=e*cz,s=Math.sqrt(e)/Math.sqrt(t);r.x=s*Math.cos(i),r.y=s*Math.sin(i)},spherePointDeterministic(r,e,t,i=0,s=1){i=1-2*i,s=1-2*s;const n=Q.lerp(i,s,e/t),a=Math.sqrt(1-n*n),o=cz*e;r.x=Math.cos(o)*a,r.y=n,r.z=Math.sin(o)*a},radicalInverse(r){let e=(r<<16|r>>>16)>>>0;return e=((e&1431655765)<<1|(e&2863311530)>>>1)>>>0,e=((e&858993459)<<2|(e&3435973836)>>>2)>>>0,e=((e&252645135)<<4|(e&4042322160)>>>4)>>>0,e=((e&16711935)<<8|(e&4278255360)>>>8)>>>0,e*23283064365386963e-26}},uz=r=>{switch(r){case vM:return"Cubemap";case Qde:return"Octahedral";default:return"Equirect"}},Z0=(r,e,t)=>{if(r<=0)e[t+0]=0,e[t+1]=0,e[t+2]=0,e[t+3]=0;else if(r>=1)e[t+0]=255,e[t+1]=0,e[t+2]=0,e[t+3]=0;else{let i=1*r%1,s=255*r%1,n=65025*r%1;const a=16581375*r%1;i-=s/255,s-=n/255,n-=a/255,e[t+0]=Math.min(255,Math.floor(i*256)),e[t+1]=Math.min(255,Math.floor(s*256)),e[t+2]=Math.min(255,Math.floor(n*256)),e[t+3]=Math.min(255,Math.floor(a*256))}},d_e=r=>{const e=r.length,t=Math.min(e,512),i=Math.ceil(e/t),s=new Uint8Array(t*i*4);let n=0;for(let a=0;a<e;a+=4)Z0(r[a+0]*.5+.5,s,n+0),Z0(r[a+1]*.5+.5,s,n+4),Z0(r[a+2]*.5+.5,s,n+8),Z0(r[a+3]/8,s,n+12),n+=16;return{width:t,height:i,data:s}},f_e=(r,e,t,i)=>{const s=t*2*Math.PI,n=Math.pow(1-e,1/(i+1)),a=Math.sqrt(1-n*n);r.set(Math.cos(s)*a,Math.sin(s)*a,n).normalize()},p_e=(r,e,t)=>{const i=t*2*Math.PI,s=Math.sqrt(1-e),n=Math.sqrt(e);r.set(Math.cos(i)*n,Math.sin(i)*n,s).normalize()},m_e=(r,e,t,i)=>{const s=t*2*Math.PI,n=Math.sqrt((1-e)/(1+(i*i-1)*e)),a=Math.sqrt(1-n*n);r.set(Math.cos(s)*a,Math.sin(s)*a,n).normalize()},g_e=(r,e)=>{const t=r*e,i=e/(1-r*r+t*t);return i*i*(1/Math.PI)},__e=(r,e)=>{const t=new O,i=[];for(let s=0;s<r;++s)f_e(t,s/r,Ry.radicalInverse(s),e),i.push(t.x,t.y,t.z,0);return i},v_e=(r,e)=>{const t=e/r,i=new O,s=[];for(let n=0;n<r;++n){p_e(i,n/r,Ry.radicalInverse(n));const a=i.z/Math.PI,o=.5*Math.log2(t/a);s.push(i.x,i.y,i.z,o)}return s},y_e={16:{2:26,8:20,32:17,128:16,512:16},32:{2:53,8:40,32:34,128:32,512:32},128:{2:214,8:163,32:139,128:130,512:128},1024:{2:1722,8:1310,32:1114,128:1041,512:1025}},S_e=(r,e)=>{const t=y_e[r];return t&&t[e]||r},x_e=(r,e,t)=>{const i=t/r,s=1-Math.log2(e)/11,n=s*s,a=new O,o=new O,l=new O(0,0,1),c=[],u=S_e(r,e);for(let h=0;h<u;++h){m_e(a,h/u,Ry.radicalInverse(h),n);const d=a.z;if(o.set(a.x,a.y,a.z).mulScalar(2*d).sub(l),o.z>0){const f=g_e(Math.min(1,d),n)/4+.001,p=.5*Math.log2(i/f);c.push(o.x,o.y,o.z,p)}}for(;c.length<r*4;)c.push(0,0,0,0);return c},b_e=(r,e,t)=>{const i=d_e(t);return new we(r,{name:e,width:i.width,height:i.height,mipmaps:!1,minFilter:qe,magFilter:qe,levels:[i.data]})};class V9{constructor(e=!0){this.map=new Map,this.destroyContent=e}destroy(){this.destroyContent&&this.map.forEach((e,t)=>{e.destroy()})}get(e,t){if(!this.map.has(e)){const i=t();return this.map.set(e,i),i}return this.map.get(e)}}const w_e=new V9(!1),T_e=new jr,F3=(r,e,t)=>T_e.get(r,()=>new V9).get(e,()=>b_e(r,e,w_e.get(e,t))),E_e=(r,e,t)=>{const i=`lambert-samples-${e}-${t}`;return F3(r,i,()=>v_e(e,t))},A_e=(r,e,t)=>{const i=`phong-samples-${e}-${t}`;return F3(r,i,()=>__e(e,t))},C_e=(r,e,t,i)=>{const s=`ggx-samples-${e}-${t}-${i}`;return F3(r,s,()=>x_e(e,t,i))};function lo(r,e,t={}){var A,C;const i=t.seamPixels??0,s=(((A=t.rect)==null?void 0:A.z)??e.width)-i*2,n=(((C=t.rect)==null?void 0:C.w)??e.height)-i*2;if(s<1||n<1)return!1;const a={none:"reproject",lambert:"prefilterSamplesUnweighted",phong:"prefilterSamplesUnweighted",ggx:"prefilterSamples"},o=t.hasOwnProperty("specularPower")?t.specularPower:1,l=t.hasOwnProperty("face")?t.face:null,c=t.hasOwnProperty("distribution")?t.distribution:o===1?"none":"phong",u=a[c]||"reproject",h=u.startsWith("prefilterSamples"),d=mc.decodeFunc(r.encoding),f=mc.encodeFunc(e.encoding),p=`sample${uz(r.projection)}`,m=`getDirection${uz(e.projection)}`,g=t.hasOwnProperty("numSamples")?t.numSamples:1024,_=`ReprojectShader:${u}_${d}_${f}_${p}_${m}_${g}`,v=r.device;let y=gp(v).getCachedShader(_);if(!y){const P=new Map;h&&P.set("USE_SAMPLES_TEX",""),r.cubemap&&P.set("CUBEMAP_SOURCE",""),P.set("{PROCESS_FUNC}",u),P.set("{DECODE_FUNC}",d),P.set("{ENCODE_FUNC}",f),P.set("{SOURCE_FUNC}",p),P.set("{TARGET_FUNC}",m),P.set("{NUM_SAMPLES}",g),P.set("{NUM_SAMPLES_SQRT}",Math.round(Math.sqrt(g)).toFixed(1));const I=v.isWebGPU,M=$e.get(v,I?Gt:dt),N=new Map;N.set("decodePS",M.get("decodePS")),N.set("encodePS",M.get("encodePS")),y=Tr.createShader(v,{uniqueName:_,attributes:{vertex_position:Xe},vertexChunk:"reprojectVS",fragmentChunk:"reprojectPS",fragmentIncludes:N,fragmentDefines:P})}v.setBlendState(sr.NOBLEND),v.scope.resolve(r.cubemap?"sourceCube":"sourceTex").setValue(r);const S=v.scope.resolve("params"),w=v.scope.resolve("uvMod");i>0?w.setValue([(s+i*2)/s,(n+i*2)/n,-i/s,-i/n]):w.setValue([1,1,0,0]);const T=[0,e.width*e.height*(e.cubemap?6:1),r.width*r.height*(r.cubemap?6:1)];if(h){const P=r.width*r.height*(r.cubemap?6:1),I=c==="ggx"?C_e(v,g,o,P):c==="lambert"?E_e(v,g,P):A_e(v,g,o);v.scope.resolve("samplesTex").setValue(I),v.scope.resolve("samplesTexInverseSize").setValue([1/I.width,1/I.height])}for(let P=0;P<(e.cubemap?6:1);P++)if(l===null||P===l){const I=new Zi({colorBuffer:e,face:P,depth:!1,flipY:v.isWebGPU});T[0]=P,S.setValue(T),Tc(v,I,y,t==null?void 0:t.rect),I.destroy()}return!0}const DC=(r,e=0)=>1+Math.floor(Math.log2(Math.max(r,e))),P_e=r=>r.textureHalfFloatRenderable,I_e=r=>r.textureFloatRenderable,M_e=r=>P_e(r)?wi:I_e(r)?or:ct,R_e=r=>ct,D_e=(r,e,t,i)=>new we(r,{name:`lighting-${e}`,cubemap:!0,width:e,height:e,format:t,type:Z_,addressU:ge,addressV:ge,mipmaps:!1});class j9{static generateSkyboxCubemap(e,t){const i=e.device,s=D_e(i,t||(e.cubemap?e.width:e.width/4),ct);return lo(e,s,{numSamples:1024}),s}static generateLightingSource(e,t){const i=e.device,s=M_e(i),n=(t==null?void 0:t.target)||new we(i,{name:"lighting-source",cubemap:!0,width:(t==null?void 0:t.size)||128,height:(t==null?void 0:t.size)||128,format:s,type:s===ct?Z_:qa,addressU:ge,addressV:ge,mipmaps:!0});return lo(e,n,{numSamples:e.mipmaps?1:1024}),n}static generateAtlas(e,t){const i=e.device,s=R_e(),n=(t==null?void 0:t.target)||new we(i,{name:"envAtlas",width:(t==null?void 0:t.size)||512,height:(t==null?void 0:t.size)||512,format:s,type:Z_,projection:HB,addressU:ge,addressV:ge,mipmaps:!1}),a=n.width/512,o=new ce(0,0,512*a,256*a),l=DC(256)-DC(4);for(let c=0;c<l;++c)lo(e,n,{numSamples:1,rect:o,seamPixels:a}),o.x+=o.w,o.y+=o.w,o.z=Math.max(1,Math.floor(o.z*.5)),o.w=Math.max(1,Math.floor(o.w*.5));o.set(0,256*a,256*a,128*a);for(let c=1;c<7;++c)lo(e,n,{numSamples:(t==null?void 0:t.numReflectionSamples)||1024,distribution:(t==null?void 0:t.distribution)||"ggx",specularPower:Math.max(1,2048>>c*2),rect:o,seamPixels:a}),o.y+=o.w,o.z=Math.max(1,Math.floor(o.z*.5)),o.w=Math.max(1,Math.floor(o.w*.5));return o.set(128*a,384*a,64*a,32*a),lo(e,n,{numSamples:(t==null?void 0:t.numAmbientSamples)||2048,distribution:"lambert",rect:o,seamPixels:a}),n}static generatePrefilteredAtlas(e,t){const i=e[0].device,s=e[0].format,n=e[0].type,a=(t==null?void 0:t.target)||new we(i,{name:"envPrefilteredAtlas",width:(t==null?void 0:t.size)||512,height:(t==null?void 0:t.size)||512,format:s,type:n,projection:HB,addressU:ge,addressV:ge,mipmaps:!1}),o=a.width/512,l=new ce(0,0,512*o,256*o),c=DC(512);for(let u=0;u<c;++u)lo(e[0],a,{numSamples:1,rect:l,seamPixels:o}),l.x+=l.w,l.y+=l.w,l.z=Math.max(1,Math.floor(l.z*.5)),l.w=Math.max(1,Math.floor(l.w*.5));l.set(0,256*o,256*o,128*o);for(let u=1;u<e.length;++u)lo(e[u],a,{numSamples:1,rect:l,seamPixels:o}),l.y+=l.w,l.z=Math.max(1,Math.floor(l.z*.5)),l.w=Math.max(1,Math.floor(l.w*.5));return l.set(128*o,384*o,64*o,32*o),t!=null&&t.legacyAmbient?lo(e[5],a,{numSamples:1,rect:l,seamPixels:o}):lo(e[0],a,{numSamples:(t==null?void 0:t.numSamples)||2048,distribution:"lambert",rect:l,seamPixels:o}),a}}class L_e{constructor(){this.type=um,this.color=new ae(0,0,0),this.density=0,this.start=1,this.end=1e3}}const ha=class ha extends Te{constructor(e){super(),this.ambientBake=!1,this.ambientBakeOcclusionBrightness=0,this.ambientBakeOcclusionContrast=0,this.ambientLight=new ae(0,0,0),this.ambientLuminance=0,this.exposure=1,this.lightmapSizeMultiplier=1,this.lightmapMaxResolution=2048,this.lightmapMode=nx,this.lightmapFilterEnabled=!1,this.lightmapHDR=!1,this.root=null,this.physicalUnits=!1,this._envAtlas=null,this._skyboxCubeMap=null,this._fogParams=new L_e,this.forcePassThroughSpecular=!1,this.device=e,this._gravity=new O(0,-9.8,0),this._layers=null,this._prefilteredCubemaps=[],this._internalEnvAtlas=null,this._skyboxIntensity=1,this._skyboxLuminance=0,this._skyboxMip=0,this._skyboxHighlightMultiplier=1,this._skyboxRotationShaderInclude=!1,this._skyboxRotation=new de,this._skyboxRotationMat3=new Ba,this._skyboxRotationMat4=new se,this._ambientBakeNumSamples=1,this._ambientBakeSpherePart=.4,this._lightmapFilterRange=10,this._lightmapFilterSmoothness=.2,this._clusteredLightingEnabled=!0,this._lightingParams=new k9(this.device.supportsAreaLights,this.device.maxTextureSize,()=>{this.updateShaders=!0}),this._sky=new l_e(this),this._stats={meshInstances:0,lights:0,dynamicLights:0,bakedLights:0,updateShadersTime:0},this.updateShaders=!0,this._shaderVersion=0,this.immediate=new h_e(this.device)}get defaultDrawLayer(){return this.layers.getLayerById(x3)}set ambientBakeNumSamples(e){this._ambientBakeNumSamples=Q.clamp(Math.floor(e),1,255)}get ambientBakeNumSamples(){return this._ambientBakeNumSamples}set ambientBakeSpherePart(e){this._ambientBakeSpherePart=Q.clamp(e,.001,1)}get ambientBakeSpherePart(){return this._ambientBakeSpherePart}set clusteredLightingEnabled(e){if(!(this.device.isWebGPU&&!e)){if(!this._clusteredLightingEnabled&&e){console.error("Turning on disabled clustered lighting is not currently supported");return}this._clusteredLightingEnabled=e}}get clusteredLightingEnabled(){return this._clusteredLightingEnabled}set envAtlas(e){e!==this._envAtlas&&(this._envAtlas=e,e&&(e.addressU=ge,e.addressV=ge,e.minFilter=_i,e.magFilter=_i,e.mipmaps=!1),this._prefilteredCubemaps=[],this._internalEnvAtlas&&(this._internalEnvAtlas.destroy(),this._internalEnvAtlas=null),this._resetSkyMesh())}get envAtlas(){return this._envAtlas}set layers(e){const t=this._layers;this._layers=e,this.fire("set:layers",t,e)}get layers(){return this._layers}get sky(){return this._sky}get lighting(){return this._lightingParams}get fog(){return this._fogParams}set lightmapFilterRange(e){this._lightmapFilterRange=Math.max(e,.001)}get lightmapFilterRange(){return this._lightmapFilterRange}set lightmapFilterSmoothness(e){this._lightmapFilterSmoothness=Math.max(e,.001)}get lightmapFilterSmoothness(){return this._lightmapFilterSmoothness}set prefilteredCubemaps(e){e=e||[];const t=this._prefilteredCubemaps;(t.length!==e.length||t.some((s,n)=>s!==e[n]))&&(e.length===6&&e.every(n=>!!n)?(this._internalEnvAtlas=j9.generatePrefilteredAtlas(e,{target:this._internalEnvAtlas}),this._envAtlas=this._internalEnvAtlas):(this._internalEnvAtlas&&(this._internalEnvAtlas.destroy(),this._internalEnvAtlas=null),this._envAtlas=null),this._prefilteredCubemaps=e.slice(),this._resetSkyMesh())}get prefilteredCubemaps(){return this._prefilteredCubemaps}set skybox(e){e!==this._skyboxCubeMap&&(this._skyboxCubeMap=e,this._resetSkyMesh())}get skybox(){return this._skyboxCubeMap}set skyboxIntensity(e){e!==this._skyboxIntensity&&(this._skyboxIntensity=e,this._resetSkyMesh())}get skyboxIntensity(){return this._skyboxIntensity}set skyboxLuminance(e){e!==this._skyboxLuminance&&(this._skyboxLuminance=e,this._resetSkyMesh())}get skyboxLuminance(){return this._skyboxLuminance}set skyboxMip(e){e!==this._skyboxMip&&(this._skyboxMip=e,this._resetSkyMesh())}get skyboxMip(){return this._skyboxMip}set skyboxHighlightMultiplier(e){e!==this._skyboxHighlightMultiplier&&(this._skyboxHighlightMultiplier=e,this._resetSkyMesh())}get skyboxHighlightMultiplier(){return this._skyboxHighlightMultiplier}set skyboxRotation(e){if(!this._skyboxRotation.equals(e)){const t=e.equals(de.IDENTITY);this._skyboxRotation.copy(e),t?this._skyboxRotationMat3.setIdentity():(this._skyboxRotationMat4.setTRS(O.ZERO,e,O.ONE),this._skyboxRotationMat3.invertMat4(this._skyboxRotationMat4)),!this._skyboxRotationShaderInclude&&!t&&(this._skyboxRotationShaderInclude=!0,this._resetSkyMesh())}}get skyboxRotation(){return this._skyboxRotation}destroy(){this._resetSkyMesh(),this.root=null,this.off()}drawLine(e,t,i=ae.WHITE,s=!0,n=this.defaultDrawLayer){this.immediate.getBatch(n,s).addLines([e,t],[i,i])}drawLines(e,t,i=!0,s=this.defaultDrawLayer){this.immediate.getBatch(s,i).addLines(e,t)}drawLineArrays(e,t,i=!0,s=this.defaultDrawLayer){this.immediate.getBatch(s,i).addLinesArrays(e,t)}applySettings(e){const t=e.physics,i=e.render;this._gravity.set(t.gravity[0],t.gravity[1],t.gravity[2]),this.ambientLight.set(i.global_ambient[0],i.global_ambient[1],i.global_ambient[2]),this.ambientLuminance=i.ambientLuminance,this.fog.type=i.fog,this.fog.color.set(i.fog_color[0],i.fog_color[1],i.fog_color[2]),this.fog.start=i.fog_start,this.fog.end=i.fog_end,this.fog.density=i.fog_density,this.lightmapSizeMultiplier=i.lightmapSizeMultiplier,this.lightmapMaxResolution=i.lightmapMaxResolution,this.lightmapMode=i.lightmapMode,this.exposure=i.exposure,this._skyboxIntensity=i.skyboxIntensity??1,this._skyboxLuminance=i.skyboxLuminance??2e4,this._skyboxMip=i.skyboxMip??0,i.skyboxRotation&&(this.skyboxRotation=new de().setFromEulerAngles(i.skyboxRotation[0],i.skyboxRotation[1],i.skyboxRotation[2])),this.sky.applySettings(i),this.clusteredLightingEnabled=i.clusteredLightingEnabled??!1,this.lighting.applySettings(i),["lightmapFilterEnabled","lightmapFilterRange","lightmapFilterSmoothness","ambientBake","ambientBakeNumSamples","ambientBakeSpherePart","ambientBakeOcclusionBrightness","ambientBakeOcclusionContrast"].forEach(s=>{i.hasOwnProperty(s)&&(this[s]=i[s])}),this._resetSkyMesh()}_getSkyboxTex(){const e=this._prefilteredCubemaps;return this._skyboxMip?e[[0,1,3,4,5,6][this._skyboxMip]]||this._envAtlas||e[0]||this._skyboxCubeMap:this._skyboxCubeMap||e[0]||this._envAtlas}_updateSkyMesh(){this.sky.skyMesh||this.sky.updateSkyMesh(),this.sky.update()}_resetSkyMesh(){this.sky.resetSkyMesh(),this.updateShaders=!0}setSkybox(e){e?(this.skybox=e[0]||null,e[1]&&!e[1].cubemap?this.envAtlas=e[1]:this.prefilteredCubemaps=e.slice(1)):(this.skybox=null,this.envAtlas=null)}get lightmapPixelFormat(){return this.lightmapHDR&&this.device.getRenderableHdrFormat()||ct}};ha.EVENT_SETLAYERS="set:layers",ha.EVENT_SETSKYBOX="set:skybox",ha.EVENT_PRERENDER="prerender",ha.EVENT_POSTRENDER="postrender",ha.EVENT_PRERENDER_LAYER="prerender:layer",ha.EVENT_POSTRENDER_LAYER="postrender:layer",ha.EVENT_PRECULL="precull",ha.EVENT_POSTCULL="postcull";let OM=ha;class $9{constructor(e,t,i){this.device=e,this.inverseBindPose=t,this.boneNames=i}}const O_e=[0,0,1,0,0,1,0,0,1,0,0,1],N_e=[0,1,3,2,3,1];class k_e extends Te{constructor(e,t){super(),this._device=e,this._pixelsPerUnit=t&&t.pixelsPerUnit!==void 0?t.pixelsPerUnit:1,this._renderMode=t&&t.renderMode!==void 0?t.renderMode:Ca,this._atlas=t&&t.atlas!==void 0?t.atlas:null,this._frameKeys=t&&t.frameKeys!==void 0?t.frameKeys:null,this._meshes=[],this._updatingProperties=!1,this._meshesDirty=!1,this._atlas&&this._frameKeys&&this._createMeshes()}set frameKeys(e){this._frameKeys=e,this._atlas&&this._frameKeys&&(this._updatingProperties?this._meshesDirty=!0:this._createMeshes()),this.fire("set:frameKeys",e)}get frameKeys(){return this._frameKeys}set atlas(e){e!==this._atlas&&(this._atlas&&(this._atlas.off("set:frames",this._onSetFrames,this),this._atlas.off("set:frame",this._onFrameChanged,this),this._atlas.off("remove:frame",this._onFrameRemoved,this)),this._atlas=e,this._atlas&&this._frameKeys&&(this._atlas.on("set:frames",this._onSetFrames,this),this._atlas.on("set:frame",this._onFrameChanged,this),this._atlas.on("remove:frame",this._onFrameRemoved,this),this._updatingProperties?this._meshesDirty=!0:this._createMeshes()),this.fire("set:atlas",e))}get atlas(){return this._atlas}set pixelsPerUnit(e){this._pixelsPerUnit!==e&&(this._pixelsPerUnit=e,this.fire("set:pixelsPerUnit",e),this._atlas&&this._frameKeys&&this.renderMode===Ca&&(this._updatingProperties?this._meshesDirty=!0:this._createMeshes()))}get pixelsPerUnit(){return this._pixelsPerUnit}set renderMode(e){if(this._renderMode===e)return;const t=this._renderMode;this._renderMode=e,this.fire("set:renderMode",e),(t===Ca||e===Ca)&&this._atlas&&this._frameKeys&&(this._updatingProperties?this._meshesDirty=!0:this._createMeshes())}get renderMode(){return this._renderMode}get meshes(){return this._meshes}_createMeshes(){const e=this._meshes.length;for(let s=0;s<e;s++){const n=this._meshes[s];n&&n.destroy()}const t=this._frameKeys.length;this._meshes=new Array(t);const i=this.renderMode===Li||this._renderMode===Oi?this._create9SliceMesh:this._createSimpleMesh;for(let s=0;s<t;s++){const n=this._atlas.frames[this._frameKeys[s]];this._meshes[s]=n?i.call(this,n):null}this.fire("set:meshes")}_createSimpleMesh(e){const t=e.rect,i=this._atlas.texture.width,s=this._atlas.texture.height,n=t.z/this._pixelsPerUnit,a=t.w/this._pixelsPerUnit,o=e.pivot.x,l=e.pivot.y,c=[-o*n,-l*a,0,(1-o)*n,-l*a,0,(1-o)*n,(1-l)*a,0,-o*n,(1-l)*a,0],u=t.x/i,h=1-t.y/s,d=(t.x+t.z)/i,f=1-(t.y+t.w)/s,p=[u,h,d,h,d,f,u,f],m=new yh;return m.positions=c,m.normals=O_e,m.uvs=p,m.indices=N_e,It.fromGeometry(this._device,m)}_create9SliceMesh(){const e=ee.ONE,t=3,i=3,s=[],n=[],a=[],o=[];let l=0;for(let u=0;u<=t;u++){const h=u===0||u===t?0:1;for(let d=0;d<=i;d++){const f=-e.x+2*e.x*(u<=1?0:3)/t,p=0,m=-(-e.y+2*e.y*(d<=1?0:3)/i),g=d===0||d===i?0:1;s.push(-f,p,m),n.push(0,1,0),a.push(h,g),u<t&&d<i&&(o.push(l+i+1,l+1,l),o.push(l+i+1,l+i+2,l+1)),l++}}const c=new yh;return c.positions=s,c.normals=n,c.uvs=a,c.indices=o,It.fromGeometry(this._device,c)}_onSetFrames(e){this._updatingProperties?this._meshesDirty=!0:this._createMeshes()}_onFrameChanged(e,t){const i=this._frameKeys.indexOf(e);i<0||(t?this.renderMode===Ca&&(this._meshes[i]=this._createSimpleMesh(t)):this._meshes[i]=null,this.fire("set:meshes"))}_onFrameRemoved(e){const t=this._frameKeys.indexOf(e);t<0||(this._meshes[t]=null,this.fire("set:meshes"))}startUpdate(){this._updatingProperties=!0,this._meshesDirty=!1}endUpdate(){this._updatingProperties=!1,this._meshesDirty&&this._atlas&&this._frameKeys&&this._createMeshes(),this._meshesDirty=!1}destroy(){for(const e of this._meshes)e&&e.destroy();this._meshes.length=0}}class F_e extends Te{constructor(){super(),this._texture=null,this._frames=null}set texture(e){this._texture=e,this.fire("set:texture",e)}get texture(){return this._texture}set frames(e){this._frames=e,this.fire("set:frames",e)}get frames(){return this._frames}setFrame(e,t){let i=this._frames[e];i?(i.rect.copy(t.rect),i.pivot.copy(t.pivot),i.border.copy(t.border)):(i={rect:t.rect.clone(),pivot:t.pivot.clone(),border:t.border.clone()},this._frames[e]=i),this.fire("set:frame",e.toString(),i)}removeFrame(e){const t=this._frames[e];t&&(delete this._frames[e],this.fire("remove:frame",e.toString(),t))}destroy(){this._texture&&this._texture.destroy()}}class hz{constructor(e,t,i,s){this.time=e,this.position=t,this.rotation=i,this.scale=s}}class dz{constructor(){this._name="",this._keys=[]}}class fz{constructor(){this.name="",this.duration=0,this._nodes=[],this._nodeDict={}}getNode(e){return this._nodeDict[e]}addNode(e){this._nodes.push(e),this._nodeDict[e._name]=e}get nodes(){return this._nodes}}class B_e{constructor(){this._written=!1,this._name="",this._keyFrames=[],this._quat=new de,this._pos=new O,this._scale=new O,this._targetNode=null}getTarget(){return this._targetNode}setTarget(e){this._targetNode=e}}class LC{constructor(e){this.looping=!0,this._animation=null,this._time=0,this._interpolatedKeys=[],this._interpolatedKeyDict={},this._currKeyIndices={},this.graph=null;const t=i=>{const s=new B_e;s._name=i.name,this._interpolatedKeys.push(s),this._interpolatedKeyDict[i.name]=s,this._currKeyIndices[i.name]=0;for(let n=0;n<i._children.length;n++)t(i._children[n])};t(e)}set animation(e){this._animation=e,this.currentTime=0}get animation(){return this._animation}set currentTime(e){this._time=e;const t=this._interpolatedKeys.length;for(let i=0;i<t;i++){const n=this._interpolatedKeys[i]._name;this._currKeyIndices[n]=0}this.addTime(0),this.updateGraph()}get currentTime(){return this._time}get numNodes(){return this._interpolatedKeys.length}addTime(e){if(this._animation!==null){const t=this._animation._nodes,i=this._animation.duration;if(this._time===i&&!this.looping)return;if(this._time+=e,this._time>i){this._time=this.looping?0:i;for(let n=0;n<t.length;n++){const o=t[n]._name;this._currKeyIndices[o]=0}}else if(this._time<0){this._time=this.looping?i:0;for(let n=0;n<t.length;n++){const a=t[n],o=a._name;this._currKeyIndices[o]=a._keys.length-2}}const s=e>=0?1:-1;for(let n=0;n<t.length;n++){const a=t[n],o=a._name,l=a._keys,c=this._interpolatedKeyDict[o];if(c===void 0)continue;let u=!1;if(l.length!==1)for(let h=this._currKeyIndices[o];h<l.length-1&&h>=0;h+=s){const d=l[h],f=l[h+1];if(d.time<=this._time&&f.time>=this._time){const p=(this._time-d.time)/(f.time-d.time);c._pos.lerp(d.position,f.position,p),c._quat.slerp(d.rotation,f.rotation,p),c._scale.lerp(d.scale,f.scale,p),c._written=!0,this._currKeyIndices[o]=h,u=!0;break}}(l.length===1||!u&&this._time===0&&this.looping)&&(c._pos.copy(l[0].position),c._quat.copy(l[0].rotation),c._scale.copy(l[0].scale),c._written=!0)}}}blend(e,t,i){const s=this._interpolatedKeys.length;for(let n=0;n<s;n++){const a=e._interpolatedKeys[n],o=t._interpolatedKeys[n],l=this._interpolatedKeys[n];a._written&&o._written?(l._quat.slerp(a._quat,t._interpolatedKeys[n]._quat,i),l._pos.lerp(a._pos,t._interpolatedKeys[n]._pos,i),l._scale.lerp(a._scale,o._scale,i),l._written=!0):a._written?(l._quat.copy(a._quat),l._pos.copy(a._pos),l._scale.copy(a._scale),l._written=!0):o._written&&(l._quat.copy(o._quat),l._pos.copy(o._pos),l._scale.copy(o._scale),l._written=!0)}}setGraph(e){if(this.graph=e,e)for(let t=0;t<this._interpolatedKeys.length;t++){const i=this._interpolatedKeys[t],s=e.findByName(i._name);this._interpolatedKeys[t].setTarget(s)}else for(let t=0;t<this._interpolatedKeys.length;t++)this._interpolatedKeys[t].setTarget(null)}updateGraph(){if(this.graph)for(let e=0;e<this._interpolatedKeys.length;e++){const t=this._interpolatedKeys[e];if(t._written){const i=t.getTarget();i.localPosition.copy(t._pos),i.localRotation.copy(t._quat),i.localScale.copy(t._scale),i._dirtyLocal||i._dirtifyLocal(),t._written=!1}}}}class U_e{constructor(){this.hasTangents=!1,this.shaderChunks=null,this.pass=0,this.alphaTest=!1,this.blendType=an,this.separateAmbient=!1,this.screenSpace=!1,this.skin=!1,this.batch=!1,this.useInstancing=!1,this.useMorphPosition=!1,this.useMorphNormal=!1,this.useMorphTextureBasedInt=!1,this.nineSlicedMode=0,this.clusteredLightingEnabled=!0,this.clusteredLightingCookiesEnabled=!1,this.clusteredLightingShadowsEnabled=!1,this.clusteredLightingShadowType=0,this.clusteredLightingAreaLightsEnabled=!1,this.vertexColors=!1,this.lightMapEnabled=!1,this.dirLightMapEnabled=!1,this.useHeights=!1,this.useNormals=!1,this.useClearCoatNormals=!1,this.useAo=!1,this.diffuseMapEnabled=!1,this.pixelSnap=!1,this.ambientSH=!1,this.ssao=!1,this.twoSidedLighting=!1,this.occludeDirect=!1,this.occludeSpecular=0,this.occludeSpecularFloat=!1,this.useMsdf=!1,this.msdfTextAttribute=!1,this.alphaToCoverage=!1,this.opacityFadesSpecular=!1,this.opacityDither=mh,this.opacityShadowDither=mh,this.cubeMapProjection=0,this.useSpecular=!1,this.useSpecularityFactor=!1,this.enableGGXSpecular=!1,this.fresnelModel=0,this.useRefraction=!1,this.useClearCoat=!1,this.useSheen=!1,this.useIridescence=!1,this.useMetalness=!1,this.useDynamicRefraction=!1,this.dispersion=!1,this.fog=um,this.gamma=Ay,this.toneMap=-1,this.reflectionSource=fc,this.reflectionEncoding=null,this.reflectionCubemapEncoding=null,this.ambientSource="constant",this.ambientEncoding=null,this.skyboxIntensity=1,this.useCubeMapRotation=!1,this.lightMapWithoutAmbient=!1,this.lights=[],this.noShadow=!1,this.lightMaskDynamic=0,this.userAttributes={},this.linearDepth=!1,this.shadowCatcher=!1}}class On{static update(e,t,i,s,n,a,o){On.updateSharedOptions(e,t,i,n,a),On.updateMaterialOptions(e,t),On.updateEnvOptions(e,t,i,s),On.updateLightingOptions(e,t,i,n,o)}static updateSharedOptions(e,t,i,s,n){e.shaderChunks=t.shaderChunks,e.pass=n,e.alphaTest=t.alphaTest>0,e.blendType=t.blendType,e.screenSpace=s&&(s&D3)!==0,e.skin=s&&(s&NE)!==0,e.useInstancing=s&&(s&kE)!==0,e.useMorphPosition=s&&(s&FE)!==0,e.useMorphNormal=s&&(s&BE)!==0,e.useMorphTextureBasedInt=s&&(s&UE)!==0,e.hasTangents=s&&(s&L3)!==0,e.nineSlicedMode=t.nineSlicedMode||Ca,t.useLighting&&i.clusteredLightingEnabled?(e.clusteredLightingEnabled=!0,e.clusteredLightingCookiesEnabled=i.lighting.cookiesEnabled,e.clusteredLightingShadowsEnabled=i.lighting.shadowsEnabled,e.clusteredLightingShadowType=i.lighting.shadowType,e.clusteredLightingAreaLightsEnabled=i.lighting.areaLightsEnabled):(e.clusteredLightingEnabled=!1,e.clusteredLightingCookiesEnabled=!1,e.clusteredLightingShadowsEnabled=!1,e.clusteredLightingAreaLightsEnabled=!1)}static updateMaterialOptions(e,t){e.separateAmbient=!1,e.pixelSnap=t.pixelSnap,e.ambientSH=t.ambientSH,e.twoSidedLighting=t.twoSidedLighting,e.occludeDirect=t.occludeDirect,e.occludeSpecular=t.occludeSpecular,e.occludeSpecularFloat=t.occludeSpecularIntensity!==1,e.useMsdf=!1,e.msdfTextAttribute=!1,e.alphaToCoverage=t.alphaToCoverage,e.opacityFadesSpecular=t.opacityFadesSpecular,e.opacityDither=t.opacityDither,e.cubeMapProjection=E3,e.useSpecular=t.hasSpecular,e.useSpecularityFactor=t.hasSpecularityFactor,e.enableGGXSpecular=t.ggxSpecular,e.fresnelModel=t.fresnelModel,e.useRefraction=t.hasRefraction,e.useClearCoat=t.hasClearCoat,e.useSheen=t.hasSheen,e.useIridescence=t.hasIrridescence,e.useMetalness=t.hasMetalness,e.useDynamicRefraction=t.dynamicRefraction,e.dispersion=t.dispersion>0,e.vertexColors=!1,e.lightMapEnabled=t.hasLighting,e.dirLightMapEnabled=t.dirLightMap,e.useHeights=t.hasHeights,e.useNormals=t.hasNormals,e.useClearCoatNormals=t.hasClearCoatNormals,e.useAo=t.hasAo,e.diffuseMapEnabled=t.hasDiffuseMap}static updateEnvOptions(e,t,i,s){e.fog=t.useFog?s.fog:um,e.gamma=s.shaderOutputGamma,e.toneMap=t.useTonemap?s.toneMapping:_9,t.useSkybox&&i.envAtlas&&i.skybox?(e.reflectionSource=vb,e.reflectionEncoding=i.envAtlas.encoding,e.reflectionCubemapEncoding=i.skybox.encoding):t.useSkybox&&i.envAtlas?(e.reflectionSource=_b,e.reflectionEncoding=i.envAtlas.encoding):t.useSkybox&&i.skybox?(e.reflectionSource=yb,e.reflectionEncoding=i.skybox.encoding):(e.reflectionSource=fc,e.reflectionEncoding=null),t.ambientSH?(e.ambientSource=C3,e.ambientEncoding=null):e.reflectionSource!==fc&&i.envAtlas?(e.ambientSource=P3,e.ambientEncoding=i.envAtlas.encoding):(e.ambientSource=I3,e.ambientEncoding=null);const n=e.reflectionSource!==fc;e.skyboxIntensity=n,e.useCubeMapRotation=n&&i._skyboxRotationShaderInclude}static updateLightingOptions(e,t,i,s,n){if(e.lightMapWithoutAmbient=!1,t.useLighting){const a=[],o=s?s>>16:Zn;e.lightMaskDynamic=!!(o&Zn),e.lightMapWithoutAmbient=!1,n&&(On.collectLights(Me,n[Me],a,o),i.clusteredLightingEnabled||(On.collectLights(Pt,n[Pt],a,o),On.collectLights(Rt,n[Rt],a,o))),e.lights=a}else e.lights=[];(e.lights.length===0&&!i.clusteredLightingEnabled||s&M3)&&(e.noShadow=!0)}static collectLights(e,t,i,s){for(let n=0;n<t.length;n++){const a=t[n];a.enabled&&a.mask&s&&i.push(a)}}}const OC={vertex_normal:Rs,vertex_tangent:Xa,vertex_texCoord0:un,vertex_texCoord1:Oh,vertex_color:wr,vertex_boneWeights:za,vertex_boneIndices:Es},z_e=new Map([["vec4","vec4f"],["vec3","vec3f"],["vec2","vec2f"],["float","f32"]]);class V_e{constructor(e,t,i=!0){this.varyingsCode="",this.vDefines=new Map,this.fDefines=new Map,this.includes=new Map,this.chunks=null,this.device=e,this.options=t;const s=t.shaderChunks;if(this.shaderLanguage=e.isWebGPU&&i&&(s!=null&&s.useWGSL)?Gt:dt,this.attributes={vertex_position:Xe},t.userAttributes)for(const[a,o]of Object.entries(t.userAttributes))this.attributes[o]=a;const n=$e.get(e,this.shaderLanguage);this.chunks=new Map(n),s&&(this.shaderLanguage===dt?s.glsl:s.wgsl).forEach((o,l)=>{for(const c in OC)OC.hasOwnProperty(c)&&o.indexOf(c)>=0&&(this.attributes[c]=OC[c]);this.chunks.set(l,o)}),this.shaderPassInfo=Va.get(this.device).getByIndex(t.pass),this.shadowPass=this.shaderPassInfo.isShadow,this.lighting=t.lights.length>0||t.dirLightMapEnabled||t.clusteredLightingEnabled,this.reflections=t.reflectionSource!==fc,this.needsNormal=this.lighting||this.reflections||t.useSpecular||t.ambientSH||t.useHeights||t.enableGGXSpecular||t.clusteredLightingEnabled&&!this.shadowPass||t.useClearCoatNormals,this.needsNormal=this.needsNormal&&!this.shadowPass,this.needsSceneColor=t.useDynamicRefraction,this.needsScreenSize=t.useDynamicRefraction,this.needsTransforms=t.useDynamicRefraction,this.vshader=null,this.fshader=null}fDefineSet(e,t,i=""){e&&this.fDefines.set(t,i)}generateVertexShader(e,t,i){const{options:s,vDefines:n,attributes:a}=this,o=new Map;if(o.set("vPositionW","vec3"),(s.nineSlicedMode===Li||s.nineSlicedMode===Oi)&&n.set("NINESLICED",!0),this.options.linearDepth&&(n.set("LINEAR_DEPTH",!0),o.set("vLinearDepth","float")),this.needsNormal&&n.set("NORMALS",!0),this.options.useInstancing){const h=$e.get(this.device,this.shaderLanguage);this.chunks.get("transformInstancingVS")===h.get("transformInstancingVS")&&(a.instance_line1=JO,a.instance_line2=by,a.instance_line3=e3,a.instance_line4=ap)}this.needsNormal&&(a.vertex_normal=Rs,o.set("vNormalW","vec3"),s.hasTangents&&(s.useHeights||s.useNormals||s.useClearCoatNormals||s.enableGGXSpecular)?(n.set("TANGENTS",!0),a.vertex_tangent=Xa,o.set("vTangentW","vec3"),o.set("vBinormalW","vec3")):s.enableGGXSpecular&&(n.set("GGX_SPECULAR",!0),o.set("vObjectSpaceUpW","vec3")));const l=2;for(let h=0;h<l;h++)e[h]&&(n.set(`UV${h}`,!0),a[`vertex_texCoord${h}`]=`TEXCOORD${h}`),t[h]&&(n.set(`UV${h}_UNMODIFIED`,!0),o.set(`vUv${h}`,"vec2"));let c=0;const u=new Set;i.forEach(h=>{const{id:d,uv:f,name:p}=h,m=d+f*100;if(!u.has(m)){u.add(m),o.set(`vUV${f}_${d}`,"vec2");const g=`texture_${p}MapTransform`;n.set(`{TRANSFORM_NAME_${c}}`,g),n.set(`{TRANSFORM_UV_${c}}`,f),n.set(`{TRANSFORM_ID_${c}}`,d),c++}}),n.set("UV_TRANSFORMS_COUNT",c),s.vertexColors&&(a.vertex_color=wr,n.set("VERTEX_COLOR",!0),o.set("vVertexColor","vec4")),s.useMsdf&&s.msdfTextAttribute&&(a.vertex_outlineParameters=Y_,a.vertex_shadowParameters=K_,n.set("MSDF",!0)),(s.useMorphPosition||s.useMorphNormal)&&(n.set("MORPHING",!0),s.useMorphTextureBasedInt&&n.set("MORPHING_INT",!0),s.useMorphPosition&&n.set("MORPHING_POSITION",!0),s.useMorphNormal&&n.set("MORPHING_NORMAL",!0),a.morph_vertex_id=ap),s.skin&&(a.vertex_boneIndices=Es,s.batch?n.set("BATCH",!0):(a.vertex_boneWeights=za,n.set("SKIN",!0))),s.useInstancing&&n.set("INSTANCING",!0),s.screenSpace&&n.set("SCREENSPACE",!0),s.pixelSnap&&n.set("PIXELSNAP",!0),o.forEach((h,d)=>{this.varyingsCode+=`#define VARYING_${d.toUpperCase()}
`,this.varyingsCode+=this.shaderLanguage===Gt?`varying ${d}: ${z_e.get(h)};
`:`varying ${h} ${d};
`}),this.includes.set("varyingsVS",this.varyingsCode),this.includes.set("varyingsPS",this.varyingsCode),this.vshader=`
						#include "litMainVS"
				`}_setupLightingDefines(e,t){const i=this.fDefines,s=this.options;if(this.fDefines.set("LIGHT_COUNT",s.lights.length),e&&i.set("AREA_LIGHTS",!0),t&&this.lighting&&(i.set("LIT_CLUSTERED_LIGHTS",!0),s.clusteredLightingCookiesEnabled&&i.set("CLUSTER_COOKIES",!0),s.clusteredLightingAreaLightsEnabled&&i.set("CLUSTER_AREALIGHTS",!0),s.lightMaskDynamic&&i.set("CLUSTER_MESH_DYNAMIC_LIGHTS",!0),s.clusteredLightingShadowsEnabled&&!s.noShadow)){const n=Vo.get(s.clusteredLightingShadowType);i.set("CLUSTER_SHADOWS",!0),i.set(`SHADOW_KIND_${n.kind}`,!0),i.set(`CLUSTER_SHADOW_TYPE_${n.kind}`,!0)}for(let n=0;n<s.lights.length;n++){const a=s.lights[n],o=a._type;if(t&&o!==Me)continue;const l=e&&a._shape?a._shape:Wn,c=a._shadowType,u=a.castShadows&&!s.noShadow,h=Vo.get(c);i.set(`LIGHT${n}`,!0),i.set(`LIGHT${n}TYPE`,`${mU[o]}`),i.set(`LIGHT${n}SHADOWTYPE`,`${h.name}`),i.set(`LIGHT${n}SHAPE`,`${Hpe[l]}`),i.set(`LIGHT${n}FALLOFF`,`${Gpe[a._falloffMode]}`),a.affectSpecularity&&i.set(`LIGHT${n}AFFECT_SPECULARITY`,!0),a._cookie&&(o===Rt&&!a._cookie._cubemap||o===Pt&&a._cookie._cubemap)&&(i.set(`LIGHT${n}COOKIE`,!0),i.set(`{LIGHT${n}COOKIE_CHANNEL}`,a._cookieChannel),o===Rt&&(a._cookieTransform&&i.set(`LIGHT${n}COOKIE_TRANSFORM`,!0),a._cookieFalloff&&i.set(`LIGHT${n}COOKIE_FALLOFF`,!0))),u&&(i.set(`LIGHT${n}CASTSHADOW`,!0),h.pcf&&i.set(`LIGHT${n}SHADOW_PCF`,!0),a._normalOffsetBias&&!a._isVsm&&i.set(`LIGHT${n}_SHADOW_SAMPLE_NORMAL_OFFSET`,!0),o===Me&&(i.set(`LIGHT${n}_SHADOW_SAMPLE_ORTHO`,!0),a.cascadeBlend>0&&i.set(`LIGHT${n}_SHADOW_CASCADE_BLEND`,!0),a.numCascades>1&&i.set(`LIGHT${n}_SHADOW_CASCADES`,!0)),(h.pcf||h.pcss||this.device.isWebGPU)&&i.set(`LIGHT${n}_SHADOW_SAMPLE_SOURCE_ZBUFFER`,!0),o===Pt&&i.set(`LIGHT${n}_SHADOW_SAMPLE_POINT`,!0)),u&&(i.set(`SHADOW_KIND_${h.kind}`,!0),o===Me&&i.set("SHADOW_DIRECTIONAL",!0))}}prepareForwardPass(e){const{options:t}=this,s=t.clusteredLightingEnabled&&t.clusteredLightingAreaLightsEnabled||t.lights.some(o=>o._shape&&o._shape!==Wn),n=!t.lightMapEnabled||t.lightMapWithoutAmbient,a=this.needsNormal&&(t.useNormals||t.useClearCoatNormals||t.enableGGXSpecular&&!t.useHeights);t.useSpecular&&(this.fDefineSet(!0,"LIT_SPECULAR"),this.fDefineSet(this.reflections,"LIT_REFLECTIONS"),this.fDefineSet(t.useClearCoat,"LIT_CLEARCOAT"),this.fDefineSet(t.fresnelModel>0,"LIT_SPECULAR_FRESNEL"),this.fDefineSet(t.useSheen,"LIT_SHEEN"),this.fDefineSet(t.useIridescence,"LIT_IRIDESCENCE")),this.fDefineSet(this.lighting&&t.useSpecular||this.reflections,"LIT_SPECULAR_OR_REFLECTION"),this.fDefineSet(this.needsSceneColor,"LIT_SCENE_COLOR"),this.fDefineSet(this.needsScreenSize,"LIT_SCREEN_SIZE"),this.fDefineSet(this.needsTransforms,"LIT_TRANSFORMS"),this.fDefineSet(this.needsNormal,"LIT_NEEDS_NORMAL"),this.fDefineSet(this.lighting,"LIT_LIGHTING"),this.fDefineSet(t.useMetalness,"LIT_METALNESS"),this.fDefineSet(t.enableGGXSpecular,"LIT_GGX_SPECULAR"),this.fDefineSet(t.useSpecularityFactor,"LIT_SPECULARITY_FACTOR"),this.fDefineSet(t.useCubeMapRotation,"CUBEMAP_ROTATION"),this.fDefineSet(t.occludeSpecularFloat,"LIT_OCCLUDE_SPECULAR_FLOAT"),this.fDefineSet(t.separateAmbient,"LIT_SEPARATE_AMBIENT"),this.fDefineSet(t.twoSidedLighting,"LIT_TWO_SIDED_LIGHTING"),this.fDefineSet(t.lightMapEnabled,"LIT_LIGHTMAP"),this.fDefineSet(t.dirLightMapEnabled,"LIT_DIR_LIGHTMAP"),this.fDefineSet(t.skyboxIntensity>0,"LIT_SKYBOX_INTENSITY"),this.fDefineSet(t.clusteredLightingShadowsEnabled,"LIT_CLUSTERED_SHADOWS"),this.fDefineSet(t.clusteredLightingAreaLightsEnabled,"LIT_CLUSTERED_AREA_LIGHTS"),this.fDefineSet(a,"LIT_TBN"),this.fDefineSet(n,"LIT_ADD_AMBIENT"),this.fDefineSet(t.hasTangents,"LIT_TANGENTS"),this.fDefineSet(t.useNormals,"LIT_USE_NORMALS"),this.fDefineSet(t.useClearCoatNormals,"LIT_USE_CLEARCOAT_NORMALS"),this.fDefineSet(t.useRefraction,"LIT_REFRACTION"),this.fDefineSet(t.useDynamicRefraction,"LIT_DYNAMIC_REFRACTION"),this.fDefineSet(t.dispersion,"LIT_DISPERSION"),this.fDefineSet(t.useHeights,"LIT_HEIGHTS"),this.fDefineSet(t.opacityFadesSpecular,"LIT_OPACITY_FADES_SPECULAR"),this.fDefineSet(t.alphaToCoverage,"LIT_ALPHA_TO_COVERAGE"),this.fDefineSet(t.alphaTest,"LIT_ALPHA_TEST"),this.fDefineSet(t.useMsdf,"LIT_MSDF"),this.fDefineSet(t.ssao,"LIT_SSAO"),this.fDefineSet(t.useAo,"LIT_AO"),this.fDefineSet(t.occludeDirect,"LIT_OCCLUDE_DIRECT"),this.fDefineSet(t.msdfTextAttribute,"LIT_MSDF_TEXT_ATTRIBUTE"),this.fDefineSet(t.diffuseMapEnabled,"LIT_DIFFUSE_MAP"),this.fDefineSet(t.shadowCatcher,"LIT_SHADOW_CATCHER"),this.fDefineSet(!0,"LIT_FRESNEL_MODEL",jpe[t.fresnelModel]),this.fDefineSet(!0,"LIT_NONE_SLICE_MODE",tme[t.nineSlicedMode]),this.fDefineSet(!0,"LIT_BLEND_TYPE",a9[t.blendType]),this.fDefineSet(!0,"LIT_CUBEMAP_PROJECTION",Kpe[t.cubeMapProjection]),this.fDefineSet(!0,"LIT_OCCLUDE_SPECULAR",Qpe[t.occludeSpecular]),this.fDefineSet(!0,"LIT_REFLECTION_SOURCE",Jpe[t.reflectionSource]),this.fDefineSet(!0,"LIT_AMBIENT_SOURCE",eme[t.ambientSource]),this.fDefineSet(!0,"{lightingUv}",e??""),this.fDefineSet(!0,"{reflectionDecode}",mc.decodeFunc(t.reflectionEncoding)),this.fDefineSet(!0,"{reflectionCubemapDecode}",mc.decodeFunc(t.reflectionCubemapEncoding)),this.fDefineSet(!0,"{ambientDecode}",mc.decodeFunc(t.ambientEncoding)),this._setupLightingDefines(s,t.clusteredLightingEnabled)}prepareShadowPass(){const{options:e}=this,t=this.shaderPassInfo.lightType,i=this.shaderPassInfo.shadowType,s=Vo.get(i),n=t===Me||!s.vsm&&t===Rt;this.fDefineSet(n,"PERSPECTIVE_DEPTH"),this.fDefineSet(!0,"LIGHT_TYPE",`${mU[t]}`),this.fDefineSet(!0,"SHADOW_TYPE",`${s.name}`),this.fDefineSet(e.alphaTest,"LIT_ALPHA_TEST")}generateFragmentShader(e,t,i){const s=this.options;this.includes.set("frontendDeclPS",e??""),this.includes.set("frontendCodePS",t??""),s.pass===VE||s.pass===zE||(this.shadowPass?this.prepareShadowPass():this.prepareForwardPass(i)),this.fshader=`
						#include "litMainPS"
				`}}const H9={generateKey(r){return`lit${Object.keys(r).sort().map(e=>{var t;return e==="shaderChunks"?((t=r.shaderChunks)==null?void 0:t.key)??"":e==="lights"?H9.generateLightsKey(r):e+r[e]}).join(`
`)}`},generateLightsKey(r){return`lights:${r.lights.map(e=>!r.clusteredLightingEnabled||e._type===Me?`${e.key},`:"").join("")}`}};class wb{get pass(){return this.litOptions.pass}constructor(){this.defines=new Map,this.forceUv1=!1,this.specularTint=!1,this.metalnessTint=!1,this.glossTint=!1,this.emissiveEncoding="linear",this.lightMapEncoding="linear",this.packedNormal=!1,this.normalDetailPackedNormal=!1,this.clearCoatPackedNormal=!1,this.glossInvert=!1,this.sheenGlossInvert=!1,this.clearCoatGlossInvert=!1,this.useAO=!1,this.litOptions=new U_e}}const Rf=[],NC=r=>Object.keys(r).filter(e=>e!=="litOptions").sort();class j_e extends gh{generateKey(e){let t;return e===this.optionsContextMin?(this.propsMin||(this.propsMin=NC(e)),t=this.propsMin):e===this.optionsContext?(this.props||(this.props=NC(e)),t=this.props):t=NC(e),`standard:
${gh.definesHash(e.defines)}
${t.map(n=>n+e[n]).join(`
`)}${H9.generateKey(e.litOptions)}`}_getUvSourceExpression(e,t,i){const s=i[e],n=i[t],a=i.litOptions.pass===Nh;let o;return a&&i.litOptions.nineSlicedMode===Li||a&&i.litOptions.nineSlicedMode===Oi?o="nineSlicedUv":(s===0?o=`vUv${n}`:o=`vUV${n}_${s}`,i.heightMap&&e!=="heightMapTransform"&&(o+=" + dUvOffset")),o}_validateMapChunk(e,t,i){}_addMapDefines(e,t,i,s,n,a,o=null){const l=`${t}Map`,c=t.toUpperCase(),u=`${l}Uv`,h=`${l}Identifier`,d=`${l}Transform`,f=`${l}Channel`,p=`${t}VertexColorChannel`,m=`${t}Tint`,g=`${t}VertexColor`,_=`${t}Mode`,v=`${t}Invert`,y=s[m],x=s[g],S=s[l],w=s[h],T=s[_],A=n.get(i);if(S){e.set(`STD_${c}_TEXTURE`,"");const C=this._getUvSourceExpression(d,u,s);e.set(`{STD_${c}_TEXTURE_UV}`,C),e.set(`{STD_${c}_TEXTURE_CHANNEL}`,s[f]);const P=`{STD_${c}_TEXTURE_NAME}`;if(A.includes(P)){let I=`texture_${l}`;const M=a[w];M?I=M:(a[w]=I,e.set(`STD_${c}_TEXTURE_ALLOCATE`,"")),e.set(P,I)}if(o){const I=s[f]==="aaa"?"passThrough":mc.decodeFunc(o);e.set(`{STD_${c}_TEXTURE_DECODE}`,I)}}x&&(e.set(`STD_${c}_VERTEX`,""),e.set(`{STD_${c}_VERTEX_CHANNEL}`,s[p])),T&&e.set(`{STD_${c}_DETAILMODE}`,T),y&&e.set(`STD_${c}_CONSTANT`,""),s[v]&&e.set(`STD_${c}_INVERT`,"")}_correctChannel(e,t,i){if(i[e]>0){if(i[e]<t.length)return t.substring(0,i[e]);if(i[e]>t.length){let s=t;const n=s.charAt(s.length-1),a=i[e]-s.length;for(let o=0;o<a;o++)s+=n;return s}return t}}createVertexShader(e,t){const i=[],s=[],n=[];for(const o in Rf){const l=`${o}Map`;if(t[`${o}VertexColor`]){const c=`${o}VertexColorChannel`;t[c]=this._correctChannel(o,t[c],Rf)}if(t[l]){const c=`${l}Channel`,u=`${l}Transform`,h=`${l}Uv`;t[h]=Math.min(t[h],1),t[c]=this._correctChannel(o,t[c],Rf);const d=t[h];i[d]=!0,s[d]=s[d]||t[l]&&!t[u],t[u]&&n.push({name:o,id:t[u],uv:t[h]})}}t.forceUv1&&(i[1]=!0,s[1]=s[1]!==void 0?s[1]:!0),e.generateVertexShader(i,s,n)}prepareFragmentDefines(e,t,i){const s=(n,a,o="")=>{n&&t.set(a,o)};s(e.lightMap,"STD_LIGHTMAP",""),s(e.lightVertexColor,"STD_LIGHT_VERTEX_COLOR",""),s(e.dirLightMap&&e.litOptions.useSpecular,"STD_LIGHTMAP_DIR",""),s(e.heightMap,"STD_HEIGHT_MAP",""),s(e.useSpecularColor,"STD_SPECULAR_COLOR",""),s(e.aoMap||e.aoVertexColor||e.useAO,"STD_AO",""),s(!0,"STD_OPACITY_DITHER",hme[i.isForward?e.litOptions.opacityDither:e.litOptions.opacityShadowDither])}createShaderDefinition(e,t){const i=Va.get(e).getByIndex(t.litOptions.pass),s=i.isForward,n=new V_e(e,t.litOptions);this.createVertexShader(n,t);const a={};t.litOptions.fresnelModel=t.litOptions.fresnelModel===0?y3:t.litOptions.fresnelModel;const o=n.fDefines;this.prepareFragmentDefines(t,o,i);let l="";if(s){if(t.heightMap&&this._addMapDefines(o,"height","parallaxPS",t,n.chunks,a),(t.litOptions.blendType!==an||t.litOptions.alphaTest||t.litOptions.alphaToCoverage||t.litOptions.opacityDither!==mh)&&this._addMapDefines(o,"opacity","opacityPS",t,n.chunks,a),n.needsNormal){if((t.normalMap||t.clearCoatNormalMap)&&!t.litOptions.hasTangents){const d=t.normalMap?"normalMap":"clearCoatNormalMap";l=this._getUvSourceExpression(`${d}Transform`,`${d}Uv`,t)}this._addMapDefines(o,"normalDetail","normalMapPS",t,n.chunks,a,t.normalDetailPackedNormal?"xy":"xyz"),this._addMapDefines(o,"normal","normalMapPS",t,n.chunks,a,t.packedNormal?"xy":"xyz")}t.diffuseDetail&&this._addMapDefines(o,"diffuseDetail","diffusePS",t,n.chunks,a,t.diffuseDetailEncoding),this._addMapDefines(o,"diffuse","diffusePS",t,n.chunks,a,t.diffuseEncoding),t.litOptions.useRefraction&&(this._addMapDefines(o,"refraction","transmissionPS",t,n.chunks,a),this._addMapDefines(o,"thickness","thicknessPS",t,n.chunks,a)),t.litOptions.useIridescence&&(this._addMapDefines(o,"iridescence","iridescencePS",t,n.chunks,a),this._addMapDefines(o,"iridescenceThickness","iridescenceThicknessPS",t,n.chunks,a)),(n.lighting&&t.litOptions.useSpecular||n.reflections)&&(t.litOptions.useSheen&&(this._addMapDefines(o,"sheen","sheenPS",t,n.chunks,a,t.sheenEncoding),this._addMapDefines(o,"sheenGloss","sheenGlossPS",t,n.chunks,a)),t.litOptions.useMetalness&&(this._addMapDefines(o,"metalness","metalnessPS",t,n.chunks,a),this._addMapDefines(o,"ior","iorPS",t,n.chunks,a)),t.litOptions.useSpecularityFactor&&this._addMapDefines(o,"specularityFactor","specularityFactorPS",t,n.chunks,a),t.useSpecularColor&&this._addMapDefines(o,"specular","specularPS",t,n.chunks,a,t.specularEncoding),this._addMapDefines(o,"gloss","glossPS",t,n.chunks,a)),t.aoDetail&&this._addMapDefines(o,"aoDetail","aoPS",t,n.chunks,a),(t.aoMap||t.aoVertexColor||t.useAO)&&this._addMapDefines(o,"ao","aoPS",t,n.chunks,a),this._addMapDefines(o,"emissive","emissivePS",t,n.chunks,a,t.emissiveEncoding),t.litOptions.useClearCoat&&(this._addMapDefines(o,"clearCoat","clearCoatPS",t,n.chunks,a),this._addMapDefines(o,"clearCoatGloss","clearCoatGlossPS",t,n.chunks,a),this._addMapDefines(o,"clearCoatNormal","clearCoatNormalPS",t,n.chunks,a,t.clearCoatPackedNormal?"xy":"xyz")),t.litOptions.enableGGXSpecular&&this._addMapDefines(o,"anisotropy","anisotropyPS",t,n.chunks,a),(t.lightMap||t.lightVertexColor)&&this._addMapDefines(o,"light","lightmapPS",t,n.chunks,a,t.lightMapEncoding)}else{const d=t.litOptions.opacityShadowDither;(t.litOptions.alphaTest||d)&&this._addMapDefines(o,"opacity","opacityPS",t,n.chunks,a)}n.generateFragmentShader(n.chunks.get("stdDeclarationPS"),n.chunks.get("stdFrontEndPS"),l);const c=Sb.merge(n.chunks,n.includes),u=n.vDefines;t.defines.forEach((d,f)=>u.set(f,d)),t.defines.forEach((d,f)=>o.set(f,d));const h=Wr.createDefinition(e,{name:"StandardShader",attributes:n.attributes,shaderLanguage:n.shaderLanguage,vertexCode:n.vshader,fragmentCode:n.fshader,vertexIncludes:c,fragmentIncludes:c,fragmentDefines:o,vertexDefines:u});return n.shaderPassInfo.isForward&&(h.tag=Wde),h}constructor(...e){super(...e),this.optionsContext=new wb,this.optionsContextMin=new wb}}const kC=new j_e,pz=(r,e)=>{if(r.length!==e.length)return!1;for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0},$_e=r=>r.r!==1||r.g!==1||r.b!==1,H_e=r=>r.r!==0||r.g!==0||r.b!==0;class G_e{constructor(){this._mapXForms=null}updateMinRef(e,t,i,s,n,a){this._updateSharedOptions(e,t,i,s,n),this._updateMinOptions(e,i,n),this._updateUVOptions(e,i,s,!0)}updateRef(e,t,i,s,n,a,o){this._updateSharedOptions(e,t,s,n,a),this._updateEnvOptions(e,s,t,i),this._updateMaterialOptions(e,s,t),e.litOptions.hasTangents=n&&(n&L3)!==0,this._updateLightOptions(e,t,s,n,o),this._updateUVOptions(e,s,n,!1,i)}_updateSharedOptions(e,t,i,s,n){e.forceUv1=i.forceUv1,i.userAttributes&&(e.litOptions.userAttributes=Object.fromEntries(i.userAttributes.entries())),e.litOptions.shaderChunks=i.shaderChunks,e.litOptions.pass=n,e.litOptions.alphaTest=i.alphaTest>0,e.litOptions.blendType=i.blendType,e.litOptions.screenSpace=s&&(s&D3)!==0,e.litOptions.skin=s&&(s&NE)!==0,e.litOptions.batch=s&&(s&CM)!==0,e.litOptions.useInstancing=s&&(s&kE)!==0,e.litOptions.useMorphPosition=s&&(s&FE)!==0,e.litOptions.useMorphNormal=s&&(s&BE)!==0,e.litOptions.useMorphTextureBasedInt=s&&(s&UE)!==0,e.litOptions.nineSlicedMode=i.nineSlicedMode||0,t.clusteredLightingEnabled&&i.useLighting?(e.litOptions.clusteredLightingEnabled=!0,e.litOptions.clusteredLightingCookiesEnabled=t.lighting.cookiesEnabled,e.litOptions.clusteredLightingShadowsEnabled=t.lighting.shadowsEnabled,e.litOptions.clusteredLightingShadowType=t.lighting.shadowType,e.litOptions.clusteredLightingAreaLightsEnabled=t.lighting.areaLightsEnabled):(e.litOptions.clusteredLightingEnabled=!1,e.litOptions.clusteredLightingCookiesEnabled=!1,e.litOptions.clusteredLightingShadowsEnabled=!1,e.litOptions.clusteredLightingAreaLightsEnabled=!1)}_updateUVOptions(e,t,i,s,n){let a=!1,o=!1,l=!1;i&&(a=(i&R3)!==0,o=(i&b9)!==0,l=(i&w9)!==0),e.litOptions.vertexColors=!1,this._mapXForms=[];const c={};for(const u in Rf)this._updateTexOptions(e,t,u,a,o,l,s,c);this._mapXForms=null,e.litOptions.ssao=n==null?void 0:n.ssaoEnabled,e.useAO=e.litOptions.ssao,e.litOptions.lightMapEnabled=e.lightMap,e.litOptions.dirLightMapEnabled=e.dirLightMap,e.litOptions.useHeights=e.heightMap,e.litOptions.useNormals=e.normalMap,e.litOptions.useClearCoatNormals=e.clearCoatNormalMap,e.litOptions.useAo=e.aoMap||e.aoVertexColor||e.litOptions.ssao,e.litOptions.diffuseMapEnabled=e.diffuseMap}_updateTexOptions(e,t,i,s,n,a,o,l){const c=i==="opacity";if(!o||c){const u=`${i}Map`,h=`${i}VertexColor`,d=`${i}VertexColorChannel`,f=`${u}Channel`,p=`${u}Transform`,m=`${u}Uv`,g=`${u}Identifier`;if(i!=="light"&&(e[u]=!1,e[g]=void 0,e[f]="",e[p]=0,e[m]=0),e[h]=!1,e[d]="",c&&t.blendType===an&&t.alphaTest===0&&!t.alphaToCoverage&&t.opacityDither===mh)return;if(i!=="height"&&t[h]&&a&&(e[h]=t[h],e[d]=t[d],e.litOptions.vertexColors=!0),t[u]){let _=!0;if(t[m]===0&&!s&&(_=!1),t[m]===1&&!n&&(_=!1),_){const v=t[u].id;let y=l[v];y===void 0&&(l[v]=i,y=i),e[u]=!!t[u],e[g]=y,e[p]=this._getMapTransformID(t.getUniform(p),t[m]),e[f]=t[f],e[m]=t[m]}}}}_updateMinOptions(e,t,i){const s=i===zE;e.litOptions.opacityShadowDither=s?t.opacityDither:t.opacityShadowDither,e.litOptions.linearDepth=s,e.litOptions.lights=[]}_updateMaterialOptions(e,t,i){var u,h,d,f,p,m;const s=!!(t.useMetalness||t.specularMap||t.sphereMap||t.cubeMap||H_e(t.specular)||t.specularityFactor>0&&t.useMetalness||t.enableGGXSpecular||t.clearCoat>0),n=!t.useMetalness||t.useMetalnessSpecularColor,a=s&&(t.specularTint||!t.specularMap&&!t.specularVertexColor)&&$_e(t.specular),o=s&&t.useMetalnessSpecularColor&&(t.specularityFactorTint||t.specularityFactor<1&&!t.specularityFactorMap),l=g=>g?g.format===fy||g.type===t3:!1,c=(g,_)=>Math.abs(g-_)<1e-4;e.specularTint=a,e.specularityFactorTint=o,e.metalnessTint=t.useMetalness&&t.metalness<1,e.glossTint=!0,e.diffuseEncoding=(u=t.diffuseMap)==null?void 0:u.encoding,e.diffuseDetailEncoding=(h=t.diffuseDetailMap)==null?void 0:h.encoding,e.emissiveEncoding=(d=t.emissiveMap)==null?void 0:d.encoding,e.lightMapEncoding=(f=t.lightMap)==null?void 0:f.encoding,e.packedNormal=l(t.normalMap),e.refractionTint=c(t.refraction,1),e.refractionIndexTint=c(t.refractionIndex,1/1.5),e.thicknessTint=t.useDynamicRefraction&&t.thickness!==1,e.specularEncoding=(p=t.specularMap)==null?void 0:p.encoding,e.sheenEncoding=(m=t.sheenMap)==null?void 0:m.encoding,e.aoMapUv=t.aoUvSet,e.aoDetail=!!t.aoDetailMap,e.diffuseDetail=!!t.diffuseDetailMap,e.normalDetail=!!t.normalMap,e.normalDetailPackedNormal=l(t.normalDetailMap),e.diffuseDetailMode=t.diffuseDetailMode,e.aoDetailMode=t.aoDetailMode,e.clearCoatGloss=!!t.clearCoatGloss,e.clearCoatPackedNormal=l(t.clearCoatNormalMap),e.iorTint=c(t.refractionIndex,1/1.5),i.forcePassThroughSpecular&&(e.specularEncoding="linear",e.sheenEncoding="linear"),e.iridescenceTint=t.iridescence!==1,e.glossInvert=t.glossInvert,e.sheenGlossInvert=t.sheenGlossInvert,e.clearCoatGlossInvert=t.clearCoatGlossInvert,e.useSpecularColor=n,e.litOptions.separateAmbient=!1,e.litOptions.pixelSnap=t.pixelSnap,e.litOptions.ambientSH=!!t.ambientSH,e.litOptions.twoSidedLighting=t.twoSidedLighting,e.litOptions.occludeSpecular=t.occludeSpecular,e.litOptions.occludeSpecularFloat=t.occludeSpecularIntensity!==1,e.litOptions.useMsdf=!!t.msdfMap,e.litOptions.msdfTextAttribute=!!t.msdfTextAttribute,e.litOptions.alphaToCoverage=t.alphaToCoverage,e.litOptions.opacityFadesSpecular=t.opacityFadesSpecular,e.litOptions.opacityDither=t.opacityDither,e.litOptions.cubeMapProjection=t.cubeMapProjection,e.litOptions.occludeDirect=t.occludeDirect,e.litOptions.useSpecular=s,e.litOptions.useSpecularityFactor=(o||!!t.specularityFactorMap)&&t.useMetalnessSpecularColor,e.litOptions.enableGGXSpecular=t.enableGGXSpecular,e.litOptions.fresnelModel=t.fresnelModel,e.litOptions.useRefraction=(t.refraction||!!t.refractionMap)&&(t.useDynamicRefraction||e.litOptions.reflectionSource!==fc),e.litOptions.useClearCoat=!!t.clearCoat,e.litOptions.useSheen=t.useSheen,e.litOptions.useIridescence=t.useIridescence&&t.iridescence!==0,e.litOptions.useMetalness=t.useMetalness,e.litOptions.useDynamicRefraction=t.useDynamicRefraction,e.litOptions.dispersion=t.dispersion>0,e.litOptions.shadowCatcher=t.shadowCatcher}_updateEnvOptions(e,t,i,s){e.litOptions.fog=t.useFog?s.fog:um,e.litOptions.gamma=s.shaderOutputGamma,e.litOptions.toneMap=t.useTonemap?s.toneMapping:_9;let n=!1;if(t.envAtlas&&t.cubeMap?(e.litOptions.reflectionSource=vb,e.litOptions.reflectionEncoding=t.envAtlas.encoding,e.litOptions.reflectionCubemapEncoding=t.cubeMap.encoding):t.envAtlas?(e.litOptions.reflectionSource=_b,e.litOptions.reflectionEncoding=t.envAtlas.encoding):t.cubeMap?(e.litOptions.reflectionSource=yb,e.litOptions.reflectionEncoding=t.cubeMap.encoding):t.sphereMap?(e.litOptions.reflectionSource=x9,e.litOptions.reflectionEncoding=t.sphereMap.encoding):t.useSkybox&&i.envAtlas&&i.skybox?(e.litOptions.reflectionSource=vb,e.litOptions.reflectionEncoding=i.envAtlas.encoding,e.litOptions.reflectionCubemapEncoding=i.skybox.encoding,n=!0):t.useSkybox&&i.envAtlas?(e.litOptions.reflectionSource=_b,e.litOptions.reflectionEncoding=i.envAtlas.encoding,n=!0):t.useSkybox&&i.skybox?(e.litOptions.reflectionSource=yb,e.litOptions.reflectionEncoding=i.skybox.encoding,n=!0):(e.litOptions.reflectionSource=fc,e.litOptions.reflectionEncoding=null),t.ambientSH)e.litOptions.ambientSource=C3,e.litOptions.ambientEncoding=null;else{const a=t.envAtlas||(t.useSkybox&&i.envAtlas?i.envAtlas:null);a&&!t.sphereMap?(e.litOptions.ambientSource=P3,e.litOptions.ambientEncoding=a.encoding):(e.litOptions.ambientSource=I3,e.litOptions.ambientEncoding=null)}e.litOptions.skyboxIntensity=n,e.litOptions.useCubeMapRotation=n&&i._skyboxRotationShaderInclude}_updateLightOptions(e,t,i,s,n){if(e.lightMap=!1,e.lightMapChannel="",e.lightMapUv=0,e.lightMapTransform=0,e.litOptions.lightMapWithoutAmbient=!1,e.dirLightMap=!1,s&&(e.litOptions.noShadow=(s&M3)!==0,s&AM&&(e.lightMapEncoding=t.lightmapPixelFormat===ct?"rgbm":"linear",e.lightMap=!0,e.lightMapChannel="rgb",e.lightMapUv=1,e.lightMapTransform=0,e.litOptions.lightMapWithoutAmbient=!i.lightMap,s&T9&&(e.dirLightMap=!0),s&E9&&(e.litOptions.lightMapWithoutAmbient=!1))),i.useLighting){const a=[],o=s?s>>16:Zn;e.litOptions.lightMaskDynamic=!!(o&Zn),n&&(On.collectLights(Me,n[Me],a,o),t.clusteredLightingEnabled||(On.collectLights(Pt,n[Pt],a,o),On.collectLights(Rt,n[Rt],a,o))),e.litOptions.lights=a}else e.litOptions.lights=[];e.litOptions.lights.length===0&&!t.clusteredLightingEnabled&&(e.litOptions.noShadow=!0)}_getMapTransformID(e,t){if(!e)return 0;let i=this._mapXForms[t];i||(i=[],this._mapXForms[t]=i);for(let s=0;s<i.length;s++)if(pz(i[s][0].value,e[0].value)&&pz(i[s][1].value,e[1].value))return s+1;return i.push(e)}}function Yt(r,e=!0,t=!0){const i={};return i[`${r}Map`]="texture",i[`${r}MapTiling`]="vec2",i[`${r}MapOffset`]="vec2",i[`${r}MapRotation`]="number",i[`${r}MapUv`]="number",e&&(i[`${r}MapChannel`]="string",t&&(i[`${r}VertexColor`]="boolean",i[`${r}VertexColorChannel`]="string")),i}const vp={name:"string",chunks:"chunks",mappingFormat:"string",_engine:"boolean",ambient:"rgb",...Yt("ao"),...Yt("aoDetail",!0,!1),aoDetailMode:"string",aoIntensity:"number",diffuse:"rgb",...Yt("diffuse"),...Yt("diffuseDetail",!0,!1),diffuseDetailMode:"string",specular:"rgb",specularTint:"boolean",...Yt("specular"),occludeSpecular:"enum:occludeSpecular",specularityFactor:"number",specularityFactorTint:"boolean",...Yt("specularityFactor"),useMetalness:"boolean",metalness:"number",enableGGXSpecular:"boolean",metalnessTint:"boolean",...Yt("metalness"),useMetalnessSpecularColor:"boolean",anisotropyIntensity:"number",anisotropyRotation:"number",...Yt("anisotropy"),shininess:"number",gloss:"number",glossInvert:"boolean",...Yt("gloss"),clearCoat:"number",...Yt("clearCoat"),clearCoatGloss:"number",clearCoatGlossInvert:"boolean",...Yt("clearCoatGloss"),clearCoatBumpiness:"number",...Yt("clearCoatNormal",!1),useSheen:"boolean",sheen:"rgb",...Yt("sheen"),sheenGloss:"number",sheenGlossInvert:"boolean",...Yt("sheenGloss"),fresnelModel:"number",emissive:"rgb",...Yt("emissive"),emissiveIntensity:"number",...Yt("normal",!1),bumpiness:"number",...Yt("normalDetail",!1),normalDetailMapBumpiness:"number",...Yt("height",!0,!1),heightMapFactor:"number",alphaToCoverage:"boolean",alphaTest:"number",alphaFade:"number",opacity:"number",...Yt("opacity"),opacityFadesSpecular:"boolean",opacityDither:"string",opacityShadowDither:"string",reflectivity:"number",refraction:"number",refractionTint:"boolean",...Yt("refraction"),refractionIndex:"number",dispersion:"number",thickness:"number",thicknessTint:"boolean",...Yt("thickness"),attenuation:"rgb",attenuationDistance:"number",useDynamicRefraction:"boolean",sphereMap:"texture",cubeMap:"cubemap",cubeMapProjection:"number",cubeMapProjectionBox:"boundingbox",useIridescence:"boolean",iridescence:"number",iridescenceTint:"boolean",...Yt("iridescence"),iridescenceThicknessTint:"boolean",iridescenceThicknessMin:"number",iridescenceThicknessMax:"number",iridescenceRefractionIndex:"number",...Yt("iridescenceThickness"),...Yt("light"),depthTest:"boolean",depthFunc:"enum:depthFunc",depthWrite:"boolean",depthBias:"number",slopeDepthBias:"number",cull:"enum:cull",blendType:"enum:blendType",useFog:"boolean",useLighting:"boolean",useSkybox:"boolean",useTonemap:"boolean",envAtlas:"texture",twoSidedLighting:"boolean",shadowCatcher:"boolean"},HE=[];for(const r in vp)vp[r]==="texture"&&HE.push(r);const B3=[];for(const r in vp)vp[r]==="cubemap"&&B3.push(r);const W_e={aoMapVertexColor:"boolean",diffuseMapTint:"boolean",diffuseMapVertexColor:"boolean",emissiveMapTint:"boolean",emissiveMapVertexColor:"boolean",glossMapVertexColor:"boolean",metalnessMapVertexColor:"boolean",opacityMapVertexColor:"boolean",specularAntialias:"boolean",specularMapTint:"boolean",specularMapVertexColor:"boolean",ambientTint:"boolean",emissiveTint:"boolean",diffuseTint:"boolean",sheenTint:"boolean",conserveEnergy:"boolean",useGamma:"boolean",useGammaTonemap:"boolean",sheenGlossTint:"boolean",anisotropy:"boolean"},cx={},G9={};let Jm=new Set;const Q0=new ae,iT=class iT extends My{constructor(){super(),this.userAttributes=new Map,this._assetReferences={},this._activeParams=new Set,this._activeLightingParams=new Set,this.shaderOptBuilder=new G_e,this.reset()}reset(){Object.keys(cx).forEach(e=>{this[`_${e}`]=cx[e].value()}),this._uniformCache={}}copy(e){return super.copy(e),Object.keys(cx).forEach(t=>{this[t]=e[t]}),this.userAttributes=new Map(e.userAttributes),this}setAttribute(e,t){this.userAttributes.set(t,e)}_setParameter(e,t){Jm.add(e),this.setParameter(e,t)}_setParameters(e){e.forEach(t=>{this._setParameter(t.name,t.value)})}_processParameters(e){const t=this[e];t.forEach(i=>{Jm.has(i)||delete this.parameters[i]}),this[e]=Jm,Jm=t,Jm.clear()}_updateMap(e){const t=`${e}Map`,i=this[t];if(i){this._setParameter(`texture_${t}`,i);const s=`${t}Transform`,n=this.getUniform(s);n&&this._setParameters(n)}}_allocUniform(e,t){let i=this._uniformCache[e];return i||(i=t(),this._uniformCache[e]=i),i}getUniform(e,t,i){return G9[e](this,t,i)}updateUniforms(e,t){const i=s=>this.getUniform(s,e,t);this._setParameter("material_ambient",i("ambient")),this._setParameter("material_diffuse",i("diffuse")),this._setParameter("material_aoIntensity",this.aoIntensity),this.useMetalness?((!this.metalnessMap||this.metalness<1)&&this._setParameter("material_metalness",this.metalness),(!this.specularMap||this.specularTint)&&this._setParameter("material_specular",i("specular")),(!this.specularityFactorMap||this.specularityFactorTint)&&this._setParameter("material_specularityFactor",this.specularityFactor),this._setParameter("material_sheen",i("sheen")),this._setParameter("material_sheenGloss",this.sheenGloss),this._setParameter("material_refractionIndex",this.refractionIndex)):(!this.specularMap||this.specularTint)&&this._setParameter("material_specular",i("specular")),this.enableGGXSpecular&&(this._setParameter("material_anisotropyIntensity",this.anisotropyIntensity),this._setParameter("material_anisotropyRotation",[Math.cos(this.anisotropyRotation*Q.DEG_TO_RAD),Math.sin(this.anisotropyRotation*Q.DEG_TO_RAD)])),this.clearCoat>0&&(this._setParameter("material_clearCoat",this.clearCoat),this._setParameter("material_clearCoatGloss",this.clearCoatGloss),this._setParameter("material_clearCoatBumpiness",this.clearCoatBumpiness)),this._setParameter("material_gloss",this.gloss),this._setParameter("material_emissive",i("emissive")),this._setParameter("material_emissiveIntensity",this.emissiveIntensity),this.refraction>0&&this._setParameter("material_refraction",this.refraction),this.dispersion>0&&this._setParameter("material_dispersion",this.dispersion),this.useDynamicRefraction&&(this._setParameter("material_thickness",this.thickness),this._setParameter("material_attenuation",i("attenuation")),this._setParameter("material_invAttenuationDistance",this.attenuationDistance===0?0:1/this.attenuationDistance)),this.useIridescence&&(this._setParameter("material_iridescence",this.iridescence),this._setParameter("material_iridescenceRefractionIndex",this.iridescenceRefractionIndex),this._setParameter("material_iridescenceThicknessMin",this.iridescenceThicknessMin),this._setParameter("material_iridescenceThicknessMax",this.iridescenceThicknessMax)),this._setParameter("material_opacity",this.opacity),this.opacityFadesSpecular===!1&&this._setParameter("material_alphaFade",this.alphaFade),this.occludeSpecular&&this._setParameter("material_occludeSpecularIntensity",this.occludeSpecularIntensity),this.cubeMapProjection===g9&&this._setParameter(i("cubeMapProjectionBox"));for(const s in Rf)this._updateMap(s);this.ambientSH&&this._setParameter("ambientSH[0]",this.ambientSH),this.normalMap&&this._setParameter("material_bumpiness",this.bumpiness),this.normalMap&&this.normalDetailMap&&this._setParameter("material_normalDetailMapBumpiness",this.normalDetailMapBumpiness),this.heightMap&&this._setParameter("material_heightMapFactor",i("heightMapFactor")),this.envAtlas&&this.cubeMap?(this._setParameter("texture_envAtlas",this.envAtlas),this._setParameter("texture_cubeMap",this.cubeMap)):this.envAtlas?this._setParameter("texture_envAtlas",this.envAtlas):this.cubeMap?this._setParameter("texture_cubeMap",this.cubeMap):this.sphereMap&&this._setParameter("texture_sphereMap",this.sphereMap),this._setParameter("material_reflectivity",this.reflectivity),this._processParameters("_activeParams"),super.updateUniforms(e,t)}updateEnvUniforms(e,t){!(this.envAtlas||this.cubeMap||this.sphereMap)&&this.useSkybox&&(t.envAtlas&&t.skybox?(this._setParameter("texture_envAtlas",t.envAtlas),this._setParameter("texture_cubeMap",t.skybox)):t.envAtlas?this._setParameter("texture_envAtlas",t.envAtlas):t.skybox&&this._setParameter("texture_cubeMap",t.skybox)),this._processParameters("_activeLightingParams")}getShaderVariant(e){const{device:t,scene:i,pass:s,objDefs:n,sortedLights:a,cameraShaderParams:o}=e;this.updateEnvUniforms(t,i);const l=Va.get(t).getByIndex(s),c=s===VE||s===zE||l.isShadow;let u=c?kC.optionsContextMin:kC.optionsContext;u.defines=Tr.getCoreDefines(this,e),c?this.shaderOptBuilder.updateMinRef(u,i,this,n,s,a):this.shaderOptBuilder.updateRef(u,i,o,this,n,s,a),this.useFog||u.defines.set("FOG","NONE"),u.defines.set("TONEMAP",v9[u.litOptions.toneMap]),this.onUpdateShader&&(u=this.onUpdateShader(u));const h=new jE(e.viewUniformFormat,e.viewBindGroupFormat,e.vertexFormat),d=gp(t);d.register("standard",kC);const f=d.getProgram("standard",u,h,this.userId);return this._dirtyShader=!1,f}destroy(){for(const e in this._assetReferences)this._assetReferences[e]._unbind();this._assetReferences=null,super.destroy()}};iT.TEXTURE_PARAMETERS=HE,iT.CUBEMAP_PARAMETERS=B3;let Ns=iT;const GE=(r,e)=>{G9[r]=e},U3=(r,e,t,i)=>{Object.defineProperty(Ns.prototype,r,{get:i||function(){return this[`_${r}`]},set:t}),cx[r]={value:e}},X_e=r=>{const e=`_${r.name}`,t=r.dirtyShaderFunc||(()=>!0),i=function(s){const n=this[e];n!==s&&(this._dirtyShader=this._dirtyShader||t(n,s),this[e]=s)};U3(r.name,()=>r.defaultValue,i,r.getterFunc)},q_e=r=>{const e=`_${r.name}`,t=r.dirtyShaderFunc||(()=>!0),i=function(s){const n=this[e];n.equals(s)||(this._dirtyShader=this._dirtyShader||t(n,s),this[e]=n.copy(s))};U3(r.name,()=>r.defaultValue.clone(),i,r.getterFunc)},qs=r=>r.defaultValue&&r.defaultValue.clone?q_e(r):X_e(r);function Ft(r,e="rgb",t=!0,i=0){Rf[r]=e.length||-1,qs({name:`${r}Map`,defaultValue:null,dirtyShaderFunc:(l,c)=>!!l!=!!c||l&&(l.type!==c.type||l.format!==c.format)}),qs({name:`${r}MapTiling`,defaultValue:new ee(1,1)}),qs({name:`${r}MapOffset`,defaultValue:new ee(0,0)}),qs({name:`${r}MapRotation`,defaultValue:0}),qs({name:`${r}MapUv`,defaultValue:i}),e&&(qs({name:`${r}MapChannel`,defaultValue:e}),t&&(qs({name:`${r}VertexColor`,defaultValue:!1}),qs({name:`${r}VertexColorChannel`,defaultValue:e})));const s=`${r}MapTiling`,n=`${r}MapOffset`,a=`${r}MapRotation`,o=`${r}MapTransform`;GE(o,(l,c,u)=>{const h=l[s],d=l[n],f=l[a];if(h.x===1&&h.y===1&&d.x===0&&d.y===0&&f===0)return null;const p=l._allocUniform(o,()=>[{name:`texture_${o}0`,value:new Float32Array(3)},{name:`texture_${o}1`,value:new Float32Array(3)}]),m=Math.cos(f*Q.DEG_TO_RAD),g=Math.sin(f*Q.DEG_TO_RAD),_=p[0].value;_[0]=m*h.x,_[1]=-g*h.y,_[2]=d.x;const v=p[1].value;return v[0]=g*h.x,v[1]=m*h.y,v[2]=1-h.y-d.y,p})}function ld(r,e){qs({name:r,defaultValue:e,getterFunc:function(){return this._dirtyShader=!0,this[`_${r}`]}}),GE(r,(t,i,s)=>{const n=t._allocUniform(r,()=>new Float32Array(3)),a=t[r];return Q0.linear(a),n[0]=Q0.r,n[1]=Q0.g,n[2]=Q0.b,n})}function ht(r,e,t){qs({name:r,defaultValue:e,dirtyShaderFunc:(i,s)=>(i===0||i===1)!=(s===0||s===1)}),GE(r,t)}function eg(r,e){qs({name:r,defaultValue:null,dirtyShaderFunc:(t,i)=>!!t==!!i}),GE(r,e)}function at(r,e){qs({name:r,defaultValue:e})}function Y_e(){ld("ambient",new ae(1,1,1)),ld("diffuse",new ae(1,1,1)),ld("specular",new ae(0,0,0)),ld("emissive",new ae(0,0,0)),ld("sheen",new ae(1,1,1)),ld("attenuation",new ae(1,1,1)),ht("emissiveIntensity",1),ht("specularityFactor",1),ht("sheenGloss",0),ht("gloss",.25),ht("aoIntensity",1),ht("heightMapFactor",1,(i,s,n)=>i.heightMapFactor*.025),ht("opacity",1),ht("alphaFade",1),ht("alphaTest",0),ht("bumpiness",1),ht("normalDetailMapBumpiness",1),ht("reflectivity",1),ht("occludeSpecularIntensity",1),ht("refraction",0),ht("refractionIndex",1/1.5),ht("dispersion",0),ht("thickness",0),ht("attenuationDistance",0),ht("metalness",1),ht("anisotropyIntensity",0),ht("anisotropyRotation",0),ht("clearCoat",0),ht("clearCoatGloss",1),ht("clearCoatBumpiness",1),ht("aoUvSet",0,null),ht("iridescence",0),ht("iridescenceRefractionIndex",1/1.5),ht("iridescenceThicknessMin",0),ht("iridescenceThicknessMax",0),eg("ambientSH"),eg("cubeMapProjectionBox",(i,s,n)=>{const a=i._allocUniform("cubeMapProjectionBox",()=>[{name:"envBoxMin",value:new Float32Array(3)},{name:"envBoxMax",value:new Float32Array(3)}]),o=i.cubeMapProjectionBox.getMin(),l=a[0].value;l[0]=o.x,l[1]=o.y,l[2]=o.z;const c=i.cubeMapProjectionBox.getMax(),u=a[1].value;return u[0]=c.x,u[1]=c.y,u[2]=c.z,a}),at("specularTint",!1),at("specularityFactorTint",!1),at("useMetalness",!1),at("useMetalnessSpecularColor",!1),at("useSheen",!1),at("enableGGXSpecular",!1),at("occludeDirect",!1),at("opacityFadesSpecular",!0),at("occludeSpecular",OE),at("fresnelModel",y3),at("useDynamicRefraction",!1),at("cubeMapProjection",E3),at("useFog",!0),at("useLighting",!0),at("useTonemap",!0),at("useSkybox",!0),at("forceUv1",!1),at("pixelSnap",!1),at("twoSidedLighting",!1),at("nineSlicedMode",void 0),at("msdfTextAttribute",!1),at("useIridescence",!1),at("glossInvert",!1),at("sheenGlossInvert",!1),at("clearCoatGlossInvert",!1),at("opacityDither",mh),at("opacityShadowDither",mh),at("shadowCatcher",!1),Ft("diffuse"),Ft("specular"),Ft("emissive"),Ft("thickness","g"),Ft("specularityFactor","g"),Ft("normal",""),Ft("metalness","g"),Ft("gloss","g"),Ft("opacity","a"),Ft("refraction","g"),Ft("height","g",!1),Ft("ao","g"),Ft("light","rgb",!0,1),Ft("msdf",""),Ft("diffuseDetail","rgb",!1),Ft("normalDetail",""),Ft("aoDetail","g",!1),Ft("clearCoat","g"),Ft("clearCoatGloss","g"),Ft("clearCoatNormal",""),Ft("sheen","rgb"),Ft("sheenGloss","g"),Ft("iridescence","g"),Ft("iridescenceThickness","g"),Ft("anisotropy",""),at("diffuseDetailMode",gU),at("aoDetailMode",gU),eg("cubeMap"),eg("sphereMap"),eg("envAtlas");const r=function(){return this._prefilteredCubemaps},e=function(i){const s=this._prefilteredCubemaps;i=i||[];let n=!1,a=!0;for(let o=0;o<6;++o){const l=i[o]||null;s[o]!==l&&(s[o]=l,n=!0),a=a&&!!s[o]}n&&(a?this.envAtlas=j9.generatePrefilteredAtlas(s,{target:this.envAtlas}):this.envAtlas&&(this.envAtlas.destroy(),this.envAtlas=null),this._dirtyShader=!0)},t=[null,null,null,null,null,null];U3("prefilteredCubemaps",()=>t.slice(),e,r)}Y_e();const En=4/64,oa=1-En*2;class z3 extends yh{constructor(e,t,i,s,n,a){super();const o=new O,l=new O,c=new O,u=new O,h=new O,d=new O,f=[],p=[],m=[],g=[],_=[];let v;if(i>0)for(let y=0;y<=s;y++)for(let x=0;x<=n;x++){const S=x/n*2*Math.PI-Math.PI,w=Math.sin(S),T=Math.cos(S);h.set(w*e,-i/2,T*e),u.set(w*t,i/2,T*t),o.lerp(h,u,y/s),l.sub2(u,h).normalize(),d.set(T,0,-w),c.cross(d,l).normalize(),f.push(o.x,o.y,o.z),p.push(c.x,c.y,c.z);let A=x/n,C=y/s;m.push(A,1-C);const P=C;if(C=A,A=P,A=A*oa+En,C=C*oa+En,A/=3,g.push(A,1-C),y<s&&x<n){const I=y*(n+1)+x,M=y*(n+1)+(x+1),N=(y+1)*(n+1)+x,k=(y+1)*(n+1)+(x+1);_.push(I,M,N),_.push(M,k,N)}}if(a){const y=Math.floor(n/2),x=n,S=i/2;for(let w=0;w<=y;w++){const T=w*Math.PI*.5/y,A=Math.sin(T),C=Math.cos(T);for(let P=0;P<=x;P++){const I=P*2*Math.PI/x-Math.PI/2,M=Math.sin(I),k=Math.cos(I)*A,V=C,B=M*A;let R=1-P/x,L=1-w/y;f.push(k*t,V*t+S,B*t),p.push(k,V,B),m.push(R,1-L),R=R*oa+En,L=L*oa+En,R/=3,L/=3,R+=1/3,g.push(R,1-L)}}v=(s+1)*(n+1);for(let w=0;w<y;++w)for(let T=0;T<x;++T){const A=w*(x+1)+T,C=A+x+1;_.push(v+A+1,v+C,v+A),_.push(v+A+1,v+C+1,v+C)}for(let w=0;w<=y;w++){const T=Math.PI*.5+w*Math.PI*.5/y,A=Math.sin(T),C=Math.cos(T);for(let P=0;P<=x;P++){const I=P*2*Math.PI/x-Math.PI/2,M=Math.sin(I),k=Math.cos(I)*A,V=C,B=M*A;let R=1-P/x,L=1-w/y;f.push(k*t,V*t-S,B*t),p.push(k,V,B),m.push(R,1-L),R=R*oa+En,L=L*oa+En,R/=3,L/=3,R+=2/3,g.push(R,1-L)}}v=(s+1)*(n+1)+(x+1)*(y+1);for(let w=0;w<y;++w)for(let T=0;T<x;++T){const A=w*(x+1)+T,C=A+x+1;_.push(v+A+1,v+C,v+A),_.push(v+A+1,v+C+1,v+C)}}else{if(v=(s+1)*(n+1),e>0)for(let y=0;y<n;y++){const x=y/n*2*Math.PI,S=Math.sin(x),w=-i/2,T=Math.cos(x);let A=1-(S+1)/2,C=(T+1)/2;f.push(S*e,w,T*e),p.push(0,-1,0),m.push(A,1-C),A=A*oa+En,C=C*oa+En,A/=3,C/=3,A+=1/3,g.push(A,1-C),y>1&&_.push(v,v+y,v+y-1)}if(v+=n,t>0)for(let y=0;y<n;y++){const x=y/n*2*Math.PI,S=Math.sin(x),w=i/2,T=Math.cos(x);let A=1-(S+1)/2,C=(T+1)/2;f.push(S*t,w,T*t),p.push(0,1,0),m.push(A,1-C),A=A*oa+En,C=C*oa+En,A/=3,C/=3,A+=2/3,g.push(A,1-C),y>1&&_.push(v,v+y-1,v+y)}}this.positions=f,this.normals=p,this.uvs=m,this.uvs1=g,this.indices=_}}class K_e extends z3{constructor(e={}){const t=e.radius??.3,i=e.height??1,s=e.heightSegments??1,n=e.sides??20;super(t,t,i-2*t,s,n,!0),e.calculateTangents&&(this.tangents=Mc(this.positions,this.normals,this.uvs,this.indices))}}class Z_e extends z3{constructor(e={}){const t=e.baseRadius??.5,i=e.peakRadius??0,s=e.height??1,n=e.heightSegments??5,a=e.capSegments??18;super(t,i,s,n,a,!1),e.calculateTangents&&(this.tangents=Mc(this.positions,this.normals,this.uvs,this.indices))}}class Q_e extends z3{constructor(e={}){const t=e.radius??.5,i=e.height??1,s=e.heightSegments??5,n=e.capSegments??20;super(t,t,i,s,n,!1),e.calculateTangents&&(this.tangents=Mc(this.positions,this.normals,this.uvs,this.indices))}}class J_e extends yh{constructor(e={}){super();const t=e.halfExtents??new ee(.5,.5),i=e.widthSegments??5,s=e.lengthSegments??5,n=[],a=[],o=[],l=[];let c=0;for(let u=0;u<=i;u++)for(let h=0;h<=s;h++){const d=-t.x+2*t.x*u/i,f=0,p=-(-t.y+2*t.y*h/s),m=u/i,g=h/s;n.push(d,f,p),a.push(0,1,0),o.push(m,1-g),u<i&&h<s&&(l.push(c+s+1,c+1,c),l.push(c+s+1,c+s+2,c+1)),c++}this.positions=n,this.normals=a,this.uvs=o,this.uvs1=o,this.indices=l,e.calculateTangents&&(this.tangents=Mc(n,a,o,l))}}class eve extends yh{constructor(e={}){super();const t=e.tubeRadius??.2,i=e.ringRadius??.3,s=(e.sectorAngle??360)*Q.DEG_TO_RAD,n=e.segments??30,a=e.sides??20,o=[],l=[],c=[],u=[];for(let h=0;h<=a;h++)for(let d=0;d<=n;d++){const f=Math.cos(s*d/n)*(i+t*Math.cos(2*Math.PI*h/a)),p=Math.sin(2*Math.PI*h/a)*t,m=Math.sin(s*d/n)*(i+t*Math.cos(2*Math.PI*h/a)),g=Math.cos(s*d/n)*Math.cos(2*Math.PI*h/a),_=Math.sin(2*Math.PI*h/a),v=Math.sin(s*d/n)*Math.cos(2*Math.PI*h/a),y=h/a,x=1-d/n;if(o.push(f,p,m),l.push(g,_,v),c.push(y,1-x),h<a&&d<n){const S=h*(n+1)+d,w=(h+1)*(n+1)+d,T=h*(n+1)+(d+1),A=(h+1)*(n+1)+(d+1);u.push(S,w,T),u.push(w,A,T)}}this.positions=o,this.normals=l,this.uvs=c,this.uvs1=c,this.indices=u,e.calculateTangents&&(this.tangents=Mc(o,l,c,u))}}class tve{constructor(e,t){this.processedCache=new Map,this.definitionsCache=new Map,this._generators=new Map,this._device=e,this._isClearingCache=!1,this._precached=!1,this._programsCollection=[],this._defaultStdMatOption=new wb,this._defaultStdMatOptionMin=new wb;const i=new R9;t.shaderOptBuilder.updateRef(this._defaultStdMatOption,{},i,t,null,[],Nh,null),t.shaderOptBuilder.updateMinRef(this._defaultStdMatOptionMin,{},t,null,A9,null),e.on("destroy:shader",s=>{this.removeFromCache(s)})}destroy(){this.clearCache()}register(e,t){this._generators.has(e)||this._generators.set(e,t)}unregister(e){this._generators.has(e)&&this._generators.delete(e)}isRegistered(e){return this._generators.has(e)}generateShaderDefinition(e,t,i,s){var a,o;let n=this.definitionsCache.get(i);if(!n){let l;(a=s.litOptions)!=null&&a.lights&&(l=s.litOptions.lights,s.litOptions.lights=l.map(u=>{const h=u.clone?u.clone():u;return h.key=u.key,h})),this.storeNewProgram(t,s),(o=s.litOptions)!=null&&o.lights&&(s.litOptions.lights=l),this._precached;const c=this._device;n=e.createShaderDefinition(c,s),n.name=n.name??(s.pass?`${t}-pass:${s.pass}`:t),this.definitionsCache.set(i,n)}return n}getCachedShader(e){return this.processedCache.get(e)}setCachedShader(e,t){this.processedCache.set(e,t)}getProgram(e,t,i,s){const n=this._generators.get(e);if(!n)return null;const a=n.generateKey(t),o=Ia(a),l=i.generateKey(this._device),c=Ia(l),u=`${o}#${c}`;let h=this.getCachedShader(u);if(!h){const d=this.generateShaderDefinition(n,e,o,t);let f="",p;t.pass!==void 0&&(p=Va.get(this._device).getByIndex(t.pass),f=`-${p.name}`),this._device.fire("shader:generate",{userMaterialId:s,shaderPassInfo:p,definition:d});const m={name:`${d.name}${f}-proc`,attributes:d.attributes,vshader:d.vshader,vincludes:d.vincludes,fincludes:d.fincludes,fshader:d.fshader,processingOptions:i,shaderLanguage:d.shaderLanguage,meshUniformBufferFormat:d.meshUniformBufferFormat,meshBindGroupFormat:d.meshBindGroupFormat};h=new s9(this._device,m),this.setCachedShader(u,h)}return h}storeNewProgram(e,t){let i={};if(e==="standard"){const s=this._getDefaultStdMatOptions(t.pass);for(const n in t)(t.hasOwnProperty(n)&&s[n]!==t[n]||n==="pass")&&(i[n]=t[n]);for(const n in t.litOptions)i[n]=t.litOptions[n]}else i=t;this._programsCollection.push(JSON.stringify({name:e,options:i}))}dumpPrograms(){let e=`let device = pc.app ? pc.app.graphicsDevice : pc.Application.getApplication().graphicsDevice;
`;e+="let shaders = [",this._programsCollection[0]&&(e+=`
	${this._programsCollection[0]}`);for(let i=1;i<this._programsCollection.length;++i)e+=`,
	${this._programsCollection[i]}`;e+=`
];
`,e+=`pc.getProgramLibrary(device).precompile(shaders);
`,e+=`if (pc.version != "${sq}" || pc.revision != "${rde}")
`,e+='	console.warn("precompile-shaders.js: engine version mismatch, rebuild shaders lib with current engine");';const t=document.createElement("a");t.setAttribute("href",`data:text/plain;charset=utf-8,${encodeURIComponent(e)}`),t.setAttribute("download","precompile-shaders.js"),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}clearCache(){this._isClearingCache=!0,this.processedCache.forEach(e=>{e.destroy()}),this.processedCache.clear(),this._isClearingCache=!1}removeFromCache(e){this._isClearingCache||this.processedCache.forEach((t,i)=>{e===t&&this.processedCache.delete(i)})}_getDefaultStdMatOptions(e){const t=Va.get(this._device).getByIndex(e);return e===VE||e===zE||t.isShadow?this._defaultStdMatOptionMin:this._defaultStdMatOption}precompile(e){if(e){const t=new Array(e.length);for(let i=0;i<e.length;i++){if(e[i].name==="standard"){const s=e[i].options,n=this._getDefaultStdMatOptions(s.pass);for(const a in n)n.hasOwnProperty(a)&&s[a]===void 0&&(s[a]=n[a])}t[i]=this.getProgram(e[i].name,e[i].options)}}this._precached=!0}}const cd=new se,mz=new de,FC=new We,gz=new We,ive=new ae(1,1,0,.4),BC=.28209479177387814;class rve{constructor(e,t,i,s,n){const a=e.getProp("x"),o=e.getProp("y"),l=e.getProp("z"),c=e.getProp("rot_1"),u=e.getProp("rot_2"),h=e.getProp("rot_3"),d=e.getProp("rot_0"),f=e.getProp("scale_0"),p=e.getProp("scale_1"),m=e.getProp("scale_2"),g=e.getProp("f_dc_0"),_=e.getProp("f_dc_1"),v=e.getProp("f_dc_2"),y=e.getProp("opacity"),x=S=>{if(S>0)return 1/(1+Math.exp(-S));const w=Math.exp(S);return w/(1+w)};this.read=S=>{t&&(t.x=a[S],t.y=o[S],t.z=l[S]),i&&i.set(c[S],u[S],h[S],d[S]),s&&s.set(Math.exp(f[S]),Math.exp(p[S]),Math.exp(m[S])),n&&n.set(.5+g[S]*BC,.5+_[S]*BC,.5+v[S]*BC,x(y[S]))}}}const _z=(r,e,t)=>{mz.set(t.x,t.y,t.z,t.w).normalize(),r.setTRS(e,mz,O.ONE)};class Sh{constructor(e,t=[]){this.elements=e,this.numSplats=this.getElement("vertex").count,this.comments=t}static calcSplatAabb(e,t,i,s){_z(cd,t,i),FC.center.set(0,0,0),FC.halfExtents.set(s.x*2,s.y*2,s.z*2),e.setFromTransformedAabb(FC,cd)}getProp(e,t="vertex"){var i,s;return(s=(i=this.getElement(t))==null?void 0:i.properties.find(n=>n.name===e))==null?void 0:s.storage}getElement(e){return this.elements.find(t=>t.name===e)}addProp(e,t){this.getElement("vertex").properties.push({type:"float",name:e,storage:t,byteSize:4})}createIter(e,t,i,s){return new rve(this,e,t,i,s)}calcAabb(e,t){let i,s,n,a,o,l,c=!0;const u=this.getProp("x"),h=this.getProp("y"),d=this.getProp("z"),f=this.getProp("scale_0"),p=this.getProp("scale_1"),m=this.getProp("scale_2");for(let g=0;g<this.numSplats;++g){if(t&&!t(g))continue;const _=u[g],v=h[g],y=d[g],x=Math.max(f[g],p[g],m[g]);if(!isFinite(_)||!isFinite(v)||!isFinite(y)||!isFinite(x))continue;const S=2*Math.exp(x);c?(c=!1,i=_-S,s=v-S,n=y-S,a=_+S,o=v+S,l=y+S):(i=Math.min(i,_-S),s=Math.min(s,v-S),n=Math.min(n,y-S),a=Math.max(a,_+S),o=Math.max(o,v+S),l=Math.max(l,y+S))}return c||(e.center.set((i+a)*.5,(s+o)*.5,(n+l)*.5),e.halfExtents.set((a-i)*.5,(o-s)*.5,(l-n)*.5)),!c}calcAabbExact(e,t){const i=new O,s=new de,n=new O,a=this.createIter(i,s,n);let o=!0;for(let l=0;l<this.numSplats;++l)t&&!t(l)||(a.read(l),o?(o=!1,Sh.calcSplatAabb(e,i,s,n)):(Sh.calcSplatAabb(gz,i,s,n),e.add(gz)));return!o}getCenters(e){const t=this.getProp("x"),i=this.getProp("y"),s=this.getProp("z");for(let n=0;n<this.numSplats;++n)e[n*3+0]=t[n],e[n*3+1]=i[n],e[n*3+2]=s[n]}calcFocalPoint(e,t){const i=this.getProp("x"),s=this.getProp("y"),n=this.getProp("z"),a=this.getProp("scale_0"),o=this.getProp("scale_1"),l=this.getProp("scale_2");e.x=0,e.y=0,e.z=0;let c=0;for(let u=0;u<this.numSplats;++u){if(t&&!t(u))continue;const h=i[u],d=s[u],f=n[u];if(!isFinite(h)||!isFinite(d)||!isFinite(f))continue;const p=1/(1+Math.exp(Math.max(a[u],o[u],l[u])));e.x+=h*p,e.y+=d*p,e.z+=f*p,c+=p}e.mulScalar(1/c)}renderWireframeBounds(e,t){const i=new O,s=new de,n=new O,a=new O,o=new O,l=this.createIter(i,s,n);for(let c=0;c<this.numSplats;++c)l.read(c),_z(cd,i,s),cd.mul2(t,cd),a.set(n.x*-2,n.y*-2,n.z*-2),o.set(n.x*2,n.y*2,n.z*2),e.immediate.drawWireAlignedBox(a,o,ive,!0,e.defaultDrawLayer,cd)}get isCompressed(){return!1}get shBands(){return{9:1,24:2,45:3}[(()=>{for(let i=0;i<45;++i)if(!this.getProp(`f_rest_${i}`))return i;return 45})()]??0}calcMortonOrder(){const e=y=>{let x=y[0],S=y[0];for(let w=1;w<y.length;w++)y[w]<x&&(x=y[w]),y[w]>S&&(S=y[w]);return{min:x,max:S}},t=(y,x,S)=>{const w=T=>(T&=1023,T=(T^T<<16)&4278190335,T=(T^T<<8)&50393103,T=(T^T<<4)&51130563,T=(T^T<<2)&153391689,T);return(w(S)<<2)+(w(x)<<1)+w(y)},i=this.getProp("x"),s=this.getProp("y"),n=this.getProp("z"),{min:a,max:o}=e(i),{min:l,max:c}=e(s),{min:u,max:h}=e(n),d=a===o?0:1024/(o-a),f=l===c?0:1024/(c-l),p=u===h?0:1024/(h-u),m=new Map;for(let y=0;y<this.numSplats;y++){const x=Math.min(1023,Math.floor((i[y]-a)*d)),S=Math.min(1023,Math.floor((s[y]-l)*f)),w=Math.min(1023,Math.floor((n[y]-u)*p)),T=t(x,S,w),A=m.get(T);A?A.push(y):m.set(T,[y])}const g=Array.from(m.keys()).sort((y,x)=>y-x),_=new Uint32Array(this.numSplats);let v=0;for(let y=0;y<g.length;++y){const x=m.get(g[y]);for(let S=0;S<x.length;++S)_[v++]=x[S]}return _}reorder(e){const t=new Map,i=a=>{if(t.has(a)){const o=t.get(a);return t.delete(a),o}return new ArrayBuffer(a)},s=a=>{t.set(a.byteLength,a)},n=a=>{const o=new a.constructor(i(a.byteLength));for(let l=0;l<e.length;l++)o[l]=a[e[l]];return s(a.buffer),o};this.elements.forEach(a=>{a.properties.forEach(o=>{o.storage&&(o.storage=n(o.storage))})})}reorderData(){this.reorder(this.calcMortonOrder())}}class V3{constructor(e,t){this.device=e,this.gsplatData=t,this.centers=new Float32Array(t.numSplats*3),t.getCenters(this.centers),this.aabb=new We,t.calcAabb(this.aabb);const i=128,n=Math.ceil(t.numSplats/i)*i/i,a=new Uint32Array(n);for(let u=0;u<n;++u)a[u]=u*i;const o=new Ls(e,[{semantic:by,components:1,type:xE,asInt:!0}]),l=new Float32Array(12*i),c=new Uint32Array(6*i);for(let u=0;u<i;++u){l.set([-1,-1,u,1,-1,u,1,1,u,-1,1,u],u*12);const h=u*4;c.set([0+h,1+h,2+h,0+h,2+h,3+h],u*6)}this.mesh=new It(e),this.mesh.setPositions(l,3),this.mesh.setIndices(c),this.mesh.update(),this.mesh.incRefCount(),this.mesh.aabb.copy(this.aabb),this.instanceIndices=new Ya(e,o,n,{usage:Kn,data:a.buffer})}destroy(){var e,t;(e=this.mesh)==null||e.destroy(),(t=this.instanceIndices)==null||t.destroy()}get instanceSize(){return 128}get numSplats(){return this.gsplatData.numSplats}configureMaterial(e){}evalTextureSize(e){return ee.ZERO}createTexture(e,t,i,s){return new we(this.device,{name:e,width:i.x,height:i.y,format:t,cubemap:!1,mipmaps:!1,minFilter:qe,magFilter:qe,addressU:ge,addressV:ge,...s?{levels:[s]}:{}})}instantiate(){}}const sve=(r,e)=>{const t=[];for(let i=0;i<e;++i)t.push(r.getProp(`f_rest_${i}`));return t};class W9 extends V3{constructor(e,t){super(e,t);const i=t.numSplats,s=this.evalTextureSize(i);this.colorTexture=this.createTexture("splatColor",wi,s),this.transformATexture=this.createTexture("transformA",Qs,s),this.transformBTexture=this.createTexture("transformB",wi,s),this.updateColorData(t),this.updateTransformData(t),this.shBands=t.shBands,this.shBands>0&&(this.sh1to3Texture=this.createTexture("splatSH_1to3",Qs,s),this.shBands>1&&(this.sh4to7Texture=this.createTexture("splatSH_4to7",Qs,s),this.shBands>2?(this.sh8to11Texture=this.createTexture("splatSH_8to11",Qs,s),this.sh12to15Texture=this.createTexture("splatSH_12to15",Qs,s)):this.sh8to11Texture=this.createTexture("splatSH_8to11",cm,s)),this.updateSHData(t))}destroy(){var e,t,i,s,n,a,o;(e=this.colorTexture)==null||e.destroy(),(t=this.transformATexture)==null||t.destroy(),(i=this.transformBTexture)==null||i.destroy(),(s=this.sh1to3Texture)==null||s.destroy(),(n=this.sh4to7Texture)==null||n.destroy(),(a=this.sh8to11Texture)==null||a.destroy(),(o=this.sh12to15Texture)==null||o.destroy(),super.destroy()}configureMaterial(e){e.setParameter("splatColor",this.colorTexture),e.setParameter("transformA",this.transformATexture),e.setParameter("transformB",this.transformBTexture),e.setDefine("SH_BANDS",this.shBands),this.sh1to3Texture&&e.setParameter("splatSH_1to3",this.sh1to3Texture),this.sh4to7Texture&&e.setParameter("splatSH_4to7",this.sh4to7Texture),this.sh8to11Texture&&e.setParameter("splatSH_8to11",this.sh8to11Texture),this.sh12to15Texture&&e.setParameter("splatSH_12to15",this.sh12to15Texture)}evalTextureSize(e){const t=Math.ceil(Math.sqrt(e)),i=Math.ceil(e/t);return new ee(t,i)}updateColorData(e){const t=this.colorTexture;if(!t)return;const i=ah.float2Half,s=t.lock(),n=e.getProp("f_dc_0"),a=e.getProp("f_dc_1"),o=e.getProp("f_dc_2"),l=e.getProp("opacity"),c=.28209479177387814;for(let u=0;u<this.numSplats;++u){const h=n[u]*c+.5,d=a[u]*c+.5,f=o[u]*c+.5,p=1/(1+Math.exp(-l[u]));s[u*4+0]=i(h),s[u*4+1]=i(d),s[u*4+2]=i(f),s[u*4+3]=i(p)}t.unlock()}updateTransformData(e){const t=ah.float2Half;if(!this.transformATexture)return;const i=this.transformATexture.lock(),s=new Float32Array(i.buffer),n=this.transformBTexture.lock(),a=new O,o=new de,l=new O,c=e.createIter(a,o,l);for(let u=0;u<this.numSplats;u++)c.read(u),o.normalize(),o.w<0&&o.mulScalar(-1),s[u*4+0]=a.x,s[u*4+1]=a.y,s[u*4+2]=a.z,i[u*4+3]=t(o.x)|t(o.y)<<16,n[u*4+0]=t(l.x),n[u*4+1]=t(l.y),n[u*4+2]=t(l.z),n[u*4+3]=t(o.z);this.transformATexture.unlock(),this.transformBTexture.unlock()}updateSHData(e){var f,p,m,g,_,v;const t=this.sh1to3Texture.lock(),i=(f=this.sh4to7Texture)==null?void 0:f.lock(),s=(p=this.sh8to11Texture)==null?void 0:p.lock(),n=(m=this.sh12to15Texture)==null?void 0:m.lock(),a={1:3,2:8,3:15}[this.shBands],o=sve(e,a*3),l=2047,c=1023,u=new Float32Array(1),h=new Uint32Array(u.buffer),d=new Array(a*3).fill(0);for(let y=0;y<e.numSplats;++y){for(let S=0;S<a;++S)d[S*3]=o[S][y],d[S*3+1]=o[S+a][y],d[S*3+2]=o[S+a*2][y];let x=d[0];for(let S=1;S<a*3;++S)x=Math.max(x,Math.abs(d[S]));if(x!==0){for(let S=0;S<a;++S)d[S*3+0]=Math.max(0,Math.min(l,Math.floor((d[S*3+0]/x*.5+.5)*l+.5))),d[S*3+1]=Math.max(0,Math.min(c,Math.floor((d[S*3+1]/x*.5+.5)*c+.5))),d[S*3+2]=Math.max(0,Math.min(l,Math.floor((d[S*3+2]/x*.5+.5)*l+.5)));u[0]=x,t[y*4+0]=h[0],t[y*4+1]=d[0]<<21|d[1]<<11|d[2],t[y*4+2]=d[3]<<21|d[4]<<11|d[5],t[y*4+3]=d[6]<<21|d[7]<<11|d[8],this.shBands>1&&(i[y*4+0]=d[9]<<21|d[10]<<11|d[11],i[y*4+1]=d[12]<<21|d[13]<<11|d[14],i[y*4+2]=d[15]<<21|d[16]<<11|d[17],i[y*4+3]=d[18]<<21|d[19]<<11|d[20],this.shBands>2?(s[y*4+0]=d[21]<<21|d[22]<<11|d[23],s[y*4+1]=d[24]<<21|d[25]<<11|d[26],s[y*4+2]=d[27]<<21|d[28]<<11|d[29],s[y*4+3]=d[30]<<21|d[31]<<11|d[32],n[y*4+0]=d[33]<<21|d[34]<<11|d[35],n[y*4+1]=d[36]<<21|d[37]<<11|d[38],n[y*4+2]=d[39]<<21|d[40]<<11|d[41],n[y*4+3]=d[42]<<21|d[43]<<11|d[44]):s[y]=d[21]<<21|d[22]<<11|d[23])}}this.sh1to3Texture.unlock(),(g=this.sh4to7Texture)==null||g.unlock(),(_=this.sh8to11Texture)==null||_.unlock(),(v=this.sh12to15Texture)==null||v.unlock()}}const nve=`
	attribute vec2 vertex_position;
	void main(void) {
		gl_Position = vec4(vertex_position, 0.0, 1.0);
	}
`,ave=`
	#include "gsplatEvalSHVS"
	vec4 packRgb(vec3 v) {
		uvec3 vb = uvec3(clamp(v, vec3(0.0), vec3(1.0)) * vec3(2047.0, 2047.0, 1023.0));
		uint bits = (vb.x << 21) | (vb.y << 10) | vb.z;
		return vec4((uvec4(bits) >> uvec4(24, 16, 8, 0)) & uvec4(0xff)) / vec4(255.0);
	}
	uniform mediump vec3 dir;
	uniform mediump sampler2D centroids;
	uniform mediump float shN_mins;
	uniform mediump float shN_maxs;
	void main(void) {
		ivec2 uv = ivec2(gl_FragCoord.xy) * ivec2(SH_COEFFS, 1);
		mediump vec3 coefficients[SH_COEFFS];
		for (int i = 0; i < SH_COEFFS; i++) {
			vec3 s = texelFetch(centroids, ivec2(uv.x + i, uv.y), 0).xyz;
			coefficients[i] = mix(vec3(shN_mins), vec3(shN_maxs), s);
		}
		gl_FragColor = packRgb(evalSH(coefficients, dir) * 0.25 + 0.5);
	}
`,ove=`
	attribute vertex_position: vec2f;
	@vertex
	fn vertexMain(input: VertexInput) -> VertexOutput {
		var output: VertexOutput;
		output.position = vec4f(vertex_position, 0.0, 1.0);
		return output;
	}
`,lve=`
	#include "gsplatEvalSHVS"
	fn packRgb(v: vec3f) -> vec4f {
		let vb = vec3u(clamp(v, vec3f(0.0), vec3f(1.0)) * vec3f(2047.0, 2047.0, 1023.0));
		let bits = dot(vb, vec3u(1 << 21, 1 << 10, 1));
		return vec4f((vec4u(bits) >> vec4u(24, 16, 8, 0)) & vec4u(0xff)) / vec4f(255.0);
	}
	uniform dir: vec3f;
	uniform shN_mins: f32;
	uniform shN_maxs: f32;
	var centroids: texture_2d<f32>;
	@fragment
	fn fragmentMain(input: FragmentInput) -> FragmentOutput {
		var output: FragmentOutput;
		var uv = vec2i(input.position.xy) * vec2i(SH_COEFFS, 1);
		var coefficients: array<vec3f, SH_COEFFS>;
		for (var i: i32 = 0; i < SH_COEFFS; i++) {
			let s: vec3f = textureLoad(centroids, vec2i(uv.x + i, uv.y), 0).xyz;
			coefficients[i] = mix(vec3f(uniform.shN_mins), vec3f(uniform.shN_maxs), s);
		}
		output.color = packRgb(evalSH(&coefficients, uniform.dir) * 0.25 + 0.5);
		return output;
	}
`,cve=`
	uniform mediump sampler2D sh0;
	uniform highp sampler2D sh_labels;
	uniform mediump sampler2D sh_result;
	uniform vec4 sh0_mins;
	uniform vec4 sh0_maxs;
	float SH_C0 = 0.28209479177387814;
	vec3 unpackRgb(vec4 v) {
		uvec4 uv = uvec4(v * 255.0);
		uint bits = (uv.x << 24) | (uv.y << 16) | (uv.z << 8) | uv.w;
		uvec3 vb = (uvec3(bits) >> uvec3(21, 10, 0)) & uvec3(0x7ffu, 0x7ffu, 0x3ffu);
		return vec3(vb) / vec3(2047.0, 2047.0, 1023.0);
	}
	vec4 readColor(in SplatSource source) {
		vec4 baseSample = mix(sh0_mins, sh0_maxs, texelFetch(sh0, source.uv, 0));
		vec4 base = vec4(vec3(0.5) + baseSample.xyz * SH_C0, 1.0 / (1.0 + exp(-baseSample.w)));
		ivec2 labelSample = ivec2(texelFetch(sh_labels, source.uv, 0).xy * 255.0);
		int n = labelSample.x + labelSample.y * 256;
		vec4 shSample = texelFetch(sh_result, ivec2(n % 64, n / 64), 0);
		vec3 sh = (unpackRgb(shSample) - vec3(0.5)) * 4.0;
		return vec4(base.xyz + sh, base.w);
	}
`,uve=`
	var sh0: texture_2d<f32>;
	var sh_labels: texture_2d<f32>;
	var sh_result: texture_2d<f32>;
	uniform sh0_mins: vec4f;
	uniform sh0_maxs: vec4f;
	const SH_C0: f32 = 0.28209479177387814;
	fn unpackRgb(v: vec4f) -> vec3f {
		let bits = dot(vec4u(v * 255.0), vec4u(1u << 24, 1u << 16, 1u << 8, 1u));
		let vb = (vec3u(bits) >> vec3u(21, 10, 0)) & vec3u(0x7ffu, 0x7ffu, 0x3ffu);
		return vec3f(vb) / vec3f(2047.0, 2047.0, 1023.0);
	}
	fn readColor(source: ptr<function, SplatSource>) -> vec4f {
		let baseSample: vec4f = mix(uniform.sh0_mins, uniform.sh0_maxs, textureLoad(sh0, source.uv, 0));
		let base = vec4f(vec3f(0.5) + baseSample.xyz * SH_C0, 1.0 / (1.0 + exp(-baseSample.w)));
		let labelSample: vec2i = vec2i(textureLoad(sh_labels, source.uv, 0).xy * 255.0);
		let n = labelSample.x + labelSample.y * 256;
		let shSample: vec4f = textureLoad(sh_result, vec2i(n % 64, n / 64), 0);
		let sh: vec3f = (unpackRgb(shSample) - vec3f(0.5)) * 4.0;
		return vec4f(base.xyz + sh, base.w);
	}
`,hve=(r,e)=>{for(const t in e)r.resolve(t).setValue(e[t])};class dve extends dn{execute(){var e;(e=this.executeCallback)==null||e.call(this)}constructor(...e){super(...e),this.executeCallback=null}}const vz=new se,tg=new O;class fve{constructor(e,t){this.prevDir=new O,this.updateMode="enable",this.device=e,this.gsplatInstance=t;const{resource:i}=t,s=new Map($e.get(e,e.isWebGPU?"wgsl":"glsl"));this.shader=Tr.createShader(e,{uniqueName:"gsplatResolveSH",vertexGLSL:nve,fragmentGLSL:ave,vertexWGSL:ove,fragmentWGSL:lve,vertexIncludes:s,fragmentIncludes:s,fragmentDefines:new Map([["SH_BANDS",i.gsplatData.shBands.toString()]]),attributes:{vertex_position:Xe}}),this.texture=i.createTexture("centroids",ct,new ee(64,1024)),this.renderTarget=new Zi({colorBuffer:this.texture,depth:!1}),this.renderPass=new dve(e),this.renderPass.init(this.renderTarget,{}),this.renderPass.colorOps.clear=!0,this.quadRender=new xb(this.shader);const{material:n}=t;n.setDefine("SH_BANDS","0");const{shaderChunks:a}=n;a.glsl.set("gsplatSogsColorVS",cve),a.wgsl.set("gsplatSogsColorVS",uve),n.update(),e.scope.resolve("sh_result").setValue(this.texture)}destroy(){const{gsplatInstance:e}=this,{material:t}=e;t.setDefine("SH_BANDS",e.resource.gsplatData.shBands.toString());const{shaderChunks:i}=t;i.glsl.delete("gsplatSogsColorVS"),i.wgsl.delete("gsplatSogsColorVS"),t.update(),this.quadRender.destroy(),this.renderPass.destroy(),this.renderTarget.destroy(),this.texture.destroy(),this.shader.destroy()}render(e,t){const{prevDir:i,updateMode:s}=this;if(s==="disable"||(vz.invert(t),vz.transformVector(e.forward,tg),tg.normalize(),s==="enable"&&tg.equalsApprox(i,.001)))return;i.copy(tg);const n=()=>{const{device:a}=this,{sh_centroids:o,meta:l}=this.gsplatInstance.resource.gsplatData;hve(a.scope,{dir:tg.toArray(),centroids:o,shN_mins:l.shN.mins,shN_maxs:l.shN.maxs}),a.setCullMode(Vi),a.setDepthState(Ds.NODEPTH),a.setStencilState(null,null),a.setBlendState(sr.NOBLEND),this.quadRender.render()};this.renderPass.executeCallback=n,this.renderPass.render()}}function pve(){const r=typeof self<"u"&&self||require("node:worker_threads").parentPort;let e,t,i,s,n,a,o=!1;const l={x:0,y:0,z:0},c={x:0,y:0,z:0},u={x:0,y:0,z:0},h={x:0,y:0,z:0};let d,f;const p=32,m=new Array(p).fill(0),g=new Array(p).fill(0),_=new Array(p).fill(0),v=(x,S,w)=>{for(;x<=S;){const T=S+x>>1,A=w(T);if(A>0)x=T+1;else if(A<0)S=T-1;else return T}return~x},y=()=>{if(!e||!t||t.length===0||!n||!a)return;const x=n.x,S=n.y,w=n.z,T=a.x,A=a.y,C=a.z,P=.001;if(!o&&Math.abs(x-l.x)<P&&Math.abs(S-l.y)<P&&Math.abs(w-l.z)<P&&Math.abs(T-c.x)<P&&Math.abs(A-c.y)<P&&Math.abs(C-c.z)<P)return;o=!1,l.x=x,l.y=S,l.z=w,c.x=T,c.y=A,c.z=C;let I,M;for(let j=0;j<8;++j){const z=j&1?u.x:h.x,$=j&2?u.y:h.y,H=j&4?u.z:h.z,G=z*T+$*A+H*C;j===0?I=M=G:(I=Math.min(I,G),M=Math.max(M,G))}const N=t.length/3,V=2**Math.max(10,Math.min(20,Math.round(Math.log2(N/4))))+1;(d==null?void 0:d.length)!==N&&(d=new Uint32Array(N)),!f||f.length!==V?f=new Uint32Array(V):f.fill(0);const B=M-I;if(B<1e-6)for(let j=0;j<N;++j)d[j]=0,f[0]++;else{const j=i.length/4;m.fill(0);for(let G=0;G<j;++G){const Y=i[G*4+0],W=i[G*4+1],ie=i[G*4+2],q=i[G*4+3],K=Y*T+W*A+ie*C-I,te=Math.max(0,Math.floor((K-q)*p/B)),X=Math.min(p,Math.ceil((K+q)*p/B));for(let _e=te;_e<X;++_e)m[_e]++}const z=m.reduce((G,Y)=>G+Y,0);for(let G=0;G<p;++G)_[G]=m[G]/z*V>>>0;for(let G=0;G<p;++G)g[G]=G===0?0:g[G-1]+_[G-1];const $=B/p;let H=0;for(let G=0;G<N;++G){const Y=t[H++],W=t[H++],ie=t[H++],q=(Y*T+W*A+ie*C-I)/$,K=q>>>0,te=g[K]+_[K]*(q-K)>>>0;d[G]=te,f[te]++}}for(let j=1;j<V;j++)f[j]+=f[j-1];for(let j=0;j<N;j++){const z=d[j],$=--f[z];e[$]=j}const R=x*T+S*A+w*C,L=j=>{let z=e[j]*3;return t[z++]*T+t[z++]*A+t[z]*C-R},D=()=>{const j=v(0,N-1,z=>-L(z));return Math.min(N,Math.abs(j))},F=L(N-1)>=0?D():N;if(s)for(let j=0;j<N;++j)e[j]=s[e[j]];r.postMessage({order:e.buffer,count:F},[e.buffer]),e=null};r.addEventListener("message",x=>{const S=x.data??x;if(S.order&&(e=new Uint32Array(S.order)),S.centers)if(t=new Float32Array(S.centers),o=!0,S.chunks){const w=new Float32Array(S.chunks);i=new Float32Array(S.chunks,0,w.length*4/6),u.x=w[0],u.y=w[1],u.z=w[2],h.x=w[3],h.y=w[4],h.z=w[5];for(let T=0;T<w.length/6;++T){const A=w[T*6+0],C=w[T*6+1],P=w[T*6+2],I=w[T*6+3],M=w[T*6+4],N=w[T*6+5];i[T*4+0]=(A+I)*.5,i[T*4+1]=(C+M)*.5,i[T*4+2]=(P+N)*.5,i[T*4+3]=Math.sqrt((I-A)**2+(M-C)**2+(N-P)**2)*.5,A<u.x&&(u.x=A),C<u.y&&(u.y=C),P<u.z&&(u.z=P),I>h.x&&(h.x=I),M>h.y&&(h.y=M),N>h.z&&(h.z=N)}}else{const w=t.length/3,T=Math.ceil(w/256);i=new Float32Array(T*4),u.x=u.y=u.z=1/0,h.x=h.y=h.z=-1/0;let A,C,P,I,M,N;for(let k=0;k<T;++k){A=C=P=1/0,I=M=N=-1/0;const V=k*256,B=Math.min(w,(k+1)*256);for(let R=V;R<B;++R){const L=t[R*3+0],D=t[R*3+1],F=t[R*3+2],j=Number.isFinite(L),z=Number.isFinite(D),$=Number.isFinite(F);j||(t[R*3+0]=0),z||(t[R*3+1]=0),$||(t[R*3+2]=0),!(!j||!z||!$)&&(L<A?A=L:L>I&&(I=L),D<C?C=D:D>M&&(M=D),F<P?P=F:F>N&&(N=F),L<u.x?u.x=L:L>h.x&&(h.x=L),D<u.y?u.y=D:D>h.y&&(h.y=D),F<u.z?u.z=F:F>h.z&&(h.z=F))}i[k*4+0]=(A+I)*.5,i[k*4+1]=(C+M)*.5,i[k*4+2]=(P+N)*.5,i[k*4+3]=Math.sqrt((I-A)**2+(M-C)**2+(N-P)**2)*.5}}S.hasOwnProperty("mapping")&&(s=S.mapping?new Uint32Array(S.mapping):null,o=!0),S.cameraPosition&&(n=S.cameraPosition),S.cameraDirection&&(a=S.cameraDirection),y()})}class mve extends Te{constructor(){super();const e=i=>{const s=i.data??i,n=s.order,a=this.orderTexture._levels[0].buffer;this.worker.postMessage({order:a},[a]),this.orderTexture._levels[0]=new Uint32Array(n),this.orderTexture.upload(),this.fire("updated",s.count)},t=`(${pve.toString()})()`;Ye.environment==="node"?(this.worker=new Worker(t,{eval:!0}),this.worker.on("message",e)):(this.worker=new Worker(URL.createObjectURL(new Blob([t],{type:"application/javascript"}))),this.worker.addEventListener("message",e))}destroy(){this.worker.terminate(),this.worker=null}init(e,t,i){this.orderTexture=e,this.centers=t.slice();const s=this.orderTexture.lock({mode:Dq}).slice();this.orderTexture.unlock();for(let o=0;o<s.length;++o)s[o]=o;const n={order:s.buffer,centers:t.buffer,chunks:i==null?void 0:i.buffer},a=[s.buffer,t.buffer].concat(i?[i.buffer]:[]);this.worker.postMessage(n,a)}setMapping(e){if(e){const t=new Float32Array(e.length*3);for(let i=0;i<e.length;++i){const s=e[i]*3,n=i*3;t[n+0]=this.centers[s+0],t[n+1]=this.centers[s+1],t[n+2]=this.centers[s+2]}this.worker.postMessage({centers:t.buffer,mapping:e.buffer},[t.buffer,e.buffer])}else{const t=this.centers.slice();this.worker.postMessage({centers:t.buffer,mapping:null},[t.buffer])}}setCamera(e,t){this.worker.postMessage({cameraPosition:{x:e.x,y:e.y,z:e.z},cameraDirection:{x:t.x,y:t.y,z:t.z}})}}var gve=`
	uniform usampler2D orderTexture;
	uniform sampler2D sourceTexture;
	uniform highp uint numSplats;
	void main(void) {
		uint w = uint(textureSize(sourceTexture, 0).x);
		uint idx = uint(gl_FragCoord.x) + uint(gl_FragCoord.y) * w;
		if (idx >= numSplats) discard;
		uint sidx = texelFetch(orderTexture, ivec2(gl_FragCoord.xy), 0).x;
		uvec2 suv = uvec2(sidx % w, sidx / w);
		gl_FragColor = texelFetch(sourceTexture, ivec2(suv), 0);
	}
`,_ve=`
	var orderTexture: texture_2d<u32>;
	var sourceTexture: texture_2d<f32>;
	uniform numSplats: u32;
	@fragment
	fn fragmentMain(input: FragmentInput) -> FragmentOutput {
		var output: FragmentOutput;
		let w: u32 = textureDimensions(sourceTexture, 0).x;
		let idx: u32 = u32(pcPosition.x) + u32(pcPosition.y) * w;
		if (idx >= uniform.numSplats) {
			discard;
			return output;
		}
		let sidx: u32 = textureLoad(orderTexture, vec2<i32>(input.position.xy), 0).x;
		let suv: vec2<u32> = vec2<u32>(sidx % w, sidx / w);
		output.color = textureLoad(sourceTexture, vec2<i32>(suv), 0);
		return output;
	}
`;const Df=.28209479177387814,co=r=>r.read(0,0,r.width,r.height,{mipLevel:0,face:0,immediate:!0}),vve=(r,e)=>{for(const t in e)r.resolve(t).setValue(e[t])};class yve{constructor(e,t,i,s,n,a){const o=(S,w,T)=>S*(1-T)+w*T,{meta:l}=e,{means:c,scales:u,sh0:h,shN:d}=l,f=t&&e.means_l._levels[0],p=t&&e.means_u._levels[0],m=i&&e.quats._levels[0],g=s&&e.scales._levels[0],_=n&&e.sh0._levels[0],v=a&&e.sh_labels._levels[0],y=a&&e.sh_centroids._levels[0],x=2/Math.sqrt(2);this.read=S=>{if(t){const w=o(c.mins[0],c.maxs[0],((p[S*4+0]<<8)+f[S*4+0])/65535),T=o(c.mins[1],c.maxs[1],((p[S*4+1]<<8)+f[S*4+1])/65535),A=o(c.mins[2],c.maxs[2],((p[S*4+2]<<8)+f[S*4+2])/65535);t.x=Math.sign(w)*(Math.exp(Math.abs(w))-1),t.y=Math.sign(T)*(Math.exp(Math.abs(T))-1),t.z=Math.sign(A)*(Math.exp(Math.abs(A))-1)}if(i){const w=(m[S*4+0]/255-.5)*x,T=(m[S*4+1]/255-.5)*x,A=(m[S*4+2]/255-.5)*x,C=Math.sqrt(Math.max(0,1-(w*w+T*T+A*A)));switch(m[S*4+3]-252){case 0:i.set(w,T,A,C);break;case 1:i.set(C,T,A,w);break;case 2:i.set(T,C,A,w);break;case 3:i.set(T,A,C,w);break}}if(s){const w=o(u.mins[0],u.maxs[0],g[S*4+0]/255),T=o(u.mins[1],u.maxs[1],g[S*4+1]/255),A=o(u.mins[2],u.maxs[2],g[S*4+2]/255);s.set(w,T,A)}if(n){const w=o(h.mins[0],h.maxs[0],_[S*4+0]/255),T=o(h.mins[1],h.maxs[1],_[S*4+1]/255),A=o(h.mins[2],h.maxs[2],_[S*4+2]/255),C=o(h.mins[3],h.maxs[3],_[S*4+3]/255);n.set(.5+w*Df,.5+T*Df,.5+A*Df,1/(1+Math.exp(-C)))}if(a){const w=v[S*4+0]+(v[S*4+1]<<8),T=w%64*15,A=Math.floor(w/64);for(let C=0;C<3;++C)for(let P=0;P<15;++P)a[C*15+P]=o(d.mins,d.maxs,y[(T+P)*4+C+A*e.sh_centroids.width*4]/255)}}}}class X9{destroy(){var e,t,i,s,n,a,o;(e=this.means_l)==null||e.destroy(),(t=this.means_u)==null||t.destroy(),(i=this.quats)==null||i.destroy(),(s=this.scales)==null||s.destroy(),(n=this.sh0)==null||n.destroy(),(a=this.sh_centroids)==null||a.destroy(),(o=this.sh_labels)==null||o.destroy()}createIter(e,t,i,s,n){return new yve(this,e,t,i,s,n)}calcAabb(e){const{mins:t,maxs:i}=this.meta.means,s=n=>Math.sign(n)*(Math.exp(Math.abs(n))-1);e.center.set((s(t[0])+s(i[0]))*.5,(s(t[1])+s(i[1]))*.5,(s(t[2])+s(i[2]))*.5),e.halfExtents.set((s(i[0])-s(t[0]))*.5,(s(i[1])-s(t[1]))*.5,(s(i[2])-s(t[2]))*.5)}getCenters(e){var g;const{meta:t,means_l:i,means_u:s,numSplats:n}=this,{means:a}=t,o=new Uint32Array(s._levels[0].buffer),l=new Uint32Array(i._levels[0].buffer),c=(g=this.orderTexture)==null?void 0:g._levels[0],u=a.mins[0]/65535,h=a.mins[1]/65535,d=a.mins[2]/65535,f=a.maxs[0]/65535,p=a.maxs[1]/65535,m=a.maxs[2]/65535;for(let _=0;_<n;_++){const v=c?c[_]:_,y=o[v],x=l[v],S=y<<8&65280|x&255,w=y&65280|x>>>8&255,T=y>>>8&65280|x>>>16&255,A=u*(65535-S)+f*S,C=h*(65535-w)+p*w,P=d*(65535-T)+m*T,I=A<0?-A:A,M=C<0?-C:C,N=P<0?-P:P;e[_*3]=(A<0?-1:1)*(Math.exp(I)-1),e[_*3+1]=(C<0?-1:1)*(Math.exp(M)-1),e[_*3+2]=(P<0?-1:1)*(Math.exp(N)-1)}}calcFocalPoint(e,t){e.set(0,0,0)}get isSogs(){return!0}get shBands(){var t;return{192:1,512:2,960:3}[(t=this.sh_centroids)==null?void 0:t.width]??0}async decompress(){const e=["x","y","z","f_dc_0","f_dc_1","f_dc_2","opacity","scale_0","scale_1","scale_2","rot_0","rot_1","rot_2","rot_3"],{shBands:t}=this,{means_l:i,means_u:s,quats:n,scales:a,sh0:o,sh_labels:l,sh_centroids:c}=this;if(i._levels[0]=await co(i),s._levels[0]=await co(s),n._levels[0]=await co(n),a._levels[0]=await co(a),o._levels[0]=await co(o),t>0){l._levels[0]=await co(l),c._levels[0]=await co(c);const _=[];for(let v=0;v<45;++v)_.push(`f_rest_${v}`);e.splice(e.indexOf("f_dc_0")+1,0,..._)}const u={};e.forEach(_=>{u[_]=new Float32Array(this.numSplats)});const h=new O,d=new de,f=new O,p=new ce,m=t>0?new Float32Array(45):null,g=this.createIter(h,d,f,p,m);for(let _=0;_<this.numSplats;++_)if(g.read(_),u.x[_]=h.x,u.y[_]=h.y,u.z[_]=h.z,u.rot_1[_]=d.x,u.rot_2[_]=d.y,u.rot_3[_]=d.z,u.rot_0[_]=d.w,u.scale_0[_]=f.x,u.scale_1[_]=f.y,u.scale_2[_]=f.z,u.f_dc_0[_]=(p.x-.5)/Df,u.f_dc_1[_]=(p.y-.5)/Df,u.f_dc_2[_]=(p.z-.5)/Df,u.opacity[_]=p.w<=0?-40:p.w>=1?40:-Math.log(1/p.w-1),m)for(let v=0;v<45;++v)u[`f_rest_${v}`][_]=m[v];return new Sh([{name:"vertex",count:this.numSplats,properties:e.map(_=>({name:_,type:"float",byteSize:4,storage:u[_]}))}])}reorderGpuMemory(){const{orderTexture:e,numSplats:t}=this,{device:i,height:s,width:n}=e,{scope:a}=i,o=Tr.createShader(i,{uniqueName:"GsplatSogsReorderShader",attributes:{vertex_position:Xe},vertexChunk:"fullscreenQuadVS",fragmentGLSL:gve,fragmentWGSL:_ve}),l=new we(i,{width:n,height:s,format:ct,mipmaps:!1}),c=["means_l","means_u","quats","scales","sh0","sh_labels"];i.setBlendState(sr.NOBLEND),i.setCullMode(Vi),i.setDepthState(Ds.NODEPTH),c.forEach(u=>{const h=this[u];if(!h)return;const d=new Zi({colorBuffer:h,depth:!1,mipLevel:0});l._levels[0]=h._levels[0],l.upload(),vve(a,{orderTexture:e,sourceTexture:l,numSplats:t}),Tc(i,d,o),d.destroy()}),l.destroy()}calcMortonOrder(){const e=(l,c,u)=>{const h=d=>(d&=1023,d=(d^d<<16)&4278190335,d=(d^d<<8)&50393103,d=(d^d<<4)&51130563,d=(d^d<<2)&153391689,d);return(h(u)<<2)+(h(c)<<1)+h(l)},{means_l:t,means_u:i}=this,s=t._levels[0],n=i._levels[0],a=new BigUint64Array(this.numSplats);for(let l=0;l<this.numSplats;++l){const c=n[l*4+0]<<2|s[l*4+0]>>>6,u=n[l*4+1]<<2|s[l*4+1]>>>6,h=n[l*4+2]<<2|s[l*4+2]>>>6;a[l]=BigInt(e(c,u,h))<<BigInt(32)|BigInt(l)}a.sort();const o=new Uint32Array(t.width*t.height);for(let l=0;l<this.numSplats;++l)o[l]=Number(a[l]&BigInt(4294967295));return o}async reorderData(){const{device:e,height:t,width:i}=this.means_l;this.means_l._levels[0]=await co(this.means_l),this.means_u._levels[0]=await co(this.means_u),this.orderTexture=new we(e,{name:"orderTexture",width:i,height:t,format:cm,mipmaps:!1,levels:[this.calcMortonOrder()]}),e.on("devicerestored",()=>{this.reorderGpuMemory()}),this.reorderGpuMemory()}}const Sve=new se,ud=new O,hd=new O,J0=[0,0];class xve{constructor(e,t={}){var n;this.options={},this.sorter=null,this.lastCameraPosition=new O,this.lastCameraDirection=new O,this.resolveSH=null,this.cameras=[],this.resource=e,this.orderTexture=e.createTexture("splatOrder",cm,e.evalTextureSize(e.numSplats)),t.material?(this._material=t.material,this._material.setParameter("splatOrder",this.orderTexture)):(this._material=new nv({uniqueName:"SplatMaterial",vertexGLSL:'#include "gsplatVS"',fragmentGLSL:'#include "gsplatPS"',vertexWGSL:'#include "gsplatVS"',fragmentWGSL:'#include "gsplatPS"',attributes:{vertex_position:Xe,vertex_id_attrib:by}}),this.configureMaterial(this._material),this._material.update()),this.meshInstance=new Dt(e.mesh,this._material),this.meshInstance.setInstancing(e.instanceIndices,!0),this.meshInstance.gsplatInstance=this,this.meshInstance.instancingCount=0;const i=e.centers.slice(),s=(n=e.chunks)==null?void 0:n.slice();this.sorter=new mve,this.sorter.init(this.orderTexture,i,s),this.sorter.on("updated",a=>{this.meshInstance.instancingCount=Math.ceil(a/e.instanceSize),this.material.setParameter("numSplats",a)}),this.setHighQualitySH(t.highQualitySH??!1)}destroy(){var e,t,i,s;(e=this.resolveSH)==null||e.destroy(),(t=this.material)==null||t.destroy(),(i=this.meshInstance)==null||i.destroy(),(s=this.sorter)==null||s.destroy()}set material(e){this._material!==e&&(this._material=e,this._material.setParameter("splatOrder",this.orderTexture),this.meshInstance&&(this.meshInstance.material=e))}get material(){return this._material}configureMaterial(e,t={}){this.resource.configureMaterial(e),e.setParameter("numSplats",0),e.setParameter("splatOrder",this.orderTexture),e.setParameter("alphaClip",.3),e.setDefine(`DITHER_${t.dither?"BLUENOISE":"NONE"}`,""),e.cull=Vi,e.blendType=t.dither?an:fh,e.depthWrite=!!t.dither}updateViewport(e){var o;const t=e==null?void 0:e.camera,i=t==null?void 0:t.renderTarget,{width:s,height:n}=i??this.resource.device;J0[0]=s,J0[1]=n;const a=(o=t==null?void 0:t.camera)==null?void 0:o.xr;a!=null&&a.active&&a.views.list.length===2&&(J0[0]*=.5),this.material.setParameter("viewport",J0)}sort(e){if(this.sorter){const t=e.getWorldTransform();t.getTranslation(ud),t.getZ(hd);const i=this.meshInstance.node.getWorldTransform(),s=Sve.invert(i);s.transformPoint(ud,ud),s.transformVector(hd,hd),(!ud.equalsApprox(this.lastCameraPosition)||!hd.equalsApprox(this.lastCameraDirection))&&(this.lastCameraPosition.copy(ud),this.lastCameraDirection.copy(hd),this.sorter.setCamera(ud,hd))}this.updateViewport(e)}update(){var e;if(this.cameras.length>0){const t=this.cameras[0];this.sort(t._node),(e=this.resolveSH)==null||e.render(t._node,this.meshInstance.node.getWorldTransform()),this.cameras.length=0}}setHighQualitySH(e){const{resource:t}=this,{gsplatData:i}=t;i instanceof X9&&i.shBands>0&&e===!!this.resolveSH&&(this.resolveSH?(this.resolveSH.destroy(),this.resolveSH=null):this.resolveSH=new fve(t.device,this))}}class bve extends V3{destroy(){this.gsplatData.destroy(),super.destroy()}configureMaterial(e){const{gsplatData:t}=this;e.setDefine("GSPLAT_SOGS_DATA",!0),e.setDefine("SH_BANDS",this.gsplatData.shBands),["means_l","means_u","quats","scales","sh0","sh_centroids","sh_labels"].forEach(i=>{t[i]&&e.setParameter(i,t[i])}),["means","scales","sh0","shN"].forEach(i=>{const s=t.meta[i];s&&(e.setParameter(`${i}_mins`,s.mins),e.setParameter(`${i}_maxs`,s.maxs))})}evalTextureSize(e){return new ee(this.gsplatData.means_l.width,this.gsplatData.means_l.height)}}const q9="FILL_WINDOW",yz="KEEP_ASPECT",NM="AUTO",Y9="FIXED";let K9;function Xu(){return K9}function kM(r){K9=r}class wve{addRenderPass(e){e.frameUpdate();const t=e.beforePasses;for(let s=0;s<t.length;s++){const n=t[s];n.enabled&&this.addRenderPass(n)}e.enabled&&this.renderPasses.push(e);const i=e.afterPasses;for(let s=0;s<i.length;s++){const n=i[s];n.enabled&&this.addRenderPass(n)}}reset(){this.renderPasses.length=0}compile(){const e=this.renderTargetMap,t=this.renderPasses;for(let n=0;n<t.length;n++){const a=t[n],o=a.renderTarget;if(o!==void 0){const l=e.get(o);if(l){const c=a.colorArrayOps.length;for(let u=0;u<c;u++)a.colorArrayOps[u].clear||(l.colorArrayOps[u].store=!0);a.depthStencilOps.clearDepth||(l.depthStencilOps.storeDepth=!0),a.depthStencilOps.clearStencil||(l.depthStencilOps.storeStencil=!0)}e.set(o,a)}}for(let n=0;n<t.length-1;n++){const a=t[n],o=a.renderTarget,l=t[n+1],c=l.renderTarget;o!==c||o===void 0||l.depthStencilOps.clearDepth||l.depthStencilOps.clearStencil||l.colorArrayOps.some(u=>u.clear)||a.afterPasses.length>0||l.beforePasses.length>0||(a._skipEnd=!0,l._skipStart=!0)}let i=null,s=null;for(let n=0;n<t.length;n++){const a=t[n],o=a.renderTarget,l=o==null?void 0:o.colorBuffer;if(l!=null&&l.cubemap){if(i===l){const c=s.colorArrayOps.length;for(let u=0;u<c;u++)s.colorArrayOps[u].mipmaps=!1}i=o.colorBuffer,s=a}else a.requiresCubemaps&&(i=null,s=null)}e.clear()}render(e){this.compile();const t=this.renderPasses;for(let i=0;i<t.length;i++)t[i].render()}constructor(){this.renderPasses=[],this.renderTargetMap=new Map}}class Tve{constructor(e,t){this.texture0=e,this.texture1=t}destroy(){var e,t;(e=this.texture0)==null||e.destroy(),(t=this.texture1)==null||t.destroy()}}const Sz=new jr;class Eu{static createTexture(e,t,i,s=""){return new we(e,{name:`AreaLightLUT${s}`,width:i,height:i,format:t,addressU:ge,addressV:ge,type:qa,magFilter:_i,minFilter:qe,anisotropy:1,mipmaps:!1})}static applyTextures(e,t,i){Sz.remove(e),Sz.get(e,()=>new Tve(t,t===i?null:i)),e.scope.resolve("areaLightsLutTex1").setValue(t),e.scope.resolve("areaLightsLutTex2").setValue(i)}static createPlaceholder(e){const t=Eu.createTexture(e,wi,2,"placeholder");t.lock().fill(0),t.unlock(),Eu.applyTextures(e,t,t)}static set(e,t,i){function s(d,f,p){const m=Eu.createTexture(d,p,64);return m.lock().set(f),m.unlock(),m}function n(d){const f=d.length,p=new Uint16Array(f),m=ah.float2Half;for(let g=0;g<f;g++)p[g]=m(d[g]);return p}const a=t,o=i,l=n(a),c=n(o),u=s(e,l,wi),h=s(e,c,wi);Eu.applyTextures(e,u,h)}}const Tb="en-US",Eb={en:"en-US",es:"en-ES",zh:"zh-CN","zh-HK":"zh-TW","zh-TW":"zh-HK","zh-MO":"zh-HK",fr:"fr-FR",de:"de-DE",it:"it-IT",ru:"ru-RU",ja:"ja-JP"},j3={};function Rc(r,e){for(let t=0,i=r.length;t<i;t++)j3[r[t]]=e}function vo(r){const e=r.indexOf("-");return e!==-1?r.substring(0,e):r}function Eve(r,e){const t=r.indexOf("-");return t!==-1?e+r.substring(t):e}function Z9(r,e){if(e[r])return r;let t=Eb[r];if(t&&e[t])return t;const i=vo(r);return t=Eb[i],e[t]?t:e[i]?i:Tb}Rc(["ja","ko","th","vi","zh","id"],r=>0);Rc(["fa","hi"],r=>r>=0&&r<=1?0:1);Rc(["fr","pt"],r=>r>=0&&r<2?0:1);Rc(["da"],r=>r===1||!Number.isInteger(r)&&r>=0&&r<=1?0:1);Rc(["de","en","it","el","es","tr","fi","sv","nb","no","ur"],r=>r===1?0:1);Rc(["ru","uk"],r=>{if(Number.isInteger(r)){const e=r%10,t=r%100;if(e===1&&t!==11)return 0;if(e>=2&&e<=4&&(t<12||t>14))return 1;if(e===0||e>=5&&e<=9||t>=11&&t<=14)return 2}return 3});Rc(["pl"],r=>{if(Number.isInteger(r)){if(r===1)return 0;const e=r%10,t=r%100;if(e>=2&&e<=4&&(t<12||t>14))return 1;if(e>=0&&e<=1||e>=5&&e<=9||t>=12&&t<=14)return 2}return 3});Rc(["ar"],r=>{if(r===0)return 0;if(r===1)return 1;if(r===2)return 2;if(Number.isInteger(r)){const e=r%100;if(e>=3&&e<=10)return 3;if(e>=11&&e<=99)return 4}return 5});const Ave=j3[vo(Tb)];function UC(r){return j3[r]||Ave}const yp=new RegExp("^\\s*(?:(?:[a-z]+[a-z0-9\\-+.]*:)?//|data:|blob:)","i");class Cve{constructor(e="",t="",i=null,s=null,n=null,a=null){this.url=e,this.filename=t,this.hash=i,this.size=s,this.opt=n,this.contents=a}equals(e){return this.url===e.url&&this.filename===e.filename&&this.hash===e.hash&&this.size===e.size&&this.opt===e.opt&&this.contents===e.contents}}let Pve=-1;const Ive={pvr:"extCompressedTexturePVRTC",dxt:"extCompressedTextureS3TC",etc2:"extCompressedTextureETC",etc1:"extCompressedTextureETC1",basis:"canvas"},xz=["pvr","dxt","etc2","etc1","basis"],da=class da extends Te{constructor(e,t,i,s={},n={}){super(),this._file=null,this._i18n={},this._preload=!1,this._resources=[],this.id=Pve--,this.loaded=!1,this.loading=!1,this.options={},this.registry=null,this.tags=new sb(this),this.urlObject=null,this._name=e||"",this.type=t,this._data=s||{},this.options=n||{},i&&(this.file=i)}set name(e){if(this._name===e)return;const t=this._name;this._name=e,this.fire("name",this,this._name,t)}get name(){return this._name}set file(e){var s,n;if(e&&e.variants&&["texture","textureatlas","bundle"].indexOf(this.type)!==-1){const a=((n=(s=this.registry)==null?void 0:s._loader)==null?void 0:n._app)||Xu(),o=a==null?void 0:a.graphicsDevice;if(o)for(let l=0,c=xz.length;l<c;l++){const u=xz[l];if(e.variants[u]&&o[Ive[u]]){e=e.variants[u];break}if(a.enableBundles){const h=a.bundles.listBundlesForAsset(this);if(h&&h.find(d=>{var f;return(f=d==null?void 0:d.file)==null?void 0:f.variants[u]}))break}}}const t=this._file,i=e?new Cve(e.url,e.filename,e.hash,e.size,e.opt,e.contents):null;(!!i!=!!t||i&&!i.equals(t))&&(this._file=i,this.fire("change",this,"file",i,t),this.reload())}get file(){return this._file}set data(e){const t=this._data;this._data=e,e!==t&&(this.fire("change",this,"data",e,t),this.loaded&&this.registry._loader.patch(this,this.registry))}get data(){return this._data}set resource(e){const t=this._resources[0];this._resources[0]=e,this.fire("change",this,"resource",e,t)}get resource(){return this._resources[0]}set resources(e){const t=this._resources;this._resources=e,this.fire("change",this,"resources",e,t)}get resources(){return this._resources}set preload(e){e=!!e,this._preload!==e&&(this._preload=e,this._preload&&!this.loaded&&!this.loading&&this.registry&&this.registry.load(this))}get preload(){return this._preload}set loadFaces(e){e=!!e,(!this.hasOwnProperty("_loadFaces")||e!==this._loadFaces)&&(this._loadFaces=e,this.loaded&&this.registry._loader.patch(this,this.registry))}get loadFaces(){return this._loadFaces}getFileUrl(){const e=this.file;if(!e||!e.url)return null;let t=e.url;if(this.registry&&this.registry.prefix&&!yp.test(t)&&(t=this.registry.prefix+t),this.type!=="script"&&e.hash){const i=t.indexOf("?")!==-1?"&":"?";t+=`${i}t=${e.hash}`}return t}getAbsoluteUrl(e){if(e.startsWith("blob:")||e.startsWith("data:"))return e;const t=Ne.getDirectory(this.file.url);return Ne.join(t,e)}getLocalizedAssetId(e){return e=Z9(e,this._i18n),this._i18n[e]||null}addLocalizedAssetId(e,t){this._i18n[e]=t,this.fire("add:localized",e,t)}removeLocalizedAssetId(e){const t=this._i18n[e];t&&(delete this._i18n[e],this.fire("remove:localized",e,t))}ready(e,t){t=t||this,this.loaded?e.call(t,this):this.once("load",i=>{e.call(t,i)})}reload(){this.loaded&&(this.loaded=!1,this.registry.load(this))}unload(){if(!this.loaded&&this._resources.length===0)return;this.fire("unload",this),this.registry.fire(`unload:${this.id}`,this);const e=this._resources;this.urlObject&&(URL.revokeObjectURL(this.urlObject),this.urlObject=null),this.resources=[],this.loaded=!1,this.file&&this.registry._loader.clearCache(this.getFileUrl(),this.type);for(let t=0;t<e.length;++t){const i=e[t];i&&i.destroy&&i.destroy()}}static fetchArrayBuffer(e,t,i,s=0){var n;(n=i==null?void 0:i.file)!=null&&n.contents?setTimeout(()=>{t(null,i.file.contents)}):qt.get(e,{cache:!0,responseType:"arraybuffer",retry:s>0,maxRetries:s},t)}};da.EVENT_LOAD="load",da.EVENT_UNLOAD="unload",da.EVENT_REMOVE="remove",da.EVENT_ERROR="error",da.EVENT_CHANGE="change",da.EVENT_PROGRESS="progress",da.EVENT_ADDLOCALIZED="add:localized",da.EVENT_REMOVELOCALIZED="remove:localized";let be=da;class Mve{constructor(e=null){this._index={},this._key=e}addItem(e){const t=e.tags._list;for(const i of t)this.add(i,e)}removeItem(e){const t=e.tags._list;for(const i of t)this.remove(i,e)}add(e,t){this._index[e]&&this._index[e].list.indexOf(t)!==-1||(this._index[e]||(this._index[e]={list:[]},this._key&&(this._index[e].keys={})),this._index[e].list.push(t),this._key&&(this._index[e].keys[t[this._key]]=t))}remove(e,t){if(!this._index[e]||this._key&&!this._index[e].keys[t[this._key]])return;const i=this._index[e].list.indexOf(t);i!==-1&&(this._index[e].list.splice(i,1),this._key&&delete this._index[e].keys[t[this._key]],this._index[e].list.length===0&&delete this._index[e])}find(e){const t={},i=[];let s,n,a,o,l;const c=(u,h)=>this._index[u].list.length-this._index[h].list.length;for(let u=0;u<e.length;u++){if(n=e[u],n instanceof Array){if(n.length===0)continue;if(n.length===1)n=n[0];else{l=!1;for(let h=0;h<n.length;h++)if(!this._index[n[h]]){l=!0;break}if(l)continue;a=n.slice(0).sort(c),o=a.slice(1),o.length===1&&(o=o[0]);for(let h=0;h<this._index[a[0]].list.length;h++)s=this._index[a[0]].list[h],(this._key?!t[s[this._key]]:i.indexOf(s)===-1)&&s.tags.has(o)&&(this._key&&(t[s[this._key]]=!0),i.push(s));continue}}if(n&&typeof n=="string"&&this._index[n])for(let h=0;h<this._index[n].list.length;h++)s=this._index[n].list[h],this._key?t[s[this._key]]||(t[s[this._key]]=!0,i.push(s)):i.indexOf(s)===-1&&i.push(s)}return i}}const uf=class uf extends Te{constructor(e){super(),this._assets=new Set,this._idToAsset=new Map,this._urlToAsset=new Map,this._nameToAsset=new Map,this._tags=new Mve("id"),this.prefix=null,this.bundles=null,this._loader=e}list(e={}){const t=Array.from(this._assets);return e.preload!==void 0?t.filter(i=>i.preload===e.preload):t}add(e){var t,i;this._assets.has(e)||(this._assets.add(e),this._idToAsset.set(e.id,e),(t=e.file)!=null&&t.url&&this._urlToAsset.set(e.file.url,e),this._nameToAsset.has(e.name)||this._nameToAsset.set(e.name,new Set),this._nameToAsset.get(e.name).add(e),e.on("name",this._onNameChange,this),e.registry=this,this._tags.addItem(e),e.tags.on("add",this._onTagAdd,this),e.tags.on("remove",this._onTagRemove,this),this.fire("add",e),this.fire(`add:${e.id}`,e),(i=e.file)!=null&&i.url&&this.fire(`add:url:${e.file.url}`,e),e.preload&&this.load(e))}remove(e){var t,i;if(!this._assets.has(e))return!1;if(this._assets.delete(e),this._idToAsset.delete(e.id),(t=e.file)!=null&&t.url&&this._urlToAsset.delete(e.file.url),e.off("name",this._onNameChange,this),this._nameToAsset.has(e.name)){const s=this._nameToAsset.get(e.name);s.delete(e),s.size===0&&this._nameToAsset.delete(e.name)}return this._tags.removeItem(e),e.tags.off("add",this._onTagAdd,this),e.tags.off("remove",this._onTagRemove,this),e.fire("remove",e),this.fire("remove",e),this.fire(`remove:${e.id}`,e),(i=e.file)!=null&&i.url&&this.fire(`remove:url:${e.file.url}`,e),!0}get(e){return this._idToAsset.get(Number(e))}getByUrl(e){return this._urlToAsset.get(e)}load(e,t){if((e.loading||e.loaded)&&!(t!=null&&t.force))return;const i=e.file,s=()=>{this.fire("load",e),this.fire(`load:${e.id}`,e),i&&i.url&&this.fire(`load:url:${i.url}`,e),e.fire("load",e)},n=o=>{if(o instanceof Array?e.resources=o:e.resource=o,this._loader.patch(e,this),e.type==="bundle"){const l=e.data.assets;for(let c=0;c<l.length;c++){const u=this._idToAsset.get(l[c]);u&&!u.loaded&&this.load(u,{force:!0})}e.resource.loaded?s():(this.fire("load:start",e),this.fire(`load:start:${e.id}`,e),i&&i.url&&this.fire(`load:start:url:${i.url}`,e),e.fire("load:start",e),e.resource.on("load",s))}else s()},a=(o,l,c)=>{if(e.loaded=!0,e.loading=!1,o)this.fire("error",o,e),this.fire(`error:${e.id}`,o,e),e.fire("error",o,e);else{if(e.type==="script"){const u=this._loader.getHandler("script");u._cache[e.id]&&u._cache[e.id].parentNode===document.head&&document.head.removeChild(u._cache[e.id]),u._cache[e.id]=c}n(l)}};if(i||e.type==="cubemap"){this.fire("load:start",e),this.fire(`load:${e.id}:start`,e),e.loading=!0;const o=e.getFileUrl();if(e.type==="bundle"){const l=e.data.assets;for(let c=0;c<l.length;c++){const u=this._idToAsset.get(l[c]);u&&(u.loaded||u.resource||u.loading||(u.loading=!0))}}this._loader.load(o,e.type,a,e,t)}else{const o=this._loader.open(e.type,e.data);e.loaded=!0,n(o)}}loadFromUrl(e,t,i){this.loadFromUrlAndFilename(e,null,t,i)}loadFromUrlAndFilename(e,t,i,s){const n=Ne.getBasename(t||e),a={filename:t||n,url:e};let o=this.getByUrl(e);if(!o)o=new be(n,i,a),this.add(o);else if(o.loaded){s(o.loadFromUrlError||null,o);return}const l=c=>{c.once("load",u=>{i==="material"?this._loadTextures(u,(h,d)=>{s(h,u)}):s(null,u)}),c.once("error",u=>{u&&(this.loadFromUrlError=u),s(u,c)}),this.load(c)};o.resource?s(null,o):i==="model"?this._loadModel(o,l):l(o)}_loadModel(e,t){const i=e.getFileUrl(),s=Ne.getExtension(i);if(s===".json"||s===".glb"){const n=Ne.getDirectory(i),a=Ne.getBasename(i),o=Ne.join(n,a.replace(s,".mapping.json"));this._loader.load(o,"json",(l,c)=>{l?(e.data={mapping:[]},t(e)):this._loadMaterials(e,c,(u,h)=>{e.data=c,t(e)})})}else t(e)}_loadMaterials(e,t,i){const s=[];let n=0;const a=(o,l)=>{this._loadTextures(l,(c,u)=>{s.push(l),s.length===n&&i(null,s)})};for(let o=0;o<t.mapping.length;o++){const l=t.mapping[o].path;if(l){n++;const c=e.getAbsoluteUrl(l);this.loadFromUrl(c,"material",a)}}n===0&&i(null,s)}_loadTextures(e,t){const i=[];let s=0;const n=e.data;if(n.mappingFormat!=="path"){t(null,i);return}const a=(l,c)=>{l&&console.error(l),i.push(c),i.length===s&&t(null,i)},o=HE;for(let l=0;l<o.length;l++){const c=n[o[l]];if(c&&typeof c=="string"){s++;const u=e.getAbsoluteUrl(c);this.loadFromUrl(u,"texture",a)}}s===0&&t(null,i)}_onTagAdd(e,t){this._tags.add(e,t)}_onTagRemove(e,t){this._tags.remove(e,t)}_onNameChange(e,t,i){if(this._nameToAsset.has(i)){const s=this._nameToAsset.get(i);s.delete(e),s.size===0&&this._nameToAsset.delete(i)}this._nameToAsset.has(e.name)||this._nameToAsset.set(e.name,new Set),this._nameToAsset.get(e.name).add(e)}findByTag(...e){return this._tags.find(e)}filter(e){return Array.from(this._assets).filter(t=>e(t))}find(e,t){const i=this._nameToAsset.get(e);if(!i)return null;for(const s of i)if(!t||s.type===t)return s;return null}findAll(e,t){const i=this._nameToAsset.get(e);if(!i)return[];const s=Array.from(i);return t?s.filter(n=>n.type===t):s}};uf.EVENT_LOAD="load",uf.EVENT_ADD="add",uf.EVENT_REMOVE="remove",uf.EVENT_ERROR="error";let FM=uf;class Rve{constructor(e){this._idToBundle=new Map,this._assetToBundles=new Map,this._urlsToBundles=new Map,this._fileRequests=new Map,this._assets=e,this._assets.bundles=this,this._assets.on("add",this._onAssetAdd,this),this._assets.on("remove",this._onAssetRemove,this)}_onAssetAdd(e){if(e.type==="bundle"){this._idToBundle.set(e.id,e),this._assets.on(`load:start:${e.id}`,this._onBundleLoadStart,this),this._assets.on(`load:${e.id}`,this._onBundleLoad,this),this._assets.on(`error:${e.id}`,this._onBundleError,this);const t=e.data.assets;for(let i=0;i<t.length;i++)this._indexAssetInBundle(t[i],e)}else this._assetToBundles.has(e.id)&&this._indexAssetFileUrls(e)}_unbindAssetEvents(e){this._assets.off(`load:start:${e}`,this._onBundleLoadStart,this),this._assets.off(`load:${e}`,this._onBundleLoad,this),this._assets.off(`error:${e}`,this._onBundleError,this)}_indexAssetInBundle(e,t){let i=this._assetToBundles.get(e);i||(i=new Set,this._assetToBundles.set(e,i)),i.add(t);const s=this._assets.get(e);s&&this._indexAssetFileUrls(s)}_indexAssetFileUrls(e){const t=this._getAssetFileUrls(e);if(t)for(let i=0;i<t.length;i++){const s=this._assetToBundles.get(e.id);s&&this._urlsToBundles.set(t[i],s)}}_getAssetFileUrls(e){let t=e.getFileUrl();if(!t)return null;t=t.split("?")[0];const i=[t];if(e.type==="font"){const s=e.data.info.maps.length;for(let n=1;n<s;n++)i.push(t.replace(".png",`${n}.png`))}return i}_onAssetRemove(e){if(e.type==="bundle"){this._idToBundle.delete(e.id),this._unbindAssetEvents(e.id);const t=e.data.assets;for(let i=0;i<t.length;i++){const s=this._assetToBundles.get(t[i]);if(s&&(s.delete(e),s.size===0)){this._assetToBundles.delete(t[i]);for(const[n,a]of this._urlsToBundles)a===s&&this._urlsToBundles.delete(n)}}this._onBundleError(`Bundle ${e.id} was removed`)}else{if(!this._assetToBundles.get(e.id))return;this._assetToBundles.delete(e.id);const i=this._getAssetFileUrls(e);if(!i)return;for(let s=0;s<i.length;s++)this._urlsToBundles.delete(i[s])}}_onBundleLoadStart(e){e.resource.on("add",(t,i)=>{const s=this._fileRequests.get(t);if(s){for(let n=0;n<s.length;n++)s[n](null,i);this._fileRequests.delete(t)}})}_onBundleLoad(e){if(!e.resource){this._onBundleError(`Bundle ${e.id} failed to load`);return}if(this._fileRequests)for(const[t,i]of this._fileRequests){const s=this._urlsToBundles.get(t);if(!s||!s.has(e))continue;const n=decodeURIComponent(t);let a,o;if(e.resource.has(n))o=e.resource.get(n);else if(e.resource.loaded)a=`Bundle ${e.id} does not contain URL ${t}`;else continue;for(let l=0;l<i.length;l++)i[l](a,a||o);this._fileRequests.delete(t)}}_onBundleError(e){for(const[t,i]of this._fileRequests)if(!this._findLoadedOrLoadingBundleForUrl(t)){for(let n=0;n<i.length;n++)i[n](e);this._fileRequests.delete(t)}}_findLoadedOrLoadingBundleForUrl(e){const t=this._urlsToBundles.get(e);if(!t)return null;let i=null;for(const s of t){if(s.loaded&&s.resource)return s;s.loading&&(i=s)}return i}listBundlesForAsset(e){const t=this._assetToBundles.get(e.id);return t?Array.from(t):null}list(){return Array.from(this._idToBundle.values())}hasUrl(e){return this._urlsToBundles.has(e)}urlIsLoadedOrLoading(e){return!!this._findLoadedOrLoadingBundleForUrl(e)}loadUrl(e,t){const i=this._findLoadedOrLoadingBundleForUrl(e);if(!i){t(`URL ${e} not found in any bundles`);return}if(i.loaded){const n=decodeURIComponent(e);if(i.resource.has(n)){t(null,i.resource.get(n));return}else if(i.resource.loaded){t(`Bundle ${i.id} does not contain URL ${e}`);return}}let s=this._fileRequests.get(e);s||(s=[],this._fileRequests.set(e,s)),s.push(t)}destroy(){this._assets.off("add",this._onAssetAdd,this),this._assets.off("remove",this._onAssetRemove,this);for(const e of this._idToBundle.keys())this._unbindAssetEvents(e);this._assets=null,this._idToBundle.clear(),this._idToBundle=null,this._assetToBundles.clear(),this._assetToBundles=null,this._urlsToBundles.clear(),this._urlsToBundles=null,this._fileRequests.clear(),this._fileRequests=null}}class Dve extends Te{constructor(){super(),this.list=[]}add(e){const t=e.id;if(this[t])throw new Error(`ComponentSystem name '${t}' already registered or not allowed`);this[t]=e,this.list.push(e)}remove(e){const t=e.id;if(!this[t])throw new Error(`No ComponentSystem named '${t}' registered`);delete this[t];const i=this.list.indexOf(this[t]);i!==-1&&this.list.splice(i,1)}destroy(){this.off();for(let e=0;e<this.list.length;e++)this.list[e].destroy()}}const rT=class rT extends Te{addFile(e,t){this._index.has(e)||(this._index.set(e,t),this.fire("add",e,t))}has(e){return this._index.has(e)}get(e){return this._index.get(e)||null}destroy(){this._index.clear()}set loaded(e){!e||this._loaded||(this._loaded=!0,this.fire("load"))}get loaded(){return this._loaded}constructor(...e){super(...e),this._index=new Map,this._loaded=!1}};rT.EVENT_ADD="add",rT.EVENT_LOAD="load";let BM=rT;class Lve extends Te{constructor(e,t=""){super(),this.headerSize=512,this.paddingSize=512,this.bytesRead=0,this.bytesReceived=0,this.headerRead=!1,this.reader=null,this.data=new Uint8Array(0),this.decoder=null,this.prefix="",this.fileName="",this.fileSize=0,this.fileType="",this.ustarFormat="",this.prefix=t||"",this.reader=e.body.getReader(),this.reader.read().then(i=>{this.pump(i.done,i.value)}).catch(i=>{this.fire("error",i)})}pump(e,t){if(e)return this.fire("done"),null;this.bytesReceived+=t.byteLength;const i=new Uint8Array(this.data.length+t.length);for(i.set(this.data),i.set(t,this.data.length),this.data=i;this.readFile(););return this.reader.read().then(s=>{this.pump(s.done,s.value)}).catch(s=>{this.fire("error",s)})}readFile(){if(!this.headerRead&&this.bytesReceived>this.bytesRead+this.headerSize){this.headerRead=!0;const e=new DataView(this.data.buffer,this.bytesRead,this.headerSize);this.decoder??(this.decoder=new TextDecoder("windows-1252"));const t=this.decoder.decode(e);if(this.fileName=t.substring(0,100).replace(/\0/g,""),this.fileSize=parseInt(t.substring(124,136),8),this.fileType=t.substring(156,157),this.ustarFormat=t.substring(257,263),this.ustarFormat.indexOf("ustar")!==-1){const i=t.substring(345,500).replace(/\0/g,"");i.length>0&&(this.fileName=i.trim()+this.fileName.trim())}this.bytesRead+=512}if(this.headerRead){if(this.bytesReceived<this.bytesRead+this.fileSize)return!1;if(this.fileType===""||this.fileType==="0"){const t=new DataView(this.data.buffer,this.bytesRead,this.fileSize),i={name:this.prefix+this.fileName,size:this.fileSize,data:t};this.fire("file",i)}this.bytesRead+=this.fileSize,this.headerRead=!1;const e=this.bytesRead%this.paddingSize;return e!==0&&(this.bytesRead+=this.paddingSize-e),!0}return!1}}class Ot{constructor(e,t){this.handlerType="",this._maxRetries=0,this._app=e,this.handlerType=t}set maxRetries(e){this._maxRetries=e}get maxRetries(){return this._maxRetries}load(e,t,i){}open(e,t,i){return t}patch(e,t){}}class Ove extends Ot{constructor(e){super(e,"bundle"),this._assets=e.assets}_fetchRetries(e,t,i=0){return new Promise((s,n)=>{const a=()=>{fetch(e,t).then(s).catch(o=>{i++,i<this.maxRetries?a():n(o)})};a()})}load(e,t){typeof e=="string"&&(e={load:e,original:e}),this._fetchRetries(e.load,{mode:"cors",credentials:"include"},this.maxRetries).then(i=>{const s=new BM;t(null,s);const n=new Lve(i,this._assets.prefix);n.on("file",a=>{s.addFile(a.name,a.data)}),n.on("done",()=>{s.loaded=!0}),n.on("error",a=>{t(a)})}).catch(i=>{t(i)})}open(e,t){return t}}class Lf{constructor(e){this._handlers={},this._requests={},this._cache={},this._app=e}addHandler(e,t){this._handlers[e]=t,t._loader=this}removeHandler(e){delete this._handlers[e]}getHandler(e){return this._handlers[e]}static makeKey(e,t){return`${e}-${t}`}load(e,t,i,s,n){var l;const a=this._handlers[t];if(!a){const c=`No resource handler for asset type: '${t}' when loading [${e}]`;i(c);return}if(!e){this._loadNull(a,i,s);return}const o=Lf.makeKey(e,t);if(this._cache[o]!==void 0)i(null,this._cache[o]);else if(this._requests[o])this._requests[o].push(i);else{this._requests[o]=[i];const c=this,u=function(d,f){if(d){c._onFailure(o,d);return}if(f.load instanceof DataView){if(a.openBinary){if(!c._requests[o])return;try{const p=a.openBinary(f.load);c._onSuccess(o,p)}catch(p){c._onFailure(o,p)}return}f.load=URL.createObjectURL(new Blob([f.load])),s&&(s.urlObject&&URL.revokeObjectURL(s.urlObject),s.urlObject=f.load)}a.load(f,(p,m,g)=>{if(c._requests[o]){if(p){c._onFailure(o,p);return}try{c._onSuccess(o,a.open(f.original,m,s),g)}catch(_){c._onFailure(o,_)}}},s)},h=e.split("?")[0];if(this._app.enableBundles&&this._app.bundles.hasUrl(h)&&!(n&&n.bundlesIgnore)){if(!this._app.bundles.urlIsLoadedOrLoading(h)){const d=this._app.bundles.listBundlesForAsset(s);let f;n&&n.bundlesFilter&&(f=n.bundlesFilter(d)),f||(d==null||d.sort((p,m)=>p.file.size-m.file.size),f=d==null?void 0:d[0]),f&&((l=this._app.assets)==null||l.load(f))}this._app.bundles.loadUrl(h,(d,f)=>{u(d,{load:f,original:h})})}else u(null,{load:e,original:s&&s.file.filename||e})}}_loadNull(e,t,i){const s=function(n,a,o){if(n)t(n);else try{t(null,e.open(null,a,i),o)}catch(l){t(l)}};e.load(null,s,i)}_onSuccess(e,t,i){t!==null?this._cache[e]=t:delete this._cache[e];for(let s=0;s<this._requests[e].length;s++)this._requests[e][s](null,t,i);delete this._requests[e]}_onFailure(e,t){if(console.error(t),this._requests[e]){for(let i=0;i<this._requests[e].length;i++)this._requests[e][i](t);delete this._requests[e]}}open(e,t){const i=this._handlers[e];return i?i.open(null,t):(console.warn(`No resource handler found for: ${e}`),t)}patch(e,t){const i=this._handlers[e.type];if(!i){console.warn(`No resource handler found for: ${e.type}`);return}i.patch&&i.patch(e,t)}clearCache(e,t){const i=Lf.makeKey(e,t);delete this._cache[i]}getFromCache(e,t){const i=Lf.makeKey(e,t);if(this._cache[i])return this._cache[i]}enableRetry(e=5){e=Math.max(0,e)||0;for(const t in this._handlers)this._handlers[t].maxRetries=e}disableRetry(){for(const e in this._handlers)this._handlers[e].maxRetries=0}destroy(){this._handlers={},this._requests={},this._cache={}}}class Nve{_validate(e){if(!e.header)throw new Error('pc.I18n#addData: Missing "header" field');if(!e.header.version)throw new Error('pc.I18n#addData: Missing "header.version" field');if(e.header.version!==1)throw new Error('pc.I18n#addData: Invalid "header.version" field');if(e.data){if(!Array.isArray(e.data))throw new Error('pc.I18n#addData: "data" field must be an array')}else throw new Error('pc.I18n#addData: Missing "data" field');for(let t=0,i=e.data.length;t<i;t++){const s=e.data[t];if(!s.info)throw new Error(`pc.I18n#addData: missing "data[${t}].info" field`);if(!s.info.locale)throw new Error(`pc.I18n#addData: missing "data[${t}].info.locale" field`);if(typeof s.info.locale!="string")throw new Error(`pc.I18n#addData: "data[${t}].info.locale" must be a string`);if(!s.messages)throw new Error(`pc.I18n#addData: missing "data[${t}].messages" field`)}}parse(e){return e.data}}const sT=class sT extends Te{constructor(e){super(),this.locale=Tb,this._translations={},this._availableLangs={},this._app=e,this._assets=[],this._parser=new Nve}set assets(e){const t={};for(let s=0,n=e.length;s<n;s++){const a=e[s]instanceof be?e[s].id:e[s];t[a]=!0}let i=this._assets.length;for(;i--;){const s=this._assets[i];if(!t[s]){this._app.assets.off(`add:${s}`,this._onAssetAdd,this);const n=this._app.assets.get(s);n&&this._onAssetRemove(n),this._assets.splice(i,1)}}for(const s in t){const n=parseInt(s,10);if(this._assets.indexOf(n)!==-1)continue;this._assets.push(n);const a=this._app.assets.get(n);a?this._onAssetAdd(a):this._app.assets.once(`add:${n}`,this._onAssetAdd,this)}}get assets(){return this._assets}set locale(e){if(this._locale===e)return;let t=vo(e);if(t==="in"&&(t="id",e=Eve(e,t),this._locale===e))return;const i=this._locale;this._locale=e,this._lang=t,this._pluralFn=UC(this._lang),this.fire(sT.EVENT_CHANGE,e,i)}get locale(){return this._locale}static findAvailableLocale(e,t){return Z9(e,t)}findAvailableLocale(e){if(this._translations[e])return e;const t=vo(e);return this._findFallbackLocale(e,t)}getText(e,t){let i=e,s;t||(t=this._locale,s=this._lang);let n=this._translations[t];return n||(s||(s=vo(t)),t=this._findFallbackLocale(t,s),n=this._translations[t]),n&&n.hasOwnProperty(e)&&(i=n[e],Array.isArray(i)&&(i=i[0]),i==null&&(i=e)),i}getPluralText(e,t,i){let s=e,n,a;i?(n=vo(i),a=UC(n)):(i=this._locale,n=this._lang,a=this._pluralFn);let o=this._translations[i];if(o||(i=this._findFallbackLocale(i,n),n=vo(i),a=UC(n),o=this._translations[i]),o&&o[e]&&a){const l=a(t);s=o[e][l],s==null&&(s=e)}return s}addData(e){let t;try{t=this._parser.parse(e)}catch(i){console.error(i);return}for(let i=0,s=t.length;i<s;i++){const n=t[i],a=n.info.locale,o=n.messages;if(!this._translations[a]){this._translations[a]={};const l=vo(a);this._availableLangs[l]||(this._availableLangs[l]=a)}Object.assign(this._translations[a],o),this.fire("data:add",a,o)}}removeData(e){let t;try{t=this._parser.parse(e)}catch(i){console.error(i);return}for(let i=0,s=t.length;i<s;i++){const n=t[i],a=n.info.locale,o=this._translations[a];if(!o)continue;const l=n.messages;for(const c in l)delete o[c];Object.keys(o).length===0&&(delete this._translations[a],delete this._availableLangs[vo(a)]),this.fire("data:remove",a,l)}}destroy(){this._translations=null,this._availableLangs=null,this._assets=null,this._parser=null,this.off()}_findFallbackLocale(e,t){let i=Eb[e];return i&&this._translations[i]||(i=Eb[t],i&&this._translations[i])||(i=this._availableLangs[t],i&&this._translations[i])?i:Tb}_onAssetAdd(e){e.on("load",this._onAssetLoad,this),e.on("change",this._onAssetChange,this),e.on("remove",this._onAssetRemove,this),e.on("unload",this._onAssetUnload,this),e.resource&&this._onAssetLoad(e)}_onAssetLoad(e){this.addData(e.resource)}_onAssetChange(e){e.resource&&this.addData(e.resource)}_onAssetRemove(e){e.off("load",this._onAssetLoad,this),e.off("change",this._onAssetChange,this),e.off("remove",this._onAssetRemove,this),e.off("unload",this._onAssetUnload,this),e.resource&&this.removeData(e.resource),this._app.assets.once(`add:${e.id}`,this._onAssetAdd,this)}_onAssetUnload(e){e.resource&&this.removeData(e.resource)}};sT.EVENT_CHANGE="change";let xh=sT;class kve extends Te{constructor(e){super(),this._scripts={},this._list=[],this._scriptSchemas=new Map,this.app=e}destroy(){this.app=null,this.off()}addSchema(e,t){t&&this._scriptSchemas.set(e,t)}getSchema(e){return this._scriptSchemas.get(e)}add(e){const t=e.__name;return this._scripts.hasOwnProperty(t)?(setTimeout(()=>{if(e.prototype.swap){const i=this._scripts[t],s=this._list.indexOf(i);this._list[s]=e,this._scripts[t]=e,this.fire("swap",t,e),this.fire(`swap:${t}`,e)}else console.warn(`script registry already has '${t}' script, define 'swap' method for new script type to enable code hot swapping`)}),!1):(this._scripts[t]=e,this._list.push(e),this.fire("add",t,e),this.fire(`add:${t}`,e),setTimeout(()=>{if(!this._scripts.hasOwnProperty(t)||!this.app||!this.app.systems||!this.app.systems.script)return;const i=this.app.systems.script._components;let s;const n=[],a=[];for(i.loopIndex=0;i.loopIndex<i.length;i.loopIndex++){const o=i.items[i.loopIndex];if(o._scriptsIndex[t]&&o._scriptsIndex[t].awaiting){o._scriptsData&&o._scriptsData[t]&&(s=o._scriptsData[t].attributes);const l=o.create(t,{preloading:!0,ind:o._scriptsIndex[t].ind,attributes:s});l&&n.push(l);for(const c of o.scripts)o.initializeAttributes(c)}}for(let o=0;o<n.length;o++)n[o].enabled&&(n[o]._initialized=!0,a.push(n[o]),n[o].initialize&&n[o].initialize());for(let o=0;o<a.length;o++)!a[o].enabled||a[o]._postInitialized||(a[o]._postInitialized=!0,a[o].postInitialize&&a[o].postInitialize())}),!0)}remove(e){let t=e,i=e;if(typeof i!="string"?i=t.__name:t=this.get(i),this.get(i)!==t)return!1;delete this._scripts[i];const s=this._list.indexOf(t);return this._list.splice(s,1),this.fire("remove",i,t),this.fire(`remove:${i}`,t),!0}get(e){return this._scripts[e]||null}has(e){if(typeof e=="string")return this._scripts.hasOwnProperty(e);if(!e)return!1;const t=e.__name;return this._scripts[t]===e}list(){return this._list}}const Fve=(r,e)=>r.constructor.order-e.constructor.order,Bve=r=>r.sort(Fve),ig=[],Q9=[],Uve=()=>Q9.pop()??[],bz=r=>{r.length=0,Q9.push(r)},nT=class nT extends Xt{constructor(e,t=Xu()){super(e),this.c={},this._destroying=!1,this._guid=null,this._template=!1,this._app=t}addComponent(e,t){const i=this._app.systems[e];return!i||this.c[e]?null:i.addComponent(this,t)}removeComponent(e){const t=this._app.systems[e];t&&this.c[e]&&t.removeComponent(this)}findComponent(e){const t=this.findOne(i=>{var s;return(s=i.c)==null?void 0:s[e]});return t&&t.c[e]}findComponents(e){return this.find(t=>{var i;return(i=t.c)==null?void 0:i[e]}).map(t=>t.c[e])}findScript(e){const t=this.findOne(i=>{var s,n;return(n=(s=i.c)==null?void 0:s.script)==null?void 0:n.has(e)});return t==null?void 0:t.c.script.get(e)}findScripts(e){return this.find(i=>{var s,n;return(n=(s=i.c)==null?void 0:s.script)==null?void 0:n.has(e)}).map(i=>i.c.script.get(e))}getGuid(){return this._guid||this.setGuid(sde.create()),this._guid}setGuid(e){const t=this._app._entityIndex;this._guid&&delete t[this._guid],this._guid=e,t[this._guid]=this}_notifyHierarchyStateChanged(e,t){let i=!1;e===this&&ig.length===0&&(i=!0),e._beingEnabled=!0,e._onHierarchyStateChanged(t),e._onHierarchyStatePostChanged&&ig.push(e);const s=e._children;for(let n=0,a=s.length;n<a;n++)s[n]._enabled&&this._notifyHierarchyStateChanged(s[n],t);if(e._beingEnabled=!1,i){for(let n=0;n<ig.length;n++)ig[n]._onHierarchyStatePostChanged();ig.length=0}}_onHierarchyStateChanged(e){super._onHierarchyStateChanged(e);const t=this._getSortedComponents();for(let i=0;i<t.length;i++){const s=t[i];s.enabled&&(e?s.onEnable():s.onDisable())}bz(t)}_onHierarchyStatePostChanged(){const e=this._getSortedComponents();for(let t=0;t<e.length;t++)e[t].onPostStateChange();bz(e)}findByGuid(e){if(this._guid===e)return this;const t=this._app._entityIndex[e];return t&&(t===this||t.isDescendantOf(this))?t:null}destroy(){this._destroying=!0;for(const e in this.c)this.c[e].enabled=!1;for(const e in this.c)this.c[e].system.removeComponent(this);super.destroy(),this._guid&&delete this._app._entityIndex[this._guid],this._destroying=!1}clone(){const e={},t=this._cloneRecursively(e);return e[this.getGuid()]=t,J9(this,this,t,e),t}_getSortedComponents(){const e=this.c,t=Uve();let i=0;for(const s in e)if(e.hasOwnProperty(s)){const n=e[s];i|=n.constructor.order!==0,t.push(n)}return i&&t.length>1&&Bve(t),t}_cloneRecursively(e){const t=new this.constructor(void 0,this._app);super._cloneInternal(t);for(const i in this.c)this.c[i].system.cloneComponent(this,t);for(let i=0;i<this._children.length;i++){const s=this._children[i];if(s instanceof nT){const n=s._cloneRecursively(e);t.addChild(n),e[s.getGuid()]=n}}return t}};nT.EVENT_DESTROY="destroy";let lt=nT;function J9(r,e,t,i){if(e instanceof lt){const s=e.c;for(const o in s){const l=s[o],c=l.system.getPropertiesOfType("entity");for(let u=0,h=c.length;u<h;u++){const f=c[u].name,p=l[f];if(!!r.findByGuid(p)){const g=i[p].getGuid();g&&(t.c[o][f]=g)}}}s.script&&t.script.resolveDuplicatedEntityReferenceProperties(s.script,i),s.render&&t.render.resolveDuplicatedEntityReferenceProperties(s.render,i),s.button&&t.button.resolveDuplicatedEntityReferenceProperties(s.button,i),s.scrollview&&t.scrollview.resolveDuplicatedEntityReferenceProperties(s.scrollview,i),s.scrollbar&&t.scrollbar.resolveDuplicatedEntityReferenceProperties(s.scrollbar,i),s.anim&&t.anim.resolveDuplicatedEntityReferenceProperties(s.anim,i);const n=e.children.filter(o=>o instanceof lt),a=t.children.filter(o=>o instanceof lt);for(let o=0,l=n.length;o<l;o++)J9(r,n[o],a[o],i)}}class wz{constructor(e,t){this.data=null,this._loading=!1,this._onLoadedCallbacks=[],this.name=e,this.url=t}get loaded(){return!!this.data}get loading(){return this._loading}}class zve{constructor(e){this._list=[],this._index={},this._urlIndex={},this._app=e}destroy(){this._app=null}list(){return this._list}add(e,t){if(this._index.hasOwnProperty(e))return!1;const i=new wz(e,t),s=this._list.push(i);return this._index[i.name]=s-1,this._urlIndex[i.url]=s-1,!0}find(e){return this._index.hasOwnProperty(e)?this._list[this._index[e]]:null}findByUrl(e){return this._urlIndex.hasOwnProperty(e)?this._list[this._urlIndex[e]]:null}remove(e){if(this._index.hasOwnProperty(e)){const t=this._index[e];let i=this._list[t];delete this._urlIndex[i.url],delete this._index[e],this._list.splice(t,1);for(let s=0;s<this._list.length;s++)i=this._list[s],this._index[i.name]=s,this._urlIndex[i.url]=s}}_loadSceneData(e,t,i){const s=this._app;let n=e;if(typeof e=="string"&&(e=this.findByUrl(n)||this.find(n)||new wz("Untitled",n)),n=e.url,!n){i("Cannot find scene to load");return}if(e.loaded){i(null,e);return}s.assets&&s.assets.prefix&&!yp.test(n)&&(n=Ne.join(s.assets.prefix,n)),e._onLoadedCallbacks.push(i),e._loading||s.loader.getHandler("hierarchy").load(n,(o,l)=>{e.data=l,e._loading=!1;for(let c=0;c<e._onLoadedCallbacks.length;c++)e._onLoadedCallbacks[c](o,e);t||(e.data=null),e._onLoadedCallbacks.length=0}),e._loading=!0}loadSceneData(e,t){this._loadSceneData(e,!0,t)}unloadSceneData(e){typeof e=="string"&&(e=this.findByUrl(e)),e&&(e.data=null)}_loadSceneHierarchy(e,t,i){this._loadSceneData(e,!1,(s,n)=>{if(s){i&&i(s);return}t&&t(n);const a=this._app,o=()=>{const l=a.loader.getHandler("hierarchy");a.systems.script.preloading=!0;const c=l.open(n.url,n.data);a.systems.script.preloading=!1,a.loader.clearCache(n.url,"hierarchy"),a.root.addChild(c),a.systems.fire("initialize",c),a.systems.fire("postInitialize",c),a.systems.fire("postPostInitialize",c),i&&i(null,c)};a._preloadScripts(n.data,o)})}loadSceneHierarchy(e,t){this._loadSceneHierarchy(e,null,t)}loadSceneSettings(e,t){this._loadSceneData(e,!1,(i,s)=>{i?t&&t(i):(this._app.applySceneSettings(s.data.settings),t&&t(null))})}changeScene(e,t){const i=this._app,s=n=>{const{children:a}=i.root;for(;a.length;)a[0].destroy();i.applySceneSettings(n.data.settings)};this._loadSceneHierarchy(e,s,t)}loadScene(e,t){const i=this._app,s=i.loader.getHandler("scene");i.assets&&i.assets.prefix&&!yp.test(e)&&(e=Ne.join(i.assets.prefix,e)),s.load(e,(n,a)=>{if(n)t&&t(n);else{const o=()=>{i.systems.script.preloading=!0;const l=s.open(e,a),c=this.findByUrl(e);c&&!c.loaded&&(c.data=a),i.systems.script.preloading=!1,i.loader.clearCache(e,"scene"),i.loader.patch({resource:l,type:"scene"},i.assets),i.root.addChild(l.root),i.systems.rigidbody&&typeof Ammo<"u"&&i.systems.rigidbody.gravity.set(l._gravity.x,l._gravity.y,l._gravity.z),t&&t(null,l)};i._preloadScripts(a,o)}})}}class Vve{constructor(e){this.frame={fps:0,ms:0,dt:0,updateStart:0,updateTime:0,renderStart:0,renderTime:0,physicsStart:0,physicsTime:0,cullTime:0,sortTime:0,skinTime:0,morphTime:0,instancingTime:0,triangles:0,otherPrimitives:0,shaders:0,materials:0,cameras:0,shadowMapUpdates:0,shadowMapTime:0,depthMapTime:0,forwardTime:0,lightClustersTime:0,lightClusters:0,_timeToCountFrames:0,_fpsAccum:0},this.drawCalls={forward:0,depth:0,shadow:0,immediate:0,misc:0,total:0,skinned:0,instanced:0,removedByInstancing:0},this.misc={renderTargetCreationTime:0},this.particles={updatesPerFrame:0,_updatesPerFrame:0,frameTime:0,_frameTime:0},this.shaders=e._shaderStats,this.vram=e._vram,Object.defineProperty(this.vram,"totalUsed",{get:function(){return this.tex+this.vb+this.ib}}),Object.defineProperty(this.vram,"geom",{get:function(){return this.vb+this.ib}})}get scene(){return Xu().scene._stats}get lightmapper(){var e;return(e=Xu().lightmapper)==null?void 0:e.stats}get batcher(){const e=Xu()._batcher;return e?e._stats:null}}var jve=`
uniform float alpha_ref;
void alphaTest(float a) {
	if (a < alpha_ref) discard;
}
`,$ve=`
#ifdef LIT_AMBIENT_SOURCE == AMBIENTSH
	uniform vec3 ambientSH[9];
#endif
#if LIT_AMBIENT_SOURCE == ENVALATLAS
	#include "envAtlasPS"
	#ifndef ENV_ATLAS
	#define ENV_ATLAS
		uniform sampler2D texture_envAtlas;
	#endif
#endif
void addAmbient(vec3 worldNormal) {
	#ifdef LIT_AMBIENT_SOURCE == AMBIENTSH
		vec3 n = cubeMapRotate(worldNormal);
		vec3 color =
			ambientSH[0] +
			ambientSH[1] * n.x +
			ambientSH[2] * n.y +
			ambientSH[3] * n.z +
			ambientSH[4] * n.x * n.z +
			ambientSH[5] * n.z * n.y +
			ambientSH[6] * n.y * n.x +
			ambientSH[7] * (3.0 * n.z * n.z - 1.0) +
			ambientSH[8] * (n.x * n.x - n.y * n.y);
		dDiffuseLight += processEnvironment(max(color, vec3(0.0)));
	#endif
	#if LIT_AMBIENT_SOURCE == ENVALATLAS
		vec3 dir = normalize(cubeMapRotate(worldNormal) * vec3(-1.0, 1.0, 1.0));
		vec2 uv = mapUv(toSphericalUv(dir), vec4(128.0, 256.0 + 128.0, 64.0, 32.0) / atlasSize);
		vec4 raw = texture2D(texture_envAtlas, uv);
		vec3 linear = {ambientDecode}(raw);
		dDiffuseLight += processEnvironment(linear);
	#endif
	#if LIT_AMBIENT_SOURCE == CONSTANT
		dDiffuseLight += light_globalAmbient;
	#endif
}
`,Hve=`
#ifdef LIT_GGX_SPECULAR
	uniform float material_anisotropyIntensity;
	uniform vec2 material_anisotropyRotation;
#endif
void getAnisotropy() {
	dAnisotropy = 0.0;
	dAnisotropyRotation = vec2(1.0, 0.0);
#ifdef LIT_GGX_SPECULAR
	dAnisotropy = material_anisotropyIntensity;
	dAnisotropyRotation = material_anisotropyRotation;
#endif
	#ifdef STD_ANISOTROPY_TEXTURE
	vec3 anisotropyTex = texture2DBias({STD_ANISOTROPY_TEXTURE_NAME}, {STD_ANISOTROPY_TEXTURE_UV}, textureBias).rgb;
	dAnisotropy *= anisotropyTex.b;
	vec2 anisotropyRotationFromTex = anisotropyTex.rg * 2.0 - vec2(1.0);
	mat2 rotationMatrix = mat2(dAnisotropyRotation.x, dAnisotropyRotation.y, -dAnisotropyRotation.y, dAnisotropyRotation.x);
	dAnisotropyRotation = rotationMatrix * anisotropyRotationFromTex;
	#endif
	
	dAnisotropy = clamp(dAnisotropy, 0.0, 1.0);
}
`,Gve=`
#if defined(STD_AO_TEXTURE) || defined(STD_AO_VERTEX)
	uniform float material_aoIntensity;
#endif
#ifdef STD_AODETAIL_TEXTURE
	#include "detailModesPS"
#endif
void getAO() {
	dAo = 1.0;
	#ifdef STD_AO_TEXTURE
		float aoBase = texture2DBias({STD_AO_TEXTURE_NAME}, {STD_AO_TEXTURE_UV}, textureBias).{STD_AO_TEXTURE_CHANNEL};
		#ifdef STD_AODETAIL_TEXTURE
			float aoDetail = texture2DBias({STD_AODETAIL_TEXTURE_NAME}, {STD_AODETAIL_TEXTURE_UV}, textureBias).{STD_AODETAIL_TEXTURE_CHANNEL};
			aoBase = detailMode_{STD_AODETAIL_DETAILMODE}(vec3(aoBase), vec3(aoDetail)).r;
		#endif
		dAo *= aoBase;
	#endif
	#ifdef STD_AO_VERTEX
		dAo *= saturate(vVertexColor.{STD_AO_VERTEX_CHANNEL});
	#endif
	#if defined(STD_AO_TEXTURE) || defined(STD_AO_VERTEX)
		dAo = mix(1.0, dAo, material_aoIntensity);
	#endif
}
`,Wve=`
void occludeDiffuse(float ao) {
	dDiffuseLight *= ao;
}
`,Xve=`
#if LIT_OCCLUDE_SPECULAR != NONE
	#ifdef LIT_OCCLUDE_SPECULAR_FLOAT
		uniform float material_occludeSpecularIntensity;
	#endif
#endif
void occludeSpecular(float gloss, float ao, vec3 worldNormal, vec3 viewDir) {
	#if LIT_OCCLUDE_SPECULAR == AO
		#ifdef LIT_OCCLUDE_SPECULAR_FLOAT
			float specOcc = mix(1.0, ao, material_occludeSpecularIntensity);
		#else
			float specOcc = ao;
		#endif
	#endif
	#if LIT_OCCLUDE_SPECULAR == GLOSSDEPENDENT
		float specPow = exp2(gloss * 11.0);
		float specOcc = saturate(pow(dot(worldNormal, viewDir) + ao, 0.01 * specPow) - 1.0 + ao);
		#ifdef LIT_OCCLUDE_SPECULAR_FLOAT
			specOcc = mix(1.0, specOcc, material_occludeSpecularIntensity);
		#endif
	#endif
	#if LIT_OCCLUDE_SPECULAR != NONE
		dSpecularLight *= specOcc;
		dReflection *= specOcc;
		#ifdef LIT_SHEEN
			sSpecularLight *= specOcc;
			sReflection *= specOcc;
		#endif
	#endif
}
`,qve=`
	vec4 dirLm = texture2D(texture_dirLightMap, vUv1);
	if (bakeDir > 0.5) {
		if (dAtten > 0.00001) {
			dirLm.xyz = dirLm.xyz * 2.0 - vec3(1.0);
			dAtten = saturate(dAtten);
			gl_FragColor.rgb = normalize(dLightDirNormW.xyz*dAtten + dirLm.xyz*dirLm.w) * 0.5 + vec3(0.5);
			gl_FragColor.a = dirLm.w + dAtten;
			gl_FragColor.a = max(gl_FragColor.a, 1.0 / 255.0);
		} else {
			gl_FragColor = dirLm;
		}
	} else {
		gl_FragColor.rgb = dirLm.xyz;
		gl_FragColor.a = max(dirLm.w, dAtten > 0.00001 ? (1.0/255.0) : 0.0);
	}
`,Yve=`
#ifdef LIT_LIGHTMAP_BAKING_ADD_AMBIENT
	dDiffuseLight = ((dDiffuseLight - 0.5) * max(ambientBakeOcclusionContrast + 1.0, 0.0)) + 0.5;
	dDiffuseLight += vec3(ambientBakeOcclusionBrightness);
	dDiffuseLight = saturate(dDiffuseLight);
	dDiffuseLight *= dAmbientLight;
#endif
#ifdef LIGHTMAP_RGBM
	gl_FragColor.rgb = dDiffuseLight;
	gl_FragColor.rgb = pow(gl_FragColor.rgb, vec3(0.5));
	gl_FragColor.rgb /= 8.0;
	gl_FragColor.a = clamp( max( max( gl_FragColor.r, gl_FragColor.g ), max( gl_FragColor.b, 1.0 / 255.0 ) ), 0.0,1.0 );
	gl_FragColor.a = ceil(gl_FragColor.a * 255.0) / 255.0;
	gl_FragColor.rgb /= gl_FragColor.a;
#else
	gl_FragColor = vec4(dDiffuseLight, 1.0);
#endif
`,Kve=`
uniform vec3 view_position;
uniform vec3 light_globalAmbient;
float square(float x) {
	return x*x;
}
float saturate(float x) {
	return clamp(x, 0.0, 1.0);
}
vec3 saturate(vec3 x) {
	return clamp(x, vec3(0.0), vec3(1.0));
}
`,Zve=`
#define NINESLICED
varying vec2 vMask;
varying vec2 vTiledUv;
uniform mediump vec4 innerOffset;
uniform mediump vec2 outerScale;
uniform mediump vec4 atlasRect;
vec2 nineSlicedUv;
`,Qve=`
#define NINESLICED
#define NINESLICETILED
varying vec2 vMask;
varying vec2 vTiledUv;
uniform mediump vec4 innerOffset;
uniform mediump vec2 outerScale;
uniform mediump vec4 atlasRect;
vec2 nineSlicedUv;
`,Jve=`
float bayer2(vec2 p) {
	return mod(2.0 * p.y + p.x + 1.0, 4.0);
}
float bayer4(vec2 p) {
	vec2 p1 = mod(p, 2.0);
	vec2 p2 = floor(0.5 * mod(p, 4.0));
	return 4.0 * bayer2(p1) + bayer2(p2);
}
float bayer8(vec2 p) {
	vec2 p1 = mod(p, 2.0);
	vec2 p2 = floor(0.5 * mod(p, 4.0));
	vec2 p4 = floor(0.25 * mod(p, 8.0));
	return 4.0 * (4.0 * bayer2(p1) + bayer2(p2)) + bayer2(p4);
}
`,eye=`
varying vec2 vUv0;
uniform sampler2D source;
uniform vec2 pixelOffset;
#ifdef GAUSS
	uniform float weight[{SAMPLES}];
#endif
void main(void) {
	vec3 moments = vec3(0.0);
	vec2 uv = vUv0 - pixelOffset * (float({SAMPLES}) * 0.5);
	for (int i = 0; i < {SAMPLES}; i++) {
		vec4 c = texture2D(source, uv + pixelOffset * float(i));
		#ifdef GAUSS
			moments += c.xyz * weight[i];
		#else
			moments += c.xyz;
		#endif
	}
	#ifndef GAUSS
		moments *= 1.0 / float({SAMPLES});
	#endif
	gl_FragColor = vec4(moments.x, moments.y, moments.z, 1.0);
}
`,tye=`
uniform float material_clearCoat;
void getClearCoat() {
	ccSpecularity = material_clearCoat;
	#ifdef STD_CLEARCOAT_TEXTURE
	ccSpecularity *= texture2DBias({STD_CLEARCOAT_TEXTURE_NAME}, {STD_CLEARCOAT_TEXTURE_UV}, textureBias).{STD_CLEARCOAT_TEXTURE_CHANNEL};
	#endif
	#ifdef STD_CLEARCOAT_VERTEX
	ccSpecularity *= saturate(vVertexColor.{STD_CLEARCOAT_VERTEX_CHANNEL});
	#endif
}
`,iye=`
uniform float material_clearCoatGloss;
void getClearCoatGlossiness() {
	ccGlossiness = material_clearCoatGloss;
	#ifdef STD_CLEARCOATGLOSS_TEXTURE
	ccGlossiness *= texture2DBias({STD_CLEARCOATGLOSS_TEXTURE_NAME}, {STD_CLEARCOATGLOSS_TEXTURE_UV}, textureBias).{STD_CLEARCOATGLOSS_TEXTURE_CHANNEL};
	#endif
	#ifdef STD_CLEARCOATGLOSS_VERTEX
	ccGlossiness *= saturate(vVertexColor.{STD_CLEARCOATGLOSS_VERTEX_CHANNEL});
	#endif
	#ifdef STD_CLEARCOATGLOSS_INVERT
	ccGlossiness = 1.0 - ccGlossiness;
	#endif
	ccGlossiness += 0.0000001;
}
`,rye=`
#ifdef STD_CLEARCOATNORMAL_TEXTURE
uniform float material_clearCoatBumpiness;
#endif
void getClearCoatNormal() {
#ifdef STD_CLEARCOATNORMAL_TEXTURE
	vec3 normalMap = {STD_CLEARCOATNORMAL_TEXTURE_DECODE}(texture2DBias({STD_CLEARCOATNORMAL_TEXTURE_NAME}, {STD_CLEARCOATNORMAL_TEXTURE_UV}, textureBias));
	normalMap = mix(vec3(0.0, 0.0, 1.0), normalMap, material_clearCoatBumpiness);
	ccNormalW = normalize(dTBN * normalMap);
#else
	ccNormalW = dVertexNormalW;
#endif
}
`,sye=`
vec2 getCubemapFaceCoordinates(const vec3 dir, out float faceIndex, out vec2 tileOffset)
{
	vec3 vAbs = abs(dir);
	float ma;
	vec2 uv;
	if (vAbs.z >= vAbs.x && vAbs.z >= vAbs.y) {
		faceIndex = dir.z < 0.0 ? 5.0 : 4.0;
		ma = 0.5 / vAbs.z;
		uv = vec2(dir.z < 0.0 ? -dir.x : dir.x, -dir.y);
		tileOffset.x = 2.0;
		tileOffset.y = dir.z < 0.0 ? 1.0 : 0.0;
	} else if(vAbs.y >= vAbs.x) {
		faceIndex = dir.y < 0.0 ? 3.0 : 2.0;
		ma = 0.5 / vAbs.y;
		uv = vec2(dir.x, dir.y < 0.0 ? -dir.z : dir.z);
		tileOffset.x = 1.0;
		tileOffset.y = dir.y < 0.0 ? 1.0 : 0.0;
	} else {
		faceIndex = dir.x < 0.0 ? 1.0 : 0.0;
		ma = 0.5 / vAbs.x;
		uv = vec2(dir.x < 0.0 ? dir.z : -dir.z, -dir.y);
		tileOffset.x = 0.0;
		tileOffset.y = dir.x < 0.0 ? 1.0 : 0.0;
	}
	return uv * ma + 0.5;
}
vec2 getCubemapAtlasCoordinates(const vec3 omniAtlasViewport, float shadowEdgePixels, float shadowTextureResolution, const vec3 dir) {
	float faceIndex;
	vec2 tileOffset;
	vec2 uv = getCubemapFaceCoordinates(dir, faceIndex, tileOffset);
	float atlasFaceSize = omniAtlasViewport.z;
	float tileSize = shadowTextureResolution * atlasFaceSize;
	float offset = shadowEdgePixels / tileSize;
	uv = uv * vec2(1.0 - offset * 2.0) + vec2(offset * 1.0);
	uv *= atlasFaceSize;
	uv += tileOffset * atlasFaceSize;
	uv += omniAtlasViewport.xy;
	return uv;
}
`,nye=`
vec3 _getCookieClustered(TEXTURE_ACCEPT(tex), vec2 uv, float intensity, vec4 cookieChannel) {
	vec4 pixel = mix(vec4(1.0), texture2DLod(tex, uv, 0.0), intensity);
	bool isRgb = dot(cookieChannel.rgb, vec3(1.0)) == 3.0;
	return isRgb ? pixel.rgb : vec3(dot(pixel, cookieChannel));
}
vec3 getCookie2DClustered(TEXTURE_ACCEPT(tex), mat4 transform, vec3 worldPosition, float intensity, vec4 cookieChannel) {
	vec4 projPos = transform * vec4(worldPosition, 1.0);
	return _getCookieClustered(TEXTURE_PASS(tex), projPos.xy / projPos.w, intensity, cookieChannel);
}
vec3 getCookieCubeClustered(TEXTURE_ACCEPT(tex), vec3 dir, float intensity, vec4 cookieChannel, float shadowTextureResolution, float shadowEdgePixels, vec3 omniAtlasViewport) {
	vec2 uv = getCubemapAtlasCoordinates(omniAtlasViewport, shadowEdgePixels, shadowTextureResolution, dir);
	return _getCookieClustered(TEXTURE_PASS(tex), uv, intensity, cookieChannel);
}
`,aye=`
vec3 _getShadowCoordPerspZbuffer(mat4 shadowMatrix, vec4 shadowParams, vec3 wPos) {
	vec4 projPos = shadowMatrix * vec4(wPos, 1.0);
	projPos.xyz /= projPos.w;
	return projPos.xyz;
}
vec3 getShadowCoordPerspZbufferNormalOffset(mat4 shadowMatrix, vec4 shadowParams, vec3 normal) {
	vec3 wPos = vPositionW + normal * shadowParams.y;
	return _getShadowCoordPerspZbuffer(shadowMatrix, shadowParams, wPos);
}
vec3 normalOffsetPointShadow(vec4 shadowParams, vec3 lightPos, vec3 lightDir, vec3 lightDirNorm, vec3 normal) {
	float distScale = length(lightDir);
	vec3 wPos = vPositionW + normal * shadowParams.y * clamp(1.0 - dot(normal, -lightDirNorm), 0.0, 1.0) * distScale;
	vec3 dir = wPos - lightPos;
	return dir;
}
#if defined(CLUSTER_SHADOW_TYPE_PCF1)
float getShadowOmniClusteredPCF1(SHADOWMAP_ACCEPT(shadowMap), vec4 shadowParams, vec3 omniAtlasViewport, float shadowEdgePixels, vec3 lightDir) {
	float shadowTextureResolution = shadowParams.x;
	vec2 uv = getCubemapAtlasCoordinates(omniAtlasViewport, shadowEdgePixels, shadowTextureResolution, lightDir);
	float shadowZ = length(lightDir) * shadowParams.w + shadowParams.z;
	return textureShadow(shadowMap, vec3(uv, shadowZ));
}
#endif
#if defined(CLUSTER_SHADOW_TYPE_PCF3)
float getShadowOmniClusteredPCF3(SHADOWMAP_ACCEPT(shadowMap), vec4 shadowParams, vec3 omniAtlasViewport, float shadowEdgePixels, vec3 lightDir) {
	float shadowTextureResolution = shadowParams.x;
	vec2 uv = getCubemapAtlasCoordinates(omniAtlasViewport, shadowEdgePixels, shadowTextureResolution, lightDir);
	float shadowZ = length(lightDir) * shadowParams.w + shadowParams.z;
	vec3 shadowCoord = vec3(uv, shadowZ);
	return getShadowPCF3x3(SHADOWMAP_PASS(shadowMap), shadowCoord, shadowParams);
}
#endif
#if defined(CLUSTER_SHADOW_TYPE_PCF5)
float getShadowOmniClusteredPCF5(SHADOWMAP_ACCEPT(shadowMap), vec4 shadowParams, vec3 omniAtlasViewport, float shadowEdgePixels, vec3 lightDir) {
	float shadowTextureResolution = shadowParams.x;
	vec2 uv = getCubemapAtlasCoordinates(omniAtlasViewport, shadowEdgePixels, shadowTextureResolution, lightDir);
	float shadowZ = length(lightDir) * shadowParams.w + shadowParams.z;
	vec3 shadowCoord = vec3(uv, shadowZ);
	return getShadowPCF5x5(SHADOWMAP_PASS(shadowMap), shadowCoord, shadowParams);
}
#endif
#if defined(CLUSTER_SHADOW_TYPE_PCF1)
float getShadowSpotClusteredPCF1(SHADOWMAP_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams) {
	return textureShadow(shadowMap, shadowCoord);
}
#endif
#if defined(CLUSTER_SHADOW_TYPE_PCF3)
float getShadowSpotClusteredPCF3(SHADOWMAP_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams) {
	return getShadowSpotPCF3x3(SHADOWMAP_PASS(shadowMap), shadowCoord, shadowParams);
}
#endif
#if defined(CLUSTER_SHADOW_TYPE_PCF5)
float getShadowSpotClusteredPCF5(SHADOWMAP_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams) {
	return getShadowPCF5x5(SHADOWMAP_PASS(shadowMap), shadowCoord, shadowParams);
}
#endif
`,oye=`
#include "lightBufferDefinesPS"
#include "clusteredLightUtilsPS"
#ifdef CLUSTER_COOKIES
	#include "clusteredLightCookiesPS"
#endif
#ifdef CLUSTER_SHADOWS
	#include "clusteredLightShadowsPS"
#endif
uniform highp sampler2D clusterWorldTexture;
uniform highp sampler2D lightsTexture;
#ifdef CLUSTER_SHADOWS
	uniform sampler2DShadow shadowAtlasTexture;
#endif
#ifdef CLUSTER_COOKIES
	uniform sampler2D cookieAtlasTexture;
#endif
uniform int clusterMaxCells;
uniform float clusterSkip;
uniform vec3 clusterCellsCountByBoundsSize;
uniform vec3 clusterTextureSize;
uniform vec3 clusterBoundsMin;
uniform vec3 clusterBoundsDelta;
uniform vec3 clusterCellsDot;
uniform vec3 clusterCellsMax;
uniform vec2 shadowAtlasParams;
struct ClusterLightData {
	uint flags;
	vec3 halfWidth;
	bool isSpot;
	vec3 halfHeight;
	int lightIndex;
	vec3 position;
	uint shape;
	vec3 direction;
	bool falloffModeLinear;
	vec3 color;
	float shadowIntensity;
	vec3 omniAtlasViewport;
	float range;
	vec4 cookieChannelMask;
	float biasesData;
	float shadowBias;
	float shadowNormalBias;
	float anglesData;
	float innerConeAngleCos;
	float outerConeAngleCos;
	float cookieIntensity;
	bool isDynamic;
	bool isLightmapped;
};
mat4 lightProjectionMatrix;
vec4 sampleLightTextureF(const ClusterLightData clusterLightData, int index) {
	return texelFetch(lightsTexture, ivec2(index, clusterLightData.lightIndex), 0);
}
void decodeClusterLightCore(inout ClusterLightData clusterLightData, float lightIndex) {
	clusterLightData.lightIndex = int(lightIndex);
	vec4 halfData = sampleLightTextureF(clusterLightData, {CLUSTER_TEXTURE_COLOR_ANGLES_BIAS});
	clusterLightData.anglesData = halfData.z;
	clusterLightData.biasesData = halfData.w;
	vec2 colorRG = unpackHalf2x16(floatBitsToUint(halfData.x));
	vec2 colorB_ = unpackHalf2x16(floatBitsToUint(halfData.y));
	clusterLightData.color = vec3(colorRG, colorB_.x) * {LIGHT_COLOR_DIVIDER};
	vec4 lightPosRange = sampleLightTextureF(clusterLightData, {CLUSTER_TEXTURE_POSITION_RANGE});
	clusterLightData.position = lightPosRange.xyz;
	clusterLightData.range = lightPosRange.w;
	vec4 lightDir_Flags = sampleLightTextureF(clusterLightData, {CLUSTER_TEXTURE_DIRECTION_FLAGS});
	clusterLightData.direction = lightDir_Flags.xyz;
	clusterLightData.flags = floatBitsToUint(lightDir_Flags.w);
	clusterLightData.isSpot = (clusterLightData.flags & (1u << 30u)) != 0u;
	clusterLightData.shape = (clusterLightData.flags >> 28u) & 0x3u;
	clusterLightData.falloffModeLinear = (clusterLightData.flags & (1u << 27u)) == 0u;
	clusterLightData.shadowIntensity = float((clusterLightData.flags >> 0u) & 0xFFu) / 255.0;
	clusterLightData.cookieIntensity = float((clusterLightData.flags >> 8u) & 0xFFu) / 255.0;
	clusterLightData.isDynamic = (clusterLightData.flags & (1u << 22u)) != 0u;
	clusterLightData.isLightmapped = (clusterLightData.flags & (1u << 21u)) != 0u;
}
void decodeClusterLightSpot(inout ClusterLightData clusterLightData) {
	vec2 angles = unpackHalf2x16(floatBitsToUint(clusterLightData.anglesData));
	clusterLightData.innerConeAngleCos = angles.x;
	clusterLightData.outerConeAngleCos = angles.y;
}
void decodeClusterLightOmniAtlasViewport(inout ClusterLightData clusterLightData) {
	clusterLightData.omniAtlasViewport = sampleLightTextureF(clusterLightData, {CLUSTER_TEXTURE_PROJ_MAT_0}).xyz;
}
void decodeClusterLightAreaData(inout ClusterLightData clusterLightData) {
	clusterLightData.halfWidth = sampleLightTextureF(clusterLightData, {CLUSTER_TEXTURE_AREA_DATA_WIDTH}).xyz;
	clusterLightData.halfHeight = sampleLightTextureF(clusterLightData, {CLUSTER_TEXTURE_AREA_DATA_HEIGHT}).xyz;
}
void decodeClusterLightProjectionMatrixData(inout ClusterLightData clusterLightData) {
	
	vec4 m0 = sampleLightTextureF(clusterLightData, {CLUSTER_TEXTURE_PROJ_MAT_0});
	vec4 m1 = sampleLightTextureF(clusterLightData, {CLUSTER_TEXTURE_PROJ_MAT_1});
	vec4 m2 = sampleLightTextureF(clusterLightData, {CLUSTER_TEXTURE_PROJ_MAT_2});
	vec4 m3 = sampleLightTextureF(clusterLightData, {CLUSTER_TEXTURE_PROJ_MAT_3});
	lightProjectionMatrix = mat4(m0, m1, m2, m3);
}
void decodeClusterLightShadowData(inout ClusterLightData clusterLightData) {
	
	vec2 biases = unpackHalf2x16(floatBitsToUint(clusterLightData.biasesData));
	clusterLightData.shadowBias = biases.x;
	clusterLightData.shadowNormalBias = biases.y;
}
void decodeClusterLightCookieData(inout ClusterLightData clusterLightData) {
	uint cookieFlags = (clusterLightData.flags >> 23u) & 0x0Fu;
	clusterLightData.cookieChannelMask = vec4(uvec4(cookieFlags) & uvec4(1u, 2u, 4u, 8u));
	clusterLightData.cookieChannelMask = step(1.0, clusterLightData.cookieChannelMask);
}
void evaluateLight(
	ClusterLightData light, 
	vec3 worldNormal, 
	vec3 viewDir, 
	vec3 reflectionDir,
#if defined(LIT_CLEARCOAT)
	vec3 clearcoatReflectionDir,
#endif
	float gloss, 
	vec3 specularity, 
	vec3 geometricNormal, 
	mat3 tbn, 
#if defined(LIT_IRIDESCENCE)
	vec3 iridescenceFresnel,
#endif
	vec3 clearcoat_worldNormal,
	float clearcoat_gloss,
	float sheen_gloss,
	float iridescence_intensity
) {
	vec3 cookieAttenuation = vec3(1.0);
	float diffuseAttenuation = 1.0;
	float falloffAttenuation = 1.0;
	vec3 lightDirW = evalOmniLight(light.position);
	vec3 lightDirNormW = normalize(lightDirW);
	#ifdef CLUSTER_AREALIGHTS
	if (light.shape != {LIGHTSHAPE_PUNCTUAL}) {
		decodeClusterLightAreaData(light);
		if (light.shape == {LIGHTSHAPE_RECT}) {
			calcRectLightValues(light.position, light.halfWidth, light.halfHeight);
		} else if (light.shape == {LIGHTSHAPE_DISK}) {
			calcDiskLightValues(light.position, light.halfWidth, light.halfHeight);
		} else {
			calcSphereLightValues(light.position, light.halfWidth, light.halfHeight);
		}
		falloffAttenuation = getFalloffWindow(light.range, lightDirW);
	} else
	#endif
	{
		if (light.falloffModeLinear)
			falloffAttenuation = getFalloffLinear(light.range, lightDirW);
		else
			falloffAttenuation = getFalloffInvSquared(light.range, lightDirW);
	}
	if (falloffAttenuation > 0.00001) {
		#ifdef CLUSTER_AREALIGHTS
		if (light.shape != {LIGHTSHAPE_PUNCTUAL}) {
			if (light.shape == {LIGHTSHAPE_RECT}) {
				diffuseAttenuation = getRectLightDiffuse(worldNormal, viewDir, lightDirW, lightDirNormW) * 16.0;
			} else if (light.shape == {LIGHTSHAPE_DISK}) {
				diffuseAttenuation = getDiskLightDiffuse(worldNormal, viewDir, lightDirW, lightDirNormW) * 16.0;
			} else {
				diffuseAttenuation = getSphereLightDiffuse(worldNormal, viewDir, lightDirW, lightDirNormW) * 16.0;
			}
		} else
		#endif
		{
			falloffAttenuation *= getLightDiffuse(worldNormal, viewDir, lightDirNormW); 
		}
		if (light.isSpot) {
			decodeClusterLightSpot(light);
			falloffAttenuation *= getSpotEffect(light.direction, light.innerConeAngleCos, light.outerConeAngleCos, lightDirNormW);
		}
		#if defined(CLUSTER_COOKIES) || defined(CLUSTER_SHADOWS)
		if (falloffAttenuation > 0.00001) {
			if (light.shadowIntensity > 0.0 || light.cookieIntensity > 0.0) {
				if (light.isSpot) {
					decodeClusterLightProjectionMatrixData(light);
				} else {
					decodeClusterLightOmniAtlasViewport(light);
				}
				float shadowTextureResolution = shadowAtlasParams.x;
				float shadowEdgePixels = shadowAtlasParams.y;
				#ifdef CLUSTER_COOKIES
				if (light.cookieIntensity > 0.0) {
					decodeClusterLightCookieData(light);
					if (light.isSpot) {
						cookieAttenuation = getCookie2DClustered(TEXTURE_PASS(cookieAtlasTexture), lightProjectionMatrix, vPositionW, light.cookieIntensity, light.cookieChannelMask);
					} else {
						cookieAttenuation = getCookieCubeClustered(TEXTURE_PASS(cookieAtlasTexture), lightDirW, light.cookieIntensity, light.cookieChannelMask, shadowTextureResolution, shadowEdgePixels, light.omniAtlasViewport);
					}
				}
				#endif
				#ifdef CLUSTER_SHADOWS
				if (light.shadowIntensity > 0.0) {
					decodeClusterLightShadowData(light);
					vec4 shadowParams = vec4(shadowTextureResolution, light.shadowNormalBias, light.shadowBias, 1.0 / light.range);
					if (light.isSpot) {
						vec3 shadowCoord = getShadowCoordPerspZbufferNormalOffset(lightProjectionMatrix, shadowParams, geometricNormal);
						
						#if defined(CLUSTER_SHADOW_TYPE_PCF1)
							float shadow = getShadowSpotClusteredPCF1(SHADOWMAP_PASS(shadowAtlasTexture), shadowCoord, shadowParams);
						#elif defined(CLUSTER_SHADOW_TYPE_PCF3)
							float shadow = getShadowSpotClusteredPCF3(SHADOWMAP_PASS(shadowAtlasTexture), shadowCoord, shadowParams);
						#elif defined(CLUSTER_SHADOW_TYPE_PCF5)
							float shadow = getShadowSpotClusteredPCF5(SHADOWMAP_PASS(shadowAtlasTexture), shadowCoord, shadowParams);
						#elif defined(CLUSTER_SHADOW_TYPE_PCSS)
							float shadow = getShadowSpotClusteredPCSS(SHADOWMAP_PASS(shadowAtlasTexture), shadowCoord, shadowParams);
						#endif
						falloffAttenuation *= mix(1.0, shadow, light.shadowIntensity);
					} else {
						vec3 dir = normalOffsetPointShadow(shadowParams, light.position, lightDirW, lightDirNormW, geometricNormal);
						#if defined(CLUSTER_SHADOW_TYPE_PCF1)
							float shadow = getShadowOmniClusteredPCF1(SHADOWMAP_PASS(shadowAtlasTexture), shadowParams, light.omniAtlasViewport, shadowEdgePixels, dir);
						#elif defined(CLUSTER_SHADOW_TYPE_PCF3)
							float shadow = getShadowOmniClusteredPCF3(SHADOWMAP_PASS(shadowAtlasTexture), shadowParams, light.omniAtlasViewport, shadowEdgePixels, dir);
						#elif defined(CLUSTER_SHADOW_TYPE_PCF5)
							float shadow = getShadowOmniClusteredPCF5(SHADOWMAP_PASS(shadowAtlasTexture), shadowParams, light.omniAtlasViewport, shadowEdgePixels, dir);
						#endif
						falloffAttenuation *= mix(1.0, shadow, light.shadowIntensity);
					}
				}
				#endif
			}
		}
		#endif
		#ifdef CLUSTER_AREALIGHTS
		if (light.shape != {LIGHTSHAPE_PUNCTUAL}) {
			{
				vec3 areaDiffuse = (diffuseAttenuation * falloffAttenuation) * light.color * cookieAttenuation;
				#if defined(LIT_SPECULAR)
					areaDiffuse = mix(areaDiffuse, vec3(0), dLTCSpecFres);
				#endif
				dDiffuseLight += areaDiffuse;
			}
			#ifdef LIT_SPECULAR
				float areaLightSpecular;
				if (light.shape == {LIGHTSHAPE_RECT}) {
					areaLightSpecular = getRectLightSpecular(worldNormal, viewDir);
				} else if (light.shape == {LIGHTSHAPE_DISK}) {
					areaLightSpecular = getDiskLightSpecular(worldNormal, viewDir);
				} else {
					areaLightSpecular = getSphereLightSpecular(worldNormal, viewDir);
				}
				dSpecularLight += dLTCSpecFres * areaLightSpecular * falloffAttenuation * light.color * cookieAttenuation;
				#ifdef LIT_CLEARCOAT
					float areaLightSpecularCC;
					if (light.shape == {LIGHTSHAPE_RECT}) {
						areaLightSpecularCC = getRectLightSpecular(clearcoat_worldNormal, viewDir);
					} else if (light.shape == {LIGHTSHAPE_DISK}) {
						areaLightSpecularCC = getDiskLightSpecular(clearcoat_worldNormal, viewDir);
					} else {
						areaLightSpecularCC = getSphereLightSpecular(clearcoat_worldNormal, viewDir);
					}
					ccSpecularLight += ccLTCSpecFres * areaLightSpecularCC * falloffAttenuation * light.color  * cookieAttenuation;
				#endif
			#endif
		} else
		#endif
		{
			{
				vec3 punctualDiffuse = falloffAttenuation * light.color * cookieAttenuation;
				#if defined(CLUSTER_AREALIGHTS)
				#if defined(LIT_SPECULAR)
					punctualDiffuse = mix(punctualDiffuse, vec3(0), specularity);
				#endif
				#endif
				dDiffuseLight += punctualDiffuse;
			}
	 
			#ifdef LIT_SPECULAR
				vec3 halfDir = normalize(-lightDirNormW + viewDir);
				
				#ifdef LIT_SPECULAR_FRESNEL
					dSpecularLight += 
						getLightSpecular(halfDir, reflectionDir, worldNormal, viewDir, lightDirNormW, gloss, tbn) * falloffAttenuation * light.color * cookieAttenuation * 
						getFresnel(
							dot(viewDir, halfDir), 
							gloss, 
							specularity
						#if defined(LIT_IRIDESCENCE)
							, iridescenceFresnel,
							iridescence_intensity
						#endif
							);
				#else
					dSpecularLight += getLightSpecular(halfDir, reflectionDir, worldNormal, viewDir, lightDirNormW, gloss, tbn) * falloffAttenuation * light.color * cookieAttenuation * specularity;
				#endif
				#ifdef LIT_CLEARCOAT
					#ifdef LIT_SPECULAR_FRESNEL
						ccSpecularLight += getLightSpecular(halfDir, clearcoatReflectionDir, clearcoat_worldNormal, viewDir, lightDirNormW, clearcoat_gloss, tbn) * falloffAttenuation * light.color * cookieAttenuation * getFresnelCC(dot(viewDir, halfDir));
					#else
						ccSpecularLight += getLightSpecular(halfDir, clearcoatReflectionDir, clearcoat_worldNormal, viewDir, lightDirNormW, clearcoat_gloss, tbn) * falloffAttenuation * light.color * cookieAttenuation; 
					#endif
				#endif
				#ifdef LIT_SHEEN
					sSpecularLight += getLightSpecularSheen(halfDir, worldNormal, viewDir, lightDirNormW, sheen_gloss) * falloffAttenuation * light.color * cookieAttenuation;
				#endif
			#endif
		}
	}
	dAtten = falloffAttenuation;
	dLightDirNormW = lightDirNormW;
}
void evaluateClusterLight(
	float lightIndex, 
	vec3 worldNormal, 
	vec3 viewDir, 
	vec3 reflectionDir, 
#if defined(LIT_CLEARCOAT)
	vec3 clearcoatReflectionDir,
#endif
	float gloss, 
	vec3 specularity, 
	vec3 geometricNormal, 
	mat3 tbn, 
#if defined(LIT_IRIDESCENCE)
	vec3 iridescenceFresnel,
#endif
	vec3 clearcoat_worldNormal,
	float clearcoat_gloss,
	float sheen_gloss,
	float iridescence_intensity
) {
	ClusterLightData clusterLightData;
	decodeClusterLightCore(clusterLightData, lightIndex);
	#ifdef CLUSTER_MESH_DYNAMIC_LIGHTS
		bool acceptLightMask = clusterLightData.isDynamic;
	#else
		bool acceptLightMask = clusterLightData.isLightmapped;
	#endif
	if (acceptLightMask)
		evaluateLight(
			clusterLightData, 
			worldNormal, 
			viewDir, 
			reflectionDir, 
#if defined(LIT_CLEARCOAT)
			clearcoatReflectionDir, 
#endif
			gloss, 
			specularity, 
			geometricNormal, 
			tbn, 
#if defined(LIT_IRIDESCENCE)
			iridescenceFresnel,
#endif
			clearcoat_worldNormal,
			clearcoat_gloss,
			sheen_gloss,
			iridescence_intensity
		);
}
void addClusteredLights(
	vec3 worldNormal, 
	vec3 viewDir, 
	vec3 reflectionDir, 
#if defined(LIT_CLEARCOAT)
	vec3 clearcoatReflectionDir,
#endif
	float gloss, 
	vec3 specularity, 
	vec3 geometricNormal, 
	mat3 tbn, 
#if defined(LIT_IRIDESCENCE)
	vec3 iridescenceFresnel,
#endif
	vec3 clearcoat_worldNormal,
	float clearcoat_gloss,
	float sheen_gloss,
	float iridescence_intensity
) {
	if (clusterSkip > 0.5)
		return;
	vec3 cellCoords = floor((vPositionW - clusterBoundsMin) * clusterCellsCountByBoundsSize);
	if (!(any(lessThan(cellCoords, vec3(0.0))) || any(greaterThanEqual(cellCoords, clusterCellsMax)))) {
		float cellIndex = dot(clusterCellsDot, cellCoords);
		float clusterV = floor(cellIndex * clusterTextureSize.y);
		float clusterU = cellIndex - (clusterV * clusterTextureSize.x);
		for (int lightCellIndex = 0; lightCellIndex < clusterMaxCells; lightCellIndex++) {
			float lightIndex = texelFetch(clusterWorldTexture, ivec2(int(clusterU) + lightCellIndex, clusterV), 0).x;
			if (lightIndex <= 0.0)
				break;
			evaluateClusterLight(
				lightIndex * 255.0, 
				worldNormal, 
				viewDir, 
				reflectionDir,
#if defined(LIT_CLEARCOAT)
				clearcoatReflectionDir,
#endif
				gloss, 
				specularity, 
				geometricNormal, 
				tbn, 
#if defined(LIT_IRIDESCENCE)
				iridescenceFresnel,
#endif
				clearcoat_worldNormal,
				clearcoat_gloss,
				sheen_gloss,
				iridescence_intensity
			); 
		}
	}
}
`,lye=`
vec3 combineColor(vec3 albedo, vec3 sheenSpecularity, float clearcoatSpecularity) {
	vec3 ret = vec3(0);
#ifdef LIT_OLD_AMBIENT
	ret += (dDiffuseLight - light_globalAmbient) * albedo + material_ambient * light_globalAmbient;
#else
	ret += albedo * dDiffuseLight;
#endif
#ifdef LIT_SPECULAR
	ret += dSpecularLight;
#endif
#ifdef LIT_REFLECTIONS
	ret += dReflection.rgb * dReflection.a;
#endif
#ifdef LIT_SHEEN
	float sheenScaling = 1.0 - max(max(sheenSpecularity.r, sheenSpecularity.g), sheenSpecularity.b) * 0.157;
	ret = ret * sheenScaling + (sSpecularLight + sReflection.rgb) * sheenSpecularity;
#endif
#ifdef LIT_CLEARCOAT
	float clearCoatScaling = 1.0 - ccFresnel * clearcoatSpecularity;
	ret = ret * clearCoatScaling + (ccSpecularLight + ccReflection) * clearcoatSpecularity;
#endif
	return ret;
}
`,cye=`
	varying vec2 uv0;
	uniform sampler2D blitTexture;
	void main(void) {
		gl_FragColor = texture2D(blitTexture, uv0);
	}
`,uye=`
	varying vec2 uv0;
	uniform samplerCube blitTexture;
	uniform mat4 invViewProj;
	void main(void) {
		vec4 projPos = vec4(uv0 * 2.0 - 1.0, 0.5, 1.0);
		vec4 worldPos = invViewProj * projPos;
		gl_FragColor = textureCube(blitTexture, worldPos.xyz);
	}
`,hye=`
	attribute vec2 vertex_position;
	varying vec2 uv0;
	void main(void) {
		gl_Position = vec4(vertex_position, 0.5, 1.0);
		uv0 = vertex_position.xy * 0.5 + 0.5;
		#ifndef WEBGPU
			uv0.y = 1.0 - uv0.y;
		#endif
	}
`,dye=`
vec4 getCookie2D(sampler2D tex, mat4 transform, float intensity) {
	vec4 projPos = transform * vec4(vPositionW, 1.0);
	projPos.xy /= projPos.w;
	return mix(vec4(1.0), texture2D(tex, projPos.xy), intensity);
}
vec4 getCookie2DClip(sampler2D tex, mat4 transform, float intensity) {
	vec4 projPos = transform * vec4(vPositionW, 1.0);
	projPos.xy /= projPos.w;
	if (projPos.x < 0.0 || projPos.x > 1.0 || projPos.y < 0.0 || projPos.y > 1.0 || projPos.z < 0.0) return vec4(0.0);
	return mix(vec4(1.0), texture2D(tex, projPos.xy), intensity);
}
vec4 getCookie2DXform(sampler2D tex, mat4 transform, float intensity, vec4 cookieMatrix, vec2 cookieOffset) {
	vec4 projPos = transform * vec4(vPositionW, 1.0);
	projPos.xy /= projPos.w;
	projPos.xy += cookieOffset;
	vec2 uv = mat2(cookieMatrix) * (projPos.xy-vec2(0.5)) + vec2(0.5);
	return mix(vec4(1.0), texture2D(tex, uv), intensity);
}
vec4 getCookie2DClipXform(sampler2D tex, mat4 transform, float intensity, vec4 cookieMatrix, vec2 cookieOffset) {
	vec4 projPos = transform * vec4(vPositionW, 1.0);
	projPos.xy /= projPos.w;
	projPos.xy += cookieOffset;
	if (projPos.x < 0.0 || projPos.x > 1.0 || projPos.y < 0.0 || projPos.y > 1.0 || projPos.z < 0.0) return vec4(0.0);
	vec2 uv = mat2(cookieMatrix) * (projPos.xy-vec2(0.5)) + vec2(0.5);
	return mix(vec4(1.0), texture2D(tex, uv), intensity);
}
vec4 getCookieCube(samplerCube tex, mat4 transform, float intensity) {
	return mix(vec4(1.0), textureCube(tex, dLightDirNormW * mat3(transform)), intensity);
}
`,fye=`
#if LIT_CUBEMAP_PROJECTION == BOX
	uniform vec3 envBoxMin;
	uniform vec3 envBoxMax;
#endif
vec3 cubeMapProject(vec3 nrdir) {
	#if LIT_CUBEMAP_PROJECTION == NONE
		return cubeMapRotate(nrdir);
	#endif
	#if LIT_CUBEMAP_PROJECTION == BOX
		nrdir = cubeMapRotate(nrdir);
		vec3 rbmax = (envBoxMax - vPositionW) / nrdir;
		vec3 rbmin = (envBoxMin - vPositionW) / nrdir;
		vec3 rbminmax = mix(rbmin, rbmax, vec3(greaterThan(nrdir, vec3(0.0))));
		float fa = min(min(rbminmax.x, rbminmax.y), rbminmax.z);
		vec3 posonbox = vPositionW + nrdir * fa;
		vec3 envBoxPos = (envBoxMin + envBoxMax) * 0.5;
		return normalize(posonbox - envBoxPos);
	#endif
}
`,pye=`
#ifdef CUBEMAP_ROTATION
uniform mat3 cubeMapRotationMatrix;
#endif
vec3 cubeMapRotate(vec3 refDir) {
#ifdef CUBEMAP_ROTATION
	return refDir * cubeMapRotationMatrix;
#else
	return refDir;
#endif
}
`,mye=`
#ifdef DEBUG_ALBEDO_PASS
gl_FragColor = vec4(gammaCorrectOutput(dAlbedo), 1.0);
#endif
#ifdef DEBUG_UV0_PASS
gl_FragColor = vec4(litArgs_albedo , 1.0);
#endif
#ifdef DEBUG_WORLD_NORMAL_PASS
gl_FragColor = vec4(litArgs_worldNormal * 0.5 + 0.5, 1.0);
#endif
#ifdef DEBUG_OPACITY_PASS
gl_FragColor = vec4(vec3(litArgs_opacity) , 1.0);
#endif
#ifdef DEBUG_SPECULARITY_PASS
gl_FragColor = vec4(litArgs_specularity, 1.0);
#endif
#ifdef DEBUG_GLOSS_PASS
gl_FragColor = vec4(vec3(litArgs_gloss) , 1.0);
#endif
#ifdef DEBUG_METALNESS_PASS
gl_FragColor = vec4(vec3(litArgs_metalness) , 1.0);
#endif
#ifdef DEBUG_AO_PASS
gl_FragColor = vec4(vec3(litArgs_ao) , 1.0);
#endif
#ifdef DEBUG_EMISSION_PASS
gl_FragColor = vec4(gammaCorrectOutput(litArgs_emission), 1.0);
#endif
`,gye=`
#ifdef DEBUG_LIGHTING_PASS
litArgs_albedo = vec3(0.5);
#endif
#ifdef DEBUG_UV0_PASS
#ifdef VARYING_VUV0
litArgs_albedo = vec3(vUv0, 0);
#else
litArgs_albedo = vec3(0);
#endif
#endif
`,_ye=`
#ifndef _DECODE_INCLUDED_
#define _DECODE_INCLUDED_
vec3 decodeLinear(vec4 raw) {
	return raw.rgb;
}
float decodeGamma(float raw) {
	return pow(raw, 2.2);
}
vec3 decodeGamma(vec3 raw) {
	return pow(raw, vec3(2.2));
}
vec3 decodeGamma(vec4 raw) {
	return pow(raw.xyz, vec3(2.2));
}
vec3 decodeRGBM(vec4 raw) {
	vec3 color = (8.0 * raw.a) * raw.rgb;
	return color * color;
}
vec3 decodeRGBP(vec4 raw) {
	vec3 color = raw.rgb * (-raw.a * 7.0 + 8.0);
	return color * color;
}
vec3 decodeRGBE(vec4 raw) {
	if (raw.a == 0.0) {
		return vec3(0.0, 0.0, 0.0);
	} else {
		return raw.xyz * pow(2.0, raw.w * 255.0 - 128.0);
	}
}
vec4 passThrough(vec4 raw) {
	return raw;
}
vec3 unpackNormalXYZ(vec4 nmap) {
	return nmap.xyz * 2.0 - 1.0;
}
vec3 unpackNormalXY(vec4 nmap) {
	vec3 normal;
	normal.xy = nmap.wy * 2.0 - 1.0;
	normal.z = sqrt(1.0 - clamp(dot(normal.xy, normal.xy), 0.0, 1.0));
	return normal;
}
#endif
`,vye=`
#ifndef _DETAILMODES_INCLUDED_
#define _DETAILMODES_INCLUDED_
vec3 detailMode_mul(vec3 c1, vec3 c2) {
	return c1 * c2;
}
vec3 detailMode_add(vec3 c1, vec3 c2) {
	return c1 + c2;
}
vec3 detailMode_screen(vec3 c1, vec3 c2) {
	return 1.0 - (1.0 - c1)*(1.0 - c2);
}
vec3 detailMode_overlay(vec3 c1, vec3 c2) {
	return mix(1.0 - 2.0 * (1.0 - c1)*(1.0 - c2), 2.0 * c1 * c2, step(c1, vec3(0.5)));
}
vec3 detailMode_min(vec3 c1, vec3 c2) {
	return min(c1, c2);
}
vec3 detailMode_max(vec3 c1, vec3 c2) {
	return max(c1, c2);
}
#endif
`,yye=`
uniform vec3 material_diffuse;
#ifdef STD_DIFFUSEDETAIL_TEXTURE
	#include "detailModesPS"
#endif
void getAlbedo() {
	dAlbedo = material_diffuse.rgb;
	#ifdef STD_DIFFUSE_TEXTURE
		vec3 albedoTexture = {STD_DIFFUSE_TEXTURE_DECODE}(texture2DBias({STD_DIFFUSE_TEXTURE_NAME}, {STD_DIFFUSE_TEXTURE_UV}, textureBias)).{STD_DIFFUSE_TEXTURE_CHANNEL};
		#ifdef STD_DIFFUSEDETAIL_TEXTURE
			vec3 albedoDetail = {STD_DIFFUSEDETAIL_TEXTURE_DECODE}(texture2DBias({STD_DIFFUSEDETAIL_TEXTURE_NAME}, {STD_DIFFUSEDETAIL_TEXTURE_UV}, textureBias)).{STD_DIFFUSEDETAIL_TEXTURE_CHANNEL};
			albedoTexture = detailMode_{STD_DIFFUSEDETAIL_DETAILMODE}(albedoTexture, albedoDetail);
		#endif
		dAlbedo *= albedoTexture;
	#endif
	#ifdef STD_DIFFUSE_VERTEX
		dAlbedo *= gammaCorrectInput(saturate(vVertexColor.{STD_DIFFUSE_VERTEX_CHANNEL}));
	#endif
}
`,Sye=`
uniform vec3 material_emissive;
uniform float material_emissiveIntensity;
void getEmission() {
	dEmission = material_emissive * material_emissiveIntensity;
	#ifdef STD_EMISSIVE_TEXTURE
	dEmission *= {STD_EMISSIVE_TEXTURE_DECODE}(texture2DBias({STD_EMISSIVE_TEXTURE_NAME}, {STD_EMISSIVE_TEXTURE_UV}, textureBias)).{STD_EMISSIVE_TEXTURE_CHANNEL};
	#endif
	#ifdef STD_EMISSIVE_VERTEX
	dEmission *= gammaCorrectInput(saturate(vVertexColor.{STD_EMISSIVE_VERTEX_CHANNEL}));
	#endif
}
`,xye=`
vec4 encodeLinear(vec3 source) {
	return vec4(source, 1.0);
}
vec4 encodeGamma(vec3 source) {
	return vec4(pow(source + 0.0000001, vec3(1.0 / 2.2)), 1.0);
}
vec4 encodeRGBM(vec3 source) {
	vec4 result;
	result.rgb = pow(source.rgb, vec3(0.5));
	result.rgb *= 1.0 / 8.0;
	result.a = saturate( max( max( result.r, result.g ), max( result.b, 1.0 / 255.0 ) ) );
	result.a = ceil(result.a * 255.0) / 255.0;
	result.rgb /= result.a;
	return result;
}
vec4 encodeRGBP(vec3 source) {
	vec3 gamma = pow(source, vec3(0.5));
	float maxVal = min(8.0, max(1.0, max(gamma.x, max(gamma.y, gamma.z))));
	float v = 1.0 - ((maxVal - 1.0) / 7.0);
	v = ceil(v * 255.0) / 255.0;
	return vec4(gamma / (-v * 7.0 + 8.0), v);	
}
vec4 encodeRGBE(vec3 source) {
	float maxVal = max(source.x, max(source.y, source.z));
	if (maxVal < 1e-32) {
		return vec4(0, 0, 0, 0);
	} else {
		float e = ceil(log2(maxVal));
		return vec4(source / pow(2.0, e), (e + 128.0) / 255.0);
	}
}
`,bye=`
	gl_FragColor.rgb = combineColor(litArgs_albedo, litArgs_sheen_specularity, litArgs_clearcoat_specularity);
	gl_FragColor.rgb += litArgs_emission;
	gl_FragColor.rgb = addFog(gl_FragColor.rgb);
	gl_FragColor.rgb = toneMap(gl_FragColor.rgb);
	gl_FragColor.rgb = gammaCorrectOutput(gl_FragColor.rgb);
`,wye=`
#ifndef _ENVATLAS_INCLUDED_
#define _ENVATLAS_INCLUDED_
const float atlasSize = 512.0;
const float seamSize = 1.0 / atlasSize;
vec2 mapUv(vec2 uv, vec4 rect) {
	return vec2(mix(rect.x + seamSize, rect.x + rect.z - seamSize, uv.x),
				mix(rect.y + seamSize, rect.y + rect.w - seamSize, uv.y));
}
vec2 mapRoughnessUv(vec2 uv, float level) {
	float t = 1.0 / exp2(level);
	return mapUv(uv, vec4(0, 1.0 - t, t, t * 0.5));
}
vec2 mapShinyUv(vec2 uv, float level) {
	float t = 1.0 / exp2(level);
	return mapUv(uv, vec4(1.0 - t, 1.0 - t, t, t * 0.5));
}
#endif
`,Tye=`
#ifdef LIT_SKYBOX_INTENSITY
	uniform float skyboxIntensity;
#endif
vec3 processEnvironment(vec3 color) {
	#ifdef LIT_SKYBOX_INTENSITY
		return color * skyboxIntensity;
	#else
		return color;
	#endif
}
`,Eye=`
float getFalloffWindow(float lightRadius, vec3 lightDir) {
	float sqrDist = dot(lightDir, lightDir);
	float invRadius = 1.0 / lightRadius;
	return square(saturate(1.0 - square(sqrDist * square(invRadius))));
}
float getFalloffInvSquared(float lightRadius, vec3 lightDir) {
	float sqrDist = dot(lightDir, lightDir);
	float falloff = 1.0 / (sqrDist + 1.0);
	float invRadius = 1.0 / lightRadius;
	falloff *= 16.0;
	falloff *= square(saturate(1.0 - square(sqrDist * square(invRadius))));
	return falloff;
}
`,Aye=`
float getFalloffLinear(float lightRadius, vec3 lightDir) {
	float d = length(lightDir);
	return max(((lightRadius - d) / lightRadius), 0.0);
}
`,Cye=`
#ifndef FLOAT_AS_UINT
#define FLOAT_AS_UINT
vec4 float2uint(float value) {
	uint intBits = floatBitsToUint(value);
	return vec4(
		float((intBits >> 24u) & 0xFFu) / 255.0,
		float((intBits >> 16u) & 0xFFu) / 255.0,
		float((intBits >> 8u) & 0xFFu) / 255.0,
		float(intBits & 0xFFu) / 255.0
	);
}
float uint2float(vec4 value) {
	uint intBits = 
		(uint(value.r * 255.0) << 24u) |
		(uint(value.g * 255.0) << 16u) |
		(uint(value.b * 255.0) << 8u) |
		uint(value.a * 255.0);
	return uintBitsToFloat(intBits);
}
vec4 float2vec4(float value) {
	#if defined(CAPS_TEXTURE_FLOAT_RENDERABLE)
		return vec4(value, 1.0, 1.0, 1.0);
	#else
		return float2uint(value);
	#endif
}
#endif
`,Pye=`
float dBlendModeFogFactor = 1.0;
#if (FOG != NONE)
	uniform vec3 fog_color;
	#if (FOG == LINEAR)
		uniform float fog_start;
		uniform float fog_end;
	#else
		uniform float fog_density;
	#endif
#endif
float getFogFactor() {
	float depth = gl_FragCoord.z / gl_FragCoord.w;
	float fogFactor = 0.0;
	#if (FOG == LINEAR)
		fogFactor = (fog_end - depth) / (fog_end - fog_start);
	#elif (FOG == EXP)
		fogFactor = exp(-depth * fog_density);
	#elif (FOG == EXP2)
		fogFactor = exp(-depth * depth * fog_density * fog_density);
	#endif
	return clamp(fogFactor, 0.0, 1.0);
}
vec3 addFog(vec3 color) {
	#if (FOG != NONE)
		return mix(fog_color * dBlendModeFogFactor, color, getFogFactor());
	#endif
	return color;
}
`,Iye=`
vec3 getFresnel(
		float cosTheta, 
		float gloss, 
		vec3 specularity
#if defined(LIT_IRIDESCENCE)
		, vec3 iridescenceFresnel, 
		float iridescenceIntensity
#endif
	) {
	float fresnel = pow(1.0 - saturate(cosTheta), 5.0);
	float glossSq = gloss * gloss;
	vec3 ret = specularity + (max(vec3(glossSq), specularity) - specularity) * fresnel;
#if defined(LIT_IRIDESCENCE)
	return mix(ret, iridescenceFresnel, iridescenceIntensity);
#else
	return ret;
#endif	
}
float getFresnelCC(float cosTheta) {
	float fresnel = pow(1.0 - saturate(cosTheta), 5.0);
	return 0.04 + (1.0 - 0.04) * fresnel;
}
`,Mye=`
attribute vec2 vertex_position;
varying vec2 vUv0;
void main(void)
{
	gl_Position = vec4(vertex_position, 0.5, 1.0);
	vUv0 = vertex_position.xy * 0.5 + 0.5;
}
`,Rye=`
#include "decodePS"
#if (GAMMA == SRGB)
	float gammaCorrectInput(float color) {
		return decodeGamma(color);
	}
	vec3 gammaCorrectInput(vec3 color) {
		return decodeGamma(color);
	}
	vec4 gammaCorrectInput(vec4 color) {
		return vec4(decodeGamma(color.xyz), color.w);
	}
	vec3 gammaCorrectOutput(vec3 color) {
		return pow(color + 0.0000001, vec3(1.0 / 2.2));
	}
#else
	float gammaCorrectInput(float color) {
		return color;
	}
	vec3 gammaCorrectInput(vec3 color) {
		return color;
	}
	vec4 gammaCorrectInput(vec4 color) {
		return color;
	}
	vec3 gammaCorrectOutput(vec3 color) {
		return color;
	}
#endif
`,Dye=`
#ifdef STD_GLOSS_CONSTANT
uniform float material_gloss;
#endif
void getGlossiness() {
	dGlossiness = 1.0;
	#ifdef STD_GLOSS_CONSTANT
	dGlossiness *= material_gloss;
	#endif
	#ifdef STD_GLOSS_TEXTURE
	dGlossiness *= texture2DBias({STD_GLOSS_TEXTURE_NAME}, {STD_GLOSS_TEXTURE_UV}, textureBias).{STD_GLOSS_TEXTURE_CHANNEL};
	#endif
	#ifdef STD_GLOSS_VERTEX
	dGlossiness *= saturate(vVertexColor.{STD_GLOSS_VERTEX_CHANNEL});
	#endif
	#ifdef STD_GLOSS_INVERT
	dGlossiness = 1.0 - dGlossiness;
	#endif
	dGlossiness += 0.0000001;
}
`,Lye=`
uniform mat4 matrix_model;
uniform mat4 matrix_view;
uniform mat4 matrix_projection;
bool initCenter(vec3 modelCenter, out SplatCenter center) {
	mat4 modelView = matrix_view * matrix_model;
	vec4 centerView = modelView * vec4(modelCenter, 1.0);
	if (centerView.z > 0.0) {
		return false;
	}
	vec4 centerProj = matrix_projection * centerView;
	#if WEBGPU
		centerProj.z = clamp(centerProj.z, 0, abs(centerProj.w));
	#else
		centerProj.z = clamp(centerProj.z, -abs(centerProj.w), abs(centerProj.w));
	#endif
	center.view = centerView.xyz / centerView.w;
	center.proj = centerProj;
	center.projMat00 = matrix_projection[0][0];
	center.modelView = modelView;
	return true;
}
`,Oye=`
uniform mediump sampler2D splatColor;
vec4 readColor(in SplatSource source) {
	return texelFetch(splatColor, source.uv, 0);
}
`,Nye=`
struct SplatSource {
	uint order;
	uint id;
	ivec2 uv;
	vec2 cornerUV;
};
struct SplatCenter {
	vec3 view;
	vec4 proj;
	mat4 modelView;
	float projMat00;
};
struct SplatCorner {
	vec2 offset;
	vec2 uv;
	#if GSPLAT_AA
		float aaFactor;
	#endif
	vec2 v;
	float dlen;
};
#include "gsplatEvalSHVS"
#include "gsplatQuatToMat3VS"
#if GSPLAT_COMPRESSED_DATA == true
	#include "gsplatCompressedDataVS"
	#if SH_COEFFS > 0
		#include "gsplatCompressedSHVS"
	#endif
#elif GSPLAT_SOGS_DATA == true
	#include "gsplatSogsDataVS"
	#include "gsplatSogsColorVS"
	#if SH_COEFFS > 0
		#include "gsplatSogsSHVS"
	#endif
#else
	#include "gsplatDataVS"
	#include "gsplatColorVS"
	#if SH_COEFFS > 0
		#include "gsplatSHVS"
	#endif
#endif
#include "gsplatSourceVS"
#include "gsplatCenterVS"
#include "gsplatCornerVS"
#include "gsplatOutputVS"
void clipCorner(inout SplatCorner corner, float alpha) {
	float clip = min(1.0, sqrt(-log(1.0 / 255.0 / alpha)) / 2.0);
	corner.offset *= clip;
	corner.uv *= clip;
}
`,kye=`
uniform highp usampler2D packedTexture;
uniform highp sampler2D chunkTexture;
vec4 chunkDataA;
vec4 chunkDataB;
vec4 chunkDataC;
vec4 chunkDataD;
vec4 chunkDataE;
uvec4 packedData;
vec3 unpack111011(uint bits) {
	return vec3(
		float(bits >> 21u) / 2047.0,
		float((bits >> 11u) & 0x3ffu) / 1023.0,
		float(bits & 0x7ffu) / 2047.0
	);
}
vec4 unpack8888(uint bits) {
	return vec4(
		float(bits >> 24u) / 255.0,
		float((bits >> 16u) & 0xffu) / 255.0,
		float((bits >> 8u) & 0xffu) / 255.0,
		float(bits & 0xffu) / 255.0
	);
}
const float norm = 1.0 / (sqrt(2.0) * 0.5);
vec4 unpackRotation(uint bits) {
	float a = (float((bits >> 20u) & 0x3ffu) / 1023.0 - 0.5) * norm;
	float b = (float((bits >> 10u) & 0x3ffu) / 1023.0 - 0.5) * norm;
	float c = (float(bits & 0x3ffu) / 1023.0 - 0.5) * norm;
	float m = sqrt(1.0 - (a * a + b * b + c * c));
	uint mode = bits >> 30u;
	if (mode == 0u) return vec4(m, a, b, c);
	if (mode == 1u) return vec4(a, m, b, c);
	if (mode == 2u) return vec4(a, b, m, c);
	return vec4(a, b, c, m);
}
vec3 readCenter(SplatSource source) {
	uint w = uint(textureSize(chunkTexture, 0).x) / 5u;
	uint chunkId = source.id / 256u;
	ivec2 chunkUV = ivec2((chunkId % w) * 5u, chunkId / w);
	chunkDataA = texelFetch(chunkTexture, chunkUV, 0);
	chunkDataB = texelFetch(chunkTexture, chunkUV + ivec2(1, 0), 0);
	chunkDataC = texelFetch(chunkTexture, chunkUV + ivec2(2, 0), 0);
	chunkDataD = texelFetch(chunkTexture, chunkUV + ivec2(3, 0), 0);
	chunkDataE = texelFetch(chunkTexture, chunkUV + ivec2(4, 0), 0);
	packedData = texelFetch(packedTexture, source.uv, 0);
	return mix(chunkDataA.xyz, vec3(chunkDataA.w, chunkDataB.xy), unpack111011(packedData.x));
}
vec4 readColor(in SplatSource source) {
	vec4 r = unpack8888(packedData.w);
	return vec4(mix(chunkDataD.xyz, vec3(chunkDataD.w, chunkDataE.xy), r.rgb), r.w);
}
vec4 getRotation() {
	return unpackRotation(packedData.y);
}
vec3 getScale() {
	return exp(mix(vec3(chunkDataB.zw, chunkDataC.x), chunkDataC.yzw, unpack111011(packedData.z)));
}
void readCovariance(in SplatSource source, out vec3 covA, out vec3 covB) {
	mat3 rot = quatToMat3(getRotation());
	vec3 scale = getScale();
	mat3 M = transpose(mat3(
		scale.x * rot[0],
		scale.y * rot[1],
		scale.z * rot[2]
	));
	covA = vec3(dot(M[0], M[0]), dot(M[0], M[1]), dot(M[0], M[2]));
	covB = vec3(dot(M[1], M[1]), dot(M[1], M[2]), dot(M[2], M[2]));
}
`,Fye=`
#if SH_BANDS > 0
uniform highp usampler2D shTexture0;
uniform highp usampler2D shTexture1;
uniform highp usampler2D shTexture2;
vec4 unpack8888s(in uint bits) {
	return vec4((uvec4(bits) >> uvec4(0u, 8u, 16u, 24u)) & 0xffu) * (8.0 / 255.0) - 4.0;
}
void readSHData(in SplatSource source, out vec3 sh[15], out float scale) {
	uvec4 shData0 = texelFetch(shTexture0, source.uv, 0);
	uvec4 shData1 = texelFetch(shTexture1, source.uv, 0);
	uvec4 shData2 = texelFetch(shTexture2, source.uv, 0);
	vec4 r0 = unpack8888s(shData0.x);
	vec4 r1 = unpack8888s(shData0.y);
	vec4 r2 = unpack8888s(shData0.z);
	vec4 r3 = unpack8888s(shData0.w);
	vec4 g0 = unpack8888s(shData1.x);
	vec4 g1 = unpack8888s(shData1.y);
	vec4 g2 = unpack8888s(shData1.z);
	vec4 g3 = unpack8888s(shData1.w);
	vec4 b0 = unpack8888s(shData2.x);
	vec4 b1 = unpack8888s(shData2.y);
	vec4 b2 = unpack8888s(shData2.z);
	vec4 b3 = unpack8888s(shData2.w);
	sh[0] =  vec3(r0.x, g0.x, b0.x);
	sh[1] =  vec3(r0.y, g0.y, b0.y);
	sh[2] =  vec3(r0.z, g0.z, b0.z);
	sh[3] =  vec3(r0.w, g0.w, b0.w);
	sh[4] =  vec3(r1.x, g1.x, b1.x);
	sh[5] =  vec3(r1.y, g1.y, b1.y);
	sh[6] =  vec3(r1.z, g1.z, b1.z);
	sh[7] =  vec3(r1.w, g1.w, b1.w);
	sh[8] =  vec3(r2.x, g2.x, b2.x);
	sh[9] =  vec3(r2.y, g2.y, b2.y);
	sh[10] = vec3(r2.z, g2.z, b2.z);
	sh[11] = vec3(r2.w, g2.w, b2.w);
	sh[12] = vec3(r3.x, g3.x, b3.x);
	sh[13] = vec3(r3.y, g3.y, b3.y);
	sh[14] = vec3(r3.z, g3.z, b3.z);
	scale = 1.0;
}
#endif
`,Bye=`
	#if SH_BANDS == 1
		#define SH_COEFFS 3
	#elif SH_BANDS == 2
		#define SH_COEFFS 8
	#elif SH_BANDS == 3
		#define SH_COEFFS 15
	#else
		#define SH_COEFFS 0
	#endif
	#if SH_BANDS > 0
	const float SH_C1 = 0.4886025119029199f;
	#if SH_BANDS > 1
		const float SH_C2_0 = 1.0925484305920792f;
		const float SH_C2_1 = -1.0925484305920792f;
		const float SH_C2_2 = 0.31539156525252005f;
		const float SH_C2_3 = -1.0925484305920792f;
		const float SH_C2_4 = 0.5462742152960396f;
	#endif
	#if SH_BANDS > 2
		const float SH_C3_0 = -0.5900435899266435f;
		const float SH_C3_1 = 2.890611442640554f;
		const float SH_C3_2 = -0.4570457994644658f;
		const float SH_C3_3 = 0.3731763325901154f;
		const float SH_C3_4 = -0.4570457994644658f;
		const float SH_C3_5 = 1.445305721320277f;
		const float SH_C3_6 = -0.5900435899266435f;
	#endif
	vec3 evalSH(in vec3 sh[SH_COEFFS], in vec3 dir) {
		float x = dir.x;
		float y = dir.y;
		float z = dir.z;
		vec3 result = SH_C1 * (-sh[0] * y + sh[1] * z - sh[2] * x);
		#if SH_BANDS > 1
			float xx = x * x;
			float yy = y * y;
			float zz = z * z;
			float xy = x * y;
			float yz = y * z;
			float xz = x * z;
			result +=
				sh[3] * (SH_C2_0 * xy) +
				sh[4] * (SH_C2_1 * yz) +
				sh[5] * (SH_C2_2 * (2.0 * zz - xx - yy)) +
				sh[6] * (SH_C2_3 * xz) +
				sh[7] * (SH_C2_4 * (xx - yy));
		#endif
		#if SH_BANDS > 2
			result +=
				sh[8]  * (SH_C3_0 * y * (3.0 * xx - yy)) +
				sh[9]  * (SH_C3_1 * xy * z) +
				sh[10] * (SH_C3_2 * y * (4.0 * zz - xx - yy)) +
				sh[11] * (SH_C3_3 * z * (2.0 * zz - 3.0 * xx - 3.0 * yy)) +
				sh[12] * (SH_C3_4 * x * (4.0 * zz - xx - yy)) +
				sh[13] * (SH_C3_5 * z * (xx - yy)) +
				sh[14] * (SH_C3_6 * x * (xx - 3.0 * yy));
		#endif
		return result;
	}
	#endif
`,Uye=`
mat3 quatToMat3(vec4 R) {
	vec4 R2 = R + R;
	float X = R2.x * R.w;
	vec4 Y  = R2.y * R;
	vec4 Z  = R2.z * R;
	float W = R2.w * R.w;
	return mat3(
		1.0 - Z.z - W,
			  Y.z + X,
			  Y.w - Z.x,
			  Y.z - X,
		1.0 - Y.y - W,
			  Z.w + Y.x,
			  Y.w + Z.x,
			  Z.w - Y.x,
		1.0 - Y.y - Z.z
	);
}
`,zye=`
uniform mediump sampler2D sh0;
uniform vec4 sh0_mins;
uniform vec4 sh0_maxs;
float SH_C0 = 0.28209479177387814;
vec4 readColor(in SplatSource source) {
	vec4 clr = mix(sh0_mins, sh0_maxs, texelFetch(sh0, source.uv, 0));
	return vec4(vec3(0.5) + clr.xyz * SH_C0, 1.0 / (1.0 + exp(-clr.w)));
}
`,Vye=`
uniform highp sampler2D means_u;
uniform highp sampler2D means_l;
uniform highp sampler2D quats;
uniform highp sampler2D scales;
uniform vec3 means_mins;
uniform vec3 means_maxs;
uniform vec3 scales_mins;
uniform vec3 scales_maxs;
vec3 readCenter(SplatSource source) {
	vec3 u = texelFetch(means_u, source.uv, 0).xyz;
	vec3 l = texelFetch(means_l, source.uv, 0).xyz;
	vec3 n = (l * 255.0 + u * 255.0 * 256.0) / 65535.0;
	vec3 v = mix(means_mins, means_maxs, n);
	return sign(v) * (exp(abs(v)) - 1.0);
}
const float norm = 2.0 / sqrt(2.0);
void readCovariance(in SplatSource source, out vec3 covA, out vec3 covB) {
	vec4 qdata = texelFetch(quats, source.uv, 0);
	vec3 abc = (qdata.xyz - 0.5) * norm;
	float d = sqrt(max(0.0, 1.0 - dot(abc, abc)));
	uint mode = uint(qdata.w * 255.0 + 0.5) - 252u;
	vec4 quat = (mode == 0u) ? vec4(d, abc) :
				((mode == 1u) ? vec4(abc.x, d, abc.yz) :
				((mode == 2u) ? vec4(abc.xy, d, abc.z) : vec4(abc, d)));
	mat3 rot = quatToMat3(quat);
	vec3 scale = exp(mix(scales_mins, scales_maxs, texelFetch(scales, source.uv, 0).xyz));
	mat3 M = transpose(mat3(
		scale.x * rot[0],
		scale.y * rot[1],
		scale.z * rot[2]
	));
	covA = vec3(dot(M[0], M[0]), dot(M[0], M[1]), dot(M[0], M[2]));
	covB = vec3(dot(M[1], M[1]), dot(M[1], M[2]), dot(M[2], M[2]));
}
`,jye=`
uniform highp sampler2D sh_labels;
uniform highp sampler2D sh_centroids;
uniform float shN_mins;
uniform float shN_maxs;
void readSHData(in SplatSource source, out vec3 sh[SH_COEFFS], out float scale) {
	ivec2 t = ivec2(texelFetch(sh_labels, source.uv, 0).xy * 255.0);
	int n = t.x + t.y * 256;
	int u = (n % 64) * SH_COEFFS;
	int v = n / 64;
	for (int i = 0; i < SH_COEFFS; i++) {
		sh[i] = mix(vec3(shN_mins), vec3(shN_maxs), texelFetch(sh_centroids, ivec2(u + i, v), 0).xyz);
	}
	scale = 1.0;
}
`,$ye=`
uniform vec2 viewport;
uniform vec4 camera_params;
bool initCorner(SplatSource source, SplatCenter center, out SplatCorner corner) {
	vec3 covA, covB;
	readCovariance(source, covA, covB);
	mat3 Vrk = mat3(
		covA.x, covA.y, covA.z, 
		covA.y, covB.x, covB.y,
		covA.z, covB.y, covB.z
	);
	float focal = viewport.x * center.projMat00;
	vec3 v = camera_params.w == 1.0 ? vec3(0.0, 0.0, 1.0) : center.view.xyz;
	float J1 = focal / v.z;
	vec2 J2 = -J1 / v.z * v.xy;
	mat3 J = mat3(
		J1, 0.0, J2.x, 
		0.0, J1, J2.y, 
		0.0, 0.0, 0.0
	);
	mat3 W = transpose(mat3(center.modelView));
	mat3 T = W * J;
	mat3 cov = transpose(T) * Vrk * T;
	#if GSPLAT_AA
		float detOrig = cov[0][0] * cov[1][1] - cov[0][1] * cov[0][1];
		float detBlur = (cov[0][0] + 0.3) * (cov[1][1] + 0.3) - cov[0][1] * cov[0][1];
		corner.aaFactor = sqrt(max(detOrig / detBlur, 0.0));
	#endif
	float diagonal1 = cov[0][0] + 0.3;
	float offDiagonal = cov[0][1];
	float diagonal2 = cov[1][1] + 0.3;
	float mid = 0.5 * (diagonal1 + diagonal2);
	float radius = length(vec2((diagonal1 - diagonal2) / 2.0, offDiagonal));
	float lambda1 = mid + radius;
	float lambda2 = max(mid - radius, 0.1);
	float vmin = min(1024.0, min(viewport.x, viewport.y));
	float l1 = 2.0 * min(sqrt(2.0 * lambda1), vmin);
	float l2 = 2.0 * min(sqrt(2.0 * lambda2), vmin);
	if (l1 < 2.0 && l2 < 2.0) {
		return false;
	}
	vec2 c = center.proj.ww / viewport;
	if (any(greaterThan(abs(center.proj.xy) - vec2(max(l1, l2)) * c, center.proj.ww))) {
		return false;
	}
	vec2 diagonalVector = normalize(vec2(offDiagonal, lambda1 - diagonal1));
	vec2 v1 = l1 * diagonalVector;
	vec2 v2 = l2 * vec2(diagonalVector.y, -diagonalVector.x);
	corner.offset = (source.cornerUV.x * v1 + source.cornerUV.y * v2) * c;
	corner.uv = source.cornerUV;
	return true;
}
`,Hye=`
uniform highp usampler2D transformA;
uniform highp sampler2D transformB;
uint tAw;
vec3 readCenter(SplatSource source) {
	uvec4 tA = texelFetch(transformA, source.uv, 0);
	tAw = tA.w;
	return uintBitsToFloat(tA.xyz);
}
vec4 unpackRotation(vec3 packed) {
	return vec4(packed.xyz, sqrt(max(0.0, 1.0 - dot(packed, packed))));
}
void readCovariance(in SplatSource source, out vec3 covA, out vec3 covB) {
	vec4 tB = texelFetch(transformB, source.uv, 0);
	mat3 rot = quatToMat3(unpackRotation(vec3(unpackHalf2x16(tAw), tB.w)).wxyz);
	vec3 scale = tB.xyz;
	
	mat3 M = transpose(mat3(
		scale.x * rot[0],
		scale.y * rot[1],
		scale.z * rot[2]
	));
	covA = vec3(dot(M[0], M[0]), dot(M[0], M[1]), dot(M[0], M[2]));
	covB = vec3(dot(M[1], M[1]), dot(M[1], M[2]), dot(M[2], M[2]));
}
`,Gye=`
#include "tonemappingPS"
#include "decodePS"
#include "gammaPS"
vec3 prepareOutputFromGamma(vec3 gammaColor) {
	#if TONEMAP == NONE
		#if GAMMA == NONE
			return decodeGamma(gammaColor);
		#else
			return gammaColor;
		#endif
	#else
		return gammaCorrectOutput(toneMap(decodeGamma(gammaColor)));
	#endif
}
`,Wye=`
#ifndef DITHER_NONE
	#include "bayerPS"
	#include "opacityDitherPS"
	varying float id;
#endif
#ifdef PICK_PASS
	#include "pickPS"
#endif
#if defined(SHADOW_PASS) || defined(PICK_PASS) || defined(PREPASS_PASS)
	uniform float alphaClip;
#endif
#ifdef PREPASS_PASS
	varying float vLinearDepth;
	#include "floatAsUintPS"
#endif
const float  EXP_A	  = 12102203.0;
const int	EXP_BC_RMS = 1064866808;
float fastExp(float x) {
	int i = int(EXP_A * x) + EXP_BC_RMS;
	return intBitsToFloat(i);
}
varying mediump vec2 gaussianUV;
varying mediump vec4 gaussianColor;
void main(void) {
	mediump float A = dot(gaussianUV, gaussianUV);
	if (A > 1.0) {
		discard;
	}
	mediump float alpha = fastExp(-A * 4.0) * gaussianColor.a;
	#if defined(SHADOW_PASS) || defined(PICK_PASS) || defined(PREPASS_PASS)
		if (alpha < alphaClip) {
			discard;
		}
	#endif
	#ifdef PICK_PASS
		gl_FragColor = getPickOutput();
	#elif SHADOW_PASS
		gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
	#elif PREPASS_PASS
		gl_FragColor = float2vec4(vLinearDepth);
	#else
		if (alpha < 1.0 / 255.0) {
			discard;
		}
		#ifndef DITHER_NONE
			opacityDither(alpha, id * 0.013);
		#endif
		gl_FragColor = vec4(gaussianColor.xyz * alpha, alpha);
	#endif
}
`,Xye=`
#if SH_BANDS > 0
vec3 unpack111011s(uint bits) {
	return vec3((uvec3(bits) >> uvec3(21u, 11u, 0u)) & uvec3(0x7ffu, 0x3ffu, 0x7ffu)) / vec3(2047.0, 1023.0, 2047.0) * 2.0 - 1.0;
}
void fetchScale(in uvec4 t, out float scale, out vec3 a, out vec3 b, out vec3 c) {
	scale = uintBitsToFloat(t.x);
	a = unpack111011s(t.y);
	b = unpack111011s(t.z);
	c = unpack111011s(t.w);
}
void fetch(in uvec4 t, out vec3 a, out vec3 b, out vec3 c, out vec3 d) {
	a = unpack111011s(t.x);
	b = unpack111011s(t.y);
	c = unpack111011s(t.z);
	d = unpack111011s(t.w);
}
void fetch(in uint t, out vec3 a) {
	a = unpack111011s(t);
}
#if SH_BANDS == 1
	uniform highp usampler2D splatSH_1to3;
	void readSHData(in SplatSource source, out vec3 sh[3], out float scale) {
		fetchScale(texelFetch(splatSH_1to3, source.uv, 0), scale, sh[0], sh[1], sh[2]);
	}
#elif SH_BANDS == 2
	uniform highp usampler2D splatSH_1to3;
	uniform highp usampler2D splatSH_4to7;
	uniform highp usampler2D splatSH_8to11;
	void readSHData(in SplatSource source, out vec3 sh[8], out float scale) {
		fetchScale(texelFetch(splatSH_1to3, source.uv, 0), scale, sh[0], sh[1], sh[2]);
		fetch(texelFetch(splatSH_4to7, source.uv, 0), sh[3], sh[4], sh[5], sh[6]);
		fetch(texelFetch(splatSH_8to11, source.uv, 0).x, sh[7]);
	}
#else
	uniform highp usampler2D splatSH_1to3;
	uniform highp usampler2D splatSH_4to7;
	uniform highp usampler2D splatSH_8to11;
	uniform highp usampler2D splatSH_12to15;
	void readSHData(in SplatSource source, out vec3 sh[15], out float scale) {
		fetchScale(texelFetch(splatSH_1to3, source.uv, 0), scale, sh[0], sh[1], sh[2]);
		fetch(texelFetch(splatSH_4to7, source.uv, 0), sh[3], sh[4], sh[5], sh[6]);
		fetch(texelFetch(splatSH_8to11, source.uv, 0), sh[7], sh[8], sh[9], sh[10]);
		fetch(texelFetch(splatSH_12to15, source.uv, 0), sh[11], sh[12], sh[13], sh[14]);
	}
#endif
#endif
`,qye=`
attribute vec3 vertex_position;
attribute uint vertex_id_attrib;
uniform uint numSplats;
uniform highp usampler2D splatOrder;
bool initSource(out SplatSource source) {
	uint w = uint(textureSize(splatOrder, 0).x);
	source.order = vertex_id_attrib + uint(vertex_position.z);
	if (source.order >= numSplats) {
		return false;
	}
	ivec2 orderUV = ivec2(source.order % w, source.order / w);
	source.id = texelFetch(splatOrder, orderUV, 0).r;
	source.uv = ivec2(source.id % w, source.id / w);
	source.cornerUV = vertex_position.xy;
	return true;
}
`,Yye=`
#include "gsplatCommonVS"
varying mediump vec2 gaussianUV;
varying mediump vec4 gaussianColor;
#ifndef DITHER_NONE
	varying float id;
#endif
mediump vec4 discardVec = vec4(0.0, 0.0, 2.0, 1.0);
#ifdef PREPASS_PASS
	varying float vLinearDepth;
#endif
void main(void) {
	SplatSource source;
	if (!initSource(source)) {
		gl_Position = discardVec;
		return;
	}
	vec3 modelCenter = readCenter(source);
	SplatCenter center;
	if (!initCenter(modelCenter, center)) {
		gl_Position = discardVec;
		return;
	}
	SplatCorner corner;
	if (!initCorner(source, center, corner)) {
		gl_Position = discardVec;
		return;
	}
	vec4 clr = readColor(source);
	#if GSPLAT_AA
		clr.a *= corner.aaFactor;
	#endif
	#if SH_BANDS > 0
		vec3 dir = normalize(center.view * mat3(center.modelView));
		vec3 sh[SH_COEFFS];
		float scale;
		readSHData(source, sh, scale);
		clr.xyz += evalSH(sh, dir) * scale;
	#endif
	clipCorner(corner, clr.w);
	gl_Position = center.proj + vec4(corner.offset, 0, 0);
	gaussianUV = corner.uv;
	gaussianColor = vec4(prepareOutputFromGamma(max(clr.xyz, 0.0)), clr.w);
	#ifndef DITHER_NONE
		id = float(source.id);
	#endif
	#ifdef PREPASS_PASS
		vLinearDepth = -center.view.z;
	#endif
}
`,Kye=`
	attribute vec2 aPosition;
	varying vec2 uv0;
	void main(void)
	{
		gl_Position = vec4(aPosition, 0.0, 1.0);
		uv0 = getImageEffectUV((aPosition.xy + 1.0) * 0.5);
	}
`,Zye=`
		#include "gammaPS"
		varying vec4 color;
		void main(void) {
			gl_FragColor = vec4(gammaCorrectOutput(decodeGamma(color.rgb)), color.a);
		}
`,Qye=`
	attribute vec4 vertex_position;
	attribute vec4 vertex_color;
	uniform mat4 matrix_model;
	uniform mat4 matrix_viewProjection;
	varying vec4 color;
	void main(void) {
		color = vertex_color;
		gl_Position = matrix_viewProjection * matrix_model * vertex_position;
	}
`,Jye=`
uniform float material_iridescenceRefractionIndex;
float iridescence_iorToFresnel(float transmittedIor, float incidentIor) {
	return pow((transmittedIor - incidentIor) / (transmittedIor + incidentIor), 2.0);
}
vec3 iridescence_iorToFresnel(vec3 transmittedIor, float incidentIor) {
	return pow((transmittedIor - vec3(incidentIor)) / (transmittedIor + vec3(incidentIor)), vec3(2.0));
}
vec3 iridescence_fresnelToIor(vec3 f0) {
	vec3 sqrtF0 = sqrt(f0);
	return (vec3(1.0) + sqrtF0) / (vec3(1.0) - sqrtF0);
}
vec3 iridescence_sensitivity(float opd, vec3 shift) {
	float PI = 3.141592653589793;
	float phase = 2.0 * PI * opd * 1.0e-9;
	const vec3 val = vec3(5.4856e-13, 4.4201e-13, 5.2481e-13);
	const vec3 pos = vec3(1.6810e+06, 1.7953e+06, 2.2084e+06);
	const vec3 var = vec3(4.3278e+09, 9.3046e+09, 6.6121e+09);
	vec3 xyz = val * sqrt(2.0 * PI * var) * cos(pos * phase + shift) * exp(-pow(phase, 2.0) * var);
	xyz.x += 9.7470e-14 * sqrt(2.0 * PI * 4.5282e+09) * cos(2.2399e+06 * phase + shift[0]) * exp(-4.5282e+09 * pow(phase, 2.0));
	xyz /= vec3(1.0685e-07);
	const mat3 XYZ_TO_REC709 = mat3(
		3.2404542, -0.9692660,  0.0556434,
	   -1.5371385,  1.8760108, -0.2040259,
	   -0.4985314,  0.0415560,  1.0572252
	);
	return XYZ_TO_REC709 * xyz;
}
float iridescence_fresnel(float cosTheta, float f0) {
	float x = clamp(1.0 - cosTheta, 0.0, 1.0);
	float x2 = x * x;
	float x5 = x * x2 * x2;
	return f0 + (1.0 - f0) * x5;
} 
vec3 iridescence_fresnel(float cosTheta, vec3 f0) {
	float x = clamp(1.0 - cosTheta, 0.0, 1.0);
	float x2 = x * x;
	float x5 = x * x2 * x2; 
	return f0 + (vec3(1.0) - f0) * x5;
}
vec3 calcIridescence(float outsideIor, float cosTheta, vec3 base_f0, float iridescenceThickness) {
	float PI = 3.141592653589793;
	float iridescenceIor = mix(outsideIor, material_iridescenceRefractionIndex, smoothstep(0.0, 0.03, iridescenceThickness));
	float sinTheta2Sq = pow(outsideIor / iridescenceIor, 2.0) * (1.0 - pow(cosTheta, 2.0));
	float cosTheta2Sq = 1.0 - sinTheta2Sq;
	if (cosTheta2Sq < 0.0) {
		return vec3(1.0);
	}
	float cosTheta2 = sqrt(cosTheta2Sq);
	float r0 = iridescence_iorToFresnel(iridescenceIor, outsideIor);
	float r12 = iridescence_fresnel(cosTheta, r0);
	float r21 = r12;
	float t121 = 1.0 - r12;
	float phi12 = iridescenceIor < outsideIor ? PI : 0.0;
	float phi21 = PI - phi12;
	vec3 baseIor = iridescence_fresnelToIor(base_f0 + vec3(0.0001));
	vec3 r1 = iridescence_iorToFresnel(baseIor, iridescenceIor);
	vec3 r23 = iridescence_fresnel(cosTheta2, r1);
	vec3 phi23 = vec3(0.0);
	if (baseIor[0] < iridescenceIor) phi23[0] = PI;
	if (baseIor[1] < iridescenceIor) phi23[1] = PI;
	if (baseIor[2] < iridescenceIor) phi23[2] = PI;
	float opd = 2.0 * iridescenceIor * iridescenceThickness * cosTheta2;
	vec3 phi = vec3(phi21) + phi23; 
	vec3 r123Sq = clamp(r12 * r23, 1e-5, 0.9999);
	vec3 r123 = sqrt(r123Sq);
	vec3 rs = pow(t121, 2.0) * r23 / (1.0 - r123Sq);
	vec3 c0 = r12 + rs;
	vec3 i = c0;
	vec3 cm = rs - t121;
	for (int m = 1; m <= 2; m++) {
		cm *= r123;
		vec3 sm = 2.0 * iridescence_sensitivity(float(m) * opd, float(m) * phi);
		i += cm * sm;
	}
	return max(i, vec3(0.0));
}
vec3 getIridescence(float cosTheta, vec3 specularity, float iridescenceThickness) {
	return calcIridescence(1.0, cosTheta, specularity, iridescenceThickness);
}
`,e0e=`
#ifdef STD_IRIDESCENCE_CONSTANT
uniform float material_iridescence;
#endif
void getIridescence() {
	float iridescence = 1.0;
	#ifdef STD_IRIDESCENCE_CONSTANT
	iridescence *= material_iridescence;
	#endif
	#ifdef STD_IRIDESCENCE_TEXTURE
	iridescence *= texture2DBias({STD_IRIDESCENCE_TEXTURE_NAME}, {STD_IRIDESCENCE_TEXTURE_UV}, textureBias).{STD_IRIDESCENCE_TEXTURE_CHANNEL};
	#endif
	dIridescence = iridescence; 
}
`,t0e=`
uniform float material_iridescenceThicknessMax;
#ifdef STD_IRIDESCENCETHICKNESS_TEXTURE
uniform float material_iridescenceThicknessMin;
#endif
void getIridescenceThickness() {
	#ifdef STD_IRIDESCENCETHICKNESS_TEXTURE
		float blend = texture2DBias({STD_IRIDESCENCETHICKNESS_TEXTURE_NAME}, {STD_IRIDESCENCETHICKNESS_TEXTURE_UV}, textureBias).{STD_IRIDESCENCETHICKNESS_TEXTURE_CHANNEL};
		float iridescenceThickness = mix(material_iridescenceThicknessMin, material_iridescenceThicknessMax, blend);
	#else
		float iridescenceThickness = material_iridescenceThicknessMax;
	#endif
	dIridescenceThickness = iridescenceThickness; 
}
`,i0e=`
#ifdef STD_IOR_CONSTANT
uniform float material_refractionIndex;
#endif
void getIor() {
#ifdef STD_IOR_CONSTANT
	dIor = material_refractionIndex;
#else
	dIor = 1.0 / 1.5;
#endif
}
`,r0e=`
#if defined(LIGHT{i})
	uniform vec3 light{i}_color;
	#if LIGHT{i}TYPE == DIRECTIONAL
		uniform vec3 light{i}_direction;
	#else
		#define LIT_CODE_LIGHTS_POINT
		uniform vec3 light{i}_position;
		uniform float light{i}_radius;
		#if LIGHT{i}TYPE == SPOT
			#define LIT_CODE_LIGHTS_SPOT
			uniform vec3 light{i}_direction;
			uniform float light{i}_innerConeAngle;
			uniform float light{i}_outerConeAngle;
		#endif
	#endif
	#if LIGHT{i}SHAPE != PUNCTUAL
		#define LIT_CODE_FALLOFF_SQUARED
		#if LIGHT{i}TYPE == DIRECTIONAL
			uniform vec3 light{i}_position;
		#endif
		uniform vec3 light{i}_halfWidth;
		uniform vec3 light{i}_halfHeight;
	#else
		#if LIGHT{i}FALLOFF == LINEAR
			#define LIT_CODE_FALLOFF_LINEAR
		#endif
		#if LIGHT{i}FALLOFF == INVERSESQUARED
			#define LIT_CODE_FALLOFF_SQUARED
		#endif
	#endif
	#if defined(LIGHT{i}CASTSHADOW)
		uniform mat4 light{i}_shadowMatrix;
		uniform float light{i}_shadowIntensity;
		uniform vec4 light{i}_shadowParams;
		#if LIGHT{i}SHADOWTYPE == PCSS_32F
			uniform float light{i}_shadowSearchArea;
			uniform vec4 light{i}_cameraParams;
			#if LIGHT{i}TYPE == DIRECTIONAL
				uniform vec4 light{i}_softShadowParams;
			#endif
		#endif
		#if LIGHT{i}TYPE == DIRECTIONAL
			uniform mat4 light{i}_shadowMatrixPalette[4];
			uniform vec4 light{i}_shadowCascadeDistances;
			uniform int light{i}_shadowCascadeCount;
			uniform float light{i}_shadowCascadeBlend;
		#endif
		#if LIGHT{i}TYPE == OMNI
			#if defined(LIGHT{i}SHADOW_PCF)
				uniform samplerCubeShadow light{i}_shadowMap;
			#else
				uniform samplerCube light{i}_shadowMap;
			#endif
		#else
			#if defined(LIGHT{i}SHADOW_PCF)
				uniform sampler2DShadow light{i}_shadowMap;
			#else
				uniform sampler2D light{i}_shadowMap;
			#endif
		#endif
	#endif
	#if defined(LIGHT{i}COOKIE)
		#define LIT_CODE_COOKIE
		#if LIGHT{i}TYPE == OMNI
			uniform samplerCube light{i}_cookie;
			uniform float light{i}_cookieIntensity;
			#if !defined(LIGHT{i}CASTSHADOW)
				uniform mat4 light{i}_shadowMatrix;
			#endif
		#endif
		#if LIGHT{i}TYPE == SPOT
			uniform sampler2D light{i}_cookie;
			uniform float light{i}_cookieIntensity;
			#if !defined(LIGHT{i}CASTSHADOW)
				uniform mat4 light{i}_shadowMatrix;
			#endif
			#if defined(LIGHT{i}COOKIE_TRANSFORM)
				uniform vec4 light{i}_cookieMatrix;
				uniform vec2 light{i}_cookieOffset;
			#endif
		#endif
	#endif
#endif
`,s0e=`
float getLightDiffuse(vec3 worldNormal, vec3 viewDir, vec3 lightDirNorm) {
	return max(dot(worldNormal, -lightDirNorm), 0.0);
}
`,n0e=`
vec3 evalOmniLight(vec3 lightPosW) {
	return vPositionW - lightPosW;
}
`,a0e=`
#if defined(LIGHT{i})
	evaluateLight{i}(
		#if defined(LIT_IRIDESCENCE)
			iridescenceFresnel
		#endif
	);
#endif
`,o0e=`
#if defined(LIGHT{i})
void evaluateLight{i}(
	#if defined(LIT_IRIDESCENCE)
		vec3 iridescenceFresnel
	#endif
) {
	vec3 lightColor = light{i}_color;
	#if LIGHT{i}TYPE == DIRECTIONAL && !defined(LIT_SHADOW_CATCHER)
		if (all(equal(lightColor, vec3(0.0)))) {
			return;
		}
	#endif
	#if LIGHT{i}TYPE == DIRECTIONAL
		dLightDirNormW = light{i}_direction;
		dAtten = 1.0;
	#else
		
		vec3 lightDirW = evalOmniLight(light{i}_position);
		dLightDirNormW = normalize(lightDirW);
		#if defined(LIGHT{i}COOKIE)
			#if LIGHT{i}TYPE == SPOT
				#ifdef LIGHT{i}COOKIE_FALLOFF
					#ifdef LIGHT{i}COOKIE_TRANSFORM
						vec3 cookieAttenuation = getCookie2DXform(light{i}_cookie, light{i}_shadowMatrix, light{i}_cookieIntensity, light{i}_cookieMatrix, light{i}_cookieOffset).{LIGHT{i}COOKIE_CHANNEL};
					#else
						vec3 cookieAttenuation = getCookie2D(light{i}_cookie, light{i}_shadowMatrix, light{i}_cookieIntensity).{LIGHT{i}COOKIE_CHANNEL};
					#endif
				#else
					#ifdef LIGHT{i}COOKIE_TRANSFORM
						vec3 cookieAttenuation = getCookie2DClipXform(light{i}_cookie, light{i}_shadowMatrix, light{i}_cookieIntensity, light{i}_cookieMatrix, light{i}_cookieOffset).{LIGHT{i}COOKIE_CHANNEL};
					#else
						vec3 cookieAttenuation = getCookie2DClip(light{i}_cookie, light{i}_shadowMatrix, light{i}_cookieIntensity).{LIGHT{i}COOKIE_CHANNEL};
					#endif
				#endif
			#endif
			#if LIGHT{i}TYPE == OMNI
				vec3 cookieAttenuation = getCookieCube(light{i}_cookie, light{i}_shadowMatrix, light{i}_cookieIntensity).{LIGHT{i}COOKIE_CHANNEL};
			#endif
			lightColor *= cookieAttenuation;
		#endif
		#if LIGHT{i}SHAPE == PUNCTUAL
			#if LIGHT{i}FALLOFF == LINEAR
				dAtten = getFalloffLinear(light{i}_radius, lightDirW);
			#else
				dAtten = getFalloffInvSquared(light{i}_radius, lightDirW);
			#endif
		#else
			dAtten = getFalloffWindow(light{i}_radius, lightDirW);
		#endif
		#if LIGHT{i}TYPE == SPOT
			#if !defined(LIGHT{i}COOKIE) || defined(LIGHT{i}COOKIE_FALLOFF)
				dAtten *= getSpotEffect(light{i}_direction, light{i}_innerConeAngle, light{i}_outerConeAngle, dLightDirNormW);
			#endif
		#endif
	#endif
	if (dAtten < 0.00001) {
		return;
	}
	#if LIGHT{i}SHAPE != PUNCTUAL
		#if LIGHT{i}SHAPE == RECT
			calcRectLightValues(light{i}_position, light{i}_halfWidth, light{i}_halfHeight);
		#elif LIGHT{i}SHAPE == DISK
			calcDiskLightValues(light{i}_position, light{i}_halfWidth, light{i}_halfHeight);
		#elif LIGHT{i}SHAPE == SPHERE
			calcSphereLightValues(light{i}_position, light{i}_halfWidth, light{i}_halfHeight);
		#endif
	#endif
	#if LIGHT{i}SHAPE != PUNCTUAL
		#if LIGHT{i}TYPE == DIRECTIONAL
			float attenDiffuse = getLightDiffuse(litArgs_worldNormal, dViewDirW, dLightDirNormW);
		#else
			#if LIGHT{i}SHAPE == RECT
				float attenDiffuse = getRectLightDiffuse(litArgs_worldNormal, dViewDirW, lightDirW, dLightDirNormW) * 16.0;
			#elif LIGHT{i}SHAPE == DISK
				float attenDiffuse = getDiskLightDiffuse(litArgs_worldNormal, dViewDirW, lightDirW, dLightDirNormW) * 16.0;
			#elif LIGHT{i}SHAPE == SPHERE
				float attenDiffuse = getSphereLightDiffuse(litArgs_worldNormal, dViewDirW, lightDirW, dLightDirNormW) * 16.0;
			#endif
		#endif
	#else
		dAtten *= getLightDiffuse(litArgs_worldNormal, vec3(0.0), dLightDirNormW);
	#endif
	#ifdef LIGHT{i}CASTSHADOW
		#if LIGHT{i}TYPE == DIRECTIONAL
			float shadow = getShadow{i}(vec3(0.0));
		#else
			float shadow = getShadow{i}(lightDirW);
		#endif
		shadow = mix(1.0, shadow, light{i}_shadowIntensity);
		dAtten *= shadow;
		#if defined(LIT_SHADOW_CATCHER) && LIGHT{i}TYPE == DIRECTIONAL
			dShadowCatcher *= shadow;
		#endif			
	#endif
	#if LIGHT{i}SHAPE != PUNCTUAL
		#ifdef LIT_SPECULAR
			dDiffuseLight += ((attenDiffuse * dAtten) * lightColor) * (1.0 - dLTCSpecFres);
		#else
			dDiffuseLight += (attenDiffuse * dAtten) * lightColor;
		#endif						
	#else
		#if defined(AREA_LIGHTS) && defined(LIT_SPECULAR)
			dDiffuseLight += (dAtten * lightColor) * (1.0 - litArgs_specularity);
		#else
			dDiffuseLight += dAtten * lightColor;
		#endif
	#endif
	#ifdef LIGHT{i}AFFECT_SPECULARITY
		#if LIGHT{i}SHAPE != PUNCTUAL
			#ifdef LIT_CLEARCOAT
				#if LIGHT{i}SHAPE == RECT
					ccSpecularLight += ccLTCSpecFres * getRectLightSpecular(litArgs_clearcoat_worldNormal, dViewDirW) * dAtten * lightColor;
				#elif LIGHT{i}SHAPE == DISK
					ccSpecularLight += ccLTCSpecFres * getDiskLightSpecular(litArgs_clearcoat_worldNormal, dViewDirW) * dAtten * lightColor;
				#elif LIGHT{i}SHAPE == SPHERE
					ccSpecularLight += ccLTCSpecFres * getSphereLightSpecular(litArgs_clearcoat_worldNormal, dViewDirW) * dAtten * lightColor;
				#endif
			#endif
			#ifdef LIT_SPECULAR
				#if LIGHT{i}SHAPE == RECT
					dSpecularLight += dLTCSpecFres * getRectLightSpecular(litArgs_worldNormal, dViewDirW) * dAtten * lightColor;
				#elif LIGHT{i}SHAPE == DISK
					dSpecularLight += dLTCSpecFres * getDiskLightSpecular(litArgs_worldNormal, dViewDirW) * dAtten * lightColor;
				#elif LIGHT{i}SHAPE == SPHERE
					dSpecularLight += dLTCSpecFres * getSphereLightSpecular(litArgs_worldNormal, dViewDirW) * dAtten * lightColor;
				#endif
			#endif
		#else
			#if LIGHT{i}TYPE == DIRECTIONAL && LIT_FRESNEL_MODEL != NONE
				#define LIGHT{i}FRESNEL
			#endif
			#ifdef LIT_SPECULAR
				vec3 halfDirW = normalize(-dLightDirNormW + dViewDirW);
			#endif
			#ifdef LIT_CLEARCOAT
				vec3 lightspecularCC = getLightSpecular(halfDirW, ccReflDirW, litArgs_clearcoat_worldNormal, dViewDirW, dLightDirNormW, litArgs_clearcoat_gloss, dTBN) * dAtten * lightColor;
				#ifdef LIGHT{i}FRESNEL
					lightspecularCC *= getFresnelCC(dot(dViewDirW, halfDirW));
				#endif
				ccSpecularLight += lightspecularCC;
			#endif
			#ifdef LIT_SHEEN
				sSpecularLight += getLightSpecularSheen(halfDirW, litArgs_worldNormal, dViewDirW, dLightDirNormW, litArgs_sheen_gloss) * dAtten * lightColor;
			#endif
			#ifdef LIT_SPECULAR
				vec3 lightSpecular = getLightSpecular(halfDirW, dReflDirW, litArgs_worldNormal, dViewDirW, dLightDirNormW, litArgs_gloss, dTBN) * dAtten * lightColor;
				#ifdef LIGHT{i}FRESNEL
					#if defined(LIT_IRIDESCENCE)
						lightSpecular *= getFresnel(dot(dViewDirW, halfDirW), litArgs_gloss, litArgs_specularity, iridescenceFresnel, litArgs_iridescence_intensity);
					#else
						lightSpecular *= getFresnel(dot(dViewDirW, halfDirW), litArgs_gloss, litArgs_specularity);
					#endif
				#else
					lightSpecular *= litArgs_specularity;
				#endif
				
				dSpecularLight += lightSpecular;
			#endif
		#endif
	#endif
}
#endif
`,l0e=`
#ifdef LIGHT{i}CASTSHADOW
	vec3 getShadowSampleCoord{i}(mat4 shadowTransform, vec4 shadowParams, vec3 worldPosition, vec3 lightPos, inout vec3 lightDir, vec3 lightDirNorm, vec3 normal) {
		vec3 surfacePosition = worldPosition;
		#ifdef LIGHT{i}_SHADOW_SAMPLE_POINT
			#ifdef LIGHT{i}_SHADOW_SAMPLE_NORMAL_OFFSET
				float distScale = length(lightDir);
				surfacePosition = surfacePosition + normal * shadowParams.y * clamp(1.0 - dot(normal, -lightDirNorm), 0.0, 1.0) * distScale;
				lightDir = surfacePosition - lightPos;
				return lightDir;
			#endif
		#else
			#ifdef LIGHT{i}_SHADOW_SAMPLE_SOURCE_ZBUFFER
				#ifdef LIGHT{i}_SHADOW_SAMPLE_NORMAL_OFFSET
					surfacePosition = surfacePosition + normal * shadowParams.y;
				#endif
			#else
				#ifdef LIGHT{i}_SHADOW_SAMPLE_NORMAL_OFFSET
					#ifdef LIGHT{i}_SHADOW_SAMPLE_ORTHO
						float distScale = 1.0;
					#else
						float distScale = abs(dot(vPositionW - lightPos, lightDirNorm));
					#endif
					surfacePosition = surfacePosition + normal * shadowParams.y * clamp(1.0 - dot(normal, -lightDirNorm), 0.0, 1.0) * distScale;
				#endif
			#endif
			vec4 positionInShadowSpace = shadowTransform * vec4(surfacePosition, 1.0);
			#ifdef LIGHT{i}_SHADOW_SAMPLE_ORTHO
				positionInShadowSpace.z = saturate(positionInShadowSpace.z) - 0.0001;
			#else
				#ifdef LIGHT{i}_SHADOW_SAMPLE_SOURCE_ZBUFFER
					positionInShadowSpace.xyz /= positionInShadowSpace.w;
				#else
					positionInShadowSpace.xy /= positionInShadowSpace.w;
					positionInShadowSpace.z = length(lightDir) * shadowParams.w;
				#endif
			#endif
			#ifdef SHADOW_SAMPLE_Z_BIAS
			#endif
			surfacePosition = positionInShadowSpace.xyz;
		#endif
		return surfacePosition;
	}
	float getShadow{i}(vec3 lightDirW) {
		#ifdef LIGHT{i}_SHADOW_CASCADES
			int cascadeIndex = getShadowCascadeIndex(light{i}_shadowCascadeDistances, light{i}_shadowCascadeCount);
			#ifdef LIGHT{i}_SHADOW_CASCADE_BLEND
				cascadeIndex = ditherShadowCascadeIndex(cascadeIndex, light{i}_shadowCascadeDistances, light{i}_shadowCascadeCount, light{i}_shadowCascadeBlend);
			#endif
			mat4 shadowMatrix = light{i}_shadowMatrixPalette[cascadeIndex];
		#else
			mat4 shadowMatrix = light{i}_shadowMatrix;
		#endif
		#if LIGHT{i}TYPE == DIRECTIONAL
			vec3 shadowCoord = getShadowSampleCoord{i}(shadowMatrix, light{i}_shadowParams, vPositionW, vec3(0.0), lightDirW, dLightDirNormW, dVertexNormalW);
		#else
			vec3 shadowCoord = getShadowSampleCoord{i}(shadowMatrix, light{i}_shadowParams, vPositionW, light{i}_position, lightDirW, dLightDirNormW, dVertexNormalW);
		#endif
		#if LIGHT{i}TYPE == DIRECTIONAL
			shadowCoord = fadeShadow(shadowCoord, light{i}_shadowCascadeDistances);
		#endif
		#if LIGHT{i}TYPE == DIRECTIONAL
			#if LIGHT{i}SHADOWTYPE == VSM_16F
				return getShadowVSM16(SHADOWMAP_PASS(light{i}_shadowMap), shadowCoord, light{i}_shadowParams, 5.54);
			#endif
			#if LIGHT{i}SHADOWTYPE == VSM_32F
				return getShadowVSM32(SHADOWMAP_PASS(light{i}_shadowMap), shadowCoord, light{i}_shadowParams, 15.0);
			#endif
			#if LIGHT{i}SHADOWTYPE == PCSS_32F
				#if LIGHT{i}SHAPE != PUNCTUAL
					vec2 shadowSearchArea = vec2(length(light{i}_halfWidth), length(light{i}_halfHeight)) * light{i}_shadowSearchArea;
					return getShadowPCSS(SHADOWMAP_PASS(light{i}_shadowMap), shadowCoord, light{i}_shadowParams, light{i}_cameraParams, shadowSearchArea, lightDirW);
				#else
					return getShadowPCSS(SHADOWMAP_PASS(light{i}_shadowMap), shadowCoord, light{i}_shadowParams, light{i}_cameraParams, light{i}_softShadowParams, lightDirW);
				#endif
			#endif
			#if LIGHT{i}SHADOWTYPE == PCF1_16F || LIGHT{i}SHADOWTYPE == PCF1_32F
				return getShadowPCF1x1(SHADOWMAP_PASS(light{i}_shadowMap), shadowCoord, light{i}_shadowParams);
			#endif
			#if LIGHT{i}SHADOWTYPE == PCF3_16F || LIGHT{i}SHADOWTYPE == PCF3_32F
				return getShadowPCF3x3(SHADOWMAP_PASS(light{i}_shadowMap), shadowCoord, light{i}_shadowParams);
			#endif
			#if LIGHT{i}SHADOWTYPE == PCF5_16F || LIGHT{i}SHADOWTYPE == PCF5_32F
				return getShadowPCF5x5(SHADOWMAP_PASS(light{i}_shadowMap), shadowCoord, light{i}_shadowParams);
			#endif
		#endif
		#if LIGHT{i}TYPE == SPOT
			#if LIGHT{i}SHADOWTYPE == VSM_16F
				return getShadowSpotVSM16(SHADOWMAP_PASS(light{i}_shadowMap), shadowCoord, light{i}_shadowParams, 5.54, lightDirW);
			#endif
			#if LIGHT{i}SHADOWTYPE == VSM_32F
				return getShadowSpotVSM32(SHADOWMAP_PASS(light{i}_shadowMap), shadowCoord, light{i}_shadowParams, 15.0, lightDirW);
			#endif
			#if LIGHT{i}SHADOWTYPE == PCSS_32F
				#if LIGHT{i}SHAPE != PUNCTUAL
					vec2 shadowSearchArea = vec2(length(light{i}_halfWidth), length(light{i}_halfHeight)) * light{i}_shadowSearchArea;
				#else
					vec2 shadowSearchArea = vec2(light{i}_shadowSearchArea);
				#endif
				return getShadowSpotPCSS(SHADOWMAP_PASS(light{i}_shadowMap), shadowCoord, light{i}_shadowParams, light{i}_cameraParams, shadowSearchArea, lightDirW);
			#endif
			#if LIGHT{i}SHADOWTYPE == PCF1_16F || LIGHT{i}SHADOWTYPE == PCF1_32F
				return getShadowSpotPCF1x1(SHADOWMAP_PASS(light{i}_shadowMap), shadowCoord, light{i}_shadowParams);
			#endif
			#if LIGHT{i}SHADOWTYPE == PCF3_16F || LIGHT{i}SHADOWTYPE == PCF3_32F
				return getShadowSpotPCF3x3(SHADOWMAP_PASS(light{i}_shadowMap), shadowCoord, light{i}_shadowParams);
			#endif
			#if LIGHT{i}SHADOWTYPE == PCF5_16F || LIGHT{i}SHADOWTYPE == PCF5_32F
				return getShadowSpotPCF5x5(SHADOWMAP_PASS(light{i}_shadowMap), shadowCoord, light{i}_shadowParams);
			#endif
		#endif
		#if LIGHT{i}TYPE == OMNI
			#if LIGHT{i}SHADOWTYPE == PCSS_32F
				#if LIGHT{i}SHAPE != PUNCTUAL
					vec2 shadowSearchArea = vec2(length(light{i}_halfWidth), length(light{i}_halfHeight)) * light{i}_shadowSearchArea;
				#else
					vec2 shadowSearchArea = vec2(light{i}_shadowSearchArea);
				#endif
				return getShadowOmniPCSS(SHADOWMAP_PASS(light{i}_shadowMap), shadowCoord, light{i}_shadowParams, light{i}_cameraParams, shadowSearchArea, lightDirW);
			#endif
			#if LIGHT{i}SHADOWTYPE == PCF1_16F || LIGHT{i}SHADOWTYPE == PCF1_32F
				return getShadowOmniPCF1x1(SHADOWMAP_PASS(light{i}_shadowMap), shadowCoord, light{i}_shadowParams, lightDirW);
			#endif
			#if LIGHT{i}SHADOWTYPE == PCF3_16F || LIGHT{i}SHADOWTYPE == PCF3_32F
				return getShadowOmniPCF3x3(SHADOWMAP_PASS(light{i}_shadowMap), shadowCoord, light{i}_shadowParams, lightDirW);
			#endif
		#endif
	}
#endif
`,c0e=`
#ifdef LIT_CLUSTERED_LIGHTS
	#define LIT_CODE_FALLOFF_LINEAR
	#define LIT_CODE_FALLOFF_SQUARED
	#define LIT_CODE_LIGHTS_POINT
	#define LIT_CODE_LIGHTS_SPOT
#endif
#ifdef AREA_LIGHTS
	uniform highp sampler2D areaLightsLutTex1;
	uniform highp sampler2D areaLightsLutTex2;
#endif
#ifdef LIT_LIGHTING
	#include "lightDiffuseLambertPS"
	#if defined(AREA_LIGHTS) || defined(LIT_CLUSTERED_AREA_LIGHTS)
		#include "ltcPS"
	#endif
#endif
#ifdef SHADOW_DIRECTIONAL
	#include "shadowCascadesPS"
#endif
#if defined(SHADOW_KIND_PCF1)
	#include "shadowPCF1PS"
#endif
#if defined(SHADOW_KIND_PCF3)
	#include "shadowPCF3PS"
#endif
#if defined(SHADOW_KIND_PCF5)
	#include "shadowPCF5PS"
#endif
#if defined(SHADOW_KIND_PCSS)
	#include "linearizeDepthPS"
	#include "shadowPCSSPS"
	#include "shadowSoftPS"
#endif
#if defined(SHADOW_KIND_VSM)
	#include "shadowEVSMPS"
#endif
#ifdef LIT_CODE_FALLOFF_LINEAR
	#include "falloffLinearPS"
#endif
#ifdef LIT_CODE_FALLOFF_SQUARED
	#include "falloffInvSquaredPS"
#endif
#ifdef LIT_CODE_LIGHTS_POINT
	#include "lightDirPointPS"
#endif
#ifdef LIT_CODE_LIGHTS_SPOT
	#include "spotPS"
#endif
#ifdef LIT_CODE_COOKIE
	#include "cookiePS"
#endif
#ifdef LIT_CLUSTERED_LIGHTS
	#include "clusteredLightPS"
#endif
#ifdef LIGHT_COUNT > 0
	#include "lightFunctionShadowPS, LIGHT_COUNT"
	#include "lightFunctionLightPS, LIGHT_COUNT"
#endif
`,u0e=`
void addLightMap(
	vec3 lightmap, 
	vec3 dir, 
	vec3 worldNormal, 
	vec3 viewDir, 
	vec3 reflectionDir, 
	float gloss, 
	vec3 specularity, 
	vec3 vertexNormal, 
	mat3 tbn
#if defined(LIT_IRIDESCENCE)
	vec3 iridescenceFresnel, 
	float iridescenceIntensity
#endif
) {
	#if defined(LIT_SPECULAR) && defined(LIT_DIR_LIGHTMAP)
		if (dot(dir, dir) < 0.0001) {
				dDiffuseLight += lightmap;
		} else {
			float vlight = saturate(dot(dir, -vertexNormal));
			float flight = saturate(dot(dir, -worldNormal));
			float nlight = (flight / max(vlight, 0.01)) * 0.5;
			dDiffuseLight += lightmap * nlight * 2.0;
			vec3 halfDir = normalize(-dir + viewDir);
			vec3 specularLight = lightmap * getLightSpecular(halfDir, reflectionDir, worldNormal, viewDir, dir, gloss, tbn);
			#ifdef LIT_SPECULAR_FRESNEL
				specularLight *= 
					getFresnel(dot(viewDir, halfDir), 
					gloss, 
					specularity
				#if defined(LIT_IRIDESCENCE)
					, iridescenceFresnel,
					iridescenceIntensity
				#endif
					);
			#endif
			dSpecularLight += specularLight;
		}
	#else
		dDiffuseLight += lightmap;
	#endif
}
`,h0e=`
#ifdef STD_LIGHTMAP_DIR
	vec3 dLightmapDir;
	uniform sampler2D texture_dirLightMap;
#endif
void getLightMap() {
	dLightmap = vec3(1.0);
	#ifdef STD_LIGHT_TEXTURE
		dLightmap *= {STD_LIGHT_TEXTURE_DECODE}(texture2DBias({STD_LIGHT_TEXTURE_NAME}, {STD_LIGHT_TEXTURE_UV}, textureBias)).{STD_LIGHT_TEXTURE_CHANNEL};
		#ifdef STD_LIGHTMAP_DIR
			vec3 dir = texture2DBias(texture_dirLightMap, {STD_LIGHT_TEXTURE_UV}, textureBias).xyz * 2.0 - 1.0;
			float dirDot = dot(dir, dir);
			dLightmapDir = (dirDot > 0.001) ? dir / sqrt(dirDot) : vec3(0.0);
		#endif
	#endif
	#ifdef STD_LIGHT_VERTEX
		dLightmap *= saturate(vVertexColor.{STD_LIGHT_VERTEX_CHANNEL});
	#endif
}
`,d0e=`
float calcLightSpecular(float gloss, vec3 worldNormal, vec3 viewDir, vec3 h, vec3 lightDirNorm, mat3 tbn) {
	float PI = 3.141592653589793;
	float roughness = max((1.0 - gloss) * (1.0 - gloss), 0.001);
	float alphaRoughness = roughness * roughness;
	float anisotropy = dAnisotropy;
	vec2 direction = dAnisotropyRotation;
	float at = mix(alphaRoughness, 1.0, anisotropy * anisotropy);
	float ab = clamp(alphaRoughness, 0.001, 1.0);
	vec3 anisotropicT = normalize(tbn * vec3(direction, 0.0));
	vec3 anisotropicB = normalize(cross(tbn[2], anisotropicT));
	float NoH = dot(worldNormal, h);
	float ToH = dot(anisotropicT, h);
	float BoH = dot(anisotropicB, h);
	float a2 = at * ab;
	vec3 v = vec3(ab * ToH, at * BoH, a2 * NoH);
	float v2 = dot(v, v);
	float w2 = a2 / v2;
	float D = a2 * w2 * w2 * (1.0 / PI);
	float ToV = dot(anisotropicT, viewDir);
	float BoV = dot(anisotropicB, viewDir);
	float ToL = dot(anisotropicT, -lightDirNorm);
	float BoL = dot(anisotropicB, -lightDirNorm);
	float NoV = dot(worldNormal, viewDir);
	float NoL = dot(worldNormal, -lightDirNorm);
	float lambdaV = NoL * length(vec3(at * ToV, ab * BoV, NoV));
	float lambdaL = NoV * length(vec3(at * ToL, ab * BoL, NoL));
	float G = 0.5 / (lambdaV + lambdaL);
	return D * G;
}
float getLightSpecular(vec3 h, vec3 reflDir, vec3 worldNormal, vec3 viewDir, vec3 lightDirNorm, float gloss, mat3 tbn) {
	return calcLightSpecular(gloss, worldNormal, viewDir, h, lightDirNorm, tbn);
}
`,f0e=`
float calcLightSpecular(float gloss, vec3 worldNormal, vec3 h) {
	float nh = max( dot( h, worldNormal ), 0.0 );
	float specPow = exp2(gloss * 11.0);
	specPow = max(specPow, 0.0001);
	return pow(nh, specPow) * (specPow + 2.0) / 8.0;
}
float getLightSpecular(vec3 h, vec3 reflDir, vec3 worldNormal, vec3 viewDir, vec3 lightDirNorm, float gloss, mat3 tbn) {
	return calcLightSpecular(gloss, worldNormal, h);
}
`,p0e=`
float sheenD(vec3 normal, vec3 h, float roughness) {
	const float PI = 3.141592653589793;
	float invR = 1.0 / (roughness * roughness);
	float cos2h = max(dot(normal, h), 0.0);
	cos2h *= cos2h;
	float sin2h = max(1.0 - cos2h, 0.0078125);
	return (2.0 + invR) * pow(sin2h, invR * 0.5) / (2.0 * PI);
}
float sheenV(vec3 normal, vec3 viewDir, vec3 light) {
	float NoV = max(dot(normal, viewDir), 0.000001);
	float NoL = max(dot(normal, light), 0.000001);
	return 1.0 / (4.0 * (NoL + NoV - NoL * NoV));
}
float getLightSpecularSheen(vec3 h, vec3 worldNormal, vec3 viewDir, vec3 lightDirNorm, float sheenGloss) {
	float D = sheenD(worldNormal, h, sheenGloss);
	float V = sheenV(worldNormal, viewDir, -lightDirNorm);
	return D * V;
}
`,m0e=`
#ifndef LINEARIZE_DEPTH
#define LINEARIZE_DEPTH
float linearizeDepthWithParams(float z, vec4 cameraParams) {
	if (cameraParams.w == 0.0)
		return (cameraParams.z * cameraParams.y) / (cameraParams.y + z * (cameraParams.z - cameraParams.y));
	else
		return cameraParams.z + z * (cameraParams.y - cameraParams.z);
}
#ifndef CAMERAPLANES
	#define CAMERAPLANES
	uniform vec4 camera_params;
#endif
float linearizeDepth(float z) {
	return linearizeDepthWithParams(z, camera_params);
}
#endif
`,g0e=`
void evaluateBackend() {
	#ifdef LIT_SSAO
		litArgs_ao *= texture2DLod(ssaoTexture, gl_FragCoord.xy * ssaoTextureSizeInv, 0.0).r;
	#endif
	#ifdef LIT_NEEDS_NORMAL
		#ifdef LIT_SPECULAR
			getReflDir(litArgs_worldNormal, dViewDirW, litArgs_gloss, dTBN);
		#endif
		#ifdef LIT_CLEARCOAT
			ccReflDirW = normalize(-reflect(dViewDirW, litArgs_clearcoat_worldNormal));
		#endif
	#endif
	#ifdef LIT_SPECULAR_OR_REFLECTION
		#ifdef LIT_METALNESS
			float f0 = 1.0 / litArgs_ior;
			f0 = (f0 - 1.0) / (f0 + 1.0);
			f0 *= f0;
			litArgs_specularity = getSpecularModulate(litArgs_specularity, litArgs_albedo, litArgs_metalness, f0);
			litArgs_albedo = getAlbedoModulate(litArgs_albedo, litArgs_metalness);
		#endif
		#ifdef LIT_IRIDESCENCE
			vec3 iridescenceFresnel = getIridescence(saturate(dot(dViewDirW, litArgs_worldNormal)), litArgs_specularity, litArgs_iridescence_thickness);
		#endif
	#endif
	#ifdef LIT_ADD_AMBIENT
		addAmbient(litArgs_worldNormal);
		#ifdef LIT_SPECULAR
			dDiffuseLight = dDiffuseLight * (1.0 - litArgs_specularity);
		#endif
		#ifdef LIT_SEPARATE_AMBIENT
			vec3 dAmbientLight = dDiffuseLight;
			dDiffuseLight = vec3(0);
		#endif
	#endif
	#ifndef LIT_OLD_AMBIENT
		dDiffuseLight *= material_ambient;
	#endif
	#ifdef LIT_AO
		#ifndef LIT_OCCLUDE_DIRECT
			occludeDiffuse(litArgs_ao);
		#endif
	#endif
	#ifdef LIT_LIGHTMAP
		addLightMap(
			litArgs_lightmap, 
			litArgs_lightmapDir, 
			litArgs_worldNormal, 
			dViewDirW, 
			dReflDirW, 
			litArgs_gloss, 
			litArgs_specularity, 
			dVertexNormalW,
			dTBN
		#if defined(LIT_IRIDESCENCE)
			, iridescenceFresnel,
			litArgs_iridescence_intensity
		#endif
		);
	#endif
	#ifdef LIT_LIGHTING || LIT_REFLECTIONS
		#ifdef LIT_REFLECTIONS
			#ifdef LIT_CLEARCOAT
				addReflectionCC(ccReflDirW, litArgs_clearcoat_gloss);
			
				#ifdef LIT_SPECULAR_FRESNEL
					ccFresnel = getFresnelCC(dot(dViewDirW, litArgs_clearcoat_worldNormal));
					ccReflection *= ccFresnel;
				#else
					ccFresnel = 0.0;
				#endif
			#endif
			#ifdef LIT_SPECULARITY_FACTOR
				ccReflection *= litArgs_specularityFactor;
			#endif
			#ifdef LIT_SHEEN
				addReflectionSheen(litArgs_worldNormal, dViewDirW, litArgs_sheen_gloss);
			#endif
			addReflection(dReflDirW, litArgs_gloss);
			#ifdef LIT_FRESNEL_MODEL
				dReflection.rgb *= getFresnel(
					dot(dViewDirW, litArgs_worldNormal), 
					litArgs_gloss, 
					litArgs_specularity
				#if defined(LIT_IRIDESCENCE)
					, iridescenceFresnel,
					litArgs_iridescence_intensity
				#endif
					);
			#else
				dReflection.rgb *= litArgs_specularity;
			#endif
			#ifdef LIT_SPECULARITY_FACTOR
				dReflection.rgb *= litArgs_specularityFactor;
			#endif
		#endif
		#ifdef AREA_LIGHTS
			dSpecularLight *= litArgs_specularity;
			#ifdef LIT_SPECULAR
				calcLTCLightValues(litArgs_gloss, litArgs_worldNormal, dViewDirW, litArgs_specularity, litArgs_clearcoat_gloss, litArgs_clearcoat_worldNormal, litArgs_clearcoat_specularity);
			#endif
		#endif
		
		#ifdef LIGHT_COUNT > 0
			#include "lightEvaluationPS, LIGHT_COUNT"
		#endif
		#ifdef LIT_CLUSTERED_LIGHTS
			addClusteredLights(litArgs_worldNormal, dViewDirW, dReflDirW,
				#if defined(LIT_CLEARCOAT)
						ccReflDirW,
				#endif
						litArgs_gloss, litArgs_specularity, dVertexNormalW, dTBN, 
				#if defined(LIT_IRIDESCENCE)
						iridescenceFresnel,
				#endif
						litArgs_clearcoat_worldNormal, litArgs_clearcoat_gloss, litArgs_sheen_gloss, litArgs_iridescence_intensity
			);
		#endif
		#ifdef AREA_LIGHTS
			#ifdef LIT_CLEARCOAT
				litArgs_clearcoat_specularity = 1.0;
			#endif
			#ifdef LIT_SPECULAR
				litArgs_specularity = vec3(1);
			#endif
		#endif
		#ifdef LIT_REFRACTION
			addRefraction(
				litArgs_worldNormal, 
				dViewDirW, 
				litArgs_thickness, 
				litArgs_gloss, 
				litArgs_specularity, 
				litArgs_albedo, 
				litArgs_transmission,
				litArgs_ior,
				litArgs_dispersion
				#if defined(LIT_IRIDESCENCE)
					, iridescenceFresnel, 
					litArgs_iridescence_intensity
				#endif
			);
		#endif
	#endif
	#ifdef LIT_AO
		#ifdef LIT_OCCLUDE_DIRECT
			occludeDiffuse(litArgs_ao);
		#endif
		#if LIT_OCCLUDE_SPECULAR != NONE
			occludeSpecular(litArgs_gloss, litArgs_ao, litArgs_worldNormal, dViewDirW);
		#endif
	#endif
	#ifdef LIT_SPECULARITY_FACTOR
		dSpecularLight *= litArgs_specularityFactor;
	#endif
	#if !defined(LIT_OPACITY_FADES_SPECULAR)
		#if LIT_BLEND_TYPE == NORMAL || LIT_BLEND_TYPE == PREMULTIPLIED
			float specLum = dot((dSpecularLight + dReflection.rgb * dReflection.a), vec3( 0.2126, 0.7152, 0.0722 ));
			#ifdef LIT_CLEARCOAT
				specLum += dot(ccSpecularLight * litArgs_clearcoat_specularity + ccReflection * litArgs_clearcoat_specularity, vec3( 0.2126, 0.7152, 0.0722 ));
			#endif
			litArgs_opacity = clamp(litArgs_opacity + gammaCorrectInput(specLum), 0.0, 1.0);
		#endif
		litArgs_opacity *= material_alphaFade;
	#endif
	#ifdef LIT_LIGHTMAP_BAKING
		#ifdef LIT_LIGHTMAP_BAKING_COLOR
			#include "bakeLmEndPS"
		#endif
		#ifdef LIT_LIGHTMAP_BAKING_DIR
			#include "bakeDirLmEndPS"
		#endif
	#else
		#include "endPS"
		#include "outputAlphaPS"
	#endif
	#ifdef LIT_MSDF
		gl_FragColor = applyMsdf(gl_FragColor);
	#endif
	#include "outputPS"
	#include "debugOutputPS"
	#ifdef LIT_SHADOW_CATCHER
		gl_FragColor.rgb = vec3(dShadowCatcher);
	#endif
}
`,_0e=`
vec3 sReflection;
vec3 dVertexNormalW;
vec3 dTangentW;
vec3 dBinormalW;
vec3 dViewDirW;
vec3 dReflDirW;
vec3 ccReflDirW;
vec3 dLightDirNormW;
float dAtten;
mat3 dTBN;
vec4 dReflection;
vec3 dDiffuseLight;
vec3 dSpecularLight;
float ccFresnel;
vec3 ccReflection;
vec3 ccSpecularLight;
float ccSpecularityNoFres;
vec3 sSpecularLight;
#ifdef LIT_DISPERSION
	uniform float material_dispersion;
#endif
#ifndef LIT_OPACITY_FADES_SPECULAR
	uniform float material_alphaFade;
#endif
#ifdef LIT_SSAO
	uniform sampler2D ssaoTexture;
	uniform vec2 ssaoTextureSizeInv;
#endif
#ifdef LIT_SHADOW_CATCHER
	float dShadowCatcher = 1.0;
#endif
#if LIGHT_COUNT > 0
	#include "lightDeclarationPS, LIGHT_COUNT"
#endif
#ifdef LIT_SPECULAR
	#if LIT_FRESNEL_MODEL == NONE && !defined(LIT_REFLECTIONS) && !defined(LIT_DIFFUSE_MAP) 
		#define LIT_OLD_AMBIENT
	#endif
#endif
#ifdef STD_LIGHTMAP_DIR
	uniform float bakeDir;
#endif
#ifdef LIT_LIGHTMAP_BAKING_ADD_AMBIENT
	uniform float ambientBakeOcclusionContrast;
	uniform float ambientBakeOcclusionBrightness;
#endif
`,v0e=`
void main(void) {
	#include "litUserMainStartPS"
	dReflection = vec4(0);
	#ifdef LIT_CLEARCOAT
		ccSpecularLight = vec3(0);
		ccReflection = vec3(0);
	#endif
	#if LIT_NONE_SLICE_MODE == SLICED
		#include "startNineSlicedPS"
	#elif LIT_NONE_SLICE_MODE == TILED
		#include "startNineSlicedTiledPS"
	#endif
	#ifdef LIT_NEEDS_NORMAL
		dVertexNormalW = normalize(vNormalW);
		#ifdef LIT_TANGENTS
			#if defined(LIT_HEIGHTS) || defined(LIT_USE_NORMALS) || defined(LIT_USE_CLEARCOAT_NORMALS) || defined(LIT_GGX_SPECULAR)
				dTangentW = vTangentW;
				dBinormalW = vBinormalW;
			#endif
		#endif
		getViewDir();
		#ifdef LIT_TBN
			getTBN(dTangentW, dBinormalW, dVertexNormalW);
			#ifdef LIT_TWO_SIDED_LIGHTING
				handleTwoSidedLighting();
			#endif
		#endif
	#endif
	evaluateFrontend();
	#include "debugProcessFrontendPS"
	evaluateBackend();
	#include "litUserMainEndPS"
}
`,y0e=`
#ifdef LIT_NEEDS_NORMAL
	#include "cubeMapRotatePS"
	#include "cubeMapProjectPS"
	#include "envProcPS"
#endif
#ifdef LIT_SPECULAR_OR_REFLECTION
	#ifdef LIT_METALNESS
		#include "metalnessModulatePS"
	#endif
	#if LIT_FRESNEL_MODEL == SCHLICK
		#include "fresnelSchlickPS"
	#endif
	#ifdef LIT_IRIDESCENCE
		#include "iridescenceDiffractionPS"
	#endif
#endif
#ifdef LIT_AO
	#include "aoDiffuseOccPS"
	#include "aoSpecOccPS"
#endif
#if LIT_REFLECTION_SOURCE == ENVATLASHQ
	#include "envAtlasPS"
	#include "reflectionEnvHQPS"
#elif LIT_REFLECTION_SOURCE == ENVATLAS
	#include "envAtlasPS"
	#include "reflectionEnvPS"
#elif LIT_REFLECTION_SOURCE == CUBEMAP
	#include "reflectionCubePS"
#elif LIT_REFLECTION_SOURCE == SPHEREMAP
	#include "reflectionSpherePS"
#endif
#ifdef LIT_REFLECTIONS
	#ifdef LIT_CLEARCOAT
		#include "reflectionCCPS"
	#endif
	#ifdef LIT_SHEEN
		#include "reflectionSheenPS"
	#endif
#endif
#ifdef LIT_REFRACTION
	#if defined(LIT_DYNAMIC_REFRACTION)
		#include "refractionDynamicPS"
	#elif defined(LIT_REFLECTIONS)
		#include "refractionCubePS"
	#endif
#endif
#ifdef LIT_SHEEN
	#include "lightSheenPS"
#endif
uniform vec3 material_ambient;
#ifdef LIT_SPECULAR
	#ifdef LIT_LIGHTING
		#ifdef LIT_GGX_SPECULAR
			#include "lightSpecularAnisoGGXPS"
		#else
			#include "lightSpecularBlinnPS"
		#endif
	#endif
#endif
#include "combinePS"
#ifdef LIT_LIGHTMAP
	#include "lightmapAddPS"
#endif
#ifdef LIT_ADD_AMBIENT
	#include "ambientPS"
#endif
#ifdef LIT_MSDF
	#include "msdfPS"
#endif
#ifdef LIT_NEEDS_NORMAL
	#include "viewDirPS"
	#ifdef LIT_SPECULAR
		#ifdef LIT_GGX_SPECULAR
			#include "reflDirAnisoPS"
		#else
			#include "reflDirPS"
		#endif
	#endif
#endif
#include "lightingPS"
`,S0e=`
#include "basePS"
#include "sphericalPS"
#include "decodePS"
#include "gammaPS"
#include "tonemappingPS"
#include "fogPS"
#if LIT_NONE_SLICE_MODE == SLICED
	#include "baseNineSlicedPS"
#elif LIT_NONE_SLICE_MODE == TILED
	#include "baseNineSlicedTiledPS"
#endif
#ifdef LIT_TBN
	#include "TBNPS"
	#ifdef LIT_TWO_SIDED_LIGHTING
		#include "twoSidedLightingPS"
	#endif
#endif
`,x0e=`
#include "varyingsPS"
#include "litUserDeclarationPS"
#include "frontendDeclPS"
#if defined(PICK_PASS) || defined(PREPASS_PASS)
	#include "frontendCodePS"
	#include "litUserCodePS"
	#include "litOtherMainPS"
#elif defined(SHADOW_PASS)
	#include "frontendCodePS"
	#include "litUserCodePS"
	#include "litShadowMainPS"
#else
	#include "litForwardDeclarationPS"
	#include "litForwardPreCodePS"
	#include "frontendCodePS"
	#include "litForwardPostCodePS"
	#include "litForwardBackendPS"
	#include "litUserCodePS"
	#include "litForwardMainPS"
#endif
`,b0e=`
#include "varyingsVS"
#include  "litUserDeclarationVS"
#ifdef VERTEX_COLOR
	attribute vec4 vertex_color;
#endif
#ifdef NINESLICED
	varying vec2 vMask;
	varying vec2 vTiledUv;
	uniform mediump vec4 innerOffset;
	uniform mediump vec2 outerScale;
	uniform mediump vec4 atlasRect;
#endif
vec3 dPositionW;
mat4 dModelMatrix;
#include "transformCoreVS"
#ifdef UV0
	attribute vec2 vertex_texCoord0;
	#include "uv0VS"
#endif
#ifdef UV1
	attribute vec2 vertex_texCoord1;
	#include "uv1VS"
#endif
#ifdef LINEAR_DEPTH
	#ifndef VIEWMATRIX
	#define VIEWMATRIX
		uniform mat4 matrix_view;
	#endif
#endif
#include "transformVS"
#ifdef NORMALS
	#include "normalCoreVS"
	#include "normalVS"
#endif
#ifdef TANGENTS
	attribute vec4 vertex_tangent;
#endif
#include "uvTransformUniformsPS, UV_TRANSFORMS_COUNT"
#ifdef MSDF
	#include "msdfVS"
#endif
#include  "litUserCodeVS"
void main(void) {
	#include "litUserMainStartVS"
	gl_PointSize = 1.0;
	gl_Position = getPosition();
	vPositionW = getWorldPosition();
	#ifdef NORMALS
		vNormalW = getNormal();
	#endif
	#ifdef TANGENTS
		vTangentW = normalize(dNormalMatrix * vertex_tangent.xyz);
		vBinormalW = cross(vNormalW, vTangentW) * vertex_tangent.w;
	#elif defined(GGX_SPECULAR)
		vObjectSpaceUpW = normalize(dNormalMatrix * vec3(0, 1, 0));
	#endif
	#ifdef UV0
		vec2 uv0 = getUv0();
		#ifdef UV0_UNMODIFIED
			vUv0 = uv0;
		#endif
	#endif
	#ifdef UV1
		vec2 uv1 = getUv1();
		#ifdef UV1_UNMODIFIED
			vUv1 = uv1;
		#endif
	#endif
	#include "uvTransformVS, UV_TRANSFORMS_COUNT"
	#ifdef VERTEX_COLOR
		vVertexColor = vertex_color;
	#endif
	#ifdef LINEAR_DEPTH
		vLinearDepth = -(matrix_view * vec4(vPositionW, 1.0)).z;
	#endif
	#ifdef MSDF
		unpackMsdfParams();
	#endif
	#include "litUserMainEndVS"
}
`,w0e=`
#ifdef PICK_PASS
	#include "pickPS"
#endif
#ifdef PREPASS_PASS
	#include "floatAsUintPS"
#endif
void main(void) {
	#include "litUserMainStartPS"
	evaluateFrontend();
	#ifdef PICK_PASS
		gl_FragColor = getPickOutput();
	#endif
	#ifdef PREPASS_PASS
		gl_FragColor = float2vec4(vLinearDepth);
	#endif
	#include "litUserMainEndPS"
}
`,T0e=`
vec3 litArgs_albedo;
float litArgs_opacity;
vec3 litArgs_emission;
vec3 litArgs_worldNormal;
float litArgs_ao;
vec3 litArgs_lightmap;
vec3 litArgs_lightmapDir;
float litArgs_metalness;
vec3 litArgs_specularity;
float litArgs_specularityFactor;
float litArgs_gloss;
float litArgs_sheen_gloss;
vec3 litArgs_sheen_specularity;
float litArgs_transmission;
float litArgs_thickness;
float litArgs_ior;
float litArgs_dispersion;
float litArgs_iridescence_intensity;
float litArgs_iridescence_thickness;
vec3 litArgs_clearcoat_worldNormal;
float litArgs_clearcoat_specularity;
float litArgs_clearcoat_gloss;
`,E0e=`
	#if LIT_NONE_SLICE_MODE == TILED
		const float textureBias = -1000.0;
	#else
		uniform float textureBias;
	#endif
	#include "litShaderArgsPS"
`,A0e=`
#if LIGHT_TYPE != DIRECTIONAL
	uniform vec3 view_position;
	uniform float light_radius;
#endif
#if SHADOW_TYPE == PCSS_32F
	#include "linearizeDepthPS"
#endif
void main(void) {
	#include "litUserMainStartPS"
	evaluateFrontend();
	#ifdef PERSPECTIVE_DEPTH
		float depth = gl_FragCoord.z;
		#if SHADOW_TYPE == PCSS_32F
			#if LIGHT_TYPE != DIRECTIONAL
				depth = linearizeDepthWithParams(depth, camera_params);
			#endif
		#endif
	#else
		float depth = min(distance(view_position, vPositionW) / light_radius, 0.99999);
		#define MODIFIED_DEPTH
	#endif
	#if SHADOW_TYPE == VSM_16F || SHADOW_TYPE == VSM_32F
		#if SHADOW_TYPE == VSM_32F
			float exponent = 15.0;
		#else
			float exponent = 5.54;
		#endif
		depth = 2.0 * depth - 1.0;
		depth =  exp(exponent * depth);
		gl_FragColor = vec4(depth, depth*depth, 1.0, 1.0);
	#else
		#if SHADOW_TYPE == PCSS_32F
			gl_FragColor.r = depth;
		#else
			#ifdef MODIFIED_DEPTH
				gl_FragDepth = depth;
			#endif
			gl_FragColor = vec4(1.0);
		#endif
	#endif
	#include "litUserMainEndPS"
}
`,C0e=`
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
struct Coords {
	vec3 coord0;
	vec3 coord1;
	vec3 coord2;
	vec3 coord3;
};
float LTC_EvaluateRect( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in Coords rectCoords) {
	vec3 v1 = rectCoords.coord1 - rectCoords.coord0;
	vec3 v2 = rectCoords.coord3 - rectCoords.coord0;
	
	vec3 lightNormal = cross( v1, v2 );
	float factor = sign(-dot( lightNormal, P - rectCoords.coord0 ));
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 =  factor * cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords.coord0 - P );
	coords[ 1 ] = mat * ( rectCoords.coord1 - P );
	coords[ 2 ] = mat * ( rectCoords.coord2 - P );
	coords[ 3 ] = mat * ( rectCoords.coord3 - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return result;
}
Coords dLTCCoords;
Coords getLTCLightCoords(vec3 lightPos, vec3 halfWidth, vec3 halfHeight){
	Coords coords;
	coords.coord0 = lightPos + halfWidth - halfHeight;
	coords.coord1 = lightPos - halfWidth - halfHeight;
	coords.coord2 = lightPos - halfWidth + halfHeight;
	coords.coord3 = lightPos + halfWidth + halfHeight;
	return coords;
}
float dSphereRadius;
Coords getSphereLightCoords(vec3 lightPos, vec3 halfWidth, vec3 halfHeight){
	dSphereRadius = max(length(halfWidth), length(halfHeight));
	vec3 f = reflect(normalize(lightPos - view_position), vNormalW);
	vec3 w = normalize(cross(f, halfHeight));
	vec3 h = normalize(cross(f, w));
	return getLTCLightCoords(lightPos, w * dSphereRadius, h * dSphereRadius);
}
vec2 dLTCUV;
#ifdef LIT_CLEARCOAT
	vec2 ccLTCUV;
#endif
vec2 getLTCLightUV(float gloss, vec3 worldNormal, vec3 viewDir)
{
	float roughness = max((1.0 - gloss) * (1.0 - gloss), 0.001);
	return LTC_Uv( worldNormal, viewDir, roughness );
}
vec3 dLTCSpecFres;
#ifdef LIT_CLEARCOAT
	vec3 ccLTCSpecFres;
#endif
vec3 getLTCLightSpecFres(vec2 uv, vec3 specularity)
{
	vec4 t2 = texture2DLod(areaLightsLutTex2, uv, 0.0);
	return specularity * t2.x + ( vec3( 1.0 ) - specularity) * t2.y;
}
void calcLTCLightValues(float gloss, vec3 worldNormal, vec3 viewDir, vec3 specularity, float clearcoatGloss, vec3 clearcoatWorldNormal, float clearcoatSpecularity)
{
	dLTCUV = getLTCLightUV(gloss, worldNormal, viewDir);
	dLTCSpecFres = getLTCLightSpecFres(dLTCUV, specularity); 
#ifdef LIT_CLEARCOAT
	ccLTCUV = getLTCLightUV(clearcoatGloss, clearcoatWorldNormal, viewDir);
	ccLTCSpecFres = getLTCLightSpecFres(ccLTCUV, vec3(clearcoatSpecularity));
#endif
}
void calcRectLightValues(vec3 lightPos, vec3 halfWidth, vec3 halfHeight) {
	dLTCCoords = getLTCLightCoords(lightPos, halfWidth, halfHeight);
}
void calcDiskLightValues(vec3 lightPos, vec3 halfWidth, vec3 halfHeight) {
	calcRectLightValues(lightPos, halfWidth, halfHeight);
}
void calcSphereLightValues(vec3 lightPos, vec3 halfWidth, vec3 halfHeight) {
	dLTCCoords = getSphereLightCoords(lightPos, halfWidth, halfHeight);
}
vec3 SolveCubic(vec4 Coefficient)
{
	float pi = 3.14159;
	Coefficient.xyz /= Coefficient.w;
	Coefficient.yz /= 3.0;
	float A = Coefficient.w;
	float B = Coefficient.z;
	float C = Coefficient.y;
	float D = Coefficient.x;
	vec3 Delta = vec3(
		-Coefficient.z * Coefficient.z + Coefficient.y,
		-Coefficient.y * Coefficient.z + Coefficient.x,
		dot(vec2(Coefficient.z, -Coefficient.y), Coefficient.xy)
	);
	float Discriminant = dot(vec2(4.0 * Delta.x, -Delta.y), Delta.zy);
	vec2 xlc, xsc;
	{
		float A_a = 1.0;
		float C_a = Delta.x;
		float D_a = -2.0 * B * Delta.x + Delta.y;
		float Theta = atan(sqrt(Discriminant), -D_a) / 3.0;
		float x_1a = 2.0 * sqrt(-C_a) * cos(Theta);
		float x_3a = 2.0 * sqrt(-C_a) * cos(Theta + (2.0 / 3.0) * pi);
		float xl;
		if ((x_1a + x_3a) > 2.0 * B)
			xl = x_1a;
		else
			xl = x_3a;
		xlc = vec2(xl - B, A);
	}
	{
		float A_d = D;
		float C_d = Delta.z;
		float D_d = -D * Delta.y + 2.0 * C * Delta.z;
		float Theta = atan(D * sqrt(Discriminant), -D_d) / 3.0;
		float x_1d = 2.0 * sqrt(-C_d) * cos(Theta);
		float x_3d = 2.0 * sqrt(-C_d) * cos(Theta + (2.0 / 3.0) * pi);
		float xs;
		if (x_1d + x_3d < 2.0 * C)
			xs = x_1d;
		else
			xs = x_3d;
		xsc = vec2(-D, xs + C);
	}
	float E =  xlc.y * xsc.y;
	float F = -xlc.x * xsc.y - xlc.y * xsc.x;
	float G =  xlc.x * xsc.x;
	vec2 xmc = vec2(C * F - B * G, -B * F + C * E);
	vec3 Root = vec3(xsc.x / xsc.y, xmc.x / xmc.y, xlc.x / xlc.y);
	if (Root.x < Root.y && Root.x < Root.z)
		Root.xyz = Root.yxz;
	else if (Root.z < Root.x && Root.z < Root.y)
		Root.xyz = Root.xzy;
	return Root;
}
float LTC_EvaluateDisk(vec3 N, vec3 V, vec3 P, mat3 Minv, Coords points)
{
	vec3 T1 = normalize(V - N * dot(V, N));
	vec3 T2 = cross(N, T1);
	mat3 R = transposeMat3( mat3( T1, T2, N ) );
	vec3 L_[ 3 ];
	L_[ 0 ] = R * ( points.coord0 - P );
	L_[ 1 ] = R * ( points.coord1 - P );
	L_[ 2 ] = R * ( points.coord2 - P );
	vec3 C  = 0.5 * (L_[0] + L_[2]);
	vec3 V1 = 0.5 * (L_[1] - L_[2]);
	vec3 V2 = 0.5 * (L_[1] - L_[0]);
	C  = Minv * C;
	V1 = Minv * V1;
	V2 = Minv * V2;
	float a, b;
	float d11 = dot(V1, V1);
	float d22 = dot(V2, V2);
	float d12 = dot(V1, V2);
	if (abs(d12) / sqrt(d11 * d22) > 0.0001)
	{
		float tr = d11 + d22;
		float det = -d12 * d12 + d11 * d22;
		det = sqrt(det);
		float u = 0.5 * sqrt(tr - 2.0 * det);
		float v = 0.5 * sqrt(tr + 2.0 * det);
		float e_max = (u + v) * (u + v);
		float e_min = (u - v) * (u - v);
		vec3 V1_, V2_;
		if (d11 > d22)
		{
			V1_ = d12 * V1 + (e_max - d11) * V2;
			V2_ = d12 * V1 + (e_min - d11) * V2;
		}
		else
		{
			V1_ = d12*V2 + (e_max - d22)*V1;
			V2_ = d12*V2 + (e_min - d22)*V1;
		}
		a = 1.0 / e_max;
		b = 1.0 / e_min;
		V1 = normalize(V1_);
		V2 = normalize(V2_);
	}
	else
	{
		a = 1.0 / dot(V1, V1);
		b = 1.0 / dot(V2, V2);
		V1 *= sqrt(a);
		V2 *= sqrt(b);
	}
	vec3 V3 = normalize(cross(V1, V2));
	if (dot(C, V3) < 0.0)
		V3 *= -1.0;
	float L  = dot(V3, C);
	float x0 = dot(V1, C) / L;
	float y0 = dot(V2, C) / L;
	float E1 = inversesqrt(a);
	float E2 = inversesqrt(b);
	a *= L * L;
	b *= L * L;
	float c0 = a * b;
	float c1 = a * b * (1.0 + x0 * x0 + y0 * y0) - a - b;
	float c2 = 1.0 - a * (1.0 + x0 * x0) - b * (1.0 + y0 * y0);
	float c3 = 1.0;
	vec3 roots = SolveCubic(vec4(c0, c1, c2, c3));
	float e1 = roots.x;
	float e2 = roots.y;
	float e3 = roots.z;
	vec3 avgDir = vec3(a * x0 / (a - e2), b * y0 / (b - e2), 1.0);
	mat3 rotate = mat3(V1, V2, V3);
	avgDir = rotate * avgDir;
	avgDir = normalize(avgDir);
	float L1 = sqrt(-e2 / e3);
	float L2 = sqrt(-e2 / e1);
	float formFactor = max(0.0, L1 * L2 * inversesqrt((1.0 + L1 * L1) * (1.0 + L2 * L2)));
	
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	vec2 uv = vec2(avgDir.z * 0.5 + 0.5, formFactor);
	uv = uv*LUT_SCALE + LUT_BIAS;
	float scale = texture2DLod(areaLightsLutTex2, uv, 0.0).w;
	return formFactor*scale;
}
float FixNan(float value) {
	#ifdef WEBGPU
		return value != value ? 0.0 : value;
	#else
		return isnan(value) ? 0.0 : value;
	#endif
}
float getRectLightDiffuse(vec3 worldNormal, vec3 viewDir, vec3 lightDir, vec3 lightDirNorm) {
	return LTC_EvaluateRect( worldNormal, viewDir, vPositionW, mat3( 1.0 ), dLTCCoords );
}
float getDiskLightDiffuse(vec3 worldNormal, vec3 viewDir, vec3 lightDir, vec3 lightDirNorm) {
	return FixNan(LTC_EvaluateDisk( worldNormal, viewDir, vPositionW, mat3( 1.0 ), dLTCCoords ));
}
float getSphereLightDiffuse(vec3 worldNormal, vec3 viewDir, vec3 lightDir, vec3 lightDirNorm) {
	float falloff = dSphereRadius / (dot(lightDir, lightDir) + dSphereRadius);
	return FixNan(getLightDiffuse(worldNormal, viewDir, lightDirNorm) * falloff);
}
mat3 getLTCLightInvMat(vec2 uv)
{
	vec4 t1 = texture2DLod(areaLightsLutTex1, uv, 0.0);
	return mat3(
		vec3( t1.x, 0, t1.y ),
		vec3(	0, 1,	0 ),
		vec3( t1.z, 0, t1.w )
	);
}
float calcRectLightSpecular(vec3 worldNormal, vec3 viewDir, vec2 uv) {
	mat3 mInv = getLTCLightInvMat(uv);
	return LTC_EvaluateRect( worldNormal, viewDir, vPositionW, mInv, dLTCCoords );
}
float getRectLightSpecular(vec3 worldNormal, vec3 viewDir) {
	return calcRectLightSpecular(worldNormal, viewDir, dLTCUV);
}
float calcDiskLightSpecular(vec3 worldNormal, vec3 viewDir, vec2 uv) {
	mat3 mInv = getLTCLightInvMat(uv);
	return LTC_EvaluateDisk( worldNormal, viewDir, vPositionW, mInv, dLTCCoords );
}
float getDiskLightSpecular(vec3 worldNormal, vec3 viewDir) {
	return calcDiskLightSpecular(worldNormal, viewDir, dLTCUV);
}
float getSphereLightSpecular(vec3 worldNormal, vec3 viewDir) {
	return calcDiskLightSpecular(worldNormal, viewDir, dLTCUV);
}
`,P0e=`
#ifdef STD_METALNESS_CONSTANT
uniform float material_metalness;
#endif
void getMetalness() {
	float metalness = 1.0;
	#ifdef STD_METALNESS_CONSTANT
	metalness *= material_metalness;
	#endif
	#ifdef STD_METALNESS_TEXTURE
	metalness *= texture2DBias({STD_METALNESS_TEXTURE_NAME}, {STD_METALNESS_TEXTURE_UV}, textureBias).{STD_METALNESS_TEXTURE_CHANNEL};
	#endif
	#ifdef STD_METALNESS_VERTEX
	metalness *= saturate(vVertexColor.{STD_METALNESS_VERTEX_CHANNEL});
	#endif
	dMetalness = metalness;
}
`,I0e=`
uniform sampler2D texture_msdfMap;
float median(float r, float g, float b) {
	return max(min(r, g), min(max(r, g), b));
}
float map (float min, float max, float v) {
	return (v - min) / (max - min);
}
uniform float font_sdfIntensity;
uniform float font_pxrange;
uniform float font_textureWidth;
#ifndef LIT_MSDF_TEXT_ATTRIBUTE
	uniform vec4 outline_color;
	uniform float outline_thickness;
	uniform vec4 shadow_color;
	uniform vec2 shadow_offset;
#else
	varying vec4 outline_color;
	varying float outline_thickness;
	varying vec4 shadow_color;
	varying vec2 shadow_offset;
#endif
vec4 applyMsdf(vec4 color) {
	color.rgb = gammaCorrectInput(color.rgb);
	vec3 tsample = texture2D(texture_msdfMap, vUv0).rgb;
	vec2 uvShdw = vUv0 - shadow_offset;
	vec3 ssample = texture2D(texture_msdfMap, uvShdw).rgb;
	float sigDist = median(tsample.r, tsample.g, tsample.b);
	float sigDistShdw = median(ssample.r, ssample.g, ssample.b);
	float smoothingMax = 0.2;
	vec2 w = fwidth(vUv0);
	float smoothing = clamp(w.x * font_textureWidth / font_pxrange, 0.0, smoothingMax);
	float mapMin = 0.05;
	float mapMax = clamp(1.0 - font_sdfIntensity, mapMin, 1.0);
	float sigDistInner = map(mapMin, mapMax, sigDist);
	float sigDistOutline = map(mapMin, mapMax, sigDist + outline_thickness);
	sigDistShdw = map(mapMin, mapMax, sigDistShdw + outline_thickness);
	float center = 0.5;
	float inside = smoothstep(center-smoothing, center+smoothing, sigDistInner);
	float outline = smoothstep(center-smoothing, center+smoothing, sigDistOutline);
	float shadow = smoothstep(center-smoothing, center+smoothing, sigDistShdw);
	vec4 tcolor = (outline > inside) ? outline * vec4(outline_color.a * outline_color.rgb, outline_color.a) : vec4(0.0);
	tcolor = mix(tcolor, color, inside);
	vec4 scolor = (shadow > outline) ? shadow * vec4(shadow_color.a * shadow_color.rgb, shadow_color.a) : tcolor;
	tcolor = mix(scolor, tcolor, outline);
	tcolor.rgb = gammaCorrectOutput(tcolor.rgb);
	
	return tcolor;
}
`,M0e=`
vec3 getSpecularModulate(in vec3 specularity, in vec3 albedo, in float metalness, in float f0) {
	vec3 dielectricF0 = f0 * specularity;
	return mix(dielectricF0, albedo, metalness);
}
vec3 getAlbedoModulate(in vec3 albedo, in float metalness) {
	return albedo * (1.0 - metalness);
}
`,R0e=`
	varying vec2 uv0;
	uniform sampler2DArray morphTexture;
	uniform highp float morphFactor[{MORPH_TEXTURE_MAX_COUNT}];
	uniform highp uint morphIndex[{MORPH_TEXTURE_MAX_COUNT}];
	uniform int count;
	#ifdef MORPH_INT
		uniform vec3 aabbSize;
		uniform vec3 aabbMin;
	#endif
	void main (void) {
		highp vec3 color = vec3(0, 0, 0);
		for (int i = 0; i < count; i++) {
			uint textureIndex = morphIndex[i];
			vec3 delta = texture(morphTexture, vec3(uv0, textureIndex)).xyz;
			color += morphFactor[i] * delta;
		}
		#ifdef MORPH_INT
			color = (color - aabbMin) / aabbSize * 65535.0;
			gl_FragColor = uvec4(color, 1u);
		#else
			gl_FragColor = vec4(color, 1.0);
		#endif
	}
`,D0e=`
	attribute vec2 vertex_position;
	varying vec2 uv0;
	void main(void) {
		gl_Position = vec4(vertex_position, 0.5, 1.0);
		uv0 = vertex_position.xy * 0.5 + 0.5;
	}
`,L0e=`
attribute vec3 vertex_outlineParameters;
attribute vec3 vertex_shadowParameters;
varying vec4 outline_color;
varying float outline_thickness;
varying vec4 shadow_color;
varying vec2 shadow_offset;
void unpackMsdfParams() {
	vec3 little = mod(vertex_outlineParameters, 256.);
	vec3 big = (vertex_outlineParameters - little) / 256.;
	outline_color.rb = little.xy / 255.;
	outline_color.ga = big.xy / 255.;
	outline_thickness = little.z / 255. * 0.2;
	little = mod(vertex_shadowParameters, 256.);
	big = (vertex_shadowParameters - little) / 256.;
	shadow_color.rb = little.xy / 255.;
	shadow_color.ga = big.xy / 255.;
	shadow_offset = (vec2(little.z, big.z) / 127. - 1.) * 0.005;
}
`,O0e=`
mat3 dNormalMatrix;
vec3 getNormal() {
	dNormalMatrix = getNormalMatrix(dModelMatrix);
	vec3 localNormal = getLocalNormal(vertex_normal);
	return normalize(dNormalMatrix * localNormal);
}
`,N0e=`
attribute vec3 vertex_normal;
uniform mat3 matrix_normal;
#ifdef MORPHING_NORMAL
	#ifdef MORPHING_INT
		uniform highp usampler2D morphNormalTex;
	#else
		uniform highp sampler2D morphNormalTex;
	#endif
#endif
vec3 getLocalNormal(vec3 vertexNormal) {
	vec3 localNormal = vertex_normal;
	#ifdef MORPHING_NORMAL
		ivec2 morphUV = getTextureMorphCoords();
		#ifdef MORPHING_INT
			vec3 morphNormal = vec3(texelFetch(morphNormalTex, ivec2(morphUV), 0).xyz) / 65535.0 * 2.0 - 1.0;
		#else
			vec3 morphNormal = texelFetch(morphNormalTex, ivec2(morphUV), 0).xyz;
		#endif
		localNormal += morphNormal;
	#endif
	return localNormal;
}
#if defined(SKIN) || defined(BATCH)
	mat3 getNormalMatrix(mat4 modelMatrix) {
		return mat3(modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz);
	}
#elif defined(INSTANCING)
	mat3 getNormalMatrix(mat4 modelMatrix) {
		return mat3(modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz);
	}
#else
	mat3 getNormalMatrix(mat4 modelMatrix) {
		return matrix_normal;
	}
#endif
`,k0e=`
#ifdef STD_NORMAL_TEXTURE
	uniform float material_bumpiness;
#endif
#ifdef STD_NORMALDETAIL_TEXTURE
	uniform float material_normalDetailMapBumpiness;
	vec3 blendNormals(vec3 n1, vec3 n2) {
		n1 += vec3(0, 0, 1);
		n2 *= vec3(-1, -1, 1);
		return n1 * dot(n1, n2) / n1.z - n2;
	}
#endif
void getNormal() {
#ifdef STD_NORMAL_TEXTURE
	vec3 normalMap = {STD_NORMAL_TEXTURE_DECODE}(texture2DBias({STD_NORMAL_TEXTURE_NAME}, {STD_NORMAL_TEXTURE_UV}, textureBias));
	normalMap = mix(vec3(0.0, 0.0, 1.0), normalMap, material_bumpiness);
	#ifdef STD_NORMALDETAIL_TEXTURE
		vec3 normalDetailMap = {STD_NORMALDETAIL_TEXTURE_DECODE}(texture2DBias({STD_NORMALDETAIL_TEXTURE_NAME}, {STD_NORMALDETAIL_TEXTURE_UV}, textureBias));
		normalDetailMap = mix(vec3(0.0, 0.0, 1.0), normalDetailMap, material_normalDetailMapBumpiness);
		normalMap = blendNormals(normalMap, normalDetailMap);
	#endif
	dNormalW = normalize(dTBN * normalMap);
#else
	dNormalW = dVertexNormalW;
#endif
}
`,F0e=`
uniform float material_opacity;
void getOpacity() {
	dAlpha = material_opacity;
	#ifdef STD_OPACITY_TEXTURE
	dAlpha *= texture2DBias({STD_OPACITY_TEXTURE_NAME}, {STD_OPACITY_TEXTURE_UV}, textureBias).{STD_OPACITY_TEXTURE_CHANNEL};
	#endif
	#ifdef STD_OPACITY_VERTEX
	dAlpha *= clamp(vVertexColor.{STD_OPACITY_VERTEX_CHANNEL}, 0.0, 1.0);
	#endif
}
`,B0e=`
#if STD_OPACITY_DITHER == BAYER8
	#include "bayerPS"
#endif
uniform vec4 blueNoiseJitter;
#if STD_OPACITY_DITHER == BLUENOISE
	uniform sampler2D blueNoiseTex32;
#endif
void opacityDither(float alpha, float id) {
	#if STD_OPACITY_DITHER == BAYER8
		float noise = bayer8(floor(mod(gl_FragCoord.xy + blueNoiseJitter.xy + id, 8.0))) / 64.0;
	#else
		#if STD_OPACITY_DITHER == BLUENOISE
			vec2 uv = fract(gl_FragCoord.xy / 32.0 + blueNoiseJitter.xy + id);
			float noise = texture2DLod(blueNoiseTex32, uv, 0.0).y;
		#endif
		#if STD_OPACITY_DITHER == IGNNOISE
			vec3 magic = vec3(0.06711056, 0.00583715, 52.9829189);
			float noise = fract(magic.z * fract(dot(gl_FragCoord.xy + blueNoiseJitter.xy + id, magic.xy)));
		#endif
	#endif
	noise = pow(noise, 2.2);
	if (alpha < noise)
		discard;
}
`,U0e=`
`,z0e=`
#if LIT_BLEND_TYPE == NORMAL || LIT_BLEND_TYPE == ADDITIVEALPHA || defined(LIT_ALPHA_TO_COVERAGE)
	gl_FragColor.a = litArgs_opacity;
#elif LIT_BLEND_TYPE == PREMULTIPLIED
	gl_FragColor.rgb *= litArgs_opacity;
	gl_FragColor.a = litArgs_opacity;
#else
	gl_FragColor.a = 1.0;
#endif
`,V0e=`
varying vec2 vUv0;
uniform sampler2D source;
void main(void) {
	gl_FragColor = texture2D(source, vUv0);
}
`,j0e=`
uniform vec3 material_sheen;
void getSheen() {
	vec3 sheenColor = material_sheen;
	#ifdef STD_SHEEN_TEXTURE
	sheenColor *= {STD_SHEEN_TEXTURE_DECODE}(texture2DBias({STD_SHEEN_TEXTURE_NAME}, {STD_SHEEN_TEXTURE_UV}, textureBias)).{STD_SHEEN_TEXTURE_CHANNEL};
	#endif
	#ifdef STD_SHEEN_VERTEX
	sheenColor *= saturate(vVertexColor.{STD_SHEEN_VERTEX_CHANNEL});
	#endif
	sSpecularity = sheenColor;
}
`,$0e=`
uniform float material_sheenGloss;
void getSheenGlossiness() {
	float sheenGlossiness = material_sheenGloss;
	#ifdef STD_SHEENGLOSS_TEXTURE
	sheenGlossiness *= texture2DBias({STD_SHEENGLOSS_TEXTURE_NAME}, {STD_SHEENGLOSS_TEXTURE_UV}, textureBias).{STD_SHEENGLOSS_TEXTURE_CHANNEL};
	#endif
	#ifdef STD_SHEENGLOSS_VERTEX
	sheenGlossiness *= saturate(vVertexColor.{STD_SHEENGLOSS_VERTEX_CHANNEL});
	#endif
	#ifdef STD_SHEENGLOSS_INVERT
	sheenGlossiness = 1.0 - sheenGlossiness;
	#endif
	sGlossiness = sheenGlossiness + 0.0000001;
}
`,H0e=`
uniform float material_heightMapFactor;
void getParallax() {
	float parallaxScale = material_heightMapFactor;
	float height = texture2DBias({STD_HEIGHT_TEXTURE_NAME}, {STD_HEIGHT_TEXTURE_UV}, textureBias).{STD_HEIGHT_TEXTURE_CHANNEL};
	height = height * parallaxScale - parallaxScale * 0.5;
	vec3 viewDirT = dViewDirW * dTBN;
	viewDirT.z += 0.42;
	dUvOffset = height * (viewDirT.xy / viewDirT.z);
}
`,G0e=`
uniform uint meshInstanceId;
vec4 getPickOutput() {
	const vec4 inv = vec4(1.0 / 255.0);
	const uvec4 shifts = uvec4(16, 8, 0, 24);
	uvec4 col = (uvec4(meshInstanceId) >> shifts) & uvec4(0xff);
	return vec4(col) * inv;
}
`,W0e=`
void getReflDir(vec3 worldNormal, vec3 viewDir, float gloss, mat3 tbn) {
	dReflDirW = normalize(-reflect(viewDir, worldNormal));
}
`,X0e=`
void getReflDir(vec3 worldNormal, vec3 viewDir, float gloss, mat3 tbn) {
	float roughness = sqrt(1.0 - min(gloss, 1.0));
	vec2 direction = dAnisotropyRotation;
	vec3 anisotropicT = normalize(tbn * vec3(direction, 0.0));
	vec3 anisotropicB = normalize(cross(tbn[2], anisotropicT));
	float anisotropy = dAnisotropy;
	vec3 anisotropicDirection = anisotropicB;
	vec3 anisotropicTangent = cross(anisotropicDirection, viewDir);
	vec3 anisotropicNormal = cross(anisotropicTangent, anisotropicDirection);
	float bendFactor = 1.0 - anisotropy * (1.0 - roughness);
	float bendFactor4 = bendFactor * bendFactor * bendFactor * bendFactor;
	vec3 bentNormal = normalize(mix(normalize(anisotropicNormal), normalize(worldNormal), bendFactor4));
	dReflDirW = reflect(-viewDir, bentNormal);
}
`,q0e=`
#ifdef LIT_CLEARCOAT
void addReflectionCC(vec3 reflDir, float gloss) {
	ccReflection += calcReflection(reflDir, gloss);
}
#endif
`,Y0e=`
uniform samplerCube texture_cubeMap;
uniform float material_reflectivity;
vec3 calcReflection(vec3 reflDir, float gloss) {
	vec3 lookupVec = cubeMapProject(reflDir);
	lookupVec.x *= -1.0;
	return {reflectionDecode}(textureCube(texture_cubeMap, lookupVec));
}
void addReflection(vec3 reflDir, float gloss) {   
	dReflection += vec4(calcReflection(reflDir, gloss), material_reflectivity);
}
`,K0e=`
#ifndef ENV_ATLAS
	#define ENV_ATLAS
	uniform sampler2D texture_envAtlas;
#endif
uniform samplerCube texture_cubeMap;
uniform float material_reflectivity;
vec3 calcReflection(vec3 reflDir, float gloss) {
	vec3 dir = cubeMapProject(reflDir) * vec3(-1.0, 1.0, 1.0);
	vec2 uv = toSphericalUv(dir);
	float level = saturate(1.0 - gloss) * 5.0;
	float ilevel = floor(level);
	float flevel = level - ilevel;
	vec3 sharp = {reflectionCubemapDecode}(textureCube(texture_cubeMap, dir));
	vec3 roughA = {reflectionDecode}(texture2D(texture_envAtlas, mapRoughnessUv(uv, ilevel)));
	vec3 roughB = {reflectionDecode}(texture2D(texture_envAtlas, mapRoughnessUv(uv, ilevel + 1.0)));
	return processEnvironment(mix(sharp, mix(roughA, roughB, flevel), min(level, 1.0)));
}
void addReflection(vec3 reflDir, float gloss) {   
	dReflection += vec4(calcReflection(reflDir, gloss), material_reflectivity);
}
`,Z0e=`
#ifndef ENV_ATLAS
#define ENV_ATLAS
	uniform sampler2D texture_envAtlas;
#endif
uniform float material_reflectivity;
float shinyMipLevel(vec2 uv) {
	vec2 dx = dFdx(uv);
	vec2 dy = dFdy(uv);
	vec2 uv2 = vec2(fract(uv.x + 0.5), uv.y);
	vec2 dx2 = dFdx(uv2);
	vec2 dy2 = dFdy(uv2);
	float maxd = min(max(dot(dx, dx), dot(dy, dy)), max(dot(dx2, dx2), dot(dy2, dy2)));
	return clamp(0.5 * log2(maxd) - 1.0 + textureBias, 0.0, 5.0);
}
vec3 calcReflection(vec3 reflDir, float gloss) {
	vec3 dir = cubeMapProject(reflDir) * vec3(-1.0, 1.0, 1.0);
	vec2 uv = toSphericalUv(dir);
	float level = saturate(1.0 - gloss) * 5.0;
	float ilevel = floor(level);
	float level2 = shinyMipLevel(uv * atlasSize);
	float ilevel2 = floor(level2);
	vec2 uv0, uv1;
	float weight;
	if (ilevel == 0.0) {
		uv0 = mapShinyUv(uv, ilevel2);
		uv1 = mapShinyUv(uv, ilevel2 + 1.0);
		weight = level2 - ilevel2;
	} else {
		uv0 = uv1 = mapRoughnessUv(uv, ilevel);
		weight = 0.0;
	}
	vec3 linearA = {reflectionDecode}(texture2D(texture_envAtlas, uv0));
	vec3 linearB = {reflectionDecode}(texture2D(texture_envAtlas, uv1));
	vec3 linear0 = mix(linearA, linearB, weight);
	vec3 linear1 = {reflectionDecode}(texture2D(texture_envAtlas, mapRoughnessUv(uv, ilevel + 1.0)));
	return processEnvironment(mix(linear0, linear1, level - ilevel));
}
void addReflection(vec3 reflDir, float gloss) {   
	dReflection += vec4(calcReflection(reflDir, gloss), material_reflectivity);
}
`,Q0e=`
#ifndef VIEWMATRIX
	#define VIEWMATRIX
	uniform mat4 matrix_view;
#endif
uniform sampler2D texture_sphereMap;
uniform float material_reflectivity;
vec3 calcReflection(vec3 reflDir, float gloss) {
	vec3 reflDirV = (mat3(matrix_view) * reflDir);
	float m = 2.0 * sqrt(dot(reflDirV.xy, reflDirV.xy) + (reflDirV.z + 1.0) * (reflDirV.z + 1.0));
	vec2 sphereMapUv = reflDirV.xy / m + 0.5;
	return {reflectionDecode}(texture2D(texture_sphereMap, sphereMapUv));
}
void addReflection(vec3 reflDir, float gloss) {   
	dReflection += vec4(calcReflection(reflDir, gloss), material_reflectivity);
}
`,J0e=`
void addReflectionSheen(vec3 worldNormal, vec3 viewDir, float gloss) {
	float NoV = dot(worldNormal, viewDir);
	float alphaG = gloss * gloss;
	float a = gloss < 0.25 ? -339.2 * alphaG + 161.4 * gloss - 25.9 : -8.48 * alphaG + 14.3 * gloss - 9.95;
	float b = gloss < 0.25 ? 44.0 * alphaG - 23.7 * gloss + 3.26 : 1.97 * alphaG - 3.27 * gloss + 0.72;
	float DG = exp( a * NoV + b ) + ( gloss < 0.25 ? 0.0 : 0.1 * ( gloss - 0.25 ) );
	sReflection += calcReflection(worldNormal, 0.0) * saturate(DG);
}
`,eSe=`
vec3 refract2(vec3 viewVec, vec3 normal, float IOR) {
	float vn = dot(viewVec, normal);
	float k = 1.0 - IOR * IOR * (1.0 - vn * vn);
	vec3 refrVec = IOR * viewVec - (IOR * vn + sqrt(k)) * normal;
	return refrVec;
}
void addRefraction(
	vec3 worldNormal, 
	vec3 viewDir, 
	float thickness, 
	float gloss, 
	vec3 specularity, 
	vec3 albedo, 
	float transmission,
	float refractionIndex,
	float dispersion
#if defined(LIT_IRIDESCENCE)
	, vec3 iridescenceFresnel,
	float iridescenceIntensity
#endif 
) {
	vec4 tmpRefl = dReflection;
	vec3 reflectionDir = refract2(-viewDir, worldNormal, refractionIndex);
	dReflection = vec4(0);
	addReflection(reflectionDir, gloss);
	dDiffuseLight = mix(dDiffuseLight, dReflection.rgb * albedo, transmission);
	dReflection = tmpRefl;
}
`,tSe=`
uniform float material_invAttenuationDistance;
uniform vec3 material_attenuation;
vec3 evalRefractionColor(vec3 refractionVector, float gloss, float refractionIndex) {
	vec4 pointOfRefraction = vec4(vPositionW + refractionVector, 1.0);
	vec4 projectionPoint = matrix_viewProjection * pointOfRefraction;
	vec2 uv = getGrabScreenPos(projectionPoint);
	float iorToRoughness = (1.0 - gloss) * clamp((1.0 / refractionIndex) * 2.0 - 2.0, 0.0, 1.0);
	float refractionLod = log2(uScreenSize.x) * iorToRoughness;
	vec3 refraction = texture2DLod(uSceneColorMap, uv, refractionLod).rgb;
	return refraction;
}
void addRefraction(
	vec3 worldNormal, 
	vec3 viewDir, 
	float thickness, 
	float gloss, 
	vec3 specularity, 
	vec3 albedo, 
	float transmission,
	float refractionIndex,
	float dispersion
#if defined(LIT_IRIDESCENCE)
	, vec3 iridescenceFresnel,
	float iridescenceIntensity
#endif
) {
	vec3 modelScale;
	modelScale.x = length(vec3(matrix_model[0].xyz));
	modelScale.y = length(vec3(matrix_model[1].xyz));
	modelScale.z = length(vec3(matrix_model[2].xyz));
	vec3 scale = thickness * modelScale;
	vec3 refractionVector = normalize(refract(-viewDir, worldNormal, refractionIndex)) * scale;
	vec3 refraction = evalRefractionColor(refractionVector, gloss, refractionIndex);
	#ifdef LIT_DISPERSION
		float halfSpread = (1.0 / refractionIndex - 1.0) * 0.025 * dispersion;
		float refractionIndexR = refractionIndex - halfSpread;
		refractionVector = normalize(refract(-viewDir, worldNormal, refractionIndexR)) * scale;
		refraction.r = evalRefractionColor(refractionVector, gloss, refractionIndexR).r;
		float refractionIndexB = refractionIndex + halfSpread;
		refractionVector = normalize(refract(-viewDir, worldNormal, refractionIndexB)) * scale;
		refraction.b = evalRefractionColor(refractionVector, gloss, refractionIndexB).b;
	#endif
	vec3 transmittance;
	if (material_invAttenuationDistance != 0.0)
	{
		vec3 attenuation = -log(material_attenuation) * material_invAttenuationDistance;
		transmittance = exp(-attenuation * length(refractionVector));
	}
	else
	{
		transmittance = refraction;
	}
	vec3 fresnel = vec3(1.0) - 
		getFresnel(
			dot(viewDir, worldNormal), 
			gloss, 
			specularity
		#if defined(LIT_IRIDESCENCE)
			, iridescenceFresnel,
			iridescenceIntensity
		#endif
		);
	dDiffuseLight = mix(dDiffuseLight, refraction * transmittance * fresnel, transmission);
}
`,iSe=`
varying vec2 vUv0;
#ifdef CUBEMAP_SOURCE
	uniform samplerCube sourceCube;
#else
	uniform sampler2D sourceTex;
#endif
#ifdef USE_SAMPLES_TEX
	uniform sampler2D samplesTex;
	uniform vec2 samplesTexInverseSize;
#endif
uniform vec3 params;
float targetFace() { return params.x; }
float targetTotalPixels() { return params.y; }
float sourceTotalPixels() { return params.z; }
float PI = 3.141592653589793;
float saturate(float x) {
	return clamp(x, 0.0, 1.0);
}
#include "decodePS"
#include "encodePS"
vec3 modifySeams(vec3 dir, float scale) {
	vec3 adir = abs(dir);
	float M = max(max(adir.x, adir.y), adir.z);
	return dir / M * vec3(
		adir.x == M ? 1.0 : scale,
		adir.y == M ? 1.0 : scale,
		adir.z == M ? 1.0 : scale
	);
}
vec2 toSpherical(vec3 dir) {
	return vec2(dir.xz == vec2(0.0) ? 0.0 : atan(dir.x, dir.z), asin(dir.y));
}
vec3 fromSpherical(vec2 uv) {
	return vec3(cos(uv.y) * sin(uv.x),
				sin(uv.y),
				cos(uv.y) * cos(uv.x));
}
vec3 getDirectionEquirect() {
	return fromSpherical((vec2(vUv0.x, 1.0 - vUv0.y) * 2.0 - 1.0) * vec2(PI, PI * 0.5));
}
float signNotZero(float k){
	return(k >= 0.0) ? 1.0 : -1.0;
}
vec2 signNotZero(vec2 v) {
	return vec2(signNotZero(v.x), signNotZero(v.y));
}
vec3 octDecode(vec2 o) {
	vec3 v = vec3(o.x, 1.0 - abs(o.x) - abs(o.y), o.y);
	if (v.y < 0.0) {
		v.xz = (1.0 - abs(v.zx)) * signNotZero(v.xz);
	}
	return normalize(v);
}
vec3 getDirectionOctahedral() {
	return octDecode(vec2(vUv0.x, 1.0 - vUv0.y) * 2.0 - 1.0);
}
vec2 octEncode(in vec3 v) {
	float l1norm = abs(v.x) + abs(v.y) + abs(v.z);
	vec2 result = v.xz * (1.0 / l1norm);
	if (v.y < 0.0) {
		result = (1.0 - abs(result.yx)) * signNotZero(result.xy);
	}
	return result;
}
#ifdef CUBEMAP_SOURCE
	vec4 sampleCubemap(vec3 dir) {
		return textureCube(sourceCube, modifySeams(dir, 1.0));
	}
	vec4 sampleCubemap(vec2 sph) {
		return sampleCubemap(fromSpherical(sph));
	}
	vec4 sampleCubemap(vec3 dir, float mipLevel) {
		return textureCubeLod(sourceCube, modifySeams(dir, 1.0), mipLevel);
	}
	vec4 sampleCubemap(vec2 sph, float mipLevel) {
		return sampleCubemap(fromSpherical(sph), mipLevel);
	}
#else
	vec4 sampleEquirect(vec2 sph) {
		vec2 uv = sph / vec2(PI * 2.0, PI) + 0.5;
		return texture2D(sourceTex, vec2(uv.x, 1.0 - uv.y));
	}
	vec4 sampleEquirect(vec3 dir) {
		return sampleEquirect(toSpherical(dir));
	}
	vec4 sampleEquirect(vec2 sph, float mipLevel) {
		vec2 uv = sph / vec2(PI * 2.0, PI) + 0.5;
		return texture2DLod(sourceTex, vec2(uv.x, 1.0 - uv.y), mipLevel);
	}
	vec4 sampleEquirect(vec3 dir, float mipLevel) {
		return sampleEquirect(toSpherical(dir), mipLevel);
	}
	vec4 sampleOctahedral(vec3 dir) {
		vec2 uv = octEncode(dir) * 0.5 + 0.5;
		return texture2D(sourceTex, vec2(uv.x, 1.0 - uv.y));
	}
	vec4 sampleOctahedral(vec2 sph) {
		return sampleOctahedral(fromSpherical(sph));
	}
	vec4 sampleOctahedral(vec3 dir, float mipLevel) {
		vec2 uv = octEncode(dir) * 0.5 + 0.5;
		return texture2DLod(sourceTex, vec2(uv.x, 1.0 - uv.y), mipLevel);
	}
	vec4 sampleOctahedral(vec2 sph, float mipLevel) {
		return sampleOctahedral(fromSpherical(sph), mipLevel);
	}
#endif
vec3 getDirectionCubemap() {
	vec2 st = vUv0 * 2.0 - 1.0;
	float face = targetFace();
	vec3 vec;
	if (face == 0.0) {
		vec = vec3(1, -st.y, -st.x);
	} else if (face == 1.0) {
		vec = vec3(-1, -st.y, st.x);
	} else if (face == 2.0) {
		vec = vec3(st.x, 1, st.y);
	} else if (face == 3.0) {
		vec = vec3(st.x, -1, -st.y);
	} else if (face == 4.0) {
		vec = vec3(st.x, -st.y, 1);
	} else {
		vec = vec3(-st.x, -st.y, -1);
	}
	return normalize(modifySeams(vec, 1.0));
}
mat3 matrixFromVector(vec3 n) {
	float a = 1.0 / (1.0 + n.z);
	float b = -n.x * n.y * a;
	vec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);
	vec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);
	return mat3(b1, b2, n);
}
mat3 matrixFromVectorSlow(vec3 n) {
	vec3 up = (1.0 - abs(n.y) <= 0.0000001) ? vec3(0.0, 0.0, n.y > 0.0 ? 1.0 : -1.0) : vec3(0.0, 1.0, 0.0);
	vec3 x = normalize(cross(up, n));
	vec3 y = cross(n, x);
	return mat3(x, y, n);
}
vec4 reproject() {
	if ({NUM_SAMPLES} <= 1) {
		return {ENCODE_FUNC}({DECODE_FUNC}({SOURCE_FUNC}({TARGET_FUNC}())));
	} else {
		vec3 t = {TARGET_FUNC}();
		vec3 tu = dFdx(t);
		vec3 tv = dFdy(t);
		vec3 result = vec3(0.0);
		for (float u = 0.0; u < {NUM_SAMPLES_SQRT}; ++u) {
			for (float v = 0.0; v < {NUM_SAMPLES_SQRT}; ++v) {
				result += {DECODE_FUNC}({SOURCE_FUNC}(normalize(t +
															tu * (u / {NUM_SAMPLES_SQRT} - 0.5) +
															tv * (v / {NUM_SAMPLES_SQRT} - 0.5))));
			}
		}
		return {ENCODE_FUNC}(result / ({NUM_SAMPLES_SQRT} * {NUM_SAMPLES_SQRT}));
	}
}
vec4 unpackFloat = vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0);
#ifdef USE_SAMPLES_TEX
	void unpackSample(int i, out vec3 L, out float mipLevel) {
		float u = (float(i * 4) + 0.5) * samplesTexInverseSize.x;
		float v = (floor(u) + 0.5) * samplesTexInverseSize.y;
		vec4 raw;
		raw.x = dot(texture2D(samplesTex, vec2(u, v)), unpackFloat); u += samplesTexInverseSize.x;
		raw.y = dot(texture2D(samplesTex, vec2(u, v)), unpackFloat); u += samplesTexInverseSize.x;
		raw.z = dot(texture2D(samplesTex, vec2(u, v)), unpackFloat); u += samplesTexInverseSize.x;
		raw.w = dot(texture2D(samplesTex, vec2(u, v)), unpackFloat);
		L.xyz = raw.xyz * 2.0 - 1.0;
		mipLevel = raw.w * 8.0;
	}
	vec4 prefilterSamples() {
		mat3 vecSpace = matrixFromVectorSlow({TARGET_FUNC}());
		vec3 L;
		float mipLevel;
		vec3 result = vec3(0.0);
		float totalWeight = 0.0;
		for (int i = 0; i < {NUM_SAMPLES}; ++i) {
			unpackSample(i, L, mipLevel);
			result += {DECODE_FUNC}({SOURCE_FUNC}(vecSpace * L, mipLevel)) * L.z;
			totalWeight += L.z;
		}
		return {ENCODE_FUNC}(result / totalWeight);
	}
	vec4 prefilterSamplesUnweighted() {
		mat3 vecSpace = matrixFromVectorSlow({TARGET_FUNC}());
		vec3 L;
		float mipLevel;
		vec3 result = vec3(0.0);
		float totalWeight = 0.0;
		for (int i = 0; i < {NUM_SAMPLES}; ++i) {
			unpackSample(i, L, mipLevel);
			result += {DECODE_FUNC}({SOURCE_FUNC}(vecSpace * L, mipLevel));
		}
		return {ENCODE_FUNC}(result / float({NUM_SAMPLES}));
	}
#endif
void main(void) {
	gl_FragColor = {PROCESS_FUNC}();
}
`,rSe=`
attribute vec2 vertex_position;
uniform vec4 uvMod;
varying vec2 vUv0;
void main(void) {
	gl_Position = vec4(vertex_position, 0.5, 1.0);
	vUv0 = getImageEffectUV((vertex_position.xy * 0.5 + 0.5) * uvMod.xy + uvMod.zw);
}
`,sSe=`
uniform highp sampler2D uSceneDepthMap;
#ifndef SCREENSIZE
	#define SCREENSIZE
	uniform vec4 uScreenSize;
#endif
#ifndef VIEWMATRIX
	#define VIEWMATRIX
	uniform mat4 matrix_view;
#endif
#ifndef LINEARIZE_DEPTH
	#define LINEARIZE_DEPTH
	
	#ifndef CAMERAPLANES
		#define CAMERAPLANES
		uniform vec4 camera_params;
	#endif
	float linearizeDepth(float z) {
		if (camera_params.w == 0.0)
			return (camera_params.z * camera_params.y) / (camera_params.y + z * (camera_params.z - camera_params.y));
		else
			return camera_params.z + z * (camera_params.y - camera_params.z);
	}
#endif
float delinearizeDepth(float linearDepth) {
	if (camera_params.w == 0.0) {
		return (camera_params.y * (camera_params.z - linearDepth)) / (linearDepth * (camera_params.z - camera_params.y));
	} else {
		return (linearDepth - camera_params.z) / (camera_params.y - camera_params.z);
	}
}
float getLinearScreenDepth(vec2 uv) {
	#ifdef SCENE_DEPTHMAP_LINEAR
		#ifdef SCENE_DEPTHMAP_FLOAT
			return texture2D(uSceneDepthMap, uv).r;
		#else
			ivec2 textureSize = textureSize(uSceneDepthMap, 0);
			ivec2 texel = ivec2(uv * vec2(textureSize));
			vec4 data = texelFetch(uSceneDepthMap, texel, 0);
			uint intBits = 
				(uint(data.r * 255.0) << 24u) |
				(uint(data.g * 255.0) << 16u) |
				(uint(data.b * 255.0) << 8u) |
				uint(data.a * 255.0);
			return uintBitsToFloat(intBits);
		#endif
	#else
		return linearizeDepth(texture2D(uSceneDepthMap, uv).r);
	#endif
}
#ifndef VERTEXSHADER
	float getLinearScreenDepth() {
		vec2 uv = gl_FragCoord.xy * uScreenSize.zw;
		return getLinearScreenDepth(uv);
	}
#endif
float getLinearDepth(vec3 pos) {
	return -(matrix_view * vec4(pos, 1.0)).z;
}
`,nSe=`
int getShadowCascadeIndex(vec4 shadowCascadeDistances, int shadowCascadeCount) {
	float depth = 1.0 / gl_FragCoord.w;
	vec4 comparisons = step(shadowCascadeDistances, vec4(depth));
	int cascadeIndex = int(dot(comparisons, vec4(1.0)));
	return min(cascadeIndex, shadowCascadeCount - 1);
}
int ditherShadowCascadeIndex(int cascadeIndex, vec4 shadowCascadeDistances, int shadowCascadeCount, float blendFactor) {
 
	if (cascadeIndex < shadowCascadeCount - 1) {
		float currentRangeEnd = shadowCascadeDistances[cascadeIndex];
		float transitionStart = blendFactor * currentRangeEnd;
		float depth = 1.0 / gl_FragCoord.w;
		if (depth > transitionStart) {
			float transitionFactor = smoothstep(transitionStart, currentRangeEnd, depth);
			float dither = fract(sin(dot(gl_FragCoord.xy, vec2(12.9898, 78.233))) * 43758.5453);
			if (dither < transitionFactor) {
				cascadeIndex += 1;
			}
		}
	}
	return cascadeIndex;
}
vec3 fadeShadow(vec3 shadowCoord, vec4 shadowCascadeDistances) {				  
	float depth = 1.0 / gl_FragCoord.w;
	if (depth > shadowCascadeDistances.w) {
		shadowCoord.z = -9999999.0;
	}
	return shadowCoord;
}
`,aSe=`
float linstep(float a, float b, float v) {
	return saturate((v - a) / (b - a));
}
float reduceLightBleeding(float pMax, float amount) {
	 return linstep(amount, 1.0, pMax);
}
float chebyshevUpperBound(vec2 moments, float mean, float minVariance, float lightBleedingReduction) {
	float variance = moments.y - (moments.x * moments.x);
	variance = max(variance, minVariance);
	float d = mean - moments.x;
	float pMax = variance / (variance + (d * d));
	pMax = reduceLightBleeding(pMax, lightBleedingReduction);
	return (mean <= moments.x ? 1.0 : pMax);
}
float calculateEVSM(vec3 moments, float Z, float vsmBias, float exponent) {
	Z = 2.0 * Z - 1.0;
	float warpedDepth = exp(exponent * Z);
	moments.xy += vec2(warpedDepth, warpedDepth*warpedDepth) * (1.0 - moments.z);
	float VSMBias = vsmBias;
	float depthScale = VSMBias * exponent * warpedDepth;
	float minVariance1 = depthScale * depthScale;
	return chebyshevUpperBound(moments.xy, warpedDepth, minVariance1, 0.1);
}
float VSM16(TEXTURE_ACCEPT(tex), vec2 texCoords, float resolution, float Z, float vsmBias, float exponent) {
	vec3 moments = texture2DLod(tex, texCoords, 0.0).xyz;
	return calculateEVSM(moments, Z, vsmBias, exponent);
}
float getShadowVSM16(TEXTURE_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams, float exponent) {
	return VSM16(TEXTURE_PASS(shadowMap), shadowCoord.xy, shadowParams.x, shadowCoord.z, shadowParams.y, exponent);
}
float getShadowSpotVSM16(TEXTURE_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams, float exponent, vec3 lightDir) {
	return VSM16(TEXTURE_PASS(shadowMap), shadowCoord.xy, shadowParams.x, length(lightDir) * shadowParams.w + shadowParams.z, shadowParams.y, exponent);
}
float VSM32(TEXTURE_ACCEPT(tex), vec2 texCoords, float resolution, float Z, float vsmBias, float exponent) {
	#ifdef CAPS_TEXTURE_FLOAT_FILTERABLE
		vec3 moments = texture2DLod(tex, texCoords, 0.0).xyz;
	#else
		float pixelSize = 1.0 / resolution;
		texCoords -= vec2(pixelSize);
		vec3 s00 = texture2DLod(tex, texCoords, 0.0).xyz;
		vec3 s10 = texture2DLod(tex, texCoords + vec2(pixelSize, 0), 0.0).xyz;
		vec3 s01 = texture2DLod(tex, texCoords + vec2(0, pixelSize), 0.0).xyz;
		vec3 s11 = texture2DLod(tex, texCoords + vec2(pixelSize), 0.0).xyz;
		vec2 fr = fract(texCoords * resolution);
		vec3 h0 = mix(s00, s10, fr.x);
		vec3 h1 = mix(s01, s11, fr.x);
		vec3 moments = mix(h0, h1, fr.y);
	#endif
	return calculateEVSM(moments, Z, vsmBias, exponent);
}
float getShadowVSM32(TEXTURE_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams, float exponent) {
	return VSM32(TEXTURE_PASS(shadowMap), shadowCoord.xy, shadowParams.x, shadowCoord.z, shadowParams.y, exponent);
}
float getShadowSpotVSM32(TEXTURE_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams, float exponent, vec3 lightDir) {
	float Z = length(lightDir) * shadowParams.w + shadowParams.z;
	return VSM32(TEXTURE_PASS(shadowMap), shadowCoord.xy, shadowParams.x, Z, shadowParams.y, exponent);
}
`,oSe=`
float getShadowPCF1x1(SHADOWMAP_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams) {
	return textureShadow(shadowMap, shadowCoord);
}
float getShadowSpotPCF1x1(SHADOWMAP_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams) {
	return textureShadow(shadowMap, shadowCoord);
}
#ifndef WEBGPU
float getShadowOmniPCF1x1(samplerCubeShadow shadowMap, vec3 shadowCoord, vec4 shadowParams, vec3 lightDir) {
	float shadowZ = length(lightDir) * shadowParams.w + shadowParams.z;
	return texture(shadowMap, vec4(lightDir, shadowZ));
}
#endif
`,lSe=`
float _getShadowPCF3x3(SHADOWMAP_ACCEPT(shadowMap), vec3 shadowCoord, vec3 shadowParams) {
	float z = shadowCoord.z;
	vec2 uv = shadowCoord.xy * shadowParams.x;
	float shadowMapSizeInv = 1.0 / shadowParams.x;
	vec2 base_uv = floor(uv + 0.5);
	float s = (uv.x + 0.5 - base_uv.x);
	float t = (uv.y + 0.5 - base_uv.y); 
	base_uv -= vec2(0.5);
	base_uv *= shadowMapSizeInv;
	float sum = 0.0;
	float uw0 = (3.0 - 2.0 * s);
	float uw1 = (1.0 + 2.0 * s);
	float u0 = (2.0 - s) / uw0 - 1.0;
	float u1 = s / uw1 + 1.0;
	float vw0 = (3.0 - 2.0 * t);
	float vw1 = (1.0 + 2.0 * t);
	float v0 = (2.0 - t) / vw0 - 1.0;
	float v1 = t / vw1 + 1.0;
	u0 = u0 * shadowMapSizeInv + base_uv.x;
	v0 = v0 * shadowMapSizeInv + base_uv.y;
	u1 = u1 * shadowMapSizeInv + base_uv.x;
	v1 = v1 * shadowMapSizeInv + base_uv.y;
	sum += uw0 * vw0 * textureShadow(shadowMap, vec3(u0, v0, z));
	sum += uw1 * vw0 * textureShadow(shadowMap, vec3(u1, v0, z));
	sum += uw0 * vw1 * textureShadow(shadowMap, vec3(u0, v1, z));
	sum += uw1 * vw1 * textureShadow(shadowMap, vec3(u1, v1, z));
	sum *= 1.0f / 16.0;
	return sum;
}
float getShadowPCF3x3(SHADOWMAP_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams) {
	return _getShadowPCF3x3(SHADOWMAP_PASS(shadowMap), shadowCoord, shadowParams.xyz);
}
float getShadowSpotPCF3x3(SHADOWMAP_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams) {
	return _getShadowPCF3x3(SHADOWMAP_PASS(shadowMap), shadowCoord, shadowParams.xyz);
}
#ifndef WEBGPU
float getShadowOmniPCF3x3(samplerCubeShadow shadowMap, vec4 shadowParams, vec3 dir) {
	
	float shadowZ = length(dir) * shadowParams.w + shadowParams.z;
	float z = 1.0 / float(textureSize(shadowMap, 0));
	vec3 tc = normalize(dir);
	mediump vec4 shadows;
	shadows.x = texture(shadowMap, vec4(tc + vec3( z, z, z), shadowZ));
	shadows.y = texture(shadowMap, vec4(tc + vec3(-z,-z, z), shadowZ));
	shadows.z = texture(shadowMap, vec4(tc + vec3(-z, z,-z), shadowZ));
	shadows.w = texture(shadowMap, vec4(tc + vec3( z,-z,-z), shadowZ));
	return dot(shadows, vec4(0.25));
}
float getShadowOmniPCF3x3(samplerCubeShadow shadowMap, vec3 shadowCoord, vec4 shadowParams, vec3 lightDir) {
	return getShadowOmniPCF3x3(shadowMap, shadowParams, lightDir);
}
#endif
`,cSe=`
float _getShadowPCF5x5(SHADOWMAP_ACCEPT(shadowMap), vec3 shadowCoord, vec3 shadowParams) {
	float z = shadowCoord.z;
	vec2 uv = shadowCoord.xy * shadowParams.x;
	float shadowMapSizeInv = 1.0 / shadowParams.x;
	vec2 base_uv = floor(uv + 0.5);
	float s = (uv.x + 0.5 - base_uv.x);
	float t = (uv.y + 0.5 - base_uv.y);
	base_uv -= vec2(0.5);
	base_uv *= shadowMapSizeInv;
	float uw0 = (4.0 - 3.0 * s);
	float uw1 = 7.0;
	float uw2 = (1.0 + 3.0 * s);
	float u0 = (3.0 - 2.0 * s) / uw0 - 2.0;
	float u1 = (3.0 + s) / uw1;
	float u2 = s / uw2 + 2.0;
	float vw0 = (4.0 - 3.0 * t);
	float vw1 = 7.0;
	float vw2 = (1.0 + 3.0 * t);
	float v0 = (3.0 - 2.0 * t) / vw0 - 2.0;
	float v1 = (3.0 + t) / vw1;
	float v2 = t / vw2 + 2.0;
	float sum = 0.0;
	u0 = u0 * shadowMapSizeInv + base_uv.x;
	v0 = v0 * shadowMapSizeInv + base_uv.y;
	u1 = u1 * shadowMapSizeInv + base_uv.x;
	v1 = v1 * shadowMapSizeInv + base_uv.y;
	u2 = u2 * shadowMapSizeInv + base_uv.x;
	v2 = v2 * shadowMapSizeInv + base_uv.y;
	sum += uw0 * vw0 * textureShadow(shadowMap, vec3(u0, v0, z));
	sum += uw1 * vw0 * textureShadow(shadowMap, vec3(u1, v0, z));
	sum += uw2 * vw0 * textureShadow(shadowMap, vec3(u2, v0, z));
	sum += uw0 * vw1 * textureShadow(shadowMap, vec3(u0, v1, z));
	sum += uw1 * vw1 * textureShadow(shadowMap, vec3(u1, v1, z));
	sum += uw2 * vw1 * textureShadow(shadowMap, vec3(u2, v1, z));
	sum += uw0 * vw2 * textureShadow(shadowMap, vec3(u0, v2, z));
	sum += uw1 * vw2 * textureShadow(shadowMap, vec3(u1, v2, z));
	sum += uw2 * vw2 * textureShadow(shadowMap, vec3(u2, v2, z));
	sum *= 1.0f / 144.0;
	sum = saturate(sum);
	return sum;
}
float getShadowPCF5x5(SHADOWMAP_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams) {
	return _getShadowPCF5x5(SHADOWMAP_PASS(shadowMap), shadowCoord, shadowParams.xyz);
}
float getShadowSpotPCF5x5(SHADOWMAP_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams) {
	return _getShadowPCF5x5(SHADOWMAP_PASS(shadowMap), shadowCoord, shadowParams.xyz);
}
`,uSe=`
#define PCSS_SAMPLE_COUNT 16
uniform float pcssDiskSamples[PCSS_SAMPLE_COUNT];
uniform float pcssSphereSamples[PCSS_SAMPLE_COUNT];
vec2 vogelDisk(int sampleIndex, float count, float phi, float r) {
	const float GoldenAngle = 2.4;
	float theta = float(sampleIndex) * GoldenAngle + phi;
	float sine = sin(theta);
	float cosine = cos(theta);
	return vec2(r * cosine, r * sine);
}
vec3 vogelSphere(int sampleIndex, float count, float phi, float r) {
	const float GoldenAngle = 2.4;
	float theta = float(sampleIndex) * GoldenAngle + phi;
	float weight = float(sampleIndex) / count;
	return vec3(cos(theta) * r, weight, sin(theta) * r);
}
float noise(vec2 screenPos) {
	const float PHI = 1.61803398874989484820459;
	return fract(sin(dot(screenPos * PHI, screenPos)) * screenPos.x);
}
float viewSpaceDepth(float depth, mat4 invProjection) {
	float z = depth * 2.0 - 1.0;
	vec4 clipSpace = vec4(0.0, 0.0, z, 1.0);
	vec4 viewSpace = invProjection * clipSpace;
	return viewSpace.z;
}
float PCSSBlockerDistance(TEXTURE_ACCEPT(shadowMap), vec2 sampleCoords[PCSS_SAMPLE_COUNT], vec2 shadowCoords, vec2 searchSize, float z, vec4 cameraParams) {
	float blockers = 0.0;
	float averageBlocker = 0.0;
	for (int i = 0; i < PCSS_SAMPLE_COUNT; i++) {
		vec2 offset = sampleCoords[i] * searchSize;
		vec2 sampleUV = shadowCoords + offset;
		float blocker = texture2DLod(shadowMap, sampleUV, 0.0).r;
		float isBlocking = step(blocker, z);
		blockers += isBlocking;
		averageBlocker += blocker * isBlocking;
	}
	if (blockers > 0.0)
		return averageBlocker / blockers;
	return -1.0;
}
float PCSS(TEXTURE_ACCEPT(shadowMap), vec3 shadowCoords, vec4 cameraParams, vec2 shadowSearchArea) {
	float receiverDepth = linearizeDepthWithParams(shadowCoords.z, cameraParams);
	vec2 samplePoints[PCSS_SAMPLE_COUNT];
	const float PI = 3.141592653589793;
	float noise = noise( gl_FragCoord.xy ) * 2.0 * PI;
	for (int i = 0; i < PCSS_SAMPLE_COUNT; i++) {
		float pcssPresample = pcssDiskSamples[i];
		samplePoints[i] = vogelDisk(i, float(PCSS_SAMPLE_COUNT), noise, pcssPresample);
	}
	float averageBlocker = PCSSBlockerDistance(TEXTURE_PASS(shadowMap), samplePoints, shadowCoords.xy, shadowSearchArea, receiverDepth, cameraParams);
	if (averageBlocker == -1.0) {
		return 1.0;
	} else {
		float depthDifference = (receiverDepth - averageBlocker) / 3.0;
		vec2 filterRadius = depthDifference * shadowSearchArea;
		float shadow = 0.0;
		for (int i = 0; i < PCSS_SAMPLE_COUNT; i ++)
		{
			vec2 sampleUV = samplePoints[i] * filterRadius;
			sampleUV = shadowCoords.xy + sampleUV;
			float depth = texture2DLod(shadowMap, sampleUV, 0.0).r;
			shadow += step(receiverDepth, depth);
		}
		return shadow / float(PCSS_SAMPLE_COUNT);
	} 
}
#ifndef WEBGPU
float PCSSCubeBlockerDistance(samplerCube shadowMap, vec3 lightDirNorm, vec3 samplePoints[PCSS_SAMPLE_COUNT], float z, float shadowSearchArea) {
	float blockers = 0.0;
	float averageBlocker = 0.0;
	for (int i = 0; i < PCSS_SAMPLE_COUNT; i++) {
		vec3 sampleDir = lightDirNorm + samplePoints[i] * shadowSearchArea;
		sampleDir = normalize(sampleDir);
		float blocker = textureCubeLod(shadowMap, sampleDir, 0.0).r;
		float isBlocking = step(blocker, z);
		blockers += isBlocking;
		averageBlocker += blocker * isBlocking;
	}
	if (blockers > 0.0)
		return averageBlocker / blockers;
	return -1.0;
}
float PCSSCube(samplerCube shadowMap, vec4 shadowParams, vec3 shadowCoords, vec4 cameraParams, float shadowSearchArea, vec3 lightDir) {
	
	vec3 samplePoints[PCSS_SAMPLE_COUNT];
	const float PI = 3.141592653589793;
	float noise = noise( gl_FragCoord.xy ) * 2.0 * PI;
	for (int i = 0; i < PCSS_SAMPLE_COUNT; i++) {
		float r = pcssSphereSamples[i];
		samplePoints[i] = vogelSphere(i, float(PCSS_SAMPLE_COUNT), noise, r);
	}
	float receiverDepth = length(lightDir) * shadowParams.w + shadowParams.z;
	vec3 lightDirNorm = normalize(lightDir);
	
	float averageBlocker = PCSSCubeBlockerDistance(shadowMap, lightDirNorm, samplePoints, receiverDepth, shadowSearchArea);
	if (averageBlocker == -1.0) {
		return 1.0;
	} else {
		float filterRadius = ((receiverDepth - averageBlocker) / averageBlocker) * shadowSearchArea;
		float shadow = 0.0;
		for (int i = 0; i < PCSS_SAMPLE_COUNT; i++)
		{
			vec3 offset = samplePoints[i] * filterRadius;
			vec3 sampleDir = lightDirNorm + offset;
			sampleDir = normalize(sampleDir);
			float depth = textureCubeLod(shadowMap, sampleDir, 0.0).r;
			shadow += step(receiverDepth, depth);
		}
		return shadow / float(PCSS_SAMPLE_COUNT);
	}
}
float getShadowOmniPCSS(samplerCube shadowMap, vec3 shadowCoord, vec4 shadowParams, vec4 cameraParams, vec2 shadowSearchArea, vec3 lightDir) {
	return PCSSCube(shadowMap, shadowParams, shadowCoord, cameraParams, shadowSearchArea.x, lightDir);
}
#endif
float getShadowSpotPCSS(TEXTURE_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams, vec4 cameraParams, vec2 shadowSearchArea, vec3 lightDir) {
	return PCSS(TEXTURE_PASS(shadowMap), shadowCoord, cameraParams, shadowSearchArea);
}
`,hSe=`
highp float fractSinRand(const in vec2 uv) {
	const float PI = 3.141592653589793;
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot(uv.xy, vec2(a, b)), sn = mod(dt, PI);
	return fract(sin(sn) * c);
}
struct VogelDiskData {
	float invNumSamples;
	float initialAngle;
	float currentPointId;
};
void prepareDiskConstants(out VogelDiskData data, int sampleCount, float randomSeed) {
	const float pi2 = 6.28318530718;
	data.invNumSamples = 1.0 / float(sampleCount);
	data.initialAngle = randomSeed * pi2;
	data.currentPointId = 0.0;
}
vec2 generateDiskSample(inout VogelDiskData data) {
	const float GOLDEN_ANGLE = 2.399963;
	float r = sqrt((data.currentPointId + 0.5) * data.invNumSamples);
	float theta = data.currentPointId * GOLDEN_ANGLE + data.initialAngle;
	vec2 offset = vec2(cos(theta), sin(theta)) * pow(r, 1.33);
	data.currentPointId += 1.0;
	return offset;
}
void PCSSFindBlocker(TEXTURE_ACCEPT(shadowMap), out float avgBlockerDepth, out int numBlockers,
	vec2 shadowCoords, float z, int shadowBlockerSamples, float penumbraSize, float invShadowMapSize, float randomSeed) {
	VogelDiskData diskData;
	prepareDiskConstants(diskData, shadowBlockerSamples, randomSeed);
	float searchWidth = penumbraSize * invShadowMapSize;
	float blockerSum = 0.0;
	numBlockers = 0;
	for( int i = 0; i < shadowBlockerSamples; ++i ) {
		vec2 diskUV = generateDiskSample(diskData);
		vec2 sampleUV = shadowCoords + diskUV * searchWidth;
		float shadowMapDepth = texture2DLod(shadowMap, sampleUV, 0.0).r;
		if ( shadowMapDepth < z ) {
			blockerSum += shadowMapDepth;
			numBlockers++;
		}
	}
	avgBlockerDepth = blockerSum / float(numBlockers);
}
float PCSSFilter(TEXTURE_ACCEPT(shadowMap), vec2 uv, float receiverDepth, int shadowSamples, float filterRadius, float randomSeed) {
	VogelDiskData diskData;
	prepareDiskConstants(diskData, shadowSamples, randomSeed);
	float sum = 0.0;
	for (int i = 0; i < shadowSamples; i++) {
		vec2 offsetUV = generateDiskSample(diskData) * filterRadius;
		float depth = texture2DLod(shadowMap, uv + offsetUV, 0.0).r;
		sum += step(receiverDepth, depth);
	}
	return sum / float(shadowSamples);
}
float getPenumbra(float dblocker, float dreceiver, float penumbraSize, float penumbraFalloff) {
	float dist = dreceiver - dblocker;
	float penumbra = 1.0 - pow(1.0 - dist, penumbraFalloff);
	return penumbra * penumbraSize;
}
float PCSSDirectional(TEXTURE_ACCEPT(shadowMap), vec3 shadowCoords, vec4 cameraParams, vec4 softShadowParams) {
	float receiverDepth = shadowCoords.z;
	float randomSeed = fractSinRand(gl_FragCoord.xy);
	int shadowSamples = int(softShadowParams.x);
	int shadowBlockerSamples = int(softShadowParams.y);
	float penumbraSize = softShadowParams.z;
	float penumbraFalloff = softShadowParams.w;
	int shadowMapSize = textureSize(shadowMap, 0).x;
	float invShadowMapSize = 1.0 / float(shadowMapSize);
	invShadowMapSize *= float(shadowMapSize) / 2048.0;
	float penumbra;
	if (shadowBlockerSamples > 0) {
		float avgBlockerDepth = 0.0;
		int numBlockers = 0;
		PCSSFindBlocker(TEXTURE_PASS(shadowMap), avgBlockerDepth, numBlockers, shadowCoords.xy, receiverDepth, shadowBlockerSamples, penumbraSize, invShadowMapSize, randomSeed);
		if (numBlockers < 1)
			return 1.0f;
		penumbra = getPenumbra(avgBlockerDepth, shadowCoords.z, penumbraSize, penumbraFalloff);
	} else {
		penumbra = penumbraSize;
	}
	float filterRadius = penumbra * invShadowMapSize;
	return PCSSFilter(TEXTURE_PASS(shadowMap), shadowCoords.xy, receiverDepth, shadowSamples, filterRadius, randomSeed);
}
float getShadowPCSS(TEXTURE_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams, vec4 cameraParams, vec4 softShadowParams, vec3 lightDir) {
	return PCSSDirectional(TEXTURE_PASS(shadowMap), shadowCoord, cameraParams, softShadowParams);
}
`,dSe=`
attribute float vertex_boneIndices;
uniform highp sampler2D texture_poseMap;
mat4 getBoneMatrix(const in float indexFloat) {
	int width = textureSize(texture_poseMap, 0).x;
	int index = int(indexFloat + 0.5) * 3;
	int iy = index / width;
	int ix = index % width;
	vec4 v1 = texelFetch(texture_poseMap, ivec2(ix + 0, iy), 0);
	vec4 v2 = texelFetch(texture_poseMap, ivec2(ix + 1, iy), 0);
	vec4 v3 = texelFetch(texture_poseMap, ivec2(ix + 2, iy), 0);
	return mat4(
		v1.x, v2.x, v3.x, 0,
		v1.y, v2.y, v3.y, 0,
		v1.z, v2.z, v3.z, 0,
		v1.w, v2.w, v3.w, 1
	);
}
`,fSe=`
attribute vec4 vertex_boneWeights;
attribute vec4 vertex_boneIndices;
uniform highp sampler2D texture_poseMap;
void getBoneMatrix(const in int width, const in int index, out vec4 v1, out vec4 v2, out vec4 v3) {
	int v = index / width;
	int u = index % width;
	v1 = texelFetch(texture_poseMap, ivec2(u + 0, v), 0);
	v2 = texelFetch(texture_poseMap, ivec2(u + 1, v), 0);
	v3 = texelFetch(texture_poseMap, ivec2(u + 2, v), 0);
}
mat4 getSkinMatrix(const in vec4 indicesFloat, const in vec4 weights) {
	int width = textureSize(texture_poseMap, 0).x;
	ivec4 indices = ivec4(indicesFloat + 0.5) * 3;
	vec4 a1, a2, a3;
	getBoneMatrix(width, indices.x, a1, a2, a3);
	vec4 b1, b2, b3;
	getBoneMatrix(width, indices.y, b1, b2, b3);
	vec4 c1, c2, c3;
	getBoneMatrix(width, indices.z, c1, c2, c3);
	vec4 d1, d2, d3;
	getBoneMatrix(width, indices.w, d1, d2, d3);
	vec4 v1 = a1 * weights.x + b1 * weights.y + c1 * weights.z + d1 * weights.w;
	vec4 v2 = a2 * weights.x + b2 * weights.y + c2 * weights.z + d2 * weights.w;
	vec4 v3 = a3 * weights.x + b3 * weights.y + c3 * weights.z + d3 * weights.w;
	float one = dot(weights, vec4(1.0));
	return mat4(
		v1.x, v2.x, v3.x, 0,
		v1.y, v2.y, v3.y, 0,
		v1.z, v2.z, v3.z, 0,
		v1.w, v2.w, v3.w, one
	);
}
`,pSe=`
	#define LIT_SKYBOX_INTENSITY
	#include "envProcPS"
	#include "gammaPS"
	#include "tonemappingPS"
	#ifdef PREPASS_PASS
		varying float vLinearDepth;
		#include "floatAsUintPS"
	#endif
	varying vec3 vViewDir;
	uniform float skyboxHighlightMultiplier;
	#ifdef SKY_CUBEMAP
		uniform samplerCube texture_cubeMap;
		#ifdef SKYMESH
			varying vec3 vWorldPos;
			uniform mat3 cubeMapRotationMatrix;
			uniform vec3 projectedSkydomeCenter;
		#endif
	#else
		#include "sphericalPS"
		#include "envAtlasPS"
		uniform sampler2D texture_envAtlas;
		uniform float mipLevel;
	#endif
	void main(void) {
		#ifdef PREPASS_PASS
			gl_FragColor = float2vec4(vLinearDepth);
		#else
			#ifdef SKY_CUBEMAP
				#ifdef SKYMESH
					vec3 envDir = normalize(vWorldPos - projectedSkydomeCenter);
					vec3 dir = envDir * cubeMapRotationMatrix;
				#else
					vec3 dir = vViewDir;
				#endif
				dir.x *= -1.0;
				vec3 linear = {SKYBOX_DECODE_FNC}(textureCube(texture_cubeMap, dir));
			#else
				vec3 dir = vViewDir * vec3(-1.0, 1.0, 1.0);
				vec2 uv = toSphericalUv(normalize(dir));
				vec3 linear = {SKYBOX_DECODE_FNC}(texture2D(texture_envAtlas, mapRoughnessUv(uv, mipLevel)));
			#endif
			if (any(greaterThanEqual(linear, vec3(64.0)))) {
				linear *= skyboxHighlightMultiplier;
			}
			gl_FragColor = vec4(gammaCorrectOutput(toneMap(processEnvironment(linear))), 1.0);
		#endif
	}
`,mSe=`
attribute vec4 aPosition;
uniform mat4 matrix_view;
uniform mat4 matrix_projectionSkybox;
uniform mat3 cubeMapRotationMatrix;
varying vec3 vViewDir;
#ifdef PREPASS_PASS
	varying float vLinearDepth;
#endif
#ifdef SKYMESH
	uniform mat4 matrix_model;
	varying vec3 vWorldPos;
#endif
void main(void) {
	mat4 view = matrix_view;
	#ifdef SKYMESH
		vec4 worldPos = matrix_model * aPosition;
		vWorldPos = worldPos.xyz;
		gl_Position = matrix_projectionSkybox * (view * worldPos);
		#ifdef PREPASS_PASS
			vLinearDepth = -(matrix_view * vec4(vWorldPos, 1.0)).z;
		#endif
	#else
		view[3][0] = view[3][1] = view[3][2] = 0.0;
		gl_Position = matrix_projectionSkybox * (view * aPosition);
		vViewDir = aPosition.xyz * cubeMapRotationMatrix;
		#ifdef PREPASS_PASS
			vLinearDepth = -gl_Position.w;
		#endif
	#endif
	gl_Position.z = gl_Position.w - 1.0e-7;
}
`,gSe=`
#ifdef STD_SPECULAR_CONSTANT
uniform vec3 material_specular;
#endif
void getSpecularity() {
	vec3 specularColor = vec3(1,1,1);
	#ifdef STD_SPECULAR_CONSTANT
	specularColor *= material_specular;
	#endif
	#ifdef STD_SPECULAR_TEXTURE
	specularColor *= {STD_SPECULAR_TEXTURE_DECODE}(texture2DBias({STD_SPECULAR_TEXTURE_NAME}, {STD_SPECULAR_TEXTURE_UV}, textureBias)).{STD_SPECULAR_TEXTURE_CHANNEL};
	#endif
	#ifdef STD_SPECULAR_VERTEX
	specularColor *= saturate(vVertexColor.{STD_SPECULAR_VERTEX_CHANNEL});
	#endif
	dSpecularity = specularColor;
}
`,_Se=`
vec2 toSpherical(vec3 dir) {
	return vec2(dir.xz == vec2(0.0) ? 0.0 : atan(dir.x, dir.z), asin(dir.y));
}
vec2 toSphericalUv(vec3 dir) {
	const float PI = 3.141592653589793;
	vec2 uv = toSpherical(dir) / vec2(PI * 2.0, PI) + 0.5;
	return vec2(uv.x, 1.0 - uv.y);
}
`,vSe=`
#ifdef STD_SPECULARITYFACTOR_CONSTANT
uniform float material_specularityFactor;
#endif
void getSpecularityFactor() {
	float specularityFactor = 1.0;
	#ifdef STD_SPECULARITYFACTOR_CONSTANT
	specularityFactor *= material_specularityFactor;
	#endif
	#ifdef STD_SPECULARITYFACTOR_TEXTURE
	specularityFactor *= texture2DBias({STD_SPECULARITYFACTOR_TEXTURE_NAME}, {STD_SPECULARITYFACTOR_TEXTURE_UV}, textureBias).{STD_SPECULARITYFACTOR_TEXTURE_CHANNEL};
	#endif
	#ifdef STD_SPECULARITYFACTOR_VERTEX
	specularityFactor *= saturate(vVertexColor.{STD_SPECULARITYFACTOR_VERTEX_CHANNEL});
	#endif
	dSpecularityFactor = specularityFactor;
}
`,ySe=`
float getSpotEffect(vec3 lightSpotDir, float lightInnerConeAngle, float lightOuterConeAngle, vec3 lightDirNorm) {
	float cosAngle = dot(lightDirNorm, lightSpotDir);
	return smoothstep(lightOuterConeAngle, lightInnerConeAngle, cosAngle);
}
`,SSe=`
	nineSlicedUv = vec2(vUv0.x, 1.0 - vUv0.y);
`,xSe=`
	vec2 tileMask = step(vMask, vec2(0.99999));
	vec2 tileSize = 0.5 * (innerOffset.xy + innerOffset.zw);
	vec2 tileScale = vec2(1.0) / (vec2(1.0) - tileSize);
	vec2 clampedUv = mix(innerOffset.xy * 0.5, vec2(1.0) - innerOffset.zw * 0.5, fract((vTiledUv - tileSize) * tileScale));
	clampedUv = clampedUv * atlasRect.zw + atlasRect.xy;
	nineSlicedUv = vUv0 * tileMask + clampedUv * (vec2(1.0) - tileMask);
	nineSlicedUv.y = 1.0 - nineSlicedUv.y;
	
`,bSe=`
	float dAlpha = 1.0;
	#if LIT_BLEND_TYPE != NONE || defined(LIT_ALPHA_TEST) || defined(LIT_ALPHA_TO_COVERAGE) || STD_OPACITY_DITHER != NONE
		#ifdef STD_OPACITY_TEXTURE_ALLOCATE
			uniform sampler2D texture_opacityMap;
		#endif
	#endif
	#ifdef FORWARD_PASS
		vec3 dAlbedo;
		vec3 dNormalW;
		vec3 dSpecularity = vec3(0.0);
		float dGlossiness = 0.0;
		#ifdef LIT_REFRACTION
			float dTransmission;
			float dThickness;
		#endif
		#ifdef LIT_SCENE_COLOR
			uniform sampler2D uSceneColorMap;
		#endif
		#ifdef LIT_SCREEN_SIZE
			uniform vec4 uScreenSize;
		#endif
		#ifdef LIT_TRANSFORMS
			uniform mat4 matrix_viewProjection;
			uniform mat4 matrix_model;
		#endif
		#ifdef STD_HEIGHT_MAP
			vec2 dUvOffset;
			#ifdef STD_DIFFUSE_TEXTURE_ALLOCATE
				uniform sampler2D texture_heightMap;
			#endif
		#endif
		#ifdef STD_DIFFUSE_TEXTURE_ALLOCATE
			uniform sampler2D texture_diffuseMap;
		#endif
		#ifdef STD_DIFFUSEDETAIL_TEXTURE_ALLOCATE
			uniform sampler2D texture_diffuseDetailMap;
		#endif
		#ifdef STD_NORMAL_TEXTURE_ALLOCATE
			uniform sampler2D texture_normalMap;
		#endif
		#ifdef STD_NORMALDETAIL_TEXTURE_ALLOCATE
			uniform sampler2D texture_normalDetailMap;
		#endif
		#ifdef STD_THICKNESS_TEXTURE_ALLOCATE
			uniform sampler2D texture_thicknessMap;
		#endif
		#ifdef STD_REFRACTION_TEXTURE_ALLOCATE
			uniform sampler2D texture_refractionMap;
		#endif
		#ifdef LIT_IRIDESCENCE
			float dIridescence;
			float dIridescenceThickness;
			#ifdef STD_IRIDESCENCE_THICKNESS_TEXTURE_ALLOCATE
				uniform sampler2D texture_iridescenceThicknessMap;
			#endif
			#ifdef STD_IRIDESCENCE_TEXTURE_ALLOCATE
				uniform sampler2D texture_iridescenceMap;
			#endif
		#endif
		#ifdef LIT_CLEARCOAT
			float ccSpecularity;
			float ccGlossiness;
			vec3 ccNormalW;
		#endif
		#ifdef LIT_GGX_SPECULAR
			float dAnisotropy;
			vec2 dAnisotropyRotation;
		#endif
		#ifdef LIT_SPECULAR_OR_REFLECTION
			#ifdef LIT_SHEEN
				vec3 sSpecularity;
				float sGlossiness;
				#ifdef STD_SHEEN_TEXTURE_ALLOCATE
					uniform sampler2D texture_sheenMap;
				#endif
				#ifdef STD_SHEENGLOSS_TEXTURE_ALLOCATE
					uniform sampler2D texture_sheenGlossMap;
				#endif
			#endif
			#ifdef LIT_METALNESS
				float dMetalness;
				float dIor;
				#ifdef STD_METALNESS_TEXTURE_ALLOCATE
					uniform sampler2D texture_metalnessMap;
				#endif
			#endif
			#ifdef LIT_SPECULARITY_FACTOR
				float dSpecularityFactor;
				#ifdef STD_SPECULARITYFACTOR_TEXTURE_ALLOCATE
					uniform sampler2D texture_specularityFactorMap;
				#endif
			#endif
			#ifdef STD_SPECULAR_COLOR
				#ifdef STD_SPECULAR_TEXTURE_ALLOCATE
					uniform sampler2D texture_specularMap;
				#endif
			#endif
			#ifdef STD_GLOSS_TEXTURE_ALLOCATE
				uniform sampler2D texture_glossMap;
			#endif
		#endif
		#ifdef STD_AO
			float dAo;
			#ifdef STD_AO_TEXTURE_ALLOCATE
				uniform sampler2D texture_aoMap;
			#endif
			#ifdef STD_AODETAIL_TEXTURE_ALLOCATE
				uniform sampler2D texture_aoDetailMap;
			#endif
		#endif
		vec3 dEmission;
		#ifdef STD_EMISSIVE_TEXTURE_ALLOCATE
			uniform sampler2D texture_emissiveMap;
		#endif
		#ifdef LIT_CLEARCOAT
			#ifdef STD_CLEARCOAT_TEXTURE_ALLOCATE
				uniform sampler2D texture_clearCoatMap;
			#endif
			#ifdef STD_CLEARCOATGLOSS_TEXTURE_ALLOCATE
				uniform sampler2D texture_clearCoatGlossMap;
			#endif
			#ifdef STD_CLEARCOATNORMAL_TEXTURE_ALLOCATE
				uniform sampler2D texture_clearCoatNormalMap;
			#endif
		#endif
		
		#ifdef LIT_GGX_SPECULAR
			#ifdef STD_ANISOTROPY_TEXTURE_ALLOCATE
				uniform sampler2D texture_anisotropyMap;
			#endif
		#endif
		#if defined(STD_LIGHTMAP) || defined(STD_LIGHT_VERTEX_COLOR)
			vec3 dLightmap;
			#ifdef STD_LIGHT_TEXTURE_ALLOCATE
				uniform sampler2D texture_lightMap;
			#endif
		#endif
	#endif
	#include "litShaderCorePS"
`,wSe=`
	#if LIT_BLEND_TYPE != NONE || defined(LIT_ALPHA_TEST) || defined(LIT_ALPHA_TO_COVERAGE) || STD_OPACITY_DITHER != NONE
		#include "opacityPS"
		#if defined(LIT_ALPHA_TEST)
			#include "alphaTestPS"
		#endif
		#if STD_OPACITY_DITHER != NONE
			#include "opacityDitherPS"
		#endif
	#endif
	#ifdef FORWARD_PASS
		#ifdef STD_HEIGHT_MAP
			#include "parallaxPS"
		#endif
		#include  "diffusePS"
		#ifdef LIT_NEEDS_NORMAL
			#include "normalMapPS"
		#endif
		#ifdef LIT_REFRACTION
			#include "transmissionPS"
			#include "thicknessPS"
		#endif
		#ifdef LIT_IRIDESCENCE
			#include "iridescencePS"
			#include "iridescenceThicknessPS"
		#endif
		#ifdef LIT_SPECULAR_OR_REFLECTION
			#ifdef LIT_SHEEN
				#include "sheenPS"
				#include "sheenGlossPS"
			#endif
			#ifdef LIT_METALNESS
				#include "metalnessPS"
				#include "iorPS"
			#endif
			#ifdef LIT_SPECULARITY_FACTOR
				#include "specularityFactorPS"
			#endif
			#ifdef STD_SPECULAR_COLOR
				#include "specularPS"
			#else
				void getSpecularity() { 
					dSpecularity = vec3(1);
				}
			#endif
			#include "glossPS"
		#endif
		#ifdef STD_AO
			#include "aoPS"
		#endif
		#include "emissivePS"
		#ifdef LIT_CLEARCOAT
			#include "clearCoatPS"
			#include "clearCoatGlossPS"
			#include "clearCoatNormalPS"
		#endif
		#if defined(LIT_SPECULAR) && defined(LIT_LIGHTING) && defined(LIT_GGX_SPECULAR)
			#include "anisotropyPS"
		#endif
		#if defined(STD_LIGHTMAP) || defined(STD_LIGHT_VERTEX_COLOR)
			#include "lightmapPS"
		#endif
	#endif
	void evaluateFrontend() {
		#if LIT_BLEND_TYPE != NONE || defined(LIT_ALPHA_TEST) || defined(LIT_ALPHA_TO_COVERAGE) || STD_OPACITY_DITHER != NONE
			getOpacity();
			#if defined(LIT_ALPHA_TEST)
				alphaTest(dAlpha);
			#endif
			#if STD_OPACITY_DITHER != NONE
				opacityDither(dAlpha, 0.0);
			#endif
			litArgs_opacity = dAlpha;
		#endif
		#ifdef FORWARD_PASS
			#ifdef STD_HEIGHT_MAP
				getParallax();
			#endif
			getAlbedo();
			litArgs_albedo = dAlbedo;
			#ifdef LIT_NEEDS_NORMAL
				getNormal();
				litArgs_worldNormal = dNormalW;
			#endif
			#ifdef LIT_REFRACTION
				getRefraction();
				litArgs_transmission = dTransmission;
				getThickness();
				litArgs_thickness = dThickness;
				#ifdef LIT_DISPERSION
					litArgs_dispersion = material_dispersion;
				#endif
			#endif
			#ifdef LIT_IRIDESCENCE
				getIridescence();
				getIridescenceThickness();
				litArgs_iridescence_intensity = dIridescence;
				litArgs_iridescence_thickness = dIridescenceThickness;
			#endif
			#ifdef LIT_SPECULAR_OR_REFLECTION
				#ifdef LIT_SHEEN
					getSheen();
					litArgs_sheen_specularity = sSpecularity;
					getSheenGlossiness();
					litArgs_sheen_gloss = sGlossiness;
				#endif
				#ifdef LIT_METALNESS
					getMetalness();
					litArgs_metalness = dMetalness;
					getIor();
					litArgs_ior = dIor;
				#endif
				#ifdef LIT_SPECULARITY_FACTOR
					getSpecularityFactor();
					litArgs_specularityFactor = dSpecularityFactor;
				#endif
				getGlossiness();
				getSpecularity();
				litArgs_specularity = dSpecularity;
				litArgs_gloss = dGlossiness;
			#endif
			#ifdef STD_AO
				getAO();
				litArgs_ao = dAo;
			#endif
			getEmission();
			litArgs_emission = dEmission;
			#ifdef LIT_CLEARCOAT
				getClearCoat();
				getClearCoatGlossiness();
				getClearCoatNormal();
				litArgs_clearcoat_specularity = ccSpecularity;
				litArgs_clearcoat_gloss = ccGlossiness;
				litArgs_clearcoat_worldNormal = ccNormalW;
			#endif
			#if defined(LIT_SPECULAR) && defined(LIT_LIGHTING) && defined(LIT_GGX_SPECULAR)
				getAnisotropy();
			#endif
			#if defined(STD_LIGHTMAP) || defined(STD_LIGHT_VERTEX_COLOR)
				getLightMap();
				litArgs_lightmap = dLightmap;
				#ifdef STD_LIGHTMAP_DIR
					litArgs_lightmapDir = dLightmapDir;
				#endif
			#endif
		#endif
	}
`,TSe=`
#ifdef LIT_TANGENTS
	#define TBN_TANGENTS
#else
	#if defined(LIT_USE_NORMALS) || defined(LIT_USE_CLEARCOAT_NORMALS)
		#define TBN_DERIVATIVES
	#endif
#endif
#if defined(TBN_DERIVATIVES)
	uniform float tbnBasis;
#endif
void getTBN(vec3 tangent, vec3 binormal, vec3 normal) {
	#ifdef TBN_TANGENTS
		dTBN = mat3(normalize(tangent), normalize(binormal), normalize(normal));
	#elif defined(TBN_DERIVATIVES)
		vec2 uv = {lightingUv};
		vec3 dp1 = dFdx( vPositionW );
		vec3 dp2 = dFdy( vPositionW );
		vec2 duv1 = dFdx( uv );
		vec2 duv2 = dFdy( uv );
		vec3 dp2perp = cross( dp2, normal );
		vec3 dp1perp = cross( normal, dp1 );
		vec3 T = dp2perp * duv1.x + dp1perp * duv2.x;
		vec3 B = dp2perp * duv1.y + dp1perp * duv2.y;
		float denom = max( dot(T,T), dot(B,B) );
		float invmax = (denom == 0.0) ? 0.0 : tbnBasis / sqrt( denom );
		dTBN = mat3(T * invmax, -B * invmax, normal );
	#else
		vec3 B = cross(normal, vObjectSpaceUpW);
		vec3 T = cross(normal, B);
		if (dot(B,B)==0.0)
		{
			float major=max(max(normal.x, normal.y), normal.z);
			if (normal.x == major)
			{
				B = cross(normal, vec3(0,1,0));
				T = cross(normal, B);
			}
			else if (normal.y == major)
			{
				B = cross(normal, vec3(0,0,1));
				T = cross(normal, B);
			}
			else if (normal.z == major)
			{
				B = cross(normal, vec3(1,0,0));
				T = cross(normal, B);
			}
		}
		dTBN = mat3(normalize(T), normalize(B), normalize(normal));
	#endif
}
`,ESe=`
#ifdef STD_THICKNESS_CONSTANT
uniform float material_thickness;
#endif
void getThickness() {
	dThickness = 1.0;
	#ifdef STD_THICKNESS_CONSTANT
	dThickness *= material_thickness;
	#endif
	#ifdef STD_THICKNESS_TEXTURE
	dThickness *= texture2DBias({STD_THICKNESS_TEXTURE_NAME}, {STD_THICKNESS_TEXTURE_UV}, textureBias).{STD_THICKNESS_TEXTURE_CHANNEL};
	#endif
	#ifdef STD_THICKNESS_VERTEX
	dThickness *= saturate(vVertexColor.{STD_THICKNESS_VERTEX_CHANNEL});
	#endif
}
`,ASe=`
#if (TONEMAP == NONE)
	#include "tonemappingNonePS"
#elif TONEMAP == FILMIC
	#include "tonemappingFilmicPS"
#elif TONEMAP == LINEAR
	#include "tonemappingLinearPS"
#elif TONEMAP == HEJL
	#include "tonemappingHejlPS"
#elif TONEMAP == ACES
	#include "tonemappingAcesPS"
#elif TONEMAP == ACES2
	#include "tonemappingAces2PS"
#elif TONEMAP == NEUTRAL
	#include "tonemappingNeutralPS"
#endif
`,CSe=`
uniform float exposure;
vec3 toneMap(vec3 color) {
	float tA = 2.51;
	float tB = 0.03;
	float tC = 2.43;
	float tD = 0.59;
	float tE = 0.14;
	vec3 x = color * exposure;
	return (x*(tA*x+tB))/(x*(tC*x+tD)+tE);
}
`,PSe=`
uniform float exposure;
const mat3 ACESInputMat = mat3(
	0.59719, 0.35458, 0.04823,
	0.07600, 0.90834, 0.01566,
	0.02840, 0.13383, 0.83777
);
const mat3 ACESOutputMat = mat3(
	 1.60475, -0.53108, -0.07367,
	-0.10208,  1.10813, -0.00605,
	-0.00327, -0.07276,  1.07602
);
vec3 RRTAndODTFit(vec3 v) {
	vec3 a = v * (v + 0.0245786) - 0.000090537;
	vec3 b = v * (0.983729 * v + 0.4329510) + 0.238081;
	return a / b;
}
vec3 toneMap(vec3 color) {
	color *= exposure / 0.6;
	color = color * ACESInputMat;
	color = RRTAndODTFit(color);
	color = color * ACESOutputMat;
	color = clamp(color, 0.0, 1.0);
	return color;
}
`,ISe=`
const float A =  0.15;
const float B =  0.50;
const float C =  0.10;
const float D =  0.20;
const float E =  0.02;
const float F =  0.30;
const float W =  11.2;
uniform float exposure;
vec3 uncharted2Tonemap(vec3 x) {
	 return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;
}
vec3 toneMap(vec3 color) {
	color = uncharted2Tonemap(color * exposure);
	vec3 whiteScale = 1.0 / uncharted2Tonemap(vec3(W,W,W));
	color = color * whiteScale;
	return color;
}
`,MSe=`
uniform float exposure;
vec3 toneMap(vec3 color) {
	color *= exposure;
	const float  A = 0.22, B = 0.3, C = .1, D = 0.2, E = .01, F = 0.3;
	const float Scl = 1.25;
	vec3 h = max( vec3(0.0), color - vec3(0.004) );
	return (h*((Scl*A)*h+Scl*vec3(C*B,C*B,C*B))+Scl*vec3(D*E,D*E,D*E)) / (h*(A*h+vec3(B,B,B))+vec3(D*F,D*F,D*F)) - Scl*vec3(E/F,E/F,E/F);
}
`,RSe=`
uniform float exposure;
vec3 toneMap(vec3 color) {
	return color * exposure;
}
`,DSe=`
uniform float exposure;
vec3 toneMap(vec3 color) {
	color *= exposure;
	float startCompression = 0.8 - 0.04;
	float desaturation = 0.15;
	float x = min(color.r, min(color.g, color.b));
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max(color.r, max(color.g, color.b));
	if (peak < startCompression) return color;
	float d = 1. - startCompression;
	float newPeak = 1. - d * d / (peak + d - startCompression);
	color *= newPeak / peak;
	float g = 1. - 1. / (desaturation * (peak - newPeak) + 1.);
	return mix(color, newPeak * vec3(1, 1, 1), g);
}
`,LSe=`
vec3 toneMap(vec3 color) {
	return color;
}
`,OSe=`
#ifdef PIXELSNAP
uniform vec4 uScreenSize;
#endif
#ifdef SCREENSPACE
uniform float projectionFlipY;
#endif
vec4 evalWorldPosition(vec3 vertexPosition, mat4 modelMatrix) {
	vec3 localPos = getLocalPosition(vertexPosition);
	#ifdef NINESLICED
		localPos.xz *= outerScale;
		vec2 positiveUnitOffset = clamp(vertexPosition.xz, vec2(0.0), vec2(1.0));
		vec2 negativeUnitOffset = clamp(-vertexPosition.xz, vec2(0.0), vec2(1.0));
		localPos.xz += (-positiveUnitOffset * innerOffset.xy + negativeUnitOffset * innerOffset.zw) * vertex_texCoord0.xy;
		vTiledUv = (localPos.xz - outerScale + innerOffset.xy) * -0.5 + 1.0;
		localPos.xz *= -0.5;
		localPos = localPos.xzy;
	#endif
	vec4 posW = modelMatrix * vec4(localPos, 1.0);
	#ifdef SCREENSPACE
		posW.zw = vec2(0.0, 1.0);
	#endif
	return posW;
}
vec4 getPosition() {
	dModelMatrix = getModelMatrix();
	vec4 posW = evalWorldPosition(vertex_position.xyz, dModelMatrix);
	dPositionW = posW.xyz;
	vec4 screenPos;
	#ifdef UV1LAYOUT
		screenPos = vec4(vertex_texCoord1.xy * 2.0 - 1.0, 0.5, 1);
		#ifdef WEBGPU
			screenPos.y *= -1.0;
		#endif
	#else
		#ifdef SCREENSPACE
			screenPos = posW;
			screenPos.y *= projectionFlipY;
		#else
			screenPos = matrix_viewProjection * posW;
		#endif
		#ifdef PIXELSNAP
			screenPos.xy = (screenPos.xy * 0.5) + 0.5;
			screenPos.xy *= uScreenSize.xy;
			screenPos.xy = floor(screenPos.xy);
			screenPos.xy *= uScreenSize.zw;
			screenPos.xy = (screenPos.xy * 2.0) - 1.0;
		#endif
	#endif
	return screenPos;
}
vec3 getWorldPosition() {
	return dPositionW;
}
`,NSe=`
attribute vec4 vertex_position;
uniform mat4 matrix_viewProjection;
uniform mat4 matrix_model;
#ifdef MORPHING
	uniform vec2 morph_tex_params;
	attribute uint morph_vertex_id;
	ivec2 getTextureMorphCoords() {
		ivec2 textureSize = ivec2(morph_tex_params);
		int morphGridV = int(morph_vertex_id) / textureSize.x;
		int morphGridU = int(morph_vertex_id) - (morphGridV * textureSize.x);
		#ifdef WEBGPU
			morphGridV = textureSize.y - morphGridV - 1;
		#endif
		return ivec2(morphGridU, morphGridV);
	}
	#ifdef MORPHING_POSITION
		#ifdef MORPHING_INT
			uniform vec3 aabbSize;
			uniform vec3 aabbMin;
			uniform usampler2D morphPositionTex;
		#else
			uniform highp sampler2D morphPositionTex;
		#endif
	#endif
#endif
#ifdef defined(BATCH)
	#include "skinBatchVS"
	mat4 getModelMatrix() {
		return getBoneMatrix(vertex_boneIndices);
	}
#elif defined(SKIN)
	#include "skinVS"
	mat4 getModelMatrix() {
		return matrix_model * getSkinMatrix(vertex_boneIndices, vertex_boneWeights);
	}
#elif defined(INSTANCING)
	#include "transformInstancingVS"
#else
	mat4 getModelMatrix() {
		return matrix_model;
	}
#endif
vec3 getLocalPosition(vec3 vertexPosition) {
	vec3 localPos = vertexPosition;
	#ifdef MORPHING_POSITION
		ivec2 morphUV = getTextureMorphCoords();
		#ifdef MORPHING_INT
			vec3 morphPos = vec3(texelFetch(morphPositionTex, ivec2(morphUV), 0).xyz) / 65535.0 * aabbSize + aabbMin;
		#else
			vec3 morphPos = texelFetch(morphPositionTex, ivec2(morphUV), 0).xyz;
		#endif
		localPos += morphPos;
	#endif
	return localPos;
}
`,kSe=`
attribute vec4 instance_line1;
attribute vec4 instance_line2;
attribute vec4 instance_line3;
attribute vec4 instance_line4;
mat4 getModelMatrix() {
	return matrix_model * mat4(instance_line1, instance_line2, instance_line3, instance_line4);
}
`,FSe=`
#ifdef STD_REFRACTION_CONSTANT
uniform float material_refraction;
#endif
void getRefraction() {
	float refraction = 1.0;
	#ifdef STD_REFRACTION_CONSTANT
	refraction = material_refraction;
	#endif
	#ifdef STD_REFRACTION_TEXTURE
	refraction *= texture2DBias({STD_REFRACTION_TEXTURE_NAME}, {STD_REFRACTION_TEXTURE_UV}, textureBias).{STD_REFRACTION_TEXTURE_CHANNEL};
	#endif
	#ifdef STD_REFRACTION_VERTEX
	refraction *= saturate(vVertexColor.{STD_REFRACTION_VERTEX_CHANNEL});
	#endif
	dTransmission = refraction;
}
`,BSe=`
uniform float twoSidedLightingNegScaleFactor;
void handleTwoSidedLighting() {
	dTBN[2] *= gl_FrontFacing ? twoSidedLightingNegScaleFactor : -twoSidedLightingNegScaleFactor;
}
`,USe=`
#ifdef NINESLICED
	vec2 getUv0() {
		vec2 uv = vertex_position.xz;
		vec2 positiveUnitOffset = clamp(vertex_position.xz, vec2(0.0), vec2(1.0));
		vec2 negativeUnitOffset = clamp(-vertex_position.xz, vec2(0.0), vec2(1.0));
		uv += (-positiveUnitOffset * innerOffset.xy + negativeUnitOffset * innerOffset.zw) * vertex_texCoord0.xy;
		uv = uv * -0.5 + 0.5;
		uv = uv * atlasRect.zw + atlasRect.xy;
		vMask = vertex_texCoord0.xy;
		return uv;
	}
#else
	vec2 getUv0() {
		return vertex_texCoord0;
	}
#endif
`,zSe=`
vec2 getUv1() {
	return vertex_texCoord1;
}
`,VSe=`
vUV{TRANSFORM_UV_{i}}_{TRANSFORM_ID_{i}} = vec2(
	dot(vec3(uv{TRANSFORM_UV_{i}}, 1), {TRANSFORM_NAME_{i}}0),
	dot(vec3(uv{TRANSFORM_UV_{i}}, 1), {TRANSFORM_NAME_{i}}1)
);
`,jSe=`
	uniform vec3 {TRANSFORM_NAME_{i}}0;
	uniform vec3 {TRANSFORM_NAME_{i}}1;
`,$Se=`
void getViewDir() {
	dViewDirW = normalize(view_position - vPositionW);
}
`;const HSe={alphaTestPS:jve,ambientPS:$ve,anisotropyPS:Hve,aoPS:Gve,aoDiffuseOccPS:Wve,aoSpecOccPS:Xve,bakeDirLmEndPS:qve,bakeLmEndPS:Yve,basePS:Kve,baseNineSlicedPS:Zve,baseNineSlicedTiledPS:Qve,bayerPS:Jve,blurVSMPS:eye,clearCoatPS:tye,clearCoatGlossPS:iye,clearCoatNormalPS:rye,clusteredLightCookiesPS:nye,clusteredLightShadowsPS:aye,clusteredLightUtilsPS:sye,clusteredLightPS:oye,combinePS:lye,cookieBlit2DPS:cye,cookieBlitCubePS:uye,cookieBlitVS:hye,cookiePS:dye,cubeMapProjectPS:fye,cubeMapRotatePS:pye,debugOutputPS:mye,debugProcessFrontendPS:gye,detailModesPS:vye,diffusePS:yye,decodePS:_ye,emissivePS:Sye,encodePS:xye,endPS:bye,envAtlasPS:wye,envProcPS:Tye,falloffInvSquaredPS:Eye,falloffLinearPS:Aye,floatAsUintPS:Cye,fogPS:Pye,fresnelSchlickPS:Iye,frontendCodePS:"",frontendDeclPS:"",fullscreenQuadVS:Mye,gammaPS:Rye,gles3PS:Qq,gles3VS:Jq,glossPS:Dye,gsplatCenterVS:Lye,gsplatCornerVS:$ye,gsplatColorVS:Oye,gsplatCommonVS:Nye,gsplatCompressedDataVS:kye,gsplatCompressedSHVS:Fye,gsplatEvalSHVS:Bye,gsplatQuatToMat3VS:Uye,gsplatSogsColorVS:zye,gsplatSogsDataVS:Vye,gsplatSogsSHVS:jye,gsplatDataVS:Hye,gsplatOutputVS:Gye,gsplatPS:Wye,gsplatSHVS:Xye,gsplatSourceVS:qye,gsplatVS:Yye,quadVS:Kye,immediateLinePS:Zye,immediateLineVS:Qye,iridescenceDiffractionPS:Jye,iridescencePS:e0e,iridescenceThicknessPS:t0e,iorPS:i0e,lightDeclarationPS:r0e,lightDiffuseLambertPS:s0e,lightDirPointPS:n0e,lightEvaluationPS:a0e,lightFunctionLightPS:o0e,lightFunctionShadowPS:l0e,lightingPS:c0e,lightmapAddPS:u0e,lightmapPS:h0e,lightSpecularAnisoGGXPS:d0e,lightSpecularBlinnPS:f0e,lightSheenPS:p0e,linearizeDepthPS:m0e,litForwardBackendPS:g0e,litForwardDeclarationPS:_0e,litForwardMainPS:v0e,litForwardPostCodePS:y0e,litForwardPreCodePS:S0e,litMainPS:x0e,litMainVS:b0e,litOtherMainPS:w0e,litShaderArgsPS:T0e,litShaderCorePS:E0e,litShadowMainPS:A0e,litUserDeclarationPS:"",litUserDeclarationVS:"",litUserCodePS:"",litUserCodeVS:"",litUserMainStartPS:"",litUserMainStartVS:"",litUserMainEndPS:"",litUserMainEndVS:"",ltcPS:C0e,metalnessPS:P0e,metalnessModulatePS:M0e,morphPS:R0e,morphVS:D0e,msdfPS:I0e,msdfVS:L0e,normalVS:O0e,normalCoreVS:N0e,normalMapPS:k0e,opacityPS:F0e,opacityDitherPS:B0e,outputPS:U0e,outputAlphaPS:z0e,outputTex2DPS:V0e,sheenPS:j0e,sheenGlossPS:$0e,parallaxPS:H0e,pickPS:G0e,reflDirPS:W0e,reflDirAnisoPS:X0e,reflectionCCPS:q0e,reflectionCubePS:Y0e,reflectionEnvHQPS:K0e,reflectionEnvPS:Z0e,reflectionSpherePS:Q0e,reflectionSheenPS:J0e,refractionCubePS:eSe,refractionDynamicPS:tSe,reprojectPS:iSe,reprojectVS:rSe,screenDepthPS:sSe,shadowCascadesPS:nSe,shadowEVSMPS:aSe,shadowPCF1PS:oSe,shadowPCF3PS:lSe,shadowPCF5PS:cSe,shadowPCSSPS:uSe,shadowSoftPS:hSe,skinBatchVS:dSe,skinVS:fSe,skyboxPS:pSe,skyboxVS:mSe,specularPS:gSe,sphericalPS:_Se,specularityFactorPS:vSe,spotPS:ySe,startNineSlicedPS:SSe,startNineSlicedTiledPS:xSe,stdDeclarationPS:bSe,stdFrontEndPS:wSe,TBNPS:TSe,thicknessPS:ESe,tonemappingPS:ASe,tonemappingAcesPS:CSe,tonemappingAces2PS:PSe,tonemappingFilmicPS:ISe,tonemappingHejlPS:MSe,tonemappingLinearPS:RSe,tonemappingNeutralPS:DSe,tonemappingNonePS:LSe,transformVS:OSe,transformCoreVS:NSe,transformInstancingVS:kSe,transmissionPS:FSe,twoSidedLightingPS:BSe,uv0VS:USe,uv1VS:zSe,uvTransformVS:VSe,uvTransformUniformsPS:jSe,viewDirPS:$Se,webgpuPS:e9,webgpuVS:t9};var GSe=`
uniform alpha_ref: f32;
fn alphaTest(a: f32) {
	if (a < uniform.alpha_ref) {
		discard;
	}
}
`,WSe=`
#if LIT_AMBIENT_SOURCE == AMBIENTSH
	uniform ambientSH: array<vec3f, 9>;
#endif
#if LIT_AMBIENT_SOURCE == ENVALATLAS
	#include "envAtlasPS"
	#ifndef ENV_ATLAS
		#define ENV_ATLAS
		var texture_envAtlas: texture_2d<f32>;
		var texture_envAtlasSampler: sampler;
	#endif
#endif
fn addAmbient(worldNormal: vec3f) {
	#ifdef LIT_AMBIENT_SOURCE == AMBIENTSH
		let n: vec3f = cubeMapRotate(worldNormal);
		let color: vec3f =
			uniform.ambientSH[0] +
			uniform.ambientSH[1] * n.x +
			uniform.ambientSH[2] * n.y +
			uniform.ambientSH[3] * n.z +
			uniform.ambientSH[4] * n.x * n.z +
			uniform.ambientSH[5] * n.z * n.y +
			uniform.ambientSH[6] * n.y * n.x +
			uniform.ambientSH[7] * (3.0 * n.z * n.z - 1.0) +
			uniform.ambientSH[8] * (n.x * n.x - n.y * n.y);
		dDiffuseLight += processEnvironment(max(color, vec3f(0.0)));
	#endif
	#if LIT_AMBIENT_SOURCE == ENVALATLAS
		let dir: vec3f = normalize(cubeMapRotate(worldNormal) * vec3f(-1.0, 1.0, 1.0));
		let uv: vec2f = mapUv(toSphericalUv(dir), vec4f(128.0, 256.0 + 128.0, 64.0, 32.0) / atlasSize);
		let raw: vec4f = textureSample(texture_envAtlas, texture_envAtlasSampler, uv);
		let linear: vec3f = {ambientDecode}(raw);
		dDiffuseLight += processEnvironment(linear);
	#endif
	#if LIT_AMBIENT_SOURCE == CONSTANT
		dDiffuseLight += uniform.light_globalAmbient;
	#endif
}
`,XSe=`
#ifdef LIT_GGX_SPECULAR
	uniform material_anisotropyIntensity: f32;
	uniform material_anisotropyRotation: vec2f;
#endif
fn getAnisotropy() {
	dAnisotropy = 0.0;
	dAnisotropyRotation = vec2f(1.0, 0.0);
#ifdef LIT_GGX_SPECULAR
	dAnisotropy = uniform.material_anisotropyIntensity;
	dAnisotropyRotation = uniform.material_anisotropyRotation;
#endif
#ifdef STD_ANISOTROPY_TEXTURE
	let anisotropyTex: vec3f = textureSampleBias({STD_ANISOTROPY_TEXTURE_NAME}, {STD_ANISOTROPY_TEXTURE_NAME}Sampler, {STD_ANISOTROPY_TEXTURE_UV}, uniform.textureBias).rgb;
	dAnisotropy *= anisotropyTex.b;
	let anisotropyRotationFromTex: vec2f = anisotropyTex.rg * 2.0 - vec2f(1.0);
	let rotationMatrix: mat2x2f = mat2x2f(dAnisotropyRotation.x, dAnisotropyRotation.y, -dAnisotropyRotation.y, dAnisotropyRotation.x);
	dAnisotropyRotation = rotationMatrix * anisotropyRotationFromTex;
#endif
	dAnisotropy = clamp(dAnisotropy, 0.0, 1.0);
}
`,qSe=`
#if defined(STD_AO_TEXTURE) || defined(STD_AO_VERTEX)
	uniform material_aoIntensity: f32;
#endif
#ifdef STD_AODETAIL_TEXTURE
	#include "detailModesPS"
#endif
fn getAO() {
	dAo = 1.0;
	#ifdef STD_AO_TEXTURE
		var aoBase: f32 = textureSampleBias({STD_AO_TEXTURE_NAME}, {STD_AO_TEXTURE_NAME}Sampler, {STD_AO_TEXTURE_UV}, uniform.textureBias).{STD_AO_TEXTURE_CHANNEL};
		#ifdef STD_AODETAIL_TEXTURE
			var aoDetail: f32 = textureSampleBias({STD_AODETAIL_TEXTURE_NAME}, {STD_AODETAIL_TEXTURE_NAME}Sampler, {STD_AODETAIL_TEXTURE_UV}, uniform.textureBias).{STD_AODETAIL_TEXTURE_CHANNEL};
			aoBase = detailMode_{STD_AODETAIL_DETAILMODE}(vec3f(aoBase), vec3f(aoDetail)).r;
		#endif
		dAo = dAo * aoBase;
	#endif
	#ifdef STD_AO_VERTEX
		dAo = dAo * saturate(vVertexColor.{STD_AO_VERTEX_CHANNEL});
	#endif
	#if defined(STD_AO_TEXTURE) || defined(STD_AO_VERTEX)
		dAo = mix(1.0, dAo, uniform.material_aoIntensity);
	#endif
}
`,YSe=`
fn occludeDiffuse(ao: f32) {
	dDiffuseLight = dDiffuseLight * ao;
}
`,KSe=`
#if LIT_OCCLUDE_SPECULAR != NONE
	#ifdef LIT_OCCLUDE_SPECULAR_FLOAT
		uniform material_occludeSpecularIntensity: f32;
	#endif
#endif
fn occludeSpecular(gloss: f32, ao: f32, worldNormal: vec3f, viewDir: vec3f) {
	#if LIT_OCCLUDE_SPECULAR == AO
		#ifdef LIT_OCCLUDE_SPECULAR_FLOAT
			var specOcc: f32 = mix(1.0, ao, uniform.material_occludeSpecularIntensity);
		#else
			var specOcc: f32 = ao;
		#endif
	#endif
	#if LIT_OCCLUDE_SPECULAR == GLOSSDEPENDENT
		var specPow: f32 = exp2(gloss * 11.0);
		var specOcc: f32 = saturate(pow(dot(worldNormal, viewDir) + ao, 0.01 * specPow) - 1.0 + ao);
		#ifdef LIT_OCCLUDE_SPECULAR_FLOAT
			specOcc = mix(1.0, specOcc, uniform.material_occludeSpecularIntensity);
		#endif
	#endif
	#if LIT_OCCLUDE_SPECULAR != NONE
		dSpecularLight = dSpecularLight * specOcc;
		dReflection = dReflection * specOcc;
		#ifdef LIT_SHEEN
			sSpecularLight = sSpecularLight * specOcc;
			sReflection = sReflection * specOcc;
		#endif
	#endif
}
`,ZSe=`
	let dirLm = textureSample(texture_dirLightMap, texture_dirLightMapSampler, vUv1);
	if (uniform.bakeDir > 0.5) {
		if (dAtten > 0.00001) {
			let unpacked_dir = dirLm.xyz * 2.0 - vec3f(1.0);
			dAtten = clamp(dAtten, 0.0, 1.0);
			let combined_dir = dLightDirNormW.xyz * dAtten + unpacked_dir * dirLm.w;
			let finalRgb = normalize(combined_dir) * 0.5 + vec3f(0.5);
			let finalA = max(dirLm.w + dAtten, 1.0 / 255.0);
			output.color = vec4f(finalRgb, finalA);
		} else {
			output.color = dirLm;
		}
	} else {
		let alpha_min = select(0.0, 1.0 / 255.0, dAtten > 0.00001);
		let finalA = max(dirLm.w, alpha_min);
		output.color = vec4f(dirLm.rgb, finalA);
	}
`,QSe=`
#ifdef LIT_LIGHTMAP_BAKING_ADD_AMBIENT
	dDiffuseLight = ((dDiffuseLight - 0.5) * max(uniform.ambientBakeOcclusionContrast + 1.0, 0.0)) + 0.5;
	dDiffuseLight = dDiffuseLight + vec3f(uniform.ambientBakeOcclusionBrightness);
	dDiffuseLight = saturate3(dDiffuseLight);
	dDiffuseLight = dDiffuseLight * dAmbientLight;
#endif
#ifdef LIGHTMAP_RGBM
	var temp_color_rgbm = vec4f(dDiffuseLight, 1.0);
	temp_color_rgbm = vec4f(pow(temp_color_rgbm.rgb, vec3f(0.5)), temp_color_rgbm.a);
	temp_color_rgbm = vec4f(temp_color_rgbm.rgb / 8.0, temp_color_rgbm.a);
	let max_g_b = max(temp_color_rgbm.g, max(temp_color_rgbm.b, 1.0 / 255.0));
	let max_rgb = max(temp_color_rgbm.r, max_g_b);
	temp_color_rgbm.a = clamp(max_rgb, 0.0, 1.0);
	temp_color_rgbm.a = ceil(temp_color_rgbm.a * 255.0) / 255.0;
	temp_color_rgbm = vec4f(temp_color_rgbm.rgb / temp_color_rgbm.a, temp_color_rgbm.a);
	output.color = temp_color_rgbm;
#else
	output.color = vec4f(dDiffuseLight, 1.0);
#endif
`,JSe=`
uniform view_position: vec3f;
uniform light_globalAmbient: vec3f;
fn square(x: f32) -> f32 {
	return x*x;
}
fn saturate(x: f32) -> f32 {
	return clamp(x, 0.0, 1.0);
}
fn saturate3(x: vec3f) -> vec3f {
	return clamp(x, vec3f(0.0), vec3f(1.0));
}
`,exe=`
#define NINESLICED
varying vMask: vec2f;
varying vTiledUv: vec2f;
uniform innerOffset: vec4f;
uniform outerScale: vec2f;
uniform atlasRect: vec4f;
var<private> nineSlicedUv: vec2f;
`,txe=`
#define NINESLICED
#define NINESLICETILED
varying vMask: vec2f;
varying vTiledUv: vec2f;
uniform innerOffset: vec4f;
uniform outerScale: vec2f;
uniform atlasRect: vec4f;
var<private> nineSlicedUv: vec2f;
`,ixe=`
fn bayer2(p: vec2f) -> f32 {
	return (2.0 * p.y + p.x + 1.0) % 4.0;
}
fn bayer4(p: vec2f) -> f32 {
	let p1: vec2f = p % vec2f(2.0);
	let p2: vec2f = floor(0.5 * (p % vec2f(4.0)));
	return 4.0 * bayer2(p1) + bayer2(p2);
}
fn bayer8(p: vec2f) -> f32 {
	let p1: vec2f = p % vec2f(2.0);
	let p2: vec2f = floor(0.5 * (p % vec2f(4.0)));
	let p4: vec2f = floor(0.25 * (p % vec2f(8.0)));
	return 4.0 * (4.0 * bayer2(p1) + bayer2(p2)) + bayer2(p4);
}
`,rxe=`
varying vUv0: vec2f;
var source: texture_2d<f32>;
var sourceSampler: sampler;
#ifdef GAUSS
	uniform weight: array<f32, {SAMPLES}>;
#endif
uniform pixelOffset: vec2f;
@fragment
fn fragmentMain(input: FragmentInput) -> FragmentOutput {
	var output: FragmentOutput;
	var moments: vec3f = vec3f(0.0);
	let uv: vec2f = input.vUv0 - uniform.pixelOffset * (f32({SAMPLES}) * 0.5);
	for (var i: i32 = 0; i < {SAMPLES}; i = i + 1) {
		let c: vec4f = textureSample(source, sourceSampler, uv + uniform.pixelOffset * f32(i));
		#ifdef GAUSS
			moments = moments + c.xyz * uniform.weight[i].element;
		#else
			moments = moments + c.xyz;
		#endif
	}
	#ifndef GAUSS
		moments = moments * (1.0 / f32({SAMPLES}));
	#endif
	output.color = vec4f(moments, 1.0);
	return output;
}
`,sxe=`
uniform material_clearCoat: f32;
fn getClearCoat() {
	ccSpecularity = uniform.material_clearCoat;
	#ifdef STD_CLEARCOAT_TEXTURE
	ccSpecularity = ccSpecularity * textureSampleBias({STD_CLEARCOAT_TEXTURE_NAME}, {STD_CLEARCOAT_TEXTURE_NAME}Sampler, {STD_CLEARCOAT_TEXTURE_UV}, uniform.textureBias).{STD_CLEARCOAT_TEXTURE_CHANNEL};
	#endif
	#ifdef STD_CLEARCOAT_VERTEX
	ccSpecularity = ccSpecularity * saturate(vVertexColor.{STD_CLEARCOAT_VERTEX_CHANNEL});
	#endif
}
`,nxe=`
	uniform material_clearCoatGloss: f32;
fn getClearCoatGlossiness() {
	ccGlossiness = uniform.material_clearCoatGloss;
	#ifdef STD_CLEARCOATGLOSS_TEXTURE
	ccGlossiness = ccGlossiness * textureSampleBias({STD_CLEARCOATGLOSS_TEXTURE_NAME}, {STD_CLEARCOATGLOSS_TEXTURE_NAME}Sampler, {STD_CLEARCOATGLOSS_TEXTURE_UV}, uniform.textureBias).{STD_CLEARCOATGLOSS_TEXTURE_CHANNEL};
	#endif
	#ifdef STD_CLEARCOATGLOSS_VERTEX
	ccGlossiness = ccGlossiness * saturate(vVertexColor.{STD_CLEARCOATGLOSS_VERTEX_CHANNEL});
	#endif
	#ifdef STD_CLEARCOATGLOSS_INVERT
	ccGlossiness = 1.0 - ccGlossiness;
	#endif
	ccGlossiness += 0.0000001;
}
`,axe=`
#ifdef STD_CLEARCOATNORMAL_TEXTURE
	uniform material_clearCoatBumpiness: f32;
#endif
fn getClearCoatNormal() {
#ifdef STD_CLEARCOATNORMAL_TEXTURE
	var normalMap: vec3f = {STD_CLEARCOATNORMAL_TEXTURE_DECODE}(textureSampleBias({STD_CLEARCOATNORMAL_TEXTURE_NAME}, {STD_CLEARCOATNORMAL_TEXTURE_NAME}Sampler, {STD_CLEARCOATNORMAL_TEXTURE_UV}, uniform.textureBias));
	normalMap = mix(vec3f(0.0, 0.0, 1.0), normalMap, uniform.material_clearCoatBumpiness);
	ccNormalW = normalize(dTBN * normalMap);
#else
	ccNormalW = dVertexNormalW;
#endif
}
`,oxe=`
struct FaceCoords {
	uv: vec2f,
	faceIndex: f32,
	tileOffset: vec2f,
}
fn getCubemapFaceCoordinates(dir: vec3f) -> FaceCoords {
	var faceIndex: f32;
	var tileOffset: vec2f;
	var uv: vec2f;
	let vAbs: vec3f = abs(dir);
	var ma: f32;
	if (vAbs.z >= vAbs.x && vAbs.z >= vAbs.y) {
		let is_neg_z = dir.z < 0.0;
		faceIndex = select(4.0, 5.0, is_neg_z);
		ma = 0.5 / vAbs.z;
		uv = vec2f(select(dir.x, -dir.x, is_neg_z), -dir.y);
		tileOffset = vec2f(2.0, select(0.0, 1.0, is_neg_z));
	} else if (vAbs.y >= vAbs.x) {
		let is_neg_y = dir.y < 0.0;
		faceIndex = select(2.0, 3.0, is_neg_y);
		ma = 0.5 / vAbs.y;
		uv = vec2f(dir.x, select(dir.z, -dir.z, is_neg_y));
		tileOffset = vec2f(1.0, select(0.0, 1.0, is_neg_y));
	} else {
		let is_neg_x = dir.x < 0.0;
		faceIndex = select(0.0, 1.0, is_neg_x);
		ma = 0.5 / vAbs.x;
		uv = vec2f(select(-dir.z, dir.z, is_neg_x), -dir.y);
		tileOffset = vec2f(0.0, select(0.0, 1.0, is_neg_x));
	}
	uv = uv * ma + 0.5;
	return FaceCoords(uv, faceIndex, tileOffset);
}
fn getCubemapAtlasCoordinates(omniAtlasViewport: vec3f, shadowEdgePixels: f32, shadowTextureResolution: f32, dir: vec3f) -> vec2f {
	let faceData: FaceCoords = getCubemapFaceCoordinates(dir);
	var uv: vec2f = faceData.uv;
	let tileOffset: vec2f = faceData.tileOffset;
	let atlasFaceSize: f32 = omniAtlasViewport.z;
	let tileSize: f32 = shadowTextureResolution * atlasFaceSize;
	var offset: f32 = shadowEdgePixels / tileSize;
	uv = uv * (1.0 - offset * 2.0) + offset;
	uv = uv * atlasFaceSize;
	uv = uv + tileOffset * atlasFaceSize;
	uv = uv + omniAtlasViewport.xy;
	return uv;
}
`,lxe=`
fn _getCookieClustered(tex: texture_2d<f32>, texSampler: sampler, uv: vec2f, intensity: f32, cookieChannel: vec4f) -> vec3f {
	let pixel: vec4f = mix(vec4f(1.0), textureSampleLevel(tex, texSampler, uv, 0.0), intensity);
	let isRgb: bool = dot(cookieChannel.rgb, vec3f(1.0)) == 3.0;
	return select(vec3f(dot(pixel, cookieChannel)), pixel.rgb, isRgb);
}
fn getCookie2DClustered(tex: texture_2d<f32>, texSampler: sampler, transform: mat4x4f, worldPosition: vec3f, intensity: f32, cookieChannel: vec4f) -> vec3f {
	let projPos: vec4f = transform * vec4f(worldPosition, 1.0);
	return _getCookieClustered(tex, texSampler, projPos.xy / projPos.w, intensity, cookieChannel);
}
fn getCookieCubeClustered(tex: texture_2d<f32>, texSampler: sampler, dir: vec3f, intensity: f32, cookieChannel: vec4f, shadowTextureResolution: f32, shadowEdgePixels: f32, omniAtlasViewport: vec3f) -> vec3f {
	let uv: vec2f = getCubemapAtlasCoordinates(omniAtlasViewport, shadowEdgePixels, shadowTextureResolution, dir);
	return _getCookieClustered(tex, texSampler, uv, intensity, cookieChannel);
}
`,cxe=`
fn _getShadowCoordPerspZbuffer(shadowMatrix: mat4x4f, shadowParams: vec4f, wPos: vec3f) -> vec3f {
	var projPos = shadowMatrix * vec4f(wPos, 1.0);
	return projPos.xyz / projPos.w;
}
fn getShadowCoordPerspZbufferNormalOffset(shadowMatrix: mat4x4f, shadowParams: vec4f, normal: vec3f) -> vec3f {
	let wPos: vec3f = vPositionW + normal * shadowParams.y;
	return _getShadowCoordPerspZbuffer(shadowMatrix, shadowParams, wPos);
}
fn normalOffsetPointShadow(shadowParams: vec4f, lightPos: vec3f, lightDir: vec3f, lightDirNorm: vec3f, normal: vec3f) -> vec3f {
	let distScale: f32 = length(lightDir);
	let wPos: vec3f = vPositionW + normal * shadowParams.y * clamp(1.0 - dot(normal, -lightDirNorm), 0.0, 1.0) * distScale;
	let dir: vec3f = wPos - lightPos;
	return dir;
}
#if defined(CLUSTER_SHADOW_TYPE_PCF1)
	fn getShadowOmniClusteredPCF1(shadowMap: texture_depth_2d, shadowMapSampler: sampler_comparison, shadowParams: vec4f, omniAtlasViewport: vec3f, shadowEdgePixels: f32, lightDir: vec3f) -> f32 {
		let shadowTextureResolution: f32 = shadowParams.x;
		let uv: vec2f = getCubemapAtlasCoordinates(omniAtlasViewport, shadowEdgePixels, shadowTextureResolution, lightDir);
		let shadowZ: f32 = length(lightDir) * shadowParams.w + shadowParams.z;
		return textureSampleCompareLevel(shadowMap, shadowMapSampler, uv, shadowZ);
	}
#endif
#if defined(CLUSTER_SHADOW_TYPE_PCF3)
	fn getShadowOmniClusteredPCF3(shadowMap: texture_depth_2d, shadowMapSampler: sampler_comparison, shadowParams: vec4f, omniAtlasViewport: vec3f, shadowEdgePixels: f32, lightDir: vec3f) -> f32 {
		let shadowTextureResolution: f32 = shadowParams.x;
		let uv: vec2f = getCubemapAtlasCoordinates(omniAtlasViewport, shadowEdgePixels, shadowTextureResolution, lightDir);
		let shadowZ: f32 = length(lightDir) * shadowParams.w + shadowParams.z;
		let shadowCoord: vec3f = vec3f(uv, shadowZ);
		return getShadowPCF3x3(shadowMap, shadowMapSampler, shadowCoord, shadowParams);
	}
#endif
#if defined(CLUSTER_SHADOW_TYPE_PCF5)
	fn getShadowOmniClusteredPCF5(shadowMap: texture_depth_2d, shadowMapSampler: sampler_comparison, shadowParams: vec4f, omniAtlasViewport: vec3f, shadowEdgePixels: f32, lightDir: vec3f) -> f32 {
		let shadowTextureResolution: f32 = shadowParams.x;
		let uv: vec2f = getCubemapAtlasCoordinates(omniAtlasViewport, shadowEdgePixels, shadowTextureResolution, lightDir);
		let shadowZ: f32 = length(lightDir) * shadowParams.w + shadowParams.z;
		let shadowCoord: vec3f = vec3f(uv, shadowZ);
		return getShadowPCF5x5(shadowMap, shadowMapSampler, shadowCoord, shadowParams);
	}
#endif
#if defined(CLUSTER_SHADOW_TYPE_PCF1)
	fn getShadowSpotClusteredPCF1(shadowMap: texture_depth_2d, shadowMapSampler: sampler_comparison, shadowCoord: vec3f, shadowParams: vec4f) -> f32 {
		return textureSampleCompareLevel(shadowMap, shadowMapSampler, shadowCoord.xy, shadowCoord.z);
	}
#endif
	#if defined(CLUSTER_SHADOW_TYPE_PCF3)
	fn getShadowSpotClusteredPCF3(shadowMap: texture_depth_2d, shadowMapSampler: sampler_comparison, shadowCoord: vec3f, shadowParams: vec4f) -> f32 {
		return getShadowSpotPCF3x3(shadowMap, shadowMapSampler, shadowCoord, shadowParams);
	}
#endif
	#if defined(CLUSTER_SHADOW_TYPE_PCF5)
	fn getShadowSpotClusteredPCF5(shadowMap: texture_depth_2d, shadowMapSampler: sampler_comparison, shadowCoord: vec3f, shadowParams: vec4f) -> f32 {
		return getShadowPCF5x5(shadowMap, shadowMapSampler, shadowCoord, shadowParams);
	}
#endif
`,uxe=`
#include "lightBufferDefinesPS"
#include "clusteredLightUtilsPS"
#ifdef CLUSTER_COOKIES
	#include "clusteredLightCookiesPS"
#endif
#ifdef CLUSTER_SHADOWS
	#include "clusteredLightShadowsPS"
#endif
var clusterWorldTexture: texture_2d<f32>;
var lightsTexture: texture_2d<f32>;
#ifdef CLUSTER_SHADOWS
	var shadowAtlasTexture: texture_depth_2d;
	var shadowAtlasTextureSampler: sampler_comparison;
#endif
#ifdef CLUSTER_COOKIES
	var cookieAtlasTexture: texture_2d<f32>;
	var cookieAtlasTextureSampler: sampler;
#endif
uniform clusterMaxCells: i32;
uniform clusterSkip: f32;
uniform clusterCellsCountByBoundsSize: vec3f;
uniform clusterTextureSize: vec3f;
uniform clusterBoundsMin: vec3f;
uniform clusterBoundsDelta: vec3f;
uniform clusterCellsDot: vec3f;
uniform clusterCellsMax: vec3f;
uniform shadowAtlasParams: vec2f;
struct ClusterLightData {
	flags: u32,
	halfWidth: vec3f,
	isSpot: bool,
	halfHeight: vec3f,
	lightIndex: i32,
	position: vec3f,
	shape: u32,
	direction: vec3f,
	falloffModeLinear: bool,
	color: vec3f,
	shadowIntensity: f32,
	omniAtlasViewport: vec3f,
	range: f32,
	cookieChannelMask: vec4f,
	biasesData: f32,
	shadowBias: f32,
	shadowNormalBias: f32,
	anglesData: f32,
	innerConeAngleCos: f32,
	outerConeAngleCos: f32,
	cookieIntensity: f32,
	isDynamic: bool,
	isLightmapped: bool
}
var<private> lightProjectionMatrix: mat4x4f;
fn sampleLightTextureF(lightIndex: i32, index: i32) -> vec4f {
	return textureLoad(lightsTexture, vec2<i32>(index, lightIndex), 0);
}
fn decodeClusterLightCore(clusterLightData: ptr<function, ClusterLightData>, lightIndex: f32) {
	clusterLightData.lightIndex = i32(lightIndex);
	let halfData: vec4f = sampleLightTextureF(clusterLightData.lightIndex, {CLUSTER_TEXTURE_COLOR_ANGLES_BIAS});
	clusterLightData.anglesData = halfData.z;
	clusterLightData.biasesData = halfData.w;
	let colorRG: vec2f = unpack2x16float(bitcast<u32>(halfData.x));
	let colorB_: vec2f = unpack2x16float(bitcast<u32>(halfData.y));
	clusterLightData.color = vec3f(colorRG, colorB_.x) * {LIGHT_COLOR_DIVIDER};
	let lightPosRange: vec4f = sampleLightTextureF(clusterLightData.lightIndex, {CLUSTER_TEXTURE_POSITION_RANGE});
	clusterLightData.position = lightPosRange.xyz;
	clusterLightData.range = lightPosRange.w;
	let lightDir_Flags: vec4f = sampleLightTextureF(clusterLightData.lightIndex, {CLUSTER_TEXTURE_DIRECTION_FLAGS});
	clusterLightData.direction = lightDir_Flags.xyz;
	let flags_uint: u32 = bitcast<u32>(lightDir_Flags.w);
	clusterLightData.flags = flags_uint;
	clusterLightData.isSpot = (flags_uint & (1u << 30u)) != 0u;
	clusterLightData.shape = (flags_uint >> 28u) & 0x3u;
	clusterLightData.falloffModeLinear = (flags_uint & (1u << 27u)) == 0u;
	clusterLightData.shadowIntensity = f32((flags_uint >> 0u) & 0xFFu) / 255.0;
	clusterLightData.cookieIntensity = f32((flags_uint >> 8u) & 0xFFu) / 255.0;
	clusterLightData.isDynamic = (flags_uint & (1u << 22u)) != 0u;
	clusterLightData.isLightmapped = (flags_uint & (1u << 21u)) != 0u;
}
fn decodeClusterLightSpot(clusterLightData: ptr<function, ClusterLightData>) {
	let angles: vec2f = unpack2x16float(bitcast<u32>(clusterLightData.anglesData));
	clusterLightData.innerConeAngleCos = angles.x;
	clusterLightData.outerConeAngleCos = angles.y;
}
fn decodeClusterLightOmniAtlasViewport(clusterLightData: ptr<function, ClusterLightData>) {
	clusterLightData.omniAtlasViewport = sampleLightTextureF(clusterLightData.lightIndex, {CLUSTER_TEXTURE_PROJ_MAT_0}).xyz;
}
fn decodeClusterLightAreaData(clusterLightData: ptr<function, ClusterLightData>) {
	clusterLightData.halfWidth = sampleLightTextureF(clusterLightData.lightIndex, {CLUSTER_TEXTURE_AREA_DATA_WIDTH}).xyz;
	clusterLightData.halfHeight = sampleLightTextureF(clusterLightData.lightIndex, {CLUSTER_TEXTURE_AREA_DATA_HEIGHT}).xyz;
}
fn decodeClusterLightProjectionMatrixData(clusterLightData: ptr<function, ClusterLightData>) {
	let m0: vec4f = sampleLightTextureF(clusterLightData.lightIndex, {CLUSTER_TEXTURE_PROJ_MAT_0});
	let m1: vec4f = sampleLightTextureF(clusterLightData.lightIndex, {CLUSTER_TEXTURE_PROJ_MAT_1});
	let m2: vec4f = sampleLightTextureF(clusterLightData.lightIndex, {CLUSTER_TEXTURE_PROJ_MAT_2});
	let m3: vec4f = sampleLightTextureF(clusterLightData.lightIndex, {CLUSTER_TEXTURE_PROJ_MAT_3});
	lightProjectionMatrix = mat4x4f(m0, m1, m2, m3);
}
fn decodeClusterLightShadowData(clusterLightData: ptr<function, ClusterLightData>) {
	let biases: vec2f = unpack2x16float(bitcast<u32>(clusterLightData.biasesData));
	clusterLightData.shadowBias = biases.x;
	clusterLightData.shadowNormalBias = biases.y;
}
fn decodeClusterLightCookieData(clusterLightData: ptr<function, ClusterLightData>) {
	let cookieFlags: u32 = (clusterLightData.flags >> 23u) & 0x0Fu;
	let mask_uvec: vec4<u32> = vec4<u32>(cookieFlags) & vec4<u32>(1u, 2u, 4u, 8u);
	clusterLightData.cookieChannelMask = step(vec4f(1.0), vec4f(mask_uvec));
}
fn evaluateLight(
	light: ptr<function, ClusterLightData>,
	worldNormal: vec3f,
	viewDir: vec3f,
	reflectionDir: vec3f,
#if defined(LIT_CLEARCOAT)
	clearcoatReflectionDir: vec3f,
#endif
	gloss: f32,
	specularity: vec3f,
	geometricNormal: vec3f,
	tbn: mat3x3f,
#if defined(LIT_IRIDESCENCE)
	iridescenceFresnel: vec3f,
#endif
	clearcoat_worldNormal: vec3f,
	clearcoat_gloss: f32,
	sheen_gloss: f32,
	iridescence_intensity: f32
) {
	var cookieAttenuation: vec3f = vec3f(1.0);
	var diffuseAttenuation: f32 = 1.0;
	var falloffAttenuation: f32 = 1.0;
	let lightDirW: vec3f = evalOmniLight(light.position);
	let lightDirNormW: vec3f = normalize(lightDirW);
	#ifdef CLUSTER_AREALIGHTS
	if (light.shape != {LIGHTSHAPE_PUNCTUAL}) {
		decodeClusterLightAreaData(light);
		if (light.shape == {LIGHTSHAPE_RECT}) {
			calcRectLightValues(light.position, light.halfWidth, light.halfHeight);
		} else if (light.shape == {LIGHTSHAPE_DISK}) {
			calcDiskLightValues(light.position, light.halfWidth, light.halfHeight);
		} else {
			calcSphereLightValues(light.position, light.halfWidth, light.halfHeight);
		}
		falloffAttenuation = getFalloffWindow(light.range, lightDirW);
	} else
	#endif
	{
		if (light.falloffModeLinear) {
			falloffAttenuation = getFalloffLinear(light.range, lightDirW);
		} else {
			falloffAttenuation = getFalloffInvSquared(light.range, lightDirW);
		}
	}
	if (falloffAttenuation > 0.00001) {
		#ifdef CLUSTER_AREALIGHTS
		if (light.shape != {LIGHTSHAPE_PUNCTUAL}) {
			if (light.shape == {LIGHTSHAPE_RECT}) {
				diffuseAttenuation = getRectLightDiffuse(worldNormal, viewDir, lightDirW, lightDirNormW) * 16.0;
			} else if (light.shape == {LIGHTSHAPE_DISK}) {
				diffuseAttenuation = getDiskLightDiffuse(worldNormal, viewDir, lightDirW, lightDirNormW) * 16.0;
			} else {
				diffuseAttenuation = getSphereLightDiffuse(worldNormal, viewDir, lightDirW, lightDirNormW) * 16.0;
			}
		} else
		#endif
		{
			falloffAttenuation = falloffAttenuation * getLightDiffuse(worldNormal, viewDir, lightDirNormW);
		}
		if (light.isSpot) {
			decodeClusterLightSpot(light);
			falloffAttenuation = falloffAttenuation * getSpotEffect(light.direction, light.innerConeAngleCos, light.outerConeAngleCos, lightDirNormW);
		}
		#if defined(CLUSTER_COOKIES) || defined(CLUSTER_SHADOWS)
		if (falloffAttenuation > 0.00001) {
			if (light.shadowIntensity > 0.0 || light.cookieIntensity > 0.0) {
				if (light.isSpot) {
					decodeClusterLightProjectionMatrixData(light);
				} else {
					decodeClusterLightOmniAtlasViewport(light);
				}
				let shadowTextureResolution: f32 = uniform.shadowAtlasParams.x;
				let shadowEdgePixels: f32 = uniform.shadowAtlasParams.y;
				#ifdef CLUSTER_COOKIES
				if (light.cookieIntensity > 0.0) {
					decodeClusterLightCookieData(light);
					if (light.isSpot) {
						cookieAttenuation = getCookie2DClustered(cookieAtlasTexture, cookieAtlasTextureSampler, lightProjectionMatrix, vPositionW, light.cookieIntensity, light.cookieChannelMask);
					} else {
						cookieAttenuation = getCookieCubeClustered(cookieAtlasTexture, cookieAtlasTextureSampler, lightDirW, light.cookieIntensity, light.cookieChannelMask, shadowTextureResolution, shadowEdgePixels, light.omniAtlasViewport);
					}
				}
				#endif
				#ifdef CLUSTER_SHADOWS
				if (light.shadowIntensity > 0.0) {
					decodeClusterLightShadowData(light);
					let shadowParams: vec4f = vec4f(shadowTextureResolution, light.shadowNormalBias, light.shadowBias, 1.0 / light.range);
					if (light.isSpot) {
						let shadowCoord: vec3f = getShadowCoordPerspZbufferNormalOffset(lightProjectionMatrix, shadowParams, geometricNormal);
						#if defined(CLUSTER_SHADOW_TYPE_PCF1)
							let shadow: f32 = getShadowSpotClusteredPCF1(shadowAtlasTexture, shadowAtlasTextureSampler, shadowCoord, shadowParams);
						#elif defined(CLUSTER_SHADOW_TYPE_PCF3)
							let shadow: f32 = getShadowSpotClusteredPCF3(shadowAtlasTexture, shadowAtlasTextureSampler, shadowCoord, shadowParams);
						#elif defined(CLUSTER_SHADOW_TYPE_PCF5)
							let shadow: f32 = getShadowSpotClusteredPCF5(shadowAtlasTexture, shadowAtlasTextureSampler, shadowCoord, shadowParams);
						#elif defined(CLUSTER_SHADOW_TYPE_PCSS)
							let shadow: f32 = getShadowSpotClusteredPCSS(shadowAtlasTexture, shadowAtlasTextureSampler, shadowCoord, shadowParams);
						#endif
						falloffAttenuation = falloffAttenuation * mix(1.0, shadow, light.shadowIntensity);
					} else {
						let dir: vec3f = normalOffsetPointShadow(shadowParams, light.position, lightDirW, lightDirNormW, geometricNormal);
						#if defined(CLUSTER_SHADOW_TYPE_PCF1)
							let shadow: f32 = getShadowOmniClusteredPCF1(shadowAtlasTexture, shadowAtlasTextureSampler, shadowParams, light.omniAtlasViewport, shadowEdgePixels, dir);
						#elif defined(CLUSTER_SHADOW_TYPE_PCF3)
							let shadow: f32 = getShadowOmniClusteredPCF3(shadowAtlasTexture, shadowAtlasTextureSampler, shadowParams, light.omniAtlasViewport, shadowEdgePixels, dir);
						#elif defined(CLUSTER_SHADOW_TYPE_PCF5)
							let shadow: f32 = getShadowOmniClusteredPCF5(shadowAtlasTexture, shadowAtlasTextureSampler, shadowParams, light.omniAtlasViewport, shadowEdgePixels, dir);
						#endif
						falloffAttenuation = falloffAttenuation * mix(1.0, shadow, light.shadowIntensity);
					}
				}
				#endif
			}
		}
		#endif
		#ifdef CLUSTER_AREALIGHTS
		if (light.shape != {LIGHTSHAPE_PUNCTUAL}) {
			{
				var areaDiffuse: vec3f = (diffuseAttenuation * falloffAttenuation) * light.color * cookieAttenuation;
				#if defined(LIT_SPECULAR)
					areaDiffuse = mix(areaDiffuse, vec3f(0.0), dLTCSpecFres);
				#endif
				dDiffuseLight = dDiffuseLight + areaDiffuse;
			}
			#ifdef LIT_SPECULAR
				var areaLightSpecular: f32;
				if (light.shape == {LIGHTSHAPE_RECT}) {
					areaLightSpecular = getRectLightSpecular(worldNormal, viewDir);
				} else if (light.shape == {LIGHTSHAPE_DISK}) {
					areaLightSpecular = getDiskLightSpecular(worldNormal, viewDir);
				} else {
					areaLightSpecular = getSphereLightSpecular(worldNormal, viewDir);
				}
				dSpecularLight = dSpecularLight + dLTCSpecFres * areaLightSpecular * falloffAttenuation * light.color * cookieAttenuation;
				#ifdef LIT_CLEARCOAT
					var areaLightSpecularCC: f32;
					if (light.shape == {LIGHTSHAPE_RECT}) {
						areaLightSpecularCC = getRectLightSpecular(clearcoat_worldNormal, viewDir);
					} else if (light.shape == {LIGHTSHAPE_DISK}) {
						areaLightSpecularCC = getDiskLightSpecular(clearcoat_worldNormal, viewDir);
					} else {
						areaLightSpecularCC = getSphereLightSpecular(clearcoat_worldNormal, viewDir);
					}
					ccSpecularLight = ccSpecularLight + ccLTCSpecFres * areaLightSpecularCC * falloffAttenuation * light.color  * cookieAttenuation;
				#endif
			#endif
		} else
		#endif
		{
			{
				var punctualDiffuse: vec3f = falloffAttenuation * light.color * cookieAttenuation;
				#if defined(CLUSTER_AREALIGHTS)
				#if defined(LIT_SPECULAR)
					punctualDiffuse = mix(punctualDiffuse, vec3f(0.0), specularity);
				#endif
				#endif
				dDiffuseLight = dDiffuseLight + punctualDiffuse;
			}
			#ifdef LIT_SPECULAR
				let halfDir: vec3f = normalize(-lightDirNormW + viewDir);
				#ifdef LIT_SPECULAR_FRESNEL
					dSpecularLight = dSpecularLight +
						getLightSpecular(halfDir, reflectionDir, worldNormal, viewDir, lightDirNormW, gloss, tbn) * falloffAttenuation * light.color * cookieAttenuation *
						getFresnel(
							dot(viewDir, halfDir),
							gloss,
							specularity
						#if defined(LIT_IRIDESCENCE)
							, iridescenceFresnel,
							iridescence_intensity
						#endif
							);
				#else
					dSpecularLight = dSpecularLight + getLightSpecular(halfDir, reflectionDir, worldNormal, viewDir, lightDirNormW, gloss, tbn) * falloffAttenuation * light.color * cookieAttenuation * specularity;
				#endif
				#ifdef LIT_CLEARCOAT
					#ifdef LIT_SPECULAR_FRESNEL
						ccSpecularLight = ccSpecularLight + getLightSpecular(halfDir, clearcoatReflectionDir, clearcoat_worldNormal, viewDir, lightDirNormW, clearcoat_gloss, tbn) * falloffAttenuation * light.color * cookieAttenuation * getFresnelCC(dot(viewDir, halfDir));
					#else
						ccSpecularLight = ccSpecularLight + getLightSpecular(halfDir, clearcoatReflectionDir, clearcoat_worldNormal, viewDir, lightDirNormW, clearcoat_gloss, tbn) * falloffAttenuation * light.color * cookieAttenuation;
					#endif
				#endif
				#ifdef LIT_SHEEN
					sSpecularLight = sSpecularLight + getLightSpecularSheen(halfDir, worldNormal, viewDir, lightDirNormW, sheen_gloss) * falloffAttenuation * light.color * cookieAttenuation;
				#endif
			#endif
		}
	}
	dAtten = falloffAttenuation;
	dLightDirNormW = lightDirNormW;
}
fn evaluateClusterLight(
	lightIndex: f32,
	worldNormal: vec3f,
	viewDir: vec3f,
	reflectionDir: vec3f,
#if defined(LIT_CLEARCOAT)
	clearcoatReflectionDir: vec3f,
#endif
	gloss: f32,
	specularity: vec3f,
	geometricNormal: vec3f,
	tbn: mat3x3f,
#if defined(LIT_IRIDESCENCE)
	iridescenceFresnel: vec3f,
#endif
	clearcoat_worldNormal: vec3f,
	clearcoat_gloss: f32,
	sheen_gloss: f32,
	iridescence_intensity: f32
) {
	var clusterLightData: ClusterLightData;
	decodeClusterLightCore(&clusterLightData, lightIndex);
	#ifdef CLUSTER_MESH_DYNAMIC_LIGHTS
		let acceptLightMask: bool = clusterLightData.isDynamic;
	#else
		let acceptLightMask: bool = clusterLightData.isLightmapped;
	#endif
	if (acceptLightMask) {
		evaluateLight(
			&clusterLightData,
			worldNormal,
			viewDir,
			reflectionDir,
#if defined(LIT_CLEARCOAT)
			clearcoatReflectionDir,
#endif
			gloss,
			specularity,
			geometricNormal,
			tbn,
#if defined(LIT_IRIDESCENCE)
			iridescenceFresnel,
#endif
			clearcoat_worldNormal,
			clearcoat_gloss,
			sheen_gloss,
			iridescence_intensity
		);
	}
}
fn addClusteredLights(
	worldNormal: vec3f,
	viewDir: vec3f,
	reflectionDir: vec3f,
#if defined(LIT_CLEARCOAT)
	clearcoatReflectionDir: vec3f,
#endif
	gloss: f32,
	specularity: vec3f,
	geometricNormal: vec3f,
	tbn: mat3x3f,
#if defined(LIT_IRIDESCENCE)
	iridescenceFresnel: vec3f,
#endif
	clearcoat_worldNormal: vec3f,
	clearcoat_gloss: f32,
	sheen_gloss: f32,
	iridescence_intensity: f32
) {
	if (uniform.clusterSkip > 0.5) {
		return;
	}
	let cellCoords: vec3f = floor((vPositionW - uniform.clusterBoundsMin) * uniform.clusterCellsCountByBoundsSize);
	if (!(any(cellCoords < vec3f(0.0)) || any(cellCoords >= uniform.clusterCellsMax))) {
		let cellIndex: f32 = dot(uniform.clusterCellsDot, cellCoords);
		let clusterV: f32 = floor(cellIndex * uniform.clusterTextureSize.y);
		let clusterU: f32 = cellIndex - (clusterV * uniform.clusterTextureSize.x);
		for (var lightCellIndex: i32 = 0; lightCellIndex < uniform.clusterMaxCells; lightCellIndex = lightCellIndex + 1) {
			let lightIndexPacked: f32 = textureLoad(clusterWorldTexture, vec2<i32>(i32(clusterU) + lightCellIndex, i32(clusterV)), 0).r;
			if (lightIndexPacked <= 0.0) {
				break;
			}
			evaluateClusterLight(
				lightIndexPacked * 255.0,
				worldNormal,
				viewDir,
				reflectionDir,
#if defined(LIT_CLEARCOAT)
				clearcoatReflectionDir,
#endif
				gloss,
				specularity,
				geometricNormal,
				tbn,
#if defined(LIT_IRIDESCENCE)
				iridescenceFresnel,
#endif
				clearcoat_worldNormal,
				clearcoat_gloss,
				sheen_gloss,
				iridescence_intensity
			);
		}
	}
}`,hxe=`
fn combineColor(albedo: vec3f, sheenSpecularity: vec3f, clearcoatSpecularity: f32) -> vec3f {
	var ret: vec3f = vec3f(0.0);
	#ifdef LIT_OLD_AMBIENT
		ret = ret + ((dDiffuseLight - uniform.light_globalAmbient) * albedo + uniform.material_ambient * uniform.light_globalAmbient);
	#else
		ret = ret + (albedo * dDiffuseLight);
	#endif
	#ifdef LIT_SPECULAR
		ret = ret + dSpecularLight;
	#endif
	#ifdef LIT_REFLECTIONS
		ret = ret + (dReflection.rgb * dReflection.a);
	#endif
	#ifdef LIT_SHEEN
		let sheenScaling: f32 = 1.0 - max(max(sheenSpecularity.r, sheenSpecularity.g), sheenSpecularity.b) * 0.157;
		ret = ret * sheenScaling + (sSpecularLight + sReflection.rgb) * sheenSpecularity;
	#endif
	#ifdef LIT_CLEARCOAT
		let clearCoatScaling: f32 = 1.0 - ccFresnel * clearcoatSpecularity;
		ret = ret * clearCoatScaling + (ccSpecularLight + ccReflection) * clearcoatSpecularity;
	#endif
	return ret;
}
`,dxe=`
	varying uv0: vec2f;
	var blitTexture: texture_2d<f32>;
	var blitTextureSampler : sampler;
	@fragment
	fn fragmentMain(input : FragmentInput) -> FragmentOutput {
		var output: FragmentOutput;
		output.color = textureSample(blitTexture, blitTextureSampler, input.uv0);
		return output;
	}
`,fxe=`
	varying uv0: vec2f;
	uniform invViewProj: mat4x4<f32>;
	var blitTexture: texture_cube<f32>;
	var blitTextureSampler : sampler;
	@fragment
	fn fragmentMain(input : FragmentInput) -> FragmentOutput {
		var output: FragmentOutput;
		var projPos = vec4f(input.uv0 * 2.0 - 1.0, 0.5, 1.0);
		var worldPos = uniform.invViewProj * projPos;
		output.color = textureSample(blitTexture, blitTextureSampler, worldPos.xyz);
		return output;
	}
`,pxe=`
	attribute vertex_position: vec2f;
	varying uv0: vec2f;
	@vertex
	fn vertexMain(input: VertexInput) -> VertexOutput {
		var output: VertexOutput;
		output.position = vec4f(input.vertex_position, 0.5, 1.0);
		output.uv0 = input.vertex_position * 0.5 + vec2f(0.5, 0.5);
		output.uv0.y = 1.0 - output.uv0.y;
		return output;
	}
`,mxe=`
#if LIT_CUBEMAP_PROJECTION == BOX
	uniform envBoxMin: vec3f;
	uniform envBoxMax: vec3f;
#endif
fn cubeMapProject(nrdir: vec3f) -> vec3f {
	#if LIT_CUBEMAP_PROJECTION == NONE
		return cubeMapRotate(nrdir);
	#endif
	#if LIT_CUBEMAP_PROJECTION == BOX
		let nrdir_rotated: vec3f = cubeMapRotate(nrdir);
		let rbmax: vec3f = (uniform.envBoxMax - vPositionW) / nrdir_rotated;
		let rbmin: vec3f = (uniform.envBoxMin - vPositionW) / nrdir_rotated;
		let rbminmax: vec3f = select(rbmin, rbmax, nrdir_rotated > vec3f(0.0));
		let fa: f32 = min(min(rbminmax.x, rbminmax.y), rbminmax.z);
		let posonbox: vec3f = vPositionW + nrdir_rotated * fa;
		let envBoxPos: vec3f = (uniform.envBoxMin + uniform.envBoxMax) * 0.5;
		return normalize(posonbox - envBoxPos);
	#endif
}
`,gxe=`
#ifdef CUBEMAP_ROTATION
uniform cubeMapRotationMatrix: mat3x3f;
#endif
fn cubeMapRotate(refDir: vec3f) -> vec3f {
#ifdef CUBEMAP_ROTATION
	return refDir * uniform.cubeMapRotationMatrix;
#else
	return refDir;
#endif
}
`,_xe=`
#ifdef DEBUG_ALBEDO_PASS
output.color = vec4(gammaCorrectOutput(dAlbedo), 1.0);
#endif
#ifdef DEBUG_UV0_PASS
output.color = vec4f(litArgs_albedo , 1.0);
#endif
#ifdef DEBUG_WORLD_NORMAL_PASS
output.color = vec4f(litArgs_worldNormal * 0.5 + 0.5, 1.0);
#endif
#ifdef DEBUG_OPACITY_PASS
output.color = vec4f(vec3f(litArgs_opacity) , 1.0);
#endif
#ifdef DEBUG_SPECULARITY_PASS
output.color = vec4f(litArgs_specularity, 1.0);
#endif
#ifdef DEBUG_GLOSS_PASS
output.color = vec4f(vec3f(litArgs_gloss) , 1.0);
#endif
#ifdef DEBUG_METALNESS_PASS
output.color = vec4f(vec3f(litArgs_metalness) , 1.0);
#endif
#ifdef DEBUG_AO_PASS
output.color = vec4f(vec3f(litArgs_ao) , 1.0);
#endif
#ifdef DEBUG_EMISSION_PASS
output.color = vec4f(gammaCorrectOutput(litArgs_emission), 1.0);
#endif
`,vxe=`
#ifdef DEBUG_LIGHTING_PASS
	litArgs_albedo = vec3f(0.5);
#endif
#ifdef DEBUG_UV0_PASS
#ifdef VARYING_VUV0
	litArgs_albedo = vec3f(vUv0, 0.0);
#else
	litArgs_albedo = vec3f(0.0);
#endif
#endif
`,yxe=`
#ifndef _DECODE_INCLUDED_
#define _DECODE_INCLUDED_
fn decodeLinear(raw: vec4f) -> vec3f {
	return raw.rgb;
}
fn decodeGammaFloat(raw: f32) -> f32 {
	return pow(raw, 2.2);
}
fn decodeGamma3(raw: vec3f) -> vec3f {
	return pow(raw, vec3f(2.2));
}
fn decodeGamma(raw: vec4f) -> vec3f {
	return pow(raw.xyz, vec3f(2.2));
}
fn decodeRGBM(raw: vec4f) -> vec3f {
	let color = (8.0 * raw.a) * raw.rgb;
	return color * color;
}
fn decodeRGBP(raw: vec4f) -> vec3f {
	let color = raw.rgb * (-raw.a * 7.0 + 8.0);
	return color * color;
}
fn decodeRGBE(raw: vec4f) -> vec3f {
	return select(vec3f(0.0), raw.xyz * pow(2.0, raw.w * 255.0 - 128.0), raw.a != 0.0);
}
fn passThrough(raw: vec4f) -> vec4f {
	return raw;
}
fn unpackNormalXYZ(nmap: vec4f) -> vec3f {
	return nmap.xyz * 2.0 - 1.0;
}
fn unpackNormalXY(nmap: vec4f) -> vec3f {
	var xy = nmap.wy * 2.0 - 1.0;
	return vec3f(xy, sqrt(1.0 - clamp(dot(xy, xy), 0.0, 1.0)));
}
#endif
`,Sxe=`
#ifndef _DETAILMODES_INCLUDED_
#define _DETAILMODES_INCLUDED_
fn detailMode_mul(c1: vec3f, c2: vec3f) -> vec3f {
	return c1 * c2;
}
fn detailMode_add(c1: vec3f, c2: vec3f) -> vec3f {
	return c1 + c2;
}
fn detailMode_screen(c1: vec3f, c2: vec3f) -> vec3f {
	return 1.0 - (1.0 - c1)*(1.0 - c2);
}
fn detailMode_overlay(c1: vec3f, c2: vec3f) -> vec3f {
	return mix(1.0 - 2.0 * (1.0 - c1)*(1.0 - c2), 2.0 * c1 * c2, step(c1, vec3f(0.5)));
}
fn detailMode_min(c1: vec3f, c2: vec3f) -> vec3f {
	return min(c1, c2);
}
fn detailMode_max(c1: vec3f, c2: vec3f) -> vec3f {
	return max(c1, c2);
}
#endif
`,xxe=`
uniform material_diffuse: vec3f;
#ifdef STD_DIFFUSEDETAIL_TEXTURE
	#include "detailModesPS"
#endif
fn getAlbedo() {
	dAlbedo = uniform.material_diffuse.rgb;
	#ifdef STD_DIFFUSE_TEXTURE
		var albedoTexture: vec3f = {STD_DIFFUSE_TEXTURE_DECODE}(textureSampleBias({STD_DIFFUSE_TEXTURE_NAME}, {STD_DIFFUSE_TEXTURE_NAME}Sampler, {STD_DIFFUSE_TEXTURE_UV}, uniform.textureBias)).{STD_DIFFUSE_TEXTURE_CHANNEL};
		#ifdef STD_DIFFUSEDETAIL_TEXTURE
			var albedoDetail: vec3f = {STD_DIFFUSEDETAIL_TEXTURE_DECODE}(textureSampleBias({STD_DIFFUSEDETAIL_TEXTURE_NAME}, {STD_DIFFUSEDETAIL_TEXTURE_NAME}Sampler, {STD_DIFFUSEDETAIL_TEXTURE_UV}, uniform.textureBias)).{STD_DIFFUSEDETAIL_TEXTURE_CHANNEL};
			albedoTexture = detailMode_{STD_DIFFUSEDETAIL_DETAILMODE}(albedoTexture, albedoDetail);
		#endif
		dAlbedo = dAlbedo * albedoTexture;
	#endif
	#ifdef STD_DIFFUSE_VERTEX
		dAlbedo = dAlbedo * gammaCorrectInputVec3(saturate3(vVertexColor.{STD_DIFFUSE_VERTEX_CHANNEL}));
	#endif
}
`,bxe=`
uniform material_emissive: vec3f;
uniform material_emissiveIntensity: f32;
fn getEmission() {
	dEmission = uniform.material_emissive * uniform.material_emissiveIntensity;
	#ifdef STD_EMISSIVE_TEXTURE
	dEmission *= {STD_EMISSIVE_TEXTURE_DECODE}(textureSampleBias({STD_EMISSIVE_TEXTURE_NAME}, {STD_EMISSIVE_TEXTURE_NAME}Sampler, {STD_EMISSIVE_TEXTURE_UV}, uniform.textureBias)).{STD_EMISSIVE_TEXTURE_CHANNEL};
	#endif
	#ifdef STD_EMISSIVE_VERTEX
	dEmission = dEmission * gammaCorrectInputVec3(saturate3(vVertexColor.{STD_EMISSIVE_VERTEX_CHANNEL}));
	#endif
}
`,wxe=`
fn encodeLinear(source: vec3f) -> vec4f {
	return vec4f(source, 1.0);
}
fn encodeGamma(source: vec3f) -> vec4f {
	return vec4f(pow(source + vec3f(0.0000001), vec3f(1.0 / 2.2)), 1.0);
}
fn encodeRGBM(source: vec3f) -> vec4f {
	var color: vec3f = pow(source, vec3f(0.5));
	color *= 1.0 / 8.0;
	var a: f32 = saturate(max(max(color.r, color.g), max(color.b, 1.0 / 255.0)));
	a = ceil(a * 255.0) / 255.0;
	color /= a;
	return vec4f(color, a);
}
fn encodeRGBP(source: vec3f) -> vec4f {
	var gamma: vec3f = pow(source, vec3f(0.5));
	var maxVal: f32 = min(8.0, max(1.0, max(gamma.x, max(gamma.y, gamma.z))));
	var v: f32 = 1.0 - ((maxVal - 1.0) / 7.0);
	v = ceil(v * 255.0) / 255.0;
	return vec4f(gamma / (-v * 7.0 + 8.0), v);
}
fn encodeRGBE(source: vec3f) -> vec4f {
	var maxVal: f32 = max(source.x, max(source.y, source.z));
	if (maxVal < 1e-32) {
		return vec4f(0.0, 0.0, 0.0, 0.0);
	} else {
		var e: f32 = ceil(log2(maxVal));
		return vec4f(source / pow(2.0, e), (e + 128.0) / 255.0);
	}
}
`,Txe=`
	var finalRgb: vec3f = combineColor(litArgs_albedo, litArgs_sheen_specularity, litArgs_clearcoat_specularity);
	finalRgb = finalRgb + litArgs_emission;
	finalRgb = addFog(finalRgb);
	finalRgb = toneMap(finalRgb);
	finalRgb = gammaCorrectOutput(finalRgb);
	output.color = vec4f(finalRgb, output.color.a);
`,Exe=`
#ifndef _ENVATLAS_INCLUDED_
#define _ENVATLAS_INCLUDED_
const atlasSize : f32 = 512.0;
const seamSize : f32 = 1.0 / atlasSize;
fn mapUv(uv : vec2f, rect : vec4f) -> vec2f {
	return vec2f(mix(rect.x + seamSize, rect.x + rect.z - seamSize, uv.x),
				 mix(rect.y + seamSize, rect.y + rect.w - seamSize, uv.y));
}
fn mapRoughnessUv(uv : vec2f, level : f32) -> vec2f {
	let t : f32 = 1.0 / exp2(level);
	return mapUv(uv, vec4f(0.0, 1.0 - t, t, t * 0.5));
}
fn mapShinyUv(uv : vec2f, level : f32) -> vec2f {
	let t : f32 = 1.0 / exp2(level);
	return mapUv(uv, vec4f(1.0 - t, 1.0 - t, t, t * 0.5));
}
#endif
`,Axe=`
#ifdef LIT_SKYBOX_INTENSITY
	uniform skyboxIntensity : f32;
#endif
fn processEnvironment(color : vec3f) -> vec3f {
	#ifdef LIT_SKYBOX_INTENSITY
		return color * uniform.skyboxIntensity;
	#else
		return color;
	#endif
}
`,Cxe=`
fn getFalloffWindow(lightRadius: f32, lightDir: vec3f) -> f32 {
	let sqrDist: f32 = dot(lightDir, lightDir);
	let invRadius: f32 = 1.0 / lightRadius;
	return square(saturate(1.0 - square(sqrDist * square(invRadius))));
}
fn getFalloffInvSquared(lightRadius: f32, lightDir: vec3f) -> f32 {
	let sqrDist: f32 = dot(lightDir, lightDir);
	var falloff: f32 = 1.0 / (sqrDist + 1.0);
	let invRadius: f32 = 1.0 / lightRadius;
	falloff = falloff * 16.0;
	falloff = falloff * square(saturate(1.0 - square(sqrDist * square(invRadius))));
	return falloff;
}
`,Pxe=`
fn getFalloffLinear(lightRadius: f32, lightDir: vec3f) -> f32 {
	let d: f32 = length(lightDir);
	return max(((lightRadius - d) / lightRadius), 0.0);
}
`,Ixe=`
#ifndef FLOAT_AS_UINT
#define FLOAT_AS_UINT
fn float2uint(value: f32) -> vec4f {
	let intBits = bitcast<u32>(value);
	return vec4f(
		f32((intBits >> 24u) & 0xffu),
		f32((intBits >> 16u) & 0xffu),
		f32((intBits >> 8u) & 0xffu),
		f32(intBits & 0xffu)
	) / 255.0;
}
fn uint2float(value: vec4f) -> f32 {
	let rgba_u32 = vec4<u32>(value * 255.0);
	let intBits: u32 =
		(rgba_u32.r << 24u) |
		(rgba_u32.g << 16u) |
		(rgba_u32.b << 8u)  |
		 rgba_u32.a;
	return bitcast<f32>(intBits);
}
fn float2vec4(value: f32) -> vec4f {
	#if defined(CAPS_TEXTURE_FLOAT_RENDERABLE)
		return vec4f(value, 1.0, 1.0, 1.0);
	#else
		return float2uint(value);
	#endif
}
#endif
`,Mxe=`
var<private> dBlendModeFogFactor : f32 = 1.0;
#if (FOG != NONE)
	uniform fog_color : vec3f;
	
	#if (FOG == LINEAR)
		uniform fog_start : f32;
		uniform fog_end : f32;
	#else
		uniform fog_density : f32;
	#endif
#endif
fn getFogFactor() -> f32 {
	let depth = pcPosition.z / pcPosition.w;
	var fogFactor : f32 = 0.0;
	#if (FOG == LINEAR)
		fogFactor = (uniform.fog_end - depth) / (uniform.fog_end - uniform.fog_start);
	#elif (FOG == EXP)
		fogFactor = exp(-depth * uniform.fog_density);
	#elif (FOG == EXP2)
		fogFactor = exp(-depth * depth * uniform.fog_density * uniform.fog_density);
	#endif
	return clamp(fogFactor, 0.0, 1.0);
}
fn addFog(color : vec3f) -> vec3f {
	#if (FOG != NONE)
		return mix(uniform.fog_color * dBlendModeFogFactor, color, getFogFactor());
	#else
		return color;
	#endif
}
`,Rxe=`
fn getFresnel(
		cosTheta: f32,
		gloss: f32,
		specularity: vec3f
	#if defined(LIT_IRIDESCENCE)
		, iridescenceFresnel: vec3f,
		iridescenceIntensity: f32
	#endif
) -> vec3f {
	let fresnel: f32 = pow(1.0 - saturate(cosTheta), 5.0);
	let glossSq: f32 = gloss * gloss;
	let ret: vec3f = specularity + (max(vec3f(glossSq), specularity) - specularity) * fresnel;
	#if defined(LIT_IRIDESCENCE)
		return mix(ret, iridescenceFresnel, iridescenceIntensity);
	#else
		return ret;
	#endif
}
fn getFresnelCC(cosTheta: f32) -> f32 {
	let fresnel: f32 = pow(1.0 - saturate(cosTheta), 5.0);
	return 0.04 + (1.0 - 0.04) * fresnel;
}`,Dxe=`
attribute vertex_position: vec2f;
varying vUv0: vec2f;
@vertex
fn vertexMain(input: VertexInput) -> VertexOutput {
	var output: VertexOutput;
	output.position = vec4f(input.vertex_position, 0.5, 1.0);
	output.vUv0 = input.vertex_position.xy * 0.5 + vec2f(0.5);
	return output;
}
`,Lxe=`
#include "decodePS"
#if (GAMMA == SRGB)
	fn gammaCorrectInput(color: f32) -> f32 {
		return decodeGammaFloat(color);
	}
	fn gammaCorrectInputVec3(color: vec3f) -> vec3f {
		return decodeGamma3(color);
	}
	fn gammaCorrectInputVec4(color: vec4f) -> vec4f {
		return vec4f(decodeGamma3(color.xyz), color.w);
	}
	fn gammaCorrectOutput(color: vec3f) -> vec3f {
		return pow(color + 0.0000001, vec3f(1.0 / 2.2));
	}
#else
	fn gammaCorrectInput(color: f32) -> f32 {
		return color;
	}
	fn gammaCorrectInputVec3(color: vec3f) -> vec3f {
		return color;
	}
	fn gammaCorrectInputVec4(color: vec4f) -> vec4f {
		return color;
	}
	fn gammaCorrectOutput(color: vec3f) -> vec3f {
		return color;
	}
#endif
`,Oxe=`
#ifdef STD_GLOSS_CONSTANT
	uniform material_gloss: f32;
#endif
fn getGlossiness() {
	dGlossiness = 1.0;
	#ifdef STD_GLOSS_CONSTANT
	dGlossiness = dGlossiness * uniform.material_gloss;
	#endif
	#ifdef STD_GLOSS_TEXTURE
	dGlossiness = dGlossiness * textureSampleBias({STD_GLOSS_TEXTURE_NAME}, {STD_GLOSS_TEXTURE_NAME}Sampler, {STD_GLOSS_TEXTURE_UV}, uniform.textureBias).{STD_GLOSS_TEXTURE_CHANNEL};
	#endif
	#ifdef STD_GLOSS_VERTEX
	dGlossiness = dGlossiness * saturate(vVertexColor.{STD_GLOSS_VERTEX_CHANNEL});
	#endif
	#ifdef STD_GLOSS_INVERT
	dGlossiness = 1.0 - dGlossiness;
	#endif
	dGlossiness = dGlossiness + 0.0000001;
}
`,Nxe=`
uniform matrix_model: mat4x4f;
uniform matrix_view: mat4x4f;
uniform matrix_projection: mat4x4f;
fn initCenter(modelCenter: vec3f, center: ptr<function, SplatCenter>) -> bool {
	let modelView: mat4x4f = uniform.matrix_view * uniform.matrix_model;
	let centerView: vec4f = modelView * vec4f(modelCenter, 1.0);
	if (centerView.z > 0.0) {
		return false;
	}
	var centerProj: vec4f = uniform.matrix_projection * centerView;
	centerProj.z = clamp(centerProj.z, 0.0, abs(centerProj.w));
	center.view = centerView.xyz / centerView.w;
	center.proj = centerProj;
	center.projMat00 = uniform.matrix_projection[0][0];
	center.modelView = modelView;
	return true;
}
`,kxe=`
var splatColor: texture_2d<f32>;
fn readColor(source: ptr<function, SplatSource>) -> vec4f {
	return textureLoad(splatColor, source.uv, 0);
}
`,Fxe=`
struct SplatSource {
	order: u32,
	id: u32,
	uv: vec2<i32>,
	cornerUV: vec2f,
}
struct SplatCenter {
	view: vec3f,
	proj: vec4f,
	modelView: mat4x4f,
	projMat00: f32,
}
struct SplatCorner {
	offset: vec2f,
	uv: vec2f,
	#if GSPLAT_AA
		aaFactor: f32,
	#endif
}
#include "gsplatEvalSHVS"
#include "gsplatQuatToMat3VS"
#if GSPLAT_COMPRESSED_DATA
	#include "gsplatCompressedDataVS"
	#if SH_BANDS > 0
		#include "gsplatCompressedSHVS"
	#endif
#elif GSPLAT_SOGS_DATA
	#include "gsplatSogsDataVS"
	#include "gsplatSogsColorVS"
	#if SH_BANDS > 0
		#include "gsplatSogsSHVS"
	#endif
#else
	#include "gsplatDataVS"
	#include "gsplatColorVS"
	#if SH_BANDS > 0
		#include "gsplatSHVS"
	#endif
#endif
#include "gsplatSourceVS"
#include "gsplatCenterVS"
#include "gsplatCornerVS"
#include "gsplatOutputVS"
fn clipCorner(corner: ptr<function, SplatCorner>, alpha: f32) {
	let clip: f32 = min(1.0, sqrt(-log(1.0 / (255.0 * alpha))) / 2.0);
	corner.offset = corner.offset * clip;
	corner.uv = corner.uv * clip;
}
`,Bxe=`
var packedTexture: texture_2d<u32>;
var chunkTexture: texture_2d<f32>;
var<private> chunkDataA: vec4f;
var<private> chunkDataB: vec4f;
var<private> chunkDataC: vec4f;
var<private> chunkDataD: vec4f;
var<private> chunkDataE: vec4f;
var<private> packedData: vec4u;
fn unpack111011(bits: u32) -> vec3f {
	return (vec3f((vec3<u32>(bits) >> vec3<u32>(21u, 11u, 0u)) & vec3<u32>(0x7ffu, 0x3ffu, 0x7ffu))) / vec3f(2047.0, 1023.0, 2047.0);
}
fn unpack8888(bits: u32) -> vec4f {
	return vec4f(
		f32((bits >> 24u) & 0xffu),
		f32((bits >> 16u) & 0xffu),
		f32((bits >> 8u)  & 0xffu),
		f32(bits		 & 0xffu)
	) / 255.0;
}
const norm_const: f32 = 1.0 / (sqrt(2.0) * 0.5);
fn unpackRotation(bits: u32) -> vec4f {
	let a = (f32((bits >> 20u) & 0x3ffu) / 1023.0 - 0.5) * norm_const;
	let b = (f32((bits >> 10u) & 0x3ffu) / 1023.0 - 0.5) * norm_const;
	let c = (f32(bits & 0x3ffu) / 1023.0 - 0.5) * norm_const;
	let m = sqrt(1.0 - (a * a + b * b + c * c));
	let mode = bits >> 30u;
	if (mode == 0u) { return vec4f(m, a, b, c); }
	if (mode == 1u) { return vec4f(a, m, b, c); }
	if (mode == 2u) { return vec4f(a, b, m, c); }
	return vec4f(a, b, c, m);
}
fn readCenter(source: ptr<function, SplatSource>) -> vec3f {
	let tex_size_u = textureDimensions(chunkTexture, 0);
	let w: u32 = tex_size_u.x / 5u;
	let chunkId: u32 = source.id / 256u;
	let chunkUV: vec2<i32> = vec2<i32>(i32((chunkId % w) * 5u), i32(chunkId / w));
	chunkDataA = textureLoad(chunkTexture, chunkUV + vec2<i32>(0, 0), 0);
	chunkDataB = textureLoad(chunkTexture, chunkUV + vec2<i32>(1, 0), 0);
	chunkDataC = textureLoad(chunkTexture, chunkUV + vec2<i32>(2, 0), 0);
	chunkDataD = textureLoad(chunkTexture, chunkUV + vec2<i32>(3, 0), 0);
	chunkDataE = textureLoad(chunkTexture, chunkUV + vec2<i32>(4, 0), 0);
	packedData = textureLoad(packedTexture, source.uv, 0);
	return mix(chunkDataA.xyz, vec3f(chunkDataA.w, chunkDataB.xy), unpack111011(packedData.x));
}
fn readColor(source: ptr<function, SplatSource>) -> vec4f {
	let r = unpack8888(packedData.w);
	return vec4f(mix(chunkDataD.xyz, vec3f(chunkDataD.w, chunkDataE.xy), r.rgb), r.w);
}
fn getRotation() -> vec4f {
	return unpackRotation(packedData.y);
}
fn getScale() -> vec3f {
	return exp(mix(vec3f(chunkDataB.zw, chunkDataC.x), chunkDataC.yzw, unpack111011(packedData.z)));
}
fn readCovariance(source: ptr<function, SplatSource>, covA_ptr: ptr<function, vec3f>, covB_ptr: ptr<function, vec3f>) {
	let rot = quatToMat3(getRotation());
	let scale = getScale();
	let M = transpose(mat3x3f(
		scale.x * rot[0],
		scale.y * rot[1],
		scale.z * rot[2]
	));
	*covA_ptr = vec3f(dot(M[0], M[0]), dot(M[0], M[1]), dot(M[0], M[2]));
	*covB_ptr = vec3f(dot(M[1], M[1]), dot(M[1], M[2]), dot(M[2], M[2]));
}
`,Uxe=`
#if SH_BANDS > 0
var shTexture0: texture_2d<u32>;
var shTexture1: texture_2d<u32>;
var shTexture2: texture_2d<u32>;
fn unpack8888s(bits: u32) -> vec4f {
	let unpacked_u = (vec4<u32>(bits) >> vec4<u32>(0u, 8u, 16u, 24u)) & vec4<u32>(0xffu);
	return vec4f(unpacked_u) * (8.0 / 255.0) - 4.0;
}
fn readSHData(source: ptr<function, SplatSource>, sh: ptr<function, array<vec3f, 15>>, scale: ptr<function, f32>) {
	let shData0: vec4<u32> = textureLoad(shTexture0, source.uv, 0);
	let shData1: vec4<u32> = textureLoad(shTexture1, source.uv, 0);
	let shData2: vec4<u32> = textureLoad(shTexture2, source.uv, 0);
	let r0 = unpack8888s(shData0.x);
	let r1 = unpack8888s(shData0.y);
	let r2 = unpack8888s(shData0.z);
	let r3 = unpack8888s(shData0.w);
	let g0 = unpack8888s(shData1.x);
	let g1 = unpack8888s(shData1.y);
	let g2 = unpack8888s(shData1.z);
	let g3 = unpack8888s(shData1.w);
	let b0 = unpack8888s(shData2.x);
	let b1 = unpack8888s(shData2.y);
	let b2 = unpack8888s(shData2.z);
	let b3 = unpack8888s(shData2.w);
	sh[0] =  vec3f(r0.x, g0.x, b0.x);
	sh[1] =  vec3f(r0.y, g0.y, b0.y);
	sh[2] =  vec3f(r0.z, g0.z, b0.z);
	sh[3] =  vec3f(r0.w, g0.w, b0.w);
	sh[4] =  vec3f(r1.x, g1.x, b1.x);
	sh[5] =  vec3f(r1.y, g1.y, b1.y);
	sh[6] =  vec3f(r1.z, g1.z, b1.z);
	sh[7] =  vec3f(r1.w, g1.w, b1.w);
	sh[8] =  vec3f(r2.x, g2.x, b2.x);
	sh[9] =  vec3f(r2.y, g2.y, b2.y);
	sh[10] = vec3f(r2.z, g2.z, b2.z);
	sh[11] = vec3f(r2.w, g2.w, b2.w);
	sh[12] = vec3f(r3.x, g3.x, b3.x);
	sh[13] = vec3f(r3.y, g3.y, b3.y);
	sh[14] = vec3f(r3.z, g3.z, b3.z);
	*scale = 1.0;
}
#endif
`,zxe=`
	#if SH_BANDS == 1
		const SH_COEFFS: i32 = 3;
	#elif SH_BANDS == 2
		const SH_COEFFS: i32 = 8;
	#elif SH_BANDS == 3
		const SH_COEFFS: i32 = 15;
	#else
		const SH_COEFFS: i32 = 0;
	#endif
	#if SH_BANDS > 0
	const SH_C1: f32 = 0.4886025119029199;
	#if SH_BANDS > 1
		const SH_C2_0: f32 = 1.0925484305920792;
		const SH_C2_1: f32 = -1.0925484305920792;
		const SH_C2_2: f32 = 0.31539156525252005;
		const SH_C2_3: f32 = -1.0925484305920792;
		const SH_C2_4: f32 = 0.5462742152960396;
	#endif
	#if SH_BANDS > 2
		const SH_C3_0: f32 = -0.5900435899266435;
		const SH_C3_1: f32 = 2.890611442640554;
		const SH_C3_2: f32 = -0.4570457994644658;
		const SH_C3_3: f32 = 0.3731763325901154;
		const SH_C3_4: f32 = -0.4570457994644658;
		const SH_C3_5: f32 = 1.445305721320277;
		const SH_C3_6: f32 = -0.5900435899266435;
	#endif
	fn evalSH(sh: ptr<function, array<vec3f, SH_COEFFS>>, dir: vec3f) -> vec3f {
		let x = dir.x;
		let y = dir.y;
		let z = dir.z;
		var result = SH_C1 * (-sh[0] * y + sh[1] * z - sh[2] * x);
		#if SH_BANDS > 1
			let xx = x * x;
			let yy = y * y;
			let zz = z * z;
			let xy = x * y;
			let yz = y * z;
			let xz = x * z;
			result = result + (
				sh[3] * (SH_C2_0 * xy) +
				sh[4] * (SH_C2_1 * yz) +
				sh[5] * (SH_C2_2 * (2.0 * zz - xx - yy)) +
				sh[6] * (SH_C2_3 * xz) +
				sh[7] * (SH_C2_4 * (xx - yy))
			);
		#endif
		#if SH_BANDS > 2
			result = result + (
				sh[8]  * (SH_C3_0 * y * (3.0 * xx - yy)) +
				sh[9]  * (SH_C3_1 * xy * z) +
				sh[10] * (SH_C3_2 * y * (4.0 * zz - xx - yy)) +
				sh[11] * (SH_C3_3 * z * (2.0 * zz - 3.0 * xx - 3.0 * yy)) +
				sh[12] * (SH_C3_4 * x * (4.0 * zz - xx - yy)) +
				sh[13] * (SH_C3_5 * z * (xx - yy)) +
				sh[14] * (SH_C3_6 * x * (xx - 3.0 * yy))
			);
		#endif
		return result;
	}
	#endif
`,Vxe=`
fn quatToMat3(R: vec4<f32>) -> mat3x3<f32> {
	let R2: vec4<f32> = R + R;
	let X: f32	   = R2.x * R.w;
	let Y: vec4<f32> = R2.y * R;
	let Z: vec4<f32> = R2.z * R;
	let W: f32	   = R2.w * R.w;
	return mat3x3<f32>(
		1.0 - Z.z - W,  Y.z + X,	  Y.w - Z.x,
		Y.z - X,		1.0 - Y.y - W, Z.w + Y.x,
		Y.w + Z.x,	  Z.w - Y.x,	 1.0 - Y.y - Z.z
	);
}
`,jxe=`
var sh0: texture_2d<f32>;
uniform sh0_mins: vec4f;
uniform sh0_maxs: vec4f;
const SH_C0: f32 = 0.28209479177387814;
fn readColor(source: ptr<function, SplatSource>) -> vec4f {
	let clr: vec4f = mix(uniform.sh0_mins, uniform.sh0_maxs, textureLoad(sh0, source.uv, 0));
	return vec4f(vec3f(0.5) + clr.xyz * SH_C0, 1.0 / (1.0 + exp(-clr.w)));
}
`,$xe=`
var means_u: texture_2d<f32>;
var means_l: texture_2d<f32>;
var quats: texture_2d<f32>;
var scales: texture_2d<f32>;
uniform means_mins: vec3f;
uniform means_maxs: vec3f;
uniform scales_mins: vec3f;
uniform scales_maxs: vec3f;
fn readCenter(source: ptr<function, SplatSource>) -> vec3f {
	let u: vec3f = textureLoad(means_u, source.uv, 0).xyz;
	let l: vec3f = textureLoad(means_l, source.uv, 0).xyz;
	let n: vec3f = (l * 255.0 + u * 255.0 * 256.0) / 65535.0;
	let v: vec3f = mix(uniform.means_mins, uniform.means_maxs, n);
	return sign(v) * (exp(abs(v)) - 1.0);
}
const norm: f32 = 2.0 / sqrt(2.0);
fn readCovariance(source: ptr<function, SplatSource>, covA_ptr: ptr<function, vec3f>, covB_ptr: ptr<function, vec3f>) {
	let qdata: vec4f = textureLoad(quats, source.uv, 0);
	let abc: vec3f = (qdata.xyz - 0.5) * norm;
	let d: f32 = sqrt(max(0.0, 1.0 - dot(abc, abc)));
	let mode: u32 = u32(qdata.w * 255.0 + 0.5) - 252u;
	var quat: vec4f;
	if (mode == 0u) {
		quat = vec4f(d, abc);
	} else if (mode == 1u) {
		quat = vec4f(abc.x, d, abc.y, abc.z);
	} else if (mode == 2u) {
		quat = vec4f(abc.x, abc.y, d, abc.z);
	} else {
		quat = vec4f(abc.x, abc.y, abc.z, d);
	}
	let rot: mat3x3f = quatToMat3(quat);
	let scale: vec3f = exp(mix(uniform.scales_mins, uniform.scales_maxs, textureLoad(scales, source.uv, 0).xyz));
	let M: mat3x3f = transpose(mat3x3f(
		scale.x * rot[0],
		scale.y * rot[1],
		scale.z * rot[2]
	));
	*covA_ptr = vec3f(dot(M[0], M[0]), dot(M[0], M[1]), dot(M[0], M[2]));
	*covB_ptr = vec3f(dot(M[1], M[1]), dot(M[1], M[2]), dot(M[2], M[2]));
}
`,Hxe=`
var sh_labels: texture_2d<f32>;
var sh_centroids: texture_2d<f32>;
uniform shN_mins: f32;
uniform shN_maxs: f32;
fn readSHData(source: ptr<function, SplatSource>, sh: ptr<function, array<vec3f, SH_COEFFS>>, scale: ptr<function, f32>) {
	let t: vec2<i32> = vec2<i32>(textureLoad(sh_labels, source.uv, 0).xy * 255.0);
	let n: i32 = t.x + t.y * 256;
	let u: i32 = (n % 64) * SH_COEFFS;
	let v: i32 = n / 64;
	for (var i: i32 = 0; i < SH_COEFFS; i = i + 1) {
		sh[i] = mix(vec3f(uniform.shN_mins), vec3f(uniform.shN_maxs), textureLoad(sh_centroids, vec2<i32>(u + i, v), 0).xyz);
	}
	*scale = 1.0;
}
`,Gxe=`
uniform viewport: vec2f;
uniform camera_params: vec4f;
fn initCorner(source: ptr<function, SplatSource>, center: ptr<function, SplatCenter>, corner: ptr<function, SplatCorner>) -> bool {
	var covA: vec3f;
	var covB: vec3f;
	readCovariance(source, &covA, &covB);
	let Vrk = mat3x3f(
		vec3f(covA.x, covA.y, covA.z),
		vec3f(covA.y, covB.x, covB.y),
		vec3f(covA.z, covB.y, covB.z)
	);
	let focal = uniform.viewport.x * center.projMat00;
	let v = select(center.view.xyz, vec3f(0.0, 0.0, 1.0), uniform.camera_params.w == 1.0);
	let J1 = focal / v.z;
	let J2 = -J1 / v.z * v.xy;
	let J = mat3x3f(
		vec3f(J1, 0.0, J2.x),
		vec3f(0.0, J1, J2.y),
		vec3f(0.0, 0.0, 0.0)
	);
	let W = transpose(mat3x3f(center.modelView[0].xyz, center.modelView[1].xyz, center.modelView[2].xyz));
	let T = W * J;
	let cov = transpose(T) * Vrk * T;
	#if GSPLAT_AA
		let detOrig = cov[0][0] * cov[1][1] - cov[0][1] * cov[1][0];
		let detBlur = (cov[0][0] + 0.3) * (cov[1][1] + 0.3) - cov[0][1] * cov[1][0];
		corner.aaFactor = sqrt(detOrig / detBlur);
	#endif
	let diagonal1 = cov[0][0] + 0.3;
	let offDiagonal = cov[0][1];
	let diagonal2 = cov[1][1] + 0.3;
	let mid = 0.5 * (diagonal1 + diagonal2);
	let radius = length(vec2f((diagonal1 - diagonal2) / 2.0, offDiagonal));
	let lambda1 = mid + radius;
	let lambda2 = max(mid - radius, 0.1);
	let vmin = min(1024.0, min(uniform.viewport.x, uniform.viewport.y));
	let l1 = 2.0 * min(sqrt(2.0 * lambda1), vmin);
	let l2 = 2.0 * min(sqrt(2.0 * lambda2), vmin);
	if (l1 < 2.0 && l2 < 2.0) {
		return false;
	}
	let c = center.proj.ww / uniform.viewport;
	if (any((abs(center.proj.xy) - vec2f(max(l1, l2)) * c) > center.proj.ww)) {
		return false;
	}
	let diagonalVector = normalize(vec2f(offDiagonal, lambda1 - diagonal1));
	let v1 = l1 * diagonalVector;
	let v2 = l2 * vec2f(diagonalVector.y, -diagonalVector.x);
	corner.offset = (source.cornerUV.x * v1 + source.cornerUV.y * v2) * c;
	corner.uv = source.cornerUV;
	return true;
}
`,Wxe=`
var transformA: texture_2d<u32>;
var transformB: texture_2d<f32>;
var<private> tAw: u32;
fn readCenter(source: ptr<function, SplatSource>) -> vec3f {
	let tA: vec4<u32> = textureLoad(transformA, source.uv, 0);
	tAw = tA.w;
	return bitcast<vec3f>(tA.xyz);
}
fn unpackRotation(packed: vec3f) -> vec4f {
	return vec4f(packed.xyz, sqrt(max(0.0, 1.0 - dot(packed, packed))));
}
fn readCovariance(source: ptr<function, SplatSource>, covA_ptr: ptr<function, vec3f>, covB_ptr: ptr<function, vec3f>) {
	let tB: vec4f = textureLoad(transformB, source.uv, 0);
	let rot: mat3x3f = quatToMat3(unpackRotation(vec3f(unpack2x16float(bitcast<u32>(tAw)), tB.w)).wxyz);
	let scale: vec3f = tB.xyz;
	let M = transpose(mat3x3f(
		scale.x * rot[0],
		scale.y * rot[1],
		scale.z * rot[2]
	));
	*covA_ptr = vec3f(dot(M[0], M[0]), dot(M[0], M[1]), dot(M[0], M[2]));
	*covB_ptr = vec3f(dot(M[1], M[1]), dot(M[1], M[2]), dot(M[2], M[2]));
}
`,Xxe=`
#include "tonemappingPS"
#include "decodePS"
#include "gammaPS"
fn prepareOutputFromGamma(gammaColor: vec3f) -> vec3f {
	#if TONEMAP == NONE
		#if GAMMA == NONE
			return decodeGamma3(gammaColor);
		#else 
			return gammaColor;
		#endif
	#else
		return gammaCorrectOutput(toneMap(decodeGamma3(gammaColor)));
	#endif
}
`,qxe=`
#ifndef DITHER_NONE
	#include "bayerPS"
	#include "opacityDitherPS"
	varying id: f32;
#endif
#ifdef PICK_PASS
	#include "pickPS"
#endif
#if defined(SHADOW_PASS) || defined(PICK_PASS) || defined(PREPASS_PASS)
	uniform alphaClip: f32;
#endif
#ifdef PREPASS_PASS
	varying vLinearDepth: f32;
	#include "floatAsUintPS"
#endif
const EXP_A: f32	  = 12102203.0;
const EXP_BC_RMS: i32 = 1064866808;
fn fastExp(x: f32) -> f32 {
	var i: i32 = i32(EXP_A * x) + EXP_BC_RMS;
	return bitcast<f32>(i);
}
varying gaussianUV: vec2f;
varying gaussianColor: vec4f;
@fragment
fn fragmentMain(input: FragmentInput) -> FragmentOutput {
	var output: FragmentOutput;
	let A: f32 = dot(gaussianUV, gaussianUV);
	if (A > 1.0) {
		discard;
		return output;
	}
	var alpha: f32 = fastExp(-A * 4.0) * gaussianColor.a;
	#if defined(SHADOW_PASS) || defined(PICK_PASS) || defined(PREPASS_PASS)
		if (alpha < uniform.alphaClip) {
			discard;
			return output;
		}
	#endif
	#ifdef PICK_PASS
		output.color = getPickOutput();
	#elif SHADOW_PASS
		output.color = vec4f(0.0, 0.0, 0.0, 1.0);
	#elif PREPASS_PASS
		output.color = float2vec4(vLinearDepth);
	#else
		if (alpha < (1.0 / 255.0)) {
			discard;
			return output;
		}
		#ifndef DITHER_NONE
			opacityDither(&alpha, id * 0.013);
		#endif
		output.color = vec4f(input.gaussianColor.xyz * alpha, alpha);
	#endif
	return output;
}`,Yxe=`
#if SH_BANDS > 0
fn unpack111011s(bits: u32) -> vec3f {
	return (vec3f((vec3<u32>(bits) >> vec3<u32>(21u, 11u, 0u)) & vec3<u32>(0x7ffu, 0x3ffu, 0x7ffu)) / vec3f(2047.0, 1023.0, 2047.0)) * 2.0 - 1.0;
}
struct ScaleAndSH {
	scale: f32,
	a: vec3f,
	b: vec3f,
	c: vec3f
};
fn fetchScale(t_in: vec4<u32>) -> ScaleAndSH {
	var result: ScaleAndSH;
	result.scale = bitcast<f32>(t_in.x);
	result.a = unpack111011s(t_in.y);
	result.b = unpack111011s(t_in.z);
	result.c = unpack111011s(t_in.w);
	return result;
}
struct SH {
	a: vec3f,
	b: vec3f,
	c: vec3f,
	d: vec3f
};
fn fetch4(t_in: vec4<u32>) -> SH {
	var result: SH;
	result.a = unpack111011s(t_in.x);
	result.b = unpack111011s(t_in.y);
	result.c = unpack111011s(t_in.z);
	result.d = unpack111011s(t_in.w);
	return result;
}
fn fetch1(t_in: u32) -> vec3f {
	return unpack111011s(t_in);
}
#if SH_BANDS == 1
	var splatSH_1to3: texture_2d<u32>;
	fn readSHData(source: ptr<function, SplatSource>, sh: ptr<function, array<vec3f, 3>>, scale: ptr<function, f32>) {
		let result = fetchScale(textureLoad(splatSH_1to3, source.uv, 0));
		*scale = result.scale;
		sh[0] = result.a;
		sh[1] = result.b;
		sh[2] = result.c;
	}
#elif SH_BANDS == 2
	var splatSH_1to3: texture_2d<u32>;
	var splatSH_4to7: texture_2d<u32>;
	var splatSH_8to11: texture_2d<u32>;
	fn readSHData(source: ptr<function, SplatSource>, sh: ptr<function, array<vec3f, 8>>, scale: ptr<function, f32>) {
		let first: ScaleAndSH = fetchScale(textureLoad(splatSH_1to3, source.uv, 0));
		*scale = first.scale;
		sh[0] = first.a;
		sh[1] = first.b;
		sh[2] = first.c;
		let second: SH = fetch4(textureLoad(splatSH_4to7, source.uv, 0));
		sh[3] = second.a;
		sh[4] = second.b;
		sh[5] = second.c;
		sh[6] = second.d;
		sh[7] = fetch1(textureLoad(splatSH_8to11, source.uv, 0).x);
	}
#else
	var splatSH_1to3: texture_2d<u32>;
	var splatSH_4to7: texture_2d<u32>;
	var splatSH_8to11: texture_2d<u32>;
	var splatSH_12to15: texture_2d<u32>;
	fn readSHData(source: ptr<function, SplatSource>, sh: ptr<function, array<vec3f, 15>>, scale: ptr<function, f32>) {
		let first: ScaleAndSH = fetchScale(textureLoad(splatSH_1to3, source.uv, 0));
		*scale = first.scale;
		sh[0] = first.a;
		sh[1] = first.b;
		sh[2] = first.c;
		let second: SH = fetch4(textureLoad(splatSH_4to7, source.uv, 0));
		sh[3] = second.a;
		sh[4] = second.b;
		sh[5] = second.c;
		sh[6] = second.d;
		let third: SH = fetch4(textureLoad(splatSH_8to11, source.uv, 0));
		sh[7] = third.a;
		sh[8] = third.b;
		sh[9] = third.c;
		sh[10] = third.d;
		let fourth: SH = fetch4(textureLoad(splatSH_12to15, source.uv, 0));
		sh[11] = fourth.a;
		sh[12] = fourth.b;
		sh[13] = fourth.c;
		sh[14] = fourth.d;
	}
#endif
#endif
`,Kxe=`
attribute vertex_position: vec3f;
attribute vertex_id_attrib: u32;
uniform numSplats: u32;
var splatOrder: texture_2d<u32>;
fn initSource(source: ptr<function, SplatSource>) -> bool {
	let w: u32 = textureDimensions(splatOrder, 0).x;
	source.order = vertex_id_attrib + u32(vertex_position.z);
	if (source.order >= uniform.numSplats) {
		return false;
	}
	let orderUV = vec2i(vec2u(source.order % w, source.order / w));
	source.id = textureLoad(splatOrder, orderUV, 0).r;
	source.uv = vec2i(vec2u(source.id % w, source.id / w));
	source.cornerUV = vertex_position.xy;
	return true;
}
`,Zxe=`
#include "gsplatCommonVS"
varying gaussianUV: vec2f;
varying gaussianColor: vec4f;
#ifndef DITHER_NONE
	varying id: f32;
#endif
const discardVec: vec4f = vec4f(0.0, 0.0, 2.0, 1.0);
#ifdef PREPASS_PASS
	varying vLinearDepth: f32;
#endif
@vertex
fn vertexMain(input: VertexInput) -> VertexOutput {
	var output: VertexOutput;
	var source: SplatSource;
	if (!initSource(&source)) {
		output.position = discardVec;
		return output;
	}
	let modelCenter: vec3f = readCenter(&source);
	var center: SplatCenter;
	if (!initCenter(modelCenter, &center)) {
		output.position = discardVec;
		return output;
	}
	var corner: SplatCorner;
	if (!initCorner(&source, &center, &corner)) {
		output.position = discardVec;
		return output;
	}
	var clr: vec4f = readColor(&source);
	#if GSPLAT_AA
		clr.a = clr.a * corner.aaFactor;
	#endif
	#if SH_BANDS > 0
		let modelView3x3 = mat3x3f(center.modelView[0].xyz, center.modelView[1].xyz, center.modelView[2].xyz);
		let dir = normalize(modelView3x3 * center.view);
		var sh: array<vec3f, SH_COEFFS>;
		var scale: f32;
		readSHData(&source, &sh, &scale);
		clr = vec4f(clr.xyz + evalSH(&sh, dir) * scale, clr.a);
	#endif
	clipCorner(&corner, clr.w);
	output.position = center.proj + vec4f(corner.offset, 0.0, 0.0);
	output.gaussianUV = corner.uv;
	output.gaussianColor = vec4f(prepareOutputFromGamma(max(clr.xyz, vec3f(0.0))), clr.w);
	#ifndef DITHER_NONE
		output.id = f32(source.id);
	#endif
	#ifdef PREPASS_PASS
		output.vLinearDepth = -center.view.z;
	#endif
	return output;
}
`,Qxe=`
	attribute aPosition: vec2f;
	varying uv0: vec2f;
	@vertex fn vertexMain(input: VertexInput) -> VertexOutput {
		var output: VertexOutput;
		output.position = vec4f(input.aPosition, 0.0, 1.0);
		output.uv0 = getImageEffectUV((input.aPosition + 1.0) * 0.5);
		return output;
	}
`,Jxe=`
struct DrawIndexedIndirectArgs {
	indexCount: u32,
	instanceCount: u32,
	firstIndex: u32,
	baseVertex: i32,
	firstInstance: u32
};
struct DrawIndirectArgs {
	vertexCount: u32,
	instanceCount: u32,
	firstVertex: u32,
	firstInstance: u32,
	_pad: u32
};
`,ebe=`
	#include "gammaPS"
	varying color: vec4f;
	@fragment
	fn fragmentMain(input : FragmentInput) -> FragmentOutput {
		var output: FragmentOutput;
		output.color = vec4f(gammaCorrectOutput(decodeGamma3(input.color.rgb)), input.color.a);
		return output;
	}
`,tbe=`
	attribute vertex_position: vec4f;
	attribute vertex_color: vec4f;
	uniform matrix_model: mat4x4f;
	uniform matrix_viewProjection: mat4x4f;
	varying color: vec4f;
	@vertex
	fn vertexMain(input : VertexInput) -> VertexOutput {
		var output : VertexOutput;
		output.color = input.vertex_color;
		output.position = uniform.matrix_viewProjection * uniform.matrix_model * input.vertex_position;
		return output;
	}
`,ibe=`
uniform material_iridescenceRefractionIndex: f32;
fn iridescence_iorToFresnelScalar(transmittedIor: f32, incidentIor: f32) -> f32 {
	return pow((transmittedIor - incidentIor) / (transmittedIor + incidentIor), 2.0);
}
fn iridescence_iorToFresnelVec3(transmittedIor: vec3f, incidentIor: f32) -> vec3f {
	return pow((transmittedIor - vec3f(incidentIor)) / (transmittedIor + vec3f(incidentIor)), vec3f(2.0));
}
fn iridescence_fresnelToIor(f0: vec3f) -> vec3f {
	let sqrtF0: vec3f = sqrt(f0);
	return (vec3f(1.0) + sqrtF0) / (vec3f(1.0) - sqrtF0);
}
const XYZ_TO_REC709: mat3x3f = mat3x3f(
	vec3f(3.2404542, -1.5371385, -0.4985314),
	vec3f(-0.9692660,  1.8760108,  0.0415560),
	vec3f(0.0556434, -0.2040259,  1.0572252)
);
fn iridescence_sensitivity(opd: f32, shift: vec3f) -> vec3f {
	let PI: f32 = 3.141592653589793;
	let phase: f32 = 2.0 * PI * opd * 1.0e-9;
	const val: vec3f = vec3f(5.4856e-13, 4.4201e-13, 5.2481e-13);
	const pos: vec3f = vec3f(1.6810e+06, 1.7953e+06, 2.2084e+06);
	const var_: vec3f = vec3f(4.3278e+09, 9.3046e+09, 6.6121e+09);
	var xyz: vec3f = val * sqrt(2.0 * PI * var_) * cos(pos * phase + shift) * exp(-pow(phase, 2.0) * var_);
	xyz.x = xyz.x + 9.7470e-14 * sqrt(2.0 * PI * 4.5282e+09) * cos(2.2399e+06 * phase + shift[0]) * exp(-4.5282e+09 * pow(phase, 2.0));
	xyz = xyz / vec3f(1.0685e-07);
	return XYZ_TO_REC709 * xyz;
}
fn iridescence_fresnelScalar(cosTheta: f32, f0: f32) -> f32 {
	let x: f32 = clamp(1.0 - cosTheta, 0.0, 1.0);
	let x2: f32 = x * x;
	let x5: f32 = x * x2 * x2;
	return f0 + (1.0 - f0) * x5;
}
fn iridescence_fresnelVec3(cosTheta: f32, f0: vec3f) -> vec3f {
	let x: f32 = clamp(1.0 - cosTheta, 0.0, 1.0);
	let x2: f32 = x * x;
	let x5: f32 = x * x2 * x2;
	return f0 + (vec3f(1.0) - f0) * x5;
}
fn calcIridescence(outsideIor: f32, cosTheta: f32, base_f0: vec3f, iridescenceThickness: f32) -> vec3f {
	let PI: f32 = 3.141592653589793;
	let iridescenceIor: f32 = mix(outsideIor, uniform.material_iridescenceRefractionIndex, smoothstep(0.0, 0.03, iridescenceThickness));
	let sinTheta2Sq: f32 = pow(outsideIor / iridescenceIor, 2.0) * (1.0 - pow(cosTheta, 2.0));
	let cosTheta2Sq: f32 = 1.0 - sinTheta2Sq;
	if (cosTheta2Sq < 0.0) {
		return vec3f(1.0);
	}
	let cosTheta2: f32 = sqrt(cosTheta2Sq);
	let r0: f32 = iridescence_iorToFresnelScalar(iridescenceIor, outsideIor);
	let r12: f32 = iridescence_fresnelScalar(cosTheta, r0);
	let r21: f32 = r12;
	let t121: f32 = 1.0 - r12;
	let phi12: f32 = select(0.0, PI, iridescenceIor < outsideIor);
	let phi21: f32 = PI - phi12;
	let baseIor: vec3f = iridescence_fresnelToIor(base_f0 + vec3f(0.0001));
	let r1: vec3f = iridescence_iorToFresnelVec3(baseIor, iridescenceIor);
	let r23: vec3f = iridescence_fresnelVec3(cosTheta2, r1);
	let phi23: vec3f = select(vec3f(0.0), vec3f(PI), baseIor < vec3f(iridescenceIor));
	let opd: f32 = 2.0 * iridescenceIor * iridescenceThickness * cosTheta2;
	let phi: vec3f = vec3f(phi21) + phi23;
	let r123Sq: vec3f = clamp(vec3f(r12) * r23, vec3f(1e-5), vec3f(0.9999));
	let r123: vec3f = sqrt(r123Sq);
	let rs: vec3f = pow(vec3f(t121), vec3f(2.0)) * r23 / (vec3f(1.0) - r123Sq);
	let c0: vec3f = vec3f(r12) + rs;
	var i_irid: vec3f = c0;
	var cm: vec3f = rs - vec3f(t121);
	cm = cm * r123;
	let sm1: vec3f = 2.0 * iridescence_sensitivity(1.0 * opd, 1.0 * phi);
	i_irid = i_irid + cm * sm1;
	cm = cm * r123;
	let sm2: vec3f = 2.0 * iridescence_sensitivity(2.0 * opd, 2.0 * phi);
	i_irid = i_irid + cm * sm2;
	return max(i_irid, vec3f(0.0));
}
fn getIridescenceDiffraction(cosTheta: f32, specularity: vec3f, iridescenceThickness: f32) -> vec3f {
	return calcIridescence(1.0, cosTheta, specularity, iridescenceThickness);
}
`,rbe=`
#ifdef STD_IRIDESCENCE_CONSTANT
	uniform material_iridescence: f32;
#endif
fn getIridescence() {
	var iridescence = 1.0;
	#ifdef STD_IRIDESCENCE_CONSTANT
	iridescence = iridescence * uniform.material_iridescence;
	#endif
	#ifdef STD_IRIDESCENCE_TEXTURE
	iridescence = iridescence * textureSampleBias({STD_IRIDESCENCE_TEXTURE_NAME}, {STD_IRIDESCENCE_TEXTURE_NAME}Sampler, {STD_IRIDESCENCE_TEXTURE_UV}, uniform.textureBias).{STD_IRIDESCENCE_TEXTURE_CHANNEL};
	#endif
	dIridescence = iridescence; 
}
`,sbe=`
uniform material_iridescenceThicknessMax: f32;
#ifdef STD_IRIDESCENCETHICKNESS_TEXTURE
	uniform material_iridescenceThicknessMin: f32;
#endif
fn getIridescenceThickness() {
	#ifdef STD_IRIDESCENCETHICKNESS_TEXTURE
		var blend: f32 = textureSampleBias({STD_IRIDESCENCETHICKNESS_TEXTURE_NAME}, {STD_IRIDESCENCETHICKNESS_TEXTURE_NAME}Sampler, {STD_IRIDESCENCETHICKNESS_TEXTURE_UV}, uniform.textureBias).{STD_IRIDESCENCETHICKNESS_TEXTURE_CHANNEL};
		var iridescenceThickness: f32 = mix(uniform.material_iridescenceThicknessMin, uniform.material_iridescenceThicknessMax, blend);
	#else
		var iridescenceThickness: f32 = uniform.material_iridescenceThicknessMax;
	#endif
	dIridescenceThickness = iridescenceThickness; 
}
`,nbe=`
#ifdef STD_IOR_CONSTANT
	uniform material_refractionIndex: f32;
#endif
fn getIor() {
#ifdef STD_IOR_CONSTANT
	dIor = uniform.material_refractionIndex;
#else
	dIor = 1.0 / 1.5;
#endif
}
`,abe=`
#if defined(LIGHT{i})
	uniform light{i}_color: vec3f;
	#if LIGHT{i}TYPE == DIRECTIONAL
		uniform light{i}_direction: vec3f;
	#else
		#define LIT_CODE_LIGHTS_POINT
		uniform light{i}_position: vec3f;
		uniform light{i}_radius: f32;
		#if LIGHT{i}TYPE == SPOT
			#define LIT_CODE_LIGHTS_SPOT
			uniform light{i}_direction: vec3f;
			uniform light{i}_innerConeAngle: f32;
			uniform light{i}_outerConeAngle: f32;
		#endif
	#endif
	#if LIGHT{i}SHAPE != PUNCTUAL
		#define LIT_CODE_FALLOFF_SQUARED
		#if LIGHT{i}TYPE == DIRECTIONAL
			uniform light{i}_position: vec3f;
		#endif
		uniform light{i}_halfWidth: vec3f;
		uniform light{i}_halfHeight: vec3f;
	#else
		#if LIGHT{i}FALLOFF == LINEAR
			#define LIT_CODE_FALLOFF_LINEAR
		#endif
		#if LIGHT{i}FALLOFF == INVERSESQUARED
			#define LIT_CODE_FALLOFF_SQUARED
		#endif
	#endif
	#if defined(LIGHT{i}CASTSHADOW)
		uniform light{i}_shadowMatrix: mat4x4f;
		uniform light{i}_shadowIntensity: f32;
		uniform light{i}_shadowParams: vec4f;
		#if LIGHT{i}SHADOWTYPE == PCSS_32F
			uniform light{i}_shadowSearchArea: f32;
			uniform light{i}_cameraParams: vec4f;
			#if LIGHT{i}TYPE == DIRECTIONAL
				uniform light{i}_softShadowParams: vec4f;
			#endif
		#endif
		#if LIGHT{i}TYPE == DIRECTIONAL
			uniform light{i}_shadowMatrixPalette: array<mat4x4f, 4>;
			uniform light{i}_shadowCascadeDistances: vec4f;
			uniform light{i}_shadowCascadeCount: i32;
			uniform light{i}_shadowCascadeBlend: f32;
		#endif
		#if LIGHT{i}TYPE == OMNI
			NOT SUPPORTED
			
		#else
			#if defined(LIGHT{i}SHADOW_PCF)
				var light{i}_shadowMap: texture_depth_2d;
				var light{i}_shadowMapSampler: sampler_comparison;
			#else
				var light{i}_shadowMap: texture_2d<f32>;
				var light{i}_shadowMapSampler: sampler;
			#endif
		#endif
	#endif
	#if defined(LIGHT{i}COOKIE)
		#define LIT_CODE_COOKIE
		#if LIGHT{i}TYPE == OMNI
			NOT SUPPORTED
		#endif
		#if LIGHT{i}TYPE == SPOT
			NOT SUPPORTED
		#endif
	#endif
#endif
`,obe=`
fn getLightDiffuse(worldNormal: vec3f, viewDir: vec3f, lightDirNorm: vec3f) -> f32 {
	return max(dot(worldNormal, -lightDirNorm), 0.0);
}
`,lbe=`
fn evalOmniLight(lightPosW: vec3f) -> vec3f {
	return vPositionW - lightPosW;
}
`,cbe=`
#if defined(LIGHT{i})
	evaluateLight{i}(
		#if defined(LIT_IRIDESCENCE)
			iridescenceFresnel
		#endif
	);
#endif
`,ube=`
#if defined(LIGHT{i})
fn evaluateLight{i}(
	#if defined(LIT_IRIDESCENCE)
		iridescenceFresnel: vec3f
	#endif
) {
	var lightColor: vec3f = uniform.light{i}_color;
	#if LIGHT{i}TYPE == DIRECTIONAL && !defined(LIT_SHADOW_CATCHER)
		if (all(lightColor == vec3f(0.0, 0.0, 0.0))) {
			return;
		}
	#endif
	#if LIGHT{i}TYPE == DIRECTIONAL
		dLightDirNormW = uniform.light{i}_direction;
		dAtten = 1.0;
	#else
		var lightDirW: vec3f = evalOmniLight(uniform.light{i}_position);
		dLightDirNormW = normalize(lightDirW);
		#if defined(LIGHT{i}COOKIE)
			#if LIGHT{i}TYPE == SPOT
				#ifdef LIGHT{i}COOKIE_FALLOFF
					#ifdef LIGHT{i}COOKIE_TRANSFORM
						var cookieAttenuation: vec3f = getCookie2DXform(uniform.light{i}_cookie, uniform.light{i}_shadowMatrix, uniform.light{i}_cookieIntensity, uniform.light{i}_cookieMatrix, uniform.light{i}_cookieOffset).{LIGHT{i}COOKIE_CHANNEL};
					#else
						var cookieAttenuation: vec3f = getCookie2D(uniform.light{i}_cookie, uniform.light{i}_shadowMatrix, uniform.light{i}_cookieIntensity).{LIGHT{i}COOKIE_CHANNEL};
					#endif
				#else
					#ifdef LIGHT{i}COOKIE_TRANSFORM
						var cookieAttenuation: vec3f = getCookie2DClipXform(uniform.light{i}_cookie, uniform.light{i}_shadowMatrix, uniform.light{i}_cookieIntensity, uniform.light{i}_cookieMatrix, uniform.light{i}_cookieOffset).{LIGHT{i}COOKIE_CHANNEL};
					#else
						var cookieAttenuation: vec3f = getCookie2DClip(uniform.light{i}_cookie, uniform.light{i}_shadowMatrix, uniform.light{i}_cookieIntensity).{LIGHT{i}COOKIE_CHANNEL};
					#endif
				#endif
			#endif
			#if LIGHT{i}TYPE == OMNI
				var cookieAttenuation: vec3f = getCookieCube(uniform.light{i}_cookie, uniform.light{i}_shadowMatrix, uniform.light{i}_cookieIntensity).{LIGHT{i}COOKIE_CHANNEL};
			#endif
			lightColor = lightColor * cookieAttenuation;
		#endif
		#if LIGHT{i}SHAPE == PUNCTUAL
			#if LIGHT{i}FALLOFF == LINEAR
				dAtten = getFalloffLinear(uniform.light{i}_radius, lightDirW);
			#else
				dAtten = getFalloffInvSquared(uniform.light{i}_radius, lightDirW);
			#endif
		#else
			dAtten = getFalloffWindow(uniform.light{i}_radius, lightDirW);
		#endif
		#if LIGHT{i}TYPE == SPOT
			#if !defined(LIGHT{i}COOKIE) || defined(LIGHT{i}COOKIE_FALLOFF)
				dAtten = dAtten * getSpotEffect(uniform.light{i}_direction, uniform.light{i}_innerConeAngle, uniform.light{i}_outerConeAngle, dLightDirNormW);
			#endif
		#endif
	#endif
	if (dAtten < 0.00001) {
		return;
	}
	#if LIGHT{i}SHAPE != PUNCTUAL
		#if LIGHT{i}SHAPE == RECT
			calcRectLightValues(uniform.light{i}_position, uniform.light{i}_halfWidth, uniform.light{i}_halfHeight);
		#elif LIGHT{i}SHAPE == DISK
			calcDiskLightValues(uniform.light{i}_position, uniform.light{i}_halfWidth, uniform.light{i}_halfHeight);
		#elif LIGHT{i}SHAPE == SPHERE
			calcSphereLightValues(uniform.light{i}_position, uniform.light{i}_halfWidth, uniform.light{i}_halfHeight);
		#endif
	#endif
	#if LIGHT{i}SHAPE != PUNCTUAL
		#if LIGHT{i}TYPE == DIRECTIONAL
			var attenDiffuse: f32 = getLightDiffuse(litArgs_worldNormal, dViewDirW, dLightDirNormW);
		#else
			#if LIGHT{i}SHAPE == RECT
				var attenDiffuse: f32 = getRectLightDiffuse(litArgs_worldNormal, dViewDirW, lightDirW, dLightDirNormW) * 16.0;
			#elif LIGHT{i}SHAPE == DISK
				var attenDiffuse: f32 = getDiskLightDiffuse(litArgs_worldNormal, dViewDirW, lightDirW, dLightDirNormW) * 16.0;
			#elif LIGHT{i}SHAPE == SPHERE
				var attenDiffuse: f32 = getSphereLightDiffuse(litArgs_worldNormal, dViewDirW, lightDirW, dLightDirNormW) * 16.0;
			#endif
		#endif
	#else
		dAtten = dAtten * getLightDiffuse(litArgs_worldNormal, vec3(0.0), dLightDirNormW);
	#endif
	#ifdef LIGHT{i}CASTSHADOW
		#if LIGHT{i}TYPE == DIRECTIONAL
			var shadow: f32 = getShadow{i}(vec3(0.0));
		#else
			var shadow: f32 = getShadow{i}(lightDirW);
		#endif
		shadow = mix(1.0, shadow, uniform.light{i}_shadowIntensity);
		dAtten = dAtten * shadow;
		#if defined(LIT_SHADOW_CATCHER) && LIGHT{i}TYPE == DIRECTIONAL
			dShadowCatcher = dShadowCatcher * shadow;
		#endif			
	#endif
	#if LIGHT{i}SHAPE != PUNCTUAL
		#ifdef LIT_SPECULAR
			dDiffuseLight = dDiffuseLight + (((attenDiffuse * dAtten) * lightColor) * (1.0 - dLTCSpecFres));
		#else
			dDiffuseLight = dDiffuseLight + ((attenDiffuse * dAtten) * lightColor);
		#endif						
	#else
		#if defined(AREA_LIGHTS) && defined(LIT_SPECULAR)
			dDiffuseLight = dDiffuseLight + ((dAtten * lightColor) * (1.0 - litArgs_specularity));
		#else
			dDiffuseLight = dDiffuseLight + (dAtten * lightColor);
		#endif
	#endif
	#ifdef LIGHT{i}AFFECT_SPECULARITY
		#if LIGHT{i}SHAPE != PUNCTUAL
			#ifdef LIT_CLEARCOAT
				#if LIGHT{i}SHAPE == RECT
					ccSpecularLight = ccSpecularLight + (ccLTCSpecFres * getRectLightSpecular(litArgs_clearcoat_worldNormal, dViewDirW) * dAtten * lightColor);
				#elif LIGHT{i}SHAPE == DISK
					ccSpecularLight = ccSpecularLight + (ccLTCSpecFres * getDiskLightSpecular(litArgs_clearcoat_worldNormal, dViewDirW) * dAtten * lightColor);
				#elif LIGHT{i}SHAPE == SPHERE
					ccSpecularLight = ccSpecularLight + (ccLTCSpecFres * getSphereLightSpecular(litArgs_clearcoat_worldNormal, dViewDirW) * dAtten * lightColor);
				#endif
			#endif
			#ifdef LIT_SPECULAR
				#if LIGHT{i}SHAPE == RECT
					dSpecularLight = dSpecularLight + (dLTCSpecFres * getRectLightSpecular(litArgs_worldNormal, dViewDirW) * dAtten * lightColor);
				#elif LIGHT{i}SHAPE == DISK
					dSpecularLight = dSpecularLight + (dLTCSpecFres * getDiskLightSpecular(litArgs_worldNormal, dViewDirW) * dAtten * lightColor);
				#elif LIGHT{i}SHAPE == SPHERE
					dSpecularLight = dSpecularLight + (dLTCSpecFres * getSphereLightSpecular(litArgs_worldNormal, dViewDirW) * dAtten * lightColor);
				#endif
			#endif
		#else
			#if LIGHT{i}TYPE == DIRECTIONAL && LIT_FRESNEL_MODEL != NONE
				#define LIGHT{i}FRESNEL
			#endif
			#ifdef LIT_SPECULAR
				var halfDirW: vec3f = normalize(-dLightDirNormW + dViewDirW);
			#endif
			#ifdef LIT_CLEARCOAT
				var lightspecularCC: vec3f = getLightSpecular(halfDirW, ccReflDirW, litArgs_clearcoat_worldNormal, dViewDirW, dLightDirNormW, litArgs_clearcoat_gloss, dTBN) * dAtten * lightColor;
				#ifdef LIGHT{i}FRESNEL
					lightspecularCC = lightspecularCC * getFresnelCC(dot(dViewDirW, halfDirW));
				#endif
				ccSpecularLight = ccSpecularLight + lightspecularCC;
			#endif
			#ifdef LIT_SHEEN
				sSpecularLight = sSpecularLight + (getLightSpecularSheen(halfDirW, litArgs_worldNormal, dViewDirW, dLightDirNormW, litArgs_sheen_gloss) * dAtten * lightColor);
			#endif
			#ifdef LIT_SPECULAR
				var lightSpecular: vec3f = getLightSpecular(halfDirW, dReflDirW, litArgs_worldNormal, dViewDirW, dLightDirNormW, litArgs_gloss, dTBN) * dAtten * lightColor;
				#ifdef LIGHT{i}FRESNEL
					#if defined(LIT_IRIDESCENCE)
						lightSpecular = lightSpecular * getFresnel(dot(dViewDirW, halfDirW), litArgs_gloss, litArgs_specularity, iridescenceFresnel, litArgs_iridescence_intensity);
					#else
						lightSpecular = lightSpecular * getFresnel(dot(dViewDirW, halfDirW), litArgs_gloss, litArgs_specularity);
					#endif
				#else
					lightSpecular = lightSpecular * litArgs_specularity;
				#endif
				
				dSpecularLight = dSpecularLight + lightSpecular;
			#endif
		#endif
	#endif
}
#endif
`,hbe=`
#ifdef LIGHT{i}CASTSHADOW
	fn getShadowSampleCoord{i}(shadowTransform: mat4x4f, shadowParams: vec4f, worldPosition: vec3f, lightPos: vec3f, lightDir: ptr<function, vec3f>, lightDirNorm: vec3f, normal: vec3f) -> vec3f {
		var surfacePosition = worldPosition;
		#ifdef LIGHT{i}_SHADOW_SAMPLE_POINT
			#ifdef LIGHT{i}_SHADOW_SAMPLE_NORMAL_OFFSET
				let distScale: f32 = length(*lightDir);
				surfacePosition = surfacePosition + normal * shadowParams.y * clamp(1.0 - dot(normal, -lightDirNorm), 0.0, 1.0) * distScale;
				*lightDir = surfacePosition - lightPos;
				return *lightDir;
			#endif
		#else
			#ifdef LIGHT{i}_SHADOW_SAMPLE_SOURCE_ZBUFFER
				#ifdef LIGHT{i}_SHADOW_SAMPLE_NORMAL_OFFSET
					surfacePosition = surfacePosition + normal * shadowParams.y;
				#endif
			#else
				#ifdef LIGHT{i}_SHADOW_SAMPLE_NORMAL_OFFSET
					#ifdef LIGHT{i}_SHADOW_SAMPLE_ORTHO
						var distScale: f32 = 1.0;
					#else
						var distScale: f32 = abs(dot(vPositionW - lightPos, lightDirNorm));
					#endif
					surfacePosition = surfacePosition + normal * shadowParams.y * clamp(1.0 - dot(normal, -lightDirNorm), 0.0, 1.0) * distScale;
				#endif
			#endif
			var positionInShadowSpace: vec4f = shadowTransform * vec4f(surfacePosition, 1.0);
			#ifdef LIGHT{i}_SHADOW_SAMPLE_ORTHO
				positionInShadowSpace.z = saturate(positionInShadowSpace.z) - 0.0001;
			#else
				#ifdef LIGHT{i}_SHADOW_SAMPLE_SOURCE_ZBUFFER
					positionInShadowSpace.xyz = positionInShadowSpace.xyz / positionInShadowSpace.w;
				#else
					positionInShadowSpace.xy = positionInShadowSpace.xy / positionInShadowSpace.w;
					positionInShadowSpace.z = length(*lightDir) * shadowParams.w;
				#endif
			#endif
			#ifdef SHADOW_SAMPLE_Z_BIAS
			#endif
			surfacePosition = positionInShadowSpace.xyz;
		#endif
		return surfacePosition;
	}
	fn getShadow{i}(lightDirW_in: vec3f) -> f32 {
		#ifdef LIGHT{i}_SHADOW_CASCADES
			var cascadeIndex: i32 = getShadowCascadeIndex(uniform.light{i}_shadowCascadeDistances, uniform.light{i}_shadowCascadeCount);
			#ifdef LIGHT{i}_SHADOW_CASCADE_BLEND
				cascadeIndex = ditherShadowCascadeIndex(cascadeIndex, uniform.light{i}_shadowCascadeDistances, uniform.light{i}_shadowCascadeCount, uniform.light{i}_shadowCascadeBlend);
			#endif
			var shadowMatrix: mat4x4f = uniform.light{i}_shadowMatrixPalette[cascadeIndex];
		#else
			var shadowMatrix: mat4x4f = uniform.light{i}_shadowMatrix;
		#endif
		var lightDirArg = lightDirW_in;
		#if LIGHT{i}TYPE == DIRECTIONAL
			var shadowCoord: vec3f = getShadowSampleCoord{i}(shadowMatrix, uniform.light{i}_shadowParams, vPositionW, vec3f(0.0), &lightDirArg, dLightDirNormW, dVertexNormalW);
		#else
			 var shadowCoord: vec3f = getShadowSampleCoord{i}(shadowMatrix, uniform.light{i}_shadowParams, vPositionW, uniform.light{i}_position, &lightDirArg, dLightDirNormW, dVertexNormalW);
		#endif
		#if LIGHT{i}TYPE == DIRECTIONAL
			shadowCoord = fadeShadow(shadowCoord, uniform.light{i}_shadowCascadeDistances);
		#endif
		#if LIGHT{i}TYPE == DIRECTIONAL
			#if LIGHT{i}SHADOWTYPE == VSM_16F
				return getShadowVSM16(light{i}_shadowMap, light{i}_shadowMapSampler, shadowCoord, uniform.light{i}_shadowParams, 5.54);
			#endif
			#if LIGHT{i}SHADOWTYPE == VSM_32F
				return getShadowVSM32(light{i}_shadowMap, light{i}_shadowMapSampler, shadowCoord, uniform.light{i}_shadowParams, 15.0);
			#endif
			#if LIGHT{i}SHADOWTYPE == PCSS_32F
				#if LIGHT{i}SHAPE != PUNCTUAL
					let shadowSearchArea = vec2f(length(uniform.light{i}_halfWidth), length(uniform.light{i}_halfHeight)) * uniform.light{i}_shadowSearchArea;
					return getShadowPCSS(light{i}_shadowMap, light{i}_shadowMapSampler, shadowCoord, uniform.light{i}_shadowParams, uniform.light{i}_cameraParams, shadowSearchArea, lightDirW_in);
				#else
					return getShadowPCSS(light{i}_shadowMap, light{i}_shadowMapSampler, shadowCoord, uniform.light{i}_shadowParams, uniform.light{i}_cameraParams, uniform.light{i}_softShadowParams, lightDirW_in);
				#endif
			#endif
			#if LIGHT{i}SHADOWTYPE == PCF1_16F || LIGHT{i}SHADOWTYPE == PCF1_32F
				return getShadowPCF1x1(light{i}_shadowMap, light{i}_shadowMapSampler, shadowCoord, uniform.light{i}_shadowParams);
			#endif
			#if LIGHT{i}SHADOWTYPE == PCF3_16F || LIGHT{i}SHADOWTYPE == PCF3_32F
				return getShadowPCF3x3(light{i}_shadowMap, light{i}_shadowMapSampler, shadowCoord, uniform.light{i}_shadowParams);
			#endif
			#if LIGHT{i}SHADOWTYPE == PCF5_16F || LIGHT{i}SHADOWTYPE == PCF5_32F
				return getShadowPCF5x5(light{i}_shadowMap, light{i}_shadowMapSampler, shadowCoord, uniform.light{i}_shadowParams);
			#endif
		#endif
		#if LIGHT{i}TYPE == SPOT
			#if LIGHT{i}SHADOWTYPE == VSM_16F
				return getShadowSpotVSM16(light{i}_shadowMap, light{i}_shadowMapSampler, shadowCoord, uniform.light{i}_shadowParams, 5.54, lightDirW_in);
			#endif
			#if LIGHT{i}SHADOWTYPE == VSM_32F
				return getShadowSpotVSM32(light{i}_shadowMap, light{i}_shadowMapSampler, shadowCoord, uniform.light{i}_shadowParams, 15.0, lightDirW_in);
			#endif
			#if LIGHT{i}SHADOWTYPE == PCSS_32F
				#if LIGHT{i}SHAPE != PUNCTUAL
					var shadowSearchArea: vec2f = vec2f(length(uniform.light{i}_halfWidth), length(uniform.light{i}_halfHeight)) * uniform.light{i}_shadowSearchArea;
				#else
					var shadowSearchArea: vec2f = vec2f(uniform.light{i}_shadowSearchArea);
				#endif
				return getShadowSpotPCSS(light{i}_shadowMap, light{i}_shadowMapSampler, shadowCoord, uniform.light{i}_shadowParams, uniform.light{i}_cameraParams, shadowSearchArea, lightDirW_in);
			#endif
			#if LIGHT{i}SHADOWTYPE == PCF1_16F || LIGHT{i}SHADOWTYPE == PCF1_32F
				return getShadowSpotPCF1x1(light{i}_shadowMap, light{i}_shadowMapSampler, shadowCoord, uniform.light{i}_shadowParams);
			#endif
			#if LIGHT{i}SHADOWTYPE == PCF3_16F || LIGHT{i}SHADOWTYPE == PCF3_32F
				return getShadowSpotPCF3x3(light{i}_shadowMap, light{i}_shadowMapSampler, shadowCoord, uniform.light{i}_shadowParams);
			#endif
			#if LIGHT{i}SHADOWTYPE == PCF5_16F || LIGHT{i}SHADOWTYPE == PCF5_32F
				return getShadowSpotPCF5x5(light{i}_shadowMap, light{i}_shadowMapSampler, shadowCoord, uniform.light{i}_shadowParams);
			#endif
		#endif
		#if LIGHT{i}TYPE == OMNI
			#if LIGHT{i}SHADOWTYPE == PCSS_32F
				 var shadowSearchArea: vec2f;
				 #if LIGHT{i}SHAPE != PUNCTUAL
					var shadowSearchArea: vec2f = vec2f(length(uniform.light{i}_halfWidth), length(uniform.light{i}_halfHeight)) * uniform.light{i}_shadowSearchArea;
				#else
					var shadowSearchArea: vec2f = vec2f(uniform.light{i}_shadowSearchArea);
				#endif
				return getShadowOmniPCSS(light{i}_shadowMap, light{i}_shadowMapSampler, shadowCoord, uniform.light{i}_shadowParams, uniform.light{i}_cameraParams, shadowSearchArea, lightDirW_in);
			#endif
			#if LIGHT{i}SHADOWTYPE == PCF1_16F || LIGHT{i}SHADOWTYPE == PCF1_32F
				return getShadowOmniPCF1x1(light{i}_shadowMap, light{i}_shadowMapSampler, shadowCoord, uniform.light{i}_shadowParams, lightDirW_in);
			#endif
			#if LIGHT{i}SHADOWTYPE == PCF3_16F || LIGHT{i}SHADOWTYPE == PCF3_32F
				return getShadowOmniPCF3x3(light{i}_shadowMap, light{i}_shadowMapSampler, shadowCoord, uniform.light{i}_shadowParams, lightDirW_in);
			#endif
		#endif
	}
#endif
`,dbe=`
#ifdef LIT_CLUSTERED_LIGHTS
	#define LIT_CODE_FALLOFF_LINEAR
	#define LIT_CODE_FALLOFF_SQUARED
	#define LIT_CODE_LIGHTS_POINT
	#define LIT_CODE_LIGHTS_SPOT
#endif
#ifdef AREA_LIGHTS
	var areaLightsLutTex1: texture_2d<f32>;
	var areaLightsLutTex1Sampler: sampler;
	var areaLightsLutTex2: texture_2d<f32>;
	var areaLightsLutTex2Sampler: sampler;
#endif
#ifdef LIT_LIGHTING
	#include "lightDiffuseLambertPS"
	#if defined(AREA_LIGHTS) || defined(LIT_CLUSTERED_AREA_LIGHTS)
		#include "ltcPS"
	#endif
#endif
#ifdef SHADOW_DIRECTIONAL
	#include "shadowCascadesPS"
#endif
#if defined(SHADOW_KIND_PCF1)
	#include "shadowPCF1PS"
#endif
#if defined(SHADOW_KIND_PCF3)
	#include "shadowPCF3PS"
#endif
#if defined(SHADOW_KIND_PCF5)
	#include "shadowPCF5PS"
#endif
#if defined(SHADOW_KIND_PCSS)
	#include "linearizeDepthPS"
	#include "shadowSoftPS"
#endif
#if defined(SHADOW_KIND_VSM)
	#include "shadowEVSMPS"
#endif
#ifdef LIT_CODE_FALLOFF_LINEAR
	#include "falloffLinearPS"
#endif
#ifdef LIT_CODE_FALLOFF_SQUARED
	#include "falloffInvSquaredPS"
#endif
#ifdef LIT_CODE_LIGHTS_POINT
	#include "lightDirPointPS"
#endif
#ifdef LIT_CODE_LIGHTS_SPOT
	#include "spotPS"
#endif
#ifdef LIT_CODE_COOKIE
	#include "cookiePS"
#endif
#ifdef LIT_CLUSTERED_LIGHTS
	#include "clusteredLightPS"
#endif
#ifdef LIGHT_COUNT > 0
	#include "lightFunctionShadowPS, LIGHT_COUNT"
	#include "lightFunctionLightPS, LIGHT_COUNT"
#endif
`,fbe=`
fn addLightMap(
	lightmap: vec3f,
	dir: vec3f,
	worldNormal: vec3f,
	viewDir: vec3f,
	reflectionDir: vec3f,
	gloss: f32,
	specularity: vec3f,
	vertexNormal: vec3f,
	tbn: mat3x3f
#if defined(LIT_IRIDESCENCE)
	, iridescenceFresnel: vec3f,
	iridescenceIntensity: f32
#endif
) {
	#if defined(LIT_SPECULAR) && defined(LIT_DIR_LIGHTMAP)
		if (dot(dir, dir) < 0.0001) {
				dDiffuseLight = dDiffuseLight + lightmap;
		} else {
			let vlight: f32 = saturate(dot(dir, -vertexNormal));
			let flight: f32 = saturate(dot(dir, -worldNormal));
			let nlight: f32 = (flight / max(vlight, 0.01)) * 0.5;
			dDiffuseLight = dDiffuseLight + lightmap * nlight * 2.0;
			let halfDir: vec3f = normalize(-dir + viewDir);
			var specularLight: vec3f = lightmap * getLightSpecular(halfDir, reflectionDir, worldNormal, viewDir, dir, gloss, tbn);
			#ifdef LIT_SPECULAR_FRESNEL
				specularLight = specularLight *
					getFresnel(dot(viewDir, halfDir),
					gloss,
					specularity
				#if defined(LIT_IRIDESCENCE)
					, iridescenceFresnel,
					iridescenceIntensity
				#endif
					);
			#endif
			dSpecularLight = dSpecularLight + specularLight;
		}
	#else
		dDiffuseLight = dDiffuseLight + lightmap;
	#endif
}
`,pbe=`
#ifdef STD_LIGHTMAP_DIR
	var<private> dLightmapDir: vec3f;
	var texture_dirLightMap: texture_2d<f32>;
	var texture_dirLightMapSampler: sampler;
#endif
fn getLightMap() {
	dLightmap = vec3f(1.0);
	#ifdef STD_LIGHT_TEXTURE
		dLightmap = dLightmap * {STD_LIGHT_TEXTURE_DECODE}(textureSampleBias({STD_LIGHT_TEXTURE_NAME}, {STD_LIGHT_TEXTURE_NAME}Sampler, {STD_LIGHT_TEXTURE_UV}, uniform.textureBias)).{STD_LIGHT_TEXTURE_CHANNEL};
		#ifdef STD_LIGHTMAP_DIR
			var dir: vec3f = textureSampleBias(texture_dirLightMap, texture_dirLightMapSampler, {STD_LIGHT_TEXTURE_UV}, uniform.textureBias).xyz * 2.0 - 1.0;
			var dirDot = dot(dir, dir);
			dLightmapDir = select(vec3(0.0), dir / sqrt(dirDot), dirDot > 0.001);
		#endif
	#endif
	#ifdef STD_LIGHT_VERTEX
		dLightmap = dLightmap * saturate(vVertexColor.{STD_LIGHT_VERTEX_CHANNEL});
	#endif
}
`,mbe=`
fn calcLightSpecular(gloss: f32, worldNormal: vec3f, viewDir: vec3f, h: vec3f, lightDirNorm: vec3f, tbn: mat3x3f) -> f32 {
	let PI: f32 = 3.141592653589793;
	let roughness: f32 = max((1.0 - gloss) * (1.0 - gloss), 0.001);
	let alphaRoughness: f32 = roughness * roughness;
	let anisotropy: f32 = dAnisotropy;
	let direction: vec2f = dAnisotropyRotation;
	let at: f32 = mix(alphaRoughness, 1.0, anisotropy * anisotropy);
	let ab: f32 = clamp(alphaRoughness, 0.001, 1.0);
	let anisotropicT: vec3f = normalize(tbn * vec3f(direction, 0.0));
	let anisotropicB: vec3f = normalize(cross(tbn[2], anisotropicT));
	let NoH: f32 = dot(worldNormal, h);
	let ToH: f32 = dot(anisotropicT, h);
	let BoH: f32 = dot(anisotropicB, h);
	let a2: f32 = at * ab;
	let v: vec3f = vec3f(ab * ToH, at * BoH, a2 * NoH);
	let v2: f32 = dot(v, v);
	let w2: f32 = a2 / v2;
	let D: f32 = a2 * w2 * w2 * (1.0 / PI);
	let ToV: f32 = dot(anisotropicT, viewDir);
	let BoV: f32 = dot(anisotropicB, viewDir);
	let ToL: f32 = dot(anisotropicT, -lightDirNorm);
	let BoL: f32 = dot(anisotropicB, -lightDirNorm);
	let NoV: f32 = dot(worldNormal, viewDir);
	let NoL: f32 = dot(worldNormal, -lightDirNorm);
	let lambdaV: f32 = NoL * length(vec3f(at * ToV, ab * BoV, NoV));
	let lambdaL: f32 = NoV * length(vec3f(at * ToL, ab * BoL, NoL));
	let G: f32 = 0.5 / (lambdaV + lambdaL);
	return D * G;
}
fn getLightSpecular(h: vec3f, reflDir: vec3f, worldNormal: vec3f, viewDir: vec3f, lightDirNorm: vec3f, gloss: f32, tbn: mat3x3f) -> f32 {
	return calcLightSpecular(gloss, worldNormal, viewDir, h, lightDirNorm, tbn);
}
`,gbe=`
fn calcLightSpecular(gloss: f32, worldNormal: vec3f, h: vec3f) -> f32 {
	let nh: f32 = max( dot( h, worldNormal ), 0.0 );
	var specPow: f32 = exp2(gloss * 11.0);
	specPow = max(specPow, 0.0001);
	return pow(nh, specPow) * (specPow + 2.0) / 8.0;
}
fn getLightSpecular(h: vec3f, reflDir: vec3f, worldNormal: vec3f, viewDir: vec3f, lightDirNorm: vec3f, gloss: f32, tbn: mat3x3f) -> f32 {
	return calcLightSpecular(gloss, worldNormal, h);
}
`,_be=`
fn sheenD(normal: vec3f, h: vec3f, roughness: f32) -> f32 {
	let PI: f32 = 3.141592653589793;
	let invR: f32 = 1.0 / (roughness * roughness);
	var cos2h: f32 = max(dot(normal, h), 0.0);
	cos2h = cos2h * cos2h;
	let sin2h: f32 = max(1.0 - cos2h, 0.0078125);
	return (2.0 + invR) * pow(sin2h, invR * 0.5) / (2.0 * PI);
}
fn sheenV(normal: vec3f, viewDir: vec3f, light: vec3f) -> f32 {
	let NoV: f32 = max(dot(normal, viewDir), 0.000001);
	let NoL: f32 = max(dot(normal, light), 0.000001);
	return 1.0 / (4.0 * (NoL + NoV - NoL * NoV));
}
fn getLightSpecularSheen(h: vec3f, worldNormal: vec3f, viewDir: vec3f, lightDirNorm: vec3f, sheenGloss: f32) -> f32 {
	let D: f32 = sheenD(worldNormal, h, sheenGloss);
	let V: f32 = sheenV(worldNormal, viewDir, -lightDirNorm);
	return D * V;
}`,vbe=`
#ifndef LINEARIZE_DEPTH
#define LINEARIZE_DEPTH
fn linearizeDepthWithParams(z: f32, cameraParams: vec4f) -> f32 {
	if (cameraParams.w == 0.0) {
		return (cameraParams.z * cameraParams.y) / (cameraParams.y + z * (cameraParams.z - cameraParams.y));
	} else {
		return cameraParams.z + z * (cameraParams.y - cameraParams.z);
	}
}
#ifndef CAMERAPLANES
	#define CAMERAPLANES
	uniform camera_params: vec4f;
#endif
fn linearizeDepth(z: f32) -> f32 {
	return linearizeDepthWithParams(z, uniform.camera_params);
}
#endif
`,ybe=`
fn evaluateBackend() -> FragmentOutput {
	var output: FragmentOutput;
	#ifdef LIT_SSAO
		litArgs_ao = litArgs_ao * textureSampleLevel(ssaoTexture, ssaoTextureSampler, pcPosition.xy * uniform.ssaoTextureSizeInv, 0.0).r;
	#endif
	#ifdef LIT_NEEDS_NORMAL
		#ifdef LIT_SPECULAR
			getReflDir(litArgs_worldNormal, dViewDirW, litArgs_gloss, dTBN);
		#endif
		#ifdef LIT_CLEARCOAT
			ccReflDirW = normalize(-reflect(dViewDirW, litArgs_clearcoat_worldNormal));
		#endif
	#endif
	#ifdef LIT_SPECULAR_OR_REFLECTION
		#ifdef LIT_METALNESS
			var f0: f32 = 1.0 / litArgs_ior;
			f0 = (f0 - 1.0) / (f0 + 1.0);
			f0 = f0 * f0;
			litArgs_specularity = getSpecularModulate(litArgs_specularity, litArgs_albedo, litArgs_metalness, f0);
			litArgs_albedo = getAlbedoModulate(litArgs_albedo, litArgs_metalness);
		#endif
		#ifdef LIT_IRIDESCENCE
			var iridescenceFresnel: vec3f = getIridescenceDiffraction(saturate(dot(dViewDirW, litArgs_worldNormal)), litArgs_specularity, litArgs_iridescence_thickness);
		#endif
	#endif
	#ifdef LIT_ADD_AMBIENT
		addAmbient(litArgs_worldNormal);
		#ifdef LIT_SPECULAR
			dDiffuseLight = dDiffuseLight * (1.0 - litArgs_specularity);
		#endif
		#ifdef LIT_SEPARATE_AMBIENT
			var dAmbientLight: vec3f = dDiffuseLight;
			dDiffuseLight = vec3(0.0);
		#endif
	#endif
	#ifndef LIT_OLD_AMBIENT
		dDiffuseLight = dDiffuseLight * uniform.material_ambient;
	#endif
	#ifdef LIT_AO
		#ifndef LIT_OCCLUDE_DIRECT
			occludeDiffuse(litArgs_ao);
		#endif
	#endif
	#ifdef LIT_LIGHTMAP
		addLightMap(
			litArgs_lightmap, 
			litArgs_lightmapDir, 
			litArgs_worldNormal, 
			dViewDirW, 
			dReflDirW, 
			litArgs_gloss, 
			litArgs_specularity, 
			dVertexNormalW,
			dTBN
		#if defined(LIT_IRIDESCENCE)
			, iridescenceFresnel,
			litArgs_iridescence_intensity
		#endif
		);
	#endif
	#ifdef LIT_LIGHTING || LIT_REFLECTIONS
		#ifdef LIT_REFLECTIONS
			#ifdef LIT_CLEARCOAT
				addReflectionCC(ccReflDirW, litArgs_clearcoat_gloss);
			
				#ifdef LIT_SPECULAR_FRESNEL
					ccFresnel = getFresnelCC(dot(dViewDirW, litArgs_clearcoat_worldNormal));
					ccReflection = ccReflection * ccFresnel;
				#else
					ccFresnel = 0.0;
				#endif
			#endif
			#ifdef LIT_SPECULARITY_FACTOR
				ccReflection = ccReflection * litArgs_specularityFactor;
			#endif
			#ifdef LIT_SHEEN
				addReflectionSheen(litArgs_worldNormal, dViewDirW, litArgs_sheen_gloss);
			#endif
			addReflection(dReflDirW, litArgs_gloss);
			#ifdef LIT_FRESNEL_MODEL
				dReflection = vec4f(
					dReflection.rgb * getFresnel(
						dot(dViewDirW, litArgs_worldNormal),
						litArgs_gloss,
						litArgs_specularity
					#if defined(LIT_IRIDESCENCE)
						, iridescenceFresnel,
						litArgs_iridescence_intensity
					#endif
						),
					dReflection.a
				);
			#else
				dReflection = vec4f(dReflection.rgb * litArgs_specularity, dReflection.a);
			#endif
			#ifdef LIT_SPECULARITY_FACTOR
				dReflection = vec4f(dReflection.rgb * litArgs_specularityFactor, dReflection.a);
			#endif
		#endif
		#ifdef AREA_LIGHTS
			dSpecularLight = dSpecularLight * litArgs_specularity;
			#ifdef LIT_SPECULAR
				calcLTCLightValues(litArgs_gloss, litArgs_worldNormal, dViewDirW, litArgs_specularity, litArgs_clearcoat_gloss, litArgs_clearcoat_worldNormal, litArgs_clearcoat_specularity);
			#endif
		#endif
		
		#ifdef LIGHT_COUNT > 0
			#include "lightEvaluationPS, LIGHT_COUNT"
		#endif
		#ifdef LIT_CLUSTERED_LIGHTS
			addClusteredLights(litArgs_worldNormal, dViewDirW, dReflDirW,
				#if defined(LIT_CLEARCOAT)
						ccReflDirW,
				#endif
						litArgs_gloss, litArgs_specularity, dVertexNormalW, dTBN, 
				#if defined(LIT_IRIDESCENCE)
						iridescenceFresnel,
				#endif
						litArgs_clearcoat_worldNormal, litArgs_clearcoat_gloss, litArgs_sheen_gloss, litArgs_iridescence_intensity
			);
		#endif
		#ifdef AREA_LIGHTS
			#ifdef LIT_CLEARCOAT
				litArgs_clearcoat_specularity = 1.0;
			#endif
			#ifdef LIT_SPECULAR
				litArgs_specularity = vec3(1.0);
			#endif
		#endif
		#ifdef LIT_REFRACTION
			addRefraction(
				litArgs_worldNormal, 
				dViewDirW, 
				litArgs_thickness, 
				litArgs_gloss, 
				litArgs_specularity, 
				litArgs_albedo, 
				litArgs_transmission,
				litArgs_ior,
				litArgs_dispersion
				#if defined(LIT_IRIDESCENCE)
					, iridescenceFresnel, 
					litArgs_iridescence_intensity
				#endif
			);
		#endif
	#endif
	#ifdef LIT_AO
		#ifdef LIT_OCCLUDE_DIRECT
			occludeDiffuse(litArgs_ao);
		#endif
		#if LIT_OCCLUDE_SPECULAR != NONE
			occludeSpecular(litArgs_gloss, litArgs_ao, litArgs_worldNormal, dViewDirW);
		#endif
	#endif
	#ifdef LIT_SPECULARITY_FACTOR
		dSpecularLight = dSpecularLight * litArgs_specularityFactor;
	#endif
	#if !defined(LIT_OPACITY_FADES_SPECULAR)
		#if LIT_BLEND_TYPE == NORMAL || LIT_BLEND_TYPE == PREMULTIPLIED
			var specLum: f32 = dot((dSpecularLight + dReflection.rgb * dReflection.a), vec3f( 0.2126, 0.7152, 0.0722 ));
			#ifdef LIT_CLEARCOAT
				specLum = specLum + dot(ccSpecularLight * litArgs_clearcoat_specularity + ccReflection * litArgs_clearcoat_specularity, vec3f( 0.2126, 0.7152, 0.0722 ));
			#endif
			litArgs_opacity = clamp(litArgs_opacity + gammaCorrectInput(specLum), 0.0, 1.0);
		#endif
		litArgs_opacity = litArgs_opacity * uniform.material_alphaFade;
	#endif
	#ifdef LIT_LIGHTMAP_BAKING
		#ifdef LIT_LIGHTMAP_BAKING_COLOR
			#include "bakeLmEndPS"
		#endif
		#ifdef LIT_LIGHTMAP_BAKING_DIR
			#include "bakeDirLmEndPS"
		#endif
	#else
		#include "endPS"
		#include "outputAlphaPS"
	#endif
	#ifdef LIT_MSDF
		output.color = applyMsdf(output.color);
	#endif
	#include "outputPS"
	#include "debugOutputPS"
	#ifdef LIT_SHADOW_CATCHER
		output.color = vec4f(vec3f(dShadowCatcher), output.color.a);
	#endif
	return output;
}
`,Sbe=`
var<private> sReflection: vec3f;
var<private> dVertexNormalW: vec3f;
var<private> dTangentW: vec3f;
var<private> dBinormalW: vec3f;
var<private> dViewDirW: vec3f;
var<private> dReflDirW: vec3f;
var<private> ccReflDirW: vec3f;
var<private> dLightDirNormW: vec3f;
var<private> dAtten: f32;
var<private> dTBN: mat3x3f;
var<private> dReflection: vec4f;
var<private> dDiffuseLight: vec3f;
var<private> dSpecularLight: vec3f;
var<private> ccFresnel: f32;
var<private> ccReflection: vec3f;
var<private> ccSpecularLight: vec3f;
var<private> ccSpecularityNoFres: f32;
var<private> sSpecularLight: vec3f;
#ifdef LIT_DISPERSION
	uniform material_dispersion: f32;
#endif
#ifndef LIT_OPACITY_FADES_SPECULAR
	uniform material_alphaFade: f32;
#endif
#ifdef LIT_SSAO
	var ssaoTexture : texture_2d<f32>;
	var ssaoTextureSampler : sampler;
	uniform ssaoTextureSizeInv: vec2f;
#endif
#ifdef LIT_SHADOW_CATCHER
	var<private> dShadowCatcher: f32 = 1.0;
#endif
#if LIGHT_COUNT > 0
	#include "lightDeclarationPS, LIGHT_COUNT"
#endif
#ifdef LIT_SPECULAR
	#if LIT_FRESNEL_MODEL == NONE && !defined(LIT_REFLECTIONS) && !defined(LIT_DIFFUSE_MAP) 
		#define LIT_OLD_AMBIENT
	#endif
#endif
#ifdef STD_LIGHTMAP_DIR
	uniform bakeDir: f32;
#endif
#ifdef LIT_LIGHTMAP_BAKING_ADD_AMBIENT
	uniform ambientBakeOcclusionContrast: f32;
	uniform ambientBakeOcclusionBrightness: f32;
#endif
`,xbe=`
@fragment
fn fragmentMain(input: FragmentInput) -> FragmentOutput {
	#include "litUserMainStartPS"
	dReflection = vec4f(0.0);
	#ifdef LIT_CLEARCOAT
		ccSpecularLight = vec3f(0.0);
		ccReflection = vec3f(0.0);
	#endif
	#if LIT_NONE_SLICE_MODE == SLICED
		#include "startNineSlicedPS"
	#elif LIT_NONE_SLICE_MODE == TILED
		#include "startNineSlicedTiledPS"
	#endif
	#ifdef LIT_NEEDS_NORMAL
		dVertexNormalW = normalize(vNormalW);
		#ifdef LIT_TANGENTS
			#if defined(LIT_HEIGHTS) || defined(LIT_USE_NORMALS) || defined(LIT_USE_CLEARCOAT_NORMALS) || defined(LIT_GGX_SPECULAR)
				dTangentW = vTangentW;
				dBinormalW = vBinormalW;
			#endif
		#endif
		getViewDir();
		#ifdef LIT_TBN
			getTBN(dTangentW, dBinormalW, dVertexNormalW);
			#ifdef LIT_TWO_SIDED_LIGHTING
				handleTwoSidedLighting();
			#endif
		#endif
	#endif
	evaluateFrontend();
	#include "debugProcessFrontendPS"
	var output: FragmentOutput = evaluateBackend();
	#include "litUserMainEndPS"
	return output;
}
`,bbe=`
#ifdef LIT_NEEDS_NORMAL
	#include "cubeMapRotatePS"
	#include "cubeMapProjectPS"
	#include "envProcPS"
#endif
#ifdef LIT_SPECULAR_OR_REFLECTION
	#ifdef LIT_METALNESS
		#include "metalnessModulatePS"
	#endif
	#if LIT_FRESNEL_MODEL == SCHLICK
		#include "fresnelSchlickPS"
	#endif
	#ifdef LIT_IRIDESCENCE
		#include "iridescenceDiffractionPS"
	#endif
#endif
#ifdef LIT_AO
	#include "aoDiffuseOccPS"
	#include "aoSpecOccPS"
#endif
#if LIT_REFLECTION_SOURCE == ENVATLASHQ
	#include "envAtlasPS"
	#include "reflectionEnvHQPS"
#elif LIT_REFLECTION_SOURCE == ENVATLAS
	#include "envAtlasPS"
	#include "reflectionEnvPS"
#elif LIT_REFLECTION_SOURCE == CUBEMAP
	#include "reflectionCubePS"
#elif LIT_REFLECTION_SOURCE == SPHEREMAP
	#include "reflectionSpherePS"
#endif
#ifdef LIT_REFLECTIONS
	#ifdef LIT_CLEARCOAT
		#include "reflectionCCPS"
	#endif
	#ifdef LIT_SHEEN
		#include "reflectionSheenPS"
	#endif
#endif
#ifdef LIT_REFRACTION
	#if defined(LIT_DYNAMIC_REFRACTION)
		#include "refractionDynamicPS"
	#elif defined(LIT_REFLECTIONS)
		#include "refractionCubePS"
	#endif
#endif
#ifdef LIT_SHEEN
	#include "lightSheenPS"
#endif
uniform material_ambient: vec3f;
#ifdef LIT_SPECULAR
	#ifdef LIT_LIGHTING
		#ifdef LIT_GGX_SPECULAR
			#include "lightSpecularAnisoGGXPS"
		#else
			#include "lightSpecularBlinnPS"
		#endif
	#endif
#endif
#include "combinePS"
#ifdef LIT_LIGHTMAP
	#include "lightmapAddPS"
#endif
#ifdef LIT_ADD_AMBIENT
	#include "ambientPS"
#endif
#ifdef LIT_MSDF
	#include "msdfPS"
#endif
#ifdef LIT_NEEDS_NORMAL
	#include "viewDirPS"
	#ifdef LIT_SPECULAR
		#ifdef LIT_GGX_SPECULAR
			#include "reflDirAnisoPS"
		#else
			#include "reflDirPS"
		#endif
	#endif
#endif
#include "lightingPS"
`,wbe=`
#include "basePS"
#include "sphericalPS"
#include "decodePS"
#include "gammaPS"
#include "tonemappingPS"
#include "fogPS"
#if LIT_NONE_SLICE_MODE == SLICED
	#include "baseNineSlicedPS"
#elif LIT_NONE_SLICE_MODE == TILED
	#include "baseNineSlicedTiledPS"
#endif
#ifdef LIT_TBN
	#include "TBNPS"
	#ifdef LIT_TWO_SIDED_LIGHTING
		#include "twoSidedLightingPS"
	#endif
#endif
`,Tbe=`
#include "varyingsPS"
#include "litUserDeclarationPS"
#include "frontendDeclPS"
#if defined(PICK_PASS) || defined(PREPASS_PASS)
	#include "frontendCodePS"
	#include "litUserCodePS"
	#include "litOtherMainPS"
#elif defined(SHADOW_PASS)
	#include "frontendCodePS"
	#include "litUserCodePS"
	#include "litShadowMainPS"
#else
	#include "litForwardDeclarationPS"
	#include "litForwardPreCodePS"
	#include "frontendCodePS"
	#include "litForwardPostCodePS"
	#include "litForwardBackendPS"
	#include "litUserCodePS"
	#include "litForwardMainPS"
#endif
`,Ebe=`
#include "varyingsVS"
#include  "litUserDeclarationVS"
#ifdef VERTEX_COLOR
	attribute vertex_color: vec4f;
#endif
#ifdef NINESLICED
	varying vMask: vec2f;
	varying vTiledUv: vec2f;
	var<private> dMaskGlobal: vec2f;
	var<private> dTiledUvGlobal: vec2f;
	uniform innerOffset: vec4f;
	uniform outerScale: vec2f;
	uniform atlasRect: vec4f;
#endif
var<private> dPositionW: vec3f;
var<private> dModelMatrix: mat4x4f;
#include "transformCoreVS"
#ifdef UV0
	attribute vertex_texCoord0: vec2f;
	#include "uv0VS"
#endif
#ifdef UV1
	attribute vertex_texCoord1: vec2f;
	#include "uv1VS"
#endif
#ifdef LINEAR_DEPTH
	#ifndef VIEWMATRIX
	#define VIEWMATRIX
		uniform matrix_view: mat4x4f;
	#endif
#endif
#include "transformVS"
#ifdef NORMALS
	#include "normalCoreVS"
	#include "normalVS"
#endif
#ifdef TANGENTS
	attribute vertex_tangent: vec4f;
#endif
#include "uvTransformUniformsPS, UV_TRANSFORMS_COUNT"
#ifdef MSDF
	#include "msdfVS"
#endif
#include  "litUserCodeVS"
@vertex
fn vertexMain(input : VertexInput) -> VertexOutput {
	#include "litUserMainStartVS"
	var output : VertexOutput;
	output.position = getPosition();
	output.vPositionW = getWorldPosition();
	#ifdef NORMALS
		output.vNormalW = getNormal();
	#endif
	#ifdef TANGENTS
		output.vTangentW = normalize(dNormalMatrix * vertex_tangent.xyz);
		output.vBinormalW = cross(output.vNormalW, output.vTangentW) * vertex_tangent.w;
	#elif defined(GGX_SPECULAR)
		output.vObjectSpaceUpW = normalize(dNormalMatrix * vec3f(0.0, 1.0, 0.0));
	#endif
	#ifdef UV0
		var uv0: vec2f = getUv0();
		#ifdef UV0_UNMODIFIED
			output.vUv0 = uv0;
		#endif
	#endif
	#ifdef UV1
		var uv1: vec2f = getUv1();
		#ifdef UV1_UNMODIFIED
			output.vUv1 = uv1;
		#endif
	#endif
	#include "uvTransformVS, UV_TRANSFORMS_COUNT"
	#ifdef VERTEX_COLOR
		output.vVertexColor = vertex_color;
	#endif
	#ifdef LINEAR_DEPTH
		output.vLinearDepth = -(uniform.matrix_view * vec4f(output.vPositionW, 1.0)).z;
	#endif
	#ifdef MSDF
		unpackMsdfParams();
		output.outline_color = dOutlineColor;
		output.outline_thickness = dOutlineThickness;
		output.shadow_color = dShadowColor;
		output.shadow_offset = dShadowOffset;
	#endif
	#ifdef NINESLICED
		output.vMask = dMaskGlobal;
		output.vTiledUv = dTiledUvGlobal;
	#endif
	#include "litUserMainEndVS"
	return output;
}
`,Abe=`
#ifdef PICK_PASS
	#include "pickPS"
#endif
#ifdef PREPASS_PASS
	#include "floatAsUintPS"
#endif
@fragment
fn fragmentMain(input: FragmentInput) -> FragmentOutput {
	#include "litUserMainStartPS"
	var output: FragmentOutput;
	
	evaluateFrontend();
	#ifdef PICK_PASS
		output.color = getPickOutput();
	#endif
	#ifdef PREPASS_PASS
		output.color = float2vec4(vLinearDepth);
	#endif
	#include "litUserMainEndPS"
	return output;
}
`,Cbe=`
var<private> litArgs_albedo: vec3f;
var<private> litArgs_opacity: f32;
var<private> litArgs_emission: vec3f;
var<private> litArgs_worldNormal: vec3f;
var<private> litArgs_ao: f32;
var<private> litArgs_lightmap: vec3f;
var<private> litArgs_lightmapDir: vec3f;
var<private> litArgs_metalness: f32;
var<private> litArgs_specularity: vec3f;
var<private> litArgs_specularityFactor: f32;
var<private> litArgs_gloss: f32;
var<private> litArgs_sheen_gloss: f32;
var<private> litArgs_sheen_specularity: vec3f;
var<private> litArgs_transmission: f32;
var<private> litArgs_thickness: f32;
var<private> litArgs_ior: f32;
var<private> litArgs_dispersion: f32;
var<private> litArgs_iridescence_intensity: f32;
var<private> litArgs_iridescence_thickness: f32;
var<private> litArgs_clearcoat_worldNormal: vec3f;
var<private> litArgs_clearcoat_specularity: f32;
var<private> litArgs_clearcoat_gloss: f32;
`,Pbe=`
	#if LIT_NONE_SLICE_MODE == TILED
		var<private> textureBias: f32 = -1000.0;
	#else
		uniform textureBias: f32;
	#endif
	#include "litShaderArgsPS"
`,Ibe=`
#if LIGHT_TYPE != DIRECTIONAL
	uniform view_position: vec3f;
	uniform light_radius: f32;
#endif
#if SHADOW_TYPE == PCSS_32F
	#include "linearizeDepthPS"
#endif
@fragment
fn fragmentMain(input: FragmentInput) -> FragmentOutput {
	#include "litUserMainStartPS"
	var output: FragmentOutput;
	evaluateFrontend();
	#ifdef PERSPECTIVE_DEPTH
		var depth: f32 = input.position.z;
		#if SHADOW_TYPE == PCSS_32F
			#if LIGHT_TYPE != DIRECTIONAL
				depth = linearizeDepthWithParams(depth, camera_params);
			#endif
		#endif
	#else
		var depth: f32 = min(distance(uniform.view_position, input.vPositionW) / uniform.light_radius, 0.99999);
		#define MODIFIED_DEPTH
	#endif
	#if SHADOW_TYPE == VSM_16F || SHADOW_TYPE == VSM_32F
		#if SHADOW_TYPE == VSM_32F
			var exponent: f32 = 15.0;
		#else
			var exponent: f32 = 5.54;
		#endif
		var depth_vsm = 2.0 * depth - 1.0;
		depth_vsm = exp(exponent * depth_vsm);
		output.color = vec4f(depth_vsm, depth_vsm * depth_vsm, 1.0, 1.0);
	#else
		#if SHADOW_TYPE == PCSS_32F
			output.color = vec4f(depth, 0.0, 0.0, 1.0);
		#else
			#ifdef MODIFIED_DEPTH
				output.fragDepth = depth;
			#endif
			output.color = vec4f(1.0);
		#endif
	#endif
	#include "litUserMainEndPS"
	
	return output;
}
`,Mbe=`
fn LTC_Uv(N: vec3f, V: vec3f, roughness: f32) -> vec2f {
	const LUT_SIZE: f32 = 64.0;
	const LUT_SCALE: f32 = (LUT_SIZE - 1.0) / LUT_SIZE;
	const LUT_BIAS: f32 = 0.5 / LUT_SIZE;
	let dotNV: f32 = saturate(dot( N, V ));
	let uv: vec2f = vec2f( roughness, sqrt( 1.0 - dotNV ) );
	return uv * LUT_SCALE + LUT_BIAS;
}
fn LTC_ClippedSphereFormFactor( f: vec3f ) -> f32 {
	let l: f32 = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
fn LTC_EdgeVectorFormFactor( v1: vec3f, v2: vec3f ) -> vec3f {
	let x: f32 = dot( v1, v2 );
	let y: f32 = abs( x );
	let a: f32 = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	let b: f32 = 3.4175940 + ( 4.1616724 + y ) * y;
	let v: f32 = a / b;
	let inv_sqrt_term = inverseSqrt( max( 1.0 - x * x, 1e-7f ) );
	let theta_sintheta: f32 = select( (0.5 * inv_sqrt_term - v), v, x > 0.0 );
	return cross( v1, v2 ) * theta_sintheta;
}
struct Coords {
	coord0: vec3f,
	coord1: vec3f,
	coord2: vec3f,
	coord3: vec3f,
}
fn LTC_EvaluateRect( N: vec3f, V: vec3f, P: vec3f, mInv: mat3x3f, rectCoords: Coords) -> f32 {
	let v1: vec3f = rectCoords.coord1 - rectCoords.coord0;
	let v2: vec3f = rectCoords.coord3 - rectCoords.coord0;
	let lightNormal: vec3f = cross( v1, v2 );
	let factor: f32 = sign(-dot( lightNormal, P - rectCoords.coord0 ));
	let T1: vec3f = normalize( V - N * dot( V, N ) );
	let T2: vec3f = factor * cross( N, T1 );
	let mat: mat3x3f = mInv * transpose( mat3x3f( T1, T2, N ) );
	var coords: array<vec3f, 4>;
	coords[0] = mat * ( rectCoords.coord0 - P );
	coords[1] = mat * ( rectCoords.coord1 - P );
	coords[2] = mat * ( rectCoords.coord2 - P );
	coords[3] = mat * ( rectCoords.coord3 - P );
	coords[0] = normalize( coords[0] );
	coords[1] = normalize( coords[1] );
	coords[2] = normalize( coords[2] );
	coords[3] = normalize( coords[3] );
	var vectorFormFactor: vec3f = vec3f( 0.0 );
	vectorFormFactor = vectorFormFactor + LTC_EdgeVectorFormFactor( coords[0], coords[1] );
	vectorFormFactor = vectorFormFactor + LTC_EdgeVectorFormFactor( coords[1], coords[2] );
	vectorFormFactor = vectorFormFactor + LTC_EdgeVectorFormFactor( coords[2], coords[3] );
	vectorFormFactor = vectorFormFactor + LTC_EdgeVectorFormFactor( coords[3], coords[0] );
	let result: f32 = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return result;
}
var<private> dLTCCoords: Coords;
fn getLTCLightCoords(lightPos: vec3f, halfWidth: vec3f, halfHeight: vec3f) -> Coords {
	var coords: Coords;
	coords.coord0 = lightPos + halfWidth - halfHeight;
	coords.coord1 = lightPos - halfWidth - halfHeight;
	coords.coord2 = lightPos - halfWidth + halfHeight;
	coords.coord3 = lightPos + halfWidth + halfHeight;
	return coords;
}
var<private> dSphereRadius: f32;
fn getSphereLightCoords(lightPos: vec3f, halfWidth: vec3f, halfHeight: vec3f) -> Coords {
	dSphereRadius = max(length(halfWidth), length(halfHeight));
	let f: vec3f = reflect(normalize(lightPos - uniform.view_position), vNormalW);
	let w: vec3f = normalize(cross(f, halfHeight));
	let h: vec3f = normalize(cross(f, w));
	return getLTCLightCoords(lightPos, w * dSphereRadius, h * dSphereRadius);
}
var<private> dLTCUV: vec2f;
#ifdef LIT_CLEARCOAT
	var<private> ccLTCUV: vec2f;
#endif
fn getLTCLightUV(gloss: f32, worldNormal: vec3f, viewDir: vec3f) -> vec2f {
	let roughness: f32 = max((1.0 - gloss) * (1.0 - gloss), 0.001);
	return LTC_Uv( worldNormal, viewDir, roughness );
}
var<private> dLTCSpecFres: vec3f;
#ifdef LIT_CLEARCOAT
	var<private> ccLTCSpecFres: vec3f;
#endif
fn getLTCLightSpecFres(uv: vec2f, specularity: vec3f) -> vec3f {
	let t2: vec4f = textureSampleLevel(areaLightsLutTex2, areaLightsLutTex2Sampler, uv, 0.0);
	return specularity * t2.x + ( vec3f( 1.0 ) - specularity) * t2.y;
}
fn calcLTCLightValues(gloss: f32, worldNormal: vec3f, viewDir: vec3f, specularity: vec3f, clearcoatGloss: f32, clearcoatWorldNormal: vec3f, clearcoatSpecularity: f32) {
	dLTCUV = getLTCLightUV(gloss, worldNormal, viewDir);
	dLTCSpecFres = getLTCLightSpecFres(dLTCUV, specularity);
	#ifdef LIT_CLEARCOAT
		ccLTCUV = getLTCLightUV(clearcoatGloss, clearcoatWorldNormal, viewDir);
		ccLTCSpecFres = getLTCLightSpecFres(ccLTCUV, vec3f(clearcoatSpecularity));
	#endif
}
fn calcRectLightValues(lightPos: vec3f, halfWidth: vec3f, halfHeight: vec3f) {
	dLTCCoords = getLTCLightCoords(lightPos, halfWidth, halfHeight);
}
fn calcDiskLightValues(lightPos: vec3f, halfWidth: vec3f, halfHeight: vec3f) {
	calcRectLightValues(lightPos, halfWidth, halfHeight);
}
fn calcSphereLightValues(lightPos: vec3f, halfWidth: vec3f, halfHeight: vec3f) {
	dLTCCoords = getSphereLightCoords(lightPos, halfWidth, halfHeight);
}
fn SolveCubic(Coefficient_in: vec4f) -> vec3f {
	let pi: f32 = 3.14159;
	var Coefficient = Coefficient_in;
	Coefficient = vec4f(Coefficient.xyz / Coefficient.w, Coefficient.w);
	let new_yz: vec2f = Coefficient.yz / 3.0;
	Coefficient = vec4f(Coefficient.x, new_yz.x, new_yz.y, Coefficient.w);
	
	let A: f32 = Coefficient.w;
	let B: f32 = Coefficient.z;
	let C: f32 = Coefficient.y;
	let D: f32 = Coefficient.x;
	let Delta: vec3f = vec3f(
		-Coefficient.z * Coefficient.z + Coefficient.y,
		-Coefficient.y * Coefficient.z + Coefficient.x,
		dot(vec2f(Coefficient.z, -Coefficient.y), Coefficient.xy)
	);
	let Discriminant: f32 = dot(vec2f(4.0 * Delta.x, -Delta.y), Delta.zy);
	var xlc: vec2f;
	var xsc: vec2f;
	{
		let A_a: f32 = 1.0;
		let C_a: f32 = Delta.x;
		let D_a: f32 = -2.0 * B * Delta.x + Delta.y;
		let Theta: f32 = atan2(sqrt(Discriminant), -D_a) / 3.0;
		let sqrt_neg_Ca = sqrt(-C_a);
		let x_1a: f32 = 2.0 * sqrt_neg_Ca * cos(Theta);
		let x_3a: f32 = 2.0 * sqrt_neg_Ca * cos(Theta + (2.0 / 3.0) * pi);
		let xl: f32 = select(x_3a, x_1a, (x_1a + x_3a) > 2.0 * B);
		xlc = vec2f(xl - B, A);
	}
	{
		let A_d: f32 = D;
		let C_d: f32 = Delta.z;
		let D_d: f32 = -D * Delta.y + 2.0 * C * Delta.z;
		let Theta: f32 = atan2(D * sqrt(Discriminant), -D_d) / 3.0;
		let sqrt_neg_Cd = sqrt(-C_d);
		let x_1d: f32 = 2.0 * sqrt_neg_Cd * cos(Theta);
		let x_3d: f32 = 2.0 * sqrt_neg_Cd * cos(Theta + (2.0 / 3.0) * pi);
		let xs: f32 = select(x_3d, x_1d, x_1d + x_3d < 2.0 * C);
		xsc = vec2f(-D, xs + C);
	}
	let E: f32 =  xlc.y * xsc.y;
	let F: f32 = -xlc.x * xsc.y - xlc.y * xsc.x;
	let G: f32 =  xlc.x * xsc.x;
	let xmc: vec2f = vec2f(C * F - B * G, -B * F + C * E);
	var Root: vec3f = vec3f(xsc.x / xsc.y, xmc.x / xmc.y, xlc.x / xlc.y);
	if (Root.x < Root.y && Root.x < Root.z) {
		Root = Root.yxz;
	} else if (Root.z < Root.x && Root.z < Root.y) {
		Root = Root.xzy;
	}
	return Root;
}
fn LTC_EvaluateDisk(N: vec3f, V: vec3f, P: vec3f, Minv: mat3x3f, points: Coords) -> f32 {
	let T1: vec3f = normalize(V - N * dot(V, N));
	let T2: vec3f = cross(N, T1);
	let R: mat3x3f = transpose( mat3x3f( T1, T2, N ) );
	var L_: array<vec3f, 3>;
	L_[0] = R * ( points.coord0 - P );
	L_[1] = R * ( points.coord1 - P );
	L_[2] = R * ( points.coord2 - P );
	let C: vec3f  = 0.5 * (L_[0] + L_[2]);
	var V1: vec3f = 0.5 * (L_[1] - L_[2]);
	var V2: vec3f = 0.5 * (L_[1] - L_[0]);
	let C_Minv: vec3f  = Minv * C;
	let V1_Minv: vec3f = Minv * V1;
	let V2_Minv: vec3f = Minv * V2;
	var a: f32;
	var b: f32;
	let d11: f32 = dot(V1_Minv, V1_Minv);
	let d22: f32 = dot(V2_Minv, V2_Minv);
	let d12: f32 = dot(V1_Minv, V2_Minv);
	if (abs(d12) / sqrt(d11 * d22) > 0.0001) {
		let tr: f32 = d11 + d22;
		let det_inner: f32 = -d12 * d12 + d11 * d22;
		let det: f32 = sqrt(det_inner);
		let u: f32 = 0.5 * sqrt(tr - 2.0 * det);
		let v: f32 = 0.5 * sqrt(tr + 2.0 * det);
		let e_max: f32 = (u + v) * (u + v);
		let e_min: f32 = (u - v) * (u - v);
		var V1_: vec3f;
		var V2_: vec3f;
		if (d11 > d22) {
			V1_ = d12 * V1_Minv + (e_max - d11) * V2_Minv;
			V2_ = d12 * V1_Minv + (e_min - d11) * V2_Minv;
		} else {
			V1_ = d12*V2_Minv + (e_max - d22)*V1_Minv;
			V2_ = d12*V2_Minv + (e_min - d22)*V1_Minv;
		}
		a = 1.0 / e_max;
		b = 1.0 / e_min;
		V1 = normalize(V1_);
		V2 = normalize(V2_);
	} else {
		a = 1.0 / dot(V1_Minv, V1_Minv);
		b = 1.0 / dot(V2_Minv, V2_Minv);
		V1 = V1_Minv * sqrt(a);
		V2 = V2_Minv * sqrt(b);
	}
	var V3: vec3f = normalize(cross(V1, V2));
	if (dot(C_Minv, V3) < 0.0) {
		V3 = V3 * -1.0;
	}
	let L: f32  = dot(V3, C_Minv);
	let x0: f32 = dot(V1, C_Minv) / L;
	let y0: f32 = dot(V2, C_Minv) / L;
	let E1: f32 = inverseSqrt(a);
	let E2: f32 = inverseSqrt(b);
	let a_scaled = a * L * L;
	let b_scaled = b * L * L;
	let c0: f32 = a_scaled * b_scaled;
	let c1: f32 = a_scaled * b_scaled * (1.0 + x0 * x0 + y0 * y0) - a_scaled - b_scaled;
	let c2: f32 = 1.0 - a_scaled * (1.0 + x0 * x0) - b_scaled * (1.0 + y0 * y0);
	let c3: f32 = 1.0;
	let roots: vec3f = SolveCubic(vec4f(c0, c1, c2, c3));
	let e1: f32 = roots.x;
	let e2: f32 = roots.y;
	let e3: f32 = roots.z;
	var avgDir: vec3f = vec3f(a_scaled * x0 / (a_scaled - e2), b_scaled * y0 / (b_scaled - e2), 1.0);
	let rotate: mat3x3f = mat3x3f(V1, V2, V3);
	avgDir = rotate * avgDir;
	avgDir = normalize(avgDir);
	let L1: f32 = sqrt(-e2 / e3);
	let L2: f32 = sqrt(-e2 / e1);
	let formFactor: f32 = max(0.0, L1 * L2 * inverseSqrt((1.0 + L1 * L1) * (1.0 + L2 * L2)));
	const LUT_SIZE_disk: f32 = 64.0;
	const LUT_SCALE_disk: f32 = ( LUT_SIZE_disk - 1.0 ) / LUT_SIZE_disk;
	const LUT_BIAS_disk: f32 = 0.5 / LUT_SIZE_disk;
	var uv: vec2f = vec2f(avgDir.z * 0.5 + 0.5, formFactor);
	uv = uv * LUT_SCALE_disk + LUT_BIAS_disk;
	let scale: f32 = textureSampleLevel(areaLightsLutTex2, areaLightsLutTex2Sampler, uv, 0.0).w;
	return formFactor * scale;
}
fn FixNan(value: f32) -> f32 {
	return select(value, 0.0, value != value);
}
fn getRectLightDiffuse(worldNormal: vec3f, viewDir: vec3f, lightDir: vec3f, lightDirNorm: vec3f) -> f32 {
	let identityMat = mat3x3f(vec3f(1.0, 0.0, 0.0), vec3f(0.0, 1.0, 0.0), vec3f(0.0, 0.0, 1.0));
	return LTC_EvaluateRect( worldNormal, viewDir, vPositionW, identityMat, dLTCCoords );
}
fn getDiskLightDiffuse(worldNormal: vec3f, viewDir: vec3f, lightDir: vec3f, lightDirNorm: vec3f) -> f32 {
	let identityMat = mat3x3f(vec3f(1.0, 0.0, 0.0), vec3f(0.0, 1.0, 0.0), vec3f(0.0, 0.0, 1.0));
	return FixNan(LTC_EvaluateDisk( worldNormal, viewDir, vPositionW, identityMat, dLTCCoords ));
}
fn getSphereLightDiffuse(worldNormal: vec3f, viewDir: vec3f, lightDir: vec3f, lightDirNorm: vec3f) -> f32 {
	let falloff: f32 = dSphereRadius / (dot(lightDir, lightDir) + dSphereRadius);
	return FixNan(getLightDiffuse(worldNormal, viewDir, lightDirNorm) * falloff);
}
fn getLTCLightInvMat(uv: vec2f) -> mat3x3f {
	let t1: vec4f = textureSampleLevel(areaLightsLutTex1, areaLightsLutTex1Sampler, uv, 0.0);
	return mat3x3f(
		vec3f( t1.x, 0.0, t1.y ),
		vec3f( 0.0, 1.0, 0.0 ),
		vec3f( t1.z, 0.0, t1.w )
	);
}
fn calcRectLightSpecular(worldNormal: vec3f, viewDir: vec3f, uv: vec2f) -> f32 {
	let mInv: mat3x3f = getLTCLightInvMat(uv);
	return LTC_EvaluateRect( worldNormal, viewDir, vPositionW, mInv, dLTCCoords );
}
fn getRectLightSpecular(worldNormal: vec3f, viewDir: vec3f) -> f32 {
	return calcRectLightSpecular(worldNormal, viewDir, dLTCUV);
}
fn calcDiskLightSpecular(worldNormal: vec3f, viewDir: vec3f, uv: vec2f) -> f32 {
	let mInv: mat3x3f = getLTCLightInvMat(uv);
	return LTC_EvaluateDisk( worldNormal, viewDir, vPositionW, mInv, dLTCCoords );
}
fn getDiskLightSpecular(worldNormal: vec3f, viewDir: vec3f) -> f32 {
	return calcDiskLightSpecular(worldNormal, viewDir, dLTCUV);
}
fn getSphereLightSpecular(worldNormal: vec3f, viewDir: vec3f) -> f32 {
	return calcDiskLightSpecular(worldNormal, viewDir, dLTCUV);
}
`,Rbe=`
#ifdef STD_METALNESS_CONSTANT
uniform material_metalness: f32;
#endif
fn getMetalness() {
	var metalness: f32 = 1.0;
	#ifdef STD_METALNESS_CONSTANT
		metalness = metalness * uniform.material_metalness;
	#endif
	#ifdef STD_METALNESS_TEXTURE
		metalness = metalness * textureSampleBias({STD_METALNESS_TEXTURE_NAME}, {STD_METALNESS_TEXTURE_NAME}Sampler, {STD_METALNESS_TEXTURE_UV}, uniform.textureBias).{STD_METALNESS_TEXTURE_CHANNEL};
	#endif
	#ifdef STD_METALNESS_VERTEX
	metalness = metalness * saturate(vVertexColor.{STD_METALNESS_VERTEX_CHANNEL});
	#endif
	dMetalness = metalness;
}
`,Dbe=`
var texture_msdfMap: texture_2d<f32>;
var texture_msdfMapSampler: sampler;
fn median(r: f32, g: f32, b: f32) -> f32 {
	return max(min(r, g), min(max(r, g), b));
}
fn map(min: f32, max: f32, v: f32) -> f32 {
	return (v - min) / (max - min);
}
uniform font_sdfIntensity: f32;
uniform font_pxrange: f32;
uniform font_textureWidth: f32;
#ifndef LIT_MSDF_TEXT_ATTRIBUTE
	uniform outline_color: vec4f;
	uniform outline_thickness: f32;
	uniform shadow_color: vec4f;
	uniform shadow_offset: vec2f;
#else
	varying outline_color: vec4f;
	varying outline_thickness: f32;
	varying shadow_color: vec4f;
	varying shadow_offset: vec2f;
#endif
fn applyMsdf(color_in: vec4f) -> vec4f {
	#ifndef LIT_MSDF_TEXT_ATTRIBUTE
		var outline_colorValue = uniform.outline_color;
		var outline_thicknessValue = uniform.outline_thickness;
		var shadow_colorValue = uniform.shadow_color;
		var shadow_offsetValue = uniform.shadow_offset;
	#else
		var outline_colorValue = outline_color;
		var outline_thicknessValue = outline_thickness;
		var shadow_colorValue = shadow_color;
		var shadow_offsetValue = shadow_offset;
	#endif
	var color = vec4f(gammaCorrectInputVec3(color_in.rgb), color_in.a);
	let tsample: vec3f = textureSample(texture_msdfMap, texture_msdfMapSampler, vUv0).rgb;
	let uvShdw: vec2f = vUv0 - shadow_offsetValue;
	let ssample: vec3f = textureSample(texture_msdfMap, texture_msdfMapSampler, uvShdw).rgb;
	let sigDist: f32 = median(tsample.r, tsample.g, tsample.b);
	var sigDistShdw: f32 = median(ssample.r, ssample.g, ssample.b);
	let smoothingMax: f32 = 0.2;
	let w: vec2f = abs(dpdx(vUv0)) + abs(dpdy(vUv0));
	let smoothing: f32 = clamp(w.x * uniform.font_textureWidth / uniform.font_pxrange, 0.0, smoothingMax);
	let mapMin: f32 = 0.05;
	let mapMax: f32 = clamp(1.0 - uniform.font_sdfIntensity, mapMin, 1.0);
	let sigDistInner: f32 = map(mapMin, mapMax, sigDist);
	let sigDistOutline: f32 = map(mapMin, mapMax, sigDist + outline_thicknessValue);
	sigDistShdw = map(mapMin, mapMax, sigDistShdw + outline_thicknessValue);
	let center: f32 = 0.5;
	let inside: f32 = smoothstep(center - smoothing, center + smoothing, sigDistInner);
	let outline: f32 = smoothstep(center - smoothing, center + smoothing, sigDistOutline);
	let shadow: f32 = smoothstep(center - smoothing, center + smoothing, sigDistShdw);
	let tcolor_outline: vec4f = outline * vec4f(outline_colorValue.a * outline_colorValue.rgb, outline_colorValue.a);
	var tcolor: vec4f = select(vec4f(0.0), tcolor_outline, outline > inside);
	tcolor = mix(tcolor, color, inside);
	let scolor_shadow: vec4f = shadow * vec4f(shadow_colorValue.a * shadow_colorValue.rgb, shadow_colorValue.a);
	let scolor: vec4f = select(tcolor, scolor_shadow, shadow > outline);
	tcolor = mix(scolor, tcolor, outline);
	tcolor = vec4f(gammaCorrectOutput(tcolor.rgb), tcolor.a);
	return tcolor;
}
`,Lbe=`
fn getSpecularModulate(specularity: vec3f, albedo: vec3f, metalness: f32, f0: f32) -> vec3f {
	let dielectricF0: vec3f = f0 * specularity;
	return mix(dielectricF0, albedo, metalness);
}
fn getAlbedoModulate(albedo: vec3f, metalness: f32) -> vec3f {
	return albedo * (1.0 - metalness);
}
`,Obe=`
	varying uv0: vec2f;
	var morphTexture: texture_2d_array<f32>;
	var morphTextureSampler : sampler;
	uniform morphFactor: array<f32, {MORPH_TEXTURE_MAX_COUNT}>;
	uniform morphIndex: array<u32, {MORPH_TEXTURE_MAX_COUNT}>;
	uniform count: u32;
	@fragment
	fn fragmentMain(input : FragmentInput) -> FragmentOutput {
		var color = vec3f(0, 0, 0);
		for (var i: u32 = 0; i < uniform.count; i = i + 1) {
			var textureIndex: u32 = uniform.morphIndex[i].element;
			var delta = textureSample(morphTexture, morphTextureSampler, input.uv0, textureIndex).xyz;
			color += uniform.morphFactor[i].element * delta;
		}
		var output: FragmentOutput;
		output.color = vec4f(color, 1.0);
		return output;
	}
`,Nbe=`
	attribute vertex_position: vec2f;
	varying uv0: vec2f;
	@vertex
	fn vertexMain(input: VertexInput) -> VertexOutput {
		var output: VertexOutput;
		output.position = vec4f(input.vertex_position, 0.5, 1.0);
		output.uv0 = input.vertex_position * 0.5 + vec2f(0.5, 0.5);
		return output;
	}
`,kbe=`
attribute vertex_outlineParameters: vec3f;
attribute vertex_shadowParameters: vec3f;
varying outline_color: vec4f;
varying outline_thickness: f32;
varying shadow_color: vec4f;
varying shadow_offset: vec2f;
var<private> dOutlineColor: vec4f;
var<private> dOutlineThickness: f32;
var<private> dShadowColor: vec4f;
var<private> dShadowOffset: vec2f;
fn unpackMsdfParams() {
	let little: vec3f = vertex_outlineParameters % vec3f(256.0);
	let big: vec3f = (vertex_outlineParameters - little) / 256.0;
	dOutlineColor = vec4f(little.x, big.x, little.y, big.y) / 255.0;
	dOutlineThickness = little.z / 255.0 * 0.2;
	let little_shadow = vertex_shadowParameters % vec3f(256.0);
	let big_shadow = (vertex_shadowParameters - little_shadow) / 256.0;
	dShadowColor = vec4f(little_shadow.x, big_shadow.x, little_shadow.y, big_shadow.y) / 255.0;
	dShadowOffset = (vec2f(little_shadow.z, big_shadow.z) / 127.0 - 1.0) * 0.005;
}
`,Fbe=`
var<private> dNormalMatrix: mat3x3f;
fn getNormal() -> vec3f {
	dNormalMatrix = getNormalMatrix(dModelMatrix);
	let localNormal: vec3f = getLocalNormal(vertex_normal);
	return normalize(dNormalMatrix * localNormal);
}`,Bbe=`
attribute vertex_normal: vec3f;
uniform matrix_normal: mat3x3f;
#ifdef MORPHING_NORMAL
	#ifdef MORPHING_INT
		var morphNormalTex: texture_2d<u32>;
		var morphNormalTexSampler: sampler;
	#else
		var morphNormalTex: texture_2d<f32>;
		var morphNormalTexSampler: sampler;
	#endif
#endif
fn getLocalNormal(vertexNormal: vec3f) -> vec3f {
	var localNormal: vec3f = vertexNormal;
	#ifdef MORPHING_NORMAL
		let morphUV: vec2i = getTextureMorphCoords();
		#ifdef MORPHING_INT
			let morphNormalInt: vec4u = textureLoad(morphNormalTex, morphUV, 0);
			let morphNormalF: vec3f = vec3f(morphNormalInt.xyz) / 65535.0 * 2.0 - 1.0;
			localNormal = localNormal + morphNormalF;
		#else
			let morphNormal: vec3f = textureLoad(morphNormalTex, morphUV, 0).xyz;
			localNormal = localNormal + morphNormal;
		#endif
	#endif
	return localNormal;
}
#if defined(SKIN) || defined(BATCH)
	fn getNormalMatrix(modelMatrix: mat4x4f) -> mat3x3f {
		return mat3x3f(modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz);
	}
#elif defined(INSTANCING)
	fn getNormalMatrix(modelMatrix: mat4x4f) -> mat3x3f {
		return mat3x3f(modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz);
	}
#else
	fn getNormalMatrix(modelMatrix: mat4x4f) -> mat3x3f {
		return uniform.matrix_normal;
	}
#endif
`,Ube=`
#ifdef STD_NORMAL_TEXTURE
	uniform material_bumpiness: f32;
#endif
#ifdef STD_NORMALDETAIL_TEXTURE
	uniform material_normalDetailMapBumpiness: f32;
	fn blendNormals(inN1: vec3f, inN2: vec3f) -> vec3f {
		let n1: vec3f = inN1 + vec3f(0.0, 0.0, 1.0);
		let n2: vec3f = inN2 * vec3f(-1.0, -1.0, 1.0);
		return n1 * dot(n1, n2) / n1.z - n2;
	}
#endif
fn getNormal() {
#ifdef STD_NORMAL_TEXTURE
	var normalMap: vec3f = {STD_NORMAL_TEXTURE_DECODE}(textureSampleBias({STD_NORMAL_TEXTURE_NAME}, {STD_NORMAL_TEXTURE_NAME}Sampler, {STD_NORMAL_TEXTURE_UV}, uniform.textureBias));
	normalMap = mix(vec3f(0.0, 0.0, 1.0), normalMap, uniform.material_bumpiness);
	#ifdef STD_NORMALDETAIL_TEXTURE
		var normalDetailMap: vec3f = {STD_NORMALDETAIL_TEXTURE_DECODE}(textureSampleBias({STD_NORMALDETAIL_TEXTURE_NAME}, {STD_NORMALDETAIL_TEXTURE_NAME}Sampler, {STD_NORMALDETAIL_TEXTURE_UV}, uniform.textureBias));
		normalDetailMap = mix(vec3f(0.0, 0.0, 1.0), normalDetailMap, uniform.material_normalDetailMapBumpiness);
		normalMap = blendNormals(normalMap, normalDetailMap);
	#endif
	dNormalW = normalize(dTBN * normalMap);
#else
	dNormalW = dVertexNormalW;
#endif
}
`,zbe=`
uniform material_opacity: f32;
fn getOpacity() {
	dAlpha = uniform.material_opacity;
	#ifdef STD_OPACITY_TEXTURE
	dAlpha = dAlpha * textureSampleBias({STD_OPACITY_TEXTURE_NAME}, {STD_OPACITY_TEXTURE_NAME}Sampler, {STD_OPACITY_TEXTURE_UV}, uniform.textureBias).{STD_OPACITY_TEXTURE_CHANNEL};
	#endif
	#ifdef STD_OPACITY_VERTEX
	dAlpha = dAlpha * clamp(vVertexColor.{STD_OPACITY_VERTEX_CHANNEL}, 0.0, 1.0);
	#endif
}
`,Vbe=`
#if STD_OPACITY_DITHER == BAYER8
	#include "bayerPS"
#endif
uniform blueNoiseJitter: vec4f;
#if STD_OPACITY_DITHER == BLUENOISE
	var blueNoiseTex32 : texture_2d<f32>;
	var blueNoiseTex32Sampler : sampler;
#endif
fn opacityDither(alpha: f32, id: f32) {
	#if STD_OPACITY_DITHER == BAYER8
		var noise: f32 = bayer8(floor((pcPosition.xy + uniform.blueNoiseJitter.xy + id) % vec2f(8.0))) / 64.0;
	#else
		#if STD_OPACITY_DITHER == BLUENOISE
			var uv = fract(pcPosition.xy / 32.0 + uniform.blueNoiseJitter.xy + id);
			var noise: f32 = textureSampleLevel(blueNoiseTex32, blueNoiseTex32Sampler, uv, 0.0).y;
		#endif
		#if STD_OPACITY_DITHER == IGNNOISE
			var magic = vec3f(0.06711056, 0.00583715, 52.9829189);
			var noise: f32 = fract(magic.z * fract(dot(pcPosition.xy + uniform.blueNoiseJitter.xy + id, magic.xy)));
		#endif
	#endif
	noise = pow(noise, 2.2);
	if (alpha < noise) {
		discard;
	}
}
`,jbe=`
`,$be=`
#if LIT_BLEND_TYPE == NORMAL || LIT_BLEND_TYPE == ADDITIVEALPHA || defined(LIT_ALPHA_TO_COVERAGE)
	output.color = vec4f(output.color.rgb, litArgs_opacity);
#elif LIT_BLEND_TYPE == PREMULTIPLIED
	output.color = vec4f(output.color.rgb * litArgs_opacity, litArgs_opacity);
#else
	output.color = vec4f(output.color.rgb, 1.0);
#endif
`,Hbe=`
varying vUv0: vec2f;
var source: texture_2d<f32>;
var sourceSampler: sampler;
@fragment fn fragmentMain(input : FragmentInput) -> FragmentOutput {
	var output: FragmentOutput;
	output.color = textureSample(source, sourceSampler, input.vUv0);
	return output;
}
`,Gbe=`
uniform material_sheen: vec3f;
fn getSheen() {
	var sheenColor = uniform.material_sheen;
	#ifdef STD_SHEEN_TEXTURE
	sheenColor = sheenColor * {STD_SHEEN_TEXTURE_DECODE}(textureSampleBias({STD_SHEEN_TEXTURE_NAME}, {STD_SHEEN_TEXTURE_NAME}Sampler, {STD_SHEEN_TEXTURE_UV}, uniform.textureBias)).{STD_SHEEN_TEXTURE_CHANNEL};
	#endif
	#ifdef STD_SHEEN_VERTEX
	sheenColor = sheenColor * saturate3(vVertexColor.{STD_SHEEN_VERTEX_CHANNEL});
	#endif
	sSpecularity = sheenColor;
}
`,Wbe=`
uniform material_sheenGloss: f32;
fn getSheenGlossiness() {
	var sheenGlossiness = uniform.material_sheenGloss;
	#ifdef STD_SHEENGLOSS_TEXTURE
	sheenGlossiness = sheenGlossiness * textureSampleBias({STD_SHEENGLOSS_TEXTURE_NAME}, {STD_SHEENGLOSS_TEXTURE_NAME}Sampler, {STD_SHEENGLOSS_TEXTURE_UV}, uniform.textureBias).{STD_SHEENGLOSS_TEXTURE_CHANNEL};
	#endif
	#ifdef STD_SHEENGLOSS_VERTEX
	sheenGlossiness = sheenGlossiness * saturate(vVertexColor.{STD_SHEENGLOSS_VERTEX_CHANNEL});
	#endif
	#ifdef STD_SHEENGLOSS_INVERT
	sheenGlossiness = 1.0 - sheenGlossiness;
	#endif
	sGlossiness = sheenGlossiness + 0.0000001;
}
`,Xbe=`
uniform material_heightMapFactor: f32;
fn getParallax() {
	var parallaxScale = uniform.material_heightMapFactor;
	var height: f32 = textureSampleBias({STD_HEIGHT_TEXTURE_NAME}, {STD_HEIGHT_TEXTURE_NAME}Sampler, {STD_HEIGHT_TEXTURE_UV}, uniform.textureBias).{STD_HEIGHT_TEXTURE_CHANNEL};
	height = height * parallaxScale - parallaxScale * 0.5;
	var viewDirT: vec3f = dViewDirW * dTBN;
	viewDirT.z = viewDirT.z + 0.42;
	dUvOffset = height * (viewDirT.xy / viewDirT.z);
}
`,qbe=`
uniform meshInstanceId: u32;
fn getPickOutput() -> vec4f {
	let inv: vec4f = vec4f(1.0 / 255.0);
	let shifts: vec4u = vec4u(16u, 8u, 0u, 24u);
	let col: vec4u = (vec4u(uniform.meshInstanceId) >> shifts) & vec4u(0xffu);
	return vec4f(col) * inv;
}`,Ybe=`
fn getReflDir(worldNormal: vec3f, viewDir: vec3f, gloss: f32, tbn: mat3x3f) {
	dReflDirW = normalize(-reflect(viewDir, worldNormal));
}
`,Kbe=`
fn getReflDir(worldNormal: vec3f, viewDir: vec3f, gloss: f32, tbn: mat3x3f) {
	let roughness: f32 = sqrt(1.0 - min(gloss, 1.0));
	let direction: vec2f = dAnisotropyRotation;
	let anisotropicT: vec3f = normalize(tbn * vec3f(direction, 0.0));
	let anisotropicB: vec3f = normalize(cross(tbn[2], anisotropicT));
	let anisotropy: f32 = dAnisotropy;
	let anisotropicDirection: vec3f = anisotropicB;
	let anisotropicTangent: vec3f = cross(anisotropicDirection, viewDir);
	let anisotropicNormal: vec3f = cross(anisotropicTangent, anisotropicDirection);
	let bendFactor: f32 = 1.0 - anisotropy * (1.0 - roughness);
	let bendFactor4: f32 = bendFactor * bendFactor * bendFactor * bendFactor;
	let bentNormal: vec3f = normalize(mix(normalize(anisotropicNormal), normalize(worldNormal), bendFactor4));
	dReflDirW = reflect(-viewDir, bentNormal);
}`,Zbe=`
#ifdef LIT_CLEARCOAT
fn addReflectionCC(reflDir: vec3f, gloss: f32) {
	ccReflection = ccReflection + calcReflection(reflDir, gloss);
}
#endif
`,Qbe=`
var texture_cubeMap: texture_cube<f32>;
var texture_cubeMapSampler: sampler;
uniform material_reflectivity: f32;
fn calcReflection(reflDir: vec3f, gloss: f32) -> vec3f {
	var lookupVec: vec3f = cubeMapProject(reflDir);
	lookupVec.x = lookupVec.x * -1.0;
	return {reflectionDecode}(textureSample(texture_cubeMap, texture_cubeMapSampler, lookupVec));
}
fn addReflection(reflDir: vec3f, gloss: f32) {
	dReflection = dReflection + vec4f(calcReflection(reflDir, gloss), uniform.material_reflectivity);
}
`,Jbe=`
#ifndef ENV_ATLAS
	#define ENV_ATLAS
	var texture_envAtlas: texture_2d<f32>;
	var texture_envAtlasSampler: sampler;
#endif
var texture_cubeMap: texture_cube<f32>;
var texture_cubeMapSampler: sampler;
uniform material_reflectivity: f32;
fn calcReflection(reflDir: vec3f, gloss: f32) -> vec3f {
	let dir: vec3f = cubeMapProject(reflDir) * vec3f(-1.0, 1.0, 1.0);
	let uv: vec2f = toSphericalUv(dir);
	let level: f32 = saturate(1.0 - gloss) * 5.0;
	let ilevel: f32 = floor(level);
	let flevel: f32 = level - ilevel;
	let sharp: vec3f = {reflectionCubemapDecode}(textureSample(texture_cubeMap, texture_cubeMapSampler, dir));
	let roughA: vec3f = {reflectionDecode}(textureSample(texture_envAtlas, texture_envAtlasSampler, mapRoughnessUv(uv, ilevel)));
	let roughB: vec3f = {reflectionDecode}(textureSample(texture_envAtlas, texture_envAtlasSampler, mapRoughnessUv(uv, ilevel + 1.0)));
	return processEnvironment(mix(sharp, mix(roughA, roughB, flevel), min(level, 1.0)));
}
fn addReflection(reflDir: vec3f, gloss: f32) {
	dReflection = dReflection + vec4f(calcReflection(reflDir, gloss), uniform.material_reflectivity);
}
`,ewe=`
#ifndef ENV_ATLAS
#define ENV_ATLAS
	var texture_envAtlas: texture_2d<f32>;
	var texture_envAtlasSampler: sampler;
#endif
uniform material_reflectivity: f32;
fn shinyMipLevel(uv: vec2f) -> f32 {
	let dx: vec2f = dpdx(uv);
	let dy: vec2f = dpdy(uv);
	let uv2: vec2f = vec2f(fract(uv.x + 0.5), uv.y);
	let dx2: vec2f = dpdx(uv2);
	let dy2: vec2f = dpdy(uv2);
	let maxd: f32 = min(max(dot(dx, dx), dot(dy, dy)), max(dot(dx2, dx2), dot(dy2, dy2)));
	return clamp(0.5 * log2(maxd) - 1.0 + uniform.textureBias, 0.0, 5.0);
}
fn calcReflection(reflDir: vec3f, gloss: f32) -> vec3f {
	let dir: vec3f = cubeMapProject(reflDir) * vec3f(-1.0, 1.0, 1.0);
	let uv: vec2f = toSphericalUv(dir);
	let level: f32 = saturate(1.0 - gloss) * 5.0;
	let ilevel: f32 = floor(level);
	let level2: f32 = shinyMipLevel(uv * atlasSize);
	let ilevel2: f32 = floor(level2);
	var uv0: vec2f;
	var uv1: vec2f;
	var weight: f32;
	if (ilevel == 0.0) {
		uv0 = mapShinyUv(uv, ilevel2);
		uv1 = mapShinyUv(uv, ilevel2 + 1.0);
		weight = level2 - ilevel2;
	} else {
		uv0 = mapRoughnessUv(uv, ilevel);
		uv1 = uv0;
		weight = 0.0;
	}
	let linearA: vec3f = {reflectionDecode}(textureSample(texture_envAtlas, texture_envAtlasSampler, uv0));
	let linearB: vec3f = {reflectionDecode}(textureSample(texture_envAtlas, texture_envAtlasSampler, uv1));
	let linear0: vec3f = mix(linearA, linearB, weight);
	let linear1: vec3f = {reflectionDecode}(textureSample(texture_envAtlas, texture_envAtlasSampler, mapRoughnessUv(uv, ilevel + 1.0)));
	return processEnvironment(mix(linear0, linear1, level - ilevel));
}
fn addReflection(reflDir: vec3f, gloss: f32) {
	dReflection = dReflection + vec4f(calcReflection(reflDir, gloss), uniform.material_reflectivity);
}
`,twe=`
#ifndef VIEWMATRIX
	#define VIEWMATRIX
	uniform matrix_view: mat4x4f;
#endif
var texture_sphereMap: texture_2d<f32>;
var texture_sphereMapSampler: sampler;
uniform material_reflectivity: f32;
fn calcReflection(reflDir: vec3f, gloss: f32) -> vec3f {
	let viewRotationMatrix = mat3x3f(uniform.matrix_view[0].xyz, uniform.matrix_view[1].xyz, uniform.matrix_view[2].xyz);
	let reflDirV: vec3f = viewRotationMatrix * reflDir;
	let m: f32 = 2.0 * sqrt(dot(reflDirV.xy, reflDirV.xy) + (reflDirV.z + 1.0) * (reflDirV.z + 1.0));
	let sphereMapUv: vec2f = reflDirV.xy / m + 0.5;
	return {reflectionDecode}(textureSample(texture_sphereMap, texture_sphereMapSampler, sphereMapUv));
}
fn addReflection(reflDir: vec3f, gloss: f32) {
	dReflection = dReflection + vec4f(calcReflection(reflDir, gloss), uniform.material_reflectivity);
}
`,iwe=`
fn addReflectionSheen(worldNormal: vec3f, viewDir: vec3f, gloss: f32) {
	let NoV: f32 = dot(worldNormal, viewDir);
	let alphaG: f32 = gloss * gloss;
	let a: f32 = select(
		-8.48 * alphaG + 14.3 * gloss - 9.95,
		-339.2 * alphaG + 161.4 * gloss - 25.9,
		gloss < 0.25
	);
	let b: f32 = select(
		1.97 * alphaG - 3.27 * gloss + 0.72,
		44.0 * alphaG - 23.7 * gloss + 3.26,
		gloss < 0.25
	);
	let dg_add: f32 = select(
		0.1 * ( gloss - 0.25 ),
		0.0,
		gloss < 0.25
	);
	let dg: f32 = exp( a * NoV + b ) + dg_add;
	sReflection = sReflection + (calcReflection(worldNormal, 0.0) * saturate(dg));
}`,rwe=`
fn refract2(viewVec: vec3f, normal: vec3f, IOR: f32) -> vec3f {
	let vn: f32 = dot(viewVec, normal);
	let k: f32 = 1.0 - IOR * IOR * (1.0 - vn * vn);
	let refrVec: vec3f = IOR * viewVec - (IOR * vn + sqrt(k)) * normal;
	return refrVec;
}
fn addRefraction(
	worldNormal: vec3f,
	viewDir: vec3f,
	thickness: f32,
	gloss: f32,
	specularity: vec3f,
	albedo: vec3f,
	transmission: f32,
	refractionIndex: f32,
	dispersion: f32
#if defined(LIT_IRIDESCENCE)
	, iridescenceFresnel: vec3f,
	iridescenceIntensity: f32
#endif
) {
	let tmpRefl: vec4f = dReflection;
	let reflectionDir: vec3f = refract2(-viewDir, worldNormal, refractionIndex);
	dReflection = vec4f(0.0);
	addReflection(reflectionDir, gloss);
	dDiffuseLight = mix(dDiffuseLight, dReflection.rgb * albedo, transmission);
	dReflection = tmpRefl;
}
`,swe=`
uniform material_invAttenuationDistance: f32;
uniform material_attenuation: vec3f;
fn evalRefractionColor(refractionVector: vec3f, gloss: f32, refractionIndex: f32) -> vec3f {
	let pointOfRefraction: vec4f = vec4f(vPositionW + refractionVector, 1.0);
	let projectionPoint: vec4f = uniform.matrix_viewProjection * pointOfRefraction;
	let uv: vec2f = getGrabScreenPos(projectionPoint);
	let iorToRoughness: f32 = (1.0 - gloss) * clamp((1.0 / refractionIndex) * 2.0 - 2.0, 0.0, 1.0);
	let refractionLod: f32 = log2(uniform.uScreenSize.x) * iorToRoughness;
	let refraction: vec3f = textureSampleLevel(uSceneColorMap, uSceneColorMapSampler, uv, refractionLod).rgb;
	return refraction;
}
fn addRefraction(
	worldNormal: vec3f,
	viewDir: vec3f,
	thickness: f32,
	gloss: f32,
	specularity: vec3f,
	albedo: vec3f,
	transmission: f32,
	refractionIndex: f32,
	dispersion: f32,
#if defined(LIT_IRIDESCENCE)
	iridescenceFresnel: vec3f,
	iridescenceIntensity: f32
#endif
) {
	var modelScale: vec3f;
	modelScale.x = length(uniform.matrix_model[0].xyz);
	modelScale.y = length(uniform.matrix_model[1].xyz);
	modelScale.z = length(uniform.matrix_model[2].xyz);
	let scale: vec3f = thickness * modelScale;
	var refractionVector = normalize(refract(-viewDir, worldNormal, refractionIndex)) * scale;
	var refraction = evalRefractionColor(refractionVector, gloss, refractionIndex);
	#ifdef LIT_DISPERSION
		let halfSpread: f32 = (1.0 / refractionIndex - 1.0) * 0.025 * dispersion;
		let refractionIndexR: f32 = refractionIndex - halfSpread;
		refractionVector = normalize(refract(-viewDir, worldNormal, refractionIndexR)) * scale;
		refraction.r = evalRefractionColor(refractionVector, gloss, refractionIndexR).r;
		let refractionIndexB: f32 = refractionIndex + halfSpread;
		refractionVector = normalize(refract(-viewDir, worldNormal, refractionIndexB)) * scale;
		refraction.b = evalRefractionColor(refractionVector, gloss, refractionIndexB).b;
	#endif
	var transmittance: vec3f;
	if (uniform.material_invAttenuationDistance != 0.0)
	{
		let attenuation: vec3f = -log(uniform.material_attenuation) * uniform.material_invAttenuationDistance;
		transmittance = exp(-attenuation * length(refractionVector));
	}
	else
	{
		transmittance = refraction;
	}
	let fresnel: vec3f = vec3f(1.0) -
		getFresnel(
			dot(viewDir, worldNormal),
			gloss,
			specularity
		#if defined(LIT_IRIDESCENCE)
			, iridescenceFresnel,
			iridescenceIntensity
		#endif
		);
	dDiffuseLight = mix(dDiffuseLight, refraction * transmittance * fresnel, transmission);
}
`,nwe=`
varying vUv0: vec2f;
#ifdef CUBEMAP_SOURCE
	var sourceCube: texture_cube<f32>;
	var sourceCubeSampler : sampler;
#else
	var sourceTex: texture_2d<f32>;
	var sourceTexSampler : sampler;
#endif
#ifdef USE_SAMPLES_TEX
	var samplesTex: texture_2d<f32>;
	var samplesTexSampler : sampler;
	uniform samplesTexInverseSize: vec2f;
#endif
uniform params: vec3f;
fn targetFace() -> f32 { return uniform.params.x; }
fn targetTotalPixels() -> f32 { return uniform.params.y; }
fn sourceTotalPixels() -> f32 { return uniform.params.z; }
const PI: f32 = 3.141592653589793;
fn saturate(x: f32) -> f32 {
	return clamp(x, 0.0, 1.0);
}
#include "decodePS"
#include "encodePS"
fn modifySeams(dir: vec3f, scale: f32) -> vec3f {
	let adir = abs(dir);
	let M = max(max(adir.x, adir.y), adir.z);
	return dir / M * vec3f(
		select(scale, 1.0, adir.x == M),
		select(scale, 1.0, adir.y == M),
		select(scale, 1.0, adir.z == M)
	);
}
fn toSpherical(dir: vec3f) -> vec2f {
	let nonZeroXZ = any(dir.xz != vec2f(0.0, 0.0));
	return vec2f(select(0.0, atan2(dir.x, dir.z), nonZeroXZ), asin(dir.y));
}
fn fromSpherical(uv: vec2f) -> vec3f {
	return vec3f(cos(uv.y) * sin(uv.x),
				sin(uv.y),
				cos(uv.y) * cos(uv.x));
}
fn getDirectionEquirect(uv: vec2f) -> vec3f {
	return fromSpherical((vec2f(uv.x, 1.0 - uv.y) * 2.0 - 1.0) * vec2f(PI, PI * 0.5));
}
fn signNotZero(k: f32) -> f32 {
	return select(-1.0, 1.0, k >= 0.0);
}
fn signNotZeroVec2(v: vec2f) -> vec2f {
	return vec2f(signNotZero(v.x), signNotZero(v.y));
}
fn octDecode(o: vec2f) -> vec3f {
	var v = vec3f(o.x, 1.0 - abs(o.x) - abs(o.y), o.y);
	if (v.y < 0.0) {
		var temp: vec2f = (1.0 - abs(v.zx)) * signNotZeroVec2(v.xz);
		v = vec3f(temp.x, v.y, temp.y);
	}
	return normalize(v);
}
fn getDirectionOctahedral(uv: vec2f) -> vec3f {
	return octDecode(vec2f(uv.x, 1.0 - uv.y) * 2.0 - 1.0);
}
fn octEncode(v: vec3f) -> vec2f {
	let l1norm = abs(v.x) + abs(v.y) + abs(v.z);
	var result = v.xz * (1.0 / l1norm);
	if (v.y < 0.0) {
		result = (1.0 - abs(result.yx)) * signNotZeroVec2(result.xy);
	}
	return result;
}
#ifdef CUBEMAP_SOURCE
	fn sampleCubemapDir(dir: vec3f) -> vec4f {
		return textureSample(sourceCube, sourceCubeSampler, modifySeams(dir, 1.0));
	}
	fn sampleCubemapSph(sph: vec2f) -> vec4f {
		return sampleCubemapDir(fromSpherical(sph));
	}
	fn sampleCubemapDirLod(dir: vec3f, mipLevel: f32) -> vec4f {
		return textureSampleLevel(sourceCube, sourceCubeSampler, modifySeams(dir, 1.0), mipLevel);
	}
	fn sampleCubemapSphLod(sph: vec2f, mipLevel: f32) -> vec4f {
		return sampleCubemapDirLod(fromSpherical(sph), mipLevel);
	}
#else
	fn sampleEquirectSph(sph: vec2f) -> vec4f {
		let uv = sph / vec2f(PI * 2.0, PI) + 0.5;
		return textureSample(sourceTex, sourceTexSampler, vec2f(uv.x, 1.0 - uv.y));
	}
	fn sampleEquirectDir(dir: vec3f) -> vec4f {
		return sampleEquirectSph(toSpherical(dir));
	}
	fn sampleEquirectSphLod(sph: vec2f, mipLevel: f32) -> vec4f {
		let uv = sph / vec2f(PI * 2.0, PI) + 0.5;
		return textureSampleLevel(sourceTex, sourceTexSampler, vec2f(uv.x, 1.0 - uv.y), mipLevel);
	}
	fn sampleEquirectDirLod(dir: vec3f, mipLevel: f32) -> vec4f {
		return sampleEquirectSphLod(toSpherical(dir), mipLevel);
	}
	fn sampleOctahedralDir(dir: vec3f) -> vec4f {
		let uv = octEncode(dir) * 0.5 + 0.5;
		return textureSample(sourceTex, sourceTexSampler, vec2f(uv.x, 1.0 - uv.y));
	}
	fn sampleOctahedralSph(sph: vec2f) -> vec4f {
		return sampleOctahedralDir(fromSpherical(sph));
	}
	fn sampleOctahedralDirLod(dir: vec3f, mipLevel: f32) -> vec4f {
		let uv = octEncode(dir) * 0.5 + 0.5;
		return textureSampleLevel(sourceTex, sourceTexSampler, vec2f(uv.x, 1.0 - uv.y), mipLevel);
	}
	fn sampleOctahedralSphLod(sph: vec2f, mipLevel: f32) -> vec4f {
		return sampleOctahedralDirLod(fromSpherical(sph), mipLevel);
	}
#endif
fn getDirectionCubemap(uv: vec2f) -> vec3f {
	let st = uv * 2.0 - 1.0;
	let face = targetFace();
	var vec: vec3f;
	if (face == 0.0) {
		vec = vec3f(1, -st.y, -st.x);
	} else if (face == 1.0) {
		vec = vec3f(-1, -st.y, st.x);
	} else if (face == 2.0) {
		vec = vec3f(st.x, 1, st.y);
	} else if (face == 3.0) {
		vec = vec3f(st.x, -1, -st.y);
	} else if (face == 4.0) {
		vec = vec3f(st.x, -st.y, 1);
	} else {
		vec = vec3f(-st.x, -st.y, -1);
	}
	return normalize(modifySeams(vec, 1.0));
}
fn matrixFromVector(n: vec3f) -> mat3x3f {
	let a = 1.0 / (1.0 + n.z);
	let b = -n.x * n.y * a;
	let b1 = vec3f(1.0 - n.x * n.x * a, b, -n.x);
	let b2 = vec3f(b, 1.0 - n.y * n.y * a, -n.y);
	return mat3x3f(b1, b2, n);
}
fn matrixFromVectorSlow(n: vec3f) -> mat3x3f {
	let up = select(vec3f(0.0, 0.0, select(-1.0, 1.0, n.y > 0.0)), vec3f(0.0, 1.0, 0.0), abs(n.y) > 0.0000001);
	let x = normalize(cross(up, n));
	let y = cross(n, x);
	return mat3x3f(x, y, n);
}
fn reproject(uv: vec2f) -> vec4f {
	if ({NUM_SAMPLES} <= 1) {
		return {ENCODE_FUNC}({DECODE_FUNC}({SOURCE_FUNC}Dir({TARGET_FUNC}(uv))));
	} else {
		let t = {TARGET_FUNC}(uv);
		let tu = dpdx(t);
		let tv = dpdy(t);
		var result = vec3f(0.0);
		for (var u = 0.0; u < {NUM_SAMPLES_SQRT}; u += 1.0) {
			for (var v = 0.0; v < {NUM_SAMPLES_SQRT}; v += 1.0) {
				result += {DECODE_FUNC}({SOURCE_FUNC}Dir(normalize(t +
															tu * (u / {NUM_SAMPLES_SQRT} - 0.5) +
															tv * (v / {NUM_SAMPLES_SQRT} - 0.5))));
			}
		}
		return {ENCODE_FUNC}(result / ({NUM_SAMPLES_SQRT} * {NUM_SAMPLES_SQRT}));
	}
}
const unpackFloat: vec4f = vec4f(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0);
#ifdef USE_SAMPLES_TEX
	fn unpackSample(i: i32, L: ptr<function, vec3f>, mipLevel: ptr<function, f32>) {
		var u = (f32(i * 4) + 0.5) * uniform.samplesTexInverseSize.x;
		var v = (floor(u) + 0.5) * uniform.samplesTexInverseSize.y;
		var raw: vec4f;
		raw.x = dot(textureSample(samplesTex, samplesTexSampler, vec2f(u, v)), unpackFloat); u += uniform.samplesTexInverseSize.x;
		raw.y = dot(textureSample(samplesTex, samplesTexSampler, vec2f(u, v)), unpackFloat); u += uniform.samplesTexInverseSize.x;
		raw.z = dot(textureSample(samplesTex, samplesTexSampler, vec2f(u, v)), unpackFloat); u += uniform.samplesTexInverseSize.x;
		raw.w = dot(textureSample(samplesTex, samplesTexSampler, vec2f(u, v)), unpackFloat);
		*L = raw.xyz * 2.0 - 1.0;
		*mipLevel = raw.w * 8.0;
	}
	fn prefilterSamples(uv: vec2f) -> vec4f {
		let vecSpace = matrixFromVectorSlow({TARGET_FUNC}(uv));
		var L: vec3f;
		var mipLevel: f32;
		var result = vec3f(0.0);
		var totalWeight = 0.0;
		for (var i = 0; i < {NUM_SAMPLES}; i += 1) {
			unpackSample(i, &L, &mipLevel);
			result += {DECODE_FUNC}({SOURCE_FUNC}DirLod(vecSpace * L, mipLevel)) * L.z;
			totalWeight += L.z;
		}
		return {ENCODE_FUNC}(result / totalWeight);
	}
	fn prefilterSamplesUnweighted(uv: vec2f) -> vec4f {
		let vecSpace = matrixFromVectorSlow({TARGET_FUNC}(uv));
		var L: vec3f;
		var mipLevel: f32;
		var result = vec3f(0.0);
		for (var i = 0; i < {NUM_SAMPLES}; i += 1) {
			unpackSample(i, &L, &mipLevel);
			result += {DECODE_FUNC}({SOURCE_FUNC}DirLod(vecSpace * L, mipLevel));
		}
		return {ENCODE_FUNC}(result / f32({NUM_SAMPLES}));
	}
#endif
@fragment
fn fragmentMain(input : FragmentInput) -> FragmentOutput {
	var output: FragmentOutput;
	output.color = {PROCESS_FUNC}(input.vUv0);
	return output;
}
`,awe=`
attribute vertex_position: vec2f;
uniform uvMod: vec4f;
varying vUv0: vec2f;
@vertex
fn vertexMain(input: VertexInput) -> VertexOutput {
	var output: VertexOutput;
	output.position = vec4f(input.vertex_position, 0.5, 1.0);
	output.vUv0 = getImageEffectUV((input.vertex_position * 0.5 + vec2f(0.5, 0.5)) * uniform.uvMod.xy + uniform.uvMod.zw);
	return output;
}
`,owe=`
var uSceneDepthMap: texture_2d<f32>;
var uSceneDepthMapSampler: sampler;
#ifndef SCREENSIZE
	#define SCREENSIZE
	uniform uScreenSize: vec4f;
#endif
#ifndef VIEWMATRIX
	#define VIEWMATRIX
	uniform matrix_view: mat4x4f;
#endif
#ifndef LINEARIZE_DEPTH
	#define LINEARIZE_DEPTH
	#ifndef CAMERAPLANES
		#define CAMERAPLANES
		uniform camera_params: vec4f;
	#endif
	fn linearizeDepth(z: f32) -> f32 {
		if (uniform.camera_params.w == 0.0) {
			return (uniform.camera_params.z * uniform.camera_params.y) / (uniform.camera_params.y + z * (uniform.camera_params.z - uniform.camera_params.y));
		} else {
			return uniform.camera_params.z + z * (uniform.camera_params.y - uniform.camera_params.z);
		}
	}
#endif
fn delinearizeDepth(linearDepth: f32) -> f32 {
	if (uniform.camera_params.w == 0.0) {
		return (uniform.camera_params.y * (uniform.camera_params.z - linearDepth)) / (linearDepth * (uniform.camera_params.z - uniform.camera_params.y));
	} else {
		return (linearDepth - uniform.camera_params.z) / (uniform.camera_params.y - uniform.camera_params.z);
	}
}
fn getLinearScreenDepth(uv: vec2f) -> f32 {
	#ifdef SCENE_DEPTHMAP_LINEAR
		#ifdef SCENE_DEPTHMAP_FLOAT
			return textureSample(uSceneDepthMap, uSceneDepthMapSampler, uv).r;
		#else
			let textureSize = textureDimensions(uSceneDepthMap, 0);
			let texel: vec2i = vec2i(uv * vec2f(textureSize));
			let data: vec4f = textureLoad(uSceneDepthMap, texel, 0);
			let data_u32: vec4u = vec4u(data * 255.0);
			let intBits: u32 = (data_u32.r << 24u) | (data_u32.g << 16u) | (data_u32.b << 8u) | data_u32.a;
			return bitcast<f32>(intBits);
		#endif
	#else
		return linearizeDepth(textureSample(uSceneDepthMap, uSceneDepthMapSampler, uv).r);
	#endif
}
#ifndef VERTEXSHADER
	fn getLinearScreenDepthFrag() -> f32 {
		let uv: vec2f = pcPosition.xy * uniform.uScreenSize.zw;
		return getLinearScreenDepth(uv);
	}
#endif
fn getLinearDepth(pos: vec3f) -> f32 {
	return -(uniform.matrix_view * vec4f(pos, 1.0)).z;
}
`,lwe=`
fn getShadowCascadeIndex(shadowCascadeDistances: vec4f, shadowCascadeCount: i32) -> i32 {
	let depth: f32 = 1.0 / pcPosition.w;
	let comparisons: vec4f = step(shadowCascadeDistances, vec4f(depth));
	let cascadeIndex: i32 = i32(dot(comparisons, vec4f(1.0)));
	return min(cascadeIndex, shadowCascadeCount - 1);
}
fn ditherShadowCascadeIndex(cascadeIndex_in: i32, shadowCascadeDistances: vec4f, shadowCascadeCount: i32, blendFactor: f32) -> i32 {
	var cascadeIndex: i32 = cascadeIndex_in;
	if (cascadeIndex < shadowCascadeCount - 1) {
		let currentRangeEnd: f32 = shadowCascadeDistances[cascadeIndex];
		let transitionStart: f32 = blendFactor * currentRangeEnd;
		let depth: f32 = 1.0 / pcPosition.w;
		if (depth > transitionStart) {
			let transitionFactor: f32 = smoothstep(transitionStart, currentRangeEnd, depth);
			let dither: f32 = fract(sin(dot(pcPosition.xy, vec2f(12.9898, 78.233))) * 43758.5453);
			if (dither < transitionFactor) {
				cascadeIndex = cascadeIndex + 1;
			}
		}
	}
	return cascadeIndex;
}
fn fadeShadow(shadowCoord_in: vec3f, shadowCascadeDistances: vec4f) -> vec3f {
	var shadowCoord: vec3f = shadowCoord_in;
	let depth: f32 = 1.0 / pcPosition.w;
	if (depth > shadowCascadeDistances.w) {
		shadowCoord.z = -9999999.0;
	}
	return shadowCoord;
}
`,cwe=`
fn linstep(a: f32, b: f32, v: f32) -> f32 {
	return clamp((v - a) / (b - a), 0.0, 1.0);
}
fn reduceLightBleeding(pMax: f32, amount: f32) -> f32 {
	 return linstep(amount, 1.0, pMax);
}
fn chebyshevUpperBound(moments: vec2f, mean: f32, minVariance: f32, lightBleedingReduction: f32) -> f32 {
	var variance: f32 = moments.y - (moments.x * moments.x);
	variance = max(variance, minVariance);
	let d: f32 = mean - moments.x;
	var pMax: f32 = variance / (variance + (d * d));
	pMax = reduceLightBleeding(pMax, lightBleedingReduction);
	return select(pMax, 1.0, mean <= moments.x);
}
fn calculateEVSM(moments_in: vec3f, Z_in: f32, vsmBias: f32, exponent: f32) -> f32 {
	let Z: f32 = 2.0 * Z_in - 1.0;
	let warpedDepth: f32 = exp(exponent * Z);
	let moments: vec2f = moments_in.xy + vec2f(warpedDepth, warpedDepth*warpedDepth) * (1.0 - moments_in.z);
	let VSMBias: f32 = vsmBias;
	let depthScale: f32 = VSMBias * exponent * warpedDepth;
	let minVariance1: f32 = depthScale * depthScale;
	return chebyshevUpperBound(moments, warpedDepth, minVariance1, 0.1);
}
fn VSM16(tex: texture_2d<f32>, texSampler: sampler, texCoords: vec2f, resolution: f32, Z: f32, vsmBias: f32, exponent: f32) -> f32 {
	let moments: vec3f = textureSampleLevel(tex, texSampler, texCoords, 0.0).xyz;
	return calculateEVSM(moments, Z, vsmBias, exponent);
}
fn getShadowVSM16(shadowMap: texture_2d<f32>, shadowMapSampler: sampler, shadowCoord: vec3f, shadowParams: vec4f, exponent: f32) -> f32 {
	return VSM16(shadowMap, shadowMapSampler, shadowCoord.xy, shadowParams.x, shadowCoord.z, shadowParams.y, exponent);
}
fn getShadowSpotVSM16(shadowMap: texture_2d<f32>, shadowMapSampler: sampler, shadowCoord: vec3f, shadowParams: vec4f, exponent: f32, lightDir: vec3f) -> f32 {
	let Z: f32 = length(lightDir) * shadowParams.w + shadowParams.z;
	return VSM16(shadowMap, shadowMapSampler, shadowCoord.xy, shadowParams.x, Z, shadowParams.y, exponent);
}
fn VSM32(tex: texture_2d<f32>, texSampler: sampler, texCoords_in: vec2f, resolution: f32, Z: f32, vsmBias: f32, exponent: f32) -> f32 {
	#ifdef CAPS_TEXTURE_FLOAT_FILTERABLE
		var moments: vec3f = textureSampleLevel(tex, texSampler, texCoords_in, 0.0).xyz;
	#else
		var pixelSize : f32 = 1.0 / resolution;
		let texCoords: vec2f = texCoords_in - vec2f(pixelSize);
		let s00: vec3f = textureSampleLevel(tex, texSampler, texCoords, 0.0).xyz;
		let s10: vec3f = textureSampleLevel(tex, texSampler, texCoords + vec2f(pixelSize, 0.0), 0.0).xyz;
		let s01: vec3f = textureSampleLevel(tex, texSampler, texCoords + vec2f(0.0, pixelSize), 0.0).xyz;
		let s11: vec3f = textureSampleLevel(tex, texSampler, texCoords + vec2f(pixelSize), 0.0).xyz;
		let fr: vec2f = fract(texCoords * resolution);
		let h0: vec3f = mix(s00, s10, fr.x);
		let h1: vec3f = mix(s01, s11, fr.x);
		var moments: vec3f = mix(h0, h1, fr.y);
	#endif
	return calculateEVSM(moments, Z, vsmBias, exponent);
}
fn getShadowVSM32(shadowMap: texture_2d<f32>, shadowMapSampler: sampler, shadowCoord: vec3f, shadowParams: vec4f, exponent: f32) -> f32 {
	return VSM32(shadowMap, shadowMapSampler, shadowCoord.xy, shadowParams.x, shadowCoord.z, shadowParams.y, exponent);
}
fn getShadowSpotVSM32(shadowMap: texture_2d<f32>, shadowMapSampler: sampler, shadowCoord: vec3f, shadowParams: vec4f, exponent: f32, lightDir: vec3f) -> f32 {
	let Z: f32 = length(lightDir) * shadowParams.w + shadowParams.z;
	return VSM32(shadowMap, shadowMapSampler, shadowCoord.xy, shadowParams.x, Z, shadowParams.y, exponent);
}
`,uwe=`
fn getShadowPCF1x1(shadowMap: texture_depth_2d, shadowMapSampler: sampler_comparison, shadowCoord: vec3f, shadowParams: vec4f) -> f32 {
	return textureSampleCompareLevel(shadowMap, shadowMapSampler, shadowCoord.xy, shadowCoord.z);
}
fn getShadowSpotPCF1x1(shadowMap: texture_depth_2d, shadowMapSampler: sampler_comparison, shadowCoord: vec3f, shadowParams: vec4f) -> f32 {
	return textureSampleCompareLevel(shadowMap, shadowMapSampler, shadowCoord.xy, shadowCoord.z);
}
`,hwe=`
fn _getShadowPCF3x3(shadowMap: texture_depth_2d, shadowMapSampler: sampler_comparison, shadowCoord: vec3f, shadowParams: vec3f) -> f32 {
	let z: f32 = shadowCoord.z;
	let uv: vec2f = shadowCoord.xy * shadowParams.x;
	let shadowMapSizeInv: f32 = 1.0 / shadowParams.x;
	let base_uv_temp: vec2f = floor(uv + 0.5);
	let s: f32 = (uv.x + 0.5 - base_uv_temp.x);
	let t: f32 = (uv.y + 0.5 - base_uv_temp.y);
	let base_uv: vec2f = (base_uv_temp - vec2f(0.5)) * shadowMapSizeInv;
	var sum: f32 = 0.0;
	let uw0: f32 = (3.0 - 2.0 * s);
	let uw1: f32 = (1.0 + 2.0 * s);
	let u0_offset: f32 = (2.0 - s) / uw0 - 1.0;
	let u1_offset: f32 = s / uw1 + 1.0;
	let vw0: f32 = (3.0 - 2.0 * t);
	let vw1: f32 = (1.0 + 2.0 * t);
	let v0_offset: f32 = (2.0 - t) / vw0 - 1.0;
	let v1_offset: f32 = t / vw1 + 1.0;
	let u0: f32 = u0_offset * shadowMapSizeInv + base_uv.x;
	let v0: f32 = v0_offset * shadowMapSizeInv + base_uv.y;
	let u1: f32 = u1_offset * shadowMapSizeInv + base_uv.x;
	let v1: f32 = v1_offset * shadowMapSizeInv + base_uv.y;
	sum = sum + uw0 * vw0 * textureSampleCompareLevel(shadowMap, shadowMapSampler, vec2f(u0, v0), z);
	sum = sum + uw1 * vw0 * textureSampleCompareLevel(shadowMap, shadowMapSampler, vec2f(u1, v0), z);
	sum = sum + uw0 * vw1 * textureSampleCompareLevel(shadowMap, shadowMapSampler, vec2f(u0, v1), z);
	sum = sum + uw1 * vw1 * textureSampleCompareLevel(shadowMap, shadowMapSampler, vec2f(u1, v1), z);
	sum = sum * (1.0 / 16.0);
	return sum;
}
fn getShadowPCF3x3(shadowMap: texture_depth_2d, shadowMapSampler: sampler_comparison, shadowCoord: vec3f, shadowParams: vec4f) -> f32 {
	return _getShadowPCF3x3(shadowMap, shadowMapSampler, shadowCoord, shadowParams.xyz);
}
fn getShadowSpotPCF3x3(shadowMap: texture_depth_2d, shadowMapSampler: sampler_comparison, shadowCoord: vec3f, shadowParams: vec4f) -> f32 {
	return _getShadowPCF3x3(shadowMap, shadowMapSampler, shadowCoord, shadowParams.xyz);
}
`,dwe=`
fn _getShadowPCF5x5(shadowMap: texture_depth_2d, shadowMapSampler: sampler_comparison, shadowCoord: vec3f, shadowParams: vec3f) -> f32 {
	let z: f32 = shadowCoord.z;
	let uv: vec2f = shadowCoord.xy * shadowParams.x;
	let shadowMapSizeInv: f32 = 1.0 / shadowParams.x;
	let base_uv_temp: vec2f = floor(uv + 0.5);
	let s: f32 = (uv.x + 0.5 - base_uv_temp.x);
	let t: f32 = (uv.y + 0.5 - base_uv_temp.y);
	let base_uv: vec2f = (base_uv_temp - vec2f(0.5)) * shadowMapSizeInv;
	let uw0: f32 = (4.0 - 3.0 * s);
	let uw1: f32 = 7.0;
	let uw2: f32 = (1.0 + 3.0 * s);
	let u0_offset: f32 = (3.0 - 2.0 * s) / uw0 - 2.0;
	let u1_offset: f32 = (3.0 + s) / uw1;
	let u2_offset: f32 = s / uw2 + 2.0;
	let vw0: f32 = (4.0 - 3.0 * t);
	let vw1: f32 = 7.0;
	let vw2: f32 = (1.0 + 3.0 * t);
	let v0_offset: f32 = (3.0 - 2.0 * t) / vw0 - 2.0;
	let v1_offset: f32 = (3.0 + t) / vw1;
	let v2_offset: f32 = t / vw2 + 2.0;
	var sum: f32 = 0.0;
	let u0: f32 = u0_offset * shadowMapSizeInv + base_uv.x;
	let v0: f32 = v0_offset * shadowMapSizeInv + base_uv.y;
	let u1: f32 = u1_offset * shadowMapSizeInv + base_uv.x;
	let v1: f32 = v1_offset * shadowMapSizeInv + base_uv.y;
	let u2: f32 = u2_offset * shadowMapSizeInv + base_uv.x;
	let v2: f32 = v2_offset * shadowMapSizeInv + base_uv.y;
	sum = sum + uw0 * vw0 * textureSampleCompareLevel(shadowMap, shadowMapSampler, vec2f(u0, v0), z);
	sum = sum + uw1 * vw0 * textureSampleCompareLevel(shadowMap, shadowMapSampler, vec2f(u1, v0), z);
	sum = sum + uw2 * vw0 * textureSampleCompareLevel(shadowMap, shadowMapSampler, vec2f(u2, v0), z);
	sum = sum + uw0 * vw1 * textureSampleCompareLevel(shadowMap, shadowMapSampler, vec2f(u0, v1), z);
	sum = sum + uw1 * vw1 * textureSampleCompareLevel(shadowMap, shadowMapSampler, vec2f(u1, v1), z);
	sum = sum + uw2 * vw1 * textureSampleCompareLevel(shadowMap, shadowMapSampler, vec2f(u2, v1), z);
	sum = sum + uw0 * vw2 * textureSampleCompareLevel(shadowMap, shadowMapSampler, vec2f(u0, v2), z);
	sum = sum + uw1 * vw2 * textureSampleCompareLevel(shadowMap, shadowMapSampler, vec2f(u1, v2), z);
	sum = sum + uw2 * vw2 * textureSampleCompareLevel(shadowMap, shadowMapSampler, vec2f(u2, v2), z);
	sum = sum * (1.0 / 144.0);
	sum = saturate(sum);
	return sum;
}
fn getShadowPCF5x5(shadowMap: texture_depth_2d, shadowMapSampler: sampler_comparison, shadowCoord: vec3f, shadowParams: vec4f) -> f32 {
	return _getShadowPCF5x5(shadowMap, shadowMapSampler, shadowCoord, shadowParams.xyz);
}
fn getShadowSpotPCF5x5(shadowMap: texture_depth_2d, shadowMapSampler: sampler_comparison, shadowCoord: vec3f, shadowParams: vec4f) -> f32 {
	return _getShadowPCF5x5(shadowMap, shadowMapSampler, shadowCoord, shadowParams.xyz);
}
`,fwe=`
fn fractSinRand(uv: vec2f) -> f32 {
	let PI: f32 = 3.141592653589793;
	let a: f32 = 12.9898; let b: f32 = 78.233; let c: f32 = 43758.5453;
	let dt: f32 = dot(uv.xy, vec2f(a, b));
	let sn: f32 = dt % PI;
	return fract(sin(sn) * c);
}
struct VogelDiskData {
	invNumSamples: f32,
	initialAngle: f32,
	currentPointId: f32,
}
fn prepareDiskConstants(data: ptr<function, VogelDiskData>, sampleCount: i32, randomSeed: f32) {
	let pi2: f32 = 6.28318530718;
	data.invNumSamples = 1.0 / f32(sampleCount);
	data.initialAngle = randomSeed * pi2;
	data.currentPointId = 0.0;
}
fn generateDiskSample(data: ptr<function, VogelDiskData>) -> vec2f {
	let GOLDEN_ANGLE: f32 = 2.399963;
	let r: f32 = sqrt((data.currentPointId + 0.5) * data.invNumSamples);
	let theta: f32 = data.currentPointId * GOLDEN_ANGLE + data.initialAngle;
	let offset: vec2f = vec2f(cos(theta), sin(theta)) * pow(r, 1.33);
	data.currentPointId = data.currentPointId + 1.0;
	return offset;
}
fn PCSSFindBlocker(shadowMap: texture_2d<f32>, shadowMapSampler: sampler, avgBlockerDepth: ptr<function, f32>, numBlockers: ptr<function, i32>,
	shadowCoords: vec2f, z: f32, shadowBlockerSamples: i32, penumbraSize: f32, invShadowMapSize: f32, randomSeed: f32) {
	var diskData: VogelDiskData;
	prepareDiskConstants(&diskData, shadowBlockerSamples, randomSeed);
	let searchWidth: f32 = penumbraSize * invShadowMapSize;
	var blockerSum: f32 = 0.0;
	var numBlockers_local: i32 = 0;
	for( var i: i32 = 0; i < shadowBlockerSamples; i = i + 1 ) {
		let diskUV: vec2f = generateDiskSample(&diskData);
		let sampleUV: vec2f = shadowCoords + diskUV * searchWidth;
		let shadowMapDepth: f32 = textureSampleLevel(shadowMap, shadowMapSampler, sampleUV, 0.0).r;
		if ( shadowMapDepth < z ) {
			blockerSum = blockerSum + shadowMapDepth;
			numBlockers_local = numBlockers_local + 1;
		}
	}
	*avgBlockerDepth = blockerSum / f32(numBlockers_local);
	*numBlockers = numBlockers_local;
}
fn PCSSFilter(shadowMap: texture_2d<f32>, shadowMapSampler: sampler, uv: vec2f, receiverDepth: f32, shadowSamples: i32, filterRadius: f32, randomSeed: f32) -> f32 {
	var diskData: VogelDiskData;
	prepareDiskConstants(&diskData, shadowSamples, randomSeed);
	var sum: f32 = 0.0;
	for (var i: i32 = 0; i < shadowSamples; i = i + 1) {
		let offsetUV: vec2f = generateDiskSample(&diskData) * filterRadius;
		let depth: f32 = textureSampleLevel(shadowMap, shadowMapSampler, uv + offsetUV, 0.0).r;
		sum = sum + step(receiverDepth, depth);
	}
	return sum / f32(shadowSamples);
}
fn getPenumbra(dblocker: f32, dreceiver: f32, penumbraSize: f32, penumbraFalloff: f32) -> f32 {
	let dist: f32 = dreceiver - dblocker;
	let penumbra: f32 = 1.0 - pow(1.0 - dist, penumbraFalloff);
	return penumbra * penumbraSize;
}
fn PCSSDirectional(shadowMap: texture_2d<f32>, shadowMapSampler: sampler, shadowCoords: vec3f, cameraParams: vec4f, softShadowParams: vec4f) -> f32 {
	let receiverDepth: f32 = shadowCoords.z;
	let randomSeed: f32 = fractSinRand(pcPosition.xy);
	let shadowSamples: i32 = i32(softShadowParams.x);
	let shadowBlockerSamples: i32 = i32(softShadowParams.y);
	let penumbraSize: f32 = softShadowParams.z;
	let penumbraFalloff: f32 = softShadowParams.w;
	let shadowMapSize: i32 = i32(textureDimensions(shadowMap, 0).x);
	var invShadowMapSize: f32 = 1.0 / f32(shadowMapSize);
	invShadowMapSize = invShadowMapSize * (f32(shadowMapSize) / 2048.0);
	var penumbra: f32;
	if (shadowBlockerSamples > 0) {
		var avgBlockerDepth: f32 = 0.0;
		var numBlockers: i32 = 0;
		PCSSFindBlocker(shadowMap, shadowMapSampler, &avgBlockerDepth, &numBlockers, shadowCoords.xy, receiverDepth, shadowBlockerSamples, penumbraSize, invShadowMapSize, randomSeed);
		if (numBlockers < 1) {
			return 1.0;
		}
		penumbra = getPenumbra(avgBlockerDepth, shadowCoords.z, penumbraSize, penumbraFalloff);
	} else {
		penumbra = penumbraSize;
	}
	let filterRadius: f32 = penumbra * invShadowMapSize;
	return PCSSFilter(shadowMap, shadowMapSampler, shadowCoords.xy, receiverDepth, shadowSamples, filterRadius, randomSeed);
}
fn getShadowPCSS(shadowMap: texture_2d<f32>, shadowMapSampler: sampler, shadowCoord: vec3f, shadowParams: vec4f, cameraParams: vec4f, softShadowParams: vec4f, lightDir: vec3f) -> f32 {
	return PCSSDirectional(shadowMap, shadowMapSampler, shadowCoord, cameraParams, softShadowParams);
}
`,pwe=`
attribute vertex_boneIndices: f32;
var texture_poseMap: texture_2d<f32>;
fn getBoneMatrix(indexFloat: f32) -> mat4x4f {
	let width = i32(textureDimensions(texture_poseMap).x);
	let index: i32 = i32(indexFloat + 0.5) * 3;
	let iy: i32 = index / width;
	let ix: i32 = index % width;
	let v1: vec4f = textureLoad(texture_poseMap, vec2i(ix + 0, iy), 0);
	let v2: vec4f = textureLoad(texture_poseMap, vec2i(ix + 1, iy), 0);
	let v3: vec4f = textureLoad(texture_poseMap, vec2i(ix + 2, iy), 0);
	return mat4x4f(
		v1.x, v2.x, v3.x, 0,
		v1.y, v2.y, v3.y, 0,
		v1.z, v2.z, v3.z, 0,
		v1.w, v2.w, v3.w, 1.0
	);
}
`,mwe=`
attribute vertex_boneWeights: vec4f;
attribute vertex_boneIndices: vec4f;
var texture_poseMap: texture_2d<f32>;
struct BoneMatrix {
	v1: vec4f,
	v2: vec4f,
	v3: vec4f,
}
fn getBoneMatrix(width: i32, index: i32) -> BoneMatrix {
	let v = index / width;
	let u = index % width;
	var result: BoneMatrix;
	result.v1 = textureLoad(texture_poseMap, vec2i(u + 0, v), 0);
	result.v2 = textureLoad(texture_poseMap, vec2i(u + 1, v), 0);
	result.v3 = textureLoad(texture_poseMap, vec2i(u + 2, v), 0);
	return result;
}
fn getSkinMatrix(indicesFloat: vec4f, weights: vec4f) -> mat4x4f {
	let width = i32(textureDimensions(texture_poseMap).x);
	var indices = vec4i(indicesFloat + 0.5) * 3;
	let boneA = getBoneMatrix(width, indices.x);
	let boneB = getBoneMatrix(width, indices.y);
	let boneC = getBoneMatrix(width, indices.z);
	let boneD = getBoneMatrix(width, indices.w);
	let v1 = boneA.v1 * weights.x + boneB.v1 * weights.y + boneC.v1 * weights.z + boneD.v1 * weights.w;
	let v2 = boneA.v2 * weights.x + boneB.v2 * weights.y + boneC.v2 * weights.z + boneD.v2 * weights.w;
	let v3 = boneA.v3 * weights.x + boneB.v3 * weights.y + boneC.v3 * weights.z + boneD.v3 * weights.w;
	let one = dot(weights, vec4f(1.0, 1.0, 1.0, 1.0));
	return mat4x4f(
		v1.x, v2.x, v3.x, 0,
		v1.y, v2.y, v3.y, 0,
		v1.z, v2.z, v3.z, 0,
		v1.w, v2.w, v3.w, one
	);
}
`,gwe=`
	#define LIT_SKYBOX_INTENSITY
	#include "envProcPS"
	#include "gammaPS"
	#include "tonemappingPS"
	#ifdef PREPASS_PASS
		varying vLinearDepth: f32;
		#include "floatAsUintPS"
	#endif
	varying vViewDir : vec3f;
	uniform skyboxHighlightMultiplier : f32;
	#ifdef SKY_CUBEMAP
		var texture_cubeMap : texture_cube<f32>;
		var texture_cubeMap_sampler : sampler;
		#ifdef SKYMESH
			varying vWorldPos : vec3f;
			uniform cubeMapRotationMatrix : mat3x3f;
			uniform projectedSkydomeCenter : vec3f;
		#endif
	#else
		#include "sphericalPS"
		#include "envAtlasPS"
		var texture_envAtlas : texture_2d<f32>;
		var texture_envAtlas_sampler : sampler;
		uniform mipLevel : f32;
	#endif
	@fragment
	fn fragmentMain(input : FragmentInput) -> FragmentOutput {
		var output: FragmentOutput;
		#ifdef PREPASS_PASS
			output.color = float2vec4(vLinearDepth);
		#else
			var linear : vec3f;
			var dir : vec3f;
			#ifdef SKY_CUBEMAP
				#ifdef SKYMESH
					var envDir : vec3f = normalize(input.vWorldPos - uniform.projectedSkydomeCenter);
					dir = envDir * uniform.cubeMapRotationMatrix;
				#else
					dir = input.vViewDir;
				#endif
				dir.x *= -1.0;
				linear = {SKYBOX_DECODE_FNC}(textureSample(texture_cubeMap, texture_cubeMap_sampler, dir));
			#else
				dir = input.vViewDir * vec3f(-1.0, 1.0, 1.0);
				let uv : vec2f = toSphericalUv(normalize(dir));
				linear = {SKYBOX_DECODE_FNC}(textureSample(texture_envAtlas, texture_envAtlas_sampler, mapRoughnessUv(uv, uniform.mipLevel)));
			#endif
			if (any(linear >= vec3f(64.0))) {
				linear *= uniform.skyboxHighlightMultiplier;
			}
			
			output.color = vec4f(gammaCorrectOutput(toneMap(processEnvironment(linear))), 1.0);
		#endif
		return output;
	}
`,_we=`
	attribute aPosition : vec4f;
	uniform matrix_view : mat4x4f;
	uniform matrix_projectionSkybox : mat4x4f;
	uniform cubeMapRotationMatrix : mat3x3f;
	varying vViewDir : vec3f;
	#ifdef PREPASS_PASS
		varying vLinearDepth: f32;
	#endif
	#ifdef SKYMESH
		uniform matrix_model : mat4x4f;
		varying vWorldPos : vec3f;
	#endif
	@vertex
	fn vertexMain(input : VertexInput) -> VertexOutput {
		var output : VertexOutput;
		var view : mat4x4f = uniform.matrix_view;
		#ifdef SKYMESH
			var worldPos : vec4f = uniform.matrix_model * input.aPosition;
			output.vWorldPos = worldPos.xyz;
			output.position = uniform.matrix_projectionSkybox * (view * worldPos);
			#ifdef PREPASS_PASS
				output.vLinearDepth = -(uniform.matrix_view * vec4f(worldPos.xyz, 1.0)).z;
			#endif
		#else
			view[3][0] = 0.0;
			view[3][1] = 0.0;
			view[3][2] = 0.0;
			output.position = uniform.matrix_projectionSkybox * (view * input.aPosition);
			output.vViewDir = input.aPosition.xyz * uniform.cubeMapRotationMatrix;
			#ifdef PREPASS_PASS
				output.vLinearDepth = -pcPosition.w;
			#endif
		#endif
		output.position.z = output.position.w - 1.0e-7;
		return output;
	}
`,vwe=`
#ifdef STD_SPECULAR_CONSTANT
	uniform material_specular: vec3f;
#endif
fn getSpecularity() {
	var specularColor = vec3f(1.0, 1.0, 1.0);
	#ifdef STD_SPECULAR_CONSTANT
	specularColor = specularColor * uniform.material_specular;
	#endif
	#ifdef STD_SPECULAR_TEXTURE
	specularColor = specularColor * {STD_SPECULAR_TEXTURE_DECODE}(textureSampleBias({STD_SPECULAR_TEXTURE_NAME}, {STD_SPECULAR_TEXTURE_NAME}Sampler, {STD_SPECULAR_TEXTURE_UV}, uniform.textureBias)).{STD_SPECULAR_TEXTURE_CHANNEL};
	#endif
	#ifdef STD_SPECULAR_VERTEX
	specularColor = specularColor * saturate3(vVertexColor.{STD_SPECULAR_VERTEX_CHANNEL});
	#endif
	dSpecularity = specularColor;
}
`,ywe=`
fn toSpherical(dir: vec3f) -> vec2f {
	let angle_xz = select(0.0, atan2(dir.x, dir.z), any(dir.xz != vec2f(0.0)));
	return vec2f(angle_xz, asin(dir.y));
}
fn toSphericalUv(dir : vec3f) -> vec2f {
	const PI : f32 = 3.141592653589793;
	let uv : vec2f = toSpherical(dir) / vec2f(PI * 2.0, PI) + vec2f(0.5, 0.5);
	return vec2f(uv.x, 1.0 - uv.y);
}
`,Swe=`
#ifdef STD_SPECULARITYFACTOR_CONSTANT
	uniform material_specularityFactor: f32;
#endif
fn getSpecularityFactor() {
	var specularityFactor = 1.0;
	#ifdef STD_SPECULARITYFACTOR_CONSTANT
	specularityFactor = specularityFactor * uniform.material_specularityFactor;
	#endif
	#ifdef STD_SPECULARITYFACTOR_TEXTURE
	specularityFactor = specularityFactor * textureSampleBias({STD_SPECULARITYFACTOR_TEXTURE_NAME}, {STD_SPECULARITYFACTOR_TEXTURE_NAME}Sampler, {STD_SPECULARITYFACTOR_TEXTURE_UV}, uniform.textureBias).{STD_SPECULARITYFACTOR_TEXTURE_CHANNEL};
	#endif
	#ifdef STD_SPECULARITYFACTOR_VERTEX
	specularityFactor = specularityFactor * saturate(vVertexColor.{STD_SPECULARITYFACTOR_VERTEX_CHANNEL});
	#endif
	dSpecularityFactor = specularityFactor;
}
`,xwe=`
fn getSpotEffect(lightSpotDir: vec3f, lightInnerConeAngle: f32, lightOuterConeAngle: f32, lightDirNorm: vec3f) -> f32 {
	let cosAngle: f32 = dot(lightDirNorm, lightSpotDir);
	return smoothstep(lightOuterConeAngle, lightInnerConeAngle, cosAngle);
}`,bwe=`
	nineSlicedUv = vec2f(vUv0.x, 1.0 - vUv0.y);
`,wwe=`
	let tileMask: vec2f = step(vMask, vec2f(0.99999));
	let tileSize: vec2f = 0.5 * (innerOffset.xy + innerOffset.zw);
	let tileScale: vec2f = vec2f(1.0) / (vec2f(1.0) - tileSize);
	var clampedUv: vec2f = mix(innerOffset.xy * 0.5, vec2f(1.0) - innerOffset.zw * 0.5, fract((vTiledUv - tileSize) * tileScale));
	clampedUv = clampedUv * atlasRect.zw + atlasRect.xy;
	var nineSlicedUv: vec2f = vUv0 * tileMask + clampedUv * (vec2f(1.0) - tileMask);
	nineSlicedUv.y = 1.0 - nineSlicedUv.y;
`,Twe=`
	var<private> dAlpha: f32 = 1.0;
	#if LIT_BLEND_TYPE != NONE || defined(LIT_ALPHA_TEST) || defined(LIT_ALPHA_TO_COVERAGE) || STD_OPACITY_DITHER != NONE
		#ifdef STD_OPACITY_TEXTURE_ALLOCATE
			var texture_opacityMap : texture_2d<f32>;
			var texture_opacityMapSampler : sampler;
		#endif
	#endif
	#ifdef FORWARD_PASS
		var<private> dAlbedo: vec3f;
		var<private> dNormalW: vec3f;
		var<private> dSpecularity: vec3f = vec3f(0.0, 0.0, 0.0);
		var<private> dGlossiness: f32 = 0.0;
		#ifdef LIT_REFRACTION
			var<private> dTransmission: f32;
			var<private> dThickness: f32;
		#endif
		#ifdef LIT_SCENE_COLOR
			var uSceneColorMap : texture_2d<f32>;
			var uSceneColorMapSampler : sampler;
		#endif
		#ifdef LIT_SCREEN_SIZE
			uniform uScreenSize: vec4f;
		#endif
		#ifdef LIT_TRANSFORMS
			var<private> matrix_viewProjection: mat4x4f;
			var<private> matrix_model: mat4x4f;
		#endif
		#ifdef STD_HEIGHT_MAP
			var<private> dUvOffset: vec2f;
			#ifdef STD_DIFFUSE_TEXTURE_ALLOCATE
				var texture_heightMap : texture_2d<f32>;
				var texture_heightMapSampler : sampler;
			#endif
		#endif
		#ifdef STD_DIFFUSE_TEXTURE_ALLOCATE
			var texture_diffuseMap : texture_2d<f32>;
			var texture_diffuseMapSampler : sampler;
		#endif
		#ifdef STD_DIFFUSEDETAIL_TEXTURE_ALLOCATE
			var texture_diffuseDetailMap : texture_2d<f32>;
			var texture_diffuseDetailMapSampler : sampler;
		#endif
		#ifdef STD_NORMAL_TEXTURE_ALLOCATE
			var texture_normalMap : texture_2d<f32>;
			var texture_normalMapSampler : sampler;
		#endif
		#ifdef STD_NORMALDETAIL_TEXTURE_ALLOCATE
			var texture_normalDetailMap : texture_2d<f32>;
			var texture_normalDetailMapSampler : sampler;
		#endif
		#ifdef STD_THICKNESS_TEXTURE_ALLOCATE
			var texture_thicknessMap : texture_2d<f32>;
			var texture_thicknessMapSampler : sampler;
		#endif
		#ifdef STD_REFRACTION_TEXTURE_ALLOCATE
			var texture_refractionMap : texture_2d<f32>;
			var texture_refractionMapSampler : sampler;
		#endif
		#ifdef LIT_IRIDESCENCE
			var<private> dIridescence: f32;
			var<private> dIridescenceThickness: f32;
			#ifdef STD_IRIDESCENCE_THICKNESS_TEXTURE_ALLOCATE
				var texture_iridescenceThicknessMap : texture_2d<f32>;
				var texture_iridescenceThicknessMapSampler : sampler;
			#endif
			#ifdef STD_IRIDESCENCE_TEXTURE_ALLOCATE
				var texture_iridescenceMap : texture_2d<f32>;
				var texture_iridescenceMapSampler : sampler;
			#endif
		#endif
		#ifdef LIT_CLEARCOAT
			var<private> ccSpecularity: f32;
			var<private> ccGlossiness: f32;
			var<private> ccNormalW: vec3f;
		#endif
		#ifdef LIT_GGX_SPECULAR
			var<private> dAnisotropy: f32;
			var<private> dAnisotropyRotation: vec2f;
		#endif
		#ifdef LIT_SPECULAR_OR_REFLECTION
			#ifdef LIT_SHEEN
				var<private> sSpecularity: vec3f;
				var<private> sGlossiness: f32;
				#ifdef STD_SHEEN_TEXTURE_ALLOCATE
					var texture_sheenMap : texture_2d<f32>;
					var texture_sheenMapSampler : sampler;
				#endif
				#ifdef STD_SHEENGLOSS_TEXTURE_ALLOCATE
					var texture_sheenGlossMap : texture_2d<f32>;
					var texture_sheenGlossMapSampler : sampler;
				#endif
			#endif
			#ifdef LIT_METALNESS
				var<private> dMetalness: f32;
				var<private> dIor: f32;
				#ifdef STD_METALNESS_TEXTURE_ALLOCATE
					var texture_metalnessMap : texture_2d<f32>;
					var texture_metalnessMapSampler : sampler;
				#endif
			#endif
			#ifdef LIT_SPECULARITY_FACTOR
				var<private> dSpecularityFactor: f32;
				#ifdef STD_SPECULARITYFACTOR_TEXTURE_ALLOCATE
					var texture_specularityFactorMap : texture_2d<f32>;
					var texture_specularityFactorMapSampler : sampler;
				#endif
			#endif
			#ifdef STD_SPECULAR_COLOR
				#ifdef STD_SPECULAR_TEXTURE_ALLOCATE
					var texture_specularMap : texture_2d<f32>;
					var texture_specularMapSampler : sampler;
				#endif
			#endif
			#ifdef STD_GLOSS_TEXTURE_ALLOCATE
				var texture_glossMap : texture_2d<f32>;
				var texture_glossMapSampler : sampler;
			#endif
		#endif
		#ifdef STD_AO
			var <private> dAo: f32;
			#ifdef STD_AO_TEXTURE_ALLOCATE
				var texture_aoMap : texture_2d<f32>;
				var texture_aoMapSampler : sampler;
			#endif
			#ifdef STD_AODETAIL_TEXTURE_ALLOCATE
				var texture_aoDetailMap : texture_2d<f32>;
				var texture_aoDetailMapSampler : sampler;
			#endif
		#endif
		var <private> dEmission: vec3f;
		#ifdef STD_EMISSIVE_TEXTURE_ALLOCATE
			var texture_emissiveMap : texture_2d<f32>;
			var texture_emissiveMapSampler : sampler;
		#endif
		#ifdef LIT_CLEARCOAT
			#ifdef STD_CLEARCOAT_TEXTURE_ALLOCATE
				var texture_clearCoatMap : texture_2d<f32>;
				var texture_clearCoatMapSampler : sampler;
			#endif
			#ifdef STD_CLEARCOATGLOSS_TEXTURE_ALLOCATE
				var texture_clearCoatGlossMap : texture_2d<f32>;
				var texture_clearCoatGlossMapSampler : sampler;
			#endif
			#ifdef STD_CLEARCOATNORMAL_TEXTURE_ALLOCATE
				var texture_clearCoatNormalMap : texture_2d<f32>;
				var texture_clearCoatNormalMapSampler : sampler;
			#endif
		#endif
		#ifdef LIT_GGX_SPECULAR
			#ifdef STD_ANISOTROPY_TEXTURE_ALLOCATE
				var texture_anisotropyMap : texture_2d<f32>;
				var texture_anisotropyMapSampler : sampler;
			#endif
		#endif
		#if defined(STD_LIGHTMAP) || defined(STD_LIGHT_VERTEX_COLOR)
			var<private> dLightmap: vec3f;
			#ifdef STD_LIGHT_TEXTURE_ALLOCATE
				var texture_lightMap : texture_2d<f32>;
				var texture_lightMapSampler : sampler;
			#endif
		#endif
	#endif
	#include "litShaderCorePS"
`,Ewe=`
	#if LIT_BLEND_TYPE != NONE || defined(LIT_ALPHA_TEST) || defined(LIT_ALPHA_TO_COVERAGE) || STD_OPACITY_DITHER != NONE
		#include "opacityPS"
		#if defined(LIT_ALPHA_TEST)
			#include "alphaTestPS"
		#endif
		#if STD_OPACITY_DITHER != NONE
			#include "opacityDitherPS"
		#endif
	#endif
	#ifdef FORWARD_PASS
		#ifdef STD_HEIGHT_MAP
			#include "parallaxPS"
		#endif
		#include  "diffusePS"
		#ifdef LIT_NEEDS_NORMAL
			#include "normalMapPS"
		#endif
		#ifdef LIT_REFRACTION
			#include "transmissionPS"
			#include "thicknessPS"
		#endif
		#ifdef LIT_IRIDESCENCE
			#include "iridescencePS"
			#include "iridescenceThicknessPS"
		#endif
		#ifdef LIT_SPECULAR_OR_REFLECTION
			#ifdef LIT_SHEEN
				#include "sheenPS"
				#include "sheenGlossPS"
			#endif
			#ifdef LIT_METALNESS
				#include "metalnessPS"
				#include "iorPS"
			#endif
			#ifdef LIT_SPECULARITY_FACTOR
				#include "specularityFactorPS"
			#endif
			#ifdef STD_SPECULAR_COLOR
				#include "specularPS"
			#else
				fn getSpecularity() { 
					dSpecularity = vec3f(1.0, 1.0, 1.0);
				}
			#endif
			#include "glossPS"
		#endif
		#ifdef STD_AO
			#include "aoPS"
		#endif
		#include "emissivePS"
		#ifdef LIT_CLEARCOAT
			#include "clearCoatPS"
			#include "clearCoatGlossPS"
			#include "clearCoatNormalPS"
		#endif
		#if defined(LIT_SPECULAR) && defined(LIT_LIGHTING) && defined(LIT_GGX_SPECULAR)
			#include "anisotropyPS"
		#endif
		#if defined(STD_LIGHTMAP) || defined(STD_LIGHT_VERTEX_COLOR)
			#include "lightmapPS"
		#endif
	#endif
	fn evaluateFrontend() {
		#if LIT_BLEND_TYPE != NONE || defined(LIT_ALPHA_TEST) || defined(LIT_ALPHA_TO_COVERAGE) || STD_OPACITY_DITHER != NONE
			getOpacity();
			#if defined(LIT_ALPHA_TEST)
				alphaTest(dAlpha);
			#endif
			#if STD_OPACITY_DITHER != NONE
				opacityDither(dAlpha, 0.0);
			#endif
			litArgs_opacity = dAlpha;
		#endif
		#ifdef FORWARD_PASS
			#ifdef STD_HEIGHT_MAP
				getParallax();
			#endif
			getAlbedo();
			litArgs_albedo = dAlbedo;
			#ifdef LIT_NEEDS_NORMAL
				getNormal();
				litArgs_worldNormal = dNormalW;
			#endif
			#ifdef LIT_REFRACTION
				getRefraction();
				litArgs_transmission = dTransmission;
				getThickness();
				litArgs_thickness = dThickness;
				#ifdef LIT_DISPERSION
					litArgs_dispersion = uniform.material_dispersion;
				#endif
			#endif
			#ifdef LIT_IRIDESCENCE
				getIridescence();
				getIridescenceThickness();
				litArgs_iridescence_intensity = dIridescence;
				litArgs_iridescence_thickness = dIridescenceThickness;
			#endif
			#ifdef LIT_SPECULAR_OR_REFLECTION
				#ifdef LIT_SHEEN
					getSheen();
					litArgs_sheen_specularity = sSpecularity;
					getSheenGlossiness();
					litArgs_sheen_gloss = sGlossiness;
				#endif
				#ifdef LIT_METALNESS
					getMetalness();
					litArgs_metalness = dMetalness;
					getIor();
					litArgs_ior = dIor;
				#endif
				#ifdef LIT_SPECULARITY_FACTOR
					getSpecularityFactor();
					litArgs_specularityFactor = dSpecularityFactor;
				#endif
				getGlossiness();
				getSpecularity();
				litArgs_specularity = dSpecularity;
				litArgs_gloss = dGlossiness;
			#endif
			#ifdef STD_AO
				getAO();
				litArgs_ao = dAo;
			#endif
			getEmission();
			litArgs_emission = dEmission;
			#ifdef LIT_CLEARCOAT
				getClearCoat();
				getClearCoatGlossiness();
				getClearCoatNormal();
				litArgs_clearcoat_specularity = ccSpecularity;
				litArgs_clearcoat_gloss = ccGlossiness;
				litArgs_clearcoat_worldNormal = ccNormalW;
			#endif
			#if defined(LIT_SPECULAR) && defined(LIT_LIGHTING) && defined(LIT_GGX_SPECULAR)
				getAnisotropy();
			#endif
			#if defined(STD_LIGHTMAP) || defined(STD_LIGHT_VERTEX_COLOR)
				getLightMap();
				litArgs_lightmap = dLightmap;
				#ifdef STD_LIGHTMAP_DIR
					litArgs_lightmapDir = dLightmapDir;
				#endif
			#endif
		#endif
	}
`,Awe=`
#ifdef LIT_TANGENTS
	#define TBN_TANGENTS
#else
	#if defined(LIT_USE_NORMALS) || defined(LIT_USE_CLEARCOAT_NORMALS)
		#define TBN_DERIVATIVES
	#endif
#endif
#if defined(TBN_DERIVATIVES)
	uniform tbnBasis: f32;
#endif
fn getTBN(tangent: vec3f, binormal: vec3f, normal: vec3f) {
	#ifdef TBN_TANGENTS
		dTBN = mat3x3f(normalize(tangent), normalize(binormal), normalize(normal));
	#elif defined(TBN_DERIVATIVES)
		let uv: vec2f = {lightingUv};
		let dp1: vec3f = dpdx( vPositionW );
		let dp2: vec3f = dpdy( vPositionW );
		let duv1: vec2f = dpdx( uv );
		let duv2: vec2f = dpdy( uv );
		let dp2perp: vec3f = cross( dp2, normal );
		let dp1perp: vec3f = cross( normal, dp1 );
		let T: vec3f = dp2perp * duv1.x + dp1perp * duv2.x;
		let B: vec3f = dp2perp * duv1.y + dp1perp * duv2.y;
		let denom: f32 = max( dot(T, T), dot(B, B) );
		let invmax: f32 = select(uniform.tbnBasis / sqrt( denom ), 0.0, denom == 0.0);
		dTBN = mat3x3f(T * invmax, -B * invmax, normal );
	#else
		var B: vec3f = cross(normal, vObjectSpaceUpW);
		var T: vec3f = cross(normal, B);
		if (dot(B,B) == 0.0)
		{
			let major: f32 = max(max(normal.x, normal.y), normal.z);
			if (normal.x == major)
			{
				B = cross(normal, vec3f(0.0, 1.0, 0.0));
				T = cross(normal, B);
			}
			else if (normal.y == major)
			{
				B = cross(normal, vec3f(0.0, 0.0, 1.0));
				T = cross(normal, B);
			}
			else
			{
				B = cross(normal, vec3f(1.0, 0.0, 0.0));
				T = cross(normal, B);
			}
		}
		dTBN = mat3x3f(normalize(T), normalize(B), normalize(normal));
	#endif
}`,Cwe=`
#ifdef STD_THICKNESS_CONSTANT
uniform material_thickness: f32;
#endif
fn getThickness() {
	dThickness = 1.0;
	#ifdef STD_THICKNESS_CONSTANT
	dThickness = dThickness * uniform.material_thickness;
	#endif
	#ifdef STD_THICKNESS_TEXTURE
	dThickness = dThickness * textureSampleBias({STD_THICKNESS_TEXTURE_NAME}, {STD_THICKNESS_TEXTURE_NAME}Sampler, {STD_THICKNESS_TEXTURE_UV}, uniform.textureBias).{STD_THICKNESS_TEXTURE_CHANNEL};
	#endif
	#ifdef STD_THICKNESS_VERTEX
	dThickness = dThickness * saturate(vVertexColor.{STD_THICKNESS_VERTEX_CHANNEL});
	#endif
}
`,Pwe=`
#if (TONEMAP == NONE)
	#include "tonemappingNonePS"
#elif TONEMAP == FILMIC
	#include "tonemappingFilmicPS"
#elif TONEMAP == LINEAR
	#include "tonemappingLinearPS"
#elif TONEMAP == HEJL
	#include "tonemappingHejlPS"
#elif TONEMAP == ACES
	#include "tonemappingAcesPS"
#elif TONEMAP == ACES2
	#include "tonemappingAces2PS"
#elif TONEMAP == NEUTRAL
	#include "tonemappingNeutralPS"
#endif
`,Iwe=`
uniform exposure: f32;
fn toneMap(color: vec3f) -> vec3f {
	let tA: f32 = 2.51;
	let tB: f32 = 0.03;
	let tC: f32 = 2.43;
	let tD: f32 = 0.59;
	let tE: f32 = 0.14;
	let x: vec3f = color * uniform.exposure;
	return (x * (tA * x + tB)) / (x * (tC * x + tD) + tE);
}
`,Mwe=`
uniform exposure: f32;
const ACESInputMat: mat3x3f = mat3x3f(
	vec3f(0.59719, 0.35458, 0.04823),
	vec3f(0.07600, 0.90834, 0.01566),
	vec3f(0.02840, 0.13383, 0.83777)
);
const ACESOutputMat: mat3x3f = mat3x3f(
	vec3f( 1.60475, -0.53108, -0.07367),
	vec3f(-0.10208,  1.10813, -0.00605),
	vec3f(-0.00327, -0.07276,  1.07602)
);
fn RRTAndODTFit(v: vec3f) -> vec3f {
	let a: vec3f = v * (v + vec3f(0.0245786)) - vec3f(0.000090537);
	let b: vec3f = v * (vec3f(0.983729) * v + vec3f(0.4329510)) + vec3f(0.238081);
	return a / b;
}
fn toneMap(color: vec3f) -> vec3f {
	var c: vec3f = color * (uniform.exposure / 0.6);
	c = c * ACESInputMat;
	c = RRTAndODTFit(c);
	c = c * ACESOutputMat;
	return clamp(c, vec3f(0.0), vec3f(1.0));
}
`,Rwe=`
const A: f32 = 0.15;
const B: f32 = 0.50;
const C: f32 = 0.10;
const D: f32 = 0.20;
const E: f32 = 0.02;
const F: f32 = 0.30;
const W: f32 = 11.2;
uniform exposure: f32;
fn uncharted2Tonemap(x: vec3f) -> vec3f {
	return ((x * (A * x + C * B) + D * E) / (x * (A * x + B) + D * F)) - vec3f(E / F);
}
fn toneMap(color: vec3f) -> vec3f {
	var c: vec3f = uncharted2Tonemap(color * uniform.exposure);
	let whiteScale: vec3f = vec3f(1.0) / uncharted2Tonemap(vec3f(W, W, W));
	c *= whiteScale;
	return c;
}
`,Dwe=`
uniform exposure: f32;
fn toneMap(color: vec3f) -> vec3f {
	let A: f32 = 0.22;
	let B: f32 = 0.3;
	let C: f32 = 0.1;
	let D: f32 = 0.2;
	let E: f32 = 0.01;
	let F: f32 = 0.3;
	let Scl: f32 = 1.25;
	let adjusted_color = color * uniform.exposure;
	let h = max(vec3f(0.0), adjusted_color - vec3f(0.004));
	return (h * ((Scl * A) * h + Scl * vec3f(C * B)) + Scl * vec3f(D * E)) /
		   (h * (A * h + vec3f(B)) + vec3f(D * F)) -
		   Scl * vec3f(E / F);
}
`,Lwe=`
uniform exposure: f32;
fn toneMap(color: vec3f) -> vec3f {
	return color * uniform.exposure;
}
`,Owe=`
uniform exposure: f32;
fn toneMap(col: vec3f) -> vec3f {
	var color = col * uniform.exposure;
	let startCompression = 0.8 - 0.04;
	let desaturation = 0.15;
	let x = min(color.r, min(color.g, color.b));
	let offset = select(0.04, x - 6.25 * x * x, x < 0.08);
	color -= vec3f(offset);
	let peak = max(color.r, max(color.g, color.b));
	if (peak < startCompression) {
		return color;
	}
	let d = 1.0 - startCompression;
	let newPeak = 1.0 - d * d / (peak + d - startCompression);
	color *= newPeak / peak;
	let g = 1.0 - 1.0 / (desaturation * (peak - newPeak) + 1.0);
	return mix(color, vec3f(newPeak), vec3f(g));
}
`,Nwe=`
fn toneMap(color: vec3f) -> vec3f {
	return color;
}
`,kwe=`
#ifdef PIXELSNAP
	uniform uScreenSize: vec4f;
#endif
#ifdef SCREENSPACE
	uniform projectionFlipY: f32;
#endif
fn evalWorldPosition(vertexPosition: vec3f, modelMatrix: mat4x4f) -> vec4f {
	var localPos: vec3f = getLocalPosition(vertexPosition);
	#ifdef NINESLICED
		var localPosXZ: vec2f = localPos.xz;
		localPosXZ = localPosXZ * uniform.outerScale;
		let positiveUnitOffset: vec2f = clamp(vertexPosition.xz, vec2f(0.0), vec2f(1.0));
		let negativeUnitOffset: vec2f = clamp(-vertexPosition.xz, vec2f(0.0), vec2f(1.0));
		localPosXZ = localPosXZ + (-positiveUnitOffset * uniform.innerOffset.xy + negativeUnitOffset * uniform.innerOffset.zw) * vertex_texCoord0.xy;
		dTiledUvGlobal = (localPosXZ - uniform.outerScale + uniform.innerOffset.xy) * -0.5 + 1.0;
		localPosXZ = localPosXZ * -0.5;
		localPos = vec3f(localPosXZ.x, localPosXZ.y, localPos.y);
	#endif
	var posW: vec4f = modelMatrix * vec4f(localPos, 1.0);
	#ifdef SCREENSPACE
		posW = vec4f(posW.xy, 0.0, 1.0);
	#endif
	return posW;
}
fn getPosition() -> vec4f {
	dModelMatrix = getModelMatrix();
	let posW: vec4f = evalWorldPosition(vertex_position.xyz, dModelMatrix);
	dPositionW = posW.xyz;
	var screenPos: vec4f;
	#ifdef UV1LAYOUT
		screenPos = vec4f(vertex_texCoord1.xy * 2.0 - 1.0, 0.5, 1.0);
		screenPos.y *= -1.0;
	#else
		#ifdef SCREENSPACE
			screenPos = posW;
			screenPos.y *= uniform.projectionFlipY;
		#else
			screenPos = uniform.matrix_viewProjection * posW;
		#endif
		#ifdef PIXELSNAP
			screenPos.xy = (screenPos.xy * 0.5) + 0.5;
			screenPos.xy *= uniforms.uScreenSize.xy;
			screenPos.xy = floor(screenPos.xy);
			screenPos.xy *= uniforms.uScreenSize.zw;
			screenPos.xy = (screenPos.xy * 2.0) - 1.0;
		#endif
	#endif
	return screenPos;
}
fn getWorldPosition() -> vec3f {
	return dPositionW;
}
`,Fwe=`
	attribute vertex_position: vec4f;
	uniform matrix_viewProjection: mat4x4f;
	uniform matrix_model: mat4x4f;
	
	#ifdef MORPHING
		uniform morph_tex_params: vec2f;
		attribute morph_vertex_id: u32;
		fn getTextureMorphCoords() -> vec2i {
			var textureSize: vec2i = vec2i(uniform.morph_tex_params);
			var morphGridV: i32 = i32(morph_vertex_id) / textureSize.x;
			var morphGridU: i32 = i32(morph_vertex_id) - (morphGridV * textureSize.x);
			morphGridV = textureSize.y - morphGridV - 1;
			return vec2i(morphGridU, morphGridV);
		}
		#ifdef MORPHING_POSITION
			#ifdef MORPHING_INT
				uniform aabbSize: vec3f;
				uniform aabbMin: vec3f;
				var morphPositionTex: texture_2d<u32>;
			#else
				var morphPositionTex: texture_2d<f32>;
			#endif
		#endif
	#endif
	#ifdef defined(BATCH)
		#include "skinBatchVS"
		fn getModelMatrix() -> mat4x4f {
			return getBoneMatrix(vertex_boneIndices);
		}
	#elif defined(SKIN)
		#include "skinVS"
		fn getModelMatrix() -> mat4x4f {
			return uniform.matrix_model * getSkinMatrix(vertex_boneIndices, vertex_boneWeights);
		}
	#elif defined(INSTANCING)
		#include "transformInstancingVS"
	#else
		fn getModelMatrix() -> mat4x4f {
			return uniform.matrix_model;
		}
	#endif
	fn getLocalPosition(vertexPosition: vec3f) -> vec3f {
		var localPos: vec3f = vertexPosition;
		#ifdef MORPHING_POSITION
			var morphUV: vec2i = getTextureMorphCoords();
			#ifdef MORPHING_INT
				var morphPos: vec3f = vec3f(textureLoad(morphPositionTex, morphUV, 0).xyz) / 65535.0 * uniform.aabbSize + uniform.aabbMin;
			#else
				var morphPos: vec3f = textureLoad(morphPositionTex, morphUV, 0).xyz;
			#endif
			localPos += morphPos;
		#endif
		return localPos;
	}
`,Bwe=`
attribute instance_line1: vec4f;
attribute instance_line2: vec4f;
attribute instance_line3: vec4f;
attribute instance_line4: vec4f;
fn getModelMatrix() -> mat4x4f {
	return uniform.matrix_model * mat4x4f(instance_line1, instance_line2, instance_line3, instance_line4);
}
`,Uwe=`
#ifdef STD_REFRACTION_CONSTANT
	uniform material_refraction: f32;
#endif
fn getRefraction() {
	var refraction: f32 = 1.0;
	#ifdef STD_REFRACTION_CONSTANT
	refraction = uniform.material_refraction;
	#endif
	#ifdef STD_REFRACTION_TEXTURE
	refraction = refraction * textureSampleBias({STD_REFRACTION_TEXTURE_NAME}, {STD_REFRACTION_TEXTURE_NAME}Sampler, {STD_REFRACTION_TEXTURE_UV}, uniform.textureBias).{STD_REFRACTION_TEXTURE_CHANNEL};
	#endif
	#ifdef STD_REFRACTION_VERTEX
	refraction = refraction * saturate(vVertexColor.{STD_REFRACTION_VERTEX_CHANNEL});
	#endif
	dTransmission = refraction;
}
`,zwe=`
uniform twoSidedLightingNegScaleFactor: f32;
fn handleTwoSidedLighting() {
	dTBN[2] = dTBN[2] * select(-uniform.twoSidedLightingNegScaleFactor, uniform.twoSidedLightingNegScaleFactor, pcFrontFacing);
}
`,Vwe=`
#ifdef NINESLICED
	fn getUv0() -> vec2f {
		var uv = vertex_position.xz;
		let positiveUnitOffset = clamp(vertex_position.xz, vec2f(0.0, 0.0), vec2f(1.0, 1.0));
		let negativeUnitOffset = clamp(-vertex_position.xz, vec2f(0.0, 0.0), vec2f(1.0, 1.0));
		uv = uv + ((-positiveUnitOffset * uniform.innerOffset.xy) + (negativeUnitOffset * uniform.innerOffset.zw)) * vertex_texCoord0.xy;
		uv = uv * -0.5 + vec2f(0.5, 0.5);
		uv = uv * uniform.atlasRect.zw + uniform.atlasRect.xy;
		dMaskGlobal = vertex_texCoord0.xy;
		return uv;
	}
#else
	fn getUv0() -> vec2f {
		return vertex_texCoord0;
	}
#endif
`,jwe=`
fn getUv1() -> vec2f {
	return vertex_texCoord1;
}
`,$we=`
output.vUV{TRANSFORM_UV_{i}}_{TRANSFORM_ID_{i}} = vec2f(
	dot(vec3f(uv{TRANSFORM_UV_{i}}, 1), uniform.{TRANSFORM_NAME_{i}}0),
	dot(vec3f(uv{TRANSFORM_UV_{i}}, 1), uniform.{TRANSFORM_NAME_{i}}1)
);
`,Hwe=`
	uniform {TRANSFORM_NAME_{i}}0: vec3f;
	uniform {TRANSFORM_NAME_{i}}1: vec3f;
`,Gwe=`
fn getViewDir() {
	dViewDirW = normalize(uniform.view_position - vPositionW);
}
`;const Wwe={alphaTestPS:GSe,ambientPS:WSe,anisotropyPS:XSe,aoPS:qSe,aoDiffuseOccPS:YSe,aoSpecOccPS:KSe,bakeDirLmEndPS:ZSe,bakeLmEndPS:QSe,basePS:JSe,baseNineSlicedPS:exe,baseNineSlicedTiledPS:txe,bayerPS:ixe,blurVSMPS:rxe,clearCoatPS:sxe,clearCoatGlossPS:nxe,clearCoatNormalPS:axe,clusteredLightCookiesPS:lxe,clusteredLightShadowsPS:cxe,clusteredLightUtilsPS:oxe,clusteredLightPS:uxe,combinePS:hxe,cookieBlit2DPS:dxe,cookieBlitCubePS:fxe,cookieBlitVS:pxe,cubeMapProjectPS:mxe,cubeMapRotatePS:gxe,debugOutputPS:_xe,debugProcessFrontendPS:vxe,detailModesPS:Sxe,diffusePS:xxe,decodePS:yxe,emissivePS:bxe,encodePS:wxe,endPS:Txe,envAtlasPS:Exe,envProcPS:Axe,falloffInvSquaredPS:Cxe,falloffLinearPS:Pxe,floatAsUintPS:Ixe,fogPS:Mxe,fresnelSchlickPS:Rxe,frontendCodePS:"",frontendDeclPS:"",fullscreenQuadVS:Dxe,gammaPS:Lxe,glossPS:Oxe,gsplatCenterVS:Nxe,gsplatCornerVS:Gxe,gsplatColorVS:kxe,gsplatCommonVS:Fxe,gsplatCompressedDataVS:Bxe,gsplatCompressedSHVS:Uxe,gsplatEvalSHVS:zxe,gsplatQuatToMat3VS:Vxe,gsplatSogsColorVS:jxe,gsplatSogsDataVS:$xe,gsplatSogsSHVS:Hxe,gsplatDataVS:Wxe,gsplatOutputVS:Xxe,gsplatPS:qxe,gsplatSHVS:Yxe,gsplatSourceVS:Kxe,gsplatVS:Zxe,quadVS:Qxe,indirectCoreCS:Jxe,immediateLinePS:ebe,immediateLineVS:tbe,iridescenceDiffractionPS:ibe,iridescencePS:rbe,iridescenceThicknessPS:sbe,iorPS:nbe,lightDeclarationPS:abe,lightDiffuseLambertPS:obe,lightDirPointPS:lbe,lightEvaluationPS:cbe,lightFunctionLightPS:ube,lightFunctionShadowPS:hbe,lightingPS:dbe,lightmapAddPS:fbe,lightmapPS:pbe,lightSpecularAnisoGGXPS:mbe,lightSpecularBlinnPS:gbe,lightSheenPS:_be,linearizeDepthPS:vbe,litForwardBackendPS:ybe,litForwardDeclarationPS:Sbe,litForwardMainPS:xbe,litForwardPostCodePS:bbe,litForwardPreCodePS:wbe,litMainPS:Tbe,litMainVS:Ebe,litOtherMainPS:Abe,litShaderArgsPS:Cbe,litShaderCorePS:Pbe,litShadowMainPS:Ibe,litUserDeclarationPS:"",litUserDeclarationVS:"",litUserCodePS:"",litUserCodeVS:"",litUserMainStartPS:"",litUserMainStartVS:"",litUserMainEndPS:"",litUserMainEndVS:"",ltcPS:Mbe,metalnessPS:Rbe,metalnessModulatePS:Lbe,morphPS:Obe,morphVS:Nbe,msdfPS:Dbe,msdfVS:kbe,normalVS:Fbe,normalCoreVS:Bbe,normalMapPS:Ube,opacityPS:zbe,opacityDitherPS:Vbe,outputPS:jbe,outputAlphaPS:$be,outputTex2DPS:Hbe,sheenPS:Gbe,sheenGlossPS:Wbe,parallaxPS:Xbe,pickPS:qbe,reflDirPS:Ybe,reflDirAnisoPS:Kbe,reflectionCCPS:Zbe,reflectionCubePS:Qbe,reflectionEnvHQPS:Jbe,reflectionEnvPS:ewe,reflectionSpherePS:twe,reflectionSheenPS:iwe,refractionCubePS:rwe,refractionDynamicPS:swe,reprojectPS:nwe,reprojectVS:awe,screenDepthPS:owe,shadowCascadesPS:lwe,shadowEVSMPS:cwe,shadowPCF1PS:uwe,shadowPCF3PS:hwe,shadowPCF5PS:dwe,shadowSoftPS:fwe,skinBatchVS:pwe,skinVS:mwe,skyboxPS:gwe,skyboxVS:_we,specularPS:vwe,sphericalPS:ywe,specularityFactorPS:Swe,spotPS:xwe,startNineSlicedPS:bwe,startNineSlicedTiledPS:wwe,stdDeclarationPS:Twe,stdFrontEndPS:Ewe,TBNPS:Awe,thicknessPS:Cwe,tonemappingPS:Pwe,tonemappingAcesPS:Iwe,tonemappingAces2PS:Mwe,tonemappingFilmicPS:Rwe,tonemappingHejlPS:Dwe,tonemappingLinearPS:Lwe,tonemappingNeutralPS:Owe,tonemappingNonePS:Nwe,transformVS:kwe,transformCoreVS:Fwe,transformInstancingVS:Bwe,transmissionPS:Uwe,twoSidedLightingPS:zwe,uv0VS:Vwe,uv1VS:jwe,uvTransformVS:$we,uvTransformUniformsPS:Hwe,viewDirPS:Gwe,webgpuPS:i9,webgpuVS:r9},_u=class _u extends Te{constructor(e){super(),this._batcher=null,this._destroyRequested=!1,this._inFrameUpdate=!1,this._librariesLoaded=!1,this._fillMode=yz,this._resolutionMode=Y9,this._allowResize=!0,this._skyboxAsset=null,this._entityIndex={},this._inTools=!1,this._scriptPrefix="",this._time=0,this.enableBundles=typeof TextDecoder<"u",this.timeScale=1,this.maxDeltaTime=.1,this.frame=0,this.frameGraph=new wve,this.scriptsOrder=[],this.autoRender=!0,this.renderNextFrame=!1,this.lightmapper=null,this.loader=new Lf(this),this.scenes=new zve(this),this.scripts=new kve(this),this.systems=new Dve,this.i18n=new xh(this),this.keyboard=null,this.mouse=null,this.touch=null,this.gamepads=null,this.elementInput=null,this.xr=null,_u._applications[e.id]=this,kM(this),this.root=new lt,this.root._enabledInHierarchy=!0}init(e){const{assetPrefix:t,batchManager:i,componentSystems:s,elementInput:n,gamepads:a,graphicsDevice:o,keyboard:l,lightmapper:c,mouse:u,resourceHandlers:h,scriptsOrder:d,scriptPrefix:f,soundManager:p,touch:m,xr:g}=e;this.graphicsDevice=o,$e.get(o,dt).add(HSe),$e.get(o,Gt).add(Wwe),this._initDefaultMaterial(),this._initProgramLibrary(),this.stats=new Vve(o),this._soundManager=p,this.scene=new OM(o),this._registerSceneImmediate(this.scene),this.assets=new FM(this.loader),t&&(this.assets.prefix=t),this.bundles=new Rve(this.assets),this.scriptsOrder=d||[],this.defaultLayerWorld=new rd({name:"World",id:nl}),this.defaultLayerDepth=new rd({name:"Depth",id:As,enabled:!1,opaqueSortMode:ax}),this.defaultLayerSkybox=new rd({name:"Skybox",id:S3,opaqueSortMode:ax}),this.defaultLayerUi=new rd({name:"UI",id:LE,transparentSortMode:ime}),this.defaultLayerImmediate=new rd({name:"Immediate",id:x3,opaqueSortMode:ax});const _=new qU("default");_.pushOpaque(this.defaultLayerWorld),_.pushOpaque(this.defaultLayerDepth),_.pushOpaque(this.defaultLayerSkybox),_.pushTransparent(this.defaultLayerWorld),_.pushOpaque(this.defaultLayerImmediate),_.pushTransparent(this.defaultLayerImmediate),_.pushTransparent(this.defaultLayerUi),this.scene.layers=_,Eu.createPlaceholder(o),this.renderer=new Pge(o),this.renderer.scene=this.scene,c&&(this.lightmapper=new c(o,this.root,this.scene,this.renderer,this.assets),this.once("prerender",this._firstBake,this)),i&&(this._batcher=new i(o,this.root,this.scene),this.once("prerender",this._firstBatch,this)),this.keyboard=l||null,this.mouse=u||null,this.touch=m||null,this.gamepads=a||null,n&&(this.elementInput=n,this.elementInput.app=this),this.xr=g?new g(this):null,this.elementInput&&this.elementInput.attachSelectEvents(),this._scriptPrefix=f||"",this.enableBundles&&this.loader.addHandler("bundle",new Ove(this)),h.forEach(v=>{const y=new v(this);this.loader.addHandler(y.handlerType,y)}),s.forEach(v=>{this.systems.add(new v(this))}),this._visibilityChangeHandler=this.onVisibilityChange.bind(this),typeof document<"u"&&(document.hidden!==void 0?(this._hiddenAttr="hidden",document.addEventListener("visibilitychange",this._visibilityChangeHandler,!1)):document.mozHidden!==void 0?(this._hiddenAttr="mozHidden",document.addEventListener("mozvisibilitychange",this._visibilityChangeHandler,!1)):document.msHidden!==void 0?(this._hiddenAttr="msHidden",document.addEventListener("msvisibilitychange",this._visibilityChangeHandler,!1)):document.webkitHidden!==void 0&&(this._hiddenAttr="webkitHidden",document.addEventListener("webkitvisibilitychange",this._visibilityChangeHandler,!1))),this.tick=Xwe(this)}static getApplication(e){return e?_u._applications[e]:Xu()}_initDefaultMaterial(){const e=new Ns;e.name="Default Material",Cme(this.graphicsDevice,e)}_initProgramLibrary(){const e=new tve(this.graphicsDevice,new Ns);_me(this.graphicsDevice,e)}get soundManager(){return this._soundManager}get batcher(){return this._batcher}get fillMode(){return this._fillMode}get resolutionMode(){return this._resolutionMode}configure(e,t){qt.get(e,(i,s)=>{if(i){t(i);return}const n=s.application_properties,a=s.scenes,o=s.assets;this._parseApplicationProperties(n,l=>{this._parseScenes(a),this._parseAssets(o),t(l||null)})})}preload(e){this.fire("preload:start");const t=this.assets.list({preload:!0});if(t.length===0){this.fire("preload:end"),e();return}let i=0;const s=()=>{i++,this.fire("preload:progress",i/t.length),i===t.length&&(this.fire("preload:end"),e())};t.forEach(n=>{n.loaded?s():(n.once("load",s),n.once("error",s),this.assets.load(n))})}_preloadScripts(e,t){t()}_parseApplicationProperties(e,t){if(typeof e.maxAssetRetries=="number"&&e.maxAssetRetries>0&&this.loader.enableRetry(e.maxAssetRetries),e.useDevicePixelRatio||(e.useDevicePixelRatio=e.use_device_pixel_ratio),e.resolutionMode||(e.resolutionMode=e.resolution_mode),e.fillMode||(e.fillMode=e.fill_mode),this._width=e.width,this._height=e.height,e.useDevicePixelRatio&&(this.graphicsDevice.maxPixelRatio=window.devicePixelRatio),this.setCanvasResolution(e.resolutionMode,this._width,this._height),this.setCanvasFillMode(e.fillMode,this._width,this._height),e.layers&&e.layerOrder){const i=new qU("application"),s={};for(const n in e.layers){const a=e.layers[n];a.id=parseInt(n,10),a.enabled=a.id!==As,s[n]=new rd(a)}for(let n=0,a=e.layerOrder.length;n<a;n++){const o=e.layerOrder[n],l=s[o.layer];l&&(o.transparent?i.pushTransparent(l):i.pushOpaque(l),i.subLayerEnabled[n]=o.enabled)}this.scene.layers=i}if(e.batchGroups){const i=this.batcher;if(i)for(let s=0,n=e.batchGroups.length;s<n;s++){const a=e.batchGroups[s];i.addGroup(a.name,a.dynamic,a.maxAabbSize,a.id,a.layers)}}e.i18nAssets&&(this.i18n.assets=e.i18nAssets),this._loadLibraries(e.libraries,t)}_loadLibraries(e,t){const i=e.length;let s=i;const n=/^https?:\/\//;if(i){const a=(o,l)=>{s--,o?t(o):s===0&&(this.onLibrariesLoaded(),t(null))};for(let o=0;o<i;++o){let l=e[o];!n.test(l.toLowerCase())&&this._scriptPrefix&&(l=Ne.join(this._scriptPrefix,l)),this.loader.load(l,"script",a)}}else this.onLibrariesLoaded(),t(null)}_parseScenes(e){if(e)for(let t=0;t<e.length;t++)this.scenes.add(e[t].name,e[t].url)}_parseAssets(e){const t=[],i={},s={};for(let n=0;n<this.scriptsOrder.length;n++){const a=this.scriptsOrder[n];e[a]&&(i[a]=!0,t.push(e[a]))}if(this.enableBundles)for(const n in e)e[n].type==="bundle"&&(s[n]=!0,t.push(e[n]));for(const n in e)i[n]||s[n]||t.push(e[n]);for(let n=0;n<t.length;n++){const a=t[n],o=new be(a.name,a.type,a.file,a.data);if(o.id=parseInt(a.id,10),o.preload=a.preload?a.preload:!1,o.loaded=a.type==="script"&&a.data&&a.data.loadingType>0,o.tags.add(a.tags),a.i18n)for(const l in a.i18n)o.addLocalizedAssetId(l,a.i18n[l]);this.assets.add(o)}}start(){this.frame=0,this.fire("start",{timestamp:Qo(),target:this}),this._librariesLoaded||this.onLibrariesLoaded(),this.systems.fire("initialize",this.root),this.fire("initialize"),this.systems.fire("postInitialize",this.root),this.systems.fire("postPostInitialize",this.root),this.fire("postinitialize"),this.tick()}inputUpdate(e){this.controller&&this.controller.update(e),this.mouse&&this.mouse.update(),this.keyboard&&this.keyboard.update(),this.gamepads&&this.gamepads.update()}update(e){this.frame++,this.graphicsDevice.update(),this.systems.fire(this._inTools?"toolsUpdate":"update",e),this.systems.fire("animationUpdate",e),this.systems.fire("postUpdate",e),this.fire("update",e),this.inputUpdate(e)}render(){this.updateCanvasSize(),this.graphicsDevice.frameStart(),this.fire("prerender"),this.root.syncHierarchy(),this._batcher&&this._batcher.updateAll(),this.renderComposition(this.scene.layers),this.fire("postrender"),this.graphicsDevice.frameEnd()}renderComposition(e){this.renderer.update(e),this.renderer.buildFrameGraph(this.frameGraph,e),this.frameGraph.render(this.graphicsDevice)}_fillFrameStatsBasic(e,t,i){const s=this.stats.frame;s.dt=t,s.ms=i,e>s._timeToCountFrames?(s.fps=s._fpsAccum,s._fpsAccum=0,s._timeToCountFrames=e+1e3):s._fpsAccum++,this.stats.drawCalls.total=this.graphicsDevice._drawCallsPerFrame,this.graphicsDevice._drawCallsPerFrame=0}_fillFrameStats(){let e=this.stats.frame;e.cameras=this.renderer._camerasRendered,e.materials=this.renderer._materialSwitches,e.shaders=this.graphicsDevice._shaderSwitchesPerFrame,e.shadowMapUpdates=this.renderer._shadowMapUpdates,e.shadowMapTime=this.renderer._shadowMapTime,e.depthMapTime=this.renderer._depthMapTime,e.forwardTime=this.renderer._forwardTime;const t=this.graphicsDevice._primsPerFrame;e.triangles=t[Uo]/3+Math.max(t[wc]-2,0)+Math.max(t[zu]-2,0),e.cullTime=this.renderer._cullTime,e.sortTime=this.renderer._sortTime,e.skinTime=this.renderer._skinTime,e.morphTime=this.renderer._morphTime,e.lightClusters=this.renderer._lightClusters,e.lightClustersTime=this.renderer._lightClustersTime,e.otherPrimitives=0;for(let i=0;i<t.length;i++)i<Uo&&(e.otherPrimitives+=t[i]),t[i]=0;this.renderer._camerasRendered=0,this.renderer._materialSwitches=0,this.renderer._shadowMapUpdates=0,this.graphicsDevice._shaderSwitchesPerFrame=0,this.renderer._cullTime=0,this.renderer._layerCompositionUpdateTime=0,this.renderer._lightClustersTime=0,this.renderer._sortTime=0,this.renderer._skinTime=0,this.renderer._morphTime=0,this.renderer._shadowMapTime=0,this.renderer._depthMapTime=0,this.renderer._forwardTime=0,e=this.stats.drawCalls,e.forward=this.renderer._forwardDrawCalls,e.culled=this.renderer._numDrawCallsCulled,e.depth=0,e.shadow=this.renderer._shadowDrawCalls,e.skinned=this.renderer._skinDrawCalls,e.immediate=0,e.instanced=0,e.removedByInstancing=0,e.misc=e.total-(e.forward+e.shadow),this.renderer._depthDrawCalls=0,this.renderer._shadowDrawCalls=0,this.renderer._forwardDrawCalls=0,this.renderer._numDrawCallsCulled=0,this.renderer._skinDrawCalls=0,this.renderer._immediateRendered=0,this.renderer._instancedDrawCalls=0,this.stats.misc.renderTargetCreationTime=this.graphicsDevice.renderTargetCreationTime,e=this.stats.particles,e.updatesPerFrame=e._updatesPerFrame,e.frameTime=e._frameTime,e._updatesPerFrame=0,e._frameTime=0}setCanvasFillMode(e,t,i){this._fillMode=e,this.resizeCanvas(t,i)}setCanvasResolution(e,t,i){this._resolutionMode=e,e===NM&&t===void 0&&(t=this.graphicsDevice.canvas.clientWidth,i=this.graphicsDevice.canvas.clientHeight),this.graphicsDevice.resizeCanvas(t,i)}isHidden(){return document[this._hiddenAttr]}onVisibilityChange(){this.isHidden()?this._soundManager&&this._soundManager.suspend():this._soundManager&&this._soundManager.resume()}resizeCanvas(e,t){if(!this._allowResize||this.xr&&this.xr.session)return;const i=window.innerWidth,s=window.innerHeight;if(this._fillMode===yz){const n=this.graphicsDevice.canvas.width/this.graphicsDevice.canvas.height,a=i/s;n>a?(e=i,t=e/n):(t=s,e=t*n)}else this._fillMode===q9&&(e=i,t=s);return this.graphicsDevice.canvas.style.width=`${e}px`,this.graphicsDevice.canvas.style.height=`${t}px`,this.updateCanvasSize(),{width:e,height:t}}updateCanvasSize(){var e;if(!(!this._allowResize||(e=this.xr)!=null&&e.active)&&this._resolutionMode===NM){const t=this.graphicsDevice.canvas;this.graphicsDevice.resizeCanvas(t.clientWidth,t.clientHeight)}}onLibrariesLoaded(){this._librariesLoaded=!0,this.systems.rigidbody&&this.systems.rigidbody.onLibraryLoaded()}applySceneSettings(e){let t;if(this.systems.rigidbody&&typeof Ammo<"u"){const[i,s,n]=e.physics.gravity;this.systems.rigidbody.gravity.set(i,s,n)}this.scene.applySettings(e),e.render.hasOwnProperty("skybox")&&(e.render.skybox?(t=this.assets.get(e.render.skybox),t?this.setSkybox(t):this.assets.once(`add:${e.render.skybox}`,this.setSkybox,this)):this.setSkybox(null))}setAreaLightLuts(e,t){e&&t&&Eu.set(this.graphicsDevice,e,t)}setSkybox(e){if(e!==this._skyboxAsset){const t=()=>{this.setSkybox(null)},i=()=>{this.scene.setSkybox(this._skyboxAsset?this._skyboxAsset.resources:null)};this._skyboxAsset&&(this.assets.off(`load:${this._skyboxAsset.id}`,i,this),this.assets.off(`remove:${this._skyboxAsset.id}`,t,this),this._skyboxAsset.off("change",i,this)),this._skyboxAsset=e,this._skyboxAsset&&(this.assets.on(`load:${this._skyboxAsset.id}`,i,this),this.assets.once(`remove:${this._skyboxAsset.id}`,t,this),this._skyboxAsset.on("change",i,this),this.scene.skyboxMip===0&&!this._skyboxAsset.loadFaces&&(this._skyboxAsset.loadFaces=!0),this.assets.load(this._skyboxAsset)),i()}}_firstBake(){var e;(e=this.lightmapper)==null||e.bake(null,this.scene.lightmapMode)}_firstBatch(){var e;(e=this.batcher)==null||e.generate()}_processTimestamp(e){return e}drawLine(e,t,i,s,n){this.scene.drawLine(e,t,i,s,n)}drawLines(e,t,i=!0,s=this.scene.defaultDrawLayer){this.scene.drawLines(e,t,i,s)}drawLineArrays(e,t,i=!0,s=this.scene.defaultDrawLayer){this.scene.drawLineArrays(e,t,i,s)}drawWireSphere(e,t,i=ae.WHITE,s=20,n=!0,a=this.scene.defaultDrawLayer){this.scene.immediate.drawWireSphere(e,t,i,s,n,a)}drawWireAlignedBox(e,t,i=ae.WHITE,s=!0,n=this.scene.defaultDrawLayer,a){this.scene.immediate.drawWireAlignedBox(e,t,i,s,n,a)}drawMeshInstance(e,t=this.scene.defaultDrawLayer){this.scene.immediate.drawMesh(null,null,null,e,t)}drawMesh(e,t,i,s=this.scene.defaultDrawLayer){this.scene.immediate.drawMesh(t,i,e,null,s)}drawQuad(e,t,i=this.scene.defaultDrawLayer){this.scene.immediate.drawMesh(t,e,this.scene.immediate.getQuadMesh(),null,i)}drawTexture(e,t,i,s,n,a,o=this.scene.defaultDrawLayer,l=!0){if(l===!1&&!this.graphicsDevice.isWebGPU)return;const c=new se;c.setTRS(new O(e,t,0),de.IDENTITY,new O(i,-s,0)),a||(a=new nv,a.cull=Vi,a.setParameter("colorMap",n),a.shaderDesc=l?this.scene.immediate.getTextureShaderDesc(n.encoding):this.scene.immediate.getUnfilterableTextureShaderDesc(),a.update()),this.drawQuad(c,a,o)}drawDepthTexture(e,t,i,s,n=this.scene.defaultDrawLayer){const a=new nv;a.cull=Vi,a.shaderDesc=this.scene.immediate.getDepthTextureShaderDesc(),a.update(),this.drawTexture(e,t,i,s,null,a,n)}destroy(){var s,n,a,o;if(this._inFrameUpdate){this._destroyRequested=!0;return}const e=this.graphicsDevice.canvas.id;this.fire("destroy",this),this.off("librariesloaded"),typeof document<"u"&&(document.removeEventListener("visibilitychange",this._visibilityChangeHandler,!1),document.removeEventListener("mozvisibilitychange",this._visibilityChangeHandler,!1),document.removeEventListener("msvisibilitychange",this._visibilityChangeHandler,!1),document.removeEventListener("webkitvisibilitychange",this._visibilityChangeHandler,!1)),this._visibilityChangeHandler=null,this.root.destroy(),this.root=null,this.mouse&&(this.mouse.off(),this.mouse.detach(),this.mouse=null),this.keyboard&&(this.keyboard.off(),this.keyboard.detach(),this.keyboard=null),this.touch&&(this.touch.off(),this.touch.detach(),this.touch=null),this.elementInput&&(this.elementInput.detach(),this.elementInput=null),this.gamepads&&(this.gamepads.destroy(),this.gamepads=null),this.controller&&(this.controller=null),this.systems.destroy(),this.scene.layers&&this.scene.layers.destroy();const t=this.assets.list();for(let l=0;l<t.length;l++)t[l].unload(),t[l].off();this.assets.off(),this.bundles.destroy(),this.bundles=null,this.i18n.destroy(),this.i18n=null;const i=this.loader.getHandler("script");i==null||i.clearCache(),this.loader.destroy(),this.loader=null,this.scene.destroy(),this.scene=null,this.systems=null,this.context=null,this.scripts.destroy(),this.scripts=null,this.scenes.destroy(),this.scenes=null,(s=this.lightmapper)==null||s.destroy(),this.lightmapper=null,this._batcher&&(this._batcher.destroy(),this._batcher=null),this._entityIndex={},this.defaultLayerDepth.onDisable=null,this.defaultLayerDepth.onEnable=null,this.defaultLayerDepth=null,this.defaultLayerWorld=null,(n=this.xr)==null||n.end(),(a=this.xr)==null||a.destroy(),this.renderer.destroy(),this.renderer=null,this.graphicsDevice.destroy(),this.graphicsDevice=null,this.tick=null,this.off(),(o=this._soundManager)==null||o.destroy(),this._soundManager=null,_u._applications[e]=null,Xu()===this&&kM(null),_u.cancelTick(this)}static cancelTick(e){e.frameRequestId&&(window.cancelAnimationFrame(e.frameRequestId),e.frameRequestId=void 0)}getEntityFromIndex(e){return this._entityIndex[e]}_registerSceneImmediate(e){this.on("postrender",e.immediate.onPostRender,e.immediate)}};_u._applications={};let Ab=_u;const Xwe=function(r){const e=r;return function(t,i){var l,c,u,h;if(!e.graphicsDevice)return;e.frameRequestId&&((c=(l=e.xr)==null?void 0:l.session)==null||c.cancelAnimationFrame(e.frameRequestId),cancelAnimationFrame(e.frameRequestId),e.frameRequestId=null),e._inFrameUpdate=!0,kM(e);const s=e._processTimestamp(t)||Qo(),n=s-(e._time||s);let a=n/1e3;if(a=Q.clamp(a,0,e.maxDeltaTime),a*=e.timeScale,e._time=s,(u=e.xr)!=null&&u.session?e.frameRequestId=e.xr.session.requestAnimationFrame(e.tick):e.frameRequestId=Ye.browser||Ye.worker?requestAnimationFrame(e.tick):null,e.graphicsDevice.contextLost)return;e._fillFrameStatsBasic(s,a,n),e.fire("frameupdate",n);let o=!1;i?(o=!((h=e.xr)!=null&&h.update(i)),e.graphicsDevice.defaultFramebuffer=i.session.renderState.baseLayer.framebuffer):e.graphicsDevice.defaultFramebuffer=null,o||(e.update(a),e.fire("framerender"),(e.autoRender||e.renderNextFrame)&&(e.render(),e.renderNextFrame=!1),e.fire("frameend")),e._inFrameUpdate=!1,e._destroyRequested&&e.destroy()}};class qwe{constructor(){this.componentSystems=[],this.resourceHandlers=[]}}const rg=new AO;class eY{constructor(e,t,i){this.scene=e,this.light=t,this.store(),t.numCascades=1,this.scene.clusteredLightingEnabled&&!i.shadowsEnabled&&(t.castShadows=!1),t.type!==Me&&(t._node.getWorldTransform(),t.getBoundingSphere(rg),this.lightBounds=new We,this.lightBounds.center.copy(rg.center),this.lightBounds.halfExtents.set(rg.radius,rg.radius,rg.radius))}store(){this.mask=this.light.mask,this.shadowUpdateMode=this.light.shadowUpdateMode,this.enabled=this.light.enabled,this.intensity=this.light.intensity,this.rotation=this.light._node.getLocalRotation().clone(),this.numCascades=this.light.numCascades,this.castShadows=this.light._castShadows}restore(){const e=this.light;e.mask=this.mask,e.shadowUpdateMode=this.shadowUpdateMode,e.enabled=this.enabled,e.intensity=this.intensity,e._node.setLocalRotation(this.rotation),e.numCascades=this.numCascades,e._castShadows=this.castShadows}startBake(){this.light.enabled=!0,this.light._destroyShadowMap(),this.light.beginFrame()}endBake(e){const t=this.light;t.enabled=!1,t.shadowMap&&(t.shadowMap.cached&&e.add(t,t.shadowMap),t.shadowMap=null)}}const eS=new ee;class Ywe extends eY{constructor(e,t){super(e.scene,t,e.lightingParams)}get numVirtualLights(){return this.light.type===Me?this.light.bakeNumSamples:1}prepareVirtualLight(e,t){const i=this.light;if(i._node.setLocalRotation(this.rotation),e>0){const a=i.bakeArea;Ry.circlePointDeterministic(eS,e,t),eS.mulScalar(a*.5),i._node.rotateLocal(eS.x,0,eS.y)}i._node.getWorldTransform();const s=2.2,n=Math.pow(this.intensity,s);i.intensity=Math.pow(n/t,1/s)}}const Tz=new O;class Ez extends eY{constructor(e){const t=e.scene,i=new lt("AmbientLight");i.addComponent("light",{type:"directional",affectDynamic:!0,affectLightmapped:!1,bake:!0,bakeNumSamples:t.ambientBakeNumSamples,castShadows:!0,normalOffsetBias:.05,shadowBias:.2,shadowDistance:1,shadowResolution:2048,shadowType:Un,color:ae.WHITE,intensity:1,bakeDir:!1}),super(t,i.light.light,e.lightingParams)}get numVirtualLights(){return this.light.bakeNumSamples}prepareVirtualLight(e,t){Ry.spherePointDeterministic(Tz,e,t,0,this.scene.ambientBakeSpherePart),this.light._node.lookAt(Tz.mulScalar(-1)),this.light._node.rotateLocal(90,0,0);const i=2.2,s=2*Math.PI*this.scene.ambientBakeSpherePart,n=Math.pow(s,i);this.light.intensity=Math.pow(n/t,1/i)}}class tS{constructor(e,t=null){this.node=e,this.component=e.render||e.model,t=t||this.component.meshInstances,this.store(),this.meshInstances=t,this.bounds=null,this.renderTargets=[]}store(){this.castShadows=this.component.castShadows}restore(){this.component.castShadows=this.castShadows}}var Kwe=`
float normpdf3(in vec3 v, in float sigma) {
	return 0.39894 * exp(-0.5 * dot(v, v) / (sigma * sigma)) / sigma;
}
vec3 decodeRGBM(vec4 rgbm) {
	vec3 color = (8.0 * rgbm.a) * rgbm.rgb;
	return color * color;
}
float saturate(float x) {
	return clamp(x, 0.0, 1.0);
}
vec4 encodeRGBM(vec3 color) {
	vec4 encoded;
	encoded.rgb = pow(color.rgb, vec3(0.5));
	encoded.rgb *= 1.0 / 8.0;
	encoded.a = saturate( max( max( encoded.r, encoded.g ), max( encoded.b, 1.0 / 255.0 ) ) );
	encoded.a = ceil(encoded.a * 255.0) / 255.0;
	encoded.rgb /= encoded.a;
	return encoded;
}
vec3 decode(vec4 pixel) {
	#if HDR
		return pixel.rgb;
	#else
		return decodeRGBM(pixel);
	#endif
}
bool isUsed(vec4 pixel) {
	#if HDR
		return any(greaterThan(pixel.rgb, vec3(0.0)));
	#else
		return pixel.a > 0.0;
	#endif
}
varying vec2 vUv0;
uniform sampler2D source;
uniform vec2 pixelOffset;
uniform vec2 sigmas;
uniform float bZnorm;
uniform float kernel[{MSIZE}];
void main(void) {
	
	vec4 pixel = texture2DLod(source, vUv0, 0.0);
	if (!isUsed(pixel)) {
		gl_FragColor = pixel;
		return ;
	}
	float sigma = sigmas.x;
	float bSigma = sigmas.y;
	vec3 pixelHdr = decode(pixel);
	vec3 accumulatedHdr = vec3(0.0);
	float accumulatedFactor = 0.000001;
	const int kSize = ({MSIZE} - 1) / 2;
	for (int i = -kSize; i <= kSize; ++i) {
		for (int j = -kSize; j <= kSize; ++j) {
			
			vec2 coord = vUv0 + vec2(float(i), float(j)) * pixelOffset;
			vec4 pix = texture2DLod(source, coord, 0.0);
			if (isUsed(pix)) {
				vec3 hdr = decode(pix);
				float factor = kernel[kSize + j] * kernel[kSize + i];
				factor *= normpdf3(hdr - pixelHdr, bSigma) * bZnorm;
				accumulatedHdr += factor * hdr;
				accumulatedFactor += factor;
			}
		}
	}
	vec3 finalHDR = accumulatedHdr / accumulatedFactor;
	#if HDR
		gl_FragColor = vec4(finalHDR, 1.0);
	#else
		gl_FragColor = encodeRGBM(finalHDR);
	#endif
}
`,Zwe=`
varying vec2 vUv0;
uniform sampler2D source;
uniform vec2 pixelOffset;
bool isUsed(vec4 pixel) {
	#if HDR
		return any(greaterThan(pixel.rgb, vec3(0.0)));
	#else
		return pixel.a > 0.0;
	#endif
}
void main(void) {
	vec4 c = texture2DLod(source, vUv0, 0.0);
	c = isUsed(c) ? c : texture2DLod(source, vUv0 - pixelOffset, 0.0);
	c = isUsed(c) ? c : texture2DLod(source, vUv0 + vec2(0, -pixelOffset.y), 0.0);
	c = isUsed(c) ? c : texture2DLod(source, vUv0 + vec2(pixelOffset.x, -pixelOffset.y), 0.0);
	c = isUsed(c) ? c : texture2DLod(source, vUv0 + vec2(-pixelOffset.x, 0), 0.0);
	c = isUsed(c) ? c : texture2DLod(source, vUv0 + vec2(pixelOffset.x, 0), 0.0);
	c = isUsed(c) ? c : texture2DLod(source, vUv0 + vec2(-pixelOffset.x, pixelOffset.y), 0.0);
	c = isUsed(c) ? c : texture2DLod(source, vUv0 + vec2(0, pixelOffset.y), 0.0);
	c = isUsed(c) ? c : texture2DLod(source, vUv0 + pixelOffset, 0.0);
	gl_FragColor = c;
}
`,Qwe=`
fn normpdf3(v: vec3f, sigma: f32) -> f32 {
	return 0.39894 * exp(-0.5 * dot(v, v) / (sigma * sigma)) / sigma;
}
fn decodeRGBM(rgbm: vec4f) -> vec3f {
	let color = (8.0 * rgbm.a) * rgbm.rgb;
	return color * color;
}
fn saturate(x: f32) -> f32 {
	return clamp(x, 0.0, 1.0);
}
fn encodeRGBM(color: vec3f) -> vec4f {
	var encoded: vec4f;
	let rgb_processed = pow(color.rgb, vec3f(0.5)) * (1.0 / 8.0);
	encoded = vec4f(rgb_processed, 0.0);
	let max_g_b = max( encoded.g, max( encoded.b, 1.0 / 255.0 ) );
	let max_rgb = max( encoded.r, max_g_b );
	encoded.a = clamp(max_rgb, 0.0, 1.0);
	encoded.a = ceil(encoded.a * 255.0) / 255.0;
	encoded = vec4f(encoded.rgb / encoded.a, encoded.a);
	return encoded;
}
fn decode(pixel: vec4f) -> vec3f {
	#if HDR
		return pixel.rgb;
	#else
		return decodeRGBM(pixel);
	#endif
}
fn isUsed(pixel: vec4f) -> bool {
	#if HDR
		return any(pixel.rgb > vec3f(0.0));
	#else
		return pixel.a > 0.0;
	#endif
}
varying vUv0: vec2f;
var source: texture_2d<f32>;
var sourceSampler: sampler;
uniform kernel: array<f32, {MSIZE}>;
uniform pixelOffset: vec2f;
uniform sigmas: vec2f;
uniform bZnorm: f32;
@fragment
fn fragmentMain(input: FragmentInput) -> FragmentOutput {
	var output: FragmentOutput;
	let pixel = textureSampleLevel(source, sourceSampler, input.vUv0, 0.0);
	if (!isUsed(pixel)) {
		output.color = pixel;
		return output;
	}
	let sigma = uniform.sigmas.x;
	let bSigma = uniform.sigmas.y;
	let pixelHdr = decode(pixel);
	var accumulatedHdr = vec3f(0.0);
	var accumulatedFactor = 0.000001;
	const kSize = ({MSIZE} - 1) / 2;
	for (var i: i32 = -kSize; i <= kSize; i = i + 1) {
		for (var j: i32 = -kSize; j <= kSize; j = j + 1) {
			let coord = input.vUv0 + vec2f(f32(i), f32(j)) * uniform.pixelOffset;
			let pix = textureSampleLevel(source, sourceSampler, coord, 0.0);
			if (isUsed(pix)) {
				let hdr = decode(pix);
				var factor = uniform.kernel[u32(kSize + j)].element * uniform.kernel[u32(kSize + i)].element;
				factor = factor * normpdf3(hdr - pixelHdr, bSigma) * uniform.bZnorm;
				accumulatedHdr = accumulatedHdr + factor * hdr;
				accumulatedFactor = accumulatedFactor + factor;
			}
		}
	}
	let finalHDR = accumulatedHdr / accumulatedFactor;
	#if HDR
		output.color = vec4f(finalHDR, 1.0);
	#else
		output.color = encodeRGBM(finalHDR);
	#endif
	return output;
}
`,Jwe=`
varying vUv0: vec2f;
var source: texture_2d<f32>;
var sourceSampler: sampler;
uniform pixelOffset: vec2f;
fn isUsed(pixel: vec4f) -> bool {
	#ifdef HDR
		return any(pixel.rgb > vec3f(0.0));
	#else
		return pixel.a > 0.0;
	#endif
}
@fragment
fn fragmentMain(input: FragmentInput) -> FragmentOutput {
	var c: vec4f = textureSampleLevel(source, sourceSampler, input.vUv0, 0.0);
	c = select(textureSampleLevel(source, sourceSampler, input.vUv0 - uniform.pixelOffset, 0.0), c, isUsed(c));
	c = select(textureSampleLevel(source, sourceSampler, input.vUv0 + vec2f(0.0, -uniform.pixelOffset.y), 0.0), c, isUsed(c));
	c = select(textureSampleLevel(source, sourceSampler, input.vUv0 + vec2f(uniform.pixelOffset.x, -uniform.pixelOffset.y), 0.0), c, isUsed(c));
	c = select(textureSampleLevel(source, sourceSampler, input.vUv0 + vec2f(-uniform.pixelOffset.x, 0.0), 0.0), c, isUsed(c));
	c = select(textureSampleLevel(source, sourceSampler, input.vUv0 + vec2f(uniform.pixelOffset.x, 0.0), 0.0), c, isUsed(c));
	c = select(textureSampleLevel(source, sourceSampler, input.vUv0 + vec2f(-uniform.pixelOffset.x, uniform.pixelOffset.y), 0.0), c, isUsed(c));
	c = select(textureSampleLevel(source, sourceSampler, input.vUv0 + vec2f(0.0, uniform.pixelOffset.y), 0.0), c, isUsed(c));
	c = select(textureSampleLevel(source, sourceSampler, input.vUv0 + uniform.pixelOffset, 0.0), c, isUsed(c));
	var output: FragmentOutput;
	output.color = c;
	return output;
}
`;const Az=15,eTe={glslBilateralDeNoisePS:Kwe,glslDilatePS:Zwe},tTe={wgslBilateralDeNoisePS:Qwe,wgslDilatePS:Jwe};class iTe{constructor(e){this.shaderDilate=[],this.shaderDenoise=[],this.device=e,$e.get(this.device,dt).add(eTe),$e.get(this.device,Gt).add(tTe),this.constantTexSource=e.scope.resolve("source"),this.constantPixelOffset=e.scope.resolve("pixelOffset"),this.pixelOffset=new Float32Array(2),this.sigmas=null,this.constantSigmas=null,this.kernel=null}setSourceTexture(e){this.constantTexSource.setValue(e)}prepare(e,t){this.pixelOffset[0]=1/e,this.pixelOffset[1]=1/t,this.constantPixelOffset.setValue(this.pixelOffset)}prepareDenoise(e,t,i){const s=i?0:1;if(!this.shaderDenoise[s]){const n=new Map;n.set("{MSIZE}",15),i&&n.set("HDR",""),this.shaderDenoise[s]=Tr.createShader(this.device,{uniqueName:`lmBilateralDeNoise-${i?"hdr":"rgbm"}`,attributes:{vertex_position:Xe},vertexGLSL:$e.get(this.device,dt).get("fullscreenQuadVS"),vertexWGSL:$e.get(this.device,Gt).get("fullscreenQuadVS"),fragmentGLSL:$e.get(this.device,dt).get("glslBilateralDeNoisePS"),fragmentWGSL:$e.get(this.device,Gt).get("wgslBilateralDeNoisePS"),fragmentDefines:n}),this.sigmas=new Float32Array(2),this.constantSigmas=this.device.scope.resolve("sigmas"),this.constantKernel=this.device.scope.resolve("kernel[0]"),this.bZnorm=this.device.scope.resolve("bZnorm")}this.sigmas[0]=e,this.sigmas[1]=t,this.constantSigmas.setValue(this.sigmas),this.evaluateDenoiseUniforms(e,t)}getDenoise(e){const t=e?0:1;return this.shaderDenoise[t]}getDilate(e,t){const i=t?0:1;if(!this.shaderDilate[i]){const s=t?`#define HDR
`:"";this.shaderDilate[i]=Tr.createShader(e,{uniqueName:`lmDilate-${t?"hdr":"rgbm"}`,attributes:{vertex_position:Xe},vertexGLSL:$e.get(this.device,dt).get("fullscreenQuadVS"),vertexWGSL:$e.get(this.device,Gt).get("fullscreenQuadVS"),fragmentGLSL:s+$e.get(this.device,dt).get("glslDilatePS"),fragmentWGSL:s+$e.get(this.device,Gt).get("wgslDilatePS")})}return this.shaderDilate[i]}evaluateDenoiseUniforms(e,t){function i(o,l){return .39894*Math.exp(-.5*o*o/(l*l))/l}this.kernel=this.kernel||new Float32Array(Az);const s=this.kernel,n=Math.floor((Az-1)/2);for(let o=0;o<=n;++o){const l=i(o,e);s[n+o]=l,s[n-o]=l}this.constantKernel.setValue(this.kernel);const a=1/i(0,t);this.bZnorm.setValue(a)}}class rTe extends dn{constructor(e,t,i,s,n,a){super(e),this.viewBindGroups=[],this.renderer=t,this.camera=i,this.worldClusters=s,this.receivers=n,this.lightArray=a}destroy(){this.viewBindGroups.forEach(e=>{e.defaultUniformBuffer.destroy(),e.destroy()}),this.viewBindGroups.length=0}execute(){this.device;const{renderer:e,camera:t,receivers:i,renderTarget:s,worldClusters:n,lightArray:a}=this;e.renderForwardLayer(t,s,null,void 0,Nh,this.viewBindGroups,{meshInstances:i,splitLights:a,lightClusters:n})}}const sTe=2048,nTe=0,aTe=1,iS=new O;class oTe{constructor(e,t,i,s,n){this.device=e,this.root=t,this.scene=i,this.renderer=s,this.assets=n,this.shadowMapCache=s.shadowMapCache,this._tempSet=new Set,this._initCalled=!1,this.passMaterials=[],this.ambientAOMaterial=null,this.fog="",this.ambientLight=new ae,this.renderTargets=new Map,this.stats={renderPasses:0,lightmapCount:0,totalRenderTime:0,forwardTime:0,fboTime:0,shadowMapTime:0,compileTime:0,shadersLinked:0}}destroy(){var e;wa.decRef(this.blackTex),this.blackTex=null,wa.destroy(),this.device=null,this.root=null,this.scene=null,this.renderer=null,this.assets=null,(e=this.camera)==null||e.destroy(),this.camera=null}initBake(e){if(this.bakeHDR=this.scene.lightmapPixelFormat!==ct,!this._initCalled){this._initCalled=!0,this.lightmapFilters=new iTe(e),this.constantBakeDir=e.scope.resolve("bakeDir"),this.materials=[],this.blackTex=new we(this.device,{width:4,height:4,format:ct,type:ch,name:"lightmapBlack"}),wa.incRef(this.blackTex);const t=new Iy;t.clearColor.set(0,0,0,0),t.clearColorBuffer=!0,t.clearDepthBuffer=!1,t.clearStencilBuffer=!1,t.frustumCulling=!1,t.projection=Mf,t.aspectRatio=1,t.node=new Xt,this.camera=t,this.camera.shaderParams.gammaCorrection=Ay,this.camera.shaderParams.toneMapping=A3}if(this.scene.clusteredLightingEnabled){const t=new k9(e.supportsAreaLights,e.maxTextureSize,()=>{});this.lightingParams=t;const i=this.scene.lighting;t.shadowsEnabled=i.shadowsEnabled,t.shadowAtlasResolution=i.shadowAtlasResolution,t.cookiesEnabled=i.cookiesEnabled,t.cookieAtlasResolution=i.cookieAtlasResolution,t.areaLightsEnabled=i.areaLightsEnabled,t.cells=new O(3,3,3),t.maxLightsPerCell=4,this.worldClusters=new IM(e),this.worldClusters.name="ClusterLightmapper"}}finishBake(e){this.materials=[];function t(i){wa.decRef(i.colorBuffer),i.destroy()}this.renderTargets.forEach(i=>{t(i)}),this.renderTargets.clear(),e.forEach(i=>{i.renderTargets.forEach(s=>{t(s)}),i.renderTargets.length=0}),this.ambientAOMaterial=null,this.worldClusters&&(this.worldClusters.destroy(),this.worldClusters=null)}createMaterialForPass(e,t,i){const s=new Ns;return s.name=`lmMaterial-pass:${t}-ambient:${i}`,s.setDefine("UV1LAYOUT",""),s.setDefine("LIT_LIGHTMAP_BAKING",""),t===nTe?(s.setDefine("LIT_LIGHTMAP_BAKING_COLOR",""),i?s.setDefine("LIT_LIGHTMAP_BAKING_ADD_AMBIENT",""):s.ambient=new ae(0,0,0),this.bakeHDR||s.setDefine("LIGHTMAP_RGBM",""),s.lightMap=this.blackTex):(s.setDefine("LIT_LIGHTMAP_BAKING_DIR",""),s.setDefine("STD_LIGHTMAP_DIR","")),s.cull=Vi,s.forceUv1=!0,s.update(),s}createMaterials(e,t,i){for(let s=0;s<i;s++)this.passMaterials[s]||(this.passMaterials[s]=this.createMaterialForPass(t,s,!1));this.ambientAOMaterial||(this.ambientAOMaterial=this.createMaterialForPass(t,0,!0),this.ambientAOMaterial.onUpdateShader=function(s){return s.litOptions.lightMapWithoutAmbient=!0,s.litOptions.separateAmbient=!0,s})}createTexture(e,t){return new we(this.device,{width:e,height:e,format:this.scene.lightmapPixelFormat,mipmaps:!1,type:this.bakeHDR?qa:ch,minFilter:qe,magFilter:qe,addressU:ge,addressV:ge,name:t})}collectModels(e,t,i){var n,a,o;if(!e.enabled)return;let s;if((n=e.model)!=null&&n.model&&((a=e.model)!=null&&a.enabled)&&(i&&i.push(new tS(e)),e.model.lightmapped&&t&&(s=e.model.model.meshInstances)),(o=e.render)!=null&&o.enabled&&(i&&i.push(new tS(e)),e.render.lightmapped&&t&&(s=e.render.meshInstances)),s){let l=!0;for(let c=0;c<s.length;c++)if(!s[c].mesh.vertexBuffer.format.hasUv1){l=!1;break}if(l){const c=[];for(let u=0;u<s.length;u++){const h=s[u].mesh;this._tempSet.has(h)?t.push(new tS(e,[s[u]])):c.push(s[u]),this._tempSet.add(h)}this._tempSet.clear(),c.length>0&&t.push(new tS(e,c))}}for(let l=0;l<e._children.length;l++)this.collectModels(e._children[l],t,i)}prepareShadowCasters(e){const t=[];for(let i=0;i<e.length;i++){const s=e[i].component;if(s.castShadows=s.castShadowsLightmap,s.castShadowsLightmap){const n=e[i].meshInstances;for(let a=0;a<n.length;a++)n[a].visibleThisFrame=!0,t.push(n[a])}}return t}updateTransforms(e){for(let t=0;t<e.length;t++){const i=e[t].meshInstances;for(let s=0;s<i.length;s++)i[s].node.getWorldTransform()}}calculateLightmapSize(e){let t;const i=this.scene.lightmapSizeMultiplier||16,s=iS;let n,a;e.model?(a=e.model.lightmapSizeMultiplier,e.model.asset?(t=this.assets.get(e.model.asset).data,t.area&&(n=t.area)):e.model._area&&(t=e.model,t._area&&(n=t._area))):e.render&&(a=e.render.lightmapSizeMultiplier,e.render.type!=="asset"&&e.render._area&&(t=e.render,t._area&&(n=t._area)));const o={x:1,y:1,z:1,uv:1};n&&(o.x=n.x,o.y=n.y,o.z=n.z,o.uv=n.uv);const l=a||1;o.x*=l,o.y*=l,o.z*=l;const c=e.render||e.model,u=this.computeNodeBounds(c.meshInstances);s.copy(u.halfExtents);let h=o.x*s.y*s.z+o.y*s.x*s.z+o.z*s.x*s.y;return h/=o.uv,h=Math.sqrt(h),Math.min(Q.nextPowerOfTwo(h*i),this.scene.lightmapMaxResolution||sTe)}setLightmapping(e,t,i,s){for(let n=0;n<e.length;n++){const a=e[n],o=a.meshInstances;for(let l=0;l<o.length;l++){const c=o[l];if(c.setLightmapped(t),t){s&&(c._shaderDefs|=s),c.mask=ph;for(let u=0;u<i;u++){const h=a.renderTargets[u].colorBuffer;h.minFilter=_i,h.magFilter=_i,c.setRealtimeLightmap(Dt.lightmapParamNames[u],h)}}}}}bake(e,t=nx){const i=this.device,s=Qo();this.scene._updateSkyMesh(),this.stats.renderPasses=0,this.stats.shadowMapTime=0,this.stats.forwardTime=0;const n=i._shaderStats.linked,a=i._renderTargetCreationTime,o=i._shaderStats.compileTime,l=[],c=[];if(e){for(let h=0;h<e.length;h++)this.collectModels(e[h],l,null);this.collectModels(this.root,null,c)}else this.collectModels(this.root,l,c);if(l.length>0){this.renderer.shadowRenderer.frameUpdate();const h=t===nx?2:1;this.setLightmapping(l,!1,h),this.initBake(i),this.bakeInternal(h,l,c);let d=AM;t===nx&&(d|=T9),this.scene.ambientBake&&(d|=E9),this.setLightmapping(l,!0,h,d),this.finishBake(l)}const u=Qo();this.stats.totalRenderTime=u-s,this.stats.shadersLinked=i._shaderStats.linked-n,this.stats.compileTime=i._shaderStats.compileTime-o,this.stats.fboTime=i._renderTargetCreationTime-a,this.stats.lightmapCount=l.length}allocateTextures(e,t){for(let i=0;i<e.length;i++){const s=e[i],n=this.calculateLightmapSize(s.node);for(let a=0;a<t;a++){const o=this.createTexture(n,`lightmapper_lightmap_${i}`);wa.incRef(o),s.renderTargets[a]=new Zi({colorBuffer:o,depth:!1})}if(!this.renderTargets.has(n)){const a=this.createTexture(n,`lightmapper_temp_lightmap_${n}`);wa.incRef(a),this.renderTargets.set(n,new Zi({colorBuffer:a,depth:!1}))}}}prepareLightsToBake(e,t){if(this.scene.ambientBake){const s=new Ez(this);t.push(s)}const i=this.renderer.lights;for(let s=0;s<i.length;s++){const n=i[s],a=new Ywe(this,n);e.push(a),n.enabled&&n.mask&Wu&&(n.mask=Wu|ph|Zn,n.shadowUpdateMode=n.type===Me?O3:pc,t.push(a))}t.sort()}restoreLights(e){for(let t=0;t<e.length;t++)e[t].restore()}setupScene(){this.ambientLight.copy(this.scene.ambientLight),this.scene.ambientBake||this.scene.ambientLight.set(0,0,0),this.renderer.setSceneConstants(),this.device.scope.resolve("ambientBakeOcclusionContrast").setValue(this.scene.ambientBakeOcclusionContrast),this.device.scope.resolve("ambientBakeOcclusionBrightness").setValue(this.scene.ambientBakeOcclusionBrightness)}restoreScene(){this.scene.ambientLight.copy(this.ambientLight)}computeNodeBounds(e){const t=new We;if(e.length>0){t.copy(e[0].aabb);for(let i=1;i<e.length;i++)t.add(e[i].aabb)}return t}computeNodesBounds(e){for(let t=0;t<e.length;t++){const i=e[t].meshInstances;e[t].bounds=this.computeNodeBounds(i)}}computeBounds(e){const t=new We;for(let i=0;i<e.length;i++){t.copy(e[0].aabb);for(let s=1;s<e.length;s++)t.add(e[s].aabb)}return t}backupMaterials(e){for(let t=0;t<e.length;t++)this.materials[t]=e[t].material}restoreMaterials(e){for(let t=0;t<e.length;t++)e[t].material=this.materials[t]}lightCameraPrepare(e,t){const i=t.light;let s;return i.type===Rt&&(s=i.getRenderData(null,0).shadowCamera,s._node.setPosition(i._node.getPosition()),s._node.setRotation(i._node.getRotation()),s._node.rotateLocal(-90,0,0),s.projection=ba,s.nearClip=i.attenuationEnd/1e3,s.farClip=i.attenuationEnd,s.aspectRatio=1,s.fov=i._outerConeAngle*2,this.renderer.updateCameraFrustum(s)),s}lightCameraPrepareAndCull(e,t,i,s){const n=e.light;let a=!0;if(n.type===Me){iS.copy(s.center),iS.y+=s.halfExtents.y,this.camera.node.setPosition(iS),this.camera.node.setEulerAngles(-90,0,0),this.camera.nearClip=0,this.camera.farClip=s.halfExtents.y*2;const o=Math.max(s.halfExtents.x,s.halfExtents.z);this.camera.orthoHeight=o}else e.lightBounds.intersects(t.bounds)||(a=!1);if(n.type===Rt){let o=!1;const l=t.meshInstances;for(let c=0;c<l.length;c++)if(l[c]._isVisible(i)){o=!0;break}o||(a=!1)}return a}setupLightArray(e,t){e[Me].length=0,e[Pt].length=0,e[Rt].length=0,e[t.type][0]=t,t.visibleThisFrame=!0}renderShadowMap(e,t,i,s){const n=s.light,a=this.scene.clusteredLightingEnabled,o=n.castShadows&&(!a||this.scene.lighting.shadowsEnabled);if(!t&&o)if(!n.shadowMap&&!a&&(n.shadowMap=this.shadowMapCache.get(this.device,n)),n.type===Me){this.renderer._shadowRendererDirectional.cull(n,e,this.camera,i);const l=this.renderer._shadowRendererDirectional.getLightRenderPass(n,this.camera);l==null||l.render()}else{if(this.device.isWebGPU)return!0;this.renderer._shadowRendererLocal.cull(n,e,i),this.renderer.shadowRenderer.render(n,this.camera,!1)}return!0}postprocessTextures(e,t,i){const n=this.lightmapFilters.getDilate(e,this.bakeHDR);let a;const o=this.scene.lightmapFilterEnabled;o&&(this.lightmapFilters.prepareDenoise(this.scene.lightmapFilterRange,this.scene.lightmapFilterSmoothness,this.bakeHDR),a=this.lightmapFilters.getDenoise(this.bakeHDR)),e.setBlendState(sr.NOBLEND),e.setDepthState(Ds.NODEPTH),e.setStencilState(null,null);for(let l=0;l<t.length;l++){const c=t[l];for(let u=0;u<i;u++){const h=c.renderTargets[u],d=h.colorBuffer,f=this.renderTargets.get(d.width),p=f.colorBuffer;this.lightmapFilters.prepare(d.width,d.height);for(let m=0;m<1;m++)this.lightmapFilters.setSourceTexture(d),Tc(e,f,o&&u===0&&m===0?a:n),this.lightmapFilters.setSourceTexture(p),Tc(e,h,n)}}}bakeInternal(e,t,i){const s=this.scene,n=s.layers,a=this.device,o=s.clusteredLightingEnabled;this.createMaterials(a,s,e),this.setupScene(),n._update(),this.computeNodesBounds(t),this.allocateTextures(t,e),this.renderer.collectLights(n);const l=[],c=[];this.prepareLightsToBake(l,c),this.updateTransforms(i);const u=this.prepareShadowCasters(i);this.renderer.updateCpuSkinMatrices(u),this.renderer.gpuUpdate(u);const h=this.computeBounds(u);let d,f,p,m;for(d=0;d<t.length;d++)for(p=t[d].meshInstances,f=0;f<p.length;f++)m=p[f],m.setLightmapped(!1),m.mask=Wu,m.setRealtimeLightmap(Dt.lightmapParamNames[0],this.blackTex),m.setRealtimeLightmap(Dt.lightmapParamNames[1],this.blackTex);for(f=0;f<c.length;f++)c[f].light.enabled=!1;const g=[[],[],[]];let _,v,y=!1;for(d=0;d<c.length;d++){const x=c[d],S=x instanceof Ez,w=x.light.type===Me;let T=x.numVirtualLights;e>1&&T>1&&x.light.bakeDir&&(T=1);for(let A=0;A<T;A++){T>1&&x.prepareVirtualLight(A,T),x.startBake();let C=!1;const P=this.lightCameraPrepare(a,x);for(v=0;v<t.length;v++){const I=t[v];if(p=I.meshInstances,!this.lightCameraPrepareAndCull(x,I,P,h))continue;this.setupLightArray(g,x.light);const N=w?[]:[x.light];for(o&&this.renderer.lightTextureAtlas.update(N,this.lightingParams),C=this.renderShadowMap(n,C,u,x),o&&this.worldClusters.update(N,this.lightingParams),this.backupMaterials(p),_=0;_<e&&!(_>0&&A>0||S&&_>0);_++){const k=I.renderTargets[_],V=I.renderTargets[_].colorBuffer.width,B=this.renderTargets.get(V),R=B.colorBuffer;_===0?y=s.updateShaders:y&&(s.updateShaders=!0);let L=this.passMaterials[_];for(S&&A+1===T&&_===0&&(L=this.ambientAOMaterial),f=0;f<p.length;f++)p[f].material=L;if(this.renderer.updateShaders(p),_===aTe&&this.constantBakeDir.setValue(x.light.bakeDir?1:0),a.isWebGPU){const D=new rTe(a,this.renderer,this.camera,o?this.worldClusters:null,p,g);D.init(B),D.render(),D.destroy()}else this.renderer.setCamera(this.camera,B,!0),o&&this.worldClusters.activate(),this.renderer._forwardTime=0,this.renderer._shadowMapTime=0,this.renderer.renderForward(this.camera,B,p,g,Nh),a.updateEnd();for(I.renderTargets[_]=B,this.renderTargets.set(V,k),f=0;f<p.length;f++)m=p[f],m.setRealtimeLightmap(Dt.lightmapParamNames[_],R),m._shaderDefs|=AM}this.restoreMaterials(p)}x.endBake(this.shadowMapCache)}}for(this.postprocessTextures(a,t,e),v=0;v<i.length;v++)i[v].restore();this.restoreLights(l),this.restoreScene(),o||this.shadowMapCache.clear()}}const aT=class aT extends Te{constructor(e,t){super(),this.system=e,this.entity=t,this.system.schema&&!this._accessorsBuilt&&this.buildAccessors(this.system.schema),this.on("set",function(i,s,n){this.fire(`set_${i}`,i,s,n)}),this.on("set_enabled",this.onSetEnabled,this)}static _buildAccessors(e,t){t.forEach(i=>{const s=typeof i=="object"?i.name:i;Object.defineProperty(e,s,{get:function(){return this.data[s]},set:function(n){const a=this.data,o=a[s];a[s]=n,this.fire("set",s,o,n)},configurable:!0})}),e._accessorsBuilt=!0}buildAccessors(e){aT._buildAccessors(this,e)}onSetEnabled(e,t,i){t!==i&&this.entity.enabled&&(i?this.onEnable():this.onDisable())}onEnable(){}onDisable(){}onPostStateChange(){}get data(){const e=this.system.store[this.entity.getGuid()];return e?e.data:null}set enabled(e){}get enabled(){return!0}};aT.order=0;let ke=aT;class si extends Te{constructor(e){super(),this.app=e,this.store={},this.schema=[]}addComponent(e,t={}){const i=new this.ComponentType(this,e),s=new this.DataType;return this.store[e.getGuid()]={entity:e,data:s},e[this.id]=i,e.c[this.id]=i,this.initializeComponentData(i,t,[]),this.fire("add",e,i),i}removeComponent(e){const t=this.id,i=this.store[e.getGuid()],s=e.c[t];s.fire("beforeremove"),this.fire("beforeremove",e,s),delete this.store[e.getGuid()],e[t]=void 0,delete e.c[t],this.fire("remove",e,i.data)}cloneComponent(e,t){const i=this.store[e.getGuid()];return this.addComponent(t,i.data)}initializeComponentData(e,t={},i){for(let s=0,n=i.length;s<n;s++){const a=i[s];let o,l;typeof a=="object"?(o=a.name,l=a.type):(o=a,l=void 0);let c=t[o];c!==void 0?(l!==void 0&&(c=lTe(c,l)),e[o]=c):e[o]=e.data[o]}e.enabled&&e.entity.enabled&&e.onEnable()}getPropertiesOfType(e){const t=[];return(this.schema||[]).forEach(s=>{s&&typeof s=="object"&&s.type===e&&t.push(s)}),t}destroy(){this.off()}}function lTe(r,e){if(!r)return r;switch(e){case"rgb":return r instanceof ae?r.clone():new ae(r[0],r[1],r[2]);case"rgba":return r instanceof ae?r.clone():new ae(r[0],r[1],r[2],r[3]);case"vec2":return r instanceof ee?r.clone():new ee(r[0],r[1]);case"vec3":return r instanceof O?r.clone():new O(r[0],r[1],r[2]);case"vec4":return r instanceof ce?r.clone():new ce(r[0],r[1],r[2],r[3]);case"boolean":case"number":case"string":return r;case"entity":return r;default:throw new Error(`Could not convert unhandled type: ${e}`)}}const tY=0,UM=1,zM=2;class cTe{constructor(){this._left=1/0,this._right=-1/0,this._len=0,this._recip=0,this._p0=0,this._p1=0,this._t=0,this._hermite={valid:!1,p0:0,m0:0,p1:0,m1:0}}update(e,t){if(e<this._left||e>=this._right){const i=t.length;if(!i)this._left=-1/0,this._right=1/0,this._len=0,this._recip=0,this._p0=this._p1=0;else if(e<t[0])this._left=-1/0,this._right=t[0],this._len=0,this._recip=0,this._p0=this._p1=0;else if(e>=t[i-1])this._left=t[i-1],this._right=1/0,this._len=0,this._recip=0,this._p0=this._p1=i-1;else{const s=this._findKey(e,t);this._left=t[s],this._right=t[s+1],this._len=this._right-this._left;const n=1/this._len;this._recip=isFinite(n)?n:0,this._p0=s,this._p1=s+1}}this._t=this._recip===0?0:(e-this._left)*this._recip,this._hermite.valid=!1}_findKey(e,t){let i=0;for(;e>=t[i+1];)i++;return i}eval(e,t,i){const s=i._data,n=i._components,a=this._p0*n;if(t===tY)for(let o=0;o<n;++o)e[o]=s[a+o];else{const o=this._t,l=this._p1*n;switch(t){case UM:for(let c=0;c<n;++c)e[c]=Q.lerp(s[a+c],s[l+c],o);break;case zM:{const c=this._hermite;if(!c.valid){const p=o*o,m=o+o,g=1-o,_=g*g;c.valid=!0,c.p0=(1+m)*_,c.m0=o*_,c.p1=p*(3-m),c.m1=p*(o-1)}const u=(this._p0*3+1)*n,h=(this._p0*3+2)*n,d=(this._p1*3+1)*n,f=(this._p1*3+0)*n;for(let p=0;p<n;++p)e[p]=c.p0*s[u+p]+c.m0*s[h+p]*this._len+c.p1*s[d+p]+c.m1*s[f+p]*this._len;break}}}}}class Cz{constructor(e){this._name=`${e.name}Snapshot`,this._time=-1,this._cache=[],this._results=[];for(let s=0;s<e._inputs.length;++s)this._cache[s]=new cTe;const t=e._curves,i=e._outputs;for(let s=0;s<t.length;++s){const n=t[s],a=i[n._output],o=[];for(let l=0;l<a._components;++l)o[l]=0;this._results[s]=o}}}const S_=class S_{constructor(e,t,i,s,n,a){this._name=e.name,this._track=e,this._snapshot=new Cz(e),this._playing=s,this._time=t,this._speed=i,this._loop=n,this._blendWeight=1,this._blendOrder=0,this._eventHandler=a,this.alignCursorToCurrentTime()}set name(e){this._name=e}get name(){return this._name}set track(e){this._track=e,this._snapshot=new Cz(e)}get track(){return this._track}get snapshot(){return this._snapshot}set time(e){this._time=e,this.alignCursorToCurrentTime()}get time(){return this._time}set speed(e){const t=Math.sign(e)!==Math.sign(this._speed);this._speed=e,t&&this.alignCursorToCurrentTime()}get speed(){return this._speed}set loop(e){this._loop=e}get loop(){return this._loop}set blendWeight(e){this._blendWeight=e}get blendWeight(){return this._blendWeight}set blendOrder(e){this._blendOrder=e}get blendOrder(){return this._blendOrder}set eventCursor(e){this._eventCursor=e}get eventCursor(){return this._eventCursor}get eventCursorEnd(){return this.isReverse?0:this._track.events.length-1}get nextEvent(){return this._track.events[this._eventCursor]}get isReverse(){return this._speed<0}nextEventAheadOfTime(e){return this.nextEvent?this.isReverse?this.nextEvent.time<=e:this.nextEvent.time>=e:!1}nextEventBehindTime(e){return this.nextEvent?e===this.track.duration?this.isReverse?this.nextEvent.time>=e:this.nextEvent.time<=e:this.isReverse?this.nextEvent.time>e:this.nextEvent.time<e:!1}resetEventCursor(){this._eventCursor=this.isReverse?this._track.events.length-1:0}moveEventCursor(){this._eventCursor+=this.isReverse?-1:1,this._eventCursor>=this.track.events.length?this._eventCursor=0:this._eventCursor<0&&(this._eventCursor=this.track.events.length-1)}clipFrameTime(e){const t=S_.eventFrame;t.start=0,t.end=e,t.residual=0,this.isReverse?e<0&&(t.start=this.track.duration,t.end=0,t.residual=e+this.track.duration):e>this.track.duration&&(t.start=0,t.end=this.track.duration,t.residual=e-this.track.duration)}alignCursorToCurrentTime(){for(this.resetEventCursor();this.nextEventBehindTime(this._time)&&this._eventCursor!==this.eventCursorEnd;)this.moveEventCursor()}fireNextEvent(){this._eventHandler.fire(this.nextEvent.name,{track:this.track,...this.nextEvent}),this.moveEventCursor()}fireNextEventInFrame(e,t){return this.nextEventAheadOfTime(e)&&this.nextEventBehindTime(t)?(this.fireNextEvent(),!0):!1}activeEventsForFrame(e,t){const i=S_.eventFrame;this.clipFrameTime(t);const s=this.eventCursor;for(;this.fireNextEventInFrame(e,i.end)&&s!==this.eventCursor;);this.loop&&Math.abs(i.residual)>0&&this.activeEventsForFrame(i.start,i.residual)}progressForTime(e){return e*this._speed/this._track.duration}_update(e){if(this._playing){let t=this._time;const i=this._track.duration,s=this._speed,n=this._loop;this._track.events.length>0&&i>0&&this.activeEventsForFrame(t,t+s*e),t+=s*e,s>=0?t>i&&(n?t=t%i||0:(t=this._track.duration,this.pause())):t<0&&(n?t=i+(t%i||0):(t=0,this.pause())),this._time=t}this._time!==this._snapshot._time&&this._track.eval(this._time,this._snapshot)}play(){this._playing=!0,this._time=0}stop(){this._playing=!1,this._time=0}pause(){this._playing=!1}resume(){this._playing=!0}reset(){this._time=0}};S_.eventFrame={start:0,end:0,residual:0};let Cb=S_;const iY="NONE",uTe="PREV_STATE",hTe="NEXT_STATE",dTe="PREV_STATE_NEXT_STATE",fTe="NEXT_STATE_PREV_STATE",pTe="GREATER_THAN",mTe="LESS_THAN",gTe="GREATER_THAN_EQUAL_TO",_Te="LESS_THAN_EQUAL_TO",vTe="EQUAL_TO",yTe="NOT_EQUAL_TO",Pz="INTEGER",Iz="FLOAT",Mz="BOOLEAN",ux="TRIGGER",STe="1D",xTe="2D_DIRECTIONAL",bTe="2D_CARTESIAN",wTe="DIRECT",Pg="START",VM="END",au="ANY",Pb=[Pg,VM,au],rY="OVERWRITE",TTe="ADDITIVE";class Sr{static dot(e,t){const i=e.length;let s=0;for(let n=0;n<i;++n)s+=e[n]*t[n];return s}static normalize(e){let t=Sr.dot(e,e);if(t>0){t=1/Math.sqrt(t);const i=e.length;for(let s=0;s<i;++s)e[s]*=t}}static set(e,t,i){const s=e.length;if(i==="quaternion"){let n=Sr.dot(t,t);n>0&&(n=1/Math.sqrt(n));for(let a=0;a<s;++a)e[a]=t[a]*n}else for(let n=0;n<s;++n)e[n]=t[n]}static blendVec(e,t,i,s){const n=s?1:1-i,a=e.length;for(let o=0;o<a;++o)e[o]=e[o]*n+t[o]*i}static blendQuat(e,t,i,s){const n=e.length,a=s?1:1-i;Sr.dot(e,t)<0&&(i=-i);for(let o=0;o<n;++o)e[o]=e[o]*a+t[o]*i;s||Sr.normalize(e)}static blend(e,t,i,s,n){s==="quaternion"?Sr.blendQuat(e,t,i,n):Sr.blendVec(e,t,i,n)}static stableSort(e,t){const i=e.length;for(let s=0;s<i-1;++s)for(let n=s+1;n<i;++n)if(t(e[n],e[s])){const a=e[s];e[s]=e[n],e[n]=a}}}const Ut=class Ut{constructor(e,t){this._component=e,this.mask=new Int8Array(e.layers.length),this.weights=new Float32Array(e.layers.length),this.totalWeight=0,this.counter=0,this.layerCounter=0,this.valueType=t,this.dirty=!0,this.value=t===Ut.TYPE_QUAT?[0,0,0,1]:[0,0,0],this.baseValue=null,this.setter=null}get _normalizeWeights(){return this._component.normalizeWeights}getWeight(e){return this.dirty&&this.updateWeights(),this._normalizeWeights&&this.totalWeight===0||!this.mask[e]?0:this._normalizeWeights?this.weights[e]/this.totalWeight:Q.clamp(this.weights[e],0,1)}_layerBlendType(e){return this._component.layers[e].blendType}setMask(e,t){this.mask[e]=t,this._normalizeWeights&&(this._component.layers[e].blendType===rY&&(this.mask=this.mask.fill(0,0,e)),this.dirty=!0)}updateWeights(){this.totalWeight=0;for(let e=0;e<this.weights.length;e++)this.weights[e]=this._component.layers[e].weight,this.totalWeight+=this.mask[e]*this.weights[e];this.dirty=!1}updateValue(e,t){if(this.counter===0&&(Sr.set(this.value,Ut.IDENTITY_QUAT_ARR,this.valueType),this._normalizeWeights||Sr.blend(this.value,this.baseValue,1,this.valueType)),!(!this.mask[e]||this.getWeight(e)===0)){if(this._layerBlendType(e)===TTe&&!this._normalizeWeights)if(this.valueType===Ut.TYPE_QUAT){const i=Ut.q1.set(this.value[0],this.value[1],this.value[2],this.value[3]),s=Ut.q2.set(this.baseValue[0],this.baseValue[1],this.baseValue[2],this.baseValue[3]),n=Ut.q3.set(t[0],t[1],t[2],t[3]),a=s.invert().mul(n);a.slerp(de.IDENTITY,a,this.getWeight(e)),i.mul(a),Ut.quatArr[0]=i.x,Ut.quatArr[1]=i.y,Ut.quatArr[2]=i.z,Ut.quatArr[3]=i.w,Sr.set(this.value,Ut.quatArr,this.valueType)}else Ut.vecArr[0]=t[0]-this.baseValue[0],Ut.vecArr[1]=t[1]-this.baseValue[1],Ut.vecArr[2]=t[2]-this.baseValue[2],Sr.blend(this.value,Ut.vecArr,this.getWeight(e),this.valueType,!0);else Sr.blend(this.value,t,this.getWeight(e),this.valueType);this.setter&&this.setter(this.value)}}unbind(){this.setter&&this.setter(this.baseValue)}};Ut.TYPE_QUAT="quaternion",Ut.TYPE_VEC3="vector3",Ut.q1=new de,Ut.q2=new de,Ut.q3=new de,Ut.quatArr=[0,0,0,1],Ut.vecArr=[0,0,0],Ut.IDENTITY_QUAT_ARR=[0,0,0,1];let Kg=Ut;class sY{constructor(e){this._binder=e,this._clips=[],this._inputs=[],this._outputs=[],this._targets={}}get clips(){return this._clips}addClip(e){const t=this._targets,i=this._binder,s=e.track.curves,n=e.snapshot,a=[],o=[];for(let l=0;l<s.length;++l){const u=s[l].paths;for(let h=0;h<u.length;++h){const d=u[h],f=i.resolve(d);let p=t[f&&f.targetPath||null];if(!p&&f){p={target:f,value:[],curves:0,blendCounter:0};for(let m=0;m<p.target.components;++m)p.value.push(0);if(t[f.targetPath]=p,i.animComponent){if(!i.animComponent.targets[f.targetPath]){let m;f.targetPath.substring(f.targetPath.length-13)==="localRotation"?m=Kg.TYPE_QUAT:m=Kg.TYPE_VEC3,i.animComponent.targets[f.targetPath]=new Kg(i.animComponent,m)}i.animComponent.targets[f.targetPath].layerCounter++,i.animComponent.targets[f.targetPath].setMask(i.layerIndex,1)}}p&&(p.curves++,a.push(n._results[l]),o.push(p))}}this._clips.push(e),this._inputs.push(a),this._outputs.push(o)}removeClip(e){const t=this._targets,i=this._binder,s=this._clips,a=s[e].track.curves;for(let o=0;o<a.length;++o){const c=a[o].paths;for(let u=0;u<c.length;++u){const h=c[u],d=this._binder.resolve(h);d&&(d.curves--,d.curves===0&&(i.unresolve(h),delete t[d.targetPath],i.animComponent&&i.animComponent.targets[d.targetPath].layerCounter--))}}s.splice(e,1),this._inputs.splice(e,1),this._outputs.splice(e,1)}removeClips(){for(;this._clips.length>0;)this.removeClip(0)}updateClipTrack(e,t){this._clips.forEach(i=>{i.name.includes(e)&&(i.track=t)}),this.rebind()}findClip(e){const t=this._clips;for(let i=0;i<t.length;++i){const s=t[i];if(s.name===e)return s}return null}rebind(){this._binder.rebind(),this._targets={};const e=[...this.clips];this.removeClips(),e.forEach(t=>{this.addClip(t)})}assignMask(e){return this._binder.assignMask(e)}update(e,t=!0){const i=this._clips,s=i.map((o,l)=>l);Sr.stableSort(s,(o,l)=>i[o].blendOrder<i[l].blendOrder);for(let o=0;o<s.length;++o){const l=s[o],c=i[l],u=this._inputs[l],h=this._outputs[l],d=c.blendWeight;if(d>0&&c._update(e),!t)break;let f,p,m;if(d>=1)for(let g=0;g<u.length;++g)f=u[g],p=h[g],m=p.value,Sr.set(m,f,p.target.type),p.blendCounter++;else if(d>0)for(let g=0;g<u.length;++g)f=u[g],p=h[g],m=p.value,p.blendCounter===0?Sr.set(m,f,p.target.type):Sr.blend(m,f,d,p.target.type),p.blendCounter++}const n=this._targets,a=this._binder;for(const o in n)if(n.hasOwnProperty(o)){const l=n[o];if(a.animComponent&&l.target.isTransform){const c=a.animComponent.targets[o];c.counter===c.layerCounter&&(c.counter=0),c.path||(c.path=o,c.baseValue=l.target.get(),c.setter=l.target.set),c.updateValue(a.layerIndex,l.value),c.counter++}else l.target.set(l.value);l.blendCounter=0}this._binder.update(e)}}class nY{constructor(e){this._events=[...e],this._events.sort((t,i)=>t.time-i.time)}get events(){return this._events}}const oT=class oT{constructor(e,t,i,s,n,a=new nY([])){this._name=e,this._duration=t,this._inputs=i,this._outputs=s,this._curves=n,this._animEvents=a}get name(){return this._name}get duration(){return this._duration}get inputs(){return this._inputs}get outputs(){return this._outputs}get curves(){return this._curves}set events(e){this._animEvents=e}get events(){return this._animEvents.events}eval(e,t){t._time=e;const i=this._inputs,s=this._outputs,n=this._curves,a=t._cache,o=t._results;for(let l=0;l<i.length;++l)a[l].update(e,i[l]._data);for(let l=0;l<n.length;++l){const c=n[l],u=s[c._output],h=o[l];a[c._input].eval(h,c._interpolation,u)}}};oT.EMPTY=Object.freeze(new oT("empty",Number.MAX_VALUE,[],[],[]));let Jo=oT;class Zd{static joinPath(e,t){t=t||".";const i=function(s){return s.replace(/\\/g,"\\\\").replace(new RegExp(`\\${t}`,"g"),`\\${t}`)};return e.map(i).join(t)}static splitPath(e,t){t=t||".";const i=[];let s="",n=0;for(;n<e.length;){let a=e[n++];a==="\\"&&n<e.length?(a=e[n++],a==="\\"||a===t?s+=a:s+=`\\${a}`):a===t?(i.push(s),s=""):s+=a}return s.length>0&&i.push(s),i}static encode(e,t,i){return`${Array.isArray(e)?e.join("/"):e}/${t}/${Array.isArray(i)?i.join("/"):i}`}resolve(e){return null}unresolve(e){}update(e){}}class jM{constructor(e,t,i,s){e.set?(this._set=e.set,this._get=e.get):this._set=e,this._type=t,this._components=i,this._targetPath=s,this._isTransform=this._targetPath.substring(this._targetPath.length-13)==="localRotation"||this._targetPath.substring(this._targetPath.length-13)==="localPosition"||this._targetPath.substring(this._targetPath.length-10)==="localScale"}get set(){return this._set}get get(){return this._get}get type(){return this._type}get components(){return this._components}get targetPath(){return this._targetPath}get isTransform(){return this._isTransform}}class Hl{constructor(e){if(this._isPathInMask=(n,a)=>{const o=this._mask[n];if(o){if(o.children||a&&o.value!==!1)return!0}else return!1;return!1},this.graph=e,!e)return;this._mask=null;const t={},i=function(n){t[n.name]=n;for(let a=0;a<n.children.length;++a)i(n.children[a])};i(e),this.nodes=t,this.targetCache={};const s=function(n){let a=n;for(;a&&!(a instanceof lt);)a=a.parent;let o;return a&&(a.render?o=a.render.meshInstances:a.model&&(o=a.model.meshInstances)),o};this.nodeCounts={},this.activeNodes=[],this.handlers={localPosition:function(n){const a=n.localPosition,o=function(l){a.set(...l)};return Hl.createAnimTarget(o,"vector",3,n,"localPosition")},localRotation:function(n){const a=n.localRotation,o=function(l){a.set(...l)};return Hl.createAnimTarget(o,"quaternion",4,n,"localRotation")},localScale:function(n){const a=n.localScale,o=function(l){a.set(...l)};return Hl.createAnimTarget(o,"vector",3,n,"localScale")},weight:function(n,a){a.indexOf("name.")===0?a=a.replace("name.",""):a=Number(a);const o=s(n);let l;if(o){for(let c=0;c<o.length;++c)if(o[c].node.name===n.name&&o[c].morphInstance){const u=o[c].morphInstance,h=d=>{u.setWeight(a,d[0])};l||(l=[]),l.push(h)}}if(l){const c=u=>{for(let h=0;h<l.length;++h)l[h](u)};return Hl.createAnimTarget(c,"number",1,n,`weight.${a}`)}return null},materialTexture:(n,a)=>{const o=s(n);if(o){let l;for(let c=0;c<o.length;++c)if(o[c].node.name===n.name){l=o[c];break}if(l){const c=u=>{const h=this.animComponent.system.app.assets.get(u[0]);h&&h.resource&&h.type==="texture"&&(l.material[a]=h.resource,l.material.update())};return Hl.createAnimTarget(c,"vector",1,n,"materialTexture","material")}}return null}}}_isPathActive(e){if(!this._mask)return!0;const t=[e.entityPath[0],this.graph.name];for(let i=0;i<t.length;++i){let s=t[i];if(this._isPathInMask(s,e.entityPath.length===1))return!0;for(let n=1;n<e.entityPath.length;n++)if(s+=`/${e.entityPath[n]}`,this._isPathInMask(s,n===e.entityPath.length-1))return!0}return!1}findNode(e){if(!this._isPathActive(e))return null;let t;return this.graph&&(t=this.graph.findByPath(e.entityPath),t||(t=this.graph.findByPath(e.entityPath.slice(1)))),t||(t=this.nodes[e.entityPath[e.entityPath.length-1]||""]),t}static createAnimTarget(e,t,i,s,n,a){const o=Zd.encode(s.path,a||"entity",n);return new jM(e,t,i,o)}resolve(e){const t=Zd.encode(e.entityPath,e.component,e.propertyPath);let i=this.targetCache[t];if(i)return i;const s=this.findNode(e);if(!s)return null;const n=this.handlers[e.propertyPath];return!n||(i=n(s),!i)?null:(this.targetCache[t]=i,this.nodeCounts[s.path]?this.nodeCounts[s.path]++:(this.activeNodes.push(s),this.nodeCounts[s.path]=1),i)}unresolve(e){if(e.component!=="graph")return;const t=this.nodes[e.entityPath[e.entityPath.length-1]||""];if(this.nodeCounts[t.path]--,this.nodeCounts[t.path]===0){const i=this.activeNodes,s=i.indexOf(t.node),n=i.length;s<n-1&&(i[s]=i[n-1]),i.pop()}}update(e){const t=this.activeNodes;for(let i=0;i<t.length;++i)t[i]._dirtifyLocal()}assignMask(e){return e!==this._mask?(this._mask=e,!0):!1}}class aY extends ke{set animations(e){this._animations=e,this.onSetAnimations()}get animations(){return this._animations}set assets(e){const t=this._assets;if(t&&t.length){for(let s=0;s<t.length;s++)if(t[s]){const n=this.system.app.assets.get(t[s]);if(n){n.off("change",this.onAssetChanged,this),n.off("remove",this.onAssetRemoved,this);const a=this.animationsIndex[n.id];this.currAnim===a&&this._stopCurrentAnimation(),delete this.animations[a],delete this.animationsIndex[n.id]}}}this._assets=e;const i=e.map(s=>s instanceof be?s.id:s);this.loadAnimationAssets(i)}get assets(){return this._assets}set currentTime(e){if(this.skeleton&&(this.skeleton.currentTime=e,this.skeleton.addTime(0),this.skeleton.updateGraph()),this.animEvaluator){const t=this.animEvaluator.clips;for(let i=0;i<t.length;++i)t[i].time=e}}get currentTime(){if(this.skeleton)return this.skeleton._time;if(this.animEvaluator){const e=this.animEvaluator.clips;if(e.length>0)return e[e.length-1].time}return 0}get duration(){return this.currAnim?this.animations[this.currAnim].duration:0}set loop(e){if(this._loop=e,this.skeleton&&(this.skeleton.looping=e),this.animEvaluator)for(let t=0;t<this.animEvaluator.clips.length;++t)this.animEvaluator.clips[t].loop=e}get loop(){return this._loop}play(e,t=0){if(!(!this.enabled||!this.entity.enabled)&&this.animations[e]){if(this.prevAnim=this.currAnim,this.currAnim=e,this.model){!this.skeleton&&!this.animEvaluator&&this._createAnimationController();const i=this.animations[this.prevAnim],s=this.animations[this.currAnim];if(this.blending=t>0&&!!this.prevAnim,this.blending&&(this.blend=0,this.blendSpeed=1/t),this.skeleton&&(this.blending?(this.fromSkel.animation=i,this.fromSkel.addTime(this.skeleton._time),this.toSkel.animation=s):this.skeleton.animation=s),this.animEvaluator){const n=this.animEvaluator;if(this.blending)for(;n.clips.length>1;)n.removeClip(0);else this.animEvaluator.removeClips();const a=new Cb(this.animations[this.currAnim],0,1,!0,this.loop);a.name=this.currAnim,a.blendWeight=this.blending?0:1,a.reset(),this.animEvaluator.addClip(a)}}this.playing=!0}}getAnimation(e){return this.animations[e]}setModel(e){e!==this.model&&(this._resetAnimationController(),this.model=e,this.animations&&this.currAnim&&this.animations[this.currAnim]&&this.play(this.currAnim))}onSetAnimations(){const e=this.entity.model;if(e){const t=e.model;t&&t!==this.model&&this.setModel(t)}if(!this.currAnim&&this.activate&&this.enabled&&this.entity.enabled){const t=Object.keys(this._animations);t.length>0&&this.play(t[0])}}_resetAnimationController(){this.skeleton=null,this.fromSkel=null,this.toSkel=null,this.animEvaluator=null}_createAnimationController(){const e=this.model,t=this.animations;let i=!1,s=!1;for(const a in t)t.hasOwnProperty(a)&&(t[a].constructor===Jo?s=!0:i=!0);const n=e.getGraph();i?(this.fromSkel=new LC(n),this.toSkel=new LC(n),this.skeleton=new LC(n),this.skeleton.looping=this.loop,this.skeleton.setGraph(n)):s&&(this.animEvaluator=new sY(new Hl(this.entity)))}loadAnimationAssets(e){if(!e||!e.length)return;const t=this.system.app.assets,i=n=>{if(n.resources.length>1)for(let a=0;a<n.resources.length;a++)this.animations[n.resources[a].name]=n.resources[a],this.animationsIndex[n.id]=n.resources[a].name;else this.animations[n.name]=n.resource,this.animationsIndex[n.id]=n.name;this.animations=this.animations},s=n=>{n.off("change",this.onAssetChanged,this),n.on("change",this.onAssetChanged,this),n.off("remove",this.onAssetRemoved,this),n.on("remove",this.onAssetRemoved,this),n.resource?i(n):(n.once("load",i,this),this.enabled&&this.entity.enabled&&t.load(n))};for(let n=0,a=e.length;n<a;n++){const o=t.get(e[n]);o?s(o):t.on(`add:${e[n]}`,s)}}onAssetChanged(e,t,i,s){if(t==="resource"||t==="resources")if(t==="resources"&&i&&i.length===0&&(i=null),i){let n=!1;if(i.length>1){if(s&&s.length>1)for(let a=0;a<s.length;a++)delete this.animations[s[a].name];else delete this.animations[e.name];n=!1;for(let a=0;a<i.length;a++)this.animations[i[a].name]=i[a],!n&&this.currAnim===i[a].name&&this.playing&&this.enabled&&this.entity.enabled&&(n=!0,this.play(i[a].name));n||(this._stopCurrentAnimation(),this.onSetAnimations())}else{if(s&&s.length>1)for(let a=0;a<s.length;a++)delete this.animations[s[a].name];this.animations[e.name]=i[0]||i,n=!1,this.currAnim===e.name&&this.playing&&this.enabled&&this.entity.enabled&&(n=!0,this.play(e.name)),n||(this._stopCurrentAnimation(),this.onSetAnimations())}this.animationsIndex[e.id]=e.name}else{if(s.length>1)for(let n=0;n<s.length;n++)delete this.animations[s[n].name],this.currAnim===s[n].name&&this._stopCurrentAnimation();else delete this.animations[e.name],this.currAnim===e.name&&this._stopCurrentAnimation();delete this.animationsIndex[e.id]}}onAssetRemoved(e){if(e.off("remove",this.onAssetRemoved,this),this.animations){if(e.resources.length>1)for(let t=0;t<e.resources.length;t++)delete this.animations[e.resources[t].name],this.currAnim===e.resources[t].name&&this._stopCurrentAnimation();else delete this.animations[e.name],this.currAnim===e.name&&this._stopCurrentAnimation();delete this.animationsIndex[e.id]}}_stopCurrentAnimation(){if(this.currAnim=null,this.playing=!1,this.skeleton&&(this.skeleton.currentTime=0,this.skeleton.animation=null),this.animEvaluator){for(let e=0;e<this.animEvaluator.clips.length;++e)this.animEvaluator.clips[e].stop();this.animEvaluator.update(0),this.animEvaluator.removeClips()}}onEnable(){super.onEnable();const e=this.assets,t=this.system.app.assets;if(e)for(let i=0,s=e.length;i<s;i++){let n=e[i];n instanceof be||(n=t.get(n)),n&&!n.resource&&t.load(n)}if(this.activate&&!this.currAnim){const i=Object.keys(this.animations);i.length>0&&this.play(i[0])}}onBeforeRemove(){for(let e=0;e<this.assets.length;e++){let t=this.assets[e];typeof t=="number"&&(t=this.system.app.assets.get(t)),t&&(t.off("change",this.onAssetChanged,this),t.off("remove",this.onAssetRemoved,this))}this.skeleton=null,this.fromSkel=null,this.toSkel=null,this.animEvaluator=null}update(e){if(this.blending&&(this.blend+=e*this.blendSpeed,this.blend>=1&&(this.blend=1)),this.playing){const i=this.skeleton;if(i!==null&&this.model!==null){if(this.blending)i.blend(this.fromSkel,this.toSkel,this.blend);else{const s=e*this.speed;i.addTime(s),this.speed>0&&i._time===i.animation.duration&&!this.loop?this.playing=!1:this.speed<0&&i._time===0&&!this.loop&&(this.playing=!1)}this.blending&&this.blend===1&&(i.animation=this.toSkel.animation),i.updateGraph()}}const t=this.animEvaluator;if(t){for(let i=0;i<t.clips.length;++i){const s=t.clips[i];s.speed=this.speed,this.playing?s.resume():s.pause()}this.blending&&t.clips.length>1&&(t.clips[1].blendWeight=this.blend),t.update(e)}this.blending&&this.blend===1&&(this.blending=!1)}constructor(...e){super(...e),this._animations={},this._assets=[],this._loop=!0,this.animEvaluator=null,this.model=null,this.skeleton=null,this.fromSkel=null,this.toSkel=null,this.animationsIndex={},this.prevAnim=null,this.currAnim=null,this.blend=0,this.blending=!1,this.blendSpeed=0,this.activate=!0,this.speed=1}}class ETe{constructor(){this.enabled=!0}}const $M=["enabled"];class ATe extends si{constructor(e){super(e),this.id="animation",this.ComponentType=aY,this.DataType=ETe,this.schema=$M,this.on("beforeremove",this.onBeforeRemove,this),this.app.systems.on("update",this.onUpdate,this)}initializeComponentData(e,t,i){i=["activate","enabled","loop","speed","assets"];for(const s of i)t.hasOwnProperty(s)&&(e[s]=t[s]);super.initializeComponentData(e,t,$M)}cloneComponent(e,t){this.addComponent(t,{}),t.animation.assets=e.animation.assets.slice(),t.animation.speed=e.animation.speed,t.animation.loop=e.animation.loop,t.animation.activate=e.animation.activate,t.animation.enabled=e.animation.enabled;const i={},s=e.animation.animations;for(const o in s)s.hasOwnProperty(o)&&(i[o]=s[o]);t.animation.animations=i;const n={},a=e.animation.animationsIndex;for(const o in a)a.hasOwnProperty(o)&&(n[o]=a[o]);return t.animation.animationsIndex=n,t.animation}onBeforeRemove(e,t){t.onBeforeRemove()}onUpdate(e){const t=this.store;for(const i in t)if(t.hasOwnProperty(i)){const s=t[i];s.data.enabled&&s.entity.enabled&&s.entity.animation.update(e)}}destroy(){super.destroy(),this.app.systems.off("update",this.onUpdate,this)}}ke._buildAccessors(aY.prototype,$M);class av{constructor(e,t,i,s,n=1){this._state=e,this._parent=t,this._name=i,Array.isArray(s)?(this._point=new ee(s[0],s[1]),this._pointLength=this._point.length()):(this._point=s,this._pointLength=s),this._speed=n,this._weightedSpeed=1,this._weight=1,this._animTrack=null}get parent(){return this._parent}get name(){return this._name}get path(){return this._parent?`${this._parent.path}.${this._name}`:this._name}get point(){return this._point}get pointLength(){return this._pointLength}set weight(e){this._weight=e}get weight(){return this._parent?this._parent.weight*this._weight:this._weight}get normalizedWeight(){const e=this._state.totalWeight;return e===0?0:this.weight/e}get speed(){return this._weightedSpeed*this._speed}get absoluteSpeed(){return Math.abs(this._speed)}set weightedSpeed(e){this._weightedSpeed=e}get weightedSpeed(){return this._weightedSpeed}set animTrack(e){this._animTrack=e}get animTrack(){return this._animTrack}}class hm extends av{constructor(e,t,i,s,n,a,o,l,c){super(e,t,i,s),this._parameters=n,this._parameterValues=new Array(n.length),this._children=[],this._findParameter=c,this._syncAnimations=o!==!1,this._pointCache={};for(let u=0;u<a.length;u++){const h=a[u];h.children?this._children.push(l(h.type,e,this,h.name,1,h.parameter?[h.parameter]:h.parameters,h.children,h.syncAnimations,l,c)):this._children.push(new av(e,this,h.name,h.point,h.speed))}}get weight(){return this.calculateWeights(),this._parent?this._parent.weight*this._weight:this._weight}get syncAnimations(){return this._syncAnimations}getChild(e){for(let t=0;t<this._children.length;t++)if(this._children[t].name===e)return this._children[t];return null}updateParameterValues(){let e=!0;for(let t=0;t<this._parameterValues.length;t++){const i=this._findParameter(this._parameters[t]).value;this._parameterValues[t]!==i&&(this._parameterValues[t]=i,e=!1)}return e}getNodeWeightedDuration(e){return this._children[e].animTrack.duration/this._children[e].speedMultiplier*this._children[e].weight}getNodeCount(){let e=0;for(let t=0;t<this._children.length;t++)this._children[t].constructor===hm?e+=this._children[t].getNodeCount():e++;return e}}class CTe extends hm{constructor(e,t,i,s,n,a,o,l,c){a.sort((u,h)=>u.point-h.point),super(e,t,i,s,n,a,o,l,c)}calculateWeights(){if(this.updateParameterValues())return;let e=0;this._children[0].weight=0;for(let t=0;t<this._children.length;t++){const i=this._children[t];if(t!==this._children.length-1){const s=this._children[t+1];if(i.point===s.point)i.weight=.5,s.weight=.5;else if(Q.between(this._parameterValues[0],i.point,s.point,!0)){const n=Math.abs(i.point-s.point),a=Math.abs(i.point-this._parameterValues[0]),o=(n-a)/n;i.weight=o,s.weight=1-o}else s.weight=0}this._syncAnimations&&(e+=i.animTrack.duration/i.absoluteSpeed*i.weight)}if(this._syncAnimations)for(let t=0;t<this._children.length;t++){const i=this._children[t];i.weightedSpeed=i.animTrack.duration/i.absoluteSpeed/e}}}const bo=class bo extends hm{pointDistanceCache(e,t){const i=`${e}${t}`;return this._pointCache[i]||(this._pointCache[i]=this._children[t].point.clone().sub(this._children[e].point)),this._pointCache[i]}calculateWeights(){if(this.updateParameterValues())return;let e,t;bo._p.set(...this._parameterValues),e=0,t=0;for(let i=0;i<this._children.length;i++){const s=this._children[i],n=s.point;bo._pip.set(bo._p.x,bo._p.y).sub(n);let a=Number.MAX_VALUE;for(let o=0;o<this._children.length;o++){if(i===o)continue;const l=this.pointDistanceCache(i,o),c=Q.clamp(1-bo._pip.dot(l)/l.lengthSq(),0,1);c<a&&(a=c)}s.weight=a,e+=a,this._syncAnimations&&(t+=s.animTrack.duration/s.absoluteSpeed*s.weight)}for(let i=0;i<this._children.length;i++){const s=this._children[i];s.weight=s._weight/e,this._syncAnimations&&(s.weightedSpeed=s.animTrack.duration/s.absoluteSpeed/t)}}};bo._p=new ee,bo._pip=new ee;let HM=bo;const wo=class wo extends hm{pointCache(e,t){const i=`${e}${t}`;return this._pointCache[i]||(this._pointCache[i]=new ee((this._children[t].pointLength-this._children[e].pointLength)/((this._children[t].pointLength+this._children[e].pointLength)/2),ee.angleRad(this._children[e].point,this._children[t].point)*2)),this._pointCache[i]}calculateWeights(){if(this.updateParameterValues())return;let e,t;wo._p.set(...this._parameterValues);const i=wo._p.length();e=0,t=0;for(let s=0;s<this._children.length;s++){const n=this._children[s],a=n.point,o=n.pointLength;let l=Number.MAX_VALUE;for(let c=0;c<this._children.length;c++){if(s===c)continue;const u=this.pointCache(s,c),h=this._children[c].pointLength;wo._pip.set((i-o)/((h+o)/2),ee.angleRad(a,wo._p)*2);const d=Q.clamp(1-Math.abs(wo._pip.dot(u)/u.lengthSq()),0,1);d<l&&(l=d)}n.weight=l,e+=l,this._syncAnimations&&(t+=n.animTrack.duration/n.absoluteSpeed*n.weight)}for(let s=0;s<this._children.length;s++){const n=this._children[s];if(n.weight=n._weight/e,this._syncAnimations){const a=n.animTrack.duration/t*e;n.weightedSpeed=n.absoluteSpeed*a}}}};wo._p=new ee,wo._pip=new ee;let GM=wo;class PTe extends hm{calculateWeights(){if(this.updateParameterValues())return;let e=0,t=0;for(let i=0;i<this._children.length;i++)if(e+=Math.max(this._parameterValues[i],0),this._syncAnimations){const s=this._children[i];t+=s.animTrack.duration/s.absoluteSpeed*s.weight}for(let i=0;i<this._children.length;i++){const s=this._children[i],n=Math.max(this._parameterValues[i],0);e?(s.weight=n/e,this._syncAnimations&&(s.weightedSpeed=s.animTrack.duration/s.absoluteSpeed/t)):(s.weight=0,this._syncAnimations&&(s.weightedSpeed=0))}}}class Rz{constructor(e,t,i=1,s=!0,n){this._animations={},this._animationList=[],this._controller=e,this._name=t,this._speed=i,this._loop=s,this._hasAnimations=!1,n?this._blendTree=this._createTree(n.type,this,null,t,1,n.parameter?[n.parameter]:n.parameters,n.children,n.syncAnimations,this._createTree,this._controller.findParameter):this._blendTree=new av(this,null,t,1,i)}_createTree(e,t,i,s,n,a,o,l,c,u){switch(e){case STe:return new CTe(t,i,s,n,a,o,l,c,u);case bTe:return new HM(t,i,s,n,a,o,l,c,u);case xTe:return new GM(t,i,s,n,a,o,l,c,u);case wTe:return new PTe(t,i,s,n,a,o,l,c,u)}}_getNodeFromPath(e){let t=this._blendTree;for(let i=1;i<e.length;i++)t=t.getChild(e[i]);return t}addAnimation(e,t){const i=e.join("."),s=this._animationList.findIndex(n=>n.path===i);if(s>=0)this._animationList[s].animTrack=t;else{const n=this._getNodeFromPath(e);n.animTrack=t,this._animationList.push(n)}this._updateHasAnimations()}_updateHasAnimations(){this._hasAnimations=this._animationList.length>0&&this._animationList.every(e=>e.animTrack&&e.animTrack!==Jo.EMPTY)}get name(){return this._name}set animations(e){this._animationList=e,this._updateHasAnimations()}get animations(){return this._animationList}get hasAnimations(){return this._hasAnimations}set speed(e){this._speed=e}get speed(){return this._speed}set loop(e){this._loop=e}get loop(){return this._loop}get nodeCount(){return!this._blendTree||this._blendTree.constructor===av?1:this._blendTree.getNodeCount()}get playable(){return Pb.indexOf(this.name)!==-1||this.animations.length===this.nodeCount}get looping(){if(this.animations.length>0){const e=`${this.name}.${this.animations[0].animTrack.name}`,t=this._controller.animEvaluator.findClip(e);if(t)return t.loop}return!1}get totalWeight(){let e=0;for(let t=0;t<this.animations.length;t++)e+=this.animations[t].weight;return e}get timelineDuration(){let e=0;for(let t=0;t<this.animations.length;t++){const i=this.animations[t];i.animTrack.duration>e&&(e=i.animTrack.duration)}return e}}class Ib{constructor({from:e,to:t,time:i=0,priority:s=0,conditions:n=[],exitTime:a=null,transitionOffset:o=null,interruptionSource:l=iY}){this._from=e,this._to=t,this._time=i,this._priority=s,this._conditions=n,this._exitTime=a,this._transitionOffset=o,this._interruptionSource=l}get from(){return this._from}set to(e){this._to=e}get to(){return this._to}get time(){return this._time}get priority(){return this._priority}get conditions(){return this._conditions}get exitTime(){return this._exitTime}get transitionOffset(){return this._transitionOffset}get interruptionSource(){return this._interruptionSource}get hasExitTime(){return!!this.exitTime}}class ITe{constructor(e,t,i,s,n,a,o){this._states={},this._stateNames=[],this._findTransitionsFromStateCache={},this._findTransitionsBetweenStatesCache={},this._previousStateName=null,this._activeStateName=Pg,this._activeStateDuration=0,this._activeStateDurationDirty=!0,this._playing=!1,this._currTransitionTime=1,this._totalTransitionTime=1,this._isTransitioning=!1,this._transitionInterruptionSource=iY,this._transitionPreviousStates=[],this._timeInState=0,this._timeInStateBefore=0,this.findParameter=l=>this._findParameter(l),this._animEvaluator=e,this._eventHandler=n,this._findParameter=a,this._consumeTrigger=o;for(let l=0;l<t.length;l++)this._states[t[l].name]=new Rz(this,t[l].name,t[l].speed,t[l].loop,t[l].blendTree),this._stateNames.push(t[l].name);this._transitions=i.map(l=>new Ib({...l})),this._activate=s}get animEvaluator(){return this._animEvaluator}set activeState(e){this._activeStateName=e}get activeState(){return this._findState(this._activeStateName)}get activeStateName(){return this._activeStateName}get activeStateAnimations(){return this.activeState.animations}set previousState(e){this._previousStateName=e}get previousState(){return this._findState(this._previousStateName)}get previousStateName(){return this._previousStateName}get playable(){let e=!0;for(let t=0;t<this._stateNames.length;t++)this._states[this._stateNames[t]].playable||(e=!1);return e}set playing(e){this._playing=e}get playing(){return this._playing}get activeStateProgress(){return this._getActiveStateProgressForTime(this._timeInState)}get activeStateDuration(){if(this._activeStateDurationDirty){let e=0;for(let t=0;t<this.activeStateAnimations.length;t++){const i=this._animEvaluator.findClip(this.activeStateAnimations[t].name);i&&(e=Math.max(e,i.track.duration))}this._activeStateDuration=e,this._activeStateDurationDirty=!1}return this._activeStateDuration}set activeStateCurrentTime(e){this._timeInStateBefore=e,this._timeInState=e;for(let t=0;t<this.activeStateAnimations.length;t++){const i=this.animEvaluator.findClip(this.activeStateAnimations[t].name);i&&(i.time=e)}}get activeStateCurrentTime(){return this._timeInState}get transitioning(){return this._isTransitioning}get transitionProgress(){return this._currTransitionTime/this._totalTransitionTime}get states(){return this._stateNames}assignMask(e){return this._animEvaluator.assignMask(e)}_findState(e){return this._states[e]}_getActiveStateProgressForTime(e){if(this.activeStateName===Pg||this.activeStateName===VM||this.activeStateName===au)return 1;const t=this._animEvaluator.findClip(this.activeStateAnimations[0].name);return t?t.progressForTime(e):null}_findTransitionsFromState(e){let t=this._findTransitionsFromStateCache[e];return t||(t=this._transitions.filter(i=>i.from===e),rv(t),this._findTransitionsFromStateCache[e]=t),t}_findTransitionsBetweenStates(e,t){let i=this._findTransitionsBetweenStatesCache[`${e}->${t}`];return i||(i=this._transitions.filter(s=>s.from===e&&s.to===t),rv(i),this._findTransitionsBetweenStatesCache[`${e}->${t}`]=i),i}_transitionHasConditionsMet(e){const t=e.conditions;for(let i=0;i<t.length;i++){const s=t[i],n=this._findParameter(s.parameterName);switch(s.predicate){case pTe:if(!(n.value>s.value))return!1;break;case mTe:if(!(n.value<s.value))return!1;break;case gTe:if(!(n.value>=s.value))return!1;break;case _Te:if(!(n.value<=s.value))return!1;break;case vTe:if(n.value!==s.value)return!1;break;case yTe:if(n.value===s.value)return!1;break}}return!0}_findTransition(e,t){let i=[];if(e&&t)i=i.concat(this._findTransitionsBetweenStates(e,t));else if(!this._isTransitioning)i=i.concat(this._findTransitionsFromState(this._activeStateName)),i=i.concat(this._findTransitionsFromState(au));else switch(this._transitionInterruptionSource){case uTe:i=i.concat(this._findTransitionsFromState(this._previousStateName)),i=i.concat(this._findTransitionsFromState(au));break;case hTe:i=i.concat(this._findTransitionsFromState(this._activeStateName)),i=i.concat(this._findTransitionsFromState(au));break;case dTe:i=i.concat(this._findTransitionsFromState(this._previousStateName)),i=i.concat(this._findTransitionsFromState(this._activeStateName)),i=i.concat(this._findTransitionsFromState(au));break;case fTe:i=i.concat(this._findTransitionsFromState(this._activeStateName)),i=i.concat(this._findTransitionsFromState(this._previousStateName)),i=i.concat(this._findTransitionsFromState(au));break}if(i=i.filter(s=>{if(s.to===this.activeStateName)return!1;if(s.hasExitTime){let n=this._getActiveStateProgressForTime(this._timeInStateBefore),a=this._getActiveStateProgressForTime(this._timeInState);if(s.exitTime<1&&this.activeState.loop&&(n-=Math.floor(n),a-=Math.floor(a)),a===n){if(a!==s.exitTime)return null}else if(!(s.exitTime>n&&s.exitTime<=a))return null}return this._transitionHasConditionsMet(s)}),i.length>0){const s=i[0];if(s.to===VM){const n=this._findTransitionsFromState(Pg)[0];s.to=n.to}return s}return null}updateStateFromTransition(e){let t,i,s;this.previousState=e.from?this.activeStateName:null,this.activeState=e.to,this._activeStateDurationDirty=!0;for(let c=0;c<e.conditions.length;c++){const u=e.conditions[c];this._findParameter(u.parameterName).type===ux&&this._consumeTrigger(u.parameterName)}if(this.previousState){this._isTransitioning||(this._transitionPreviousStates=[]),this._transitionPreviousStates.push({name:this._previousStateName,weight:1});const c=Math.min(this._totalTransitionTime!==0?this._currTransitionTime/this._totalTransitionTime:1,1);for(let u=0;u<this._transitionPreviousStates.length;u++){this._isTransitioning?u!==this._transitionPreviousStates.length-1?this._transitionPreviousStates[u].weight*=1-c:this._transitionPreviousStates[u].weight=c:this._transitionPreviousStates[u].weight=1,t=this._findState(this._transitionPreviousStates[u].name);for(let h=0;h<t.animations.length;h++)i=t.animations[h],s=this._animEvaluator.findClip(`${i.name}.previous.${u}`),s||(s=this._animEvaluator.findClip(i.name),s.name=`${i.name}.previous.${u}`),u!==this._transitionPreviousStates.length-1&&s.pause()}}this._isTransitioning=!0,this._totalTransitionTime=e.time,this._currTransitionTime=0,this._transitionInterruptionSource=e.interruptionSource;const n=this.activeState,a=e.transitionOffset&&e.transitionOffset>0&&e.transitionOffset<1;let o=0,l=0;if(a){const c=n.timelineDuration*e.transitionOffset;o=c,l=c}this._timeInState=o,this._timeInStateBefore=l;for(let c=0;c<n.animations.length;c++){if(s=this._animEvaluator.findClip(n.animations[c].name),s)s.reset();else{const u=Number.isFinite(n.animations[c].speed)?n.animations[c].speed:n.speed;s=new Cb(n.animations[c].animTrack,this._timeInState,u,!0,n.loop,this._eventHandler),s.name=n.animations[c].name,this._animEvaluator.addClip(s)}if(e.time>0?s.blendWeight=0:s.blendWeight=n.animations[c].normalizedWeight,s.play(),a)s.time=n.timelineDuration*e.transitionOffset;else{const u=n.speed>=0?0:this.activeStateDuration;s.time=u}}}_transitionToState(e){if(!this._findState(e))return;let t=this._findTransition(this._activeStateName,e);t||(this._animEvaluator.removeClips(),t=new Ib({from:null,to:e})),this.updateStateFromTransition(t)}assignAnimation(e,t,i,s){const n=e.split(".");let a=this._findState(n[0]);a||(a=new Rz(this,n[0],i),this._states[n[0]]=a,this._stateNames.push(n[0])),a.addAnimation(n,t),this._animEvaluator.updateClipTrack(a.name,t),i!==void 0&&(a.speed=i),s!==void 0&&(a.loop=s),!this._playing&&this._activate&&this.playable&&this.play(),this._activeStateDurationDirty=!0}removeNodeAnimations(e){if(Pb.indexOf(e)!==-1)return!1;const t=this._findState(e);return t?(t.animations=[],!0):!1}play(e){e&&this._transitionToState(e),this._playing=!0}pause(){this._playing=!1}reset(){this._previousStateName=null,this._activeStateName=Pg,this._playing=!1,this._currTransitionTime=1,this._totalTransitionTime=1,this._isTransitioning=!1,this._timeInState=0,this._timeInStateBefore=0,this._animEvaluator.removeClips()}rebind(){this._animEvaluator.rebind()}update(e){if(!this._playing)return;let t,i,s;(this.activeState.loop||this._timeInState<this.activeStateDuration)&&(this._timeInStateBefore=this._timeInState,this._timeInState+=e*this.activeState.speed,!this.activeState.loop&&this._timeInState>this.activeStateDuration&&(this._timeInState=this.activeStateDuration,e=this.activeStateDuration-this._timeInStateBefore));const n=this._findTransition(this._activeStateName);if(n&&this.updateStateFromTransition(n),this._isTransitioning)if(this._currTransitionTime+=e,this._currTransitionTime<=this._totalTransitionTime){const a=this._totalTransitionTime!==0?this._currTransitionTime/this._totalTransitionTime:1;for(let o=0;o<this._transitionPreviousStates.length;o++){t=this._findState(this._transitionPreviousStates[o].name);const l=this._transitionPreviousStates[o].weight;for(let c=0;c<t.animations.length;c++)i=t.animations[c],s=this._animEvaluator.findClip(`${i.name}.previous.${o}`),s&&(s.blendWeight=(1-a)*i.normalizedWeight*l)}t=this.activeState;for(let o=0;o<t.animations.length;o++)i=t.animations[o],this._animEvaluator.findClip(i.name).blendWeight=a*i.normalizedWeight}else{this._isTransitioning=!1;const a=this.activeStateAnimations.length,o=this._animEvaluator.clips.length;for(let l=0;l<o-a;l++)this._animEvaluator.removeClip(0);this._transitionPreviousStates=[],t=this.activeState;for(let l=0;l<t.animations.length;l++)i=t.animations[l],s=this._animEvaluator.findClip(i.name),s&&(s.blendWeight=i.normalizedWeight)}else if(this.activeState._blendTree.constructor!==av){t=this.activeState;for(let a=0;a<t.animations.length;a++)i=t.animations[a],s=this._animEvaluator.findClip(i.name),s&&(s.blendWeight=i.normalizedWeight,i.parent.syncAnimations&&(s.speed=i.speed))}this._animEvaluator.update(e,this.activeState.hasAnimations)}}const zC=new ee,rS=new O,sg=new ce,ng=new ae,ag=new de;class yo extends Hl{constructor(e,t,i,s,n){super(t),this.animComponent=e,this._mask=s,this.layerName=i,this.layerIndex=n}static _packFloat(e){return e[0]}static _packBoolean(e){return!!e[0]}static _packVec2(e){return zC.x=e[0],zC.y=e[1],zC}static _packVec3(e){return rS.x=e[0],rS.y=e[1],rS.z=e[2],rS}static _packVec4(e){return sg.x=e[0],sg.y=e[1],sg.z=e[2],sg.w=e[3],sg}static _packColor(e){return ng.r=e[0],ng.g=e[1],ng.b=e[2],ng.a=e[3],ng}static _packQuat(e){return ag.x=e[0],ag.y=e[1],ag.z=e[2],ag.w=e[3],ag}resolve(e){const t=Zd.encode(e.entityPath,e.component,e.propertyPath);let i=this.targetCache[t];if(i)return i;let s,n,a;switch(e.component){case"entity":s=this._getEntityFromHierarchy(e.entityPath),a=Zd.encode(s.path,"entity",e.propertyPath),n=s;break;case"graph":if(n=this.findNode(e),!n)return null;a=Zd.encode(n.path,"graph",e.propertyPath);break;default:if(s=this._getEntityFromHierarchy(e.entityPath),n=s.findComponent(e.component),!n)return null;a=Zd.encode(s.path,e.component,e.propertyPath);break}return i=this._createAnimTargetForProperty(n,e.propertyPath,a),this.targetCache[t]=i,i}update(e){const t=this.activeNodes;if(t)for(let i=0;i<t.length;i++)t[i]._dirtifyLocal()}_getEntityFromHierarchy(e){if(!this.animComponent.entity.name===e[0])return null;const t=this.animComponent.entity;return e.length===1?t:t._parent.findByPath(e)}_resolvePath(e,t,i){const s=t.length-(i?0:1);for(let n=0;n<s;n++)e=e[t[n]];return e}_setter(e,t,i){const s=this._resolvePath(e,t),n=t[t.length-1],a=`set${n.substring(0,1).toUpperCase()}${n.substring(1)}`;if(s[a]){let c=s[`get${n.substring(0,1).toUpperCase()}${n.substring(1)}`].bind(s)();c=[c.x,c.y,c.z,c.w];const u=s[a].bind(s);return{set:h=>{u(i(h))},get:()=>c}}const o=s[n];if(typeof o=="object"&&o.hasOwnProperty("copy"))return function(l){o.copy(i(l))};if([ee,O,ce,ae,de].indexOf(s.constructor)!==-1&&t.length>1){const l=t.length>2?this._resolvePath(e,t.slice(0,-1)):e,c=t[t.length-2];return function(u){s[n]=i(u),l[c]=s}}return function(l){s[n]=i(l)}}_createAnimTargetForProperty(e,t,i){if(this.handlers&&t[0].startsWith("weight."))return this.handlers.weight(e,t[0].replace("weight.",""));if(this.handlers&&t[0]==="material"&&t.length===2){const l=t[1];if(l.endsWith("Map"))return this.handlers.materialTexture(e,l)}const s=this._resolvePath(e,t,!0);if(typeof s>"u")return null;let n,a,o;if(typeof s=="number")n=this._setter(e,t,yo._packFloat),a="vector",o=1;else if(typeof s=="boolean")n=this._setter(e,t,yo._packBoolean),a="vector",o=1;else if(typeof s=="object")switch(s.constructor){case ee:n=this._setter(e,t,yo._packVec2),a="vector",o=2;break;case O:n=this._setter(e,t,yo._packVec3),a="vector",o=3;break;case ce:n=this._setter(e,t,yo._packVec4),a="vector",o=4;break;case ae:n=this._setter(e,t,yo._packColor),a="vector",o=4;break;case de:n=this._setter(e,t,yo._packQuat),a="quaternion",o=4;break;default:return null}return t.indexOf("material")!==-1?new jM(l=>{n(l),e.material.update()},a,o,i):new jM(n,a,o,i)}rebind(){this.targetCache={},this.animComponent.rootBone?this.graph=this.animComponent.rootBone:this.graph=this.animComponent.entity;const e={},t=function(i){e[i.name]=i;for(let s=0;s<i.children.length;++s)t(i.children[s])};t(this.graph),this.nodes=e}}class MTe{constructor(e,t,i,s=1,n=rY){this._mask=null,this._blendTime=0,this._blendTimeElapsed=0,this._startingWeight=0,this._targetWeight=0,this._name=e,this._controller=t,this._component=i,this._weight=s,this._blendType=n}get name(){return this._name}set playing(e){this._controller.playing=e}get playing(){return this._controller.playing}get playable(){return this._controller.playable}get activeState(){return this._controller.activeStateName}get previousState(){return this._controller.previousStateName}get activeStateProgress(){return this._controller.activeStateProgress}get activeStateDuration(){return this._controller.activeStateDuration}set activeStateCurrentTime(e){const t=this._controller,i=t.playing;t.playing=!0,t.activeStateCurrentTime=e,i||t.update(0),t.playing=i}get activeStateCurrentTime(){return this._controller.activeStateCurrentTime}get transitioning(){return this._controller.transitioning}get transitionProgress(){return this.transitioning?this._controller.transitionProgress:null}get states(){return this._controller.states}set weight(e){this._weight=e,this._component.dirtifyTargets()}get weight(){return this._weight}set blendType(e){e!==this._blendType&&(this._blendType=e,this._controller.normalizeWeights&&this._component.rebind())}get blendType(){return this._blendType}set mask(e){this._controller.assignMask(e)&&this._component.rebind(),this._mask=e}get mask(){return this._mask}play(e){this._controller.play(e)}pause(){this._controller.pause()}reset(){this._controller.reset()}rebind(){this._controller.rebind()}update(e){this._blendTime&&(this._blendTimeElapsed<this._blendTime?(this.weight=Q.lerp(this._startingWeight,this._targetWeight,this._blendTimeElapsed/this._blendTime),this._blendTimeElapsed+=e):(this.weight=this._targetWeight,this._blendTime=0,this._blendTimeElapsed=0,this._startingWeight=0,this._targetWeight=0)),this._controller.update(e)}blendToWeight(e,t){this._startingWeight=this.weight,this._targetWeight=e,this._blendTime=Math.max(0,t),this._blendTimeElapsed=0}assignAnimation(e,t,i,s){t instanceof Jo&&(this._controller.assignAnimation(e,t,i,s),this._controller._transitions.length===0&&this._controller._transitions.push(new Ib({from:"START",to:e})),this._component.activate&&this._component.playable&&(this._component.playing=!0))}removeNodeAnimations(e){this._controller.removeNodeAnimations(e)&&(this._component.playing=!1)}getAnimationAsset(e){return this._component.animationAssets[`${this.name}:${e}`]}transition(e,t=0,i=null){this._controller.updateStateFromTransition(new Ib({from:this._controller.activeStateName,to:e,time:t,transitionOffset:i}))}}class hx{constructor(e){if(this._layers=[],this._parameters={},Array.isArray(e.layers))this._layers=e.layers;else for(const t in e.layers){const i=e.layers[t],s={name:i.name,blendType:i.blendType,weight:i.weight,states:[],transitions:[]};for(let n=0;n<i.states.length;n++)s.states.push(e.states[i.states[n]]);for(let n=0;n<i.transitions.length;n++){const a=e.transitions[i.transitions[n]];if(a.conditions&&!Array.isArray(a.conditions)){const o=Object.keys(a.conditions),l=[];for(let c=0;c<o.length;c++){const u=a.conditions[o[c]];u.parameterName&&l.push(u)}a.conditions=l}Number.isInteger(a.from)&&(a.from=e.states[a.from].name),Number.isInteger(a.to)&&(a.to=e.states[a.to].name),s.transitions.push(a)}this._layers.push(s)}for(const t in e.parameters){const i=e.parameters[t];this._parameters[i.name]={type:i.type,value:i.value}}}get parameters(){return Object.assign({},this._parameters)}get layers(){return this._layers}}class oY extends ke{set stateGraphAsset(e){if(e===null){this.removeStateGraph();return}this._stateGraphAsset&&this.system.app.assets.get(this._stateGraphAsset).off("change",this._onStateGraphAssetChangeEvent,this);let t,i;e instanceof be?(t=e.id,i=this.system.app.assets.get(t),i||(this.system.app.assets.add(e),i=this.system.app.assets.get(t))):(t=e,i=this.system.app.assets.get(t)),!(!i||this._stateGraphAsset===t)&&(i.resource?(this._stateGraph=i.resource,this.loadStateGraph(this._stateGraph),i.on("change",this._onStateGraphAssetChangeEvent,this)):(i.once("load",s=>{this._stateGraph=s.resource,this.loadStateGraph(this._stateGraph)}),i.on("change",this._onStateGraphAssetChangeEvent,this),this.system.app.assets.load(i)),this._stateGraphAsset=t)}get stateGraphAsset(){return this._stateGraphAsset}set normalizeWeights(e){this._normalizeWeights=e,this.unbind()}get normalizeWeights(){return this._normalizeWeights}set animationAssets(e){this._animationAssets=e,this.loadAnimationAssets()}get animationAssets(){return this._animationAssets}set speed(e){this._speed=e}get speed(){return this._speed}set activate(e){this._activate=e}get activate(){return this._activate}set playing(e){this._playing=e}get playing(){return this._playing}set rootBone(e){if(typeof e=="string"){const t=this.entity.root.findByGuid(e);this._rootBone=t}else e instanceof lt?this._rootBone=e:this._rootBone=null;this.rebind()}get rootBone(){return this._rootBone}set stateGraph(e){this._stateGraph=e}get stateGraph(){return this._stateGraph}get layers(){return this._layers}set layerIndices(e){this._layerIndices=e}get layerIndices(){return this._layerIndices}set parameters(e){this._parameters=e}get parameters(){return this._parameters}set targets(e){this._targets=e}get targets(){return this._targets}get playable(){for(let e=0;e<this._layers.length;e++)if(!this._layers[e].playable)return!1;return!0}get baseLayer(){return this._layers.length>0?this._layers[0]:null}_onStateGraphAssetChangeEvent(e){const t=this.animationAssets,i=this.layers.map(s=>s.mask);this.removeStateGraph(),this._stateGraph=new hx(e._data),this.loadStateGraph(this._stateGraph),this.animationAssets=t,this.loadAnimationAssets(),this.layers.forEach((s,n)=>{s.mask=i[n]}),this.rebind()}dirtifyTargets(){const e=Object.values(this._targets);for(let t=0;t<e.length;t++)e[t].dirty=!0}_addLayer({name:e,states:t,transitions:i,weight:s,mask:n,blendType:a}){let o;this.rootBone?o=this.rootBone:o=this.entity;const l=this._layers.length,c=new yo(this,o,e,n,l),u=new sY(c),h=new ITe(u,t,i,this._activate,this,this.findParameter,this.consumeTrigger);return this._layers.push(new MTe(e,h,this,s,a)),this._layerIndices[e]=l,this._layers[l]}addLayer(e,t,i,s){const n=this.findAnimationLayer(e);if(n)return n;const a=[{name:"START",speed:1}],o=[];return this._addLayer({name:e,states:a,transitions:o,weight:t,mask:i,blendType:s})}_assignParameters(e){this._parameters={};const t=Object.keys(e.parameters);for(let i=0;i<t.length;i++){const s=t[i];this._parameters[s]={type:e.parameters[s].type,value:e.parameters[s].value}}}loadStateGraph(e){this._stateGraph=e,this._assignParameters(e),this._layers=[];let t=!1;for(let i=0;i<e.layers.length;i++){const s=e.layers[i];this._addLayer({...s}),s.states.some(n=>n.blendTree)&&(t=!0)}t||this.setupAnimationAssets()}setupAnimationAssets(){for(let e=0;e<this._layers.length;e++){const t=this._layers[e],i=t.name;for(let s=0;s<t.states.length;s++){const n=t.states[s];if(Pb.indexOf(n)===-1){const a=`${i}:${n}`;this._animationAssets[a]||(this._animationAssets[a]={asset:null})}}}this.loadAnimationAssets()}loadAnimationAssets(){for(let e=0;e<this._layers.length;e++){const t=this._layers[e];for(let i=0;i<t.states.length;i++){const s=t.states[i];if(Pb.indexOf(s)!==-1)continue;const n=this._animationAssets[`${t.name}:${s}`];if(!n||!n.asset){this.findAnimationLayer(t.name).assignAnimation(s,Jo.EMPTY);continue}const a=n.asset,o=this.system.app.assets.get(a);o&&(o.resource?this.onAnimationAssetLoaded(t.name,s,o):(o.once("load",(function(l,c){return(function(u){this.onAnimationAssetLoaded(l,c,u)}).bind(this)}).bind(this)(t.name,s)),this.system.app.assets.load(o)))}}}onAnimationAssetLoaded(e,t,i){this.findAnimationLayer(e).assignAnimation(t,i.resource)}removeStateGraph(){this._stateGraph=null,this._stateGraphAsset=null,this._animationAssets={},this._layers=[],this._layerIndices={},this._parameters={},this._playing=!1,this.unbind(),this._targets={}}reset(){this._assignParameters(this._stateGraph);for(let e=0;e<this._layers.length;e++){const t=this._layers[e].playing;this._layers[e].reset(),this._layers[e].playing=t}}unbind(){this._normalizeWeights||Object.keys(this._targets).forEach(e=>{this._targets[e].unbind()})}rebind(){this._targets={};for(let e=0;e<this._layers.length;e++)this._layers[e].rebind()}findAnimationLayer(e){const t=this._layerIndices[e];return this._layers[t]||null}addAnimationState(e,t,i=1,s=!0,n="Base"){var o;this._stateGraph||this.loadStateGraph(new hx({layers:[{name:n,states:[{name:"START",speed:1},{name:e,speed:i,loop:s,defaultState:!0}],transitions:[{from:"START",to:e}]}],parameters:{}}));const a=this.findAnimationLayer(n);a?a.assignAnimation(e,t,i,s):(o=this.addLayer(n))==null||o.assignAnimation(e,t,i,s)}assignAnimation(e,t,i,s=1,n=!0){if(!this._stateGraph&&e.indexOf(".")===-1){this.loadStateGraph(new hx({layers:[{name:"Base",states:[{name:"START",speed:1},{name:e,speed:s,loop:n,defaultState:!0}],transitions:[{from:"START",to:e}]}],parameters:{}})),this.baseLayer.assignAnimation(e,t);return}const a=i?this.findAnimationLayer(i):this.baseLayer;a&&a.assignAnimation(e,t,s,n)}removeNodeAnimations(e,t){const i=t?this.findAnimationLayer(t):this.baseLayer;i&&i.removeNodeAnimations(e)}getParameterValue(e,t){const i=this._parameters[e];if(i&&i.type===t)return i.value}setParameterValue(e,t,i){const s=this._parameters[e];if(s&&s.type===t){s.value=i;return}}getFloat(e){return this.getParameterValue(e,Iz)}setFloat(e,t){this.setParameterValue(e,Iz,t)}getInteger(e){return this.getParameterValue(e,Pz)}setInteger(e,t){typeof t=="number"&&t%1===0&&this.setParameterValue(e,Pz,t)}getBoolean(e){return this.getParameterValue(e,Mz)}setBoolean(e,t){this.setParameterValue(e,Mz,!!t)}getTrigger(e){return this.getParameterValue(e,ux)}setTrigger(e,t=!1){this.setParameterValue(e,ux,!0),t&&this._consumedTriggers.add(e)}resetTrigger(e){this.setParameterValue(e,ux,!1)}onBeforeRemove(){Number.isFinite(this._stateGraphAsset)&&this.system.app.assets.get(this._stateGraphAsset).off("change",this._onStateGraphAssetChangeEvent,this)}update(e){for(let t=0;t<this.layers.length;t++)this.layers[t].update(e*this.speed);this._consumedTriggers.forEach(t=>{this.parameters[t].value=!1}),this._consumedTriggers.clear()}resolveDuplicatedEntityReferenceProperties(e,t){e.rootBone&&t[e.rootBone.getGuid()]?this.rootBone=t[e.rootBone.getGuid()]:this.rebind()}constructor(...e){super(...e),this._stateGraphAsset=null,this._animationAssets={},this._speed=1,this._activate=!0,this._playing=!1,this._rootBone=null,this._stateGraph=null,this._layers=[],this._layerIndices={},this._parameters={},this._targets={},this._consumedTriggers=new Set,this._normalizeWeights=!1,this.findParameter=t=>this._parameters[t],this.consumeTrigger=t=>{this._consumedTriggers.add(t)}}}class RTe{constructor(){this.enabled=!0}}const WM=["enabled"];class DTe extends si{constructor(e){super(e),this.id="anim",this.ComponentType=oY,this.DataType=RTe,this.schema=WM,this.on("beforeremove",this.onBeforeRemove,this),this.app.systems.on("animationUpdate",this.onAnimationUpdate,this)}initializeComponentData(e,t,i){super.initializeComponentData(e,t,WM);const s=["animationAssets","stateGraph","layers","masks"];Object.keys(t).forEach(n=>{s.includes(n)||(e[n]=t[n])}),t.stateGraph&&(e.stateGraph=t.stateGraph,e.loadStateGraph(e.stateGraph)),t.layers&&t.layers.forEach((n,a)=>{n._controller.states.forEach(o=>{n._controller._states[o]._animationList.forEach(l=>{if(!l.animTrack||l.animTrack===Jo.EMPTY){const c=this.app.assets.get(n._component._animationAssets[`${n.name}:${l.name}`].asset);c&&!c.loaded&&c.once("load",()=>{e.layers[a].assignAnimation(l.name,c.resource)})}else e.layers[a].assignAnimation(l.name,l.animTrack)})})}),t.animationAssets&&(e.animationAssets=Object.assign(e.animationAssets,t.animationAssets)),t.masks&&Object.keys(t.masks).forEach(n=>{if(e.layers[n]){const a=t.masks[n].mask,o={};Object.keys(a).forEach(l=>{o[decodeURI(l)]=a[l]}),e.layers[n].mask=o}})}onAnimationUpdate(e){const t=this.store;for(const i in t)if(t.hasOwnProperty(i)){const s=t[i].entity.anim;s.data.enabled&&s.entity.enabled&&s.playing&&s.update(e)}}cloneComponent(e,t){let i;(!e.anim.rootBone||e.anim.rootBone===e)&&(i={},e.anim.layers.forEach((n,a)=>{if(n.mask){const o={};Object.keys(n.mask).forEach(l=>{const c=l.split("/");c.shift();const u=[t.name,...c].join("/");o[u]=n.mask[l]}),i[a]={mask:o}}}));const s={enabled:e.anim.enabled,stateGraphAsset:e.anim.stateGraphAsset,animationAssets:e.anim.animationAssets,speed:e.anim.speed,activate:e.anim.activate,playing:e.anim.playing,rootBone:e.anim.rootBone,stateGraph:e.anim.stateGraph,layers:e.anim.layers,layerIndices:e.anim.layerIndices,parameters:e.anim.parameters,normalizeWeights:e.anim.normalizeWeights,masks:i};return this.addComponent(t,s)}onBeforeRemove(e,t){t.onBeforeRemove()}destroy(){super.destroy(),this.app.systems.off("animationUpdate",this.onAnimationUpdate,this)}}ke._buildAccessors(oY.prototype,WM);class lY extends ke{setCurrentListener(){if(this.enabled&&this.entity.audiolistener&&this.entity.enabled){this.system.current=this.entity;const e=this.system.current.getPosition();this.system.manager.listener.setPosition(e)}}onEnable(){this.setCurrentListener()}onDisable(){this.system.current===this.entity&&(this.system.current=null)}}class LTe{constructor(){this.enabled=!0}}const cY=["enabled"];class OTe extends si{constructor(e){super(e),this.id="audiolistener",this.ComponentType=lY,this.DataType=LTe,this.schema=cY,this.manager=e.soundManager,this.current=null,this.app.systems.on("update",this.onUpdate,this)}initializeComponentData(e,t,i){i=["enabled"],super.initializeComponentData(e,t,i)}onUpdate(e){if(this.current){const t=this.current.getPosition();this.manager.listener.setPosition(t);const i=this.current.getWorldTransform();this.manager.listener.setOrientation(i)}}destroy(){super.destroy(),this.app.systems.off("update",this.onUpdate,this)}}ke._buildAccessors(lY.prototype,cY);const XM=0,Dz=1,dx="group",qM="image",uY="text",fx="stretch",NTe="contain",kTe="cover",hi={DEFAULT:"DEFAULT",HOVER:"HOVER",PRESSED:"PRESSED",INACTIVE:"INACTIVE"},Dy={};Dy[hi.DEFAULT]="_defaultTint";Dy[hi.HOVER]="hoverTint";Dy[hi.PRESSED]="pressedTint";Dy[hi.INACTIVE]="inactiveTint";const Ly={};Ly[hi.DEFAULT]="_defaultSpriteAsset";Ly[hi.HOVER]="hoverSpriteAsset";Ly[hi.PRESSED]="pressedSpriteAsset";Ly[hi.INACTIVE]="inactiveSpriteAsset";const Oy={};Oy[hi.DEFAULT]="_defaultSpriteFrame";Oy[hi.HOVER]="hoverSpriteFrame";Oy[hi.PRESSED]="pressedSpriteFrame";Oy[hi.INACTIVE]="inactiveSpriteFrame";const Mi=class Mi extends ke{constructor(e,t){super(e,t),this._visualState=hi.DEFAULT,this._isHovering=!1,this._hoveringCounter=0,this._isPressed=!1,this._defaultTint=new ae(1,1,1,1),this._defaultSpriteAsset=null,this._defaultSpriteFrame=0,this._imageEntity=null,this._evtElementAdd=null,this._evtImageEntityElementAdd=null,this._evtImageEntityElementRemove=null,this._evtImageEntityElementColor=null,this._evtImageEntityElementOpacity=null,this._evtImageEntityElementSpriteAsset=null,this._evtImageEntityElementSpriteFrame=null,this._visualState=hi.DEFAULT,this._isHovering=!1,this._hoveringCounter=0,this._isPressed=!1,this._defaultTint=new ae(1,1,1,1),this._defaultSpriteAsset=null,this._defaultSpriteFrame=0,this._toggleLifecycleListeners("on",e)}get data(){const e=this.system.store[this.entity.getGuid()];return e?e.data:null}set enabled(e){this._setValue("enabled",e)}get enabled(){return this.data.enabled}set active(e){this._setValue("active",e)}get active(){return this.data.active}set imageEntity(e){if(this._imageEntity!==e){const t=typeof e=="string";if(this._imageEntity&&t&&this._imageEntity.getGuid()===e)return;this._imageEntity&&this._imageEntityUnsubscribe(),e instanceof Xt?this._imageEntity=e:t?this._imageEntity=this.system.app.getEntityFromIndex(e)||null:this._imageEntity=null,this._imageEntity&&this._imageEntitySubscribe(),this._imageEntity?this.data.imageEntity=this._imageEntity.getGuid():t&&e&&(this.data.imageEntity=e)}}get imageEntity(){return this._imageEntity}set hitPadding(e){this._setValue("hitPadding",e)}get hitPadding(){return this.data.hitPadding}set transitionMode(e){this._setValue("transitionMode",e)}get transitionMode(){return this.data.transitionMode}set hoverTint(e){this._setValue("hoverTint",e)}get hoverTint(){return this.data.hoverTint}set pressedTint(e){this._setValue("pressedTint",e)}get pressedTint(){return this.data.pressedTint}set inactiveTint(e){this._setValue("inactiveTint",e)}get inactiveTint(){return this.data.inactiveTint}set fadeDuration(e){this._setValue("fadeDuration",e)}get fadeDuration(){return this.data.fadeDuration}set hoverSpriteAsset(e){this._setValue("hoverSpriteAsset",e)}get hoverSpriteAsset(){return this.data.hoverSpriteAsset}set hoverSpriteFrame(e){this._setValue("hoverSpriteFrame",e)}get hoverSpriteFrame(){return this.data.hoverSpriteFrame}set pressedSpriteAsset(e){this._setValue("pressedSpriteAsset",e)}get pressedSpriteAsset(){return this.data.pressedSpriteAsset}set pressedSpriteFrame(e){this._setValue("pressedSpriteFrame",e)}get pressedSpriteFrame(){return this.data.pressedSpriteFrame}set inactiveSpriteAsset(e){this._setValue("inactiveSpriteAsset",e)}get inactiveSpriteAsset(){return this.data.inactiveSpriteAsset}set inactiveSpriteFrame(e){this._setValue("inactiveSpriteFrame",e)}get inactiveSpriteFrame(){return this.data.inactiveSpriteFrame}_setValue(e,t){const i=this.data,s=i[e];i[e]=t,this.fire("set",e,s,t)}_toggleLifecycleListeners(e,t){var i;this[e]("set_active",this._onSetActive,this),this[e]("set_transitionMode",this._onSetTransitionMode,this),this[e]("set_hoverTint",this._onSetTransitionValue,this),this[e]("set_pressedTint",this._onSetTransitionValue,this),this[e]("set_inactiveTint",this._onSetTransitionValue,this),this[e]("set_hoverSpriteAsset",this._onSetTransitionValue,this),this[e]("set_hoverSpriteFrame",this._onSetTransitionValue,this),this[e]("set_pressedSpriteAsset",this._onSetTransitionValue,this),this[e]("set_pressedSpriteFrame",this._onSetTransitionValue,this),this[e]("set_inactiveSpriteAsset",this._onSetTransitionValue,this),this[e]("set_inactiveSpriteFrame",this._onSetTransitionValue,this),e==="on"?this._evtElementAdd=this.entity.on("element:add",this._onElementComponentAdd,this):((i=this._evtElementAdd)==null||i.off(),this._evtElementAdd=null)}_onSetActive(e,t,i){t!==i&&this._updateVisualState()}_onSetTransitionMode(e,t,i){t!==i&&(this._cancelTween(),this._resetToDefaultVisualState(t),this._forceReapplyVisualState())}_onSetTransitionValue(e,t,i){t!==i&&this._forceReapplyVisualState()}_imageEntitySubscribe(){this._evtImageEntityElementAdd=this._imageEntity.on("element:add",this._onImageElementGain,this),this._imageEntity.element&&this._onImageElementGain()}_imageEntityUnsubscribe(){var e,t;(e=this._evtImageEntityElementAdd)==null||e.off(),this._evtImageEntityElementAdd=null,(t=this._imageEntity)!=null&&t.element&&this._onImageElementLose()}_imageEntityElementSubscribe(){const e=this._imageEntity.element;this._evtImageEntityElementRemove=e.once("beforeremove",this._onImageElementLose,this),this._evtImageEntityElementColor=e.on("set:color",this._onSetColor,this),this._evtImageEntityElementOpacity=e.on("set:opacity",this._onSetOpacity,this),this._evtImageEntityElementSpriteAsset=e.on("set:spriteAsset",this._onSetSpriteAsset,this),this._evtImageEntityElementSpriteFrame=e.on("set:spriteFrame",this._onSetSpriteFrame,this)}_imageEntityElementUnsubscribe(){var e,t,i,s,n;(e=this._evtImageEntityElementRemove)==null||e.off(),this._evtImageEntityElementRemove=null,(t=this._evtImageEntityElementColor)==null||t.off(),this._evtImageEntityElementColor=null,(i=this._evtImageEntityElementOpacity)==null||i.off(),this._evtImageEntityElementOpacity=null,(s=this._evtImageEntityElementSpriteAsset)==null||s.off(),this._evtImageEntityElementSpriteAsset=null,(n=this._evtImageEntityElementSpriteFrame)==null||n.off(),this._evtImageEntityElementSpriteFrame=null}_onElementComponentRemove(){this._toggleHitElementListeners("off")}_onElementComponentAdd(){this._toggleHitElementListeners("on")}_onImageElementLose(){this._imageEntityElementUnsubscribe(),this._cancelTween(),this._resetToDefaultVisualState(this.transitionMode)}_onImageElementGain(){this._imageEntityElementSubscribe(),this._storeDefaultVisualState(),this._forceReapplyVisualState()}_toggleHitElementListeners(e){if(this.entity.element){const t=e==="on";if(t&&this._hasHitElementListeners)return;this.entity.element[e]("beforeremove",this._onElementComponentRemove,this),this.entity.element[e]("mouseenter",this._onMouseEnter,this),this.entity.element[e]("mouseleave",this._onMouseLeave,this),this.entity.element[e]("mousedown",this._onMouseDown,this),this.entity.element[e]("mouseup",this._onMouseUp,this),this.entity.element[e]("touchstart",this._onTouchStart,this),this.entity.element[e]("touchend",this._onTouchEnd,this),this.entity.element[e]("touchleave",this._onTouchLeave,this),this.entity.element[e]("touchcancel",this._onTouchCancel,this),this.entity.element[e]("selectstart",this._onSelectStart,this),this.entity.element[e]("selectend",this._onSelectEnd,this),this.entity.element[e]("selectenter",this._onSelectEnter,this),this.entity.element[e]("selectleave",this._onSelectLeave,this),this.entity.element[e]("click",this._onClick,this),this._hasHitElementListeners=t}}_storeDefaultVisualState(){var t;const e=(t=this._imageEntity)==null?void 0:t.element;!e||e.type===dx||(this._storeDefaultColor(e.color),this._storeDefaultOpacity(e.opacity),this._storeDefaultSpriteAsset(e.spriteAsset),this._storeDefaultSpriteFrame(e.spriteFrame))}_storeDefaultColor(e){this._defaultTint.r=e.r,this._defaultTint.g=e.g,this._defaultTint.b=e.b}_storeDefaultOpacity(e){this._defaultTint.a=e}_storeDefaultSpriteAsset(e){this._defaultSpriteAsset=e}_storeDefaultSpriteFrame(e){this._defaultSpriteFrame=e}_onSetColor(e){this._isApplyingTint||(this._storeDefaultColor(e),this._forceReapplyVisualState())}_onSetOpacity(e){this._isApplyingTint||(this._storeDefaultOpacity(e),this._forceReapplyVisualState())}_onSetSpriteAsset(e){this._isApplyingSprite||(this._storeDefaultSpriteAsset(e),this._forceReapplyVisualState())}_onSetSpriteFrame(e){this._isApplyingSprite||(this._storeDefaultSpriteFrame(e),this._forceReapplyVisualState())}_onMouseEnter(e){this._isHovering=!0,this._updateVisualState(),this._fireIfActive("mouseenter",e)}_onMouseLeave(e){this._isHovering=!1,this._isPressed=!1,this._updateVisualState(),this._fireIfActive("mouseleave",e)}_onMouseDown(e){this._isPressed=!0,this._updateVisualState(),this._fireIfActive("mousedown",e)}_onMouseUp(e){this._isPressed=!1,this._updateVisualState(),this._fireIfActive("mouseup",e)}_onTouchStart(e){this._isPressed=!0,this._updateVisualState(),this._fireIfActive("touchstart",e)}_onTouchEnd(e){e.event.preventDefault(),this._isPressed=!1,this._updateVisualState(),this._fireIfActive("touchend",e)}_onTouchLeave(e){this._isPressed=!1,this._updateVisualState(),this._fireIfActive("touchleave",e)}_onTouchCancel(e){this._isPressed=!1,this._updateVisualState(),this._fireIfActive("touchcancel",e)}_onSelectStart(e){this._isPressed=!0,this._updateVisualState(),this._fireIfActive("selectstart",e)}_onSelectEnd(e){this._isPressed=!1,this._updateVisualState(),this._fireIfActive("selectend",e)}_onSelectEnter(e){this._hoveringCounter++,this._hoveringCounter===1&&(this._isHovering=!0,this._updateVisualState()),this._fireIfActive("selectenter",e)}_onSelectLeave(e){this._hoveringCounter--,this._hoveringCounter===0&&(this._isHovering=!1,this._isPressed=!1,this._updateVisualState()),this._fireIfActive("selectleave",e)}_onClick(e){this._fireIfActive("click",e)}_fireIfActive(e,t){this.data.active&&this.fire(e,t)}_updateVisualState(e){const t=this._visualState,i=this._determineVisualState();if((t!==i||e)&&this.enabled)switch(this._visualState=i,t===hi.HOVER&&this._fireIfActive("hoverend"),t===hi.PRESSED&&this._fireIfActive("pressedend"),i===hi.HOVER&&this._fireIfActive("hoverstart"),i===hi.PRESSED&&this._fireIfActive("pressedstart"),this.transitionMode){case XM:{const s=Dy[this._visualState],n=this[s];this._applyTint(n);break}case Dz:{const s=Ly[this._visualState],n=Oy[this._visualState],a=this[s],o=this[n];this._applySprite(a,o);break}}}_forceReapplyVisualState(){this._updateVisualState(!0)}_resetToDefaultVisualState(e){var t;if((t=this._imageEntity)!=null&&t.element)switch(e){case XM:this._cancelTween(),this._applyTintImmediately(this._defaultTint);break;case Dz:this._applySprite(this._defaultSpriteAsset,this._defaultSpriteFrame);break}}_determineVisualState(){if(this.active){if(this._isPressed)return hi.PRESSED;if(this._isHovering)return hi.HOVER}else return hi.INACTIVE;return hi.DEFAULT}_applySprite(e,t){var s;const i=(s=this._imageEntity)==null?void 0:s.element;i&&(t=t||0,this._isApplyingSprite=!0,i.spriteAsset!==e&&(i.spriteAsset=e),i.spriteFrame!==t&&(i.spriteFrame=t),this._isApplyingSprite=!1)}_applyTint(e){this._cancelTween(),this.fadeDuration===0?this._applyTintImmediately(e):this._applyTintWithTween(e)}_applyTintImmediately(e){var s;const t=(s=this._imageEntity)==null?void 0:s.element;if(!e||!t||t.type===dx)return;const i=Lz(e);this._isApplyingTint=!0,i.equals(t.color)||(t.color=i),t.opacity!==e.a&&(t.opacity=e.a),this._isApplyingTint=!1}_applyTintWithTween(e){var a;const t=(a=this._imageEntity)==null?void 0:a.element;if(!e||!t||t.type===dx)return;const i=Lz(e),s=t.color,n=t.opacity;i.equals(s)&&e.a===n||(this._tweenInfo={startTime:Qo(),from:new ae(s.r,s.g,s.b,n),to:e.clone(),lerpColor:new ae})}_updateTintTween(){const e=Qo()-this._tweenInfo.startTime;let t=this.fadeDuration===0?1:e/this.fadeDuration;if(t=Q.clamp(t,0,1),Math.abs(t-1)>1e-5){const i=this._tweenInfo.lerpColor;i.lerp(this._tweenInfo.from,this._tweenInfo.to,t),this._applyTintImmediately(new ae(i.r,i.g,i.b,i.a))}else this._applyTintImmediately(this._tweenInfo.to),this._cancelTween()}_cancelTween(){delete this._tweenInfo}onUpdate(){this._tweenInfo&&this._updateTintTween()}onEnable(){this._isHovering=!1,this._hoveringCounter=0,this._isPressed=!1,this._toggleHitElementListeners("on"),this._forceReapplyVisualState()}onDisable(){this._toggleHitElementListeners("off"),this._resetToDefaultVisualState(this.transitionMode)}onRemove(){this._imageEntityUnsubscribe(),this._toggleLifecycleListeners("off",this.system),this.onDisable()}resolveDuplicatedEntityReferenceProperties(e,t){e.imageEntity&&(this.imageEntity=t[e.imageEntity.getGuid()])}};Mi.EVENT_MOUSEDOWN="mousedown",Mi.EVENT_MOUSEUP="mouseup",Mi.EVENT_MOUSEENTER="mouseenter",Mi.EVENT_MOUSELEAVE="mouseleave",Mi.EVENT_CLICK="click",Mi.EVENT_TOUCHSTART="touchstart",Mi.EVENT_TOUCHEND="touchend",Mi.EVENT_TOUCHCANCEL="touchcancel",Mi.EVENT_TOUCHLEAVE="touchleave",Mi.EVENT_SELECTSTART="selectstart",Mi.EVENT_SELECTEND="selectend",Mi.EVENT_SELECTENTER="selectenter",Mi.EVENT_SELECTLEAVE="selectleave",Mi.EVENT_HOVERSTART="hoverstart",Mi.EVENT_HOVEREND="hoverend",Mi.EVENT_PRESSEDSTART="pressedstart",Mi.EVENT_PRESSEDEND="pressedend";let YM=Mi;function Lz(r){return new ae(r.r,r.g,r.b)}class FTe{constructor(){this.enabled=!0,this.active=!0,this.imageEntity=null,this.hitPadding=new ce,this.transitionMode=XM,this.hoverTint=new ae(.75,.75,.75),this.pressedTint=new ae(.5,.5,.5),this.inactiveTint=new ae(.25,.25,.25),this.fadeDuration=0,this.hoverSpriteAsset=null,this.hoverSpriteFrame=0,this.pressedSpriteAsset=null,this.pressedSpriteFrame=0,this.inactiveSpriteAsset=null,this.inactiveSpriteFrame=0}}const Oz=["enabled","active",{name:"hitPadding",type:"vec4"},"transitionMode",{name:"hoverTint",type:"rgba"},{name:"pressedTint",type:"rgba"},{name:"inactiveTint",type:"rgba"},"fadeDuration","hoverSpriteAsset","hoverSpriteFrame","pressedSpriteAsset","pressedSpriteFrame","inactiveSpriteAsset","inactiveSpriteFrame"];class BTe extends si{constructor(e){super(e),this.id="button",this.ComponentType=YM,this.DataType=FTe,this.schema=Oz,this.on("beforeremove",this._onRemoveComponent,this),this.app.systems.on("update",this.onUpdate,this)}initializeComponentData(e,t,i){e.imageEntity=t.imageEntity,super.initializeComponentData(e,t,Oz)}onUpdate(e){const t=this.store;for(const i in t){const s=t[i].entity,n=s.button;n.enabled&&s.enabled&&n.onUpdate()}}_onRemoveComponent(e,t){t.onRemove()}destroy(){super.destroy(),this.app.systems.off("update",this.onUpdate,this)}}const Nz=new O,kz=new de,vu=class vu extends ke{constructor(e,t){super(e,t),this._compoundParent=null,this._hasOffset=!1,this.entity.on("insert",this._onInsert,this),this.on("set_type",this.onSetType,this),this.on("set_convexHull",this.onSetModel,this),this.on("set_halfExtents",this.onSetHalfExtents,this),this.on("set_linearOffset",this.onSetOffset,this),this.on("set_angularOffset",this.onSetOffset,this),this.on("set_radius",this.onSetRadius,this),this.on("set_height",this.onSetHeight,this),this.on("set_axis",this.onSetAxis,this),this.on("set_asset",this.onSetAsset,this),this.on("set_renderAsset",this.onSetRenderAsset,this),this.on("set_model",this.onSetModel,this),this.on("set_render",this.onSetRender,this)}get data(){const e=this.system.store[this.entity.getGuid()];return e?e.data:null}set enabled(e){this._setValue("enabled",e)}get enabled(){return this.data.enabled}set type(e){this._setValue("type",e)}get type(){return this.data.type}set halfExtents(e){this._setValue("halfExtents",e)}get halfExtents(){return this.data.halfExtents}set linearOffset(e){this._setValue("linearOffset",e)}get linearOffset(){return this.data.linearOffset}set angularOffset(e){this._setValue("angularOffset",e)}get angularOffset(){return this.data.angularOffset}set radius(e){this._setValue("radius",e)}get radius(){return this.data.radius}set axis(e){this._setValue("axis",e)}get axis(){return this.data.axis}set height(e){this._setValue("height",e)}get height(){return this.data.height}set asset(e){this._setValue("asset",e)}get asset(){return this.data.asset}set renderAsset(e){this._setValue("renderAsset",e)}get renderAsset(){return this.data.renderAsset}set convexHull(e){this._setValue("convexHull",e)}get convexHull(){return this.data.convexHull}set shape(e){this._setValue("shape",e)}get shape(){return this.data.shape}set model(e){this._setValue("model",e)}get model(){return this.data.model}set render(e){this._setValue("render",e)}get render(){return this.data.render}set checkVertexDuplicates(e){this._setValue("checkVertexDuplicates",e)}get checkVertexDuplicates(){return this.data.checkVertexDuplicates}_setValue(e,t){const i=this.data,s=i[e];i[e]=t,this.fire("set",e,s,t)}onSetType(e,t,i){t!==i&&this.system.changeType(this,t,i)}onSetHalfExtents(e,t,i){const s=this.data.type;this.data.initialized&&s==="box"&&this.system.recreatePhysicalShapes(this)}onSetOffset(e,t,i){this._hasOffset=!this.data.linearOffset.equals(O.ZERO)||!this.data.angularOffset.equals(de.IDENTITY),this.data.initialized&&this.system.recreatePhysicalShapes(this)}onSetRadius(e,t,i){const s=this.data.type;this.data.initialized&&(s==="sphere"||s==="capsule"||s==="cylinder"||s==="cone")&&this.system.recreatePhysicalShapes(this)}onSetHeight(e,t,i){const s=this.data.type;this.data.initialized&&(s==="capsule"||s==="cylinder"||s==="cone")&&this.system.recreatePhysicalShapes(this)}onSetAxis(e,t,i){const s=this.data.type;this.data.initialized&&(s==="capsule"||s==="cylinder"||s==="cone")&&this.system.recreatePhysicalShapes(this)}onSetAsset(e,t,i){const s=this.system.app.assets;if(t){const n=s.get(t);n&&n.off("remove",this.onAssetRemoved,this)}if(i){i instanceof be&&(this.data.asset=i.id);const n=s.get(this.data.asset);n&&(n.off("remove",this.onAssetRemoved,this),n.on("remove",this.onAssetRemoved,this))}this.data.initialized&&this.data.type==="mesh"&&(i||(this.data.model=null),this.system.recreatePhysicalShapes(this))}onSetRenderAsset(e,t,i){const s=this.system.app.assets;if(t){const n=s.get(t);n&&n.off("remove",this.onRenderAssetRemoved,this)}if(i){i instanceof be&&(this.data.renderAsset=i.id);const n=s.get(this.data.renderAsset);n&&(n.off("remove",this.onRenderAssetRemoved,this),n.on("remove",this.onRenderAssetRemoved,this))}this.data.initialized&&this.data.type==="mesh"&&(i||(this.data.render=null),this.system.recreatePhysicalShapes(this))}onSetModel(e,t,i){this.data.initialized&&this.data.type==="mesh"&&this.system.implementations.mesh.doRecreatePhysicalShape(this)}onSetRender(e,t,i){this.onSetModel(e,t,i)}onAssetRemoved(e){e.off("remove",this.onAssetRemoved,this),this.data.asset===e.id&&(this.asset=null)}onRenderAssetRemoved(e){e.off("remove",this.onRenderAssetRemoved,this),this.data.renderAsset===e.id&&(this.renderAsset=null)}getCompoundChildShapeIndex(e){const t=this.data.shape,i=t.getNumChildShapes();for(let s=0;s<i;s++){const n=t.getChildShape(s);if(Ammo.getPointer(n)===Ammo.getPointer(e))return s}return null}_onInsert(e){if(!(typeof Ammo>"u")){if(this._compoundParent)this.system.recreatePhysicalShapes(this);else if(!this.entity.rigidbody){let t=this.entity.parent;for(;t;){if(t.collision&&t.collision.type==="compound"){t.collision.shape.getNumChildShapes()===0?this.system.recreatePhysicalShapes(t.collision):this.system.recreatePhysicalShapes(this);break}t=t.parent}}}}_updateCompound(){const e=this.entity;if(e._dirtyWorld){let t=e._dirtyLocal,i=e;for(;i&&!t&&!(i.collision&&i.collision===this._compoundParent);)i._dirtyLocal&&(t=!0),i=i.parent;if(t){e.forEach(this.system.implementations.compound._updateEachDescendantTransform,e);const s=this._compoundParent.entity.rigidbody;s&&s.activate()}}}getShapePosition(){const e=this.entity.getPosition();if(this._hasOffset){const t=this.entity.getRotation(),i=this.data.linearOffset;return kz.copy(t).transformVector(i,Nz),Nz.add(e)}return e}getShapeRotation(){const e=this.entity.getRotation();return this._hasOffset?kz.copy(e).mul(this.data.angularOffset):e}onEnable(){if(this.data.type==="mesh"&&(this.data.asset||this.data.renderAsset)&&this.data.initialized){const e=this.system.app.assets.get(this.data.asset||this.data.renderAsset);if(e&&(!e.resource||!this.data.shape)){this.system.recreatePhysicalShapes(this);return}}if(this.entity.rigidbody)this.entity.rigidbody.enabled&&this.entity.rigidbody.enableSimulation();else if(this._compoundParent&&this!==this._compoundParent)if(this._compoundParent.shape.getNumChildShapes()===0)this.system.recreatePhysicalShapes(this._compoundParent);else{const e=this.system._getNodeTransform(this.entity,this._compoundParent.entity);this._compoundParent.shape.addChildShape(e,this.data.shape),Ammo.destroy(e),this._compoundParent.entity.rigidbody&&this._compoundParent.entity.rigidbody.activate()}else this.entity.trigger&&this.entity.trigger.enable()}onDisable(){this.entity.rigidbody?this.entity.rigidbody.disableSimulation():this._compoundParent&&this!==this._compoundParent?this._compoundParent.entity._destroying||(this.system._removeCompoundChild(this._compoundParent,this.data.shape),this._compoundParent.entity.rigidbody&&this._compoundParent.entity.rigidbody.activate()):this.entity.trigger&&this.entity.trigger.disable()}onBeforeRemove(){this.asset&&(this.asset=null),this.renderAsset&&(this.renderAsset=null),this.entity.off("insert",this._onInsert,this),this.off()}};vu.EVENT_CONTACT="contact",vu.EVENT_COLLISIONSTART="collisionstart",vu.EVENT_COLLISIONEND="collisionend",vu.EVENT_TRIGGERENTER="triggerenter",vu.EVENT_TRIGGERLEAVE="triggerleave";let KM=vu;class UTe{constructor(){this.enabled=!0,this.type="box",this.halfExtents=new O(.5,.5,.5),this.linearOffset=new O,this.angularOffset=new de,this.radius=.5,this.axis=1,this.height=2,this.convexHull=!1,this.asset=null,this.renderAsset=null,this.checkVertexDuplicates=!0,this.shape=null,this.model=null,this.render=null,this.initialized=!1}}const og="static",xn="dynamic",dd="kinematic",zTe=2,Ig=4,ZM=1,Fz=4,hY=5,VTe=1,Bz=2,jTe=4,Uz=16,zz=65535,QM=65533;let bn,Xc,fd,dY=class{constructor(e,t,i){this.entity=t.entity,this.component=t,this.app=e,typeof Ammo<"u"&&!bn&&(bn=new Ammo.btVector3,Xc=new Ammo.btQuaternion,fd=new Ammo.btTransform),this.initialize(i)}initialize(e){const t=this.entity,i=e.shape;if(i&&typeof Ammo<"u"){t.trigger&&t.trigger.destroy();const s=1,n=this.component;if(n){const o=n.getShapePosition(),l=n.getShapeRotation();bn.setValue(o.x,o.y,o.z),Xc.setValue(l.x,l.y,l.z,l.w)}else{const o=t.getPosition(),l=t.getRotation();bn.setValue(o.x,o.y,o.z),Xc.setValue(l.x,l.y,l.z,l.w)}fd.setOrigin(bn),fd.setRotation(Xc);const a=this.app.systems.rigidbody.createBody(s,i,fd);a.setRestitution(0),a.setFriction(0),a.setDamping(0,0),bn.setValue(0,0,0),a.setLinearFactor(bn),a.setAngularFactor(bn),a.setCollisionFlags(a.getCollisionFlags()|Ig),a.entity=t,this.body=a,this.component.enabled&&t.enabled&&this.enable()}}destroy(){this.body&&(this.disable(),this.app.systems.rigidbody.destroyBody(this.body),this.body=null)}_getEntityTransform(e){const t=this.component;if(t){const i=t.getShapePosition(),s=t.getShapeRotation();bn.setValue(i.x,i.y,i.z),Xc.setValue(s.x,s.y,s.z,s.w)}else{const i=this.entity.getPosition(),s=this.entity.getRotation();bn.setValue(i.x,i.y,i.z),Xc.setValue(s.x,s.y,s.z,s.w)}e.setOrigin(bn),e.setRotation(Xc)}updateTransform(){this._getEntityTransform(fd);const e=this.body;e.setWorldTransform(fd),e.activate()}enable(){const e=this.body;if(!e)return;const t=this.app.systems.rigidbody;t._triggers.indexOf(this)<0&&(t.addBody(e,Uz,QM^Uz),t._triggers.push(this)),e.forceActivationState(ZM),this.updateTransform()}disable(){const e=this.body;if(!e)return;const t=this.app.systems.rigidbody,i=t._triggers.indexOf(this);i>-1&&(t.removeBody(e),t._triggers.splice(i,1)),e.forceActivationState(hY)}};const sS=new se,$Te=new O,HTe=new O,qc=new de,Vz=new Xt,GTe=["enabled","type","halfExtents","linearOffset","angularOffset","radius","axis","height","convexHull","asset","renderAsset","shape","model","render","checkVertexDuplicates"];class kh{constructor(e){this.system=e}beforeInitialize(e,t){t.shape=null,t.model=new al,t.model.graph=new Xt}afterInitialize(e,t){this.recreatePhysicalShapes(e),e.data.initialized=!0}reset(e,t){this.beforeInitialize(e,t),this.afterInitialize(e,t)}recreatePhysicalShapes(e){const t=e.entity,i=e.data;if(typeof Ammo<"u"){t.trigger&&(t.trigger.destroy(),delete t.trigger),i.shape&&(e._compoundParent&&(e!==e._compoundParent&&this.system._removeCompoundChild(e._compoundParent,i.shape),e._compoundParent.entity.rigidbody&&e._compoundParent.entity.rigidbody.activate()),this.destroyShape(i)),i.shape=this.createPhysicalShape(e.entity,i);const s=!e._compoundParent;if(i.type==="compound"&&(!e._compoundParent||e===e._compoundParent))e._compoundParent=e,t.forEach(this._addEachDescendant,e);else if(i.type!=="compound"&&!e.rigidbody){e._compoundParent=null;let n=t.parent;for(;n;){if(n.collision&&n.collision.type==="compound"){e._compoundParent=n.collision;break}n=n.parent}}e._compoundParent&&e!==e._compoundParent&&(s&&e._compoundParent.shape.getNumChildShapes()===0?this.system.recreatePhysicalShapes(e._compoundParent):(this.system.updateCompoundChildTransform(t,!0),e._compoundParent.entity.rigidbody&&e._compoundParent.entity.rigidbody.activate())),t.rigidbody?(t.rigidbody.disableSimulation(),t.rigidbody.createBody(),t.enabled&&t.rigidbody.enabled&&t.rigidbody.enableSimulation()):e._compoundParent||(t.trigger?t.trigger.initialize(i):t.trigger=new dY(this.system.app,e,i))}}createPhysicalShape(e,t){}updateTransform(e,t,i,s){e.entity.trigger&&e.entity.trigger.updateTransform()}destroyShape(e){e.shape&&(Ammo.destroy(e.shape),e.shape=null)}beforeRemove(e,t){t.data.shape&&(t._compoundParent&&!t._compoundParent.entity._destroying&&(this.system._removeCompoundChild(t._compoundParent,t.data.shape),t._compoundParent.entity.rigidbody&&t._compoundParent.entity.rigidbody.activate()),t._compoundParent=null,this.destroyShape(t.data))}remove(e,t){e.rigidbody&&e.rigidbody.body&&e.rigidbody.disableSimulation(),e.trigger&&(e.trigger.destroy(),delete e.trigger)}clone(e,t){const i=this.system.store[e.getGuid()],s={enabled:i.data.enabled,type:i.data.type,halfExtents:[i.data.halfExtents.x,i.data.halfExtents.y,i.data.halfExtents.z],linearOffset:[i.data.linearOffset.x,i.data.linearOffset.y,i.data.linearOffset.z],angularOffset:[i.data.angularOffset.x,i.data.angularOffset.y,i.data.angularOffset.z,i.data.angularOffset.w],radius:i.data.radius,axis:i.data.axis,height:i.data.height,convexHull:i.data.convexHull,asset:i.data.asset,renderAsset:i.data.renderAsset,model:i.data.model,render:i.data.render,checkVertexDuplicates:i.data.checkVertexDuplicates};return this.system.addComponent(t,s)}}class WTe extends kh{createPhysicalShape(e,t){if(typeof Ammo<"u"){const i=t.halfExtents,s=new Ammo.btVector3(i?i.x:.5,i?i.y:.5,i?i.z:.5),n=new Ammo.btBoxShape(s);return Ammo.destroy(s),n}}}class XTe extends kh{createPhysicalShape(e,t){if(typeof Ammo<"u")return new Ammo.btSphereShape(t.radius)}}class qTe extends kh{createPhysicalShape(e,t){const i=t.axis??1,s=t.radius??.5,n=Math.max((t.height??2)-2*s,0);let a=null;if(typeof Ammo<"u")switch(i){case 0:a=new Ammo.btCapsuleShapeX(s,n);break;case 1:a=new Ammo.btCapsuleShape(s,n);break;case 2:a=new Ammo.btCapsuleShapeZ(s,n);break}return a}}class YTe extends kh{createPhysicalShape(e,t){const i=t.axis??1,s=t.radius??.5,n=t.height??1;let a=null,o=null;if(typeof Ammo<"u")switch(i){case 0:a=new Ammo.btVector3(n*.5,s,s),o=new Ammo.btCylinderShapeX(a);break;case 1:a=new Ammo.btVector3(s,n*.5,s),o=new Ammo.btCylinderShape(a);break;case 2:a=new Ammo.btVector3(s,s,n*.5),o=new Ammo.btCylinderShapeZ(a);break}return a&&Ammo.destroy(a),o}}class KTe extends kh{createPhysicalShape(e,t){const i=t.axis??1,s=t.radius??.5,n=t.height??1;let a=null;if(typeof Ammo<"u")switch(i){case 0:a=new Ammo.btConeShapeX(s,n);break;case 1:a=new Ammo.btConeShape(s,n);break;case 2:a=new Ammo.btConeShapeZ(s,n);break}return a}}class ZTe extends kh{beforeInitialize(e,t){}createAmmoHull(e,t,i,s){const n=new Ammo.btConvexHullShape,a=new Ammo.btVector3,o=[];e.getPositions(o);for(let c=0;c<o.length;c+=3)a.setValue(o[c]*s.x,o[c+1]*s.y,o[c+2]*s.z),n.addPoint(a,!1);Ammo.destroy(a),n.recalcLocalAabb(),n.setMargin(.01);const l=this.system._getNodeTransform(t);i.addChildShape(l,n),Ammo.destroy(l)}createAmmoMesh(e,t,i,s,n=!0){const a=this.system;let o;if(a._triMeshCache[e.id])o=a._triMeshCache[e.id];else{const u=e.vertexBuffer,h=u.getFormat();let d,f;for(let I=0;I<h.elements.length;I++){const M=h.elements[I];if(M.name===Xe){f=new Float32Array(u.lock(),M.offset),d=M.stride/4;break}}const p=[];e.getIndices(p);const m=e.primitive[0].count/3,g=new Ammo.btVector3;let _,v,y;const x=e.primitive[0].base;o=new Ammo.btTriangleMesh,a._triMeshCache[e.id]=o;const S=new Map,w=o.getIndexedMeshArray();w.at(0).m_numTriangles=m;const T=s?s.x:1,A=s?s.y:1,C=s?s.z:1,P=I=>{const M=f[I*d]*T,N=f[I*d+1]*A,k=f[I*d+2]*C;let V;if(n){const B=`${M}:${N}:${k}`;if(V=S.get(B),V!==void 0)return V;g.setValue(M,N,k),V=o.findOrAddVertex(g,!1),S.set(B,V)}else g.setValue(M,N,k),V=o.findOrAddVertex(g,!1);return V};for(let I=0;I<m;I++)_=P(p[x+I*3]),v=P(p[x+I*3+1]),y=P(p[x+I*3+2]),o.addIndex(_),o.addIndex(v),o.addIndex(y);Ammo.destroy(g)}const l=new Ammo.btBvhTriangleMeshShape(o,!0);if(!s){const u=a._getNodeScaling(t);l.setLocalScaling(u),Ammo.destroy(u)}const c=a._getNodeTransform(t);i.addChildShape(c,l),Ammo.destroy(c)}createPhysicalShape(e,t){if(!(typeof Ammo>"u")&&(t.model||t.render)){const i=new Ammo.btCompoundShape,n=e.getWorldTransform().getScale();if(t.render){const a=t.render.meshes;for(let o=0;o<a.length;o++)t.convexHull?this.createAmmoHull(a[o],Vz,i,n):this.createAmmoMesh(a[o],Vz,i,n,t.checkVertexDuplicates)}else if(t.model){const a=t.model.meshInstances;for(let l=0;l<a.length;l++)this.createAmmoMesh(a[l].mesh,a[l].node,i,null,t.checkVertexDuplicates);const o=new Ammo.btVector3(n.x,n.y,n.z);i.setLocalScaling(o),Ammo.destroy(o)}return i}}recreatePhysicalShapes(e){const t=e.data;if((t.renderAsset||t.asset)&&e.enabled&&e.entity.enabled){this.loadAsset(e,t.renderAsset||t.asset,t.renderAsset?"render":"model");return}this.doRecreatePhysicalShape(e)}loadAsset(e,t,i){const s=e.data,n=this.system.app.assets,a=s[i],o=u=>{s[i]===a&&(s[i]=u.resource,this.doRecreatePhysicalShape(e))},l=u=>{u.ready(h=>{if(h.data.containerAsset){const d=n.get(h.data.containerAsset);d.loaded?o(h):(d.ready(()=>{o(h)}),n.load(d))}else o(h)}),n.load(u)},c=n.get(t);c?l(c):n.once(`add:${t}`,l)}doRecreatePhysicalShape(e){const t=e.entity,i=e.data;i.model||i.render?(this.destroyShape(i),i.shape=this.createPhysicalShape(t,i),t.rigidbody?(t.rigidbody.disableSimulation(),t.rigidbody.createBody(),t.enabled&&t.rigidbody.enabled&&t.rigidbody.enableSimulation()):t.trigger?t.trigger.initialize(i):t.trigger=new dY(this.system.app,e,i)):(this.beforeRemove(t,e),this.remove(t,i))}updateTransform(e,t,i,s){if(e.shape){const a=e.entity.getWorldTransform().getScale(),o=e.shape.getLocalScaling();(a.x!==o.x()||a.y!==o.y()||a.z!==o.z())&&this.doRecreatePhysicalShape(e)}super.updateTransform(e,t,i,s)}destroyShape(e){if(!e.shape)return;const t=e.shape.getNumChildShapes();for(let i=0;i<t;i++){const s=e.shape.getChildShape(i);Ammo.destroy(s)}Ammo.destroy(e.shape),e.shape=null}}class QTe extends kh{createPhysicalShape(e,t){if(typeof Ammo<"u")return new Ammo.btCompoundShape}_addEachDescendant(e){!e.collision||e.rigidbody||(e.collision._compoundParent=this,e!==this.entity&&e.collision.system.recreatePhysicalShapes(e.collision))}_updateEachDescendant(e){e.collision&&e.collision._compoundParent===this&&(e.collision._compoundParent=null,e!==this.entity&&!e.rigidbody&&e.collision.system.recreatePhysicalShapes(e.collision))}_updateEachDescendantTransform(e){!e.collision||e.collision._compoundParent!==this.collision._compoundParent||this.collision.system.updateCompoundChildTransform(e,!1)}}class JTe extends si{constructor(e){super(e),this.id="collision",this.ComponentType=KM,this.DataType=UTe,this.schema=GTe,this.implementations={},this._triMeshCache={},this.on("beforeremove",this.onBeforeRemove,this),this.on("remove",this.onRemove,this)}initializeComponentData(e,t,i){i=["type","halfExtents","radius","axis","height","convexHull","shape","model","asset","render","renderAsset","enabled","linearOffset","angularOffset","checkVertexDuplicates"];const s={};for(let o=0,l=i.length;o<l;o++){const c=i[o];s[c]=t[c]}let n;if(t.hasOwnProperty("asset")?(n=i.indexOf("model"),n!==-1&&i.splice(n,1),n=i.indexOf("render"),n!==-1&&i.splice(n,1)):t.hasOwnProperty("model")&&(n=i.indexOf("asset"),n!==-1&&i.splice(n,1)),s.type||(s.type=e.data.type),e.data.type=s.type,Array.isArray(s.halfExtents)&&(s.halfExtents=new O(s.halfExtents)),Array.isArray(s.linearOffset)&&(s.linearOffset=new O(s.linearOffset)),Array.isArray(s.angularOffset)){const o=s.angularOffset;o.length===3?s.angularOffset=new de().setFromEulerAngles(o[0],o[1],o[2]):s.angularOffset=new de(s.angularOffset)}const a=this._createImplementation(s.type);a.beforeInitialize(e,s),super.initializeComponentData(e,s,i),a.afterInitialize(e,s)}_createImplementation(e){if(this.implementations[e]===void 0){let t;switch(e){case"box":t=new WTe(this);break;case"sphere":t=new XTe(this);break;case"capsule":t=new qTe(this);break;case"cylinder":t=new YTe(this);break;case"cone":t=new KTe(this);break;case"mesh":t=new ZTe(this);break;case"compound":t=new QTe(this);break}this.implementations[e]=t}return this.implementations[e]}_getImplementation(e){return this.implementations[e.collision.data.type]}cloneComponent(e,t){return this._getImplementation(e).clone(e,t)}onBeforeRemove(e,t){this.implementations[t.data.type].beforeRemove(e,t),t.onBeforeRemove()}onRemove(e,t){this.implementations[t.type].remove(e,t)}updateCompoundChildTransform(e,t){const i=e.collision._compoundParent;if(i!==e.collision&&e.enabled&&e.collision.enabled&&(e._dirtyLocal||t)){const s=this._getNodeTransform(e,i.entity),n=i.getCompoundChildShapeIndex(e.collision.shape);n===null?i.shape.addChildShape(s,e.collision.data.shape):i.shape.updateChildTransform(n,s,!0),Ammo.destroy(s)}}_removeCompoundChild(e,t){if(e.shape.getNumChildShapes()!==0)if(e.shape.removeChildShape)e.shape.removeChildShape(t);else{const i=e.getCompoundChildShapeIndex(t);i!==null&&e.shape.removeChildShapeByIndex(i)}}onTransformChanged(e,t,i,s){this.implementations[e.data.type].updateTransform(e,t,i,s)}changeType(e,t,i){this.implementations[t].beforeRemove(e.entity,e),this.implementations[t].remove(e.entity,e.data),this._createImplementation(i).reset(e,e.data)}recreatePhysicalShapes(e){this.implementations[e.data.type].recreatePhysicalShapes(e)}_calculateNodeRelativeTransform(e,t){if(e===t){const i=e.getWorldTransform().getScale();sS.setScale(i.x,i.y,i.z)}else this._calculateNodeRelativeTransform(e.parent,t),sS.mul(e.getLocalTransform())}_getNodeScaling(e){const i=e.getWorldTransform().getScale();return new Ammo.btVector3(i.x,i.y,i.z)}_getNodeTransform(e,t){let i,s;t?(this._calculateNodeRelativeTransform(e,t),i=$Te,s=qc,sS.getTranslation(i),s.setFromMat4(sS)):(i=e.getPosition(),s=e.getRotation());const n=new Ammo.btQuaternion,a=new Ammo.btTransform;a.setIdentity();const o=a.getOrigin(),l=e.collision;if(l&&l._hasOffset){const c=l.data.linearOffset,u=l.data.angularOffset,h=HTe;qc.copy(s).transformVector(c,h),h.add(i),qc.copy(s).mul(u),o.setValue(h.x,h.y,h.z),n.setValue(qc.x,qc.y,qc.z,qc.w)}else o.setValue(i.x,i.y,i.z),n.setValue(s.x,s.y,s.z,s.w);return a.setRotation(n),Ammo.destroy(n),a}destroy(){for(const e in this._triMeshCache)Ammo.destroy(this._triMeshCache[e]);this._triMeshCache=null,super.destroy()}}const nS=new ae,eEe=new jr;class tEe{constructor(e,t,i){this._entity=e,this._element=e.element,this.model=new al,this.node=new Xt,this.model.graph=this.node,this.mesh=t,this.meshInstance=new Dt(this.mesh,i,this.node),this.meshInstance.name=`ImageElement: ${e.name}`,this.meshInstance.castShadow=!1,this.meshInstance.receiveShadow=!1,this._meshDirty=!1,this.model.meshInstances.push(this.meshInstance),this._entity.addChild(this.model.graph),this.model._entity=this._entity,this.unmaskMeshInstance=null}destroy(){var e,t;this.setMaterial(null),this._element.removeModelFromLayers(this.model),this.model.destroy(),this.model=null,this.node=null,this.mesh=null,(e=this.meshInstance)==null||e.destroy(),this.meshInstance=null,(t=this.unmaskMeshInstance)==null||t.destroy(),this.unmaskMeshInstance=null,this._entity=null,this._element=null}setMesh(e){this.meshInstance&&(this.mesh=e,this.meshInstance.mesh=e,this.meshInstance.visible=!!e,this.unmaskMeshInstance&&(this.unmaskMeshInstance.mesh=e),this.forceUpdateAabb())}setMask(e){var t;if(this.meshInstance){if(this._entity.enabled&&this._element.enabled&&this._element.removeModelFromLayers(this.model),e){this.unmaskMeshInstance=new Dt(this.mesh,this.meshInstance.material,this.node),this.unmaskMeshInstance.name=`Unmask: ${this._entity.name}`,this.unmaskMeshInstance.castShadow=!1,this.unmaskMeshInstance.receiveShadow=!1,this.unmaskMeshInstance.pick=!1,this.model.meshInstances.push(this.unmaskMeshInstance);for(const i in this.meshInstance.parameters)this.unmaskMeshInstance.setParameter(i,this.meshInstance.parameters[i].data)}else{const i=this.model.meshInstances.indexOf(this.unmaskMeshInstance);i>=0&&this.model.meshInstances.splice(i,1)}this._entity.enabled&&this._element.enabled&&this._element.addModelToLayers(this.model),e||((t=this.unmaskMeshInstance)==null||t.destroy(),this.unmaskMeshInstance=null)}}setMaterial(e){this.meshInstance&&(this.meshInstance.material=e,this.unmaskMeshInstance&&(this.unmaskMeshInstance.material=e))}setParameter(e,t){this.meshInstance&&(this.meshInstance.setParameter(e,t),this.unmaskMeshInstance&&this.unmaskMeshInstance.setParameter(e,t))}deleteParameter(e){this.meshInstance&&(this.meshInstance.deleteParameter(e),this.unmaskMeshInstance&&this.unmaskMeshInstance.deleteParameter(e))}setUnmaskDrawOrder(){if(!this.meshInstance)return;const e=function(t){let i;const s=t.children,n=s.length;if(n){for(let o=0;o<n;o++)s[o].element&&(i=s[o]);if(!i)return null;const a=e(i);return a||i}return null};if(this.unmaskMeshInstance){const t=e(this._entity);t&&t.element?this.unmaskMeshInstance.drawOrder=t.element.drawOrder+t.element.getMaskOffset():this.unmaskMeshInstance.drawOrder=this.meshInstance.drawOrder+this._element.getMaskOffset()}}setDrawOrder(e){this.meshInstance&&(this.meshInstance.drawOrder=e)}setCull(e){if(!this.meshInstance)return;const t=this._element;let i=null;e&&t._isScreenSpace()&&(i=function(s){return t.isVisibleForCamera(s)}),this.meshInstance.cull=e,this.meshInstance.isVisibleFunc=i,this.unmaskMeshInstance&&(this.unmaskMeshInstance.cull=e,this.unmaskMeshInstance.isVisibleFunc=i)}setScreenSpace(e){this.meshInstance&&(this.meshInstance.screenSpace=e,this.unmaskMeshInstance&&(this.unmaskMeshInstance.screenSpace=e))}setLayer(e){this.meshInstance&&(this.meshInstance.layer=e,this.unmaskMeshInstance&&(this.unmaskMeshInstance.layer=e))}forceUpdateAabb(e){this.meshInstance&&(this.meshInstance._aabbVer=-1,this.unmaskMeshInstance&&(this.unmaskMeshInstance._aabbVer=-1))}setAabbFunc(e){this.meshInstance&&(this.meshInstance._updateAabbFunc=e,this.unmaskMeshInstance&&(this.unmaskMeshInstance._updateAabbFunc=e))}}class iEe{constructor(e){this._evtSetMeshes=null,this._element=e,this._entity=e.entity,this._system=e.system,this._textureAsset=null,this._texture=null,this._materialAsset=null,this._material=null,this._spriteAsset=null,this._sprite=null,this._spriteFrame=0,this._pixelsPerUnit=null,this._targetAspectRatio=-1,this._rect=new ce(0,0,1,1),this._mask=!1,this._maskRef=0,this._outerScale=new ee,this._outerScaleUniform=new Float32Array(2),this._innerOffset=new ce,this._innerOffsetUniform=new Float32Array(4),this._atlasRect=new ce,this._atlasRectUniform=new Float32Array(4),this._defaultMesh=this._createMesh(),this._renderable=new tEe(this._entity,this._defaultMesh,this._material),this._color=new ae(1,1,1,1),this._colorUniform=new Float32Array([1,1,1]),this._updateRenderableEmissive(),this._renderable.setParameter("material_opacity",1),this._updateAabbFunc=this._updateAabb.bind(this),this._onScreenChange(this._element.screen),this._element.on("resize",this._onParentResizeOrPivotChange,this),this._element.on("set:pivot",this._onParentResizeOrPivotChange,this),this._element.on("screen:set:screenspace",this._onScreenSpaceChange,this),this._element.on("set:screen",this._onScreenChange,this),this._element.on("set:draworder",this._onDrawOrderChange,this),this._element.on("screen:set:resolution",this._onResolutionChange,this)}destroy(){this.textureAsset=null,this.spriteAsset=null,this.materialAsset=null,this._renderable.setMesh(this._defaultMesh),this._renderable.destroy(),this._defaultMesh=null,this._element.off("resize",this._onParentResizeOrPivotChange,this),this._element.off("set:pivot",this._onParentResizeOrPivotChange,this),this._element.off("screen:set:screenspace",this._onScreenSpaceChange,this),this._element.off("set:screen",this._onScreenChange,this),this._element.off("set:draworder",this._onDrawOrderChange,this),this._element.off("screen:set:resolution",this._onResolutionChange,this)}_onResolutionChange(e){}_onParentResizeOrPivotChange(){this._renderable.mesh&&this._updateMesh(this._renderable.mesh)}_onScreenSpaceChange(e){this._updateMaterial(e)}_onScreenChange(e,t){e?this._updateMaterial(e.screen.screenSpace):this._updateMaterial(!1)}_onDrawOrderChange(e){this._renderable.setDrawOrder(e),this.mask&&this._element.screen&&this._element.screen.screen.once("syncdraworder",function(){this._renderable.setUnmaskDrawOrder()},this)}_hasUserMaterial(){return!!this._materialAsset||!!this._material&&this._system.defaultImageMaterials.indexOf(this._material)===-1}_use9Slicing(){return this.sprite&&(this.sprite.renderMode===Li||this.sprite.renderMode===Oi)}_updateMaterial(e){const t=!!this._mask,i=!!(this.sprite&&this.sprite.renderMode===Li),s=!!(this.sprite&&this.sprite.renderMode===Oi);this._hasUserMaterial()||(this._material=this._system.getImageElementMaterial(e,t,i,s)),this._renderable&&(this._renderable.setCull(!this._element._isScreenSpace()||this._element._isScreenCulled()),this._renderable.setMaterial(this._material),this._renderable.setScreenSpace(e),this._renderable.setLayer(e?$pe:o9))}_createMesh(){const e=this._element,t=e.calculatedWidth,i=e.calculatedHeight,s=this._rect,n=this._system.app.graphicsDevice,a=new Float32Array([t,0,0,0,0,1,s.x+s.z,1-s.y,t,i,0,0,0,1,s.x+s.z,1-(s.y+s.w),0,0,0,0,0,1,s.x,1-s.y,0,i,0,0,0,1,s.x,1-(s.y+s.w)]),o=eEe.get(n,()=>new Ls(n,[{semantic:Xe,components:3,type:bt},{semantic:Rs,components:3,type:bt},{semantic:un,components:2,type:bt}])),l=new Ya(n,o,4,{data:a.buffer}),c=new It(n);return c.vertexBuffer=l,c.primitive[0].type=wc,c.primitive[0].base=0,c.primitive[0].count=4,c.primitive[0].indexed=!1,c.aabb.setMinMax(O.ZERO,new O(t,i,0)),this._updateMesh(c),c}_updateMesh(e){const t=this._element;let i=t.calculatedWidth,s=t.calculatedHeight;if(t.fitMode!==fx&&this._targetAspectRatio>0){const a=t.calculatedWidth/t.calculatedHeight;t.fitMode===NTe&&a>this._targetAspectRatio||t.fitMode===kTe&&a<this._targetAspectRatio?i=t.calculatedHeight*this._targetAspectRatio:s=t.calculatedWidth/this._targetAspectRatio}const n=t._isScreenSpace();if(this._updateMaterial(n),this._renderable&&this._renderable.forceUpdateAabb(),this.sprite&&(this.sprite.renderMode===Li||this.sprite.renderMode===Oi)){const a=this._sprite.atlas.frames[this._sprite.frameKeys[this._spriteFrame]],o=2/a.rect.z,l=2/a.rect.w;this._innerOffset.set(a.border.x*o,a.border.y*l,a.border.z*o,a.border.w*l);const c=this.sprite.atlas.texture;this._atlasRect.set(a.rect.x/c.width,a.rect.y/c.height,a.rect.z/c.width,a.rect.w/c.height);const u=this._pixelsPerUnit!==null?this._pixelsPerUnit:this.sprite.pixelsPerUnit,h=a.rect.z/u,d=a.rect.w/u;this._outerScale.set(Math.max(i,this._innerOffset.x*h),Math.max(s,this._innerOffset.y*d));let f=h,p=d;this._outerScale.x/=h,this._outerScale.y/=d,f*=Q.clamp(i/(this._innerOffset.x*h),1e-4,1),p*=Q.clamp(s/(this._innerOffset.y*d),1e-4,1),this._renderable&&(this._innerOffsetUniform[0]=this._innerOffset.x,this._innerOffsetUniform[1]=this._innerOffset.y,this._innerOffsetUniform[2]=this._innerOffset.z,this._innerOffsetUniform[3]=this._innerOffset.w,this._renderable.setParameter("innerOffset",this._innerOffsetUniform),this._atlasRectUniform[0]=this._atlasRect.x,this._atlasRectUniform[1]=this._atlasRect.y,this._atlasRectUniform[2]=this._atlasRect.z,this._atlasRectUniform[3]=this._atlasRect.w,this._renderable.setParameter("atlasRect",this._atlasRectUniform),this._outerScaleUniform[0]=this._outerScale.x,this._outerScaleUniform[1]=this._outerScale.y,this._renderable.setParameter("outerScale",this._outerScaleUniform),this._renderable.setAabbFunc(this._updateAabbFunc),this._renderable.node.setLocalScale(f,p,1),this._renderable.node.setLocalPosition((.5-t.pivot.x)*i,(.5-t.pivot.y)*s,0))}else{const a=e.vertexBuffer,o=new Float32Array(a.lock()),l=t.pivot.x,c=t.pivot.y;o[0]=i-l*i,o[1]=0-c*s,o[8]=i-l*i,o[9]=s-c*s,o[16]=0-l*i,o[17]=0-c*s,o[24]=0-l*i,o[25]=s-c*s;let u=1,h=1,d=this._rect;if(this._sprite&&this._sprite.frameKeys[this._spriteFrame]&&this._sprite.atlas){const m=this._sprite.atlas.frames[this._sprite.frameKeys[this._spriteFrame]];m&&(d=m.rect,u=this._sprite.atlas.texture.width,h=this._sprite.atlas.texture.height)}o[6]=(d.x+d.z)/u,o[7]=1-d.y/h,o[14]=(d.x+d.z)/u,o[15]=1-(d.y+d.w)/h,o[22]=d.x/u,o[23]=1-d.y/h,o[30]=d.x/u,o[31]=1-(d.y+d.w)/h,a.unlock();const f=new O(0-l*i,0-c*s,0),p=new O(i-l*i,s-c*s,0);e.aabb.setMinMax(f,p),this._renderable&&(this._renderable.node.setLocalScale(1,1,1),this._renderable.node.setLocalPosition(0,0,0),this._renderable.setAabbFunc(null))}this._meshDirty=!1}_updateSprite(){let e=!1,t=null;if(this._targetAspectRatio=-1,this._sprite&&this._sprite.atlas){t=this._sprite.meshes[this.spriteFrame],e=this._sprite.renderMode===Li||this._sprite.renderMode===Oi;const i=this._sprite.atlas.frames[this._sprite.frameKeys[this._spriteFrame]];(i==null?void 0:i.rect.w)>0&&(this._targetAspectRatio=i.rect.z/i.rect.w)}this.mesh=e?t:this._defaultMesh,this.refreshMesh()}refreshMesh(){this.mesh&&(this._element._beingInitialized?this._meshDirty=!0:this._updateMesh(this.mesh))}_updateAabb(e){return e.center.set(0,0,0),e.halfExtents.set(this._outerScale.x*.5,this._outerScale.y*.5,.001),e.setFromTransformedAabb(e,this._renderable.node.getWorldTransform()),e}_toggleMask(){this._element._dirtifyMask();const e=this._element._isScreenSpace();this._updateMaterial(e),this._renderable.setMask(!!this._mask)}_onMaterialLoad(e){this.material=e.resource}_onMaterialAdded(e){this._system.app.assets.off(`add:${e.id}`,this._onMaterialAdded,this),this._materialAsset===e.id&&this._bindMaterialAsset(e)}_bindMaterialAsset(e){this._entity.enabled&&(e.on("load",this._onMaterialLoad,this),e.on("change",this._onMaterialChange,this),e.on("remove",this._onMaterialRemove,this),e.resource?this._onMaterialLoad(e):this._system.app.assets.load(e))}_unbindMaterialAsset(e){e.off("load",this._onMaterialLoad,this),e.off("change",this._onMaterialChange,this),e.off("remove",this._onMaterialRemove,this)}_onMaterialChange(){}_onMaterialRemove(){}_onTextureAdded(e){this._system.app.assets.off(`add:${e.id}`,this._onTextureAdded,this),this._textureAsset===e.id&&this._bindTextureAsset(e)}_bindTextureAsset(e){this._entity.enabled&&(e.on("load",this._onTextureLoad,this),e.on("change",this._onTextureChange,this),e.on("remove",this._onTextureRemove,this),e.resource?this._onTextureLoad(e):this._system.app.assets.load(e))}_unbindTextureAsset(e){e.off("load",this._onTextureLoad,this),e.off("change",this._onTextureChange,this),e.off("remove",this._onTextureRemove,this)}_onTextureLoad(e){this.texture=e.resource}_onTextureChange(e){}_onTextureRemove(e){}_onSpriteAssetAdded(e){this._system.app.assets.off(`add:${e.id}`,this._onSpriteAssetAdded,this),this._spriteAsset===e.id&&this._bindSpriteAsset(e)}_bindSpriteAsset(e){this._entity.enabled&&(e.on("load",this._onSpriteAssetLoad,this),e.on("change",this._onSpriteAssetChange,this),e.on("remove",this._onSpriteAssetRemove,this),e.resource?this._onSpriteAssetLoad(e):this._system.app.assets.load(e))}_unbindSpriteAsset(e){e.off("load",this._onSpriteAssetLoad,this),e.off("change",this._onSpriteAssetChange,this),e.off("remove",this._onSpriteAssetRemove,this),e.data.textureAtlasAsset&&this._system.app.assets.off(`load:${e.data.textureAtlasAsset}`,this._onTextureAtlasLoad,this)}_onSpriteAssetLoad(e){if(!e||!e.resource)this.sprite=null;else if(e.resource.atlas)this.sprite=e.resource;else{const t=e.data.textureAtlasAsset;if(t){const i=this._system.app.assets;i.off(`load:${t}`,this._onTextureAtlasLoad,this),i.once(`load:${t}`,this._onTextureAtlasLoad,this)}}}_onSpriteAssetChange(e){this._onSpriteAssetLoad(e)}_onSpriteAssetRemove(e){}_bindSprite(e){this._evtSetMeshes=e.on("set:meshes",this._onSpriteMeshesChange,this),e.on("set:pixelsPerUnit",this._onSpritePpuChange,this),e.on("set:atlas",this._onAtlasTextureChange,this),e.atlas&&e.atlas.on("set:texture",this._onAtlasTextureChange,this)}_unbindSprite(e){var t;(t=this._evtSetMeshes)==null||t.off(),this._evtSetMeshes=null,e.off("set:pixelsPerUnit",this._onSpritePpuChange,this),e.off("set:atlas",this._onAtlasTextureChange,this),e.atlas&&e.atlas.off("set:texture",this._onAtlasTextureChange,this)}_onSpriteMeshesChange(){this._sprite&&(this._spriteFrame=Q.clamp(this._spriteFrame,0,this._sprite.frameKeys.length-1)),this._updateSprite()}_onSpritePpuChange(){this.sprite.renderMode!==Ca&&this._pixelsPerUnit===null&&this._updateSprite()}_onAtlasTextureChange(){this.sprite&&this.sprite.atlas&&this.sprite.atlas.texture?(this._renderable.setParameter("texture_emissiveMap",this._sprite.atlas.texture),this._renderable.setParameter("texture_opacityMap",this._sprite.atlas.texture)):(this._renderable.deleteParameter("texture_emissiveMap"),this._renderable.deleteParameter("texture_opacityMap"))}_onTextureAtlasLoad(e){const t=this._spriteAsset;t instanceof be?this._onSpriteAssetLoad(t):this._onSpriteAssetLoad(this._system.app.assets.get(t))}onEnable(){if(this._materialAsset){const e=this._system.app.assets.get(this._materialAsset);e&&e.resource!==this._material&&this._bindMaterialAsset(e)}if(this._textureAsset){const e=this._system.app.assets.get(this._textureAsset);e&&e.resource!==this._texture&&this._bindTextureAsset(e)}if(this._spriteAsset){const e=this._system.app.assets.get(this._spriteAsset);e&&e.resource!==this._sprite&&this._bindSpriteAsset(e)}this._element.addModelToLayers(this._renderable.model)}onDisable(){this._element.removeModelFromLayers(this._renderable.model)}_setStencil(e){this._renderable.meshInstance.stencilFront=e,this._renderable.meshInstance.stencilBack=e;let t=0;if(this._element.maskedBy&&(t=this._element.maskedBy.element._image._maskRef),this._renderable.unmaskMeshInstance){const i=new Oa({ref:t+1,func:lb,zpass:Yde});this._renderable.unmaskMeshInstance.stencilFront=i,this._renderable.unmaskMeshInstance.stencilBack=i}}_updateRenderableEmissive(){nS.linear(this._color),this._colorUniform[0]=nS.r,this._colorUniform[1]=nS.g,this._colorUniform[2]=nS.b,this._renderable.setParameter("material_emissive",this._colorUniform)}set color(e){const{r:t,g:i,b:s}=e;(this._color.r!==t||this._color.g!==i||this._color.b!==s)&&(this._color.r=t,this._color.g=i,this._color.b=s,this._updateRenderableEmissive()),this._element&&this._element.fire("set:color",this._color)}get color(){return this._color}set opacity(e){e!==this._color.a&&(this._color.a=e,this._renderable.setParameter("material_opacity",e)),this._element&&this._element.fire("set:opacity",e)}get opacity(){return this._color.a}set rect(e){let t,i,s,n;e instanceof ce?(t=e.x,i=e.y,s=e.z,n=e.w):(t=e[0],i=e[1],s=e[2],n=e[3]),!(t===this._rect.x&&i===this._rect.y&&s===this._rect.z&&n===this._rect.w)&&(this._rect.set(t,i,s,n),this._renderable.mesh&&(this._element._beingInitialized?this._meshDirty=!0:this._updateMesh(this._renderable.mesh)))}get rect(){return this._rect}_removeMaterialAssetEvents(){if(this._materialAsset){const e=this._system.app.assets;e.off(`add:${this._materialAsset}`,this._onMaterialAdded,this);const t=e.get(this._materialAsset);t&&(t.off("load",this._onMaterialLoad,this),t.off("change",this._onMaterialChange,this),t.off("remove",this._onMaterialRemove,this))}}set material(e){if(this._material!==e){if(!e){const t=this._element._isScreenSpace();this.mask?e=t?this._system.defaultScreenSpaceImageMaskMaterial:this._system.defaultImageMaskMaterial:e=t?this._system.defaultScreenSpaceImageMaterial:this._system.defaultImageMaterial}if(this._material=e,this._materialAsset){const t=this._system.app.assets.get(this._materialAsset);(!t||t.resource!==e)&&(this._removeMaterialAssetEvents(),this._materialAsset=null)}e&&(this._renderable.setMaterial(e),this._hasUserMaterial()?(this._renderable.deleteParameter("material_opacity"),this._renderable.deleteParameter("material_emissive")):(this._updateRenderableEmissive(),this._renderable.setParameter("material_opacity",this._color.a)))}}get material(){return this._material}set materialAsset(e){const t=this._system.app.assets;let i=e;if(e instanceof be&&(i=e.id),this._materialAsset!==i)if(this._removeMaterialAssetEvents(),this._materialAsset=i,this._materialAsset){const s=t.get(this._materialAsset);s?this._bindMaterialAsset(s):(this._materialAsset=null,this.material=null,this._materialAsset=i,t.on(`add:${this._materialAsset}`,this._onMaterialAdded,this))}else this._materialAsset=null,this.material=null,this._materialAsset=i}get materialAsset(){return this._materialAsset}set texture(e){if(this._texture!==e){if(this._textureAsset){const t=this._system.app.assets.get(this._textureAsset);t&&t.resource!==e&&(this.textureAsset=null)}if(this._texture=e,e){this._spriteAsset&&(this.spriteAsset=null),this._renderable.setParameter("texture_emissiveMap",this._texture),this._renderable.setParameter("texture_opacityMap",this._texture),this._updateRenderableEmissive(),this._renderable.setParameter("material_opacity",this._color.a);const t=this._texture.width/this._texture.height;t!==this._targetAspectRatio&&(this._targetAspectRatio=t,this._element.fitMode!==fx&&this.refreshMesh())}else this._renderable.deleteParameter("texture_emissiveMap"),this._renderable.deleteParameter("texture_opacityMap"),this._targetAspectRatio=-1,this._element.fitMode!==fx&&this.refreshMesh()}}get texture(){return this._texture}set textureAsset(e){const t=this._system.app.assets;let i=e;if(e instanceof be&&(i=e.id),this._textureAsset!==i){if(this._textureAsset){t.off(`add:${this._textureAsset}`,this._onTextureAdded,this);const s=t.get(this._textureAsset);s&&(s.off("load",this._onTextureLoad,this),s.off("change",this._onTextureChange,this),s.off("remove",this._onTextureRemove,this))}if(this._textureAsset=i,this._textureAsset){const s=t.get(this._textureAsset);s?this._bindTextureAsset(s):(this.texture=null,t.on(`add:${this._textureAsset}`,this._onTextureAdded,this))}else this.texture=null}}get textureAsset(){return this._textureAsset}set spriteAsset(e){const t=this._system.app.assets;let i=e;if(e instanceof be&&(i=e.id),this._spriteAsset!==i){if(this._spriteAsset){t.off(`add:${this._spriteAsset}`,this._onSpriteAssetAdded,this);const s=t.get(this._spriteAsset);s&&this._unbindSpriteAsset(s)}if(this._spriteAsset=i,this._spriteAsset){const s=t.get(this._spriteAsset);s?this._bindSpriteAsset(s):(this.sprite=null,t.on(`add:${this._spriteAsset}`,this._onSpriteAssetAdded,this))}else this.sprite=null}this._element&&this._element.fire("set:spriteAsset",i)}get spriteAsset(){return this._spriteAsset}set sprite(e){if(this._sprite!==e){if(this._sprite&&this._unbindSprite(this._sprite),this._spriteAsset){const t=this._system.app.assets.get(this._spriteAsset);t&&t.resource!==e&&(this.spriteAsset=null)}this._sprite=e,this._sprite&&(this._bindSprite(this._sprite),this._textureAsset&&(this.textureAsset=null)),this._sprite&&this._sprite.atlas&&this._sprite.atlas.texture?(this._renderable.setParameter("texture_emissiveMap",this._sprite.atlas.texture),this._renderable.setParameter("texture_opacityMap",this._sprite.atlas.texture)):(this._renderable.deleteParameter("texture_emissiveMap"),this._renderable.deleteParameter("texture_opacityMap")),this._sprite&&(this._spriteFrame=Q.clamp(this._spriteFrame,0,this._sprite.frameKeys.length-1)),this._updateSprite()}}get sprite(){return this._sprite}set spriteFrame(e){const t=this._spriteFrame;this._sprite?this._spriteFrame=Q.clamp(e,0,this._sprite.frameKeys.length-1):this._spriteFrame=e,this._spriteFrame!==t&&this._updateSprite(),this._element&&this._element.fire("set:spriteFrame",e)}get spriteFrame(){return this._spriteFrame}set mesh(e){this._renderable.setMesh(e),this._defaultMesh===e?this._renderable.setAabbFunc(null):this._renderable.setAabbFunc(this._updateAabbFunc)}get mesh(){return this._renderable.mesh}set mask(e){this._mask!==e&&(this._mask=e,this._toggleMask())}get mask(){return this._mask}set pixelsPerUnit(e){this._pixelsPerUnit!==e&&(this._pixelsPerUnit=e,this._sprite&&(this._sprite.renderMode===Li||this._sprite.renderMode===Oi)&&this._updateSprite())}get pixelsPerUnit(){return this._pixelsPerUnit}get aabb(){return this._renderable.meshInstance?this._renderable.meshInstance.aabb:null}}class rEe extends Te{constructor(e){super(),this._app=e,e.i18n.on(xh.EVENT_CHANGE,this._onSetLocale,this),this._autoLoad=!1,this._disableLocalization=!1,this._defaultAsset=null,this._localizedAsset=null}set defaultAsset(e){const t=e instanceof be?e.id:e;this._defaultAsset!==t&&(this._defaultAsset&&this._unbindDefaultAsset(),this._defaultAsset=t,this._defaultAsset&&this._bindDefaultAsset(),this._onSetLocale(this._app.i18n.locale))}get defaultAsset(){return this._defaultAsset}set localizedAsset(e){const t=e instanceof be?e.id:e;this._localizedAsset!==t&&(this._localizedAsset&&(this._app.assets.off(`add:${this._localizedAsset}`,this._onLocalizedAssetAdd,this),this._unbindLocalizedAsset()),this._localizedAsset=t,this._localizedAsset&&(this._app.assets.get(this._localizedAsset)?this._bindLocalizedAsset():this._app.assets.once(`add:${this._localizedAsset}`,this._onLocalizedAssetAdd,this)))}get localizedAsset(){return this._localizedAsset}set autoLoad(e){this._autoLoad!==e&&(this._autoLoad=e,this._autoLoad&&this._localizedAsset&&(this._unbindLocalizedAsset(),this._bindLocalizedAsset()))}get autoLoad(){return this._autoLoad}set disableLocalization(e){this._disableLocalization!==e&&(this._disableLocalization=e,this._onSetLocale(this._app.i18n.locale))}get disableLocalization(){return this._disableLocalization}_bindDefaultAsset(){const e=this._app.assets.get(this._defaultAsset);e?this._onDefaultAssetAdd(e):this._app.assets.once(`add:${this._defaultAsset}`,this._onDefaultAssetAdd,this)}_unbindDefaultAsset(){if(!this._defaultAsset)return;this._app.assets.off(`add:${this._defaultAsset}`,this._onDefaultAssetAdd,this);const e=this._app.assets.get(this._defaultAsset);e&&(e.off("add:localized",this._onLocaleAdd,this),e.off("remove:localized",this._onLocaleRemove,this),e.off("remove",this._onDefaultAssetRemove,this))}_onDefaultAssetAdd(e){this._defaultAsset===e.id&&(e.on("add:localized",this._onLocaleAdd,this),e.on("remove:localized",this._onLocaleRemove,this),e.once("remove",this._onDefaultAssetRemove,this))}_onDefaultAssetRemove(e){this._defaultAsset===e.id&&(e.off("add:localized",this._onLocaleAdd,this),e.off("remove:localized",this._onLocaleAdd,this),this._app.assets.once(`add:${this._defaultAsset}`,this._onDefaultAssetAdd,this))}_bindLocalizedAsset(){if(!this._autoLoad)return;const e=this._app.assets.get(this._localizedAsset);e&&(e.on("load",this._onLocalizedAssetLoad,this),e.on("change",this._onLocalizedAssetChange,this),e.on("remove",this._onLocalizedAssetRemove,this),e.resource?this._onLocalizedAssetLoad(e):this._app.assets.load(e))}_unbindLocalizedAsset(){const e=this._app.assets.get(this._localizedAsset);e&&(e.off("load",this._onLocalizedAssetLoad,this),e.off("change",this._onLocalizedAssetChange,this),e.off("remove",this._onLocalizedAssetRemove,this))}_onLocalizedAssetAdd(e){this._localizedAsset===e.id&&this._bindLocalizedAsset()}_onLocalizedAssetLoad(e){this.fire("load",e)}_onLocalizedAssetChange(e,t,i,s){this.fire("change",e,t,i,s)}_onLocalizedAssetRemove(e){this._localizedAsset===e.id&&(this.localizedAsset=this._defaultAsset),this.fire("remove",e)}_onLocaleAdd(e,t){this._app.i18n.locale===e&&this._onSetLocale(e)}_onLocaleRemove(e,t){this._app.i18n.locale===e&&this._onSetLocale(e)}_onSetLocale(e){if(!this._defaultAsset){this.localizedAsset=null;return}const t=this._app.assets.get(this._defaultAsset);if(!t||this._disableLocalization){this.localizedAsset=this._defaultAsset;return}const i=t.getLocalizedAssetId(e);if(!i){this.localizedAsset=this._defaultAsset;return}this.localizedAsset=i}destroy(){this.defaultAsset=null,this._app.i18n.off(xh.EVENT_CHANGE,this._onSetLocale,this),this.off()}}const Mb="msdf",sEe="bitmap",Mg=0,Rd=1,JM=2,fY=3,e2=4,t2=5,i2=6,r2=7,jz=8,nEe=` 	
\r\v\f`,aEe=/[\w|/]/;class oEe{constructor(e){this._symbols=e,this._index=0,this._last=0,this._cur=this._symbols.length>0?this._symbols[0]:null,this._buf=[],this._mode="text",this._error=null}read(){let e=this._read();for(;e===jz;)e=this._read();return e!==Mg&&e!==Rd&&(this._last=this._index),e}buf(){return this._buf}last(){return this._last}error(){return this._error}debugPrint(){const e=["EOF","ERROR","TEXT","OPEN_BRACKET","CLOSE_BRACKET","EQUALS","STRING","IDENTIFIER","WHITESPACE"];let t=this.read(),i="";for(;i+=`${(i.length>0?`
`:"")+e[t]} '${this.buf().join("")}'`,!(t===Mg||t===Rd);)t=this.read();return i}_read(){return this._buf=[],this._eof()?Mg:this._mode==="text"?this._text():this._tag()}_text(){for(;;)switch(this._cur){case null:return this._buf.length>0?JM:Mg;case"[":return this._mode="tag",this._buf.length>0?JM:this._tag();case"\\":switch(this._next(),this._cur){case"[":this._store();break;default:this._output("\\");break}break;default:this._store();break}}_tag(){switch(this._cur){case null:return this._error="unexpected end of input reading tag",Rd;case"[":return this._store(),fY;case"]":return this._store(),this._mode="text",e2;case"=":return this._store(),t2;case" ":case"	":case`
`:case"\r":case"\v":case"\f":return this._whitespace();case'"':return this._string();default:return this._isIdentifierSymbol(this._cur)?this._identifier():(this._error="unrecognized character",Rd)}}_whitespace(){for(this._store();nEe.indexOf(this._cur)!==-1;)this._store();return jz}_string(){for(this._next();;)switch(this._cur){case null:return this._error="unexpected end of input reading string",Rd;case'"':return this._next(),i2;default:this._store();break}}_identifier(){for(this._store();this._cur!==null&&this._isIdentifierSymbol(this._cur);)this._store();return r2}_isIdentifierSymbol(e){return e.length===1&&e.match(aEe)!==null}_eof(){return this._cur===null}_next(){return this._eof()||(this._index++,this._cur=this._index<this._symbols.length?this._symbols[this._index]:null),this._cur}_store(){return this._buf.push(this._cur),this._next()}_output(e){this._buf.push(e)}}class lEe{constructor(e){this._scanner=new oEe(e),this._error=null}parse(e,t){for(;;)switch(this._scanner.read()){case Mg:return!0;case Rd:return!1;case JM:Array.prototype.push.apply(e,this._scanner.buf());break;case fY:if(!this._parseTag(e,t))return!1;break;default:return!1}}error(){return`Error evaluating markup at #${this._scanner.last().toString()} (${this._scanner.error()||this._error})`}_parseTag(e,t){let i=this._scanner.read();if(i!==r2)return this._error="expected identifier",!1;const s=this._scanner.buf().join("");if(s[0]==="/"){for(let a=t.length-1;a>=0;--a)if(s===`/${t[a].name}`&&t[a].end===null)return t[a].end=e.length,i=this._scanner.read(),i!==e2?(this._error="expected close bracket",!1):!0;return this._error="failed to find matching tag",!1}const n={name:s,value:null,attributes:{},start:e.length,end:null};if(i=this._scanner.read(),i===t2){if(i=this._scanner.read(),i!==i2)return this._error="expected string",!1;n.value=this._scanner.buf().join(""),i=this._scanner.read()}for(;;){switch(i){case e2:return t.push(n),!0;case r2:{const a=this._scanner.buf().join("");if(i=this._scanner.read(),i!==t2)return this._error="expected equals",!1;if(i=this._scanner.read(),i!==i2)return this._error="expected string",!1;const o=this._scanner.buf().join("");n.attributes[a]=o;break}default:return this._error="expected close bracket or identifier",!1}i=this._scanner.read()}}}function pY(r,e){for(const t in e){if(!e.hasOwnProperty(t))continue;const i=e[t];i instanceof Object?(r.hasOwnProperty(t)||(r[t]={}),pY(r[t],e[t])):r[t]=i}}function cEe(r){if(r.length===0)return null;const e={};for(let t=0;t<r.length;++t){const i=r[t],s={};s[i.name]={value:i.value,attributes:i.attributes},pY(e,s)}return e}function uEe(r,e){if(r.length===0)return null;const t={};for(let u=0;u<r.length;++u){const h=r[u];t.hasOwnProperty(h.start)?t[h.start].open===null?t[h.start].open=[h]:t[h.start].open.push(h):t[h.start]={open:[h],close:null},t.hasOwnProperty(h.end)?t[h.end].close===null?t[h.end].close=[h]:t[h.end].close.push(h):t[h.end]={open:null,close:[h]}}let i=[];function s(u){i=i.filter(h=>u.find(d=>d===h)===void 0)}function n(u){for(let h=0;h<u.length;++h)i.push(u[h])}const a=Object.keys(t).sort((u,h)=>u-h),o=[];for(let u=0;u<a.length;++u){const h=t[a[u]];h.close!==null&&s(h.close),h.open!==null&&n(h.open),o.push({start:a[u],tags:cEe(i)})}const l=[];let c=null;for(let u=0;u<o.length;++u){const h=o[u];for(;l.length<h.start;)l.push(c?c.tags:null);c=h}for(;l.length<e;)l.push(null);return l}function hEe(r){const e=new lEe(r),t=[],i=[];if(!e.parse(t,i))return console.warn(e.error()),{symbols:r,tags:null};const s=i.find(a=>a.end===null);if(s)return console.warn(`Markup error: found unclosed tag='${s.name}'`),{symbols:r,tags:null};const n=uEe(i,t.length);return{symbols:t,tags:n}}class dEe{static evaluate(e){return hEe(e)}}class fEe{constructor(){this.count=0,this.quad=0,this.lines={},this.positions=[],this.normals=[],this.uvs=[],this.colors=[],this.indices=[],this.outlines=[],this.shadows=[],this.meshInstance=null}}function pEe(r,e){const t=new It(r);return t.setPositions(e.positions),t.setNormals(e.normals),t.setColors32(e.colors),t.setUvs(0,e.uvs),t.setIndices(e.indices),t.setVertexStream(Y_,e.outlines,3,void 0,bt,!1),t.setVertexStream(K_,e.shadows,3,void 0,bt,!1),t.update(),t}const $z=/^[\r\n]$/,mEe=/^[ \t]$/,Hz=/^[ \t\-]|\u200b$/,gEe=/^[a-z0-9]$/i,Gz=/^[\u1100-\u11ff]|[\u3000-\u9fff\ua960-\ua97f]|[\uac00-\ud7ff]$/,_Ee=/^[〕〉》」』】〙〗〟ヽヾーァィゥェォッャュョヮヵヶぁぃぅぇぉっゃゅょゎゕゖㇰㇱㇲㇳㇴㇵㇶㇷㇸㇹㇺㇻㇼㇽㇾㇿ々〻]$/,vEe=["​","؜","‎","‏","‪","‫","‬","‭","‮","⁦","⁧","⁨","⁩"],yEe={width:0,height:0,xadvance:0,xoffset:0,yoffset:0},Wz=new ae,SEe=new ee,gt=new ae;class xEe{constructor(e){this._element=e,this._system=e.system,this._entity=e.entity,this._text="",this._symbols=[],this._colorPalette=[],this._outlinePalette=[],this._shadowPalette=[],this._symbolColors=null,this._symbolOutlineParams=null,this._symbolShadowParams=null,this._i18nKey=null,this._fontAsset=new rEe(this._system.app),this._fontAsset.disableLocalization=!0,this._fontAsset.on("load",this._onFontLoad,this),this._fontAsset.on("change",this._onFontChange,this),this._fontAsset.on("remove",this._onFontRemove,this),this._font=null,this._color=new ae(1,1,1,1),this._colorUniform=new Float32Array(3),this._spacing=1,this._fontSize=32,this._fontMinY=0,this._fontMaxY=0,this._originalFontSize=32,this._maxFontSize=32,this._minFontSize=8,this._autoFitWidth=!1,this._autoFitHeight=!1,this._maxLines=-1,this._lineHeight=32,this._scaledLineHeight=32,this._wrapLines=!1,this._drawOrder=0,this._alignment=new ee(.5,.5),this._autoWidth=!0,this._autoHeight=!0,this.width=0,this.height=0,this._node=new Xt,this._model=new al,this._model.graph=this._node,this._entity.addChild(this._node),this._meshInfo=[],this._material=null,this._aabbDirty=!0,this._aabb=new We,this._noResize=!1,this._currentMaterialType=null,this._maskedMaterialSrc=null,this._rtlReorder=!1,this._unicodeConverter=!1,this._rtl=!1,this._outlineColor=new ae(0,0,0,1),this._outlineColorUniform=new Float32Array(4),this._outlineThicknessScale=.2,this._outlineThickness=0,this._shadowColor=new ae(0,0,0,1),this._shadowColorUniform=new Float32Array(4),this._shadowOffsetScale=.005,this._shadowOffset=new ee(0,0),this._shadowOffsetUniform=new Float32Array(2),this._enableMarkup=!1,this._onScreenChange(this._element.screen),e.on("resize",this._onParentResize,this),e.on("set:screen",this._onScreenChange,this),e.on("screen:set:screenspace",this._onScreenSpaceChange,this),e.on("set:draworder",this._onDrawOrderChange,this),e.on("set:pivot",this._onPivotChange,this),this._system.app.i18n.on(xh.EVENT_CHANGE,this._onLocaleSet,this),this._system.app.i18n.on("data:add",this._onLocalizationData,this),this._system.app.i18n.on("data:remove",this._onLocalizationData,this),this._rangeStart=0,this._rangeEnd=0}destroy(){this._setMaterial(null),this._model&&(this._element.removeModelFromLayers(this._model),this._model.destroy(),this._model=null),this._fontAsset.destroy(),this.font=null,this._element.off("resize",this._onParentResize,this),this._element.off("set:screen",this._onScreenChange,this),this._element.off("screen:set:screenspace",this._onScreenSpaceChange,this),this._element.off("set:draworder",this._onDrawOrderChange,this),this._element.off("set:pivot",this._onPivotChange,this),this._system.app.i18n.off(xh.EVENT_CHANGE,this._onLocaleSet,this),this._system.app.i18n.off("data:add",this._onLocalizationData,this),this._system.app.i18n.off("data:remove",this._onLocalizationData,this)}_onParentResize(e,t){this._noResize||this._font&&this._updateText()}_onScreenChange(e){e?this._updateMaterial(e.screen.screenSpace):this._updateMaterial(!1)}_onScreenSpaceChange(e){this._updateMaterial(e)}_onDrawOrderChange(e){if(this._drawOrder=e,this._model)for(let t=0,i=this._model.meshInstances.length;t<i;t++)this._model.meshInstances[t].drawOrder=e}_onPivotChange(e){this._font&&this._updateText()}_onLocaleSet(e){if(this._i18nKey){if(this.fontAsset){const t=this._system.app.assets.get(this.fontAsset);(!t||!t.resource||t.resource!==this._font)&&(this.font=null)}this._resetLocalizedText()}}_onLocalizationData(e,t){this._i18nKey&&t[this._i18nKey]&&this._resetLocalizedText()}_resetLocalizedText(){this._setText(this._system.app.i18n.getText(this._i18nKey))}_setText(e){if(this.unicodeConverter){const t=this._system.getUnicodeConverter();t?e=t(e):console.warn("Element created with unicodeConverter option but no unicodeConverter function registered")}this._text!==e&&(this._font&&this._updateText(e),this._text=e)}_updateText(e){let t;if(e===void 0&&(e=this._text),this._symbols=ix.getSymbols(e.normalize?e.normalize("NFC"):e),this._symbols.length===0&&(this._symbols=[" "]),this._enableMarkup){const h=dEe.evaluate(this._symbols);this._symbols=h.symbols,t=h.tags||[]}if(this._rtlReorder){const h=this._system.app.systems.element.getRtlReorder();if(h){const d=h(this._symbols);this._rtl=d.rtl,this._symbols=d.mapping.map(function(f){return this._symbols[f]},this),t&&(t=d.mapping.map(f=>t[f]))}else console.warn("Element created with rtlReorder option but no rtlReorder function registered")}else this._rtl=!1;const i=(h,d)=>`${h.toString(!0).toLowerCase()}:${d.toFixed(2)}`,s=(h,d)=>`${h.toString(!0).toLowerCase()}:${d.x.toFixed(2)}:${d.y.toFixed(2)}`;if(t){const h={},d={},f={};this._colorPalette=[Math.round(this._color.r*255),Math.round(this._color.g*255),Math.round(this._color.b*255)],this._outlinePalette=[Math.round(this._outlineColor.r*255),Math.round(this._outlineColor.g*255),Math.round(this._outlineColor.b*255),Math.round(this._outlineColor.a*255),Math.round(this._outlineThickness*255)],this._shadowPalette=[Math.round(this._shadowColor.r*255),Math.round(this._shadowColor.g*255),Math.round(this._shadowColor.b*255),Math.round(this._shadowColor.a*255),Math.round(this._shadowOffset.x*127),Math.round(this._shadowOffset.y*127)],this._symbolColors=[],this._symbolOutlineParams=[],this._symbolShadowParams=[],h[this._color.toString(!1).toLowerCase()]=0,d[i(this._outlineColor,this._outlineThickness)]=0,f[s(this._shadowColor,this._shadowOffset)]=0;for(let p=0,m=this._symbols.length;p<m;++p){const g=t[p];let _=0;if(g&&g.color&&g.color.value){const x=g.color.value;if(x.length===7&&x[0]==="#"){const S=x.substring(1).toLowerCase();h.hasOwnProperty(S)?_=h[S]:/^[0-9a-f]{6}$/.test(S)&&(_=this._colorPalette.length/3,h[S]=_,this._colorPalette.push(parseInt(S.substring(0,2),16)),this._colorPalette.push(parseInt(S.substring(2,4),16)),this._colorPalette.push(parseInt(S.substring(4,6),16)))}}this._symbolColors.push(_);let v=0;if(g&&g.outline&&(g.outline.attributes.color||g.outline.attributes.thickness)){let x=g.outline.attributes.color?Wz.fromString(g.outline.attributes.color):this._outlineColor,S=Number(g.outline.attributes.thickness);(Number.isNaN(x.r)||Number.isNaN(x.g)||Number.isNaN(x.b)||Number.isNaN(x.a))&&(x=this._outlineColor),Number.isNaN(S)&&(S=this._outlineThickness);const w=i(x,S);d.hasOwnProperty(w)?v=d[w]:(v=this._outlinePalette.length/5,d[w]=v,this._outlinePalette.push(Math.round(x.r*255),Math.round(x.g*255),Math.round(x.b*255),Math.round(x.a*255),Math.round(S*255)))}this._symbolOutlineParams.push(v);let y=0;if(g&&g.shadow&&(g.shadow.attributes.color||g.shadow.attributes.offset||g.shadow.attributes.offsetX||g.shadow.attributes.offsetY)){let x=g.shadow.attributes.color?Wz.fromString(g.shadow.attributes.color):this._shadowColor;const S=Number(g.shadow.attributes.offset),w=Number(g.shadow.attributes.offsetX),T=Number(g.shadow.attributes.offsetY);(Number.isNaN(x.r)||Number.isNaN(x.g)||Number.isNaN(x.b)||Number.isNaN(x.a))&&(x=this._shadowColor);const A=SEe.set(Number.isNaN(w)?Number.isNaN(S)?this._shadowOffset.x:S:w,Number.isNaN(T)?Number.isNaN(S)?this._shadowOffset.y:S:T),C=s(x,A);f.hasOwnProperty(C)?y=f[C]:(y=this._shadowPalette.length/6,f[C]=y,this._shadowPalette.push(Math.round(x.r*255),Math.round(x.g*255),Math.round(x.b*255),Math.round(x.a*255),Math.round(A.x*127),Math.round(A.y*127)))}this._symbolShadowParams.push(y)}}else this._colorPalette=[],this._symbolColors=null,this._symbolOutlineParams=null,this._symbolShadowParams=null;this._updateMaterialEmissive(),this._updateMaterialOutline(),this._updateMaterialShadow();const n=this._calculateCharsPerTexture();let a=!1;const o=this._element,l=o._isScreenSpace(),c=o._isScreenCulled(),u=function(h){return o.isVisibleForCamera(h)};for(let h=0,d=this._meshInfo.length;h<d;h++){const f=n[h]||0,p=this._meshInfo[h];if(p.count!==f){if(a||(o.removeModelFromLayers(this._model),a=!0),p.count=f,p.positions.length=p.normals.length=f*3*4,p.indices.length=f*3*2,p.uvs.length=f*2*4,p.colors.length=f*4*4,p.outlines.length=f*4*3,p.shadows.length=f*4*3,p.meshInstance&&this._removeMeshInstance(p.meshInstance),f===0){p.meshInstance=null;continue}for(let _=0;_<f;_++)p.indices[_*3*2+0]=_*4,p.indices[_*3*2+1]=_*4+1,p.indices[_*3*2+2]=_*4+3,p.indices[_*3*2+3]=_*4+2,p.indices[_*3*2+4]=_*4+3,p.indices[_*3*2+5]=_*4+1,p.normals[_*4*3+0]=0,p.normals[_*4*3+1]=0,p.normals[_*4*3+2]=-1,p.normals[_*4*3+3]=0,p.normals[_*4*3+4]=0,p.normals[_*4*3+5]=-1,p.normals[_*4*3+6]=0,p.normals[_*4*3+7]=0,p.normals[_*4*3+8]=-1,p.normals[_*4*3+9]=0,p.normals[_*4*3+10]=0,p.normals[_*4*3+11]=-1;const m=pEe(this._system.app.graphicsDevice,p),g=new Dt(m,this._material,this._node);if(g.name=`Text Element: ${this._entity.name}`,g.castShadow=!1,g.receiveShadow=!1,g.cull=!l,g.screenSpace=l,g.drawOrder=this._drawOrder,c&&(g.cull=!0,g.isVisibleFunc=u),this._setTextureParams(g,this._font.textures[h]),g.setParameter("material_emissive",this._colorUniform),g.setParameter("material_opacity",this._color.a),g.setParameter("font_sdfIntensity",this._font.intensity),g.setParameter("font_pxrange",this._getPxRange(this._font)),g.setParameter("font_textureWidth",this._font.data.info.maps[h].width),g.setParameter("outline_color",this._outlineColorUniform),g.setParameter("outline_thickness",this._outlineThicknessScale*this._outlineThickness),g.setParameter("shadow_color",this._shadowColorUniform),this._symbolShadowParams)this._shadowOffsetUniform[0]=0,this._shadowOffsetUniform[1]=0;else{const _=-this._font.data.info.maps[h].width/this._font.data.info.maps[h].height;this._shadowOffsetUniform[0]=this._shadowOffsetScale*this._shadowOffset.x,this._shadowOffsetUniform[1]=_*this._shadowOffsetScale*this._shadowOffset.y}g.setParameter("shadow_offset",this._shadowOffsetUniform),p.meshInstance=g,this._model.meshInstances.push(g)}}this._element.maskedBy&&this._element._setMaskedBy(this._element.maskedBy),a&&this._element.enabled&&this._entity.enabled&&this._element.addModelToLayers(this._model),this._updateMeshes(),this._rangeStart=0,this._rangeEnd=this._symbols.length,this._updateRenderRange()}_removeMeshInstance(e){e.destroy();const t=this._model.meshInstances.indexOf(e);t!==-1&&this._model.meshInstances.splice(t,1)}_setMaterial(e){if(this._material=e,this._model)for(let t=0,i=this._model.meshInstances.length;t<i;t++){const s=this._model.meshInstances[t];s.material=e}}_updateMaterial(e){const t=this._element,i=t._isScreenCulled(),s=function(a){return t.isVisibleForCamera(a)},n=this._font&&this._font.type===Mb;if(this._material=this._system.getTextElementMaterial(e,n,this._enableMarkup),this._model)for(let a=0,o=this._model.meshInstances.length;a<o;a++){const l=this._model.meshInstances[a];l.cull=!e,l.material=this._material,l.screenSpace=e,i?(l.cull=!0,l.isVisibleFunc=s):l.isVisibleFunc=null}}_updateMaterialEmissive(){this._symbolColors?(this._colorUniform[0]=1,this._colorUniform[1]=1,this._colorUniform[2]=1):(gt.linear(this._color),this._colorUniform[0]=gt.r,this._colorUniform[1]=gt.g,this._colorUniform[2]=gt.b)}_updateMaterialOutline(){this._symbolOutlineParams?(this._outlineColorUniform[0]=0,this._outlineColorUniform[1]=0,this._outlineColorUniform[2]=0,this._outlineColorUniform[3]=1):(gt.linear(this._outlineColor),this._outlineColorUniform[0]=gt.r,this._outlineColorUniform[1]=gt.g,this._outlineColorUniform[2]=gt.b,this._outlineColorUniform[3]=gt.a)}_updateMaterialShadow(){this._symbolOutlineParams?(this._shadowColorUniform[0]=0,this._shadowColorUniform[1]=0,this._shadowColorUniform[2]=0,this._shadowColorUniform[3]=0):(gt.linear(this._shadowColor),this._shadowColorUniform[0]=gt.r,this._shadowColorUniform[1]=gt.g,this._shadowColorUniform[2]=gt.b,this._shadowColorUniform[3]=gt.a)}_isWordBoundary(e){return Hz.test(e)}_isValidNextChar(e){return e!==null&&!_Ee.test(e)}_isNextCJKBoundary(e,t){return Gz.test(e)&&(Hz.test(t)||gEe.test(t))}_isNextCJKWholeWord(e){return Gz.test(e)}_updateMeshes(){const e=this._font.data,t=this,i=Math.min(this._minFontSize,this._maxFontSize),s=this._maxFontSize,n=this._shouldAutoFit();n&&(this._fontSize=this._maxFontSize);const a=32,o=this._symbols.length;let l=0,c=0,u=0,h=0,d=1,f=0,p=0,m=0,g=0,_=0,v=0;const y=Math.abs(this._element.anchor.x-this._element.anchor.z)>=1e-4;let x=this._element.calculatedWidth;(this.autoWidth&&!y||!this._wrapLines)&&(x=Number.POSITIVE_INFINITY);let S=0,w=0,T,A,C,P;function I(R,L,D){t._lineWidths.push(Math.abs(D));const F=m>L?L+1:m,j=m>L?m+1:L,z=R.slice(F,j);if(v){let $=z.length;for(;$--&&v>0;)$z.test(z[$])&&(z.splice($,1),v--)}t._lineContents.push(z.join("")),l=0,c-=t._scaledLineHeight,d++,g=0,_=0,v=0,f=0,m=L}let M=!0;for(;M;){M=!1,n?this._scaledLineHeight=this._lineHeight*this._fontSize/(this._maxFontSize||1e-4):this._scaledLineHeight=this._lineHeight,this.width=0,this.height=0,this._lineWidths=[],this._lineContents=[],l=0,c=0,u=0,h=0,d=1,f=0,p=0,m=0,g=0,_=0,v=0;const R=this._fontSize/a;S=this._fontMinY*R,w=this._fontMaxY*R;for(let W=0;W<this._meshInfo.length;W++)this._meshInfo[W].quad=0,this._meshInfo[W].lines={};let L=255,D=255,F=255,j=255+255*256,z=255+255*256,$=0,H=255+255*256,G=255+255*256,Y=127+127*256;for(let W=0;W<o;W++){if(T=this._symbols[W],P=W+1>=o?null:this._symbols[W+1],$z.test(T)){v++,(!this._wrapLines||this._maxLines<0||d<this._maxLines)&&(I(this._symbols,W,h),p=W+1,m=W+1);continue}let q=0,K=0,te=0,X=1,_e,pe;if(A=e.chars[T],!A)if(vEe.indexOf(T)!==-1)A=yEe;else if(e.chars[" "])A=e.chars[" "];else for(const Ae in e.chars){A=e.chars[Ae];break}if(A){let Ae=0;if(_>0){const $i=this._font.data.kerning;if($i){const ns=$i[ix.getCodePoint(this._symbols[W-1])||0];ns&&(Ae=ns[ix.getCodePoint(this._symbols[W])||0]||0)}}_e=A.scale||1,pe=(A.width+A.height)/2,X=R*pe/_e,te=(A.xadvance+Ae)*R,q=(A.xoffset-Ae)*R,K=A.yoffset*R}else console.error(`Couldn't substitute missing character: '${T}'`);const ze=mEe.test(T),Fe=A&&A.map||0,vt=-this._font.data.info.maps[Fe].width/this._font.data.info.maps[Fe].height,ne=this._meshInfo[Fe],vi=l+this._spacing*te;if(vi>x&&_>0&&!ze&&(this._maxLines<0||d<this._maxLines))if(g===0)p=W,I(this._symbols,W,h);else{const Ae=Math.max(W-p,0);if(this._meshInfo.length<=1)ne.lines[d-1]-=Ae,ne.quad-=Ae;else{const $i=p,ns=W;for(let mn=$i;mn<ns;mn++){const Ja=this._symbols[mn],as=e.chars[Ja],hl=this._meshInfo[as&&as.map||0];hl.lines[d-1]-=1,hl.quad-=1}}W-=Ae+1,I(this._symbols,p,f);continue}C=ne.quad,ne.lines[d-1]=C;let pi=l-q,ni=pi+X;const Ci=c-K,er=Ci+X;if(this._rtl){const Ae=X-q-this._spacing*te-q;pi-=Ae,ni-=Ae}ne.positions[C*4*3+0]=pi,ne.positions[C*4*3+1]=Ci,ne.positions[C*4*3+2]=u,ne.positions[C*4*3+3]=ni,ne.positions[C*4*3+4]=Ci,ne.positions[C*4*3+5]=u,ne.positions[C*4*3+6]=ni,ne.positions[C*4*3+7]=er,ne.positions[C*4*3+8]=u,ne.positions[C*4*3+9]=pi,ne.positions[C*4*3+10]=er,ne.positions[C*4*3+11]=u,this.width=Math.max(this.width,vi);let lr;if(this._shouldAutoFitWidth()&&this.width>this._element.calculatedWidth&&(lr=Math.floor(this._element.fontSize*this._element.calculatedWidth/(this.width||1e-4)),lr=Q.clamp(lr,i,s),lr!==this._element.fontSize)){this._fontSize=lr,M=!0;break}if(this.height=Math.max(this.height,w-(c+S)),this._shouldAutoFitHeight()&&this.height>this._element.calculatedHeight&&(lr=Q.clamp(this._fontSize-1,i,s),lr!==this._element.fontSize)){this._fontSize=lr,M=!0;break}l+=this._spacing*te,ze||(h=l),(this._isWordBoundary(T)||this._isValidNextChar(P)&&(this._isNextCJKBoundary(T,P)||this._isNextCJKWholeWord(P)))&&(g++,f=h,p=W+1),_++;const Cr=this._getUv(T);if(ne.uvs[C*4*2+0]=Cr[0],ne.uvs[C*4*2+1]=1-Cr[1],ne.uvs[C*4*2+2]=Cr[2],ne.uvs[C*4*2+3]=1-Cr[1],ne.uvs[C*4*2+4]=Cr[2],ne.uvs[C*4*2+5]=1-Cr[3],ne.uvs[C*4*2+6]=Cr[0],ne.uvs[C*4*2+7]=1-Cr[3],this._symbolColors){const Ae=this._symbolColors[W]*3;L=this._colorPalette[Ae],D=this._colorPalette[Ae+1],F=this._colorPalette[Ae+2]}if(ne.colors[C*4*4+0]=L,ne.colors[C*4*4+1]=D,ne.colors[C*4*4+2]=F,ne.colors[C*4*4+3]=255,ne.colors[C*4*4+4]=L,ne.colors[C*4*4+5]=D,ne.colors[C*4*4+6]=F,ne.colors[C*4*4+7]=255,ne.colors[C*4*4+8]=L,ne.colors[C*4*4+9]=D,ne.colors[C*4*4+10]=F,ne.colors[C*4*4+11]=255,ne.colors[C*4*4+12]=L,ne.colors[C*4*4+13]=D,ne.colors[C*4*4+14]=F,ne.colors[C*4*4+15]=255,this._symbolOutlineParams){const Ae=this._symbolOutlineParams[W]*5;j=this._outlinePalette[Ae]+this._outlinePalette[Ae+1]*256,z=this._outlinePalette[Ae+2]+this._outlinePalette[Ae+3]*256,$=this._outlinePalette[Ae+4]}if(ne.outlines[C*4*3+0]=j,ne.outlines[C*4*3+1]=z,ne.outlines[C*4*3+2]=$,ne.outlines[C*4*3+3]=j,ne.outlines[C*4*3+4]=z,ne.outlines[C*4*3+5]=$,ne.outlines[C*4*3+6]=j,ne.outlines[C*4*3+7]=z,ne.outlines[C*4*3+8]=$,ne.outlines[C*4*3+9]=j,ne.outlines[C*4*3+10]=z,ne.outlines[C*4*3+11]=$,this._symbolShadowParams){const Ae=this._symbolShadowParams[W]*6;H=this._shadowPalette[Ae]+this._shadowPalette[Ae+1]*256,G=this._shadowPalette[Ae+2]+this._shadowPalette[Ae+3]*256,Y=this._shadowPalette[Ae+4]+127+Math.round(vt*this._shadowPalette[Ae+5]+127)*256}ne.shadows[C*4*3+0]=H,ne.shadows[C*4*3+1]=G,ne.shadows[C*4*3+2]=Y,ne.shadows[C*4*3+3]=H,ne.shadows[C*4*3+4]=G,ne.shadows[C*4*3+5]=Y,ne.shadows[C*4*3+6]=H,ne.shadows[C*4*3+7]=G,ne.shadows[C*4*3+8]=Y,ne.shadows[C*4*3+9]=H,ne.shadows[C*4*3+10]=G,ne.shadows[C*4*3+11]=Y,ne.quad++}M||m<o&&I(this._symbols,o,l)}this._noResize=!0,this.autoWidth=this._autoWidth,this.autoHeight=this._autoHeight,this._noResize=!1;const N=this._element.pivot.x,k=this._element.pivot.y,V=this._alignment.x,B=this._alignment.y;for(let R=0;R<this._meshInfo.length;R++){if(this._meshInfo[R].count===0)continue;let L=0;for(const z in this._meshInfo[R].lines){const $=this._meshInfo[R].lines[z],H=this._lineWidths[parseInt(z,10)],G=-N*this._element.calculatedWidth+V*(this._element.calculatedWidth-H)*(this._rtl?-1:1),Y=(1-k)*this._element.calculatedHeight-w-(1-B)*(this._element.calculatedHeight-this.height);for(let W=L;W<=$;W++)this._meshInfo[R].positions[W*4*3]+=G,this._meshInfo[R].positions[W*4*3+3]+=G,this._meshInfo[R].positions[W*4*3+6]+=G,this._meshInfo[R].positions[W*4*3+9]+=G,this._meshInfo[R].positions[W*4*3+1]+=Y,this._meshInfo[R].positions[W*4*3+4]+=Y,this._meshInfo[R].positions[W*4*3+7]+=Y,this._meshInfo[R].positions[W*4*3+10]+=Y;if(this._rtl)for(let W=L;W<=$;W++){const ie=W*4*3;for(let te=0;te<4;++te)this._meshInfo[R].positions[ie+te*3]=this._element.calculatedWidth-this._meshInfo[R].positions[ie+te*3]+G*2;const q=this._meshInfo[R].positions[ie+3],K=this._meshInfo[R].positions[ie+6];this._meshInfo[R].positions[ie+3]=this._meshInfo[R].positions[ie+0],this._meshInfo[R].positions[ie+6]=this._meshInfo[R].positions[ie+9],this._meshInfo[R].positions[ie+0]=q,this._meshInfo[R].positions[ie+9]=K}L=$+1}const D=this._meshInfo[R].count*4,F=this._meshInfo[R].quad*4,j=new Xg(this._meshInfo[R].meshInstance.mesh.vertexBuffer);for(let z=0;z<D;z++)z>=F?(j.element[Xe].set(0,0,0),j.element[un].set(0,0),j.element[wr].set(0,0,0,0),j.element[Y_].set(0,0,0,0),j.element[K_].set(0,0,0,0)):(j.element[Xe].set(this._meshInfo[R].positions[z*3+0],this._meshInfo[R].positions[z*3+1],this._meshInfo[R].positions[z*3+2]),j.element[un].set(this._meshInfo[R].uvs[z*2+0],this._meshInfo[R].uvs[z*2+1]),j.element[wr].set(this._meshInfo[R].colors[z*4+0],this._meshInfo[R].colors[z*4+1],this._meshInfo[R].colors[z*4+2],this._meshInfo[R].colors[z*4+3]),j.element[Y_].set(this._meshInfo[R].outlines[z*3+0],this._meshInfo[R].outlines[z*3+1],this._meshInfo[R].outlines[z*3+2]),j.element[K_].set(this._meshInfo[R].shadows[z*3+0],this._meshInfo[R].shadows[z*3+1],this._meshInfo[R].shadows[z*3+2])),j.next();j.end(),this._meshInfo[R].meshInstance.mesh.aabb.compute(this._meshInfo[R].positions),this._meshInfo[R].meshInstance._aabbVer=-1}this._aabbDirty=!0}_onFontRender(){this.font=this._font}_onFontLoad(e){this.font!==e.resource&&(this.font=e.resource)}_onFontChange(e,t,i,s){if(t==="data"){this._font.data=i;const n=this._font.data.info.maps.length;for(let a=0;a<n;a++){if(!this._meshInfo[a])continue;const o=this._meshInfo[a].meshInstance;o&&(o.setParameter("font_sdfIntensity",this._font.intensity),o.setParameter("font_pxrange",this._getPxRange(this._font)),o.setParameter("font_textureWidth",this._font.data.info.maps[a].width))}}}_onFontRemove(e){}_setTextureParams(e,t){this._font&&(this._font.type===Mb?(e.deleteParameter("texture_emissiveMap"),e.deleteParameter("texture_opacityMap"),e.setParameter("texture_msdfMap",t)):this._font.type===sEe&&(e.deleteParameter("texture_msdfMap"),e.setParameter("texture_emissiveMap",t),e.setParameter("texture_opacityMap",t)))}_getPxRange(e){const t=Object.keys(this._font.data.chars);for(let i=0;i<t.length;i++){const s=this._font.data.chars[t[i]];if(s.range)return(s.scale||1)*s.range}return 2}_getUv(e){const t=this._font.data;if(!t.chars[e]){const f=" ";return t.chars[f]?this._getUv(f):[0,0,0,0]}const i=t.chars[e].map,s=t.info.maps[i].width,n=t.info.maps[i].height,a=t.chars[e].x,o=t.chars[e].y,l=a,c=o,u=a+t.chars[e].width,h=o-t.chars[e].height,d=1-t.chars[e].height/n;return[l/s,d-c/n,u/s,d-h/n]}onEnable(){this._fontAsset.autoLoad=!0,this._model&&this._element.addModelToLayers(this._model)}onDisable(){this._fontAsset.autoLoad=!1,this._model&&this._element.removeModelFromLayers(this._model)}_setStencil(e){if(this._model){const t=this._model.meshInstances;for(let i=0;i<t.length;i++)t[i].stencilFront=e,t[i].stencilBack=e}}_shouldAutoFitWidth(){return this._autoFitWidth&&!this._autoWidth}_shouldAutoFitHeight(){return this._autoFitHeight&&!this._autoHeight}_shouldAutoFit(){return this._autoFitWidth&&!this._autoWidth||this._autoFitHeight&&!this._autoHeight}_calculateCharsPerTexture(e){const t={};e===void 0&&(e=this._symbols.length);for(let i=0,s=e;i<s;i++){const n=this._symbols[i];let a=this._font.data.chars[n];a||(a=this._font.data.chars[" "],a||(a=this._font.data.chars[Object.keys(this._font.data.chars)[0]]));const o=a.map;t[o]?t[o]++:t[o]=1}return t}_updateRenderRange(){const e=this._rangeStart===0?0:this._calculateCharsPerTexture(this._rangeStart),t=this._rangeEnd===0?0:this._calculateCharsPerTexture(this._rangeEnd);for(let i=0,s=this._meshInfo.length;i<s;i++){const n=e[i]||0,a=t[i]||0,o=this._meshInfo[i].meshInstance;if(o){const l=o.mesh;l&&(l.primitive[0].base=n*3*2,l.primitive[0].count=(a-n)*3*2)}}}set text(e){this._i18nKey=null;const t=e!=null&&e.toString()||"";this._setText(t)}get text(){return this._text}set key(e){const t=e!==null?e.toString():null;this._i18nKey!==t&&(this._i18nKey=t,t?(this._fontAsset.disableLocalization=!1,this._resetLocalizedText()):this._fontAsset.disableLocalization=!0)}get key(){return this._i18nKey}set color(e){const t=e.r,i=e.g,s=e.b;if(!(this._color.r===t&&this._color.g===i&&this._color.b===s)&&(this._color.r=t,this._color.g=i,this._color.b=s,!!this._model)){if(this._symbolColors)this._font&&this._updateText();else{gt.linear(this._color),this._colorUniform[0]=gt.r,this._colorUniform[1]=gt.g,this._colorUniform[2]=gt.b;for(let n=0,a=this._model.meshInstances.length;n<a;n++)this._model.meshInstances[n].setParameter("material_emissive",this._colorUniform)}this._element&&this._element.fire("set:color",this._color)}}get color(){return this._color}set opacity(e){if(this._color.a!==e&&(this._color.a=e,this._model))for(let t=0,i=this._model.meshInstances.length;t<i;t++)this._model.meshInstances[t].setParameter("material_opacity",e);this._element&&this._element.fire("set:opacity",e)}get opacity(){return this._color.a}set lineHeight(e){const t=this._lineHeight;this._lineHeight=e,this._scaledLineHeight=e,t!==e&&this._font&&this._updateText()}get lineHeight(){return this._lineHeight}set wrapLines(e){const t=this._wrapLines;this._wrapLines=e,t!==e&&this._font&&this._updateText()}get wrapLines(){return this._wrapLines}get lines(){return this._lineContents}set spacing(e){const t=this._spacing;this._spacing=e,t!==e&&this._font&&this._updateText()}get spacing(){return this._spacing}set fontSize(e){const t=this._fontSize;this._fontSize=e,this._originalFontSize=e,t!==e&&this._font&&this._updateText()}get fontSize(){return this._fontSize}set fontAsset(e){this._fontAsset.defaultAsset=e}get fontAsset(){return this._fontAsset.localizedAsset}set font(e){let t;if(this._font&&(t=this._font.type,this._font.off&&this._font.off("render",this._onFontRender,this)),this._font=e,this._fontMinY=0,this._fontMaxY=0,!e)return;const i=this._font.data;for(const n in i.chars){const a=i.chars[n];a.bounds&&(this._fontMinY=Math.min(this._fontMinY,a.bounds[1]),this._fontMaxY=Math.max(this._fontMaxY,a.bounds[3]))}if(this._font.on&&this._font.on("render",this._onFontRender,this),this._fontAsset.localizedAsset&&this._system.app.assets.get(this._fontAsset.localizedAsset).resource!==this._font&&(this._fontAsset.defaultAsset=null),e.type!==t){const n=this._element._isScreenSpace();this._updateMaterial(n)}for(let n=0,a=this._font.textures.length;n<a;n++)if(!this._meshInfo[n])this._meshInfo[n]=new fEe;else{const o=this._meshInfo[n].meshInstance;o&&(o.setParameter("font_sdfIntensity",this._font.intensity),o.setParameter("font_pxrange",this._getPxRange(this._font)),o.setParameter("font_textureWidth",this._font.data.info.maps[n].width),this._setTextureParams(o,this._font.textures[n]))}let s=!1;for(let n=this._font.textures.length;n<this._meshInfo.length;n++)this._meshInfo[n].meshInstance&&(s||(this._element.removeModelFromLayers(this._model),s=!0),this._removeMeshInstance(this._meshInfo[n].meshInstance));this._meshInfo.length>this._font.textures.length&&(this._meshInfo.length=this._font.textures.length),this._updateText()}get font(){return this._font}set alignment(e){e instanceof ee?this._alignment.set(e.x,e.y):this._alignment.set(e[0],e[1]),this._font&&this._updateText()}get alignment(){return this._alignment}set autoWidth(e){const t=this._autoWidth;if(this._autoWidth=e,e&&Math.abs(this._element.anchor.x-this._element.anchor.z)<1e-4&&(this._element.width=this.width),t!==e){const i=this._shouldAutoFit()?this._maxFontSize:this._originalFontSize;i!==this._fontSize&&(this._fontSize=i,this._font&&this._updateText())}}get autoWidth(){return this._autoWidth}set autoHeight(e){const t=this._autoHeight;if(this._autoHeight=e,e&&Math.abs(this._element.anchor.y-this._element.anchor.w)<1e-4&&(this._element.height=this.height),t!==e){const i=this._shouldAutoFit()?this._maxFontSize:this._originalFontSize;i!==this._fontSize&&(this._fontSize=i,this._font&&this._updateText())}}get autoHeight(){return this._autoHeight}set rtlReorder(e){this._rtlReorder!==e&&(this._rtlReorder=e,this._font&&this._updateText())}get rtlReorder(){return this._rtlReorder}set unicodeConverter(e){this._unicodeConverter!==e&&(this._unicodeConverter=e,this._setText(this._text))}get unicodeConverter(){return this._unicodeConverter}get aabb(){if(this._aabbDirty){let e=!1;for(let t=0;t<this._meshInfo.length;t++)this._meshInfo[t].meshInstance&&(e?this._aabb.add(this._meshInfo[t].meshInstance.aabb):(this._aabb.copy(this._meshInfo[t].meshInstance.aabb),e=!0));this._aabbDirty=!1}return this._aabb}set outlineColor(e){const t=e instanceof ae?e.r:e[0],i=e instanceof ae?e.g:e[1],s=e instanceof ae?e.b:e[2],n=e instanceof ae?e.a:e[3];if(!(this._outlineColor.r===t&&this._outlineColor.g===i&&this._outlineColor.b===s&&this._outlineColor.a===n)&&(this._outlineColor.r=t,this._outlineColor.g=i,this._outlineColor.b=s,this._outlineColor.a=n,!!this._model)){if(this._symbolOutlineParams)this._font&&this._updateText();else{gt.linear(this._outlineColor),this._outlineColorUniform[0]=gt.r,this._outlineColorUniform[1]=gt.g,this._outlineColorUniform[2]=gt.b,this._outlineColorUniform[3]=gt.a;for(let a=0,o=this._model.meshInstances.length;a<o;a++)this._model.meshInstances[a].setParameter("outline_color",this._outlineColorUniform)}this._element&&this._element.fire("set:outline",this._color)}}get outlineColor(){return this._outlineColor}set outlineThickness(e){const t=this._outlineThickness;if(this._outlineThickness=e,t!==e&&this._font){if(!this._model)return;if(this._symbolOutlineParams)this._font&&this._updateText();else for(let i=0,s=this._model.meshInstances.length;i<s;i++)this._model.meshInstances[i].setParameter("outline_thickness",this._outlineThicknessScale*this._outlineThickness)}}get outlineThickness(){return this._outlineThickness}set shadowColor(e){const t=e instanceof ae?e.r:e[0],i=e instanceof ae?e.g:e[1],s=e instanceof ae?e.b:e[2],n=e instanceof ae?e.a:e[3];if(!(this._shadowColor.r===t&&this._shadowColor.g===i&&this._shadowColor.b===s&&this._shadowColor.a===n)&&(this._shadowColor.r=t,this._shadowColor.g=i,this._shadowColor.b=s,this._shadowColor.a=n,!!this._model))if(this._symbolShadowParams)this._font&&this._updateText();else{gt.linear(this._shadowColor),this._shadowColorUniform[0]=gt.r,this._shadowColorUniform[1]=gt.g,this._shadowColorUniform[2]=gt.b,this._shadowColorUniform[3]=gt.a;for(let a=0,o=this._model.meshInstances.length;a<o;a++)this._model.meshInstances[a].setParameter("shadow_color",this._shadowColorUniform)}}get shadowColor(){return this._shadowColor}set shadowOffset(e){const t=e instanceof ee?e.x:e[0],i=e instanceof ee?e.y:e[1];if(!(this._shadowOffset.x===t&&this._shadowOffset.y===i)&&(this._shadowOffset.set(t,i),this._font&&this._model))if(this._symbolShadowParams)this._updateText();else for(let s=0,n=this._model.meshInstances.length;s<n;s++){const a=-this._font.data.info.maps[s].width/this._font.data.info.maps[s].height;this._shadowOffsetUniform[0]=this._shadowOffsetScale*this._shadowOffset.x,this._shadowOffsetUniform[1]=a*this._shadowOffsetScale*this._shadowOffset.y,this._model.meshInstances[s].setParameter("shadow_offset",this._shadowOffsetUniform)}}get shadowOffset(){return this._shadowOffset}set minFontSize(e){this._minFontSize!==e&&(this._minFontSize=e,this.font&&this._shouldAutoFit()&&this._updateText())}get minFontSize(){return this._minFontSize}set maxFontSize(e){this._maxFontSize!==e&&(this._maxFontSize=e,this.font&&this._shouldAutoFit()&&this._updateText())}get maxFontSize(){return this._maxFontSize}set autoFitWidth(e){this._autoFitWidth!==e&&(this._autoFitWidth=e,this._fontSize=this._shouldAutoFit()?this._maxFontSize:this._originalFontSize,this.font&&this._updateText())}get autoFitWidth(){return this._autoFitWidth}set autoFitHeight(e){this._autoFitHeight!==e&&(this._autoFitHeight=e,this._fontSize=this._shouldAutoFit()?this._maxFontSize:this._originalFontSize,this.font&&this._updateText())}get autoFitHeight(){return this._autoFitHeight}set maxLines(e){this._maxLines!==e&&(e===null&&this._maxLines===-1||(this._maxLines=e===null?-1:e,this.font&&this._wrapLines&&this._updateText()))}get maxLines(){return this._maxLines}set enableMarkup(e){if(e=!!e,this._enableMarkup===e)return;this._enableMarkup=e,this.font&&this._updateText();const t=this._element._isScreenSpace();this._updateMaterial(t)}get enableMarkup(){return this._enableMarkup}get symbols(){return this._symbols}get symbolColors(){return this._symbolColors===null?null:this._symbolColors.map(function(e){return this._colorPalette.slice(e*3,e*3+3)},this)}get symbolOutlineParams(){return this._symbolOutlineParams===null?null:this._symbolOutlineParams.map(function(e){return this._outlinePalette.slice(e*5,e*5+5)},this)}get symbolShadowParams(){return this._symbolShadowParams===null?null:this._symbolShadowParams.map(function(e){return this._shadowPalette.slice(e*6,e*6+6)},this)}get rtl(){return this._rtl}set rangeStart(e){e=Math.max(0,Math.min(e,this._symbols.length)),e!==this._rangeStart&&(this._rangeStart=e,this._updateRenderRange())}get rangeStart(){return this._rangeStart}set rangeEnd(e){e=Math.max(this._rangeStart,Math.min(e,this._symbols.length)),e!==this._rangeEnd&&(this._rangeEnd=e,this._updateRenderRange())}get rangeEnd(){return this._rangeEnd}}const VC=new O,Xz=new se,uo=new O,bEe=new O,js=new se,aS=new se,oS=new se,pd=new se,ps=class ps extends ke{constructor(e,t){super(e,t),this._evtLayersChanged=null,this._evtLayerAdded=null,this._evtLayerRemoved=null,this._beingInitialized=!1,this._anchor=new ce,this._localAnchor=new ce,this._pivot=new ee,this._width=this._calculatedWidth=32,this._height=this._calculatedHeight=32,this._margin=new ce(0,0,-32,-32),this._modelTransform=new se,this._screenToWorld=new se,this._anchorTransform=new se,this._anchorDirty=!0,this._parentWorldTransform=new se,this._screenTransform=new se,this._screenCorners=[new O,new O,new O,new O],this._canvasCorners=[new ee,new ee,new ee,new ee],this._worldCorners=[new O,new O,new O,new O],this._cornersDirty=!0,this._canvasCornersDirty=!0,this._worldCornersDirty=!0,this.entity.on("insert",this._onInsert,this),this._patch(),this.screen=null,this._type=dx,this._image=null,this._text=null,this._group=null,this._drawOrder=0,this._fitMode=fx,this._useInput=!1,this._layers=[LE],this._addedModels=[],this._batchGroupId=-1,this._offsetReadAt=0,this._maskOffset=.5,this._maskedBy=null}get data(){const e=this.system.store[this.entity.getGuid()];return e?e.data:null}set enabled(e){const t=this.data,i=t.enabled;t.enabled=e,this.fire("set","enabled",i,e)}get enabled(){return this.data.enabled}get _absLeft(){return this._localAnchor.x+this._margin.x}get _absRight(){return this._localAnchor.z-this._margin.z}get _absTop(){return this._localAnchor.w-this._margin.w}get _absBottom(){return this._localAnchor.y+this._margin.y}get _hasSplitAnchorsX(){return Math.abs(this._anchor.x-this._anchor.z)>.001}get _hasSplitAnchorsY(){return Math.abs(this._anchor.y-this._anchor.w)>.001}get aabb(){return this._image?this._image.aabb:this._text?this._text.aabb:null}set anchor(e){e instanceof ce?this._anchor.copy(e):this._anchor.set(...e),!this.entity._parent&&!this.screen?this._calculateLocalAnchors():this._calculateSize(this._hasSplitAnchorsX,this._hasSplitAnchorsY),this._anchorDirty=!0,this.entity._dirtyLocal||this.entity._dirtifyLocal(),this.fire("set:anchor",this._anchor)}get anchor(){return this._anchor}set batchGroupId(e){var t,i;this._batchGroupId!==e&&(this.entity.enabled&&this._batchGroupId>=0&&((t=this.system.app.batcher)==null||t.remove(Bi.ELEMENT,this.batchGroupId,this.entity)),this.entity.enabled&&e>=0&&((i=this.system.app.batcher)==null||i.insert(Bi.ELEMENT,e,this.entity)),e<0&&this._batchGroupId>=0&&this.enabled&&this.entity.enabled&&(this._image&&this._image._renderable.model?this.addModelToLayers(this._image._renderable.model):this._text&&this._text._model&&this.addModelToLayers(this._text._model)),this._batchGroupId=e)}get batchGroupId(){return this._batchGroupId}set bottom(e){this._margin.y=e;const t=this.entity.getLocalPosition(),i=this._absTop,s=this._localAnchor.y+e;this._setHeight(i-s),t.y=e+this._calculatedHeight*this._pivot.y,this.entity.setLocalPosition(t)}get bottom(){return this._margin.y}set calculatedWidth(e){this._setCalculatedWidth(e,!0)}get calculatedWidth(){return this._calculatedWidth}set calculatedHeight(e){this._setCalculatedHeight(e,!0)}get calculatedHeight(){return this._calculatedHeight}get canvasCorners(){if(!this._canvasCornersDirty||!this.screen||!this.screen.screen.screenSpace)return this._canvasCorners;const e=this.system.app.graphicsDevice,t=this.screenCorners,i=e.canvas.clientWidth/e.width,s=e.canvas.clientHeight/e.height;for(let n=0;n<4;n++)this._canvasCorners[n].set(t[n].x*i,(e.height-t[n].y)*s);return this._canvasCornersDirty=!1,this._canvasCorners}set drawOrder(e){let t=0;this.screen&&(t=this.screen.screen.priority),e>16777215&&(e=16777215),this._drawOrder=(t<<24)+e,this.fire("set:draworder",this._drawOrder)}get drawOrder(){return this._drawOrder}set height(e){this._height=e,this._hasSplitAnchorsY||this._setCalculatedHeight(e,!0),this.fire("set:height",this._height)}get height(){return this._height}set layers(e){if(this._addedModels.length)for(let t=0;t<this._layers.length;t++){const i=this.system.app.scene.layers.getLayerById(this._layers[t]);if(i)for(let s=0;s<this._addedModels.length;s++)i.removeMeshInstances(this._addedModels[s].meshInstances)}if(this._layers=e,!(!this.enabled||!this.entity.enabled||!this._addedModels.length))for(let t=0;t<this._layers.length;t++){const i=this.system.app.scene.layers.getLayerById(this._layers[t]);if(i)for(let s=0;s<this._addedModels.length;s++)i.addMeshInstances(this._addedModels[s].meshInstances)}}get layers(){return this._layers}set left(e){this._margin.x=e;const t=this.entity.getLocalPosition(),i=this._absRight,s=this._localAnchor.x+e;this._setWidth(i-s),t.x=e+this._calculatedWidth*this._pivot.x,this.entity.setLocalPosition(t)}get left(){return this._margin.x}set margin(e){this._margin.copy(e),this._calculateSize(!0,!0),this.fire("set:margin",this._margin)}get margin(){return this._margin}get maskedBy(){return this._maskedBy}set pivot(e){const{pivot:t,margin:i}=this,s=t.x,n=t.y;e instanceof ee?t.copy(e):t.set(...e);const a=i.x+i.z,o=t.x-s;i.x+=a*o,i.z-=a*o;const l=i.y+i.w,c=t.y-n;i.y+=l*c,i.w-=l*c,this._anchorDirty=!0,this._cornersDirty=!0,this._worldCornersDirty=!0,this._calculateSize(!1,!1),this._flagChildrenAsDirty(),this.fire("set:pivot",t)}get pivot(){return this._pivot}set right(e){this._margin.z=e;const t=this.entity.getLocalPosition(),i=this._absLeft,s=this._localAnchor.z-e;this._setWidth(s-i),t.x=this._localAnchor.z-this._localAnchor.x-e-this._calculatedWidth*(1-this._pivot.x),this.entity.setLocalPosition(t)}get right(){return this._margin.z}get screenCorners(){if(!this._cornersDirty||!this.screen)return this._screenCorners;const e=this.entity.parent&&this.entity.parent.element&&this.entity.parent.element.screenCorners[0];this._screenCorners[0].set(this._absLeft,this._absBottom,0),this._screenCorners[1].set(this._absRight,this._absBottom,0),this._screenCorners[2].set(this._absRight,this._absTop,0),this._screenCorners[3].set(this._absLeft,this._absTop,0);const t=this.screen.screen.screenSpace;for(let i=0;i<4;i++)this._screenTransform.transformPoint(this._screenCorners[i],this._screenCorners[i]),t&&this._screenCorners[i].mulScalar(this.screen.screen.scale),e&&this._screenCorners[i].add(e);return this._cornersDirty=!1,this._canvasCornersDirty=!0,this._worldCornersDirty=!0,this._screenCorners}get textWidth(){return this._text?this._text.width:0}get textHeight(){return this._text?this._text.height:0}set top(e){this._margin.w=e;const t=this.entity.getLocalPosition(),i=this._absBottom,s=this._localAnchor.w-e;this._setHeight(s-i),t.y=this._localAnchor.w-this._localAnchor.y-e-this._calculatedHeight*(1-this._pivot.y),this.entity.setLocalPosition(t)}get top(){return this._margin.w}set type(e){e!==this._type&&(this._type=e,this._image&&(this._image.destroy(),this._image=null),this._text&&(this._text.destroy(),this._text=null),e===qM?this._image=new iEe(this):e===uY&&(this._text=new xEe(this)))}get type(){return this._type}set useInput(e){this._useInput!==e&&(this._useInput=e,this.system.app.elementInput?e?this.enabled&&this.entity.enabled&&this.system.app.elementInput.addElement(this):this.system.app.elementInput.removeElement(this):this._useInput,this.fire("set:useInput",e))}get useInput(){return this._useInput}set fitMode(e){this._fitMode=e,this._calculateSize(!0,!0),this._image&&this._image.refreshMesh()}get fitMode(){return this._fitMode}set width(e){this._width=e,this._hasSplitAnchorsX||this._setCalculatedWidth(e,!0),this.fire("set:width",this._width)}get width(){return this._width}get worldCorners(){if(!this._worldCornersDirty)return this._worldCorners;if(this.screen){const e=this.screenCorners;if(!this.screen.screen.screenSpace){js.copy(this.screen.screen._screenMatrix),js.data[13]=-js.data[13],js.mul2(this.screen.getWorldTransform(),js);for(let t=0;t<4;t++)js.transformPoint(e[t],this._worldCorners[t])}}else{const e=this.entity.getLocalPosition();js.setTranslate(-e.x,-e.y,-e.z),aS.setTRS(O.ZERO,this.entity.getLocalRotation(),this.entity.getLocalScale()),oS.setTranslate(e.x,e.y,e.z);const t=this.entity.parent?this.entity.parent:this.entity;pd.copy(t.getWorldTransform()),pd.mul(oS).mul(aS).mul(js),uo.set(e.x-this.pivot.x*this.calculatedWidth,e.y-this.pivot.y*this.calculatedHeight,e.z),pd.transformPoint(uo,this._worldCorners[0]),uo.set(e.x+(1-this.pivot.x)*this.calculatedWidth,e.y-this.pivot.y*this.calculatedHeight,e.z),pd.transformPoint(uo,this._worldCorners[1]),uo.set(e.x+(1-this.pivot.x)*this.calculatedWidth,e.y+(1-this.pivot.y)*this.calculatedHeight,e.z),pd.transformPoint(uo,this._worldCorners[2]),uo.set(e.x-this.pivot.x*this.calculatedWidth,e.y+(1-this.pivot.y)*this.calculatedHeight,e.z),pd.transformPoint(uo,this._worldCorners[3])}return this._worldCornersDirty=!1,this._worldCorners}set fontSize(e){this._setValue("fontSize",e)}get fontSize(){return this._text?this._text.fontSize:null}set minFontSize(e){this._setValue("minFontSize",e)}get minFontSize(){return this._text?this._text.minFontSize:null}set maxFontSize(e){this._setValue("maxFontSize",e)}get maxFontSize(){return this._text?this._text.maxFontSize:null}set maxLines(e){this._setValue("maxLines",e)}get maxLines(){return this._text?this._text.maxLines:null}set autoFitWidth(e){this._setValue("autoFitWidth",e)}get autoFitWidth(){return this._text?this._text.autoFitWidth:null}set autoFitHeight(e){this._setValue("autoFitHeight",e)}get autoFitHeight(){return this._text?this._text.autoFitHeight:null}set color(e){this._setValue("color",e)}get color(){return this._text?this._text.color:this._image?this._image.color:null}set font(e){this._setValue("font",e)}get font(){return this._text?this._text.font:null}set fontAsset(e){this._setValue("fontAsset",e)}get fontAsset(){return this._text&&typeof this._text.fontAsset=="number"?this._text.fontAsset:null}set spacing(e){this._setValue("spacing",e)}get spacing(){return this._text?this._text.spacing:null}set lineHeight(e){this._setValue("lineHeight",e)}get lineHeight(){return this._text?this._text.lineHeight:null}set wrapLines(e){this._setValue("wrapLines",e)}get wrapLines(){return this._text?this._text.wrapLines:null}set lines(e){this._setValue("lines",e)}get lines(){return this._text?this._text.lines:null}set alignment(e){this._setValue("alignment",e)}get alignment(){return this._text?this._text.alignment:null}set autoWidth(e){this._setValue("autoWidth",e)}get autoWidth(){return this._text?this._text.autoWidth:null}set autoHeight(e){this._setValue("autoHeight",e)}get autoHeight(){return this._text?this._text.autoHeight:null}set rtlReorder(e){this._setValue("rtlReorder",e)}get rtlReorder(){return this._text?this._text.rtlReorder:null}set unicodeConverter(e){this._setValue("unicodeConverter",e)}get unicodeConverter(){return this._text?this._text.unicodeConverter:null}set text(e){this._setValue("text",e)}get text(){return this._text?this._text.text:null}set key(e){this._setValue("key",e)}get key(){return this._text?this._text.key:null}set texture(e){this._setValue("texture",e)}get texture(){return this._image?this._image.texture:null}set textureAsset(e){this._setValue("textureAsset",e)}get textureAsset(){return this._image?this._image.textureAsset:null}set material(e){this._setValue("material",e)}get material(){return this._image?this._image.material:null}set materialAsset(e){this._setValue("materialAsset",e)}get materialAsset(){return this._image?this._image.materialAsset:null}set sprite(e){this._setValue("sprite",e)}get sprite(){return this._image?this._image.sprite:null}set spriteAsset(e){this._setValue("spriteAsset",e)}get spriteAsset(){return this._image?this._image.spriteAsset:null}set spriteFrame(e){this._setValue("spriteFrame",e)}get spriteFrame(){return this._image?this._image.spriteFrame:null}set pixelsPerUnit(e){this._setValue("pixelsPerUnit",e)}get pixelsPerUnit(){return this._image?this._image.pixelsPerUnit:null}set opacity(e){this._setValue("opacity",e)}get opacity(){return this._text?this._text.opacity:this._image?this._image.opacity:null}set rect(e){this._setValue("rect",e)}get rect(){return this._image?this._image.rect:null}set mask(e){this._setValue("mask",e)}get mask(){return this._image?this._image.mask:null}set outlineColor(e){this._setValue("outlineColor",e)}get outlineColor(){return this._text?this._text.outlineColor:null}set outlineThickness(e){this._setValue("outlineThickness",e)}get outlineThickness(){return this._text?this._text.outlineThickness:null}set shadowColor(e){this._setValue("shadowColor",e)}get shadowColor(){return this._text?this._text.shadowColor:null}set shadowOffset(e){this._setValue("shadowOffset",e)}get shadowOffset(){return this._text?this._text.shadowOffset:null}set enableMarkup(e){this._setValue("enableMarkup",e)}get enableMarkup(){return this._text?this._text.enableMarkup:null}set rangeStart(e){this._setValue("rangeStart",e)}get rangeStart(){return this._text?this._text.rangeStart:null}set rangeEnd(e){this._setValue("rangeEnd",e)}get rangeEnd(){return this._text?this._text.rangeEnd:null}_setValue(e,t){this._text?(this._text[e]!==t&&this._dirtyBatch(),this._text[e]=t):this._image&&(this._image[e]!==t&&this._dirtyBatch(),this._image[e]=t)}_patch(){this.entity._sync=this._sync,this.entity.setPosition=this._setPosition,this.entity.setLocalPosition=this._setLocalPosition}_unpatch(){this.entity._sync=lt.prototype._sync,this.entity.setPosition=lt.prototype.setPosition,this.entity.setLocalPosition=lt.prototype.setLocalPosition}_setPosition(e,t,i){if(!this.element.screen){lt.prototype.setPosition.call(this,e,t,i);return}e instanceof O?VC.copy(e):VC.set(e,t,i),this.getWorldTransform(),Xz.copy(this.element._screenToWorld).invert(),Xz.transformPoint(VC,this.localPosition),this._dirtyLocal||this._dirtifyLocal()}_setLocalPosition(e,t,i){e instanceof O?this.localPosition.copy(e):this.localPosition.set(e,t,i);const s=this.element,n=this.localPosition,a=s._pivot;s._margin.x=n.x-s._calculatedWidth*a.x,s._margin.z=s._localAnchor.z-s._localAnchor.x-s._calculatedWidth-s._margin.x,s._margin.y=n.y-s._calculatedHeight*a.y,s._margin.w=s._localAnchor.w-s._localAnchor.y-s._calculatedHeight-s._margin.y,this._dirtyLocal||this._dirtifyLocal()}_sync(){const e=this.element,t=e.screen;if(t){if(e._anchorDirty){let i=0,s=0,n=0,a=1;if(this._parent&&this._parent.element)i=this._parent.element.calculatedWidth,s=this._parent.element.calculatedHeight,n=this._parent.element.pivot.x,a=this._parent.element.pivot.y;else{const o=t.screen.resolution;i=o.x/t.screen.scale,s=o.y/t.screen.scale}e._anchorTransform.setTranslate(i*(e.anchor.x-n),-(s*(a-e.anchor.y)),0),e._anchorDirty=!1,e._calculateLocalAnchors()}e._sizeDirty&&e._calculateSize(!1,!1)}if(this._dirtyLocal){this.localTransform.setTRS(this.localPosition,this.localRotation,this.localScale);const i=this.localPosition,s=e._pivot;e._margin.x=i.x-e._calculatedWidth*s.x,e._margin.z=e._localAnchor.z-e._localAnchor.x-e._calculatedWidth-e._margin.x,e._margin.y=i.y-e._calculatedHeight*s.y,e._margin.w=e._localAnchor.w-e._localAnchor.y-e._calculatedHeight-e._margin.y,this._dirtyLocal=!1}if(!t){this._dirtyWorld&&(e._cornersDirty=!0,e._canvasCornersDirty=!0,e._worldCornersDirty=!0),lt.prototype._sync.call(this);return}if(this._dirtyWorld){if(this._parent===null)this.worldTransform.copy(this.localTransform);else if(this._parent.element?e._screenToWorld.mul2(this._parent.element._modelTransform,e._anchorTransform):e._screenToWorld.copy(e._anchorTransform),e._modelTransform.mul2(e._screenToWorld,this.localTransform),t){e._screenToWorld.mul2(t.screen._screenMatrix,e._screenToWorld),t.screen.screenSpace||e._screenToWorld.mul2(t.worldTransform,e._screenToWorld),this.worldTransform.mul2(e._screenToWorld,this.localTransform);const i=e._parentWorldTransform;i.setIdentity();const s=this._parent;s&&s.element&&s!==t&&(js.setTRS(O.ZERO,s.getLocalRotation(),s.getLocalScale()),i.mul2(s.element._parentWorldTransform,js));const n=uo;n.set(0,0,this.localPosition.z);const a=bEe;a.set(e._absLeft+e._pivot.x*e.calculatedWidth,e._absBottom+e._pivot.y*e.calculatedHeight,0),js.setTranslate(-a.x,-a.y,-a.z),aS.setTRS(n,this.getLocalRotation(),this.getLocalScale()),oS.setTranslate(a.x,a.y,a.z),e._screenTransform.mul2(e._parentWorldTransform,oS).mul(aS).mul(js),e._cornersDirty=!0,e._canvasCornersDirty=!0,e._worldCornersDirty=!0}else this.worldTransform.copy(e._modelTransform);this._dirtyWorld=!1}}_onInsert(e){const t=this._parseUpToScreen();this.entity._dirtifyWorld(),this._updateScreen(t.screen),this._dirtifyMask()}_dirtifyMask(){let e=this.entity;for(;e;){const t=e.parent;if((t===null||t.screen)&&e.element){(!this.system._prerender||!this.system._prerender.length)&&(this.system._prerender=[],this.system.app.once("prerender",this._onPrerender,this));const i=this.system._prerender.indexOf(this.entity);i>=0&&this.system._prerender.splice(i,1),this.system._prerender.indexOf(e)<0&&this.system._prerender.push(e)}e=t}}_onPrerender(){for(let e=0;e<this.system._prerender.length;e++){const t=this.system._prerender[e];t.element&&t.element.syncMask(1)}this.system._prerender.length=0}_bindScreen(e){e._bindElement(this)}_unbindScreen(e){e._unbindElement(this)}_updateScreen(e){this.screen&&this.screen!==e&&this._unbindScreen(this.screen.screen);const t=this.screen;this.screen=e,this.screen&&this._bindScreen(this.screen.screen),this._calculateSize(this._hasSplitAnchorsX,this._hasSplitAnchorsY),this.fire("set:screen",this.screen,t),this._anchorDirty=!0;const i=this.entity.children;for(let s=0,n=i.length;s<n;s++)i[s].element&&i[s].element._updateScreen(e);this.screen&&this.screen.screen.syncDrawOrder()}syncMask(e){const t=this._parseUpToScreen();this._updateMask(t.mask,e)}_setMaskedBy(e){const t=this._image||this._text;if(e){const i=e.element._image._maskRef;t==null||t._setStencil(new Oa({ref:i,func:lb})),this._maskedBy=e}else t==null||t._setStencil(null),this._maskedBy=null}_updateMask(e,t){var i,s;if(e){if(this._setMaskedBy(e),this.mask){const a=e.element._image._maskRef,o=new Oa({ref:a,func:lb,zpass:qde});this._image._setStencil(o),this._image._maskRef=t,t++,e=this.entity}const n=this.entity.children;for(let a=0,o=n.length;a<o;a++)(i=n[a].element)==null||i._updateMask(e,t);this.mask&&t--}else{if(this._setMaskedBy(null),this.mask){const a=new Oa({ref:t,func:Lo,zpass:Xde});this._image._setStencil(a),this._image._maskRef=t,t++,e=this.entity}const n=this.entity.children;for(let a=0,o=n.length;a<o;a++)(s=n[a].element)==null||s._updateMask(e,t);this.mask&&t--}}_parseUpToScreen(){const e={screen:null,mask:null};let t=this.entity._parent;for(;t&&!t.screen;)t.element&&t.element.mask&&(e.mask||(e.mask=t)),t=t.parent;return t&&t.screen&&(e.screen=t),e}_onScreenResize(e){this._anchorDirty=!0,this._cornersDirty=!0,this._worldCornersDirty=!0,this._calculateSize(this._hasSplitAnchorsX,this._hasSplitAnchorsY),this.fire("screen:set:resolution",e)}_onScreenSpaceChange(){this.fire("screen:set:screenspace",this.screen.screen.screenSpace)}_onScreenRemove(){this.screen&&(this.screen._destroying?this.screen=null:this._updateScreen(null))}_calculateLocalAnchors(){let e=1e3,t=1e3;const i=this.entity._parent;if(i&&i.element)e=i.element.calculatedWidth,t=i.element.calculatedHeight;else if(this.screen){const s=this.screen.screen.resolution,n=this.screen.screen.scale;e=s.x/n,t=s.y/n}this._localAnchor.set(this._anchor.x*e,this._anchor.y*t,this._anchor.z*e,this._anchor.w*t)}getOffsetPosition(e,t){const i=this.entity.getLocalPosition().clone();return i.x+=e,i.y+=t,this._screenToWorld.transformPoint(i,i),i}onLayersChanged(e,t){this.addModelToLayers(this._image?this._image._renderable.model:this._text._model),e.off("add",this.onLayerAdded,this),e.off("remove",this.onLayerRemoved,this),t.on("add",this.onLayerAdded,this),t.on("remove",this.onLayerRemoved,this)}onLayerAdded(e){this.layers.indexOf(e.id)<0||(this._image?e.addMeshInstances(this._image._renderable.model.meshInstances):this._text&&e.addMeshInstances(this._text._model.meshInstances))}onLayerRemoved(e){this.layers.indexOf(e.id)<0||(this._image?e.removeMeshInstances(this._image._renderable.model.meshInstances):this._text&&e.removeMeshInstances(this._text._model.meshInstances))}onEnable(){var i;const e=this.system.app.scene,t=e.layers;this._image&&this._image.onEnable(),this._text&&this._text.onEnable(),this._group&&this._group.onEnable(),this.useInput&&this.system.app.elementInput&&this.system.app.elementInput.addElement(this),this._evtLayersChanged=e.on("set:layers",this.onLayersChanged,this),t&&(this._evtLayerAdded=t.on("add",this.onLayerAdded,this),this._evtLayerRemoved=t.on("remove",this.onLayerRemoved,this)),this._batchGroupId>=0&&((i=this.system.app.batcher)==null||i.insert(Bi.ELEMENT,this.batchGroupId,this.entity)),this.fire("enableelement")}onDisable(){var i,s,n,a;const t=this.system.app.scene.layers;(i=this._evtLayersChanged)==null||i.off(),this._evtLayersChanged=null,t&&((s=this._evtLayerAdded)==null||s.off(),this._evtLayerAdded=null,(n=this._evtLayerRemoved)==null||n.off(),this._evtLayerRemoved=null),this._image&&this._image.onDisable(),this._text&&this._text.onDisable(),this._group&&this._group.onDisable(),this.system.app.elementInput&&this.useInput&&this.system.app.elementInput.removeElement(this),this._batchGroupId>=0&&((a=this.system.app.batcher)==null||a.remove(Bi.ELEMENT,this.batchGroupId,this.entity)),this.fire("disableelement")}onRemove(){this.entity.off("insert",this._onInsert,this),this._unpatch(),this._image&&this._image.destroy(),this._text&&this._text.destroy(),this.system.app.elementInput&&this.useInput&&this.system.app.elementInput.removeElement(this),this.screen&&this.screen.screen&&(this._unbindScreen(this.screen.screen),this.screen.screen.syncDrawOrder()),this.off()}_calculateSize(e,t){if(!this.entity._parent&&!this.screen)return;this._calculateLocalAnchors();const i=this._absRight-this._absLeft,s=this._absTop-this._absBottom;e?this._setWidth(i):this._setCalculatedWidth(i,!1),t?this._setHeight(s):this._setCalculatedHeight(s,!1);const n=this.entity.getLocalPosition();n.x=this._margin.x+this._calculatedWidth*this._pivot.x,n.y=this._margin.y+this._calculatedHeight*this._pivot.y,this.entity.setLocalPosition(n),this._sizeDirty=!1}_setWidth(e){this._width=e,this._setCalculatedWidth(e,!1),this.fire("set:width",this._width)}_setHeight(e){this._height=e,this._setCalculatedHeight(e,!1),this.fire("set:height",this._height)}_setCalculatedWidth(e,t){if(!(Math.abs(e-this._calculatedWidth)<=1e-4)){if(this._calculatedWidth=e,this.entity._dirtifyLocal(),t){const i=this.entity.getLocalPosition(),s=this._pivot;this._margin.x=i.x-this._calculatedWidth*s.x,this._margin.z=this._localAnchor.z-this._localAnchor.x-this._calculatedWidth-this._margin.x}this._flagChildrenAsDirty(),this.fire("set:calculatedWidth",this._calculatedWidth),this.fire("resize",this._calculatedWidth,this._calculatedHeight)}}_setCalculatedHeight(e,t){if(!(Math.abs(e-this._calculatedHeight)<=1e-4)){if(this._calculatedHeight=e,this.entity._dirtifyLocal(),t){const i=this.entity.getLocalPosition(),s=this._pivot;this._margin.y=i.y-this._calculatedHeight*s.y,this._margin.w=this._localAnchor.w-this._localAnchor.y-this._calculatedHeight-this._margin.y}this._flagChildrenAsDirty(),this.fire("set:calculatedHeight",this._calculatedHeight),this.fire("resize",this._calculatedWidth,this._calculatedHeight)}}_flagChildrenAsDirty(){const e=this.entity._children;for(let t=0,i=e.length;t<i;t++)e[t].element&&(e[t].element._anchorDirty=!0,e[t].element._sizeDirty=!0)}addModelToLayers(e){this._addedModels.push(e);for(let t=0;t<this.layers.length;t++){const i=this.system.app.scene.layers.getLayerById(this.layers[t]);i&&i.addMeshInstances(e.meshInstances)}}removeModelFromLayers(e){const t=this._addedModels.indexOf(e);t>=0&&this._addedModels.splice(t,1);for(let i=0;i<this.layers.length;i++){const s=this.system.app.scene.layers.getLayerById(this.layers[i]);s&&s.removeMeshInstances(e.meshInstances)}}getMaskOffset(){const e=this.system.app.frame;this._offsetReadAt!==e&&(this._maskOffset=.5,this._offsetReadAt=e);const t=this._maskOffset;return this._maskOffset-=.001,t}isVisibleForCamera(e){let t,i,s,n;if(this.maskedBy){const h=this.maskedBy.element.screenCorners;t=Math.min(Math.min(h[0].x,h[1].x),Math.min(h[2].x,h[3].x)),i=Math.max(Math.max(h[0].x,h[1].x),Math.max(h[2].x,h[3].x)),n=Math.min(Math.min(h[0].y,h[1].y),Math.min(h[2].y,h[3].y)),s=Math.max(Math.max(h[0].y,h[1].y),Math.max(h[2].y,h[3].y))}else{const h=this.system.app.graphicsDevice.width,d=this.system.app.graphicsDevice.height,f=e._rect.z*h,p=e._rect.w*d;t=e._rect.x*h,i=t+f,s=(1-e._rect.y)*d,n=s-p}const a=this.screenCorners,o=Math.min(Math.min(a[0].x,a[1].x),Math.min(a[2].x,a[3].x)),l=Math.max(Math.max(a[0].x,a[1].x),Math.max(a[2].x,a[3].x)),c=Math.min(Math.min(a[0].y,a[1].y),Math.min(a[2].y,a[3].y)),u=Math.max(Math.max(a[0].y,a[1].y),Math.max(a[2].y,a[3].y));return!(l<t||o>i||c>s||u<n)}_isScreenSpace(){return this.screen&&this.screen.screen?this.screen.screen.screenSpace:!1}_isScreenCulled(){return this.screen&&this.screen.screen?this.screen.screen.cull:!1}_dirtyBatch(){var e;this.batchGroupId!==-1&&((e=this.system.app.batcher)==null||e.markGroupDirty(this.batchGroupId))}};ps.EVENT_MOUSEDOWN="mousedown",ps.EVENT_MOUSEUP="mouseup",ps.EVENT_MOUSEENTER="mouseenter",ps.EVENT_MOUSELEAVE="mouseleave",ps.EVENT_MOUSEMOVE="mousemove",ps.EVENT_MOUSEWHEEL="mousewheel",ps.EVENT_CLICK="click",ps.EVENT_TOUCHSTART="touchstart",ps.EVENT_TOUCHEND="touchend",ps.EVENT_TOUCHMOVE="touchmove",ps.EVENT_TOUCHCANCEL="touchcancel";let Rb=ps;class wEe{constructor(){this.enabled=!0}}const TEe=["enabled"];class EEe extends si{constructor(e){super(e),this.id="element",this.ComponentType=Rb,this.DataType=wEe,this.schema=TEe,this._unicodeConverter=null,this._rtlReorder=null,this._defaultTexture=new we(e.graphicsDevice,{width:1,height:1,format:Ms,name:"element-system"});const t=this._defaultTexture.lock(),i=new Uint8Array(4);i[0]=255,i[1]=255,i[2]=255,i[3]=255,t.set(i),this._defaultTexture.unlock(),this.defaultImageMaterial=null,this.defaultImage9SlicedMaterial=null,this.defaultImage9TiledMaterial=null,this.defaultImageMaskMaterial=null,this.defaultImage9SlicedMaskMaterial=null,this.defaultImage9TiledMaskMaterial=null,this.defaultScreenSpaceImageMaterial=null,this.defaultScreenSpaceImage9SlicedMaterial=null,this.defaultScreenSpaceImage9TiledMaterial=null,this.defaultScreenSpaceImageMask9SlicedMaterial=null,this.defaultScreenSpaceImageMask9TiledMaterial=null,this.defaultScreenSpaceImageMaskMaterial=null,this._defaultTextMaterials={},this.defaultImageMaterials=[],this.on("add",this.onAddComponent,this),this.on("beforeremove",this.onRemoveComponent,this)}destroy(){super.destroy(),this._defaultTexture.destroy()}initializeComponentData(e,t,i){e._beingInitialized=!0,t.anchor!==void 0&&(t.anchor instanceof ce?e.anchor.copy(t.anchor):e.anchor.set(t.anchor[0],t.anchor[1],t.anchor[2],t.anchor[3])),t.pivot!==void 0&&(t.pivot instanceof ee?e.pivot.copy(t.pivot):e.pivot.set(t.pivot[0],t.pivot[1]));const s=Math.abs(e.anchor.x-e.anchor.z)>.001,n=Math.abs(e.anchor.y-e.anchor.w)>.001;let a=!1,o;t.margin!==void 0&&(t.margin instanceof ce?e.margin.copy(t.margin):e._margin.set(t.margin[0],t.margin[1],t.margin[2],t.margin[3]),a=!0),t.left!==void 0&&(e._margin.x=t.left,a=!0),t.bottom!==void 0&&(e._margin.y=t.bottom,a=!0),t.right!==void 0&&(e._margin.z=t.right,a=!0),t.top!==void 0&&(e._margin.w=t.top,a=!0),a&&(e.margin=e._margin);let l=!1;t.width!==void 0&&!s?e.width=t.width:s&&(l=!0),t.height!==void 0&&!n?e.height=t.height:n&&(l=!0),l&&(e.anchor=e.anchor),t.enabled!==void 0&&(e.enabled=t.enabled),t.useInput!==void 0&&(e.useInput=t.useInput),t.fitMode!==void 0&&(e.fitMode=t.fitMode),e.batchGroupId=t.batchGroupId===void 0||t.batchGroupId===null?-1:t.batchGroupId,t.layers&&Array.isArray(t.layers)&&(e.layers=t.layers.slice(0)),t.type!==void 0&&(e.type=t.type),e.type===qM?(t.rect!==void 0&&(e.rect=t.rect),t.color!==void 0&&(o=t.color,o instanceof ae||(o=new ae(t.color[0],t.color[1],t.color[2])),e.color=o),t.opacity!==void 0&&(e.opacity=t.opacity),t.textureAsset!==void 0&&(e.textureAsset=t.textureAsset),t.texture&&(e.texture=t.texture),t.spriteAsset!==void 0&&(e.spriteAsset=t.spriteAsset),t.sprite&&(e.sprite=t.sprite),t.spriteFrame!==void 0&&(e.spriteFrame=t.spriteFrame),t.pixelsPerUnit!==void 0&&t.pixelsPerUnit!==null&&(e.pixelsPerUnit=t.pixelsPerUnit),t.materialAsset!==void 0&&(e.materialAsset=t.materialAsset),t.material&&(e.material=t.material),t.mask!==void 0&&(e.mask=t.mask)):e.type===uY&&(t.autoWidth!==void 0&&(e.autoWidth=t.autoWidth),t.autoHeight!==void 0&&(e.autoHeight=t.autoHeight),t.rtlReorder!==void 0&&(e.rtlReorder=t.rtlReorder),t.unicodeConverter!==void 0&&(e.unicodeConverter=t.unicodeConverter),t.text!==null&&t.text!==void 0?e.text=t.text:t.key!==null&&t.key!==void 0&&(e.key=t.key),t.color!==void 0&&(o=t.color,o instanceof ae||(o=new ae(o[0],o[1],o[2])),e.color=o),t.opacity!==void 0&&(e.opacity=t.opacity),t.spacing!==void 0&&(e.spacing=t.spacing),t.fontSize!==void 0&&(e.fontSize=t.fontSize,t.lineHeight||(e.lineHeight=t.fontSize)),t.lineHeight!==void 0&&(e.lineHeight=t.lineHeight),t.maxLines!==void 0&&(e.maxLines=t.maxLines),t.wrapLines!==void 0&&(e.wrapLines=t.wrapLines),t.minFontSize!==void 0&&(e.minFontSize=t.minFontSize),t.maxFontSize!==void 0&&(e.maxFontSize=t.maxFontSize),t.autoFitWidth&&(e.autoFitWidth=t.autoFitWidth),t.autoFitHeight&&(e.autoFitHeight=t.autoFitHeight),t.fontAsset!==void 0&&(e.fontAsset=t.fontAsset),t.font!==void 0&&(e.font=t.font),t.alignment!==void 0&&(e.alignment=t.alignment),t.outlineColor!==void 0&&(e.outlineColor=t.outlineColor),t.outlineThickness!==void 0&&(e.outlineThickness=t.outlineThickness),t.shadowColor!==void 0&&(e.shadowColor=t.shadowColor),t.shadowOffset!==void 0&&(e.shadowOffset=t.shadowOffset),t.enableMarkup!==void 0&&(e.enableMarkup=t.enableMarkup));const c=e._parseUpToScreen();c.screen&&e._updateScreen(c.screen),super.initializeComponentData(e,t,i),e._beingInitialized=!1,e.type===qM&&e._image._meshDirty&&e._image._updateMesh(e._image.mesh)}onAddComponent(e,t){e.fire("element:add")}onRemoveComponent(e,t){t.onRemove()}cloneComponent(e,t){const i=e.element,s={enabled:i.enabled,width:i.width,height:i.height,anchor:i.anchor.clone(),pivot:i.pivot.clone(),margin:i.margin.clone(),alignment:i.alignment&&i.alignment.clone()||i.alignment,autoWidth:i.autoWidth,autoHeight:i.autoHeight,type:i.type,rect:i.rect&&i.rect.clone()||i.rect,rtlReorder:i.rtlReorder,unicodeConverter:i.unicodeConverter,materialAsset:i.materialAsset,material:i.material,color:i.color&&i.color.clone()||i.color,opacity:i.opacity,textureAsset:i.textureAsset,texture:i.texture,spriteAsset:i.spriteAsset,sprite:i.sprite,spriteFrame:i.spriteFrame,pixelsPerUnit:i.pixelsPerUnit,spacing:i.spacing,lineHeight:i.lineHeight,wrapLines:i.wrapLines,layers:i.layers,fontSize:i.fontSize,minFontSize:i.minFontSize,maxFontSize:i.maxFontSize,autoFitWidth:i.autoFitWidth,autoFitHeight:i.autoFitHeight,maxLines:i.maxLines,fontAsset:i.fontAsset,font:i.font,useInput:i.useInput,fitMode:i.fitMode,batchGroupId:i.batchGroupId,mask:i.mask,outlineColor:i.outlineColor&&i.outlineColor.clone()||i.outlineColor,outlineThickness:i.outlineThickness,shadowColor:i.shadowColor&&i.shadowColor.clone()||i.shadowColor,shadowOffset:i.shadowOffset&&i.shadowOffset.clone()||i.shadowOffset,enableMarkup:i.enableMarkup};return i.key!==void 0&&i.key!==null?s.key=i.key:s.text=i.text,this.addComponent(t,s)}getTextElementMaterial(e,t,i){const s=(e&&1)|(t&&2)|(i&&4);let n=this._defaultTextMaterials[s];if(n)return n;let a="TextMaterial";return n=new Ns,t?(n.msdfMap=this._defaultTexture,n.msdfTextAttribute=i,n.emissive.set(1,1,1)):(a=`Bitmap${a}`,n.emissive.set(1,1,1),n.emissiveMap=this._defaultTexture,n.opacityMap=this._defaultTexture,n.opacityMapChannel="a"),e&&(a=`ScreenSpace${a}`,n.depthTest=!1),n.name=`default${a}`,n.useLighting=!1,n.useTonemap=!1,n.useFog=!1,n.useSkybox=!1,n.diffuse.set(0,0,0),n.opacity=.5,n.blendType=fh,n.depthWrite=!1,n.emissiveVertexColor=!0,n.update(),this._defaultTextMaterials[s]=n,n}_createBaseImageMaterial(){const e=new Ns;return e.diffuse.set(0,0,0),e.emissive.set(1,1,1),e.emissiveMap=this._defaultTexture,e.opacityMap=this._defaultTexture,e.opacityMapChannel="a",e.useLighting=!1,e.useTonemap=!1,e.useFog=!1,e.useSkybox=!1,e.blendType=fh,e.depthWrite=!1,e}getImageElementMaterial(e,t,i,s){return e?t?i?(this.defaultScreenSpaceImageMask9SlicedMaterial||(this.defaultScreenSpaceImageMask9SlicedMaterial=this._createBaseImageMaterial(),this.defaultScreenSpaceImageMask9SlicedMaterial.name="defaultScreenSpaceImageMask9SlicedMaterial",this.defaultScreenSpaceImageMask9SlicedMaterial.nineSlicedMode=Li,this.defaultScreenSpaceImageMask9SlicedMaterial.depthTest=!1,this.defaultScreenSpaceImageMask9SlicedMaterial.alphaTest=1,this.defaultScreenSpaceImageMask9SlicedMaterial.redWrite=!1,this.defaultScreenSpaceImageMask9SlicedMaterial.greenWrite=!1,this.defaultScreenSpaceImageMask9SlicedMaterial.blueWrite=!1,this.defaultScreenSpaceImageMask9SlicedMaterial.alphaWrite=!1,this.defaultScreenSpaceImageMask9SlicedMaterial.update(),this.defaultImageMaterials.push(this.defaultScreenSpaceImageMask9SlicedMaterial)),this.defaultScreenSpaceImageMask9SlicedMaterial):s?(this.defaultScreenSpaceImageMask9TiledMaterial||(this.defaultScreenSpaceImageMask9TiledMaterial=this.defaultScreenSpaceImage9TiledMaterial.clone(),this.defaultScreenSpaceImageMask9TiledMaterial.name="defaultScreenSpaceImageMask9TiledMaterial",this.defaultScreenSpaceImageMask9TiledMaterial.nineSlicedMode=Oi,this.defaultScreenSpaceImageMask9TiledMaterial.depthTest=!1,this.defaultScreenSpaceImageMask9TiledMaterial.alphaTest=1,this.defaultScreenSpaceImageMask9TiledMaterial.redWrite=!1,this.defaultScreenSpaceImageMask9TiledMaterial.greenWrite=!1,this.defaultScreenSpaceImageMask9TiledMaterial.blueWrite=!1,this.defaultScreenSpaceImageMask9TiledMaterial.alphaWrite=!1,this.defaultScreenSpaceImageMask9TiledMaterial.update(),this.defaultImageMaterials.push(this.defaultScreenSpaceImageMask9TiledMaterial)),this.defaultScreenSpaceImageMask9TiledMaterial):(this.defaultScreenSpaceImageMaskMaterial||(this.defaultScreenSpaceImageMaskMaterial=this._createBaseImageMaterial(),this.defaultScreenSpaceImageMaskMaterial.name="defaultScreenSpaceImageMaskMaterial",this.defaultScreenSpaceImageMaskMaterial.depthTest=!1,this.defaultScreenSpaceImageMaskMaterial.alphaTest=1,this.defaultScreenSpaceImageMaskMaterial.redWrite=!1,this.defaultScreenSpaceImageMaskMaterial.greenWrite=!1,this.defaultScreenSpaceImageMaskMaterial.blueWrite=!1,this.defaultScreenSpaceImageMaskMaterial.alphaWrite=!1,this.defaultScreenSpaceImageMaskMaterial.update(),this.defaultImageMaterials.push(this.defaultScreenSpaceImageMaskMaterial)),this.defaultScreenSpaceImageMaskMaterial):i?(this.defaultScreenSpaceImage9SlicedMaterial||(this.defaultScreenSpaceImage9SlicedMaterial=this._createBaseImageMaterial(),this.defaultScreenSpaceImage9SlicedMaterial.name="defaultScreenSpaceImage9SlicedMaterial",this.defaultScreenSpaceImage9SlicedMaterial.nineSlicedMode=Li,this.defaultScreenSpaceImage9SlicedMaterial.depthTest=!1,this.defaultScreenSpaceImage9SlicedMaterial.update(),this.defaultImageMaterials.push(this.defaultScreenSpaceImage9SlicedMaterial)),this.defaultScreenSpaceImage9SlicedMaterial):s?(this.defaultScreenSpaceImage9TiledMaterial||(this.defaultScreenSpaceImage9TiledMaterial=this._createBaseImageMaterial(),this.defaultScreenSpaceImage9TiledMaterial.name="defaultScreenSpaceImage9TiledMaterial",this.defaultScreenSpaceImage9TiledMaterial.nineSlicedMode=Oi,this.defaultScreenSpaceImage9TiledMaterial.depthTest=!1,this.defaultScreenSpaceImage9TiledMaterial.update(),this.defaultImageMaterials.push(this.defaultScreenSpaceImage9TiledMaterial)),this.defaultScreenSpaceImage9TiledMaterial):(this.defaultScreenSpaceImageMaterial||(this.defaultScreenSpaceImageMaterial=this._createBaseImageMaterial(),this.defaultScreenSpaceImageMaterial.name="defaultScreenSpaceImageMaterial",this.defaultScreenSpaceImageMaterial.depthTest=!1,this.defaultScreenSpaceImageMaterial.update(),this.defaultImageMaterials.push(this.defaultScreenSpaceImageMaterial)),this.defaultScreenSpaceImageMaterial):t?i?(this.defaultImage9SlicedMaskMaterial||(this.defaultImage9SlicedMaskMaterial=this._createBaseImageMaterial(),this.defaultImage9SlicedMaskMaterial.name="defaultImage9SlicedMaskMaterial",this.defaultImage9SlicedMaskMaterial.nineSlicedMode=Li,this.defaultImage9SlicedMaskMaterial.alphaTest=1,this.defaultImage9SlicedMaskMaterial.redWrite=!1,this.defaultImage9SlicedMaskMaterial.greenWrite=!1,this.defaultImage9SlicedMaskMaterial.blueWrite=!1,this.defaultImage9SlicedMaskMaterial.alphaWrite=!1,this.defaultImage9SlicedMaskMaterial.update(),this.defaultImageMaterials.push(this.defaultImage9SlicedMaskMaterial)),this.defaultImage9SlicedMaskMaterial):s?(this.defaultImage9TiledMaskMaterial||(this.defaultImage9TiledMaskMaterial=this._createBaseImageMaterial(),this.defaultImage9TiledMaskMaterial.name="defaultImage9TiledMaskMaterial",this.defaultImage9TiledMaskMaterial.nineSlicedMode=Oi,this.defaultImage9TiledMaskMaterial.alphaTest=1,this.defaultImage9TiledMaskMaterial.redWrite=!1,this.defaultImage9TiledMaskMaterial.greenWrite=!1,this.defaultImage9TiledMaskMaterial.blueWrite=!1,this.defaultImage9TiledMaskMaterial.alphaWrite=!1,this.defaultImage9TiledMaskMaterial.update(),this.defaultImageMaterials.push(this.defaultImage9TiledMaskMaterial)),this.defaultImage9TiledMaskMaterial):(this.defaultImageMaskMaterial||(this.defaultImageMaskMaterial=this._createBaseImageMaterial(),this.defaultImageMaskMaterial.name="defaultImageMaskMaterial",this.defaultImageMaskMaterial.alphaTest=1,this.defaultImageMaskMaterial.redWrite=!1,this.defaultImageMaskMaterial.greenWrite=!1,this.defaultImageMaskMaterial.blueWrite=!1,this.defaultImageMaskMaterial.alphaWrite=!1,this.defaultImageMaskMaterial.update(),this.defaultImageMaterials.push(this.defaultImageMaskMaterial)),this.defaultImageMaskMaterial):i?(this.defaultImage9SlicedMaterial||(this.defaultImage9SlicedMaterial=this._createBaseImageMaterial(),this.defaultImage9SlicedMaterial.name="defaultImage9SlicedMaterial",this.defaultImage9SlicedMaterial.nineSlicedMode=Li,this.defaultImage9SlicedMaterial.update(),this.defaultImageMaterials.push(this.defaultImage9SlicedMaterial)),this.defaultImage9SlicedMaterial):s?(this.defaultImage9TiledMaterial||(this.defaultImage9TiledMaterial=this._createBaseImageMaterial(),this.defaultImage9TiledMaterial.name="defaultImage9TiledMaterial",this.defaultImage9TiledMaterial.nineSlicedMode=Oi,this.defaultImage9TiledMaterial.update(),this.defaultImageMaterials.push(this.defaultImage9TiledMaterial)),this.defaultImage9TiledMaterial):(this.defaultImageMaterial||(this.defaultImageMaterial=this._createBaseImageMaterial(),this.defaultImageMaterial.name="defaultImageMaterial",this.defaultImageMaterial.update(),this.defaultImageMaterials.push(this.defaultImageMaterial)),this.defaultImageMaterial)}registerUnicodeConverter(e){this._unicodeConverter=e}registerRtlReorder(e){this._rtlReorder=e}getUnicodeConverter(){return this._unicodeConverter}getRtlReorder(){return this._rtlReorder}}const md="free",gd="limited",_d="locked",AEe=["angularDampingX","angularDampingY","angularDampingZ","angularEquilibriumX","angularEquilibriumY","angularEquilibriumZ","angularLimitsX","angularLimitsY","angularLimitsZ","angularMotionX","angularMotionY","angularMotionZ","angularSpringX","angularSpringY","angularSpringZ","angularStiffnessX","angularStiffnessY","angularStiffnessZ","breakForce","enableCollision","enabled","entityA","entityB","linearDampingX","linearDampingY","linearDampingZ","linearEquilibriumX","linearEquilibriumY","linearEquilibriumZ","linearLimitsX","linearLimitsY","linearLimitsZ","linearMotionX","linearMotionY","linearMotionZ","linearSpringX","linearSpringY","linearSpringZ","linearStiffnessX","linearStiffnessY","linearStiffnessZ"];class $3 extends ke{constructor(e,t){super(e,t),this._constraint=null,this._entityA=null,this._entityB=null,this._breakForce=34e37,this._enableCollision=!0,this._linearMotionX=_d,this._linearLimitsX=new ee(0,0),this._linearSpringX=!1,this._linearStiffnessX=0,this._linearDampingX=1,this._linearEquilibriumX=0,this._linearMotionY=_d,this._linearLimitsY=new ee(0,0),this._linearSpringY=!1,this._linearStiffnessY=0,this._linearDampingY=1,this._linearEquilibriumY=0,this._linearMotionZ=_d,this._linearLimitsZ=new ee(0,0),this._linearSpringZ=!1,this._linearStiffnessZ=0,this._linearDampingZ=1,this._linearEquilibriumZ=0,this._angularMotionX=_d,this._angularLimitsX=new ee(0,0),this._angularSpringX=!1,this._angularStiffnessX=0,this._angularDampingX=1,this._angularEquilibriumX=0,this._angularMotionY=_d,this._angularLimitsY=new ee(0,0),this._angularSpringY=!1,this._angularStiffnessY=0,this._angularDampingY=1,this._angularEquilibriumY=0,this._angularMotionZ=_d,this._angularLimitsZ=new ee(0,0),this._angularSpringZ=!1,this._angularEquilibriumZ=0,this._angularDampingZ=1,this._angularStiffnessZ=0,this.on("set_enabled",this._onSetEnabled,this)}set entityA(e){this._destroyConstraint(),this._entityA=e,this._createConstraint()}get entityA(){return this._entityA}set entityB(e){this._destroyConstraint(),this._entityB=e,this._createConstraint()}get entityB(){return this._entityB}set breakForce(e){this._constraint&&this._breakForce!==e&&(this._constraint.setBreakingImpulseThreshold(e),this._breakForce=e)}get breakForce(){return this._breakForce}set enableCollision(e){this._destroyConstraint(),this._enableCollision=e,this._createConstraint()}get enableCollision(){return this._enableCollision}set angularLimitsX(e){this._angularLimitsX.equals(e)||(this._angularLimitsX.copy(e),this._updateAngularLimits())}get angularLimitsX(){return this._angularLimitsX}set angularMotionX(e){this._angularMotionX!==e&&(this._angularMotionX=e,this._updateAngularLimits())}get angularMotionX(){return this._angularMotionX}set angularLimitsY(e){this._angularLimitsY.equals(e)||(this._angularLimitsY.copy(e),this._updateAngularLimits())}get angularLimitsY(){return this._angularLimitsY}set angularMotionY(e){this._angularMotionY!==e&&(this._angularMotionY=e,this._updateAngularLimits())}get angularMotionY(){return this._angularMotionY}set angularLimitsZ(e){this._angularLimitsZ.equals(e)||(this._angularLimitsZ.copy(e),this._updateAngularLimits())}get angularLimitsZ(){return this._angularLimitsZ}set angularMotionZ(e){this._angularMotionZ!==e&&(this._angularMotionZ=e,this._updateAngularLimits())}get angularMotionZ(){return this._angularMotionZ}set linearLimitsX(e){this._linearLimitsX.equals(e)||(this._linearLimitsX.copy(e),this._updateLinearLimits())}get linearLimitsX(){return this._linearLimitsX}set linearMotionX(e){this._linearMotionX!==e&&(this._linearMotionX=e,this._updateLinearLimits())}get linearMotionX(){return this._linearMotionX}set linearLimitsY(e){this._linearLimitsY.equals(e)||(this._linearLimitsY.copy(e),this._updateLinearLimits())}get linearLimitsY(){return this._linearLimitsY}set linearMotionY(e){this._linearMotionY!==e&&(this._linearMotionY=e,this._updateLinearLimits())}get linearMotionY(){return this._linearMotionY}set linearLimitsZ(e){this._linearLimitsZ.equals(e)||(this._linearLimitsZ.copy(e),this._updateLinearLimits())}get linearLimitsZ(){return this._linearLimitsZ}set linearMotionZ(e){this._linearMotionZ!==e&&(this._linearMotionZ=e,this._updateLinearLimits())}get linearMotionZ(){return this._linearMotionZ}_convertTransform(e,t){const i=e.getTranslation(),s=new de;s.setFromMat4(e);const n=new Ammo.btVector3(i.x,i.y,i.z),a=new Ammo.btQuaternion(s.x,s.y,s.z,s.w);t.setOrigin(n),t.setRotation(a),Ammo.destroy(n),Ammo.destroy(a)}_updateAngularLimits(){const e=this._constraint;if(e){let t,i,s,n,a,o;this._angularMotionX===gd?(t=this._angularLimitsX.x*Q.DEG_TO_RAD,n=this._angularLimitsX.y*Q.DEG_TO_RAD):this._angularMotionX===md?(t=1,n=0):t=n=0,this._angularMotionY===gd?(i=this._angularLimitsY.x*Q.DEG_TO_RAD,a=this._angularLimitsY.y*Q.DEG_TO_RAD):this._angularMotionY===md?(i=1,a=0):i=a=0,this._angularMotionZ===gd?(s=this._angularLimitsZ.x*Q.DEG_TO_RAD,o=this._angularLimitsZ.y*Q.DEG_TO_RAD):this._angularMotionZ===md?(s=1,o=0):s=o=0;const l=new Ammo.btVector3(t,i,s);e.setAngularLowerLimit(l),l.setValue(n,a,o),e.setAngularUpperLimit(l),Ammo.destroy(l)}}_updateLinearLimits(){const e=this._constraint;if(e){let t,i,s,n,a,o;this._linearMotionX===gd?(t=this._linearLimitsX.x,n=this._linearLimitsX.y):this._linearMotionX===md?(t=1,n=0):t=n=0,this._linearMotionY===gd?(i=this._linearLimitsY.x,a=this._linearLimitsY.y):this._linearMotionY===md?(i=1,a=0):i=a=0,this._linearMotionZ===gd?(s=this._linearLimitsZ.x,o=this._linearLimitsZ.y):this._linearMotionZ===md?(s=1,o=0):s=o=0;const l=new Ammo.btVector3(t,i,s);e.setLinearLowerLimit(l),l.setValue(n,a,o),e.setLinearUpperLimit(l),Ammo.destroy(l)}}_createConstraint(){if(this._entityA&&this._entityA.rigidbody){this._destroyConstraint();const e=new se,t=this._entityA.rigidbody.body;t.activate();const i=this.entity.getWorldTransform(),n=this._entityA.getWorldTransform().clone().invert();e.mul2(n,i);const a=new Ammo.btTransform;if(this._convertTransform(e,a),this._entityB&&this._entityB.rigidbody){const u=this._entityB.rigidbody.body;u.activate();const d=this._entityB.getWorldTransform().clone().invert();e.mul2(d,i);const f=new Ammo.btTransform;this._convertTransform(e,f),this._constraint=new Ammo.btGeneric6DofSpringConstraint(t,u,a,f,!this._enableCollision),Ammo.destroy(f)}else this._constraint=new Ammo.btGeneric6DofSpringConstraint(t,a,!this._enableCollision);Ammo.destroy(a);const o=["X","Y","Z","X","Y","Z"];for(let u=0;u<6;u++){const h=u<3?"_linear":"_angular";this._constraint.enableSpring(u,this[`${h}Spring${o[u]}`]),this._constraint.setDamping(u,this[`${h}Damping${o[u]}`]),this._constraint.setEquilibriumPoint(u,this[`${h}Equilibrium${o[u]}`]),this._constraint.setStiffness(u,this[`${h}Stiffness${o[u]}`])}this._constraint.setBreakingImpulseThreshold(this._breakForce),this._updateLinearLimits(),this._updateAngularLimits(),this.system.app.systems.rigidbody.dynamicsWorld.addConstraint(this._constraint,!this._enableCollision)}}_destroyConstraint(){this._constraint&&(this.system.app.systems.rigidbody.dynamicsWorld.removeConstraint(this._constraint),Ammo.destroy(this._constraint),this._constraint=null)}initFromData(e){for(const t of AEe)e.hasOwnProperty(t)&&(e[t]instanceof ee?this[`_${t}`].copy(e[t]):this[`_${t}`]=e[t]);this._createConstraint()}onEnable(){this._createConstraint()}onDisable(){this._destroyConstraint()}_onSetEnabled(e,t,i){}_onBeforeRemove(){this.fire("remove")}}const CEe={Damping:"setDamping",Equilibrium:"setEquilibriumPoint",Spring:"enableSpring",Stiffness:"setStiffness"};["linear","angular"].forEach(r=>{["Damping","Equilibrium","Spring","Stiffness"].forEach(e=>{["X","Y","Z"].forEach(t=>{const i=r+e+t,s=`_${i}`;let n=r==="linear"?0:3;t==="Y"&&(n+=1),t==="Z"&&(n+=2),Object.defineProperty($3.prototype,i,{get:function(){return this[s]},set:function(a){this[s]!==a&&(this[s]=a,this._constraint[CEe[e]](n,a))}})})})});class PEe{constructor(){this.enabled=!0}}const s2=["enabled"];class IEe extends si{constructor(e){super(e),this.id="joint",this.app=e,this.ComponentType=$3,this.DataType=PEe,this.schema=s2}initializeComponentData(e,t,i){e.initFromData(t),super.initializeComponentData(e,t,s2)}}ke._buildAccessors($3.prototype,s2);class mY extends ke{set minWidth(e){e!==this._minWidth&&(this._minWidth=e,this.fire("resize"))}get minWidth(){return this._minWidth}set minHeight(e){e!==this._minHeight&&(this._minHeight=e,this.fire("resize"))}get minHeight(){return this._minHeight}set maxWidth(e){e!==this._maxWidth&&(this._maxWidth=e,this.fire("resize"))}get maxWidth(){return this._maxWidth}set maxHeight(e){e!==this._maxHeight&&(this._maxHeight=e,this.fire("resize"))}get maxHeight(){return this._maxHeight}set fitWidthProportion(e){e!==this._fitWidthProportion&&(this._fitWidthProportion=e,this.fire("resize"))}get fitWidthProportion(){return this._fitWidthProportion}set fitHeightProportion(e){e!==this._fitHeightProportion&&(this._fitHeightProportion=e,this.fire("resize"))}get fitHeightProportion(){return this._fitHeightProportion}set excludeFromLayout(e){e!==this._excludeFromLayout&&(this._excludeFromLayout=e,this.fire("resize"))}get excludeFromLayout(){return this._excludeFromLayout}constructor(...e){super(...e),this._minWidth=0,this._minHeight=0,this._maxWidth=null,this._maxHeight=null,this._fitWidthProportion=0,this._fitHeightProportion=0,this._excludeFromLayout=!1}}class MEe{constructor(){this.enabled=!0}}const gY=["enabled"];class REe extends si{constructor(e){super(e),this.id="layoutchild",this.ComponentType=mY,this.DataType=MEe,this.schema=gY}initializeComponentData(e,t,i){t.enabled!==void 0&&(e.enabled=t.enabled),t.minWidth!==void 0&&(e.minWidth=t.minWidth),t.minHeight!==void 0&&(e.minHeight=t.minHeight),t.maxWidth!==void 0&&(e.maxWidth=t.maxWidth),t.maxHeight!==void 0&&(e.maxHeight=t.maxHeight),t.fitWidthProportion!==void 0&&(e.fitWidthProportion=t.fitWidthProportion),t.fitHeightProportion!==void 0&&(e.fitHeightProportion=t.fitHeightProportion),t.excludeFromLayout!==void 0&&(e.excludeFromLayout=t.excludeFromLayout),super.initializeComponentData(e,t,i)}cloneComponent(e,t){const i=e.layoutchild;return this.addComponent(t,{enabled:i.enabled,minWidth:i.minWidth,minHeight:i.minHeight,maxWidth:i.maxWidth,maxHeight:i.maxHeight,fitWidthProportion:i.fitWidthProportion,fitHeightProportion:i.fitHeightProportion,excludeFromLayout:i.excludeFromLayout})}}ke._buildAccessors(mY.prototype,gY);const n2=0,DEe=1,qz=2,LEe=3,Db={};Db[Ue]={axis:"x",size:"width",calculatedSize:"calculatedWidth",minSize:"minWidth",maxSize:"maxWidth",fitting:"widthFitting",fittingProportion:"fitWidthProportion"};Db[xt]={axis:"y",size:"height",calculatedSize:"calculatedHeight",minSize:"minHeight",maxSize:"maxHeight",fitting:"heightFitting",fittingProportion:"fitHeightProportion"};const H3={};H3[Ue]=xt;H3[xt]=Ue;const OEe={minWidth:0,minHeight:0,maxWidth:Number.POSITIVE_INFINITY,maxHeight:Number.POSITIVE_INFINITY,width:null,height:null,fitWidthProportion:0,fitHeightProportion:0},us={NONE:"NONE",APPLY_STRETCHING:"APPLY_STRETCHING",APPLY_SHRINKING:"APPLY_SHRINKING"},hs=new ee;function _Y(r){let e;const t=Db[r],i=Db[H3[r]];function s(R,L){return-L[t.size]*R.pivot[t.axis]}function n(R,L){return-L[i.size]*R.pivot[i.axis]}function a(R,L){return L[t.size]*(1-R.pivot[t.axis])}function o(R,L){R=R.filter(l),e=L,hs.x=e.containerSize.x-e.padding.x-e.padding.z,hs.y=e.containerSize.y-e.padding.y-e.padding.w,c(R);const D=h(u(R)),F=f(D,d(D)),j=y(D,F);return x(D,F,j),S(D,F,j),w(D)}function l(R){const L=R.entity.layoutchild;return!L||!L.enabled||!L.excludeFromLayout}function c(R){for(let L=0;L<R.length;++L){const D=R[L],F=D.anchor;(F.x!==0||F.y!==0||F.z!==0||F.w!==0)&&(D.anchor=ce.ZERO)}}function u(R){if(!e.wrap)return[R];const L=[[]],D=T(R);let F=0;const j=e[t.fitting]===qz;for(let z=0;z<R.length;++z){L[L.length-1].length>0&&(F+=e.spacing[t.axis]);const $=D[z][t.size];F+=$,!j&&F>hs[t.axis]&&L[L.length-1].length!==0&&(F=$,L.push([])),L[L.length-1].push(R[z]),j&&F>hs[t.axis]&&z!==R.length-1&&(F=0,L.push([]))}return L}function h(R){const L=e.orientation===Ue&&e.reverseX||e.orientation===xt&&e.reverseY,D=e.orientation===Ue&&e.reverseY||e.orientation===xt&&e.reverseX;if(L)for(let F=0;F<R.length;++F)L&&R[F].reverse();return D&&R.reverse(),R}function d(R){const L=[];for(let D=0;D<R.length;++D){const F=R[D],j=T(F),z=m(j,t),$=p(e[t.fitting],z,hs[t.axis]);$===us.APPLY_STRETCHING?g(j,z,t):$===us.APPLY_SHRINKING&&_(j,z,t),L.push(j)}return L}function f(R,L){const D=[],F=[];for(let $=0;$<R.length;++$){const H=R[$];H.largestElement=null,H.largestSize={width:Number.NEGATIVE_INFINITY,height:Number.NEGATIVE_INFINITY};for(let G=0;G<H.length;++G){const Y=L[$][G];Y[i.size]>H.largestSize[i.size]&&(H.largestElement=H[G],H.largestSize=Y)}D.push(H.largestElement),F.push(H.largestSize)}const j=m(F,i),z=p(e[i.fitting],j,hs[i.axis]);z===us.APPLY_STRETCHING?g(F,j,i):z===us.APPLY_SHRINKING&&_(F,j,i);for(let $=0;$<R.length;++$){const H=R[$];for(let G=0;G<H.length;++G){const Y=L[$][G],W=Y[i.size],ie=R.length===1?hs[i.axis]:H.largestSize[i.size],q=p(e[i.fitting],W,ie);q===us.APPLY_STRETCHING?Y[i.size]=Math.min(ie,Y[i.maxSize]):q===us.APPLY_SHRINKING&&(Y[i.size]=Math.max(ie,Y[i.minSize]))}}return L}function p(R,L,D){switch(R){case n2:return us.NONE;case DEe:return L<D?us.APPLY_STRETCHING:us.NONE;case qz:return L>=D?us.APPLY_SHRINKING:us.NONE;case LEe:return L<D?us.APPLY_STRETCHING:us.APPLY_SHRINKING;default:throw new Error(`Unrecognized fitting mode: ${R}`)}}function m(R,L){const D=P(R,L.size),F=(R.length-1)*e.spacing[L.axis];return D+F}function g(R,L,D){const F=N(R,D.maxSize),j=I(R,D.fittingProportion),z=B(j,F);let $=hs[D.axis]-L;for(let H=0;H<R.length;++H){const G=F[H],Y=v(G,$,j,z),W=R[G][D.size]+Y,ie=R[G][D.maxSize],q=Math.min(W,ie);R[G][D.size]=q;const K=Math.max(W-q,0),te=Y-K;$-=te}}function _(R,L,D){const F=N(R,D.minSize,!0),j=I(R,D.fittingProportion),z=M(j),$=B(z,F);let H=L-hs[D.axis];for(let G=0;G<R.length;++G){const Y=F[G],W=v(Y,H,z,$),ie=R[Y][D.size]-W,q=R[Y][D.minSize],K=Math.max(ie,q);R[Y][D.size]=K;const te=Math.max(K-ie,0),X=W-te;H-=X}}function v(R,L,D,F){const j=D[R],z=F[R];return Math.abs(j)<1e-5&&Math.abs(z)<1e-5?L:L*j/z}function y(R,L){const D={};D[t.axis]=0,D[i.axis]=0,R[t.size]=Number.NEGATIVE_INFINITY;const F=[];for(let j=0;j<R.length;++j){const z=R[j];if(z.length===0){F.push([]);continue}const $=[],H=L[j];for(let G=0;G<z.length;++G){const Y=z[G],W=H[G];D[i.axis]-=n(Y,W),D[t.axis]-=s(Y,W),$[G]={},$[G][t.axis]=D[t.axis],$[G][i.axis]=D[i.axis],D[i.axis]+=n(Y,W),D[t.axis]+=a(Y,W)+e.spacing[t.axis]}z[t.size]=D[t.axis]-e.spacing[t.axis],z[i.size]=z.largestSize[i.size],R[t.size]=Math.max(R[t.size],z[t.size]),D[t.axis]=0,D[i.axis]+=z[i.size]+e.spacing[i.axis],F.push($)}return R[i.size]=D[i.axis]-e.spacing[i.axis],F}function x(R,L,D){const F=e.alignment[t.axis],j=e.alignment[i.axis],z=e.padding[t.axis],$=e.padding[i.axis];for(let H=0;H<R.length;++H){const G=R[H],Y=L[H],W=D[H],ie=(hs[t.axis]-G[t.size])*F+z,q=(hs[i.axis]-R[i.size])*j+$;for(let K=0;K<G.length;++K){const te=(G[i.size]-Y[K][i.size])*e.alignment[i.axis];W[K][t.axis]+=ie,W[K][i.axis]+=q+te}}}function S(R,L,D){for(let F=0;F<R.length;++F){const j=R[F],z=L[F],$=D[F];for(let H=0;H<j.length;++H){const G=j[H];G[t.calculatedSize]=z[H][t.size],G[i.calculatedSize]=z[H][i.size],e.orientation===Ue?G.entity.setLocalPosition($[H][t.axis],$[H][i.axis],G.entity.getLocalPosition().z):G.entity.setLocalPosition($[H][i.axis],$[H][t.axis],G.entity.getLocalPosition().z)}}}function w(R){const L=R.width,D=R.height,F=(hs.x-L)*e.alignment.x+e.padding.x,j=(hs.y-D)*e.alignment.y+e.padding.y;return{bounds:new ce(F,j,L,D)}}function T(R){const L=[];for(let D=0;D<R.length;++D){const F=R[D],j=Math.max(A(F,"minWidth"),0),z=Math.max(A(F,"minHeight"),0),$=Math.max(A(F,"maxWidth"),j),H=Math.max(A(F,"maxHeight"),z),G=C(A(F,"width"),j,$),Y=C(A(F,"height"),z,H),W=A(F,"fitWidthProportion"),ie=A(F,"fitHeightProportion");L.push({minWidth:j,minHeight:z,maxWidth:$,maxHeight:H,width:G,height:Y,fitWidthProportion:W,fitHeightProportion:ie})}return L}function A(R,L){const D=R.entity.layoutchild;return D&&D.enabled&&D[L]!==void 0&&D[L]!==null?D[L]:R[L]!==void 0?R[L]:OEe[L]}function C(R,L,D){return Math.min(Math.max(R,L),D)}function P(R,L){return R.reduce((D,F)=>D+F[L],0)}function I(R,L){const D=P(R,L),F=[],j=R.length;if(D===0)for(let z=0;z<j;++z)F.push(1/j);else for(let z=0;z<j;++z)F.push(R[z][L]/D);return F}function M(R){if(R.length===1)return[1];const L=[],D=R.length;for(let F=0;F<D;++F)L.push((1-R[F])/(D-1));return L}function N(R,L,D){return R.forEach(k),R.slice().sort((F,j)=>D?j[L]-F[L]:F[L]-j[L]).map(V)}function k(R,L){R.index=L}function V(R){return R.index}function B(R,L){const D=[];D[L[R.length-1]]=R[L[R.length-1]];for(let F=R.length-2;F>=0;--F)D[L[F]]=D[L[F+1]]+R[L[F]];return D}return o}const G3={};G3[Ue]=_Y(Ue);G3[xt]=_Y(xt);class NEe{calculateLayout(e,t){const i=G3[t.orientation];if(i)return i(e,t);throw new Error(`Unrecognized orientation value: ${t.orientation}`)}}function Yz(r){return r.element}function kEe(r){return r.enabled&&r.element&&r.element.enabled}class vY extends ke{constructor(e,t){super(e,t),this._orientation=Ue,this._reverseX=!1,this._reverseY=!0,this._alignment=new ee(0,1),this._padding=new ce,this._spacing=new ee,this._widthFitting=n2,this._heightFitting=n2,this._wrap=!1,this._layoutCalculator=new NEe,this._listenForReflowEvents(this.entity,"on"),this.entity.children.forEach(i=>{this._listenForReflowEvents(i,"on")}),this.entity.on("childinsert",this._onChildInsert,this),this.entity.on("childremove",this._onChildRemove,this),e.app.systems.element.on("add",this._onElementOrLayoutComponentAdd,this),e.app.systems.element.on("beforeremove",this._onElementOrLayoutComponentRemove,this),e.app.systems.layoutchild.on("add",this._onElementOrLayoutComponentAdd,this),e.app.systems.layoutchild.on("beforeremove",this._onElementOrLayoutComponentRemove,this)}set orientation(e){e!==this._orientation&&(this._orientation=e,this._scheduleReflow())}get orientation(){return this._orientation}set reverseX(e){e!==this._reverseX&&(this._reverseX=e,this._scheduleReflow())}get reverseX(){return this._reverseX}set reverseY(e){e!==this._reverseY&&(this._reverseY=e,this._scheduleReflow())}get reverseY(){return this._reverseY}set alignment(e){e.equals(this._alignment)||(this._alignment.copy(e),this._scheduleReflow())}get alignment(){return this._alignment}set padding(e){e.equals(this._padding)||(this._padding.copy(e),this._scheduleReflow())}get padding(){return this._padding}set spacing(e){e.equals(this._spacing)||(this._spacing.copy(e),this._scheduleReflow())}get spacing(){return this._spacing}set widthFitting(e){e!==this._widthFitting&&(this._widthFitting=e,this._scheduleReflow())}get widthFitting(){return this._widthFitting}set heightFitting(e){e!==this._heightFitting&&(this._heightFitting=e,this._scheduleReflow())}get heightFitting(){return this._heightFitting}set wrap(e){e!==this._wrap&&(this._wrap=e,this._scheduleReflow())}get wrap(){return this._wrap}_isSelfOrChild(e){return e===this.entity||this.entity.children.indexOf(e)!==-1}_listenForReflowEvents(e,t){e.element&&(e.element[t]("enableelement",this._scheduleReflow,this),e.element[t]("disableelement",this._scheduleReflow,this),e.element[t]("resize",this._scheduleReflow,this),e.element[t]("set:pivot",this._scheduleReflow,this)),e.layoutchild&&(e.layoutchild[t]("set_enabled",this._scheduleReflow,this),e.layoutchild[t]("resize",this._scheduleReflow,this))}_onElementOrLayoutComponentAdd(e){this._isSelfOrChild(e)&&(this._listenForReflowEvents(e,"on"),this._scheduleReflow())}_onElementOrLayoutComponentRemove(e){this._isSelfOrChild(e)&&(this._listenForReflowEvents(e,"off"),this._scheduleReflow())}_onChildInsert(e){this._listenForReflowEvents(e,"on"),this._scheduleReflow()}_onChildRemove(e){this._listenForReflowEvents(e,"off"),this._scheduleReflow()}_scheduleReflow(){this.enabled&&this.entity&&this.entity.enabled&&!this._isPerformingReflow&&this.system.scheduleReflow(this)}reflow(){const e=Yz(this.entity),t=this.entity.children.filter(kEe).map(Yz);if(!e||t.length===0)return;const i=Math.max(e.calculatedWidth,0),s=Math.max(e.calculatedHeight,0),n={orientation:this._orientation,reverseX:this._reverseX,reverseY:this._reverseY,alignment:this._alignment,padding:this._padding,spacing:this._spacing,widthFitting:this._widthFitting,heightFitting:this._heightFitting,wrap:this._wrap,containerSize:new ee(i,s)};this._isPerformingReflow=!0;const a=this._layoutCalculator.calculateLayout(t,n);this._isPerformingReflow=!1,this.fire("reflow",a)}onEnable(){this._scheduleReflow()}onRemove(){this.entity.off("childinsert",this._onChildInsert,this),this.entity.off("childremove",this._onChildRemove,this),this._listenForReflowEvents(this.entity,"off"),this.entity.children.forEach(e=>{this._listenForReflowEvents(e,"off")}),this.system.app.systems.element.off("add",this._onElementOrLayoutComponentAdd,this),this.system.app.systems.element.off("beforeremove",this._onElementOrLayoutComponentRemove,this),this.system.app.systems.layoutchild.off("add",this._onElementOrLayoutComponentAdd,this),this.system.app.systems.layoutchild.off("beforeremove",this._onElementOrLayoutComponentRemove,this)}}class FEe{constructor(){this.enabled=!0}}const yY=["enabled"],BEe=100;class UEe extends si{constructor(e){super(e),this.id="layoutgroup",this.ComponentType=vY,this.DataType=FEe,this.schema=yY,this._reflowQueue=[],this.on("beforeremove",this._onRemoveComponent,this),this.app.systems.on("postUpdate",this._onPostUpdate,this)}initializeComponentData(e,t,i){t.enabled!==void 0&&(e.enabled=t.enabled),t.orientation!==void 0&&(e.orientation=t.orientation),t.reverseX!==void 0&&(e.reverseX=t.reverseX),t.reverseY!==void 0&&(e.reverseY=t.reverseY),t.alignment!==void 0&&(e.alignment=Array.isArray(t.alignment)?new ee(t.alignment):t.alignment),t.padding!==void 0&&(e.padding=Array.isArray(t.padding)?new ce(t.padding):t.padding),t.spacing!==void 0&&(e.spacing=Array.isArray(t.spacing)?new ee(t.spacing):t.spacing),t.widthFitting!==void 0&&(e.widthFitting=t.widthFitting),t.heightFitting!==void 0&&(e.heightFitting=t.heightFitting),t.wrap!==void 0&&(e.wrap=t.wrap),super.initializeComponentData(e,t,i)}cloneComponent(e,t){const i=e.layoutgroup;return this.addComponent(t,{enabled:i.enabled,orientation:i.orientation,reverseX:i.reverseX,reverseY:i.reverseY,alignment:i.alignment,padding:i.padding,spacing:i.spacing,widthFitting:i.widthFitting,heightFitting:i.heightFitting,wrap:i.wrap})}scheduleReflow(e){this._reflowQueue.indexOf(e)===-1&&this._reflowQueue.push(e)}_onPostUpdate(){this._processReflowQueue()}_processReflowQueue(){if(this._reflowQueue.length===0)return;let e=0;for(;this._reflowQueue.length>0;){const t=this._reflowQueue.slice();this._reflowQueue.length=0,t.sort((i,s)=>i.entity.graphDepth-s.entity.graphDepth);for(let i=0;i<t.length;++i)t[i].reflow();if(++e>=BEe){console.warn("Max reflow iterations limit reached, bailing.");break}}}_onRemoveComponent(e,t){t.onRemove()}destroy(){super.destroy(),this.app.systems.off("postUpdate",this._onPostUpdate,this)}}ke._buildAccessors(vY.prototype,yY);class zEe{destroy(e){this.map.forEach(t=>t.mesh.destroy())}constructor(){this.map=new Map}}const VEe=new jr,SY=(r,e)=>{const t=VEe.get(r,()=>new zEe);let i=t.map.get(e);if(!i){let s,n;switch(e){case"box":s=It.fromGeometry(r,new LM),n={x:2,y:2,z:2,uv:2/3};break;case"capsule":s=It.fromGeometry(r,new K_e({radius:.5,height:2})),n={x:Math.PI*2,y:Math.PI,z:Math.PI*2,uv:1/3+1/3/3*2};break;case"cone":s=It.fromGeometry(r,new Z_e({baseRadius:.5,peakRadius:0,height:1})),n={x:2.54,y:2.54,z:2.54,uv:1/3+1/3/3};break;case"cylinder":s=It.fromGeometry(r,new Q_e({radius:.5,height:1})),n={x:Math.PI,y:.79*2,z:Math.PI,uv:1/3+1/3/3*2};break;case"plane":s=It.fromGeometry(r,new J_e({halfExtents:new ee(.5,.5),widthSegments:1,lengthSegments:1})),n={x:0,y:1,z:0,uv:1};break;case"sphere":s=It.fromGeometry(r,new z9({radius:.5})),n={x:Math.PI,y:Math.PI,z:Math.PI,uv:1};break;case"torus":s=It.fromGeometry(r,new eve({tubeRadius:.2,ringRadius:.3})),n={x:Math.PI*.5*.5-Math.PI*.1*.1,y:.4,z:.4,uv:1};break;default:throw new Error(`Invalid primitive type: ${e}`)}s.incRefCount(),i={mesh:s,area:n},t.map.set(e,i)}return i};class xY extends ke{constructor(e,t){super(e,t),this._type="asset",this._asset=null,this._model=null,this._mapping={},this._castShadows=!0,this._receiveShadows=!0,this._materialAsset=null,this._castShadowsLightmap=!0,this._lightmapped=!1,this._lightmapSizeMultiplier=1,this.isStatic=!1,this._layers=[nl],this._batchGroupId=-1,this._customAabb=null,this._area=null,this._materialEvents=null,this._clonedModel=!1,this._evtLayersChanged=null,this._evtLayerAdded=null,this._evtLayerRemoved=null,this._material=e.defaultMaterial,t.on("remove",this.onRemoveChild,this),t.on("removehierarchy",this.onRemoveChild,this),t.on("insert",this.onInsertChild,this),t.on("inserthierarchy",this.onInsertChild,this)}set meshInstances(e){this._model&&(this._model.meshInstances=e)}get meshInstances(){return this._model?this._model.meshInstances:null}set customAabb(e){if(this._customAabb=e,this._model){const t=this._model.meshInstances;if(t)for(let i=0;i<t.length;i++)t[i].setCustomAabb(this._customAabb)}}get customAabb(){return this._customAabb}set type(e){if(this._type!==e)if(this._area=null,this._type=e,e==="asset")this._asset!==null?this._bindModelAsset(this._asset):this.model=null;else{const t=SY(this.system.app.graphicsDevice,e);this._area=t.area;const i=t.mesh,s=new Xt,n=new al;n.graph=s,n.meshInstances=[new Dt(i,this._material,s)],this.model=n,this._asset=null}}get type(){return this._type}set asset(e){const t=this.system.app.assets;let i=e;if(e instanceof be&&(i=e.id),this._asset!==i){if(this._asset){t.off(`add:${this._asset}`,this._onModelAssetAdded,this);const s=t.get(this._asset);s&&this._unbindModelAsset(s)}if(this._asset=i,this._asset){const s=t.get(this._asset);s?this._bindModelAsset(s):(this.model=null,t.on(`add:${this._asset}`,this._onModelAssetAdded,this))}else this.model=null}}get asset(){return this._asset}set model(e){if(this._model!==e&&!(e&&e._immutable)&&(this._model&&(this._model._immutable=!1,this.removeModelFromLayers(),this._model.getGraph().destroy(),delete this._model._entity,this._clonedModel&&(this._model.destroy(),this._clonedModel=!1)),this._model=e,this._model)){this._model._immutable=!0;const t=this._model.meshInstances;for(let i=0;i<t.length;i++)t[i].castShadow=this._castShadows,t[i].receiveShadow=this._receiveShadows,t[i].setCustomAabb(this._customAabb);this.lightmapped=this._lightmapped,this.entity.addChild(this._model.graph),this.enabled&&this.entity.enabled&&this.addModelToLayers(),this._model._entity=this.entity,this.entity.animation&&this.entity.animation.setModel(this._model),this.entity.anim&&this.entity.anim.rebind(),this.type==="asset"?this.mapping=this._mapping:this._unsetMaterialEvents()}}get model(){return this._model}set lightmapped(e){if(e!==this._lightmapped&&(this._lightmapped=e,this._model)){const t=this._model.meshInstances;for(let i=0;i<t.length;i++)t[i].setLightmapped(e)}}get lightmapped(){return this._lightmapped}set castShadows(e){if(this._castShadows===e)return;const t=this._model;if(t){const i=this.layers,s=this.system.app.scene;if(this._castShadows&&!e)for(let a=0;a<i.length;a++){const o=this.system.app.scene.layers.getLayerById(this.layers[a]);o&&o.removeShadowCasters(t.meshInstances)}const n=t.meshInstances;for(let a=0;a<n.length;a++)n[a].castShadow=e;if(!this._castShadows&&e)for(let a=0;a<i.length;a++){const o=s.layers.getLayerById(i[a]);o&&o.addShadowCasters(t.meshInstances)}}this._castShadows=e}get castShadows(){return this._castShadows}set receiveShadows(e){if(this._receiveShadows!==e&&(this._receiveShadows=e,this._model)){const t=this._model.meshInstances;for(let i=0,s=t.length;i<s;i++)t[i].receiveShadow=e}}get receiveShadows(){return this._receiveShadows}set castShadowsLightmap(e){this._castShadowsLightmap=e}get castShadowsLightmap(){return this._castShadowsLightmap}set lightmapSizeMultiplier(e){this._lightmapSizeMultiplier=e}get lightmapSizeMultiplier(){return this._lightmapSizeMultiplier}set layers(e){const t=this.system.app.scene.layers;if(this.meshInstances)for(let i=0;i<this._layers.length;i++){const s=t.getLayerById(this._layers[i]);s&&s.removeMeshInstances(this.meshInstances)}this._layers.length=0;for(let i=0;i<e.length;i++)this._layers[i]=e[i];if(!(!this.enabled||!this.entity.enabled||!this.meshInstances))for(let i=0;i<this._layers.length;i++){const s=t.getLayerById(this._layers[i]);s&&s.addMeshInstances(this.meshInstances)}}get layers(){return this._layers}set batchGroupId(e){var t,i;this._batchGroupId!==e&&(this.entity.enabled&&this._batchGroupId>=0&&((t=this.system.app.batcher)==null||t.remove(Bi.MODEL,this.batchGroupId,this.entity)),this.entity.enabled&&e>=0&&((i=this.system.app.batcher)==null||i.insert(Bi.MODEL,e,this.entity)),e<0&&this._batchGroupId>=0&&this.enabled&&this.entity.enabled&&this.addModelToLayers(),this._batchGroupId=e)}get batchGroupId(){return this._batchGroupId}set materialAsset(e){let t=e;e instanceof be&&(t=e.id);const i=this.system.app.assets;if(t!==this._materialAsset){if(this._materialAsset){i.off(`add:${this._materialAsset}`,this._onMaterialAssetAdd,this);const s=i.get(this._materialAsset);s&&this._unbindMaterialAsset(s)}if(this._materialAsset=t,this._materialAsset){const s=i.get(this._materialAsset);s?this._bindMaterialAsset(s):(this._setMaterial(this.system.defaultMaterial),i.on(`add:${this._materialAsset}`,this._onMaterialAssetAdd,this))}else this._setMaterial(this.system.defaultMaterial)}}get materialAsset(){return this._materialAsset}set material(e){this._material!==e&&(this.materialAsset=null,this._setMaterial(e))}get material(){return this._material}set mapping(e){if(this._type!=="asset"||(this._unsetMaterialEvents(),e||(e={}),this._mapping=e,!this._model))return;const t=this._model.meshInstances,i=this.asset?this.system.app.assets.get(this.asset):null,s=i?i.data.mapping:null;let n=null;for(let a=0,o=t.length;a<o;a++)if(e[a]!==void 0)e[a]?(n=this.system.app.assets.get(e[a]),this._loadAndSetMeshInstanceMaterial(n,t[a],a)):t[a].material=this.system.defaultMaterial;else if(s)if(s[a]&&(s[a].material||s[a].path)){if(s[a].material!==void 0)n=this.system.app.assets.get(s[a].material);else if(s[a].path!==void 0){const l=this._getMaterialAssetUrl(s[a].path);l&&(n=this.system.app.assets.getByUrl(l))}this._loadAndSetMeshInstanceMaterial(n,t[a],a)}else t[a].material=this.system.defaultMaterial}get mapping(){return this._mapping}addModelToLayers(){const e=this.system.app.scene.layers;for(let t=0;t<this._layers.length;t++){const i=e.getLayerById(this._layers[t]);i&&i.addMeshInstances(this.meshInstances)}}removeModelFromLayers(){const e=this.system.app.scene.layers;for(let t=0;t<this._layers.length;t++){const i=e.getLayerById(this._layers[t]);i&&i.removeMeshInstances(this.meshInstances)}}onRemoveChild(){this._model&&this.removeModelFromLayers()}onInsertChild(){this._model&&this.enabled&&this.entity.enabled&&this.addModelToLayers()}onRemove(){this.asset=null,this.model=null,this.materialAsset=null,this._unsetMaterialEvents(),this.entity.off("remove",this.onRemoveChild,this),this.entity.off("insert",this.onInsertChild,this)}onLayersChanged(e,t){this.addModelToLayers(),e.off("add",this.onLayerAdded,this),e.off("remove",this.onLayerRemoved,this),t.on("add",this.onLayerAdded,this),t.on("remove",this.onLayerRemoved,this)}onLayerAdded(e){this.layers.indexOf(e.id)<0||e.addMeshInstances(this.meshInstances)}onLayerRemoved(e){this.layers.indexOf(e.id)<0||e.removeMeshInstances(this.meshInstances)}_setMaterialEvent(e,t,i,s){const n=`${t}:${i}`;this.system.app.assets.on(n,s,this),this._materialEvents||(this._materialEvents=[]),this._materialEvents[e]||(this._materialEvents[e]={}),this._materialEvents[e][n]={id:i,handler:s}}_unsetMaterialEvents(){const e=this.system.app.assets,t=this._materialEvents;if(t){for(let i=0,s=t.length;i<s;i++){if(!t[i])continue;const n=t[i];for(const a in n)e.off(a,n[a].handler,this)}this._materialEvents=null}}_getAssetByIdOrPath(e){let t=null;if(!isNaN(parseInt(e,10)))t=this.system.app.assets.get(e);else if(this.asset){const s=this._getMaterialAssetUrl(e);s&&(t=this.system.app.assets.getByUrl(s))}return t}_getMaterialAssetUrl(e){if(!this.asset)return null;const t=this.system.app.assets.get(this.asset);return t?t.getAbsoluteUrl(e):null}_loadAndSetMeshInstanceMaterial(e,t,i){const s=this.system.app.assets;e&&(e.resource?(t.material=e.resource,this._setMaterialEvent(i,"remove",e.id,function(){t.material=this.system.defaultMaterial})):(this._setMaterialEvent(i,"load",e.id,function(n){t.material=n.resource,this._setMaterialEvent(i,"remove",e.id,function(){t.material=this.system.defaultMaterial})}),this.enabled&&this.entity.enabled&&s.load(e)))}onEnable(){var a;const e=this.system.app,t=e.scene,i=t==null?void 0:t.layers;this._evtLayersChanged=t.on("set:layers",this.onLayersChanged,this),i&&(this._evtLayerAdded=i.on("add",this.onLayerAdded,this),this._evtLayerRemoved=i.on("remove",this.onLayerRemoved,this));const s=this._type==="asset";let n;if(this._model?this.addModelToLayers():s&&this._asset&&(n=e.assets.get(this._asset),n&&n.resource!==this._model&&this._bindModelAsset(n)),this._materialAsset&&(n=e.assets.get(this._materialAsset),n&&n.resource!==this._material&&this._bindMaterialAsset(n)),s&&this._mapping)for(const o in this._mapping)this._mapping[o]&&(n=this._getAssetByIdOrPath(this._mapping[o]),n&&!n.resource&&e.assets.load(n));this._batchGroupId>=0&&((a=e.batcher)==null||a.insert(Bi.MODEL,this.batchGroupId,this.entity))}onDisable(){var s,n,a,o;const e=this.system.app,i=e.scene.layers;(s=this._evtLayersChanged)==null||s.off(),this._evtLayersChanged=null,i&&((n=this._evtLayerAdded)==null||n.off(),this._evtLayerAdded=null,(a=this._evtLayerRemoved)==null||a.off(),this._evtLayerRemoved=null),this._batchGroupId>=0&&((o=e.batcher)==null||o.remove(Bi.MODEL,this.batchGroupId,this.entity)),this._model&&this.removeModelFromLayers()}hide(){if(this._model){const e=this._model.meshInstances;for(let t=0,i=e.length;t<i;t++)e[t].visible=!1}}show(){if(this._model){const e=this._model.meshInstances;for(let t=0,i=e.length;t<i;t++)e[t].visible=!0}}_bindMaterialAsset(e){if(e.on("load",this._onMaterialAssetLoad,this),e.on("unload",this._onMaterialAssetUnload,this),e.on("remove",this._onMaterialAssetRemove,this),e.on("change",this._onMaterialAssetChange,this),e.resource)this._onMaterialAssetLoad(e);else{if(!this.enabled||!this.entity.enabled)return;this.system.app.assets.load(e)}}_unbindMaterialAsset(e){e.off("load",this._onMaterialAssetLoad,this),e.off("unload",this._onMaterialAssetUnload,this),e.off("remove",this._onMaterialAssetRemove,this),e.off("change",this._onMaterialAssetChange,this)}_onMaterialAssetAdd(e){this.system.app.assets.off(`add:${e.id}`,this._onMaterialAssetAdd,this),this._materialAsset===e.id&&this._bindMaterialAsset(e)}_onMaterialAssetLoad(e){this._setMaterial(e.resource)}_onMaterialAssetUnload(e){this._setMaterial(this.system.defaultMaterial)}_onMaterialAssetRemove(e){this._onMaterialAssetUnload(e)}_onMaterialAssetChange(e){}_bindModelAsset(e){if(this._unbindModelAsset(e),e.on("load",this._onModelAssetLoad,this),e.on("unload",this._onModelAssetUnload,this),e.on("change",this._onModelAssetChange,this),e.on("remove",this._onModelAssetRemove,this),e.resource)this._onModelAssetLoad(e);else{if(!this.enabled||!this.entity.enabled)return;this.system.app.assets.load(e)}}_unbindModelAsset(e){e.off("load",this._onModelAssetLoad,this),e.off("unload",this._onModelAssetUnload,this),e.off("change",this._onModelAssetChange,this),e.off("remove",this._onModelAssetRemove,this)}_onModelAssetAdded(e){this.system.app.assets.off(`add:${e.id}`,this._onModelAssetAdded,this),e.id===this._asset&&this._bindModelAsset(e)}_onModelAssetLoad(e){this.model=e.resource.clone(),this._clonedModel=!0}_onModelAssetUnload(e){this.model=null}_onModelAssetChange(e,t,i,s){t==="data"&&(this.mapping=this._mapping)}_onModelAssetRemove(e){this.model=null}_setMaterial(e){if(this._material===e)return;this._material=e;const t=this._model;if(t&&this._type!=="asset"){const i=t.meshInstances;for(let s=0,n=i.length;s<n;s++)i[s].material=e}}}class jEe{constructor(){this.enabled=!0}}const bY=["enabled"];class $Ee extends si{constructor(e){super(e),this.id="model",this.ComponentType=xY,this.DataType=jEe,this.schema=bY,this.defaultMaterial=Py(e.graphicsDevice),this.on("beforeremove",this.onRemove,this)}initializeComponentData(e,t,i){i=["material","materialAsset","asset","castShadows","receiveShadows","castShadowsLightmap","lightmapped","lightmapSizeMultiplier","type","mapping","layers","isStatic","batchGroupId"],(t.batchGroupId===null||t.batchGroupId===void 0)&&(t.batchGroupId=-1),t.layers&&t.layers.length&&(t.layers=t.layers.slice(0));for(let s=0;s<i.length;s++)t.hasOwnProperty(i[s])&&(e[i[s]]=t[i[s]]);t.aabbCenter&&t.aabbHalfExtents&&(e.customAabb=new We(new O(t.aabbCenter),new O(t.aabbHalfExtents))),super.initializeComponentData(e,t,["enabled"])}cloneComponent(e,t){const i={type:e.model.type,asset:e.model.asset,castShadows:e.model.castShadows,receiveShadows:e.model.receiveShadows,castShadowsLightmap:e.model.castShadowsLightmap,lightmapped:e.model.lightmapped,lightmapSizeMultiplier:e.model.lightmapSizeMultiplier,isStatic:e.model.isStatic,enabled:e.model.enabled,layers:e.model.layers,batchGroupId:e.model.batchGroupId,mapping:ib({},e.model.mapping)};let s=e.model.materialAsset;!(s instanceof be)&&s!=null&&(s=this.app.assets.get(s));const n=e.model.material;(!n||n===this.defaultMaterial||!s||n===s.resource)&&(i.materialAsset=s);const a=this.addComponent(t,i);if(e.model.model&&e.model.type==="asset"&&!e.model.asset&&(a.model=e.model.model.clone(),a._clonedModel=!0),i.materialAsset||(a.material=n),e.model.model){const o=e.model.model.meshInstances,l=a.model.meshInstances;for(let c=0;c<o.length;c++)l[c].mask=o[c].mask,l[c].material=o[c].material,l[c].layer=o[c].layer,l[c].receiveShadow=o[c].receiveShadow}return e.model.customAabb&&(a.customAabb=e.model.customAabb.clone()),a}onRemove(e,t){t.onRemove()}}ke._buildAccessors(xY.prototype,bY);const HEe=["emitterExtents","emitterRadius","emitterExtentsInner","emitterRadiusInner","loop","initialVelocity","animSpeed","normalMap","particleNormal"],GEe=["numParticles","lifetime","rate","rate2","startAngle","startAngle2","lighting","halfLambert","intensity","wrap","wrapBounds","depthWrite","noFog","sort","stretch","alignToMotion","preWarm","emitterShape","animTilesX","animTilesY","animStartFrame","animNumFrames","animNumAnimations","animIndex","randomizeAnimIndex","animLoop","colorMap","localSpace","screenSpace","orientation"],WEe=["scaleGraph","scaleGraph2","colorGraph","colorGraph2","alphaGraph","alphaGraph2","velocityGraph","velocityGraph2","localVelocityGraph","localVelocityGraph2","rotationSpeedGraph","rotationSpeedGraph2","radialSpeedGraph","radialSpeedGraph2"],lS=["colorMapAsset","normalMapAsset","meshAsset","renderAsset"];let vd;class XEe extends ke{constructor(e,t){super(e,t),this._requestedDepth=!1,this._drawOrder=0,this._evtLayersChanged=null,this._evtLayerAdded=null,this._evtLayerRemoved=null,this._evtSetMeshes=null,this.on("set_colorMapAsset",this.onSetColorMapAsset,this),this.on("set_normalMapAsset",this.onSetNormalMapAsset,this),this.on("set_meshAsset",this.onSetMeshAsset,this),this.on("set_mesh",this.onSetMesh,this),this.on("set_renderAsset",this.onSetRenderAsset,this),this.on("set_loop",this.onSetLoop,this),this.on("set_blendType",this.onSetBlendType,this),this.on("set_depthSoftening",this.onSetDepthSoftening,this),this.on("set_layers",this.onSetLayers,this),HEe.forEach(i=>{this.on(`set_${i}`,this.onSetSimpleProperty,this)}),GEe.forEach(i=>{this.on(`set_${i}`,this.onSetComplexProperty,this)}),WEe.forEach(i=>{this.on(`set_${i}`,this.onSetGraphProperty,this)})}get data(){const e=this.system.store[this.entity.getGuid()];return e?e.data:null}set enabled(e){this._setValue("enabled",e)}get enabled(){return this.data.enabled}set autoPlay(e){this._setValue("autoPlay",e)}get autoPlay(){return this.data.autoPlay}set numParticles(e){this._setValue("numParticles",e)}get numParticles(){return this.data.numParticles}set lifetime(e){this._setValue("lifetime",e)}get lifetime(){return this.data.lifetime}set rate(e){this._setValue("rate",e)}get rate(){return this.data.rate}set rate2(e){this._setValue("rate2",e)}get rate2(){return this.data.rate2}set startAngle(e){this._setValue("startAngle",e)}get startAngle(){return this.data.startAngle}set startAngle2(e){this._setValue("startAngle2",e)}get startAngle2(){return this.data.startAngle2}set loop(e){this._setValue("loop",e)}get loop(){return this.data.loop}set preWarm(e){this._setValue("preWarm",e)}get preWarm(){return this.data.preWarm}set lighting(e){this._setValue("lighting",e)}get lighting(){return this.data.lighting}set halfLambert(e){this._setValue("halfLambert",e)}get halfLambert(){return this.data.halfLambert}set intensity(e){this._setValue("intensity",e)}get intensity(){return this.data.intensity}set depthWrite(e){this._setValue("depthWrite",e)}get depthWrite(){return this.data.depthWrite}set noFog(e){this._setValue("noFog",e)}get noFog(){return this.data.noFog}set depthSoftening(e){this._setValue("depthSoftening",e)}get depthSoftening(){return this.data.depthSoftening}set sort(e){this._setValue("sort",e)}get sort(){return this.data.sort}set blendType(e){this._setValue("blendType",e)}get blendType(){return this.data.blendType}set stretch(e){this._setValue("stretch",e)}get stretch(){return this.data.stretch}set alignToMotion(e){this._setValue("alignToMotion",e)}get alignToMotion(){return this.data.alignToMotion}set emitterShape(e){this._setValue("emitterShape",e)}get emitterShape(){return this.data.emitterShape}set emitterExtents(e){this._setValue("emitterExtents",e)}get emitterExtents(){return this.data.emitterExtents}set emitterExtentsInner(e){this._setValue("emitterExtentsInner",e)}get emitterExtentsInner(){return this.data.emitterExtentsInner}set emitterRadius(e){this._setValue("emitterRadius",e)}get emitterRadius(){return this.data.emitterRadius}set emitterRadiusInner(e){this._setValue("emitterRadiusInner",e)}get emitterRadiusInner(){return this.data.emitterRadiusInner}set initialVelocity(e){this._setValue("initialVelocity",e)}get initialVelocity(){return this.data.initialVelocity}set wrap(e){this._setValue("wrap",e)}get wrap(){return this.data.wrap}set wrapBounds(e){this._setValue("wrapBounds",e)}get wrapBounds(){return this.data.wrapBounds}set localSpace(e){this._setValue("localSpace",e)}get localSpace(){return this.data.localSpace}set screenSpace(e){this._setValue("screenSpace",e)}get screenSpace(){return this.data.screenSpace}set colorMapAsset(e){this._setValue("colorMapAsset",e)}get colorMapAsset(){return this.data.colorMapAsset}set normalMapAsset(e){this._setValue("normalMapAsset",e)}get normalMapAsset(){return this.data.normalMapAsset}set mesh(e){this._setValue("mesh",e)}get mesh(){return this.data.mesh}set meshAsset(e){this._setValue("meshAsset",e)}get meshAsset(){return this.data.meshAsset}set renderAsset(e){this._setValue("renderAsset",e)}get renderAsset(){return this.data.renderAsset}set orientation(e){this._setValue("orientation",e)}get orientation(){return this.data.orientation}set particleNormal(e){this._setValue("particleNormal",e)}get particleNormal(){return this.data.particleNormal}set localVelocityGraph(e){this._setValue("localVelocityGraph",e)}get localVelocityGraph(){return this.data.localVelocityGraph}set localVelocityGraph2(e){this._setValue("localVelocityGraph2",e)}get localVelocityGraph2(){return this.data.localVelocityGraph2}set velocityGraph(e){this._setValue("velocityGraph",e)}get velocityGraph(){return this.data.velocityGraph}set velocityGraph2(e){this._setValue("velocityGraph2",e)}get velocityGraph2(){return this.data.velocityGraph2}set rotationSpeedGraph(e){this._setValue("rotationSpeedGraph",e)}get rotationSpeedGraph(){return this.data.rotationSpeedGraph}set rotationSpeedGraph2(e){this._setValue("rotationSpeedGraph2",e)}get rotationSpeedGraph2(){return this.data.rotationSpeedGraph2}set radialSpeedGraph(e){this._setValue("radialSpeedGraph",e)}get radialSpeedGraph(){return this.data.radialSpeedGraph}set radialSpeedGraph2(e){this._setValue("radialSpeedGraph2",e)}get radialSpeedGraph2(){return this.data.radialSpeedGraph2}set scaleGraph(e){this._setValue("scaleGraph",e)}get scaleGraph(){return this.data.scaleGraph}set scaleGraph2(e){this._setValue("scaleGraph2",e)}get scaleGraph2(){return this.data.scaleGraph2}set colorGraph(e){this._setValue("colorGraph",e)}get colorGraph(){return this.data.colorGraph}set colorGraph2(e){this._setValue("colorGraph2",e)}get colorGraph2(){return this.data.colorGraph2}set alphaGraph(e){this._setValue("alphaGraph",e)}get alphaGraph(){return this.data.alphaGraph}set alphaGraph2(e){this._setValue("alphaGraph2",e)}get alphaGraph2(){return this.data.alphaGraph2}set colorMap(e){this._setValue("colorMap",e)}get colorMap(){return this.data.colorMap}set normalMap(e){this._setValue("normalMap",e)}get normalMap(){return this.data.normalMap}set animTilesX(e){this._setValue("animTilesX",e)}get animTilesX(){return this.data.animTilesX}set animTilesY(e){this._setValue("animTilesY",e)}get animTilesY(){return this.data.animTilesY}set animStartFrame(e){this._setValue("animStartFrame",e)}get animStartFrame(){return this.data.animStartFrame}set animNumFrames(e){this._setValue("animNumFrames",e)}get animNumFrames(){return this.data.animNumFrames}set animNumAnimations(e){this._setValue("animNumAnimations",e)}get animNumAnimations(){return this.data.animNumAnimations}set animIndex(e){this._setValue("animIndex",e)}get animIndex(){return this.data.animIndex}set randomizeAnimIndex(e){this._setValue("randomizeAnimIndex",e)}get randomizeAnimIndex(){return this.data.randomizeAnimIndex}set animSpeed(e){this._setValue("animSpeed",e)}get animSpeed(){return this.data.animSpeed}set animLoop(e){this._setValue("animLoop",e)}get animLoop(){return this.data.animLoop}set layers(e){this._setValue("layers",e)}get layers(){return this.data.layers}set drawOrder(e){this._drawOrder=e,this.emitter&&(this.emitter.drawOrder=e)}get drawOrder(){return this._drawOrder}_setValue(e,t){const i=this.data,s=i[e];i[e]=t,this.fire("set",e,s,t)}addMeshInstanceToLayers(){if(this.emitter)for(let e=0;e<this.layers.length;e++){const t=this.system.app.scene.layers.getLayerById(this.layers[e]);t&&(t.addMeshInstances([this.emitter.meshInstance]),this.emitter._layer=t)}}removeMeshInstanceFromLayers(){if(this.emitter)for(let e=0;e<this.layers.length;e++){const t=this.system.app.scene.layers.getLayerById(this.layers[e]);t&&t.removeMeshInstances([this.emitter.meshInstance])}}onSetLayers(e,t,i){if(this.emitter){for(let s=0;s<t.length;s++){const n=this.system.app.scene.layers.getLayerById(t[s]);n&&n.removeMeshInstances([this.emitter.meshInstance])}if(!(!this.enabled||!this.entity.enabled))for(let s=0;s<i.length;s++){const n=this.system.app.scene.layers.getLayerById(i[s]);n&&n.addMeshInstances([this.emitter.meshInstance])}}}onLayersChanged(e,t){this.addMeshInstanceToLayers(),e.off("add",this.onLayerAdded,this),e.off("remove",this.onLayerRemoved,this),t.on("add",this.onLayerAdded,this),t.on("remove",this.onLayerRemoved,this)}onLayerAdded(e){!this.emitter||this.layers.indexOf(e.id)<0||e.addMeshInstances([this.emitter.meshInstance])}onLayerRemoved(e){!this.emitter||this.layers.indexOf(e.id)<0||e.removeMeshInstances([this.emitter.meshInstance])}_bindColorMapAsset(e){if(e.on("load",this._onColorMapAssetLoad,this),e.on("unload",this._onColorMapAssetUnload,this),e.on("remove",this._onColorMapAssetRemove,this),e.on("change",this._onColorMapAssetChange,this),e.resource)this._onColorMapAssetLoad(e);else{if(!this.enabled||!this.entity.enabled)return;this.system.app.assets.load(e)}}_unbindColorMapAsset(e){e.off("load",this._onColorMapAssetLoad,this),e.off("unload",this._onColorMapAssetUnload,this),e.off("remove",this._onColorMapAssetRemove,this),e.off("change",this._onColorMapAssetChange,this)}_onColorMapAssetLoad(e){this.colorMap=e.resource}_onColorMapAssetUnload(e){this.colorMap=null}_onColorMapAssetRemove(e){this._onColorMapAssetUnload(e)}_onColorMapAssetChange(e){}onSetColorMapAsset(e,t,i){const s=this.system.app.assets;if(t){const n=s.get(t);n&&this._unbindColorMapAsset(n)}if(i){i instanceof be&&(this.data.colorMapAsset=i.id,i=i.id);const n=s.get(i);n?this._bindColorMapAsset(n):s.once(`add:${i}`,a=>{this._bindColorMapAsset(a)})}else this.colorMap=null}_bindNormalMapAsset(e){if(e.on("load",this._onNormalMapAssetLoad,this),e.on("unload",this._onNormalMapAssetUnload,this),e.on("remove",this._onNormalMapAssetRemove,this),e.on("change",this._onNormalMapAssetChange,this),e.resource)this._onNormalMapAssetLoad(e);else{if(!this.enabled||!this.entity.enabled)return;this.system.app.assets.load(e)}}_unbindNormalMapAsset(e){e.off("load",this._onNormalMapAssetLoad,this),e.off("unload",this._onNormalMapAssetUnload,this),e.off("remove",this._onNormalMapAssetRemove,this),e.off("change",this._onNormalMapAssetChange,this)}_onNormalMapAssetLoad(e){this.normalMap=e.resource}_onNormalMapAssetUnload(e){this.normalMap=null}_onNormalMapAssetRemove(e){this._onNormalMapAssetUnload(e)}_onNormalMapAssetChange(e){}onSetNormalMapAsset(e,t,i){const s=this.system.app.assets;if(t){const n=s.get(t);n&&this._unbindNormalMapAsset(n)}if(i){i instanceof be&&(this.data.normalMapAsset=i.id,i=i.id);const n=s.get(i);n?this._bindNormalMapAsset(n):s.once(`add:${i}`,a=>{this._bindNormalMapAsset(a)})}else this.normalMap=null}_bindMeshAsset(e){if(e.on("load",this._onMeshAssetLoad,this),e.on("unload",this._onMeshAssetUnload,this),e.on("remove",this._onMeshAssetRemove,this),e.on("change",this._onMeshAssetChange,this),e.resource)this._onMeshAssetLoad(e);else{if(!this.enabled||!this.entity.enabled)return;this.system.app.assets.load(e)}}_unbindMeshAsset(e){e.off("load",this._onMeshAssetLoad,this),e.off("unload",this._onMeshAssetUnload,this),e.off("remove",this._onMeshAssetRemove,this),e.off("change",this._onMeshAssetChange,this)}_onMeshAssetLoad(e){this._onMeshChanged(e.resource)}_onMeshAssetUnload(e){this.mesh=null}_onMeshAssetRemove(e){this._onMeshAssetUnload(e)}_onMeshAssetChange(e){}onSetMeshAsset(e,t,i){const s=this.system.app.assets;if(t){const n=s.get(t);n&&this._unbindMeshAsset(n)}if(i){i instanceof be&&(this.data.meshAsset=i.id,i=i.id);const n=s.get(i);n&&this._bindMeshAsset(n)}else this._onMeshChanged(null)}onSetMesh(e,t,i){!i||i instanceof be||typeof i=="number"?this.meshAsset=i:this._onMeshChanged(i)}_onMeshChanged(e){e&&!(e instanceof It)&&(e.meshInstances[0]?e=e.meshInstances[0].mesh:e=null),this.data.mesh=e,this.emitter&&(this.emitter.mesh=e,this.emitter.resetMaterial(),this.rebuild())}onSetRenderAsset(e,t,i){const s=this.system.app.assets;if(t){const n=s.get(t);n&&this._unbindRenderAsset(n)}if(i){i instanceof be&&(this.data.renderAsset=i.id,i=i.id);const n=s.get(i);n&&this._bindRenderAsset(n)}else this._onRenderChanged(null)}_bindRenderAsset(e){if(e.on("load",this._onRenderAssetLoad,this),e.on("unload",this._onRenderAssetUnload,this),e.on("remove",this._onRenderAssetRemove,this),e.resource)this._onRenderAssetLoad(e);else{if(!this.enabled||!this.entity.enabled)return;this.system.app.assets.load(e)}}_unbindRenderAsset(e){var t;e.off("load",this._onRenderAssetLoad,this),e.off("unload",this._onRenderAssetUnload,this),e.off("remove",this._onRenderAssetRemove,this),(t=this._evtSetMeshes)==null||t.off(),this._evtSetMeshes=null}_onRenderAssetLoad(e){this._onRenderChanged(e.resource)}_onRenderAssetUnload(e){this._onRenderChanged(null)}_onRenderAssetRemove(e){this._onRenderAssetUnload(e)}_onRenderChanged(e){var t;if(!e){this._onMeshChanged(null);return}(t=this._evtSetMeshes)==null||t.off(),this._evtSetMeshes=e.on("set:meshes",this._onRenderSetMeshes,this),e.meshes&&this._onRenderSetMeshes(e.meshes)}_onRenderSetMeshes(e){this._onMeshChanged(e&&e[0])}onSetLoop(e,t,i){this.emitter&&(this.emitter[e]=i,this.emitter.resetTime())}onSetBlendType(e,t,i){this.emitter&&(this.emitter[e]=i,this.emitter.material.blendType=i,this.emitter.resetMaterial(),this.rebuild())}_requestDepth(){this._requestedDepth||(vd||(vd=this.system.app.scene.layers.getLayerById(As)),vd&&(vd.incrementCounter(),this._requestedDepth=!0))}_releaseDepth(){this._requestedDepth&&vd&&(vd.decrementCounter(),this._requestedDepth=!1)}onSetDepthSoftening(e,t,i){t!==i&&(i?(this.enabled&&this.entity.enabled&&this._requestDepth(),this.emitter&&(this.emitter[e]=i)):(this.enabled&&this.entity.enabled&&this._releaseDepth(),this.emitter&&(this.emitter[e]=i)),this.emitter&&(this.reset(),this.emitter.resetMaterial(),this.rebuild()))}onSetSimpleProperty(e,t,i){this.emitter&&(this.emitter[e]=i,this.emitter.resetMaterial())}onSetComplexProperty(e,t,i){this.emitter&&(this.emitter[e]=i,this.emitter.resetMaterial(),this.rebuild(),this.reset())}onSetGraphProperty(e,t,i){this.emitter&&(this.emitter[e]=i,this.emitter.rebuildGraphs(),this.emitter.resetMaterial())}onEnable(){const e=this.system.app.scene,t=e.layers,i=this.data;for(let s=0,n=lS.length;s<n;s++){let a=i[lS[s]];if(a){if(!(a instanceof be))if(parseInt(a,10)>=0)a=this.system.app.assets.get(a);else continue;a&&!a.resource&&this.system.app.assets.load(a)}}if(!this.system.app.graphicsDevice.disableParticleSystem){if(!this.emitter){let s=i.mesh;s instanceof It||(s=null),this.emitter=new t_e(this.system.app.graphicsDevice,{numParticles:i.numParticles,emitterExtents:i.emitterExtents,emitterExtentsInner:i.emitterExtentsInner,emitterRadius:i.emitterRadius,emitterRadiusInner:i.emitterRadiusInner,emitterShape:i.emitterShape,initialVelocity:i.initialVelocity,wrap:i.wrap,localSpace:i.localSpace,screenSpace:i.screenSpace,wrapBounds:i.wrapBounds,lifetime:i.lifetime,rate:i.rate,rate2:i.rate2,orientation:i.orientation,particleNormal:i.particleNormal,animTilesX:i.animTilesX,animTilesY:i.animTilesY,animStartFrame:i.animStartFrame,animNumFrames:i.animNumFrames,animNumAnimations:i.animNumAnimations,animIndex:i.animIndex,randomizeAnimIndex:i.randomizeAnimIndex,animSpeed:i.animSpeed,animLoop:i.animLoop,startAngle:i.startAngle,startAngle2:i.startAngle2,scaleGraph:i.scaleGraph,scaleGraph2:i.scaleGraph2,colorGraph:i.colorGraph,colorGraph2:i.colorGraph2,alphaGraph:i.alphaGraph,alphaGraph2:i.alphaGraph2,localVelocityGraph:i.localVelocityGraph,localVelocityGraph2:i.localVelocityGraph2,velocityGraph:i.velocityGraph,velocityGraph2:i.velocityGraph2,rotationSpeedGraph:i.rotationSpeedGraph,rotationSpeedGraph2:i.rotationSpeedGraph2,radialSpeedGraph:i.radialSpeedGraph,radialSpeedGraph2:i.radialSpeedGraph2,colorMap:i.colorMap,normalMap:i.normalMap,loop:i.loop,preWarm:i.preWarm,sort:i.sort,stretch:i.stretch,alignToMotion:i.alignToMotion,lighting:i.lighting,halfLambert:i.halfLambert,intensity:i.intensity,depthSoftening:i.depthSoftening,scene:this.system.app.scene,mesh:s,depthWrite:i.depthWrite,noFog:i.noFog,node:this.entity,blendType:i.blendType}),this.emitter.meshInstance.node=this.entity,this.emitter.drawOrder=this.drawOrder,i.autoPlay||(this.pause(),this.emitter.meshInstance.visible=!1)}this.emitter.colorMap&&this.addMeshInstanceToLayers(),this._evtLayersChanged=e.on("set:layers",this.onLayersChanged,this),t&&(this._evtLayerAdded=t.on("add",this.onLayerAdded,this),this._evtLayerRemoved=t.on("remove",this.onLayerRemoved,this)),this.enabled&&this.entity.enabled&&i.depthSoftening&&this._requestDepth()}}onDisable(){var i,s,n;const t=this.system.app.scene.layers;(i=this._evtLayersChanged)==null||i.off(),this._evtLayersChanged=null,t&&((s=this._evtLayerAdded)==null||s.off(),this._evtLayerAdded=null,(n=this._evtLayerRemoved)==null||n.off(),this._evtLayerRemoved=null),this.emitter&&(this.removeMeshInstanceFromLayers(),this.data.depthSoftening&&this._releaseDepth(),this.emitter.camera=null)}onBeforeRemove(){this.enabled&&(this.enabled=!1),this.emitter&&(this.emitter.destroy(),this.emitter=null);for(let e=0;e<lS.length;e++){const t=lS[e];this.data[t]&&(this[t]=null)}this.off()}reset(){this.emitter&&this.emitter.reset()}stop(){this.emitter&&(this.emitter.loop=!1,this.emitter.resetTime(),this.emitter.addTime(0,!0))}pause(){this.data.paused=!0}unpause(){this.data.paused=!1}play(){this.data.paused=!1,this.emitter&&(this.emitter.meshInstance.visible=!0,this.emitter.loop=this.data.loop,this.emitter.resetTime())}isPlaying(){return this.data.paused?!1:this.emitter&&this.emitter.loop?!0:Date.now()<=this.emitter.endTime}setInTools(){const{emitter:e}=this;e&&!e.inTools&&(e.inTools=!0,this.rebuild())}rebuild(){const e=this.enabled;this.enabled=!1,this.emitter&&this.emitter.rebuild(),this.enabled=e}}class qEe{constructor(){this.numParticles=1,this.rate=1,this.rate2=null,this.startAngle=0,this.startAngle2=null,this.lifetime=50,this.emitterExtents=new O,this.emitterExtentsInner=new O,this.emitterRadius=0,this.emitterRadiusInner=0,this.emitterShape=_a,this.initialVelocity=0,this.wrap=!1,this.wrapBounds=new O,this.localSpace=!1,this.screenSpace=!1,this.colorMap=null,this.colorMapAsset=null,this.normalMap=null,this.normalMapAsset=null,this.loop=!0,this.preWarm=!1,this.sort=0,this.mode=m9,this.scene=null,this.lighting=!1,this.halfLambert=!1,this.intensity=1,this.stretch=0,this.alignToMotion=!1,this.depthSoftening=0,this.renderAsset=null,this.meshAsset=null,this.mesh=null,this.depthWrite=!1,this.noFog=!1,this.orientation=gb,this.particleNormal=new O(0,1,0),this.animTilesX=1,this.animTilesY=1,this.animStartFrame=0,this.animNumFrames=1,this.animNumAnimations=1,this.animIndex=0,this.randomizeAnimIndex=!1,this.animSpeed=1,this.animLoop=!0,this.scaleGraph=null,this.scaleGraph2=null,this.colorGraph=null,this.colorGraph2=null,this.alphaGraph=null,this.alphaGraph2=null,this.localVelocityGraph=null,this.localVelocityGraph2=null,this.velocityGraph=null,this.velocityGraph2=null,this.rotationSpeedGraph=null,this.rotationSpeedGraph2=null,this.radialSpeedGraph=null,this.radialSpeedGraph2=null,this.blendType=Ka,this.enabled=!0,this.paused=!1,this.autoPlay=!0,this.layers=[nl]}}var YEe=`
varying vec4 texCoordsAlphaLife;
uniform sampler2D colorMap;
uniform sampler2D colorParam;
uniform float graphSampleSize;
uniform float graphNumSamples;
#ifndef CAMERAPLANES
	#define CAMERAPLANES
	uniform vec4 camera_params;
#endif
uniform float softening;
uniform float colorMult;
float saturate(float x) {
	return clamp(x, 0.0, 1.0);
}
void main(void) {
	vec4 tex  = texture2D(colorMap, vec2(texCoordsAlphaLife.x, 1.0 - texCoordsAlphaLife.y));
	vec4 ramp = texture2D(colorParam, vec2(texCoordsAlphaLife.w, 0.0));
	ramp.rgb *= colorMult;
	ramp.a += texCoordsAlphaLife.z;
	vec3 rgb = tex.rgb * ramp.rgb;
	float a  = tex.a * ramp.a;
`,KEe=`
vec3 unpack3NFloats(float src) {
	float r = fract(src);
	float g = fract(src * 256.0);
	float b = fract(src * 65536.0);
	return vec3(r, g, b);
}
float saturate(float x) {
	return clamp(x, 0.0, 1.0);
}
vec4 tex1Dlod_lerp(TEXTURE_ACCEPT_HIGHP(tex), vec2 tc) {
	return mix( texture2D(tex,tc), texture2D(tex,tc + graphSampleSize), fract(tc.x*graphNumSamples) );
}
vec4 tex1Dlod_lerp(TEXTURE_ACCEPT_HIGHP(tex), vec2 tc, out vec3 w) {
	vec4 a = texture2D(tex,tc);
	vec4 b = texture2D(tex,tc + graphSampleSize);
	float c = fract(tc.x*graphNumSamples);
	vec3 unpackedA = unpack3NFloats(a.w);
	vec3 unpackedB = unpack3NFloats(b.w);
	w = mix(unpackedA, unpackedB, c);
	return mix(a, b, c);
}
vec2 rotate(vec2 quadXY, float pRotation, out mat2 rotMatrix) {
	float c = cos(pRotation);
	float s = sin(pRotation);
	mat2 m = mat2(c, -s, s, c);
	rotMatrix = m;
	return m * quadXY;
}
vec3 billboard(vec3 InstanceCoords, vec2 quadXY) {
	#ifdef SCREEN_SPACE
		vec3 pos = vec3(-1, 0, 0) * quadXY.x + vec3(0, -1, 0) * quadXY.y;
	#else
		vec3 pos = -matrix_viewInverse[0].xyz * quadXY.x + -matrix_viewInverse[1].xyz * quadXY.y;
	#endif
	return pos;
}
vec3 customFace(vec3 InstanceCoords, vec2 quadXY) {
	vec3 pos = faceTangent * quadXY.x + faceBinorm * quadXY.y;
	return pos;
}
vec2 safeNormalize(vec2 v) {
	float l = length(v);
	return (l > 1e-06) ? v / l : v;
}
void main(void) {
	vec3 meshLocalPos = particle_vertexData.xyz;
	float id = floor(particle_vertexData.w);
	float rndFactor = fract(sin(id + 1.0 + seed));
	vec3 rndFactor3 = vec3(rndFactor, fract(rndFactor*10.0), fract(rndFactor*100.0));
	float uv = id / numParticlesPot;
	readInput(uv);
#ifdef LOCAL_SPACE
	inVel = mat3(matrix_model) * inVel;
#endif
	vec2 velocityV = safeNormalize((mat3(matrix_view) * inVel).xy);
	float particleLifetime = lifetime;
	if (inLife <= 0.0 || inLife > particleLifetime || !inShow)
		meshLocalPos = vec3(0.0);
	vec2 quadXY = meshLocalPos.xy;
	float nlife = clamp(inLife / particleLifetime, 0.0, 1.0);
	vec3 paramDiv;
	vec4 params = tex1Dlod_lerp(TEXTURE_PASS(internalTex2), vec2(nlife, 0), paramDiv);
	float scale = params.y;
	float scaleDiv = paramDiv.x;
	float alphaDiv = paramDiv.z;
	scale += (scaleDiv * 2.0 - 1.0) * scaleDivMult * fract(rndFactor*10000.0);
#ifndef USE_MESH
	texCoordsAlphaLife = vec4(quadXY * -0.5 + 0.5, (alphaDiv * 2.0 - 1.0) * alphaDivMult * fract(rndFactor*1000.0), nlife);
#else
	texCoordsAlphaLife = vec4(particle_uv, (alphaDiv * 2.0 - 1.0) * alphaDivMult * fract(rndFactor*1000.0), nlife);
#endif
	vec3 particlePos = inPos;
	vec3 particlePosMoved = vec3(0.0);
	mat2 rotMatrix;
`,ZEe=`
	float animFrame = min(floor(texCoordsAlphaLife.w * animTexParams.y) + animTexParams.x, animTexParams.z);
`,QEe=`
	float animFrame = floor(mod(texCoordsAlphaLife.w * animTexParams.y + animTexParams.x, animTexParams.z + 1.0));
`,JEe=`
	float animationIndex;
	if (animTexIndexParams.y == 1.0) {
		animationIndex = floor((animTexParams.w + 1.0) * rndFactor3.z) * (animTexParams.z + 1.0);
	} else {
		animationIndex = animTexIndexParams.x * (animTexParams.z + 1.0);
	}
	float atlasX = (animationIndex + animFrame) * animTexTilesParams.x;
	float atlasY = 1.0 - floor(atlasX + 1.0) * animTexTilesParams.y;
	atlasX = fract(atlasX);
	texCoordsAlphaLife.xy *= animTexTilesParams.xy;
	texCoordsAlphaLife.xy += vec2(atlasX, atlasY);
`,eAe=`
void readInput(float uv) {
	vec4 tex = texture2D(particleTexIN, vec2(uv, 0.25));
	vec4 tex2 = texture2D(particleTexIN, vec2(uv, 0.75));
	inPos = tex.xyz;
	inVel = tex2.xyz;
	inAngle = (tex.w < 0.0? -tex.w : tex.w) - 1000.0;
	inShow = tex.w >= 0.0;
	inLife = tex2.w;
}
`,tAe=`
#define PI2 6.283185307179586
uniform vec3 inBoundsSize;
uniform vec3 inBoundsCenter;
uniform float maxVel;
float decodeFloatRG(vec2 rg) {
	return rg.y * (1.0 / 255.0) + rg.x;
}
float decodeFloatRGBA( vec4 rgba ) {
	return dot(rgba, vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));
}
void readInput(float uv) {
	vec4 tex0 = texture2D(particleTexIN, vec2(uv, 0.125));
	vec4 tex1 = texture2D(particleTexIN, vec2(uv, 0.375));
	vec4 tex2 = texture2D(particleTexIN, vec2(uv, 0.625));
	vec4 tex3 = texture2D(particleTexIN, vec2(uv, 0.875));
	inPos = vec3(decodeFloatRG(tex0.rg), decodeFloatRG(tex0.ba), decodeFloatRG(tex1.rg));
	inPos = (inPos - vec3(0.5)) * inBoundsSize + inBoundsCenter;
	inVel = tex2.xyz;
	inVel = (inVel - vec3(0.5)) * maxVel;
	inAngle = decodeFloatRG(tex1.ba) * PI2;
	inShow = tex2.a > 0.5;
	inLife = decodeFloatRGBA(tex3);
	float maxNegLife = max(lifetime, (numParticles - 1.0) * (rate+rateDiv));
	float maxPosLife = lifetime+1.0;
	inLife = inLife * (maxNegLife + maxPosLife) - maxNegLife;
}
`,iAe=`
void writeOutput() {
	if (gl_FragCoord.y<1.0) {
		gl_FragColor = vec4(outPos, (outAngle + 1000.0) * visMode);
	} else {
		gl_FragColor = vec4(outVel, outLife);
	}
}
`,rAe=`
uniform vec3 outBoundsMul;
uniform vec3 outBoundsAdd;
vec2 encodeFloatRG( float v ) {
	vec2 enc = vec2(1.0, 255.0) * v;
	enc = fract(enc);
	enc -= enc.yy * vec2(1.0/255.0, 1.0/255.0);
	return enc;
}
vec4 encodeFloatRGBA( float v ) {
	vec4 enc = vec4(1.0, 255.0, 65025.0, 160581375.0) * v;
	enc = fract(enc);
	enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);
	return enc;
}
void writeOutput() {
	outPos = outPos * outBoundsMul + outBoundsAdd;
	outAngle = fract(outAngle / PI2);
	outVel = (outVel / maxVel) + vec3(0.5);
	float maxNegLife = max(lifetime, (numParticles - 1.0) * (rate+rateDiv));
	float maxPosLife = lifetime+1.0;
	outLife = (outLife + maxNegLife) / (maxNegLife + maxPosLife);
	if (gl_FragCoord.y < 1.0) {
		gl_FragColor = vec4(encodeFloatRG(outPos.x), encodeFloatRG(outPos.y));
	} else if (gl_FragCoord.y < 2.0) {
		gl_FragColor = vec4(encodeFloatRG(outPos.z), encodeFloatRG(outAngle));
	} else if (gl_FragCoord.y < 3.0) {
		gl_FragColor = vec4(outVel, visMode*0.5+0.5);
	} else {
		gl_FragColor = encodeFloatRGBA(outLife);
	}
}
`,sAe=`
uniform mat3 spawnBounds;
uniform vec3 spawnPosInnerRatio;
vec3 calcSpawnPosition(vec3 inBounds, float rndFactor) {
	vec3 pos = inBounds - vec3(0.5);
	vec3 posAbs = abs(pos);
	vec3 maxPos = vec3(max(posAbs.x, max(posAbs.y, posAbs.z)));
	vec3 edge = maxPos + (vec3(0.5) - maxPos) * spawnPosInnerRatio;
	pos.x = edge.x * (maxPos.x == posAbs.x ? sign(pos.x) : 2.0 * pos.x);
	pos.y = edge.y * (maxPos.y == posAbs.y ? sign(pos.y) : 2.0 * pos.y);
	pos.z = edge.z * (maxPos.z == posAbs.z ? sign(pos.z) : 2.0 * pos.z);
#ifndef LOCAL_SPACE
	return emitterPos + spawnBounds * pos;
#else
	return spawnBounds * pos;
#endif
}
void addInitialVelocity(inout vec3 localVelocity, vec3 inBounds) {
	localVelocity -= vec3(0, 0, initialVelocity);
}
`,nAe=`
	writeOutput();
}
`,aAe=`
varying vec2 vUv0;
uniform highp sampler2D particleTexIN;
uniform highp sampler2D internalTex0;
uniform highp sampler2D internalTex1;
uniform highp sampler2D internalTex2;
uniform highp sampler2D internalTex3;
uniform mat3 emitterMatrix;
uniform mat3 emitterMatrixInv;
uniform vec3 emitterScale;
uniform vec3 emitterPos;
uniform vec3 frameRandom;
uniform vec3 localVelocityDivMult;
uniform vec3 velocityDivMult;
uniform float delta;
uniform float rate;
uniform float rateDiv;
uniform float lifetime;
uniform float numParticles;
uniform float rotSpeedDivMult;
uniform float radialSpeedDivMult;
uniform float seed;
uniform float startAngle;
uniform float startAngle2;
uniform float initialVelocity;
uniform float graphSampleSize;
uniform float graphNumSamples;
vec3 inPos;
vec3 inVel;
float inAngle;
bool inShow;
float inLife;
float visMode;
vec3 outPos;
vec3 outVel;
float outAngle;
bool outShow;
float outLife;
`,oAe=`
	if (outLife >= lifetime) {
		outLife -= max(lifetime, (numParticles - 1.0) * particleRate);
		visMode = -1.0;
	}
`,lAe=`
	visMode = outLife < 0.0? -1.0: visMode;
`,cAe=`
	if (outLife >= lifetime) {
		outLife -= max(lifetime, (numParticles - 1.0) * particleRate);
		visMode = 1.0;
	}
	visMode = outLife < 0.0? 1.0: visMode;
`,uAe=`
uniform float spawnBoundsSphere;
uniform float spawnBoundsSphereInnerRatio;
vec3 calcSpawnPosition(vec3 inBounds, float rndFactor) {
	float rnd4 = fract(rndFactor * 1000.0);
	vec3 norm = normalize(inBounds.xyz - vec3(0.5));
	float r = rnd4 * (1.0 - spawnBoundsSphereInnerRatio) + spawnBoundsSphereInnerRatio;
#ifndef LOCAL_SPACE
	return emitterPos + norm * r * spawnBoundsSphere;
#else
	return norm * r * spawnBoundsSphere;
#endif
}
void addInitialVelocity(inout vec3 localVelocity, vec3 inBounds) {
	localVelocity += normalize(inBounds - vec3(0.5)) * initialVelocity;
}
`,hAe=`
float saturate(float x) {
	return clamp(x, 0.0, 1.0);
}
vec3 unpack3NFloats(float src) {
	float r = fract(src);
	float g = fract(src * 256.0);
	float b = fract(src * 65536.0);
	return vec3(r, g, b);
}
vec3 tex1Dlod_lerp(TEXTURE_ACCEPT_HIGHP(tex), vec2 tc, out vec3 w) {
	vec4 a = texture2D(tex, tc);
	vec4 b = texture2D(tex, tc + graphSampleSize);
	float c = fract(tc.x * graphNumSamples);
	vec3 unpackedA = unpack3NFloats(a.w);
	vec3 unpackedB = unpack3NFloats(b.w);
	w = mix(unpackedA, unpackedB, c);
	return mix(a.xyz, b.xyz, c);
}
#define HASHSCALE4 vec4(1031, .1030, .0973, .1099)
vec4 hash41(float p) {
	vec4 p4 = fract(vec4(p) * HASHSCALE4);
	p4 += dot(p4, p4.wzxy+19.19);
	return fract(vec4((p4.x + p4.y)*p4.z, (p4.x + p4.z)*p4.y, (p4.y + p4.z)*p4.w, (p4.z + p4.w)*p4.x));
}
void main(void) {
	if (gl_FragCoord.x > numParticles) discard;
	readInput(vUv0.x);
	visMode = inShow? 1.0 : -1.0;
	vec4 rndFactor = hash41(gl_FragCoord.x + seed);
	float particleRate = rate + rateDiv * rndFactor.x;
	outLife = inLife + delta;
	float nlife = clamp(outLife / lifetime, 0.0, 1.0);
	vec3 localVelocityDiv;
	vec3 velocityDiv;
	vec3 paramDiv;
	vec3 localVelocity = tex1Dlod_lerp(TEXTURE_PASS(internalTex0), vec2(nlife, 0), localVelocityDiv);
	vec3 velocity =	  tex1Dlod_lerp(TEXTURE_PASS(internalTex1), vec2(nlife, 0), velocityDiv);
	vec3 params =		tex1Dlod_lerp(TEXTURE_PASS(internalTex2), vec2(nlife, 0), paramDiv);
	float rotSpeed = params.x;
	float rotSpeedDiv = paramDiv.y;
	vec3 radialParams = tex1Dlod_lerp(TEXTURE_PASS(internalTex3), vec2(nlife, 0), paramDiv);
	float radialSpeed = radialParams.x;
	float radialSpeedDiv = radialParams.y;
	bool respawn = inLife <= 0.0 || outLife >= lifetime;
	inPos = respawn ? calcSpawnPosition(rndFactor.xyz, rndFactor.x) : inPos;
	inAngle = respawn ? mix(startAngle, startAngle2, rndFactor.x) : inAngle;
#ifndef LOCAL_SPACE
	vec3 radialVel = inPos - emitterPos;
#else
	vec3 radialVel = inPos;
#endif
	radialVel = (dot(radialVel, radialVel) > 1.0E-8) ? radialSpeed * normalize(radialVel) : vec3(0.0);
	radialVel += (radialSpeedDiv * vec3(2.0) - vec3(1.0)) * radialSpeedDivMult * rndFactor.xyz;
	localVelocity +=	(localVelocityDiv * vec3(2.0) - vec3(1.0)) * localVelocityDivMult * rndFactor.xyz;
	velocity +=		 (velocityDiv * vec3(2.0) - vec3(1.0)) * velocityDivMult * rndFactor.xyz;
	rotSpeed +=		 (rotSpeedDiv * 2.0 - 1.0) * rotSpeedDivMult * rndFactor.y;
	addInitialVelocity(localVelocity, rndFactor.xyz);
#ifndef LOCAL_SPACE
	outVel = emitterMatrix * localVelocity + (radialVel + velocity) * emitterScale;
#else
	outVel = (localVelocity + radialVel) / emitterScale + emitterMatrixInv * velocity;
#endif
	outPos = inPos + outVel * delta;
	outAngle = inAngle + rotSpeed * delta;
`,dAe=`
	quadXY = rotate(quadXY, inAngle, rotMatrix);
	vec3 localPos = billboard(particlePos, quadXY);
`,fAe=`
	dBlendModeFogFactor = 0.0;
	rgb *= saturate(gammaCorrectInput(max(a, 0.0)));
	if ((rgb.r + rgb.g + rgb.b) < 0.000001) discard;
`,pAe=`
	rgb = mix(vec3(1.0), rgb, vec3(a));
	if (rgb.r + rgb.g + rgb.b > 2.99) discard;
`,mAe=`
	if (a < 0.01) discard;
`,gAe=`
attribute vec4 particle_vertexData;
attribute vec4 particle_vertexData2;
attribute vec4 particle_vertexData3;
attribute float particle_vertexData4;
#ifndef USE_MESH
	attribute vec2 particle_vertexData5;
#else
	attribute vec4 particle_vertexData5;
#endif
uniform mat4 matrix_viewProjection;
uniform mat4 matrix_model;
#ifndef VIEWMATRIX
	#define VIEWMATRIX
	uniform mat4 matrix_view;
#endif
uniform mat3 matrix_normal;
uniform mat4 matrix_viewInverse;
uniform float numParticles;
uniform float lifetime;
uniform float stretch;
uniform float seed;
uniform vec3 wrapBounds;
uniform vec3 emitterScale;
uniform vec3 faceTangent;
uniform vec3 faceBinorm;
#ifdef PARTICLE_GPU
	uniform highp sampler2D internalTex0;
	uniform highp sampler2D internalTex1;
	uniform highp sampler2D internalTex2;
#endif
uniform vec3 emitterPos;
varying vec4 texCoordsAlphaLife;
vec2 rotate(vec2 quadXY, float pRotation, out mat2 rotMatrix)
{
	float c = cos(pRotation);
	float s = sin(pRotation);
	mat2 m = mat2(c, -s, s, c);
	rotMatrix = m;
	return m * quadXY;
}
vec3 billboard(vec3 InstanceCoords, vec2 quadXY)
{
	vec3 pos = -matrix_viewInverse[0].xyz * quadXY.x + -matrix_viewInverse[1].xyz * quadXY.y;
	return pos;
}
vec3 customFace(vec3 InstanceCoords, vec2 quadXY)
{
	vec3 pos = faceTangent * quadXY.x + faceBinorm * quadXY.y;
	return pos;
}
void main(void)
{
	vec3 particlePos = particle_vertexData.xyz;
	vec3 inPos = particlePos;
	vec3 vertPos = particle_vertexData3.xyz;
	vec3 inVel = vec3(particle_vertexData2.w, particle_vertexData3.w, particle_vertexData5.x);
	float id = floor(particle_vertexData4);
	float rndFactor = fract(sin(id + 1.0 + seed));
	vec3 rndFactor3 = vec3(rndFactor, fract(rndFactor*10.0), fract(rndFactor*100.0));
#ifdef LOCAL_SPACE
	inVel = mat3(matrix_model) * inVel;
#endif
	vec2 velocityV = normalize((mat3(matrix_view) * inVel).xy);
	vec2 quadXY = vertPos.xy;
#ifdef USE_MESH
	texCoordsAlphaLife = vec4(particle_vertexData5.zw, particle_vertexData2.z, particle_vertexData.w);
#else
	texCoordsAlphaLife = vec4(quadXY * -0.5 + 0.5, particle_vertexData2.z, particle_vertexData.w);
#endif
	mat2 rotMatrix;
	float inAngle = particle_vertexData2.x;
	vec3 particlePosMoved = vec3(0.0);
	vec3 meshLocalPos = particle_vertexData3.xyz;
`,_Ae=`
	localPos *= particle_vertexData2.y * emitterScale;
	localPos += particlePos;
	gl_Position = matrix_viewProjection * vec4(localPos, 1.0);
`,vAe=`
	quadXY = rotate(quadXY, inAngle, rotMatrix);
	vec3 localPos = customFace(particlePos, quadXY);
`,yAe=`
	rgb = addFog(rgb);
	rgb = toneMap(rgb);
	rgb = gammaCorrectOutput(rgb);
	gl_FragColor = vec4(rgb, a);
}
`,SAe=`
	localPos *= scale * emitterScale;
	localPos += particlePos;
	#ifdef SCREEN_SPACE
	gl_Position = vec4(localPos.x, localPos.y, 0.0, 1.0);
	#else
	gl_Position = matrix_viewProjection * vec4(localPos.xyz, 1.0);
	#endif
`,xAe=`
	vec3 negNormal = normal * 0.5 + 0.5;
	vec3 posNormal = -normal * 0.5 + 0.5;
	negNormal *= negNormal;
	posNormal *= posNormal;
`,bAe=`
attribute vec4 particle_vertexData;
#if defined(USE_MESH)
	#if defined(USE_MESH_UV)
		attribute vec2 particle_uv;
	#else
		vec2 particle_uv = vec2(0.0, 0.0);
	#endif
#endif
uniform mat4 matrix_viewProjection;
uniform mat4 matrix_model;
uniform mat3 matrix_normal;
uniform mat4 matrix_viewInverse;
#ifndef VIEWMATRIX
	#define VIEWMATRIX
	uniform mat4 matrix_view;
#endif
uniform float numParticles;
uniform float numParticlesPot;
uniform float graphSampleSize;
uniform float graphNumSamples;
uniform float stretch;
uniform vec3 wrapBounds;
uniform vec3 emitterScale;
uniform vec3 emitterPos;
uniform vec3 faceTangent;
uniform vec3 faceBinorm;
uniform float rate;
uniform float rateDiv;
uniform float lifetime;
uniform float deltaRandomnessStatic;
uniform float scaleDivMult;
uniform float alphaDivMult;
uniform float seed;
uniform float delta;
uniform sampler2D particleTexOUT;
uniform sampler2D particleTexIN;
#ifdef PARTICLE_GPU
	uniform highp sampler2D internalTex0;
	uniform highp sampler2D internalTex1;
	uniform highp sampler2D internalTex2;
#endif
#ifndef CAMERAPLANES
	#define CAMERAPLANES
	uniform vec4 camera_params;
#endif
varying vec4 texCoordsAlphaLife;
vec3 inPos;
vec3 inVel;
float inAngle;
bool inShow;
float inLife;
`,wAe=`
	vec3 negNormal = max(normal, vec3(0.0));
	vec3 posNormal = max(-normal, vec3(0.0));
`,TAe=`
	vec3 light = negNormal.x*lightCube[0] + posNormal.x*lightCube[1] +
						negNormal.y*lightCube[2] + posNormal.y*lightCube[3] +
						negNormal.z*lightCube[4] + posNormal.z*lightCube[5];
	rgb *= light;
`,EAe=`
	particlePos = (matrix_model * vec4(particlePos, 1.0)).xyz;
`,AAe=`
	vec3 localPos = meshLocalPos;
	localPos.xy = rotate(localPos.xy, inAngle, rotMatrix);
	localPos.yz = rotate(localPos.yz, inAngle, rotMatrix);
	billboard(particlePos, quadXY);
`,CAe=`
	Normal = normalize(localPos + matrix_viewInverse[2].xyz);
`,PAe=`
	vec3 normalMap = normalize(texture2D(normalMap, vec2(texCoordsAlphaLife.x, 1.0 - texCoordsAlphaLife.y)).xyz * 2.0 - 1.0);
	vec3 normal = ParticleMat * normalMap;
`,IAe=`
	inAngle = atan(velocityV.x, velocityV.y);
`,MAe=`
	#include "particleUpdaterInitPS"
	#ifdef PACK8
		#include "particleInputRgba8PS"
		#include "particleOutputRgba8PS"
	#else
		#include "particleInputFloatPS"
		#include "particleOutputFloatPS"
	#endif
	#ifdef EMITTERSHAPE_BOX
		#include "particleUpdaterAABBPS"
	#else
		#include "particleUpdaterSpherePS"
	#endif
	#include "particleUpdaterStartPS"
	#ifdef RESPAWN
		#include "particleUpdaterRespawnPS"
	#endif
	#ifdef NO_RESPAWN
		#include "particleUpdaterNoRespawnPS"
	#endif
	#ifdef ON_STOP
		#include "particleUpdaterOnStopPS"
	#endif
	#include "particleUpdaterEndPS"
`,RAe=`
	#if NORMAL != NONE
		#if NORMAL == VERTEX
			varying vec3 Normal;
		#endif
		#if NORMAL == MAP
			varying mat3 ParticleMat;
		#endif
		uniform vec3 lightCube[6];
	#endif
	#ifdef SOFT
		varying float vDepth;
		#include "screenDepthPS"
	#endif
	#include "gammaPS"
	#include "tonemappingPS"
	#include "fogPS"
	#if NORMAL == MAP
		uniform sampler2D normalMap;
	#endif
	#include "particlePS"
	#ifdef SOFT
		#include "particle_softPS"
	#endif
	#if NORMAL == VERTEX
		vec3 normal = Normal;
	#endif
	#if NORMAL == MAP
		#include "particle_normalMapPS"
	#endif
	#if NORMAL != NONE
		#ifdef HALF_LAMBERT
			#include "particle_halflambertPS"
		#else
			#include "particle_lambertPS"
		#endif
		#include "particle_lightingPS"
	#endif
	#if BLEND == NORMAL
		#include "particle_blendNormalPS"
	#elif BLEND == ADDITIVE
		#include "particle_blendAddPS"
	#elif BLEND == MULTIPLICATIVE
		#include "particle_blendMultiplyPS"
	#endif
	#include "particle_endPS"
`,DAe=`
	#ifdef ANIMTEX
		uniform vec2 animTexTilesParams;
		uniform vec4 animTexParams;
		uniform vec2 animTexIndexParams;
	#endif
	#if NORMAL == MAP
		varying mat3 ParticleMat;
	#endif
	#if NORMAL == VERTEX
		varying vec3 Normal;
	#endif
	#ifdef SOFT
		varying float vDepth;
	#endif
	#ifdef PARTICLE_GPU
		#include "particle_initVS"
		#ifdef PACK8
			#include "particleInputRgba8PS"
		#else
			#include  "particleInputFloatPS"
		#endif
		#ifdef SOFT
			#include "screenDepthPS"
		#endif
		#include "particleVS"
	#else
		#ifdef SOFT
			#include "screenDepthPS"
		#endif
		#include "particle_cpuVS"
	#endif
	#ifdef LOCAL_SPACE
		#include "particle_localShiftVS"
	#endif
	#ifdef ANIMTEX
		#ifdef ANIMTEX_LOOP
			#include "particleAnimFrameLoopVS"
		#else
			#include "particleAnimFrameClampVS"
		#endif
		#include "particleAnimTexVS"
	#endif
	#ifdef PARTICLE_GPU
		#ifdef WRAP
			#include "particle_wrapVS"
		#endif
	#endif
	#ifdef ALIGN_TO_MOTION
		#include "particle_pointAlongVS"
	#endif
	#ifdef USE_MESH
		#include "particle_meshVS"
	#else
		#ifdef CUSTOM_FACE
			#include "particle_customFaceVS"
		#else
			#include "particle_billboardVS"
		#endif
	#endif
	#if NORMAL == VERTEX
		#include "particle_normalVS"
	#endif
	#if NORMAL == MAP
		#include "particle_TBNVS"
	#endif
	#ifdef STRETCH
		#include "particle_stretchVS"
	#endif
	#ifdef PARTICLE_GPU
		#include "particle_endVS"
	#else
		#include "particle_cpu_endVS"
	#endif
	#ifdef SOFT
		#include "particle_softVS"
	#endif
	}
`,LAe=`
	float depth = getLinearScreenDepth();
	float particleDepth = vDepth;
	float depthDiff = saturate(abs(particleDepth - depth) * softening);
	a *= depthDiff;
`,OAe=`
	vDepth = getLinearDepth(localPos);
`,NAe=`
	vec3 moveDir = inVel * stretch;
	vec3 posPrev = particlePos - moveDir;
	posPrev += particlePosMoved;
	vec2 centerToVertexV = normalize((mat3(matrix_view) * localPos).xy);
	float interpolation = dot(-velocityV, centerToVertexV) * 0.5 + 0.5;
	particlePos = mix(particlePos, posPrev, interpolation);
`,kAe=`
	mat3 rot3 = mat3(rotMatrix[0][0], rotMatrix[0][1], 0.0, rotMatrix[1][0], rotMatrix[1][1], 0.0, 0.0, 0.0, 1.0);
	ParticleMat = mat3(-matrix_viewInverse[0].xyz, -matrix_viewInverse[1].xyz, matrix_viewInverse[2].xyz) * rot3;
`,FAe=`
	vec3 origParticlePos = particlePos;
	particlePos -= matrix_model[3].xyz;
	particlePos = mod(particlePos, wrapBounds) - wrapBounds * 0.5;
	particlePos += matrix_model[3].xyz;
	particlePosMoved = particlePos - origParticlePos;
`;const BAe={particlePS:YEe,particleVS:KEe,particleAnimFrameClampVS:ZEe,particleAnimFrameLoopVS:QEe,particleAnimTexVS:JEe,particleInputFloatPS:eAe,particleInputRgba8PS:tAe,particleOutputFloatPS:iAe,particleOutputRgba8PS:rAe,particleUpdaterAABBPS:sAe,particleUpdaterEndPS:nAe,particleUpdaterInitPS:aAe,particleUpdaterNoRespawnPS:oAe,particleUpdaterOnStopPS:lAe,particleUpdaterRespawnPS:cAe,particleUpdaterSpherePS:uAe,particleUpdaterStartPS:hAe,particle_billboardVS:dAe,particle_blendAddPS:fAe,particle_blendMultiplyPS:pAe,particle_blendNormalPS:mAe,particle_cpuVS:gAe,particle_cpu_endVS:_Ae,particle_customFaceVS:vAe,particle_endPS:yAe,particle_endVS:SAe,particle_halflambertPS:xAe,particle_initVS:bAe,particle_lambertPS:wAe,particle_lightingPS:TAe,particle_localShiftVS:EAe,particle_meshVS:AAe,particle_normalVS:CAe,particle_normalMapPS:PAe,particle_pointAlongVS:IAe,particle_simulationPS:MAe,particle_shaderPS:RAe,particle_shaderVS:DAe,particle_softPS:LAe,particle_softVS:OAe,particle_stretchVS:NAe,particle_TBNVS:kAe,particle_wrapVS:FAe};var UAe=`
varying texCoordsAlphaLife: vec4f;
var colorMap: texture_2d<f32>;
var colorMapSampler: sampler;
var colorParam: texture_2d<f32>;
var colorParamSampler: sampler;
uniform graphSampleSize: f32;
uniform graphNumSamples: f32;
#ifndef CAMERAPLANES
	#define CAMERAPLANES
	uniform camera_params: vec4f;
#endif
uniform softening: f32;
uniform colorMult: f32;
fn saturate(x: f32) -> f32 {
	return clamp(x, 0.0, 1.0);
}
@fragment
fn fragmentMain(input: FragmentInput) -> FragmentOutput {
	var output: FragmentOutput;
	let tex: vec4f  = textureSample(colorMap, colorMapSampler, vec2f(input.texCoordsAlphaLife.x, 1.0 - input.texCoordsAlphaLife.y));
	var ramp: vec4f = textureSample(colorParam, colorParamSampler, vec2f(input.texCoordsAlphaLife.w, 0.0));
	ramp = vec4f(ramp.rgb * uniform.colorMult, ramp.a);
	ramp.a = ramp.a + input.texCoordsAlphaLife.z;
	var rgb: vec3f = tex.rgb * ramp.rgb;
	var a: f32 = tex.a * ramp.a;
`,zAe=`
fn unpack3NFloats(src: f32) -> vec3f {
	let r = fract(src);
	let g = fract(src * 256.0);
	let b = fract(src * 65536.0);
	return vec3f(r, g, b);
}
fn saturate(x: f32) -> f32 {
	return clamp(x, 0.0, 1.0);
}
struct TexLerpUnpackResult {
	result: vec4f,
	unpacked: vec3f
}
fn tex1Dlod_lerp_simple(tex: texture_2d<f32>, texSampler: sampler, tc: vec2f) -> vec4f {
	let tc_next = tc + vec2f(uniform.graphSampleSize);
	return mix( textureSample(tex, texSampler, tc), textureSample(tex, texSampler, tc_next), fract(tc.x * uniform.graphNumSamples) );
}
fn tex1Dlod_lerp_unpack(tex: texture_2d<f32>, texSampler: sampler, tc: vec2f) -> TexLerpUnpackResult {
	let tc_next = tc + vec2f(uniform.graphSampleSize);
	let a = textureSampleLevel(tex, texSampler, tc, 0.0);
	let b = textureSampleLevel(tex, texSampler, tc_next, 0.0);
	let c = fract(tc.x * uniform.graphNumSamples);
	let unpackedA = unpack3NFloats(a.w);
	let unpackedB = unpack3NFloats(b.w);
	let w_out = mix(unpackedA, unpackedB, c);
	return TexLerpUnpackResult(mix(a, b, c), w_out);
}
struct RotateResult {
	rotatedVec: vec2f,
	matrix: mat2x2f
}
fn rotateWithMatrix(quadXY: vec2f, pRotation: f32) -> RotateResult {
	let c = cos(pRotation);
	let s = sin(pRotation);
	let m = mat2x2f(vec2f(c, s), vec2f(-s, c));
	return RotateResult(m * quadXY, m);
}
fn billboard(InstanceCoords: vec3f, quadXY: vec2f) -> vec3f {
	var pos: vec3f;
	#ifdef SCREEN_SPACE
		pos = vec3f(-1.0, 0.0, 0.0) * quadXY.x + vec3f(0.0, -1.0, 0.0) * quadXY.y;
	#else
		pos = -uniform.matrix_viewInverse[0].xyz * quadXY.x + -uniform.matrix_viewInverse[1].xyz * quadXY.y;
	#endif
	return pos;
}
fn customFace(InstanceCoords: vec3f, quadXY: vec2f) -> vec3f {
	let pos = uniform.faceTangent * quadXY.x + uniform.faceBinorm * quadXY.y;
	return pos;
}
fn safeNormalize(v: vec2f) -> vec2f {
	let l = length(v);
	return select(v, v / l, l > 1e-06);
}
@vertex
fn vertexMain(input: VertexInput) -> VertexOutput {
	var output: VertexOutput;
	let meshLocalPos_in = input.particle_vertexData.xyz;
	let id = floor(input.particle_vertexData.w);
	let rndFactor = fract(sin(id + 1.0 + uniform.seed));
	let rndFactor3 = vec3f(rndFactor, fract(rndFactor*10.0), fract(rndFactor*100.0));
	let uv = id / uniform.numParticlesPot;
	readInput(uv);
	#ifdef LOCAL_SPACE
		let modelRotation = mat3x3f(uniform.matrix_model[0].xyz, uniform.matrix_model[1].xyz, uniform.matrix_model[2].xyz);
		inVel = modelRotation * inVel;
	#endif
	let viewRotation = mat3x3f(uniform.matrix_view[0].xyz, uniform.matrix_view[1].xyz, uniform.matrix_view[2].xyz);
	let velocityV = safeNormalize((viewRotation * inVel).xy);
	let particleLifetime = uniform.lifetime;
	var meshLocalPos = meshLocalPos_in;
	if (inLife <= 0.0 || inLife > particleLifetime || !inShow) {
		 meshLocalPos = vec3f(0.0);
	}
	let quadXY = meshLocalPos.xy;
	let nlife = clamp(inLife / particleLifetime, 0.0, 1.0);
	let lerp_result = tex1Dlod_lerp_unpack(internalTex2, internalTex2Sampler, vec2f(nlife, 0.0));
	let params = lerp_result.result;
	let paramDiv = lerp_result.unpacked;
	var scale = params.y;
	let scaleDiv = paramDiv.x;
	let alphaDiv = paramDiv.z;
	scale = scale + (scaleDiv * 2.0 - 1.0) * uniform.scaleDivMult * fract(rndFactor*10000.0);
	#ifndef USE_MESH
		output.texCoordsAlphaLife = vec4f(quadXY * -0.5 + 0.5, (alphaDiv * 2.0 - 1.0) * uniform.alphaDivMult * fract(rndFactor*1000.0), nlife);
	#else
		output.texCoordsAlphaLife = vec4f(particle_uv, (alphaDiv * 2.0 - 1.0) * uniform.alphaDivMult * fract(rndFactor*1000.0), nlife);
	#endif
	var particlePos = inPos;
	var particlePosMoved = vec3f(0.0);
	var rotMatrix: mat2x2f;
`,VAe=`
	let animFrame: f32 = min(floor(input.texCoordsAlphaLife.w * uniform.animTexParams.y) + uniform.animTexParams.x, uniform.animTexParams.z);
`,jAe=`
	let animFrame: f32 = floor((output.texCoordsAlphaLife.w * uniform.animTexParams.y + uniform.animTexParams.x) % (uniform.animTexParams.z + 1.0));	
`,$Ae=`
	var animationIndex: f32;
	if (uniform.animTexIndexParams.y == 1.0) {
		animationIndex = floor((uniform.animTexParams.w + 1.0) * rndFactor3.z) * (uniform.animTexParams.z + 1.0);
	} else {
		animationIndex = uniform.animTexIndexParams.x * (uniform.animTexParams.z + 1.0);
	}
	var atlasX: f32 = (animationIndex + animFrame) * uniform.animTexTilesParams.x;
	let atlasY: f32 = 1.0 - floor(atlasX + 1.0) * uniform.animTexTilesParams.y;
	atlasX = fract(atlasX);
	let current_tcal_xy = output.texCoordsAlphaLife.xy;
	let scaled_tcal_xy = current_tcal_xy * uniform.animTexTilesParams.xy;
	let final_tcal_xy = scaled_tcal_xy + vec2f(atlasX, atlasY);
	output.texCoordsAlphaLife = vec4f(final_tcal_xy, output.texCoordsAlphaLife.z, output.texCoordsAlphaLife.w);
`,HAe=`
fn readInput(uv: f32) {
	let tex: vec4f = textureSampleLevel(particleTexIN, particleTexINSampler, vec2f(uv, 0.25), 0.0);
	let tex2: vec4f = textureSampleLevel(particleTexIN, particleTexINSampler, vec2f(uv, 0.75), 0.0);
	inPos = tex.xyz;
	inVel = tex2.xyz;
	inAngle = abs(tex.w) - 1000.0;
	inShow = tex.w >= 0.0;
	inLife = tex2.w;
}
`,GAe=`
const PI2: f32 = 6.283185307179586;
uniform inBoundsSize: vec3f;
uniform inBoundsCenter: vec3f;
uniform maxVel: f32;
fn decodeFloatRG(rg: vec2f) -> f32 {
	return rg.y * (1.0 / 255.0) + rg.x;
}
fn decodeFloatRGBA( rgba: vec4f ) -> f32 {
	return dot(rgba, vec4f(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));
}
fn readInput(uv: f32) {
	let tex0 = textureSampleLevel(particleTexIN, particleTexINSampler, vec2f(uv, 0.125), 0.0);
	let tex1 = textureSampleLevel(particleTexIN, particleTexINSampler, vec2f(uv, 0.375), 0.0);
	let tex2 = textureSampleLevel(particleTexIN, particleTexINSampler, vec2f(uv, 0.625), 0.0);
	let tex3 = textureSampleLevel(particleTexIN, particleTexINSampler, vec2f(uv, 0.875), 0.0);
	inPos = vec3f(decodeFloatRG(tex0.rg), decodeFloatRG(tex0.ba), decodeFloatRG(tex1.rg));
	inPos = (inPos - vec3f(0.5)) * uniform.inBoundsSize + uniform.inBoundsCenter;
	inVel = tex2.xyz;
	inVel = (inVel - vec3f(0.5)) * uniform.maxVel;
	inAngle = decodeFloatRG(tex1.ba) * PI2;
	inShow = tex2.a > 0.5;
	let life_decoded = decodeFloatRGBA(tex3);
	let maxNegLife = max(uniform.lifetime, (uniform.numParticles - 1.0) * (uniform.rate + uniform.rateDiv));
	let maxPosLife = uniform.lifetime + 1.0;
	inLife = life_decoded * (maxNegLife + maxPosLife) - maxNegLife;
}`,WAe=`
fn getOutput() -> vec4f {
	if (pcPosition.y < 1.0) {
		return vec4f(outPos, (outAngle + 1000.0) * visMode);
	} else {
		return vec4f(outVel, outLife);
	}
}
`,XAe=`
uniform outBoundsMul: vec3f;
uniform outBoundsAdd: vec3f;
fn encodeFloatRG( v: f32 ) -> vec2f {
	var enc: vec2f = vec2f(1.0, 255.0) * v;
	enc = fract(enc);
	enc = enc - enc.yy * (1.0 / 255.0);
	return enc;
}
fn encodeFloatRGBA( v: f32 ) -> vec4f {
	let factors = vec4f(1.0, 255.0, 65025.0, 160581375.0);
	var enc: vec4f = factors * v;
	enc = fract(enc);
	enc = enc - enc.yzww * vec4f(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);
	return enc;
}
fn getOutput() -> vec4f {
	outPos = outPos * uniform.outBoundsMul + uniform.outBoundsAdd;
	outAngle = fract(outAngle / PI2);
	outVel = (outVel / uniform.maxVel) + vec3f(0.5);
	let maxNegLife = max(uniform.lifetime, (uniform.numParticles - 1.0) * (uniform.rate + uniform.rateDiv));
	let maxPosLife = uniform.lifetime + 1.0;
	outLife = (outLife + maxNegLife) / (maxNegLife + maxPosLife);
	if (pcPosition.y < 1.0) {
		return vec4f(encodeFloatRG(outPos.x), encodeFloatRG(outPos.y));
	} else if (pcPosition.y < 2.0) {
		return vec4f(encodeFloatRG(outPos.z), encodeFloatRG(outAngle));
	} else if (pcPosition.y < 3.0) {
		return vec4f(outVel, visMode * 0.5 + 0.5);
	} else {
		return encodeFloatRGBA(outLife);
	}
}
`,qAe=`
uniform spawnBounds: mat3x3f;
uniform spawnPosInnerRatio: vec3f;
fn calcSpawnPosition(inBounds: vec3f, rndFactor: f32) -> vec3f {
	var pos = inBounds - vec3f(0.5);
	let posAbs = abs(pos);
	let maxComp = max(posAbs.x, max(posAbs.y, posAbs.z));
	let maxPos = vec3f(maxComp);
	let edge = maxPos + (vec3f(0.5) - maxPos) * uniform.spawnPosInnerRatio;
	pos.x = edge.x * select(2.0 * pos.x, sign(pos.x), maxPos.x == posAbs.x);
	pos.y = edge.y * select(2.0 * pos.y, sign(pos.y), maxPos.y == posAbs.y);
	pos.z = edge.z * select(2.0 * pos.z, sign(pos.z), maxPos.z == posAbs.z);
	#ifndef LOCAL_SPACE
		return uniform.emitterPos + uniform.spawnBounds * pos;
	#else
		return uniform.spawnBounds * pos;
	#endif
}
fn addInitialVelocity(localVelocity: ptr<function, vec3f>, inBounds: vec3f) {
	*localVelocity = *localVelocity - vec3f(0.0, 0.0, uniform.initialVelocity);
}
`,YAe=`
	output.color = getOutput();
	return output;
}
`,KAe=`
varying vUv0: vec2f;
var particleTexIN: texture_2d<f32>;
var particleTexINSampler: sampler;
var internalTex0: texture_2d<f32>;
var internalTex0Sampler: sampler;
var internalTex1: texture_2d<f32>;
var internalTex1Sampler: sampler;
var internalTex2: texture_2d<f32>;
var internalTex2Sampler: sampler;
var internalTex3: texture_2d<f32>;
var internalTex3Sampler: sampler;
uniform emitterMatrix: mat3x3f;
uniform emitterMatrixInv: mat3x3f;
uniform emitterScale: vec3f;
uniform emitterPos: vec3f;
uniform frameRandom: vec3f;
uniform localVelocityDivMult: vec3f;
uniform velocityDivMult: vec3f;
uniform delta: f32;
uniform rate: f32;
uniform rateDiv: f32;
uniform lifetime: f32;
uniform numParticles: f32;
uniform rotSpeedDivMult: f32;
uniform radialSpeedDivMult: f32;
uniform seed: f32;
uniform startAngle: f32;
uniform startAngle2: f32;
uniform initialVelocity: f32;
uniform graphSampleSize: f32;
uniform graphNumSamples: f32;
var<private> inPos: vec3f;
var<private> inVel: vec3f;
var<private> inAngle: f32;
var<private> inShow: bool;
var<private> inLife: f32;
var<private> visMode: f32;
var<private> outPos: vec3f;
var<private> outVel: vec3f;
var<private> outAngle: f32;
var<private> outShow: bool;
var<private> outLife: f32;
`,ZAe=`
	if (outLife >= uniform.lifetime) {
		outLife = outLife - max(uniform.lifetime, (uniform.numParticles - 1.0) * particleRate);
		visMode = -1.0;
	}
`,QAe=`
	visMode = select(visMode, -1.0, outLife < 0.0);
`,JAe=`
	if (outLife >= uniform.lifetime) {
		let subtractAmount = max(uniform.lifetime, (uniform.numParticles - 1.0) * particleRate);
		outLife = outLife - subtractAmount;
		visMode = 1.0;
	}
	visMode = select(visMode, 1.0, outLife < 0.0);
`,e1e=`
uniform spawnBoundsSphere: f32;
uniform spawnBoundsSphereInnerRatio: f32;
fn calcSpawnPosition(inBounds: vec3f, rndFactor: f32) -> vec3f {
	let rnd4: f32 = fract(rndFactor * 1000.0);
	let norm: vec3f = normalize(inBounds.xyz - vec3f(0.5));
	let r: f32 = rnd4 * (1.0 - uniform.spawnBoundsSphereInnerRatio) + uniform.spawnBoundsSphereInnerRatio;
	#ifndef LOCAL_SPACE
		return uniform.emitterPos + norm * r * uniform.spawnBoundsSphere;
	#else
		return norm * r * uniform.spawnBoundsSphere;
	#endif
}
fn addInitialVelocity(localVelocity: ptr<function, vec3f>, inBounds: vec3f) {
	let initialVelOffset: vec3f = normalize(inBounds - vec3f(0.5)) * uniform.initialVelocity;
	*localVelocity = *localVelocity + initialVelOffset;
}
`,t1e=`
fn saturate(x: f32) -> f32 {
	return clamp(x, 0.0, 1.0);
}
fn unpack3NFloats(src: f32) -> vec3f {
	let r = fract(src);
	let g = fract(src * 256.0);
	let b = fract(src * 65536.0);
	return vec3f(r, g, b);
}
struct TexLerpUnpackResult {
	result: vec3f,
	unpacked: vec3f
}
fn tex1Dlod_lerp(tex: texture_2d<f32>, texSampler: sampler, tc: vec2f) -> TexLerpUnpackResult {
	let tc_next = tc + vec2f(uniform.graphSampleSize);
	let a = textureSampleLevel(tex, texSampler, tc, 0.0);
	let b = textureSampleLevel(tex, texSampler, tc_next, 0.0);
	let c = fract(tc.x * uniform.graphNumSamples);
	let unpackedA = unpack3NFloats(a.w);
	let unpackedB = unpack3NFloats(b.w);
	let w_out = mix(unpackedA, unpackedB, c);
	return TexLerpUnpackResult(mix(a.xyz, b.xyz, c), w_out);
}
const HASHSCALE4: vec4f = vec4f(1031.0, 0.1030, 0.0973, 0.1099);
fn hash41(p: f32) -> vec4f {
	var p4 = fract(vec4f(p) * HASHSCALE4);
	p4 = p4 + dot(p4, p4.wzxy + 19.19);
	return fract(vec4f((p4.x + p4.y)*p4.z, (p4.x + p4.z)*p4.y, (p4.y + p4.z)*p4.w, (p4.z + p4.w)*p4.x));
}
@fragment
fn fragmentMain(input : FragmentInput) -> FragmentOutput {
	var output: FragmentOutput;
	if (pcPosition.x > uniform.numParticles) {
		discard;
		return output;
	}
	readInput(input.vUv0.x);
	visMode = select(-1.0, 1.0, inShow);
	let rndFactor = hash41(pcPosition.x + uniform.seed);
	let particleRate = uniform.rate + uniform.rateDiv * rndFactor.x;
	outLife = inLife + uniform.delta;
	let nlife = clamp(outLife / uniform.lifetime, 0.0, 1.0);
	let lerpResult0 = tex1Dlod_lerp(internalTex0, internalTex0Sampler, vec2f(nlife, 0.0));
	var localVelocity = lerpResult0.result;
	let localVelocityDiv = lerpResult0.unpacked;
	let lerpResult1 = tex1Dlod_lerp(internalTex1, internalTex1Sampler, vec2f(nlife, 0.0));
	var velocity = lerpResult1.result;
	let velocityDiv = lerpResult1.unpacked;
	let lerpResult2 = tex1Dlod_lerp(internalTex2, internalTex2Sampler, vec2f(nlife, 0.0));
	let params = lerpResult2.result;
	let paramDiv = lerpResult2.unpacked;
	var rotSpeed = params.x;
	let rotSpeedDiv = paramDiv.y;
	let lerpResult3 = tex1Dlod_lerp(internalTex3, internalTex3Sampler, vec2f(nlife, 0.0));
	let radialParams = lerpResult3.result;
	let radialParamDiv = lerpResult3.unpacked;
	let radialSpeed = radialParams.x;
	let radialSpeedDiv = radialParamDiv.y;
	let respawn = inLife <= 0.0 || outLife >= uniform.lifetime;
	inPos = select(inPos, calcSpawnPosition(rndFactor.xyz, rndFactor.x), respawn);
	inAngle = select(inAngle, mix(uniform.startAngle, uniform.startAngle2, rndFactor.x), respawn);
	#ifndef LOCAL_SPACE
		var radialVel: vec3f = inPos - uniform.emitterPos;
	#else
		var radialVel: vec3f = inPos;
	#endif
	radialVel = select(vec3f(0.0), radialSpeed * normalize(radialVel), dot(radialVel, radialVel) > 1.0E-8);
	radialVel = radialVel + (radialSpeedDiv * vec3f(2.0) - vec3f(1.0)) * uniform.radialSpeedDivMult * rndFactor.xyz;
	localVelocity = localVelocity + (localVelocityDiv * vec3f(2.0) - vec3f(1.0)) * uniform.localVelocityDivMult * rndFactor.xyz;
	velocity = velocity + (velocityDiv * vec3f(2.0) - vec3f(1.0)) * uniform.velocityDivMult * rndFactor.xyz;
	rotSpeed = rotSpeed + (rotSpeedDiv * 2.0 - 1.0) * uniform.rotSpeedDivMult * rndFactor.y;
	addInitialVelocity(&localVelocity, rndFactor.xyz);
	#ifndef LOCAL_SPACE
		outVel = uniform.emitterMatrix * localVelocity + (radialVel + velocity) * uniform.emitterScale;
	#else
		outVel = (localVelocity + radialVel) / uniform.emitterScale + uniform.emitterMatrixInv * velocity;
	#endif
	outPos = inPos + outVel * uniform.delta;
	outAngle = inAngle + rotSpeed * uniform.delta;
`,i1e=`
	let rotationResult = rotateWithMatrix(quadXY, inAngle);
	let rotatedQuadXY = rotationResult.rotatedVec;
	rotMatrix = rotationResult.matrix;
	var localPos = billboard(particlePos, rotatedQuadXY);
`,r1e=`
	dBlendModeFogFactor = 0.0;
	rgb = rgb * saturate(gammaCorrectInput(max(a, 0.0)));
	if ((rgb.r + rgb.g + rgb.b) < 0.000001) {
		discard;
	}	
`,s1e=`
	rgb = mix(vec3f(1.0), rgb, a);
	if ((rgb.r + rgb.g + rgb.b) > 2.99) {
		discard;
	}
`,n1e=`
	if (a < 0.01) {
		discard;
	}
`,a1e=`
attribute particle_vertexData: vec4f;
attribute particle_vertexData2: vec4f;
attribute particle_vertexData3: vec4f;
attribute particle_vertexData4: f32;
#ifndef USE_MESH
	attribute particle_vertexData5: vec2f;
#else
	attribute particle_vertexData5: vec4f;
#endif
uniform matrix_viewProjection: mat4x4f;
uniform matrix_model: mat4x4f;
#ifndef VIEWMATRIX
	#define VIEWMATRIX
	uniform matrix_view: mat4x4f;
#endif
uniform matrix_normal: mat3x3f;
uniform matrix_viewInverse: mat4x4f;
uniform numParticles: f32;
uniform lifetime: f32;
uniform stretch: f32;
uniform seed: f32;
uniform wrapBounds: vec3f;
uniform emitterScale: vec3f;
uniform faceTangent: vec3f;
uniform faceBinorm: vec3f;
#ifdef PARTICLE_GPU
	var internalTex0: texture_2d<f32>;
	var internalTex0Sampler: sampler;
	var internalTex1: texture_2d<f32>;
	var internalTex1Sampler: sampler;
	var internalTex2: texture_2d<f32>;
	var internalTex2Sampler: sampler;
#endif
uniform emitterPos: vec3f;
varying texCoordsAlphaLife: vec4f;
struct RotateResult {
	rotatedVec: vec2f,
	matrix: mat2x2f
}
fn rotateWithMatrix(quadXY: vec2f, pRotation: f32) -> RotateResult {
	let c = cos(pRotation);
	let s = sin(pRotation);
	let m = mat2x2f(vec2f(c, s), vec2f(-s, c));
	return RotateResult(m * quadXY, m);
}
fn billboard(InstanceCoords: vec3f, quadXY: vec2f) -> vec3f {
	let pos = -uniform.matrix_viewInverse[0].xyz * quadXY.x + -uniform.matrix_viewInverse[1].xyz * quadXY.y;
	return pos;
}
fn customFace(InstanceCoords: vec3f, quadXY: vec2f) -> vec3f {
	let pos = uniform.faceTangent * quadXY.x + uniform.faceBinorm * quadXY.y;
	return pos;
}
@vertex
fn vertexMain(input: VertexInput) -> VertexOutput {
	var output: VertexOutput;
	var particlePos = input.particle_vertexData.xyz;
	let inPos = particlePos;
	let vertPos = input.particle_vertexData3.xyz;
	var inVel = vec3f(input.particle_vertexData2.w, input.particle_vertexData3.w, input.particle_vertexData5.x);
	let id = floor(input.particle_vertexData4);
	let rndFactor = fract(sin(id + 1.0 + uniform.seed));
	let rndFactor3 = vec3f(rndFactor, fract(rndFactor*10.0), fract(rndFactor*100.0));
	#ifdef LOCAL_SPACE
		let modelRotation = mat3x3f(uniform.matrix_model[0].xyz, uniform.matrix_model[1].xyz, uniform.matrix_model[2].xyz);
		inVel = modelRotation * inVel;
	#endif
	let velocityV = safeNormalize((mat3x3f(uniform.matrix_view[0].xyz, uniform.matrix_view[1].xyz, uniform.matrix_view[2].xyz) * inVel).xy);
	let quadXY = vertPos.xy;
	#ifdef USE_MESH
		output.texCoordsAlphaLife = vec4f(input.particle_vertexData5.zw, input.particle_vertexData2.z, input.particle_vertexData.w);
	#else
		output.texCoordsAlphaLife = vec4f(quadXY * -0.5 + 0.5, input.particle_vertexData2.z, input.particle_vertexData.w);
	#endif
	var rotMatrix: mat2x2f;
	let inAngle = input.particle_vertexData2.x;
	var particlePosMoved = vec3f(0.0);
	let meshLocalPos = input.particle_vertexData3.xyz;
`,o1e=`
	localPos = localPos * input.particle_vertexData2.y * emitterScale;
	localPos = localPos + particlePos;
	output.position = uniform.matrix_viewProjection * vec4f(localPos, 1.0);
`,l1e=`
	let rotationResult = rotateWithMatrix(quadXY, inAngle);
	let rotatedQuadXY = rotationResult.rotatedVec;
	rotMatrix = rotationResult.matrix;
	var localPos = customFace(particlePos, rotatedQuadXY);
`,c1e=`
	rgb = addFog(rgb);
	rgb = toneMap(rgb);
	rgb = gammaCorrectOutput(rgb);
	output.color = vec4f(rgb, a);
	return output;
}
`,u1e=`
	localPos = localPos * scale * uniform.emitterScale;
	localPos = localPos + particlePos;
	#ifdef SCREEN_SPACE
		output.position = vec4f(localPos.x, localPos.y, 0.0, 1.0);
	#else
		output.position = uniform.matrix_viewProjection * vec4f(localPos.xyz, 1.0);
	#endif
`,h1e=`
	var negNormal: vec3f = normal * 0.5 + 0.5;
	var posNormal: vec3f = -normal * 0.5 + 0.5;
	negNormal = negNormal * negNormal;
	posNormal = posNormal * posNormal;
`,d1e=`
attribute particle_vertexData: vec4f;
#if defined(USE_MESH)
	#if defined(USE_MESH_UV)
		attribute particle_uv: vec2f;
	#else
		var<private> particle_uv: vec2f = vec2f(0.0, 0.0);
	#endif
#endif
uniform matrix_viewProjection: mat4x4f;
uniform matrix_model: mat4x4f;
uniform matrix_normal: mat3x3f;
uniform matrix_viewInverse: mat4x4f;
#ifndef VIEWMATRIX
	#define VIEWMATRIX
	uniform matrix_view: mat4x4f;
#endif
uniform numParticles: f32;
uniform numParticlesPot: f32;
uniform graphSampleSize: f32;
uniform graphNumSamples: f32;
uniform stretch: f32;
uniform wrapBounds: vec3f;
uniform emitterScale: vec3f;
uniform emitterPos: vec3f;
uniform faceTangent: vec3f;
uniform faceBinorm: vec3f;
uniform rate: f32;
uniform rateDiv: f32;
uniform lifetime: f32;
uniform deltaRandomnessStatic: f32;
uniform scaleDivMult: f32;
uniform alphaDivMult: f32;
uniform seed: f32;
uniform delta: f32;
var particleTexOUT: texture_2d<f32>;
var particleTexOUTSampler: sampler;
var particleTexIN: texture_2d<f32>;
var particleTexINSampler: sampler;
#ifdef PARTICLE_GPU
	var internalTex0: texture_2d<f32>;
	var internalTex0Sampler: sampler;
	var internalTex1: texture_2d<f32>;
	var internalTex1Sampler: sampler;
	var internalTex2: texture_2d<f32>;
	var internalTex2Sampler: sampler;
#endif
#ifndef CAMERAPLANES
	#define CAMERAPLANES
	uniform camera_params: vec4f;
#endif
varying texCoordsAlphaLife: vec4f;
var<private> inPos: vec3f;
var<private> inVel: vec3f;
var<private> inAngle: f32;
var<private> inShow: bool;
var<private> inLife: f32;
`,f1e=`
	var negNormal: vec3f = max(normal, vec3(0.0));
	var posNormal: vec3f = max(-normal, vec3(0.0));
`,p1e=`
	let light: vec3f = negNormal.x * uniform.lightCube[0] + posNormal.x * uniform.lightCube[1] +
					   negNormal.y * uniform.lightCube[2] + posNormal.y * uniform.lightCube[3] +
					   negNormal.z * uniform.lightCube[4] + posNormal.z * uniform.lightCube[5];
	rgb = rgb * light;
`,m1e=`
particlePos = (uniform.matrix_model * vec4f(particlePos, 1.0)).xyz;
`,g1e=`
var localPos = meshLocalPos;
let rotResultXY = rotateWithMatrix(localPos.xy, inAngle);
localPos = vec3f(rotResultXY.rotatedVec, localPos.z);
rotMatrix = rotResultXY.matrix;
let rotResultYZ = rotateWithMatrix(localPos.yz, inAngle);
localPos = vec3f(localPos.x, rotResultYZ.rotatedVec);
rotMatrix = rotResultYZ.matrix;
billboard(particlePos, quadXY);
`,_1e=`
output.Normal = normalize(localPos + uniform.matrix_viewInverse[2].xyz);
`,v1e=`
	let sampledNormal: vec4f = textureSample(normalMap, normalMapSampler, vec2f(input.texCoordsAlphaLife.x, 1.0 - input.texCoordsAlphaLife.y));
	let normalMap: vec3f = normalize(sampledNormal.xyz * 2.0 - 1.0);
	let ParticleMat = mat3x3<f32>(ParticleMat0, ParticleMat1, ParticleMat2);
	let normal: vec3f = ParticleMat * normalMap;
`,y1e=`
	inAngle = atan2(velocityV.x, velocityV.y);
`,S1e=`
	#include "particleUpdaterInitPS"
	#ifdef PACK8
		#include "particleInputRgba8PS"
		#include "particleOutputRgba8PS"
	#else
		#include "particleInputFloatPS"
		#include "particleOutputFloatPS"
	#endif
	#ifdef EMITTERSHAPE_BOX
		#include "particleUpdaterAABBPS"
	#else
		#include "particleUpdaterSpherePS"
	#endif
	#include "particleUpdaterStartPS"
	#ifdef RESPAWN
		#include "particleUpdaterRespawnPS"
	#endif
	#ifdef NO_RESPAWN
		#include "particleUpdaterNoRespawnPS"
	#endif
	#ifdef ON_STOP
		#include "particleUpdaterOnStopPS"
	#endif
	#include "particleUpdaterEndPS"
`,x1e=`
	#if NORMAL != NONE
		#if NORMAL == VERTEX
			varying Normal: vec3f;
		#endif
		#if NORMAL == MAP
			varying ParticleMat0: vec3f;
			varying ParticleMat1: vec3f;
			varying ParticleMat2: vec3f;
		#endif
		uniform lightCube: array<vec3f, 6>;
	#endif
	#ifdef SOFT
		varying vDepth: f32;
		#include "screenDepthPS"
	#endif
	#include "gammaPS"
	#include "tonemappingPS"
	#include "fogPS"
	#if NORMAL == MAP
		var normalMap: texture_2d<f32>;
		var normalMapSampler: sampler;
	#endif
	#include "particlePS"
	#ifdef SOFT
		#include "particle_softPS"
	#endif
	#if NORMAL == VERTEX
		var normal: vec3f = Normal;
	#endif
	#if NORMAL == MAP
		#include "particle_normalMapPS"
	#endif
	#if NORMAL != NONE
		#ifdef HALF_LAMBERT
			#include "particle_halflambertPS"
		#else
			#include "particle_lambertPS"
		#endif
		#include "particle_lightingPS"
	#endif
	#if BLEND == NORMAL
		#include "particle_blendNormalPS"
	#elif BLEND == ADDITIVE
		#include "particle_blendAddPS"
	#elif BLEND == MULTIPLICATIVE
		#include "particle_blendMultiplyPS"
	#endif
	#include "particle_endPS"
`,b1e=`
	#ifdef ANIMTEX
		uniform animTexTilesParams: vec2f;
		uniform animTexParams: vec4f;
		uniform animTexIndexParams: vec2f;
	#endif
	#if NORMAL == MAP
		varying ParticleMat0: vec3f;
		varying ParticleMat1: vec3f;
		varying ParticleMat2: vec3f;
	#endif
	#if NORMAL == VERTEX
		varying Normal: vec3f;
	#endif
	#ifdef SOFT
		varying vDepth: f32;
	#endif
	#ifdef PARTICLE_GPU
		#include "particle_initVS"
		#ifdef PACK8
			#include "particleInputRgba8PS"
		#else
			#include  "particleInputFloatPS"
		#endif
		#ifdef SOFT
			#include "screenDepthPS"
		#endif
		#include "particleVS"
	#else
		#ifdef SOFT
			#include "screenDepthPS"
		#endif
		#include "particle_cpuVS"
	#endif
	#ifdef LOCAL_SPACE
		#include "particle_localShiftVS"
	#endif
	#ifdef ANIMTEX
		#ifdef ANIMTEX_LOOP
			#include "particleAnimFrameLoopVS"
		#else
			#include "particleAnimFrameClampVS"
		#endif
		#include "particleAnimTexVS"
	#endif
	#ifdef PARTICLE_GPU
		#ifdef WRAP
			#include "particle_wrapVS"
		#endif
	#endif
	#ifdef ALIGN_TO_MOTION
		#include "particle_pointAlongVS"
	#endif
	#ifdef USE_MESH
		#include "particle_meshVS"
	#else
		#ifdef CUSTOM_FACE
			#include "particle_customFaceVS"
		#else
			#include "particle_billboardVS"
		#endif
	#endif
	#if NORMAL == VERTEX
		#include "particle_normalVS"
	#endif
	#if NORMAL == MAP
		#include "particle_TBNVS"
	#endif
	#ifdef STRETCH
		#include "particle_stretchVS"
	#endif
	#ifdef PARTICLE_GPU
		#include "particle_endVS"
	#else
		#include "particle_cpu_endVS"
	#endif
	#ifdef SOFT
		#include "particle_softVS"
	#endif
	return output;
}
`,w1e=`
	var depth: f32 = getLinearScreenDepthFrag();
	var particleDepth: f32 = vDepth;
	var depthDiff: f32 = saturate(abs(particleDepth - depth) * uniform.softening);
	a = a * depthDiff;
`,T1e=`
	output.vDepth = getLinearDepth(localPos);
`,E1e=`
	let moveDir: vec3f = inVel * uniform.stretch;
	var posPrev: vec3f = particlePos - moveDir;
	posPrev = posPrev + particlePosMoved;
	let viewRotationTemp: mat3x3f = mat3x3f(uniform.matrix_view[0].xyz, uniform.matrix_view[1].xyz, uniform.matrix_view[2].xyz);
	let centerToVertexV: vec2f = normalize((viewRotationTemp * localPos).xy);
	let interpolation: f32 = dot(-velocityV, centerToVertexV) * 0.5 + 0.5;
	particlePos = mix(particlePos, posPrev, interpolation);
`,A1e=`
	let rot3 = mat3x3f(
		vec3f(rotMatrix[0][0], rotMatrix[1][0], 0.0),
		vec3f(rotMatrix[0][1], rotMatrix[1][1], 0.0),
		vec3f(0.0, 0.0, 1.0)
	);
	let viewBasis = mat3x3f(
		-uniform.matrix_viewInverse[0].xyz,
		-uniform.matrix_viewInverse[1].xyz,
		uniform.matrix_viewInverse[2].xyz
	);
	let tempMat = viewBasis * rot3;
	output.ParticleMat0 = tempMat[0];
	output.ParticleMat1 = tempMat[1];
	output.ParticleMat2 = tempMat[2];
`,C1e=`
	let origParticlePos: vec3f = particlePos;
	particlePos = particlePos - uniform.matrix_model[3].xyz;
	particlePos = (particlePos % uniform.wrapBounds) - uniform.wrapBounds * 0.5;
	particlePos = particlePos + uniform.matrix_model[3].xyz;
	particlePosMoved = particlePos - origParticlePos;
`;const P1e={particlePS:UAe,particleVS:zAe,particleAnimFrameClampVS:VAe,particleAnimFrameLoopVS:jAe,particleAnimTexVS:$Ae,particleInputFloatPS:HAe,particleInputRgba8PS:GAe,particleOutputFloatPS:WAe,particleOutputRgba8PS:XAe,particleUpdaterAABBPS:qAe,particleUpdaterEndPS:YAe,particleUpdaterInitPS:KAe,particleUpdaterNoRespawnPS:ZAe,particleUpdaterOnStopPS:QAe,particleUpdaterRespawnPS:JAe,particleUpdaterSpherePS:e1e,particleUpdaterStartPS:t1e,particle_billboardVS:i1e,particle_blendAddPS:r1e,particle_blendMultiplyPS:s1e,particle_blendNormalPS:n1e,particle_cpuVS:a1e,particle_cpu_endVS:o1e,particle_customFaceVS:l1e,particle_endPS:c1e,particle_endVS:u1e,particle_halflambertPS:h1e,particle_initVS:d1e,particle_lambertPS:f1e,particle_lightingPS:p1e,particle_localShiftVS:m1e,particle_meshVS:g1e,particle_normalVS:_1e,particle_normalMapPS:v1e,particle_pointAlongVS:y1e,particle_simulationPS:S1e,particle_shaderPS:x1e,particle_shaderVS:b1e,particle_softPS:w1e,particle_softVS:T1e,particle_stretchVS:E1e,particle_TBNVS:A1e,particle_wrapVS:C1e},I1e=["enabled","autoPlay","numParticles","lifetime","rate","rate2","startAngle","startAngle2","loop","preWarm","lighting","halfLambert","intensity","depthWrite","noFog","depthSoftening","sort","blendType","stretch","alignToMotion","emitterShape","emitterExtents","emitterExtentsInner","emitterRadius","emitterRadiusInner","initialVelocity","wrap","wrapBounds","localSpace","screenSpace","colorMapAsset","normalMapAsset","mesh","meshAsset","renderAsset","orientation","particleNormal","localVelocityGraph","localVelocityGraph2","velocityGraph","velocityGraph2","rotationSpeedGraph","rotationSpeedGraph2","radialSpeedGraph","radialSpeedGraph2","scaleGraph","scaleGraph2","colorGraph","colorGraph2","alphaGraph","alphaGraph2","colorMap","normalMap","animTilesX","animTilesY","animStartFrame","animNumFrames","animNumAnimations","animIndex","randomizeAnimIndex","animSpeed","animLoop","layers"];class M1e extends si{constructor(e){super(e),this.id="particlesystem",this.ComponentType=XEe,this.DataType=qEe,this.schema=I1e,this.propertyTypes={emitterExtents:"vec3",emitterExtentsInner:"vec3",particleNormal:"vec3",wrapBounds:"vec3",localVelocityGraph:"curveset",localVelocityGraph2:"curveset",velocityGraph:"curveset",velocityGraph2:"curveset",colorGraph:"curveset",colorGraph2:"curveset",alphaGraph:"curve",alphaGraph2:"curve",rotationSpeedGraph:"curve",rotationSpeedGraph2:"curve",radialSpeedGraph:"curve",radialSpeedGraph2:"curve",scaleGraph:"curve",scaleGraph2:"curve"},this.on("beforeremove",this.onBeforeRemove,this),this.app.systems.on("update",this.onUpdate,this),$e.get(e.graphicsDevice,dt).add(BAe),$e.get(e.graphicsDevice,Gt).add(P1e)}initializeComponentData(e,t,i){const s={};i=[];const n=this.propertyTypes;(t.mesh instanceof be||typeof t.mesh=="number")&&(t.meshAsset=t.mesh,delete t.mesh);for(const a in t){if(t.hasOwnProperty(a)&&(i.push(a),s[a]=t[a]),n[a]==="vec3")Array.isArray(s[a])&&(s[a]=new O(s[a][0],s[a][1],s[a][2]));else if(n[a]==="curve"){if(!(s[a]instanceof jn)){const o=s[a].type;s[a]=new jn(s[a].keys),s[a].type=o}}else if(n[a]==="curveset"&&!(s[a]instanceof Uu)){const o=s[a].type;s[a]=new Uu(s[a].keys),s[a].type=o}s.layers&&Array.isArray(s.layers)&&(s.layers=s.layers.slice(0))}super.initializeComponentData(e,s,i)}cloneComponent(e,t){const i=e.particlesystem.data,s=this.schema,n={};for(let a=0,o=s.length;a<o;a++){const l=s[a];let c=i[l];c instanceof O||c instanceof jn||c instanceof Uu?(c=c.clone(),n[l]=c):l==="layers"?n.layers=i.layers.slice(0):c!=null&&(n[l]=c)}return this.addComponent(t,n)}onUpdate(e){const t=this.store,i=this.app.stats.particles,s=this.app.scene.layers;for(let n=0;n<s.layerList.length;n++)s.layerList[n].requiresLightCube=!1;for(const n in t)if(t.hasOwnProperty(n)){const a=t[n],o=a.entity,l=a.data;if(l.enabled&&o.enabled){const c=o.particlesystem.emitter;if(!(c!=null&&c.meshInstance.visible))continue;if(c.lighting){const u=l.layers;for(let h=0;h<u.length;h++){const d=s.getLayerById(u[h]);d&&(d.requiresLightCube=!0)}}if(!l.paused){let u=0;if(c.simTime+=e,c.simTime>=c.fixedTimeStep&&(u=Math.floor(c.simTime/c.fixedTimeStep),c.simTime-=u*c.fixedTimeStep),u){u=Math.min(u,c.maxSubSteps);for(let h=0;h<u;h++)c.addTime(c.fixedTimeStep,!1);i._updatesPerFrame+=u,i._frameTime+=c._addTimeTime,c._addTimeTime=0}c.finishFrame()}}}}onBeforeRemove(e,t){t.onBeforeRemove()}destroy(){super.destroy(),this.app.systems.off("update",this.onUpdate,this)}}class R1e extends DE{constructor(e,t){super(),this.skin=e,this.skinInstance=t}}const fa=class fa{static createCachedSkinInstance(e,t,i){let s=fa.getCachedSkinInstance(e,t);return s||(s=new Cy(e),s.resolve(t,i),fa.addCachedSkinInstance(e,t,s)),s}static getCachedSkinInstance(e,t){let i=null;const s=fa._skinInstanceCache.get(t);if(s){const n=s.find(a=>a.skin===e);n&&(n.incRefCount(),i=n.skinInstance)}return i}static addCachedSkinInstance(e,t,i){let s=fa._skinInstanceCache.get(t);s||(s=[],fa._skinInstanceCache.set(t,s));let n=s.find(a=>a.skin===e);n||(n=new R1e(e,i),s.push(n)),n.incRefCount()}static removeCachedSkinInstance(e){if(e){const t=e.rootBone;if(t){const i=fa._skinInstanceCache.get(t);if(i){const s=i.findIndex(n=>n.skinInstance===e);if(s>=0){const n=i[s];n.decRefCount(),n.refCount===0&&(i.splice(s,1),i.length||fa._skinInstanceCache.delete(t),e&&(e.destroy(),n.skinInstance=null))}}}}}};fa._skinInstanceCache=new Map;let ov=fa;class lv{constructor(e,t,i,s,n){this._evtLoadById=null,this._evtUnloadById=null,this._evtAddById=null,this._evtRemoveById=null,this._evtLoadByUrl=null,this._evtAddByUrl=null,this._evtRemoveByUrl=null,this.propertyName=e,this.parent=t,this._scope=n,this._registry=i,this.id=null,this.url=null,this.asset=null,this._onAssetLoad=s.load,this._onAssetAdd=s.add,this._onAssetRemove=s.remove,this._onAssetUnload=s.unload}set id(e){if(this.url)throw Error("Can't set id and url");this._unbind(),this._id=e,this.asset=this._registry.get(this._id),this._bind()}get id(){return this._id}set url(e){if(this.id)throw Error("Can't set id and url");this._unbind(),this._url=e,this.asset=this._registry.getByUrl(this._url),this._bind()}get url(){return this._url}_bind(){this.id&&(this._onAssetLoad&&(this._evtLoadById=this._registry.on(`load:${this.id}`,this._onLoad,this)),this._onAssetAdd&&(this._evtAddById=this._registry.once(`add:${this.id}`,this._onAdd,this)),this._onAssetRemove&&(this._evtRemoveById=this._registry.on(`remove:${this.id}`,this._onRemove,this)),this._onAssetUnload&&(this._evtUnloadById=this._registry.on(`unload:${this.id}`,this._onUnload,this))),this.url&&(this._onAssetLoad&&(this._evtLoadByUrl=this._registry.on(`load:url:${this.url}`,this._onLoad,this)),this._onAssetAdd&&(this._evtAddByUrl=this._registry.once(`add:url:${this.url}`,this._onAdd,this)),this._onAssetRemove&&(this._evtRemoveByUrl=this._registry.on(`remove:url:${this.url}`,this._onRemove,this)))}_unbind(){var e,t,i,s,n,a,o;this.id&&((e=this._evtLoadById)==null||e.off(),this._evtLoadById=null,(t=this._evtAddById)==null||t.off(),this._evtAddById=null,(i=this._evtRemoveById)==null||i.off(),this._evtRemoveById=null,(s=this._evtUnloadById)==null||s.off(),this._evtUnloadById=null),this.url&&((n=this._evtLoadByUrl)==null||n.off(),this._evtLoadByUrl=null,(a=this._evtAddByUrl)==null||a.off(),this._evtAddByUrl=null,(o=this._evtRemoveByUrl)==null||o.off(),this._evtRemoveByUrl=null)}_onLoad(e){this._onAssetLoad.call(this._scope,this.propertyName,this.parent,e)}_onAdd(e){this.asset=e,this._onAssetAdd.call(this._scope,this.propertyName,this.parent,e)}_onRemove(e){this._onAssetRemove.call(this._scope,this.propertyName,this.parent,e),this.asset=null}_onUnload(e){this._onAssetUnload.call(this._scope,this.propertyName,this.parent,e)}}class wY extends ke{constructor(e,t){super(e,t),this._type="asset",this._castShadows=!0,this._receiveShadows=!0,this._castShadowsLightmap=!0,this._lightmapped=!1,this._lightmapSizeMultiplier=1,this.isStatic=!1,this._batchGroupId=-1,this._layers=[nl],this._renderStyle=qg,this._meshInstances=[],this._customAabb=null,this._area=null,this._materialReferences=[],this._rootBone=null,this._evtLayersChanged=null,this._evtLayerAdded=null,this._evtLayerRemoved=null,this._evtSetMeshes=null,this._assetReference=new lv("asset",this,e.app.assets,{add:this._onRenderAssetAdded,load:this._onRenderAssetLoad,remove:this._onRenderAssetRemove,unload:this._onRenderAssetUnload},this),this._material=e.defaultMaterial,t.on("remove",this.onRemoveChild,this),t.on("removehierarchy",this.onRemoveChild,this),t.on("insert",this.onInsertChild,this),t.on("inserthierarchy",this.onInsertChild,this)}set renderStyle(e){this._renderStyle!==e&&(this._renderStyle=e,Dt._prepareRenderStyleForArray(this._meshInstances,e))}get renderStyle(){return this._renderStyle}set customAabb(e){this._customAabb=e;const t=this._meshInstances;if(t)for(let i=0;i<t.length;i++)t[i].setCustomAabb(this._customAabb)}get customAabb(){return this._customAabb}set type(e){if(this._type!==e&&(this._area=null,this._type=e,this.destroyMeshInstances(),e!=="asset")){let t=this._material;(!t||t===this.system.defaultMaterial)&&(t=this._materialReferences[0]&&this._materialReferences[0].asset&&this._materialReferences[0].asset.resource);const i=SY(this.system.app.graphicsDevice,e);this._area=i.area,this.meshInstances=[new Dt(i.mesh,t||this.system.defaultMaterial,this.entity)]}}get type(){return this._type}set meshInstances(e){if(this.destroyMeshInstances(),this._meshInstances=e,this._meshInstances){const t=this._meshInstances;for(let i=0;i<t.length;i++)t[i].node||(t[i].node=this.entity),t[i].castShadow=this._castShadows,t[i].receiveShadow=this._receiveShadows,t[i].renderStyle=this._renderStyle,t[i].setLightmapped(this._lightmapped),t[i].setCustomAabb(this._customAabb);this.enabled&&this.entity.enabled&&this.addToLayers()}}get meshInstances(){return this._meshInstances}set lightmapped(e){if(e!==this._lightmapped){this._lightmapped=e;const t=this._meshInstances;if(t)for(let i=0;i<t.length;i++)t[i].setLightmapped(e)}}get lightmapped(){return this._lightmapped}set castShadows(e){if(this._castShadows!==e){const t=this._meshInstances;if(t){const i=this.layers,s=this.system.app.scene;if(this._castShadows&&!e)for(let n=0;n<i.length;n++){const a=s.layers.getLayerById(this.layers[n]);a&&a.removeShadowCasters(t)}for(let n=0;n<t.length;n++)t[n].castShadow=e;if(!this._castShadows&&e)for(let n=0;n<i.length;n++){const a=s.layers.getLayerById(i[n]);a&&a.addShadowCasters(t)}}this._castShadows=e}}get castShadows(){return this._castShadows}set receiveShadows(e){if(this._receiveShadows!==e){this._receiveShadows=e;const t=this._meshInstances;if(t)for(let i=0;i<t.length;i++)t[i].receiveShadow=e}}get receiveShadows(){return this._receiveShadows}set castShadowsLightmap(e){this._castShadowsLightmap=e}get castShadowsLightmap(){return this._castShadowsLightmap}set lightmapSizeMultiplier(e){this._lightmapSizeMultiplier=e}get lightmapSizeMultiplier(){return this._lightmapSizeMultiplier}set layers(e){const t=this.system.app.scene.layers;let i;if(this._meshInstances)for(let s=0;s<this._layers.length;s++)i=t.getLayerById(this._layers[s]),i&&i.removeMeshInstances(this._meshInstances);this._layers.length=0;for(let s=0;s<e.length;s++)this._layers[s]=e[s];if(!(!this.enabled||!this.entity.enabled||!this._meshInstances))for(let s=0;s<this._layers.length;s++)i=t.getLayerById(this._layers[s]),i&&i.addMeshInstances(this._meshInstances)}get layers(){return this._layers}set batchGroupId(e){var t,i;this._batchGroupId!==e&&(this.entity.enabled&&this._batchGroupId>=0&&((t=this.system.app.batcher)==null||t.remove(Bi.RENDER,this.batchGroupId,this.entity)),this.entity.enabled&&e>=0&&((i=this.system.app.batcher)==null||i.insert(Bi.RENDER,e,this.entity)),e<0&&this._batchGroupId>=0&&this.enabled&&this.entity.enabled&&this.addToLayers(),this._batchGroupId=e)}get batchGroupId(){return this._batchGroupId}set material(e){if(this._material!==e&&(this._material=e,this._meshInstances&&this._type!=="asset"))for(let t=0;t<this._meshInstances.length;t++)this._meshInstances[t].material=e}get material(){return this._material}set materialAssets(e=[]){if(this._materialReferences.length>e.length){for(let t=e.length;t<this._materialReferences.length;t++)this._materialReferences[t].id=null;this._materialReferences.length=e.length}for(let t=0;t<e.length;t++)if(this._materialReferences[t]||this._materialReferences.push(new lv(t,this,this.system.app.assets,{add:this._onMaterialAdded,load:this._onMaterialLoad,remove:this._onMaterialRemove,unload:this._onMaterialUnload},this)),e[t]){const i=e[t]instanceof be?e[t].id:e[t];this._materialReferences[t].id!==i&&(this._materialReferences[t].id=i),this._materialReferences[t].asset&&this._onMaterialAdded(t,this,this._materialReferences[t].asset)}else this._materialReferences[t].id=null,this._meshInstances[t]&&(this._meshInstances[t].material=this.system.defaultMaterial)}get materialAssets(){return this._materialReferences.map(e=>e.id)}set asset(e){const t=e instanceof be?e.id:e;this._assetReference.id!==t&&(this._assetReference.asset&&this._assetReference.asset.resource&&this._onRenderAssetRemove(),this._assetReference.id=t,this._assetReference.asset&&this._onRenderAssetAdded())}get asset(){return this._assetReference.id}assignAsset(e){const t=e instanceof be?e.id:e;this._assetReference.id=t}set rootBone(e){if(this._rootBone!==e){const t=typeof e=="string";if(this._rootBone&&t&&this._rootBone.getGuid()===e)return;this._rootBone&&this._clearSkinInstances(),e instanceof Xt?this._rootBone=e:t?(this._rootBone=this.system.app.getEntityFromIndex(e)||null,this._rootBone):this._rootBone=null,this._rootBone&&this._cloneSkinInstances()}}get rootBone(){return this._rootBone}destroyMeshInstances(){const e=this._meshInstances;if(e){this.removeFromLayers(),this._clearSkinInstances();for(let t=0;t<e.length;t++)e[t].destroy();this._meshInstances.length=0}}addToLayers(){const e=this.system.app.scene.layers;for(let t=0;t<this._layers.length;t++){const i=e.getLayerById(this._layers[t]);i&&i.addMeshInstances(this._meshInstances)}}removeFromLayers(){if(this._meshInstances&&this._meshInstances.length){const e=this.system.app.scene.layers;for(let t=0;t<this._layers.length;t++){const i=e.getLayerById(this._layers[t]);i&&i.removeMeshInstances(this._meshInstances)}}}onRemoveChild(){this.removeFromLayers()}onInsertChild(){this._meshInstances&&this.enabled&&this.entity.enabled&&this.addToLayers()}onRemove(){this.destroyMeshInstances(),this.asset=null,this.materialAsset=null,this._assetReference.id=null;for(let e=0;e<this._materialReferences.length;e++)this._materialReferences[e].id=null;this.entity.off("remove",this.onRemoveChild,this),this.entity.off("insert",this.onInsertChild,this)}onLayersChanged(e,t){this.addToLayers(),e.off("add",this.onLayerAdded,this),e.off("remove",this.onLayerRemoved,this),t.on("add",this.onLayerAdded,this),t.on("remove",this.onLayerRemoved,this)}onLayerAdded(e){this.layers.indexOf(e.id)<0||e.addMeshInstances(this._meshInstances)}onLayerRemoved(e){this.layers.indexOf(e.id)<0||e.removeMeshInstances(this._meshInstances)}onEnable(){var n;const e=this.system.app,t=e.scene,i=t.layers;this._rootBone&&this._cloneSkinInstances(),this._evtLayersChanged=t.on("set:layers",this.onLayersChanged,this),i&&(this._evtLayerAdded=i.on("add",this.onLayerAdded,this),this._evtLayerRemoved=i.on("remove",this.onLayerRemoved,this));const s=this._type==="asset";this._meshInstances&&this._meshInstances.length?this.addToLayers():s&&this.asset&&this._onRenderAssetAdded();for(let a=0;a<this._materialReferences.length;a++)this._materialReferences[a].asset&&this.system.app.assets.load(this._materialReferences[a].asset);this._batchGroupId>=0&&((n=e.batcher)==null||n.insert(Bi.RENDER,this.batchGroupId,this.entity))}onDisable(){var s,n,a,o;const e=this.system.app,i=e.scene.layers;(s=this._evtLayersChanged)==null||s.off(),this._evtLayersChanged=null,this._rootBone&&this._clearSkinInstances(),i&&((n=this._evtLayerAdded)==null||n.off(),this._evtLayerAdded=null,(a=this._evtLayerRemoved)==null||a.off(),this._evtLayerRemoved=null),this._batchGroupId>=0&&((o=e.batcher)==null||o.remove(Bi.RENDER,this.batchGroupId,this.entity)),this.removeFromLayers()}hide(){if(this._meshInstances)for(let e=0;e<this._meshInstances.length;e++)this._meshInstances[e].visible=!1}show(){if(this._meshInstances)for(let e=0;e<this._meshInstances.length;e++)this._meshInstances[e].visible=!0}_onRenderAssetAdded(){this._assetReference.asset&&(this._assetReference.asset.resource?this._onRenderAssetLoad():this.enabled&&this.entity.enabled&&this.system.app.assets.load(this._assetReference.asset))}_onRenderAssetLoad(){var e;if(this.destroyMeshInstances(),this._assetReference.asset){const t=this._assetReference.asset.resource;(e=this._evtSetMeshes)==null||e.off(),this._evtSetMeshes=t.on("set:meshes",this._onSetMeshes,this),t.meshes&&this._onSetMeshes(t.meshes)}}_onSetMeshes(e){this._cloneMeshes(e)}_clearSkinInstances(){for(let e=0;e<this._meshInstances.length;e++){const t=this._meshInstances[e];ov.removeCachedSkinInstance(t.skinInstance),t.skinInstance=null}}_cloneSkinInstances(){if(this._meshInstances.length&&this._rootBone instanceof Xt)for(let e=0;e<this._meshInstances.length;e++){const t=this._meshInstances[e],i=t.mesh;i.skin&&!t.skinInstance&&(t.skinInstance=ov.createCachedSkinInstance(i.skin,this._rootBone,this.entity))}}_cloneMeshes(e){if(e&&e.length){const t=[];for(let i=0;i<e.length;i++){const s=e[i],n=this._materialReferences[i]&&this._materialReferences[i].asset&&this._materialReferences[i].asset.resource,a=new Dt(s,n||this.system.defaultMaterial,this.entity);t.push(a),s.morph&&(a.morphInstance=new vh(s.morph))}this.meshInstances=t,this._cloneSkinInstances()}}_onRenderAssetUnload(){this._type==="asset"&&this.destroyMeshInstances()}_onRenderAssetRemove(){var e;(e=this._evtSetMeshes)==null||e.off(),this._evtSetMeshes=null,this._onRenderAssetUnload()}_onMaterialAdded(e,t,i){i.resource?this._onMaterialLoad(e,t,i):this.enabled&&this.entity.enabled&&this.system.app.assets.load(i)}_updateMainMaterial(e,t){e===0&&(this.material=t)}_onMaterialLoad(e,t,i){this._meshInstances[e]&&(this._meshInstances[e].material=i.resource),this._updateMainMaterial(e,i.resource)}_onMaterialRemove(e,t,i){this._meshInstances[e]&&(this._meshInstances[e].material=this.system.defaultMaterial),this._updateMainMaterial(e,this.system.defaultMaterial)}_onMaterialUnload(e,t,i){this._meshInstances[e]&&(this._meshInstances[e].material=this.system.defaultMaterial),this._updateMainMaterial(e,this.system.defaultMaterial)}resolveDuplicatedEntityReferenceProperties(e,t){e.rootBone&&(this.rootBone=t[e.rootBone.getGuid()])}}class D1e{constructor(){this.enabled=!0}}const a2=["enabled"],Yc=["material","meshInstances","asset","materialAssets","castShadows","receiveShadows","castShadowsLightmap","lightmapped","lightmapSizeMultiplier","renderStyle","type","layers","isStatic","batchGroupId","rootBone"];class L1e extends si{constructor(e){super(e),this.id="render",this.ComponentType=wY,this.DataType=D1e,this.schema=a2,this.defaultMaterial=Py(e.graphicsDevice),this.on("beforeremove",this.onRemove,this)}initializeComponentData(e,t,i){(t.batchGroupId===null||t.batchGroupId===void 0)&&(t.batchGroupId=-1),t.layers&&t.layers.length&&(t.layers=t.layers.slice(0));for(let s=0;s<Yc.length;s++)t.hasOwnProperty(Yc[s])&&(e[Yc[s]]=t[Yc[s]]);t.aabbCenter&&t.aabbHalfExtents&&(e.customAabb=new We(new O(t.aabbCenter),new O(t.aabbHalfExtents))),super.initializeComponentData(e,t,a2)}cloneComponent(e,t){const i={};for(let o=0;o<Yc.length;o++)i[Yc[o]]=e.render[Yc[o]];i.enabled=e.render.enabled,delete i.meshInstances;const s=this.addComponent(t,i),n=e.render.meshInstances,a=n.map(o=>o.mesh);s._onSetMeshes(a);for(let o=0;o<n.length;o++)s.meshInstances[o].material=n[o].material;return e.render.customAabb&&(s.customAabb=e.render.customAabb.clone()),s}onRemove(e,t){t.onRemove()}}ke._buildAccessors(wY.prototype,a2);class jC{constructor(e,t){this._pool=[],this._count=0,this._constructor=e,this._resize(t)}_resize(e){if(e>this._pool.length)for(let t=this._pool.length;t<e;t++)this._pool[t]=new this._constructor}allocate(){return this._count>=this._pool.length&&this._resize(this._pool.length*2),this._pool[this._count++]}freeAll(){this._count=0}}let ds,Je,wn,yd;const O1e=new de,N1e=new de,cS=new O,kl=class kl extends ke{static onLibraryLoaded(){typeof Ammo<"u"&&(ds=new Ammo.btTransform,Je=new Ammo.btVector3,wn=new Ammo.btVector3,yd=new Ammo.btQuaternion)}static onAppDestroy(){Ammo.destroy(ds),Ammo.destroy(Je),Ammo.destroy(wn),Ammo.destroy(yd),ds=null,Je=null,wn=null,yd=null}set angularDamping(e){this._angularDamping!==e&&(this._angularDamping=e,this._body&&this._body.setDamping(this._linearDamping,e))}get angularDamping(){return this._angularDamping}set angularFactor(e){this._angularFactor.equals(e)||(this._angularFactor.copy(e),this._body&&this._type===xn&&(Je.setValue(e.x,e.y,e.z),this._body.setAngularFactor(Je)))}get angularFactor(){return this._angularFactor}set angularVelocity(e){this._body&&this._type===xn&&(this._body.activate(),Je.setValue(e.x,e.y,e.z),this._body.setAngularVelocity(Je),this._angularVelocity.copy(e))}get angularVelocity(){if(this._body&&this._type===xn){const e=this._body.getAngularVelocity();this._angularVelocity.set(e.x(),e.y(),e.z())}return this._angularVelocity}set body(e){this._body!==e&&(this._body=e,e&&this._simulationEnabled&&e.activate())}get body(){return this._body}set friction(e){this._friction!==e&&(this._friction=e,this._body&&this._body.setFriction(e))}get friction(){return this._friction}set group(e){this._group!==e&&(this._group=e,this.enabled&&this.entity.enabled&&(this.disableSimulation(),this.enableSimulation()))}get group(){return this._group}set linearDamping(e){this._linearDamping!==e&&(this._linearDamping=e,this._body&&this._body.setDamping(e,this._angularDamping))}get linearDamping(){return this._linearDamping}set linearFactor(e){this._linearFactor.equals(e)||(this._linearFactor.copy(e),this._body&&this._type===xn&&(Je.setValue(e.x,e.y,e.z),this._body.setLinearFactor(Je)))}get linearFactor(){return this._linearFactor}set linearVelocity(e){this._body&&this._type===xn&&(this._body.activate(),Je.setValue(e.x,e.y,e.z),this._body.setLinearVelocity(Je),this._linearVelocity.copy(e))}get linearVelocity(){if(this._body&&this._type===xn){const e=this._body.getLinearVelocity();this._linearVelocity.set(e.x(),e.y(),e.z())}return this._linearVelocity}set mask(e){this._mask!==e&&(this._mask=e,this.enabled&&this.entity.enabled&&(this.disableSimulation(),this.enableSimulation()))}get mask(){return this._mask}set mass(e){if(this._mass!==e&&(this._mass=e,this._body&&this._type===xn)){const t=this.enabled&&this.entity.enabled;t&&this.disableSimulation(),this._body.getCollisionShape().calculateLocalInertia(e,Je),this._body.setMassProps(e,Je),this._body.updateInertiaTensor(),t&&this.enableSimulation()}}get mass(){return this._mass}set restitution(e){this._restitution!==e&&(this._restitution=e,this._body&&this._body.setRestitution(e))}get restitution(){return this._restitution}set rollingFriction(e){this._rollingFriction!==e&&(this._rollingFriction=e,this._body&&this._body.setRollingFriction(e))}get rollingFriction(){return this._rollingFriction}set type(e){if(this._type!==e){switch(this._type=e,this.disableSimulation(),e){case xn:this._group=VTe,this._mask=zz;break;case dd:this._group=jTe,this._mask=zz;break;case og:default:this._group=Bz,this._mask=QM;break}this.createBody()}}get type(){return this._type}createBody(){const e=this.entity;let t;if(e.collision&&(t=e.collision.shape,e.trigger&&(e.trigger.destroy(),delete e.trigger)),t){this._body&&(this.system.removeBody(this._body),this.system.destroyBody(this._body),this._body=null);const i=this._type===xn?this._mass:0;this._getEntityTransform(ds);const s=this.system.createBody(i,t,ds);if(s.setRestitution(this._restitution),s.setFriction(this._friction),s.setRollingFriction(this._rollingFriction),s.setDamping(this._linearDamping,this._angularDamping),this._type===xn){const n=this._linearFactor;Je.setValue(n.x,n.y,n.z),s.setLinearFactor(Je);const a=this._angularFactor;Je.setValue(a.x,a.y,a.z),s.setAngularFactor(Je)}else this._type===dd&&(s.setCollisionFlags(s.getCollisionFlags()|zTe),s.setActivationState(Fz));s.entity=e,this.body=s,this.enabled&&e.enabled&&this.enableSimulation()}}isActive(){return this._body?this._body.isActive():!1}activate(){this._body&&this._body.activate()}enableSimulation(){const e=this.entity;if(e.collision&&e.collision.enabled&&!this._simulationEnabled){const t=this._body;if(t){switch(this.system.addBody(t,this._group,this._mask),this._type){case xn:this.system._dynamic.push(this),t.forceActivationState(ZM),this.syncEntityToBody();break;case dd:this.system._kinematic.push(this),t.forceActivationState(Fz);break;case og:t.forceActivationState(ZM),this.syncEntityToBody();break}e.collision.type==="compound"&&this.system._compounds.push(e.collision),t.activate(),this._simulationEnabled=!0}}}disableSimulation(){const e=this._body;if(e&&this._simulationEnabled){const t=this.system;let i=t._compounds.indexOf(this.entity.collision);i>-1&&t._compounds.splice(i,1),i=t._dynamic.indexOf(this),i>-1&&t._dynamic.splice(i,1),i=t._kinematic.indexOf(this),i>-1&&t._kinematic.splice(i,1),t.removeBody(e),e.forceActivationState(hY),this._simulationEnabled=!1}}applyForce(e,t,i,s,n,a){const o=this._body;o&&(o.activate(),e instanceof O?Je.setValue(e.x,e.y,e.z):Je.setValue(e,t,i),t instanceof O?wn.setValue(t.x,t.y,t.z):s!==void 0?wn.setValue(s,n,a):wn.setValue(0,0,0),o.applyForce(Je,wn))}applyTorque(e,t,i){const s=this._body;s&&(s.activate(),e instanceof O?Je.setValue(e.x,e.y,e.z):Je.setValue(e,t,i),s.applyTorque(Je))}applyImpulse(e,t,i,s,n,a){const o=this._body;o&&(o.activate(),e instanceof O?Je.setValue(e.x,e.y,e.z):Je.setValue(e,t,i),t instanceof O?wn.setValue(t.x,t.y,t.z):s!==void 0?wn.setValue(s,n,a):wn.setValue(0,0,0),o.applyImpulse(Je,wn))}applyTorqueImpulse(e,t,i){const s=this._body;s&&(s.activate(),e instanceof O?Je.setValue(e.x,e.y,e.z):Je.setValue(e,t,i),s.applyTorqueImpulse(Je))}isStatic(){return this._type===og}isStaticOrKinematic(){return this._type===og||this._type===dd}isKinematic(){return this._type===dd}_getEntityTransform(e){const t=this.entity,i=t.collision;if(i){const s=i.getShapePosition(),n=i.getShapeRotation();Je.setValue(s.x,s.y,s.z),yd.setValue(n.x,n.y,n.z,n.w)}else{const s=t.getPosition(),n=t.getRotation();Je.setValue(s.x,s.y,s.z),yd.setValue(n.x,n.y,n.z,n.w)}e.setOrigin(Je),e.setRotation(yd)}syncEntityToBody(){const e=this._body;if(e){if(this._getEntityTransform(ds),e.setWorldTransform(ds),this._type===dd){const t=e.getMotionState();t&&t.setWorldTransform(ds)}e.activate()}}_updateDynamic(){const e=this._body;if(e.isActive()){const t=e.getMotionState();if(t){const i=this.entity;t.getWorldTransform(ds);const s=ds.getOrigin(),n=ds.getRotation(),a=i.collision;if(a&&a._hasOffset){const o=a.data.linearOffset,l=a.data.angularOffset,c=N1e.copy(l).invert(),u=O1e.set(n.x(),n.y(),n.z(),n.w()).mul(c);u.transformVector(o,cS),i.setPosition(s.x()-cS.x,s.y()-cS.y,s.z()-cS.z),i.setRotation(u)}else i.setPosition(s.x(),s.y(),s.z()),i.setRotation(n.x(),n.y(),n.z(),n.w())}}}_updateKinematic(){const e=this._body.getMotionState();e&&(this._getEntityTransform(ds),e.setWorldTransform(ds))}teleport(e,t,i,s,n,a){e instanceof O?this.entity.setPosition(e):this.entity.setPosition(e,t,i),t instanceof de?this.entity.setRotation(t):t instanceof O?this.entity.setEulerAngles(t):s!==void 0&&this.entity.setEulerAngles(s,n,a),this.syncEntityToBody()}onEnable(){this._body||this.createBody(),this.enableSimulation()}onDisable(){this.disableSimulation()}constructor(...e){super(...e),this._angularDamping=0,this._angularFactor=new O(1,1,1),this._angularVelocity=new O,this._body=null,this._friction=.5,this._group=Bz,this._linearDamping=0,this._linearFactor=new O(1,1,1),this._linearVelocity=new O,this._mask=QM,this._mass=1,this._restitution=0,this._rollingFriction=0,this._simulationEnabled=!1,this._type=og}};kl.EVENT_CONTACT="contact",kl.EVENT_COLLISIONSTART="collisionstart",kl.EVENT_COLLISIONEND="collisionend",kl.EVENT_TRIGGERENTER="triggerenter",kl.EVENT_TRIGGERLEAVE="triggerleave",kl.order=-1;let Of=kl;class k1e{constructor(){this.enabled=!0}}let ho,fo;class Kz{constructor(e,t,i,s){this.entity=e,this.point=t,this.normal=i,this.hitFraction=s}}class F1e{constructor(e,t,i){arguments.length!==0?(this.a=e,this.b=t,this.impulse=i.impulse,this.localPointA=i.localPoint,this.localPointB=i.localPointOther,this.pointA=i.point,this.pointB=i.pointOther,this.normal=i.normal):(this.a=null,this.b=null,this.impulse=0,this.localPointA=new O,this.localPointB=new O,this.pointA=new O,this.pointB=new O,this.normal=new O)}}class B1e{constructor(e=new O,t=new O,i=new O,s=new O,n=new O,a=0){this.localPoint=e,this.localPointOther=t,this.point=i,this.pointOther=s,this.normal=n,this.impulse=a}}class U1e{constructor(e,t){this.other=e,this.contacts=t}}const TY=["enabled"],vk=class vk extends si{constructor(e){super(e),this.maxSubSteps=10,this.fixedTimeStep=1/60,this.gravity=new O(0,-9.81,0),this._gravityFloat32=new Float32Array(3),this._dynamic=[],this._kinematic=[],this._triggers=[],this._compounds=[],this.id="rigidbody",this._stats=e.stats.frame,this.ComponentType=Of,this.DataType=k1e,this.contactPointPool=null,this.contactResultPool=null,this.singleContactResultPool=null,this.schema=TY,this.collisions={},this.frameCollisions={},this.on("beforeremove",this.onBeforeRemove,this)}onLibraryLoaded(){if(typeof Ammo<"u"){if(this.collisionConfiguration=new Ammo.btDefaultCollisionConfiguration,this.dispatcher=new Ammo.btCollisionDispatcher(this.collisionConfiguration),this.overlappingPairCache=new Ammo.btDbvtBroadphase,this.solver=new Ammo.btSequentialImpulseConstraintSolver,this.dynamicsWorld=new Ammo.btDiscreteDynamicsWorld(this.dispatcher,this.overlappingPairCache,this.solver,this.collisionConfiguration),this.dynamicsWorld.setInternalTickCallback){const e=Ammo.addFunction(this._checkForCollisions.bind(this),"vif");this.dynamicsWorld.setInternalTickCallback(e)}ho=new Ammo.btVector3,fo=new Ammo.btVector3,Of.onLibraryLoaded(),this.contactPointPool=new jC(B1e,1),this.contactResultPool=new jC(U1e,1),this.singleContactResultPool=new jC(F1e,1),this.app.systems.on("update",this.onUpdate,this)}else this.app.systems.off("update",this.onUpdate,this)}initializeComponentData(e,t,i){const s=["mass","linearDamping","angularDamping","linearFactor","angularFactor","friction","rollingFriction","restitution","type","group","mask"];for(const n of s)if(t.hasOwnProperty(n)){const a=t[n];Array.isArray(a)?e[n]=new O(a[0],a[1],a[2]):e[n]=a}super.initializeComponentData(e,t,["enabled"])}cloneComponent(e,t){const i=e.rigidbody,s={enabled:i.enabled,mass:i.mass,linearDamping:i.linearDamping,angularDamping:i.angularDamping,linearFactor:[i.linearFactor.x,i.linearFactor.y,i.linearFactor.z],angularFactor:[i.angularFactor.x,i.angularFactor.y,i.angularFactor.z],friction:i.friction,rollingFriction:i.rollingFriction,restitution:i.restitution,type:i.type,group:i.group,mask:i.mask};return this.addComponent(t,s)}onBeforeRemove(e,t){t.enabled&&(t.enabled=!1),t.body&&(this.destroyBody(t.body),t.body=null)}addBody(e,t,i){t!==void 0&&i!==void 0?this.dynamicsWorld.addRigidBody(e,t,i):this.dynamicsWorld.addRigidBody(e)}removeBody(e){this.dynamicsWorld.removeRigidBody(e)}createBody(e,t,i){const s=new Ammo.btVector3(0,0,0);e!==0&&t.calculateLocalInertia(e,s);const n=new Ammo.btDefaultMotionState(i),a=new Ammo.btRigidBodyConstructionInfo(e,n,t,s),o=new Ammo.btRigidBody(a);return Ammo.destroy(a),Ammo.destroy(s),o}destroyBody(e){const t=e.getMotionState();t&&Ammo.destroy(t),Ammo.destroy(e)}raycastFirst(e,t,i={}){if(i.filterTags||i.filterCallback)return i.sort=!0,this.raycastAll(e,t,i)[0]||null;let s=null;ho.setValue(e.x,e.y,e.z),fo.setValue(t.x,t.y,t.z);const n=new Ammo.ClosestRayResultCallback(ho,fo);if(typeof i.filterCollisionGroup=="number"&&n.set_m_collisionFilterGroup(i.filterCollisionGroup),typeof i.filterCollisionMask=="number"&&n.set_m_collisionFilterMask(i.filterCollisionMask),this.dynamicsWorld.rayTest(ho,fo,n),n.hasHit()){const a=n.get_m_collisionObject(),o=Ammo.castObject(a,Ammo.btRigidBody);if(o){const l=n.get_m_hitPointWorld(),c=n.get_m_hitNormalWorld();s=new Kz(o.entity,new O(l.x(),l.y(),l.z()),new O(c.x(),c.y(),c.z()),n.get_m_closestHitFraction())}}return Ammo.destroy(n),s}raycastAll(e,t,i={}){const s=[];ho.setValue(e.x,e.y,e.z),fo.setValue(t.x,t.y,t.z);const n=new Ammo.AllHitsRayResultCallback(ho,fo);if(typeof i.filterCollisionGroup=="number"&&n.set_m_collisionFilterGroup(i.filterCollisionGroup),typeof i.filterCollisionMask=="number"&&n.set_m_collisionFilterMask(i.filterCollisionMask),this.dynamicsWorld.rayTest(ho,fo,n),n.hasHit()){const a=n.get_m_collisionObjects(),o=n.get_m_hitPointWorld(),l=n.get_m_hitNormalWorld(),c=n.get_m_hitFractions(),u=a.size();for(let h=0;h<u;h++){const d=Ammo.castObject(a.at(h),Ammo.btRigidBody);if(d&&d.entity){if(i.filterTags&&!d.entity.tags.has(...i.filterTags)||i.filterCallback&&!i.filterCallback(d.entity))continue;const f=o.at(h),p=l.at(h),m=new Kz(d.entity,new O(f.x(),f.y(),f.z()),new O(p.x(),p.y(),p.z()),c.at(h));s.push(m)}}i.sort&&s.sort((h,d)=>h.hitFraction-d.hitFraction)}return Ammo.destroy(n),s}_storeCollision(e,t){let i=!1;const s=e.getGuid();return this.collisions[s]=this.collisions[s]||{others:[],entity:e},this.collisions[s].others.indexOf(t)<0&&(this.collisions[s].others.push(t),i=!0),this.frameCollisions[s]=this.frameCollisions[s]||{others:[],entity:e},this.frameCollisions[s].others.push(t),i}_createContactPointFromAmmo(e){const t=e.get_m_localPointA(),i=e.get_m_localPointB(),s=e.getPositionWorldOnA(),n=e.getPositionWorldOnB(),a=e.get_m_normalWorldOnB(),o=this.contactPointPool.allocate();return o.localPoint.set(t.x(),t.y(),t.z()),o.localPointOther.set(i.x(),i.y(),i.z()),o.point.set(s.x(),s.y(),s.z()),o.pointOther.set(n.x(),n.y(),n.z()),o.normal.set(a.x(),a.y(),a.z()),o.impulse=e.getAppliedImpulse(),o}_createReverseContactPointFromAmmo(e){const t=e.get_m_localPointA(),i=e.get_m_localPointB(),s=e.getPositionWorldOnA(),n=e.getPositionWorldOnB(),a=e.get_m_normalWorldOnB(),o=this.contactPointPool.allocate();return o.localPointOther.set(t.x(),t.y(),t.z()),o.localPoint.set(i.x(),i.y(),i.z()),o.pointOther.set(s.x(),s.y(),s.z()),o.point.set(n.x(),n.y(),n.z()),o.normal.set(a.x(),a.y(),a.z()),o.impulse=e.getAppliedImpulse(),o}_createSingleContactResult(e,t,i){const s=this.singleContactResultPool.allocate();return s.a=e,s.b=t,s.localPointA=i.localPoint,s.localPointB=i.localPointOther,s.pointA=i.point,s.pointB=i.pointOther,s.normal=i.normal,s.impulse=i.impulse,s}_createContactResult(e,t){const i=this.contactResultPool.allocate();return i.other=e,i.contacts=t,i}_cleanOldCollisions(){for(const e in this.collisions)if(this.collisions.hasOwnProperty(e)){const t=this.frameCollisions[e],i=this.collisions[e],s=i.entity,n=s.collision,a=s.rigidbody,o=i.others;let c=o.length;for(;c--;){const u=o[c];(!t||t.others.indexOf(u)<0)&&(o.splice(c,1),s.trigger?(n&&n.fire("triggerleave",u),u.rigidbody&&u.rigidbody.fire("triggerleave",s)):u.trigger||(a&&a.fire("collisionend",u),n&&n.fire("collisionend",u)))}o.length===0&&delete this.collisions[e]}}_hasContactEvent(e){const t=e.collision;if(t&&(t.hasEvent("collisionstart")||t.hasEvent("collisionend")||t.hasEvent("contact")))return!0;const i=e.rigidbody;return i&&(i.hasEvent("collisionstart")||i.hasEvent("collisionend")||i.hasEvent("contact"))}_checkForCollisions(e,t){const s=Ammo.wrapPointer(e,Ammo.btDynamicsWorld).getDispatcher(),n=s.getNumManifolds();this.frameCollisions={};for(let a=0;a<n;a++){const o=s.getManifoldByIndexInternal(a),l=o.getBody0(),c=o.getBody1(),u=Ammo.castObject(l,Ammo.btRigidBody),h=Ammo.castObject(c,Ammo.btRigidBody),d=u.entity,f=h.entity;if(!d||!f)continue;const p=u.getCollisionFlags(),m=h.getCollisionFlags(),g=o.getNumContacts(),_=[],v=[];let y;if(g>0)if(p&Ig||m&Ig){const x=d.collision&&(d.collision.hasEvent("triggerenter")||d.collision.hasEvent("triggerleave")),S=f.collision&&(f.collision.hasEvent("triggerenter")||f.collision.hasEvent("triggerleave")),w=d.rigidbody&&(d.rigidbody.hasEvent("triggerenter")||d.rigidbody.hasEvent("triggerleave")),T=f.rigidbody&&(f.rigidbody.hasEvent("triggerenter")||f.rigidbody.hasEvent("triggerleave"));x&&(y=this._storeCollision(d,f),y&&!(m&Ig)&&d.collision.fire("triggerenter",f)),S&&(y=this._storeCollision(f,d),y&&!(p&Ig)&&f.collision.fire("triggerenter",d)),w&&(y||(y=this._storeCollision(f,d)),y&&d.rigidbody.fire("triggerenter",f)),T&&(y||(y=this._storeCollision(d,f)),y&&f.rigidbody.fire("triggerenter",d))}else{const x=this._hasContactEvent(d),S=this._hasContactEvent(f),w=this.hasEvent("contact");if(w||x||S){for(let T=0;T<g;T++){const A=o.getContactPoint(T),C=this._createContactPointFromAmmo(A);if(x||S){_.push(C);const P=this._createReverseContactPointFromAmmo(A);v.push(P)}if(w){const P=this._createSingleContactResult(d,f,C);this.fire("contact",P)}}if(x){const T=this._createContactResult(f,_);y=this._storeCollision(d,f),d.collision&&(d.collision.fire("contact",T),y&&d.collision.fire("collisionstart",T)),d.rigidbody&&(d.rigidbody.fire("contact",T),y&&d.rigidbody.fire("collisionstart",T))}if(S){const T=this._createContactResult(d,v);y=this._storeCollision(f,d),f.collision&&(f.collision.fire("contact",T),y&&f.collision.fire("collisionstart",T)),f.rigidbody&&(f.rigidbody.fire("contact",T),y&&f.rigidbody.fire("collisionstart",T))}}}}this._cleanOldCollisions(),this.contactPointPool.freeAll(),this.contactResultPool.freeAll(),this.singleContactResultPool.freeAll()}onUpdate(e){let t,i;this._gravityFloat32[0]=this.gravity.x,this._gravityFloat32[1]=this.gravity.y,this._gravityFloat32[2]=this.gravity.z;const s=this.dynamicsWorld.getGravity();(s.x()!==this._gravityFloat32[0]||s.y()!==this._gravityFloat32[1]||s.z()!==this._gravityFloat32[2])&&(s.setValue(this.gravity.x,this.gravity.y,this.gravity.z),this.dynamicsWorld.setGravity(s));const n=this._triggers;for(t=0,i=n.length;t<i;t++)n[t].updateTransform();const a=this._compounds;for(t=0,i=a.length;t<i;t++)a[t]._updateCompound();const o=this._kinematic;for(t=0,i=o.length;t<i;t++)o[t]._updateKinematic();this.dynamicsWorld.stepSimulation(e,this.maxSubSteps,this.fixedTimeStep);const l=this._dynamic;for(t=0,i=l.length;t<i;t++)l[t]._updateDynamic();this.dynamicsWorld.setInternalTickCallback||this._checkForCollisions(Ammo.getPointer(this.dynamicsWorld),e)}destroy(){super.destroy(),this.app.systems.off("update",this.onUpdate,this),typeof Ammo<"u"&&(Ammo.destroy(this.dynamicsWorld),Ammo.destroy(this.solver),Ammo.destroy(this.overlappingPairCache),Ammo.destroy(this.dispatcher),Ammo.destroy(this.collisionConfiguration),Ammo.destroy(ho),Ammo.destroy(fo),this.dynamicsWorld=null,this.solver=null,this.overlappingPairCache=null,this.dispatcher=null,this.collisionConfiguration=null,ho=null,fo=null,Of.onAppDestroy())}};vk.EVENT_CONTACT="contact";let o2=vk;ke._buildAccessors(Of.prototype,TY);const Sd="none",z1e="blend",Zz=new se;class EY extends ke{constructor(e,t){super(e,t),this._resolution=new ee(640,320),this._referenceResolution=new ee(640,320),this._scaleMode=Sd,this.scale=1,this._scaleBlend=.5,this._priority=0,this._screenSpace=!1,this.cull=this._screenSpace,this._screenMatrix=new se,this._elements=new Set,e.app.graphicsDevice.on("resizecanvas",this._onResize,this)}syncDrawOrder(){this.system.queueDrawOrderSync(this.entity.getGuid(),this._processDrawOrderSync,this)}_recurseDrawOrderSync(e,t){var s;if(!(e instanceof lt))return t;if(e.element){const n=e.element.drawOrder;e.element.drawOrder=t++,e.element._batchGroupId>=0&&n!==e.element.drawOrder&&((s=this.system.app.batcher)==null||s.markGroupDirty(e.element._batchGroupId))}e.particlesystem&&(e.particlesystem.drawOrder=t++);const i=e.children;for(let n=0;n<i.length;n++)t=this._recurseDrawOrderSync(i[n],t);return t}_processDrawOrderSync(){this._recurseDrawOrderSync(this.entity,1),this.fire("syncdraworder")}_calcProjectionMatrix(){const e=this._resolution.x/this.scale,t=this._resolution.y/this.scale,i=0,s=e,n=-t;this._screenMatrix.setOrtho(i,s,n,0,1,-1),this._screenSpace||(Zz.setScale(.5*e,.5*t,1),this._screenMatrix.mul2(Zz,this._screenMatrix))}_updateScale(){this.scale=this._calcScale(this._resolution,this.referenceResolution)}_calcScale(e,t){const i=Math.log2((e.x||1)/t.x),s=Math.log2((e.y||1)/t.y);return Math.pow(2,i*(1-this._scaleBlend)+s*this._scaleBlend)}_onResize(e,t){this._screenSpace&&(this._resolution.set(e,t),this.resolution=this._resolution)}_bindElement(e){this._elements.add(e)}_unbindElement(e){this._elements.delete(e)}onRemove(){this.system.app.graphicsDevice.off("resizecanvas",this._onResize,this),this.fire("remove"),this._elements.forEach(e=>e._onScreenRemove()),this._elements.clear(),this.off()}set resolution(e){this._screenSpace?this._resolution.set(this.system.app.graphicsDevice.width,this.system.app.graphicsDevice.height):this._resolution.set(e.x,e.y),this._updateScale(),this._calcProjectionMatrix(),this.entity._dirtyLocal||this.entity._dirtifyLocal(),this.fire("set:resolution",this._resolution),this._elements.forEach(t=>t._onScreenResize(this._resolution))}get resolution(){return this._resolution}set referenceResolution(e){this._referenceResolution.set(e.x,e.y),this._updateScale(),this._calcProjectionMatrix(),this.entity._dirtyLocal||this.entity._dirtifyLocal(),this.fire("set:referenceresolution",this._resolution),this._elements.forEach(t=>t._onScreenResize(this._resolution))}get referenceResolution(){return this._scaleMode===Sd?this._resolution:this._referenceResolution}set screenSpace(e){this._screenSpace=e,this._screenSpace&&this._resolution.set(this.system.app.graphicsDevice.width,this.system.app.graphicsDevice.height),this.resolution=this._resolution,this.entity._dirtyLocal||this.entity._dirtifyLocal(),this.fire("set:screenspace",this._screenSpace),this._elements.forEach(t=>t._onScreenSpaceChange())}get screenSpace(){return this._screenSpace}set scaleMode(e){e!==Sd&&e!==z1e&&(e=Sd),!this._screenSpace&&e!==Sd&&(e=Sd),this._scaleMode=e,this.resolution=this._resolution,this.fire("set:scalemode",this._scaleMode)}get scaleMode(){return this._scaleMode}set scaleBlend(e){this._scaleBlend=e,this._updateScale(),this._calcProjectionMatrix(),this.entity._dirtyLocal||this.entity._dirtifyLocal(),this.fire("set:scaleblend",this._scaleBlend),this._elements.forEach(t=>t._onScreenResize(this._resolution))}get scaleBlend(){return this._scaleBlend}set priority(e){e>255&&(e=255),this._priority!==e&&(this._priority=e,this.syncDrawOrder())}get priority(){return this._priority}}class V1e{constructor(){this.enabled=!0}}const l2=["enabled"];class j1e extends si{constructor(e){super(e),this.id="screen",this.ComponentType=EY,this.DataType=V1e,this.schema=l2,this.windowResolution=new ee,this._drawOrderSyncQueue=new vde,this.app.graphicsDevice.on("resizecanvas",this._onResize,this),this.app.systems.on("update",this._onUpdate,this),this.on("beforeremove",this.onRemoveComponent,this)}initializeComponentData(e,t,i){t.priority!==void 0&&(e.priority=t.priority),t.screenSpace!==void 0&&(e.screenSpace=t.screenSpace),e.cull=e.screenSpace,t.scaleMode!==void 0&&(e.scaleMode=t.scaleMode),t.scaleBlend!==void 0&&(e.scaleBlend=t.scaleBlend),t.resolution!==void 0&&(t.resolution instanceof ee?e._resolution.copy(t.resolution):e._resolution.set(t.resolution[0],t.resolution[1]),e.resolution=e._resolution),t.referenceResolution!==void 0&&(t.referenceResolution instanceof ee?e._referenceResolution.copy(t.referenceResolution):e._referenceResolution.set(t.referenceResolution[0],t.referenceResolution[1]),e.referenceResolution=e._referenceResolution),e.syncDrawOrder(),super.initializeComponentData(e,t,l2)}destroy(){super.destroy(),this.app.graphicsDevice.off("resizecanvas",this._onResize,this),this.app.systems.off("update",this._onUpdate,this)}_onUpdate(e){const t=this.store;for(const i in t)t[i].entity.screen.update&&t[i].entity.screen.update(e)}_onResize(e,t){this.windowResolution.x=e,this.windowResolution.y=t}cloneComponent(e,t){const i=e.screen;return this.addComponent(t,{enabled:i.enabled,screenSpace:i.screenSpace,scaleMode:i.scaleMode,resolution:i.resolution.clone(),referenceResolution:i.referenceResolution.clone()})}onRemoveComponent(e,t){t.onRemove()}processDrawOrderSyncQueue(){const e=this._drawOrderSyncQueue.list();for(let t=0;t<e.length;t++){const i=e[t];i.callback.call(i.scope)}this._drawOrderSyncQueue.clear()}queueDrawOrderSync(e,t,i){this._drawOrderSyncQueue.list().length||this.app.once("prerender",this.processDrawOrderSyncQueue,this),this._drawOrderSyncQueue.has(e)||this._drawOrderSyncQueue.push(e,{callback:t,scope:i})}}ke._buildAccessors(EY.prototype,l2);const bl=new ee,Qz=new O,Kc=new aM,Jz=new hq,eV=new O,lg=new O,$1e=new de,H1e={x:"y",y:"x"},x_=class x_ extends Te{constructor(e,t){if(super(),!e||!(e instanceof Rb))throw new Error("Element was null or not an ElementComponent");if(t&&t!=="x"&&t!=="y")throw new Error(`Unrecognized axis: ${t}`);this._element=e,this._app=e.system.app,this._axis=t||null,this._enabled=!0,this._dragScale=new O,this._dragStartMousePosition=new O,this._dragStartHandlePosition=new O,this._deltaMousePosition=new O,this._deltaHandlePosition=new O,this._isDragging=!1,this._toggleLifecycleListeners("on")}_toggleLifecycleListeners(e){this._element[e]("mousedown",this._onMouseDownOrTouchStart,this),this._element[e]("touchstart",this._onMouseDownOrTouchStart,this),this._element[e]("selectstart",this._onMouseDownOrTouchStart,this)}_toggleDragListeners(e){const t=e==="on";this._hasDragListeners&&t||(this._app.mouse&&(this._element[e]("mousemove",this._onMove,this),this._element[e]("mouseup",this._onMouseUpOrTouchEnd,this)),Ye.touch&&(this._element[e]("touchmove",this._onMove,this),this._element[e]("touchend",this._onMouseUpOrTouchEnd,this),this._element[e]("touchcancel",this._onMouseUpOrTouchEnd,this)),this._element[e]("selectmove",this._onMove,this),this._element[e]("selectend",this._onMouseUpOrTouchEnd,this),this._hasDragListeners=t)}_onMouseDownOrTouchStart(e){if(this._element&&!this._isDragging&&this.enabled){this._dragCamera=e.camera,this._calculateDragScale();const t=this._screenToLocal(e);t&&(this._toggleDragListeners("on"),this._isDragging=!0,this._dragStartMousePosition.copy(t),this._dragStartHandlePosition.copy(this._element.entity.getLocalPosition()),this.fire("drag:start"))}}_onMouseUpOrTouchEnd(){this._isDragging&&(this._isDragging=!1,this._toggleDragListeners("off"),this.fire("drag:end"))}_screenToLocal(e){return e.inputSource?Kc.set(e.inputSource.getOrigin(),e.inputSource.getDirection()):(this._determineInputPosition(e),this._chooseRayOriginAndDirection()),eV.copy(this._element.entity.forward).mulScalar(-1),Jz.setFromPointNormal(this._element.entity.getPosition(),eV),Jz.intersectsRay(Kc,lg)?($1e.copy(this._element.entity.getRotation()).invert().transformVector(lg,lg),lg.mul(this._dragScale),lg):null}_determineInputPosition(e){const t=this._app.graphicsDevice.maxPixelRatio;typeof e.x<"u"&&typeof e.y<"u"?(bl.x=e.x*t,bl.y=e.y*t):e.changedTouches?(bl.x=e.changedTouches[0].x*t,bl.y=e.changedTouches[0].y*t):console.warn("Could not determine position from input event")}_chooseRayOriginAndDirection(){this._element.screen&&this._element.screen.screen.screenSpace?(Kc.origin.set(bl.x,-bl.y,0),Kc.direction.copy(O.FORWARD)):(Qz.copy(this._dragCamera.screenToWorld(bl.x,bl.y,1)),Kc.origin.copy(this._dragCamera.entity.getPosition()),Kc.direction.copy(Qz).sub(Kc.origin).normalize())}_calculateDragScale(){let e=this._element.entity.parent;const t=this._element.screen&&this._element.screen.screen,i=t&&t.screenSpace,s=i?t.scale:1,n=this._dragScale;for(n.set(s,s,s);e&&(n.mul(e.getLocalScale()),e=e.parent,!(i&&e.screen)););n.x=1/n.x,n.y=1/n.y,n.z=0}_onMove(e){const{_element:t,_deltaMousePosition:i,_deltaHandlePosition:s,_axis:n}=this;if(t&&this._isDragging&&this.enabled&&t.enabled&&t.entity.enabled){const a=this._screenToLocal(e);if(a){if(i.sub2(a,this._dragStartMousePosition),s.add2(this._dragStartHandlePosition,i),n){const o=t.entity.getLocalPosition(),l=H1e[n];s[l]=o[l]}t.entity.setLocalPosition(s),this.fire("drag:move",s)}}}destroy(){this._toggleLifecycleListeners("off"),this._toggleDragListeners("off")}set enabled(e){this._enabled=e}get enabled(){return this._enabled}get isDragging(){return this._isDragging}};x_.EVENT_DRAGSTART="drag:start",x_.EVENT_DRAGEND="drag:end",x_.EVENT_DRAGMOVE="drag:move";let Lb=x_;const G1e=0,tV=1,W1e=2,X1e=0,q1e=1,cg=new ee,yk=class yk extends ke{constructor(e,t){super(e,t),this._viewportEntity=null,this._contentEntity=null,this._horizontalScrollbarEntity=null,this._verticalScrollbarEntity=null,this._evtElementRemove=null,this._evtViewportElementRemove=null,this._evtViewportResize=null,this._evtContentEntityElementAdd=null,this._evtContentElementRemove=null,this._evtContentResize=null,this._evtHorizontalScrollbarAdd=null,this._evtHorizontalScrollbarRemove=null,this._evtHorizontalScrollbarValue=null,this._evtVerticalScrollbarAdd=null,this._evtVerticalScrollbarRemove=null,this._evtVerticalScrollbarValue=null,this._scrollbarUpdateFlags={},this._scrollbarEntities={},this._prevContentSizes={},this._prevContentSizes[Ue]=null,this._prevContentSizes[xt]=null,this._scroll=new ee,this._velocity=new O,this._dragStartPosition=new O,this._disabledContentInput=!1,this._disabledContentInputEntities=[],this._toggleLifecycleListeners("on"),this._toggleElementListeners("on")}get data(){const e=this.system.store[this.entity.getGuid()];return e?e.data:null}set enabled(e){this._setValue("enabled",e)}get enabled(){return this.data.enabled}set horizontal(e){this._setValue("horizontal",e)}get horizontal(){return this.data.horizontal}set vertical(e){this._setValue("vertical",e)}get vertical(){return this.data.vertical}set scrollMode(e){this._setValue("scrollMode",e)}get scrollMode(){return this.data.scrollMode}set bounceAmount(e){this._setValue("bounceAmount",e)}get bounceAmount(){return this.data.bounceAmount}set friction(e){this._setValue("friction",e)}get friction(){return this.data.friction}set dragThreshold(e){this._setValue("dragThreshold",e)}get dragThreshold(){return this.data.dragThreshold}set useMouseWheel(e){this._setValue("useMouseWheel",e)}get useMouseWheel(){return this.data.useMouseWheel}set mouseWheelSensitivity(e){this._setValue("mouseWheelSensitivity",e)}get mouseWheelSensitivity(){return this.data.mouseWheelSensitivity}set horizontalScrollbarVisibility(e){this._setValue("horizontalScrollbarVisibility",e)}get horizontalScrollbarVisibility(){return this.data.horizontalScrollbarVisibility}set verticalScrollbarVisibility(e){this._setValue("verticalScrollbarVisibility",e)}get verticalScrollbarVisibility(){return this.data.verticalScrollbarVisibility}set viewportEntity(e){if(this._viewportEntity===e)return;const t=typeof e=="string";this._viewportEntity&&t&&this._viewportEntity.getGuid()===e||(this._viewportEntity&&this._viewportEntityUnsubscribe(),e instanceof Xt?this._viewportEntity=e:t?this._viewportEntity=this.system.app.getEntityFromIndex(e)||null:this._viewportEntity=null,this._viewportEntity&&this._viewportEntitySubscribe(),this._viewportEntity?this.data.viewportEntity=this._viewportEntity.getGuid():t&&e&&(this.data.viewportEntity=e))}get viewportEntity(){return this._viewportEntity}set contentEntity(e){if(this._contentEntity===e)return;const t=typeof e=="string";this._contentEntity&&t&&this._contentEntity.getGuid()===e||(this._contentEntity&&this._contentEntityUnsubscribe(),e instanceof Xt?this._contentEntity=e:t?this._contentEntity=this.system.app.getEntityFromIndex(e)||null:this._contentEntity=null,this._contentEntity&&this._contentEntitySubscribe(),this._contentEntity?this.data.contentEntity=this._contentEntity.getGuid():t&&e&&(this.data.contentEntity=e))}get contentEntity(){return this._contentEntity}set horizontalScrollbarEntity(e){if(this._horizontalScrollbarEntity===e)return;const t=typeof e=="string";this._horizontalScrollbarEntity&&t&&this._horizontalScrollbarEntity.getGuid()===e||(this._horizontalScrollbarEntity&&this._horizontalScrollbarEntityUnsubscribe(),e instanceof Xt?this._horizontalScrollbarEntity=e:t?this._horizontalScrollbarEntity=this.system.app.getEntityFromIndex(e)||null:this._horizontalScrollbarEntity=null,this._scrollbarEntities[Ue]=this._horizontalScrollbarEntity,this._horizontalScrollbarEntity&&this._horizontalScrollbarEntitySubscribe(),this._horizontalScrollbarEntity?this.data.horizontalScrollbarEntity=this._horizontalScrollbarEntity.getGuid():t&&e&&(this.data.horizontalScrollbarEntity=e))}get horizontalScrollbarEntity(){return this._horizontalScrollbarEntity}set verticalScrollbarEntity(e){if(this._verticalScrollbarEntity===e)return;const t=typeof e=="string";this._verticalScrollbarEntity&&t&&this._verticalScrollbarEntity.getGuid()===e||(this._verticalScrollbarEntity&&this._verticalScrollbarEntityUnsubscribe(),e instanceof Xt?this._verticalScrollbarEntity=e:t?this._verticalScrollbarEntity=this.system.app.getEntityFromIndex(e)||null:this._verticalScrollbarEntity=null,this._scrollbarEntities[xt]=this._verticalScrollbarEntity,this._verticalScrollbarEntity&&this._verticalScrollbarEntitySubscribe(),this._verticalScrollbarEntity?this.data.verticalScrollbarEntity=this._verticalScrollbarEntity.getGuid():t&&e&&(this.data.verticalScrollbarEntity=e))}get verticalScrollbarEntity(){return this._verticalScrollbarEntity}set scroll(e){this._onSetScroll(e.x,e.y)}get scroll(){return this._scroll}_setValue(e,t){const i=this.data,s=i[e];i[e]=t,this.fire("set",e,s,t)}_toggleLifecycleListeners(e){this[e]("set_horizontal",this._onSetHorizontalScrollingEnabled,this),this[e]("set_vertical",this._onSetVerticalScrollingEnabled,this),this.entity[e]("element:add",this._onElementComponentAdd,this)}_toggleElementListeners(e){if(this.entity.element){if(e==="on"&&this._hasElementListeners)return;this.entity.element[e]("resize",this._syncAll,this),this.entity.element[e]("mousewheel",this._onMouseWheel,this),this._hasElementListeners=e==="on"}}_onElementComponentAdd(e){this._evtElementRemove=this.entity.element.once("beforeremove",this._onElementComponentRemove,this),this._toggleElementListeners("on")}_onElementComponentRemove(e){var t;(t=this._evtElementRemove)==null||t.off(),this._evtElementRemove=null,this._toggleElementListeners("off")}_viewportEntitySubscribe(){this._evtViewportEntityElementAdd=this._viewportEntity.on("element:add",this._onViewportElementGain,this),this._viewportEntity.element&&this._onViewportElementGain()}_viewportEntityUnsubscribe(){var e,t;(e=this._evtViewportEntityElementAdd)==null||e.off(),this._evtViewportEntityElementAdd=null,(t=this._viewportEntity)!=null&&t.element&&this._onViewportElementLose()}_viewportEntityElementSubscribe(){const e=this._viewportEntity.element;this._evtViewportElementRemove=e.once("beforeremove",this._onViewportElementLose,this),this._evtViewportResize=e.on("resize",this._syncAll,this)}_viewportEntityElementUnsubscribe(){var e,t;(e=this._evtViewportElementRemove)==null||e.off(),this._evtViewportElementRemove=null,(t=this._evtViewportResize)==null||t.off(),this._evtViewportResize=null}_onViewportElementGain(){this._viewportEntityElementSubscribe(),this._syncAll()}_onViewportElementLose(){this._viewportEntityElementUnsubscribe()}_contentEntitySubscribe(){this._evtContentEntityElementAdd=this._contentEntity.on("element:add",this._onContentElementGain,this),this._contentEntity.element&&this._onContentElementGain()}_contentEntityUnsubscribe(){var e,t;(e=this._evtContentEntityElementAdd)==null||e.off(),this._evtContentEntityElementAdd=null,(t=this._contentEntity)!=null&&t.element&&this._onContentElementLose()}_contentEntityElementSubscribe(){const e=this._contentEntity.element;this._evtContentElementRemove=e.once("beforeremove",this._onContentElementLose,this),this._evtContentResize=e.on("resize",this._syncAll,this)}_contentEntityElementUnsubscribe(){var e,t;(e=this._evtContentElementRemove)==null||e.off(),this._evtContentElementRemove=null,(t=this._evtContentResize)==null||t.off(),this._evtContentResize=null}_onContentElementGain(){this._contentEntityElementSubscribe(),this._destroyDragHelper(),this._contentDragHelper=new Lb(this._contentEntity.element),this._contentDragHelper.on("drag:start",this._onContentDragStart,this),this._contentDragHelper.on("drag:end",this._onContentDragEnd,this),this._contentDragHelper.on("drag:move",this._onContentDragMove,this),this._prevContentSizes[Ue]=null,this._prevContentSizes[xt]=null,this._syncAll()}_onContentElementLose(){this._contentEntityElementUnsubscribe(),this._destroyDragHelper()}_onContentDragStart(){this._contentEntity&&this.enabled&&this.entity.enabled&&this._dragStartPosition.copy(this._contentEntity.getLocalPosition())}_onContentDragEnd(){this._prevContentDragPosition=null,this._enableContentInput()}_onContentDragMove(e){if(this._contentEntity&&this.enabled&&this.entity.enabled&&(this._wasDragged=!0,this._setScrollFromContentPosition(e),this._setVelocityFromContentPositionDelta(e),!this._disabledContentInput)){const t=e.x-this._dragStartPosition.x,i=e.y-this._dragStartPosition.y;(Math.abs(t)>this.dragThreshold||Math.abs(i)>this.dragThreshold)&&this._disableContentInput()}}_horizontalScrollbarEntitySubscribe(){this._evtHorizontalScrollbarAdd=this._horizontalScrollbarEntity.on("scrollbar:add",this._onHorizontalScrollbarGain,this),this._horizontalScrollbarEntity.scrollbar&&this._onHorizontalScrollbarGain()}_verticalScrollbarEntitySubscribe(){this._evtVerticalScrollbarAdd=this._verticalScrollbarEntity.on("scrollbar:add",this._onVerticalScrollbarGain,this),this._verticalScrollbarEntity.scrollbar&&this._onVerticalScrollbarGain()}_horizontalScrollbarEntityUnsubscribe(){var e;(e=this._evtHorizontalScrollbarAdd)==null||e.off(),this._evtHorizontalScrollbarAdd=null,this._horizontalScrollbarEntity.scrollbar&&this._onHorizontalScrollbarLose()}_verticalScrollbarEntityUnsubscribe(){var e;(e=this._evtVerticalScrollbarAdd)==null||e.off(),this._evtVerticalScrollbarAdd=null,this._verticalScrollbarEntity.scrollbar&&this._onVerticalScrollbarLose()}_onSetHorizontalScrollbarValue(e){!this._scrollbarUpdateFlags[Ue]&&this.enabled&&this.entity.enabled&&this._onSetScroll(e,null)}_onSetVerticalScrollbarValue(e){!this._scrollbarUpdateFlags[xt]&&this.enabled&&this.entity.enabled&&this._onSetScroll(null,e)}_onHorizontalScrollbarGain(){var t;const e=(t=this._horizontalScrollbarEntity)==null?void 0:t.scrollbar;this._evtHorizontalScrollbarRemove=e.on("beforeremove",this._onHorizontalScrollbarLose,this),this._evtHorizontalScrollbarValue=e.on("set:value",this._onSetHorizontalScrollbarValue,this),this._syncScrollbarEnabledState(Ue),this._syncScrollbarPosition(Ue)}_onVerticalScrollbarGain(){var t;const e=(t=this._verticalScrollbarEntity)==null?void 0:t.scrollbar;this._evtVerticalScrollbarRemove=e.on("beforeremove",this._onVerticalScrollbarLose,this),this._evtVerticalScrollbarValue=e.on("set:value",this._onSetVerticalScrollbarValue,this),this._syncScrollbarEnabledState(xt),this._syncScrollbarPosition(xt)}_onHorizontalScrollbarLose(){var e,t;(e=this._evtHorizontalScrollbarRemove)==null||e.off(),this._evtHorizontalScrollbarRemove=null,(t=this._evtHorizontalScrollbarValue)==null||t.off(),this._evtHorizontalScrollbarValue=null}_onVerticalScrollbarLose(){var e,t;(e=this._evtVerticalScrollbarRemove)==null||e.off(),this._evtVerticalScrollbarRemove=null,(t=this._evtVerticalScrollbarValue)==null||t.off(),this._evtVerticalScrollbarValue=null}_onSetHorizontalScrollingEnabled(){this._syncScrollbarEnabledState(Ue)}_onSetVerticalScrollingEnabled(){this._syncScrollbarEnabledState(xt)}_onSetScroll(e,t,i){i!==!1&&this._velocity.set(0,0,0);const s=this._updateAxis(e,"x",Ue),n=this._updateAxis(t,"y",xt);(s||n)&&this.fire("set:scroll",this._scroll)}_updateAxis(e,t,i){const s=e!==null&&Math.abs(e-this._scroll[t])>1e-5;return(s||this._isDragging()||e===0)&&(this._scroll[t]=this._determineNewScrollValue(e,t,i),this._syncContentPosition(i),this._syncScrollbarPosition(i)),s}_determineNewScrollValue(e,t,i){if(!this._getScrollingEnabled(i))return this._scroll[t];switch(this.scrollMode){case G1e:return Q.clamp(e,0,this._getMaxScrollValue(i));case tV:return this._setVelocityFromOvershoot(e,t,i),e;case W1e:return e;default:return console.warn(`Unhandled scroll mode:${this.scrollMode}`),e}}_syncAll(){this._syncContentPosition(Ue),this._syncContentPosition(xt),this._syncScrollbarPosition(Ue),this._syncScrollbarPosition(xt),this._syncScrollbarEnabledState(Ue),this._syncScrollbarEnabledState(xt)}_syncContentPosition(e){if(!this._contentEntity)return;const t=this._getAxis(e),i=this._getSign(e),s=this._prevContentSizes[e],n=this._getContentSize(e);if(s!==null&&Math.abs(s-n)>1e-4){const l=this._getMaxOffset(e,s),c=this._getMaxOffset(e,n);c===0?this._scroll[t]=1:this._scroll[t]=Q.clamp(this._scroll[t]*l/c,0,1)}const a=this._scroll[t]*this._getMaxOffset(e),o=this._contentEntity.getLocalPosition();o[t]=a*i,this._contentEntity.setLocalPosition(o),this._prevContentSizes[e]=n}_syncScrollbarPosition(e){const t=this._scrollbarEntities[e];if(!(t!=null&&t.scrollbar))return;const i=this._getAxis(e);this._scrollbarUpdateFlags[e]=!0,t.scrollbar.value=this._scroll[i],t.scrollbar.handleSize=this._getScrollbarHandleSize(i,e),this._scrollbarUpdateFlags[e]=!1}_syncScrollbarEnabledState(e){const t=this._scrollbarEntities[e];if(!t)return;const i=this._getScrollingEnabled(e),s=this._getScrollbarVisibility(e);switch(s){case X1e:t.enabled=i;return;case q1e:t.enabled=i&&this._contentIsLargerThanViewport(e);return;default:console.warn(`Unhandled scrollbar visibility:${s}`),t.enabled=i}}_contentIsLargerThanViewport(e){return this._getContentSize(e)>this._getViewportSize(e)}_contentPositionToScrollValue(e){const t=this._getMaxOffset(Ue),i=this._getMaxOffset(xt);return t===0?cg.x=0:cg.x=e.x/t,i===0?cg.y=0:cg.y=e.y/-i,cg}_getMaxOffset(e,t){t=t===void 0?this._getContentSize(e):t;const i=this._getViewportSize(e);return t<i?-this._getViewportSize(e):i-t}_getMaxScrollValue(e){return this._contentIsLargerThanViewport(e)?1:0}_getScrollbarHandleSize(e,t){const i=this._getViewportSize(t),s=this._getContentSize(t);if(Math.abs(s)<.001)return 1;const n=Math.min(i/s,1),a=this._toOvershoot(this._scroll[e],t);return a===0?n:n/(1+Math.abs(a))}_getViewportSize(e){return this._getSize(e,this._viewportEntity)}_getContentSize(e){return this._getSize(e,this._contentEntity)}_getSize(e,t){return t!=null&&t.element?t.element[this._getCalculatedDimension(e)]:0}_getScrollingEnabled(e){if(e===Ue)return this.horizontal;if(e===xt)return this.vertical}_getScrollbarVisibility(e){if(e===Ue)return this.horizontalScrollbarVisibility;if(e===xt)return this.verticalScrollbarVisibility}_getSign(e){return e===Ue?1:-1}_getAxis(e){return e===Ue?"x":"y"}_getCalculatedDimension(e){return e===Ue?"calculatedWidth":"calculatedHeight"}_destroyDragHelper(){this._contentDragHelper&&this._contentDragHelper.destroy()}onUpdate(){this._contentEntity&&(this._updateVelocity(),this._syncScrollbarEnabledState(Ue),this._syncScrollbarEnabledState(xt))}_updateVelocity(){if(!this._isDragging()){if(this.scrollMode===tV&&(this._hasOvershoot("x",Ue)&&this._setVelocityFromOvershoot(this.scroll.x,"x",Ue),this._hasOvershoot("y",xt)&&this._setVelocityFromOvershoot(this.scroll.y,"y",xt)),Math.abs(this._velocity.x)>1e-4||Math.abs(this._velocity.y)>1e-4){const e=this._contentEntity.getLocalPosition();e.x+=this._velocity.x,e.y+=this._velocity.y,this._contentEntity.setLocalPosition(e),this._setScrollFromContentPosition(e)}this._velocity.x*=1-this.friction,this._velocity.y*=1-this.friction}}_hasOvershoot(e,t){return Math.abs(this._toOvershoot(this.scroll[e],t))>.001}_toOvershoot(e,t){const i=this._getMaxScrollValue(t);return e<0?e:e>i?e-i:0}_setVelocityFromOvershoot(e,t,i){const n=this._toOvershoot(e,i)*this._getMaxOffset(i)*this._getSign(i);Math.abs(n)>0&&(this._velocity[t]=-n/(this.bounceAmount*50+1))}_setVelocityFromContentPositionDelta(e){this._prevContentDragPosition?(this._velocity.sub2(e,this._prevContentDragPosition),this._prevContentDragPosition.copy(e)):(this._velocity.set(0,0,0),this._prevContentDragPosition=e.clone())}_setScrollFromContentPosition(e){let t=this._contentPositionToScrollValue(e);this._isDragging()&&(t=this._applyScrollValueTension(t)),this._onSetScroll(t.x,t.y,!1)}_applyScrollValueTension(e){let i=this._getMaxScrollValue(Ue),s=this._toOvershoot(e.x,Ue);return s>0?e.x=i+1*Math.log10(1+s):s<0&&(e.x=-1*Math.log10(1-s)),i=this._getMaxScrollValue(xt),s=this._toOvershoot(e.y,xt),s>0?e.y=i+1*Math.log10(1+s):s<0&&(e.y=-1*Math.log10(1-s)),e}_isDragging(){return this._contentDragHelper&&this._contentDragHelper.isDragging}_setScrollbarComponentsEnabled(e){var t,i;(t=this._horizontalScrollbarEntity)!=null&&t.scrollbar&&(this._horizontalScrollbarEntity.scrollbar.enabled=e),(i=this._verticalScrollbarEntity)!=null&&i.scrollbar&&(this._verticalScrollbarEntity.scrollbar.enabled=e)}_setContentDraggingEnabled(e){this._contentDragHelper&&(this._contentDragHelper.enabled=e)}_onMouseWheel(e){var o;if(!this.useMouseWheel||!((o=this._contentEntity)!=null&&o.element))return;const t=e.event,i=t.deltaX/this._contentEntity.element.calculatedWidth*this.mouseWheelSensitivity.x,s=t.deltaY/this._contentEntity.element.calculatedHeight*this.mouseWheelSensitivity.y,n=Q.clamp(this._scroll.x+i,0,this._getMaxScrollValue(Ue)),a=Q.clamp(this._scroll.y+s,0,this._getMaxScrollValue(xt));this.scroll=new ee(n,a)}_enableContentInput(){for(;this._disabledContentInputEntities.length;){const e=this._disabledContentInputEntities.pop();e.element&&(e.element.useInput=!0)}this._disabledContentInput=!1}_disableContentInput(){const e=t=>{t.element&&t.element.useInput&&(this._disabledContentInputEntities.push(t),t.element.useInput=!1);const i=t.children;for(let s=0,n=i.length;s<n;s++)e(i[s])};if(this._contentEntity){const t=this._contentEntity.children;for(let i=0,s=t.length;i<s;i++)e(t[i])}this._disabledContentInput=!0}onEnable(){this._setScrollbarComponentsEnabled(!0),this._setContentDraggingEnabled(!0),this._syncAll()}onDisable(){this._setScrollbarComponentsEnabled(!1),this._setContentDraggingEnabled(!1)}onRemove(){this._toggleLifecycleListeners("off"),this._toggleElementListeners("off"),this._destroyDragHelper()}resolveDuplicatedEntityReferenceProperties(e,t){e.viewportEntity&&(this.viewportEntity=t[e.viewportEntity.getGuid()]),e.contentEntity&&(this.contentEntity=t[e.contentEntity.getGuid()]),e.horizontalScrollbarEntity&&(this.horizontalScrollbarEntity=t[e.horizontalScrollbarEntity.getGuid()]),e.verticalScrollbarEntity&&(this.verticalScrollbarEntity=t[e.verticalScrollbarEntity.getGuid()])}};yk.EVENT_SETSCROLL="set:scroll";let c2=yk;const Y1e=10;class K1e{constructor(){this.enabled=!0,this.dragThreshold=Y1e,this.useMouseWheel=!0,this.mouseWheelSensitivity=new ee(1,1),this.horizontalScrollbarVisibility=0,this.verticalScrollbarVisibility=0,this.viewportEntity=null,this.contentEntity=null,this.horizontalScrollbarEntity=null,this.verticalScrollbarEntity=null}}const iV=[{name:"enabled",type:"boolean"},{name:"horizontal",type:"boolean"},{name:"vertical",type:"boolean"},{name:"scrollMode",type:"number"},{name:"bounceAmount",type:"number"},{name:"friction",type:"number"},{name:"dragThreshold",type:"number"},{name:"useMouseWheel",type:"boolean"},{name:"mouseWheelSensitivity",type:"vec2"},{name:"horizontalScrollbarVisibility",type:"number"},{name:"verticalScrollbarVisibility",type:"number"}],Z1e=10;class Q1e extends si{constructor(e){super(e),this.id="scrollview",this.ComponentType=c2,this.DataType=K1e,this.schema=iV,this.on("beforeremove",this._onRemoveComponent,this),this.app.systems.on("update",this.onUpdate,this)}initializeComponentData(e,t,i){t.dragThreshold===void 0&&(t.dragThreshold=Z1e),t.useMouseWheel===void 0&&(t.useMouseWheel=!0),t.mouseWheelSensitivity===void 0&&(t.mouseWheelSensitivity=new ee(1,1)),super.initializeComponentData(e,t,iV),e.viewportEntity=t.viewportEntity,e.contentEntity=t.contentEntity,e.horizontalScrollbarEntity=t.horizontalScrollbarEntity,e.verticalScrollbarEntity=t.verticalScrollbarEntity}onUpdate(e){const t=this.store;for(const i in t){const s=t[i].entity,n=s.scrollview;n.enabled&&s.enabled&&n.onUpdate()}}_onRemoveComponent(e,t){t.onRemove()}destroy(){super.destroy(),this.app.systems.off("update",this.onUpdate,this)}}const Sk=class Sk extends ke{constructor(e,t){super(e,t),this._handleEntity=null,this._evtHandleEntityElementAdd=null,this._evtHandleEntityChanges=[],this._toggleLifecycleListeners("on")}get data(){const e=this.system.store[this.entity.getGuid()];return e?e.data:null}set enabled(e){this._setValue("enabled",e)}get enabled(){return this.data.enabled}set orientation(e){this._setValue("orientation",e)}get orientation(){return this.data.orientation}set value(e){this._setValue("value",e)}get value(){return this.data.value}set handleSize(e){this._setValue("handleSize",e)}get handleSize(){return this.data.handleSize}set handleEntity(e){if(this._handleEntity===e)return;const t=typeof e=="string";this._handleEntity&&t&&this._handleEntity.getGuid()===e||(this._handleEntity&&this._handleEntityUnsubscribe(),e instanceof Xt?this._handleEntity=e:t?this._handleEntity=this.system.app.getEntityFromIndex(e)||null:this._handleEntity=null,this._handleEntity&&this._handleEntitySubscribe(),this._handleEntity?this.data.handleEntity=this._handleEntity.getGuid():t&&e&&(this.data.handleEntity=e))}get handleEntity(){return this._handleEntity}_setValue(e,t){const i=this.data,s=i[e];i[e]=t,this.fire("set",e,s,t)}_toggleLifecycleListeners(e){this[e]("set_value",this._onSetValue,this),this[e]("set_handleSize",this._onSetHandleSize,this),this[e]("set_orientation",this._onSetOrientation,this)}_handleEntitySubscribe(){this._evtHandleEntityElementAdd=this._handleEntity.on("element:add",this._onHandleElementGain,this),this._handleEntity.element&&this._onHandleElementGain()}_handleEntityUnsubscribe(){var e,t;(e=this._evtHandleEntityElementAdd)==null||e.off(),this._evtHandleEntityElementAdd=null,(t=this._handleEntity)!=null&&t.element&&this._onHandleElementLose()}_handleEntityElementSubscribe(){const e=this._handleEntity.element,t=this._evtHandleEntityChanges;t.push(e.once("beforeremove",this._onHandleElementLose,this)),t.push(e.on("set:anchor",this._onSetHandleAlignment,this)),t.push(e.on("set:margin",this._onSetHandleAlignment,this)),t.push(e.on("set:pivot",this._onSetHandleAlignment,this))}_handleEntityElementUnsubscribe(){for(let e=0;e<this._evtHandleEntityChanges.length;e++)this._evtHandleEntityChanges[e].off();this._evtHandleEntityChanges.length=0}_onHandleElementGain(){this._handleEntityElementSubscribe(),this._destroyDragHelper(),this._handleDragHelper=new Lb(this._handleEntity.element,this._getAxis()),this._handleDragHelper.on("drag:move",this._onHandleDrag,this),this._updateHandlePositionAndSize()}_onHandleElementLose(){this._handleEntityElementUnsubscribe(),this._destroyDragHelper()}_onHandleDrag(e){this._handleEntity&&this.enabled&&this.entity.enabled&&(this.value=this._handlePositionToScrollValue(e[this._getAxis()]))}_onSetValue(e,t,i){Math.abs(i-t)>1e-5&&(this.data.value=Q.clamp(i,0,1),this._updateHandlePositionAndSize(),this.fire("set:value",this.data.value))}_onSetHandleSize(e,t,i){Math.abs(i-t)>1e-5&&(this.data.handleSize=Q.clamp(i,0,1),this._updateHandlePositionAndSize())}_onSetHandleAlignment(){this._updateHandlePositionAndSize()}_onSetOrientation(e,t,i){var s;i!==t&&((s=this._handleEntity)!=null&&s.element)&&(this._handleEntity.element[this._getOppositeDimension()]=0)}_updateHandlePositionAndSize(){const e=this._handleEntity,t=e==null?void 0:e.element;if(e){const i=e.getLocalPosition();i[this._getAxis()]=this._getHandlePosition(),e.setLocalPosition(i)}t&&(t[this._getDimension()]=this._getHandleLength())}_handlePositionToScrollValue(e){return e*this._getSign()/this._getUsableTrackLength()}_scrollValueToHandlePosition(e){return e*this._getSign()*this._getUsableTrackLength()}_getUsableTrackLength(){return Math.max(this._getTrackLength()-this._getHandleLength(),.001)}_getTrackLength(){return this.entity.element?this.orientation===Ue?this.entity.element.calculatedWidth:this.entity.element.calculatedHeight:0}_getHandleLength(){return this._getTrackLength()*this.handleSize}_getHandlePosition(){return this._scrollValueToHandlePosition(this.value)}_getSign(){return this.orientation===Ue?1:-1}_getAxis(){return this.orientation===Ue?"x":"y"}_getDimension(){return this.orientation===Ue?"width":"height"}_getOppositeDimension(){return this.orientation===Ue?"height":"width"}_destroyDragHelper(){this._handleDragHelper&&this._handleDragHelper.destroy()}_setHandleDraggingEnabled(e){this._handleDragHelper&&(this._handleDragHelper.enabled=e)}onEnable(){this._setHandleDraggingEnabled(!0)}onDisable(){this._setHandleDraggingEnabled(!1)}onRemove(){this._destroyDragHelper(),this._toggleLifecycleListeners("off")}resolveDuplicatedEntityReferenceProperties(e,t){e.handleEntity&&(this.handleEntity=t[e.handleEntity.getGuid()])}};Sk.EVENT_SETVALUE="set:value";let u2=Sk;class J1e{constructor(){this.enabled=!0,this.orientation=Ue,this.value=0,this.handleSize=0,this.handleEntity=null}}const rV=[{name:"enabled",type:"boolean"},{name:"orientation",type:"number"},{name:"value",type:"number"},{name:"handleSize",type:"number"}];class eCe extends si{constructor(e){super(e),this.id="scrollbar",this.ComponentType=u2,this.DataType=J1e,this.schema=rV,this.on("add",this._onAddComponent,this),this.on("beforeremove",this._onRemoveComponent,this)}initializeComponentData(e,t,i){super.initializeComponentData(e,t,rV),e.handleEntity=t.handleEntity}_onAddComponent(e){e.fire("scrollbar:add")}_onRemoveComponent(e,t){t.onRemove()}}const tCe={volume:0,pitch:0,loop:!1,startTime:0,duration:0,position:new O,maxDistance:0,refDistance:0,rollOffFactor:0,distanceModel:0,onPlay:null,onPause:null,onResume:null,onStop:null,onEnd:null},Fl=class Fl extends Te{constructor(e,t="Untitled",i={}){super(),this.instances=[],this._component=e,this._assets=e.system.app.assets,this._manager=e.system.manager,this.name=t,this._volume=i.volume!==void 0?Q.clamp(Number(i.volume)||0,0,1):1,this._pitch=i.pitch!==void 0?Math.max(.01,Number(i.pitch)||0):1,this._loop=!!(i.loop!==void 0&&i.loop),this._duration=i.duration>0?i.duration:null,this._startTime=Math.max(0,Number(i.startTime)||0),this._overlap=!!i.overlap,this._autoPlay=!!i.autoPlay,this._firstNode=null,this._lastNode=null,this._asset=i.asset,this._asset instanceof be&&(this._asset=this._asset.id),this._onInstancePlayHandler=this._onInstancePlay.bind(this),this._onInstancePauseHandler=this._onInstancePause.bind(this),this._onInstanceResumeHandler=this._onInstanceResume.bind(this),this._onInstanceStopHandler=this._onInstanceStop.bind(this),this._onInstanceEndHandler=this._onInstanceEnd.bind(this)}play(){if(this.overlap||this.stop(),!this.isLoaded&&!this._hasAsset())return;const e=this._createInstance();if(this.instances.push(e),this.isLoaded)e.play();else{const t=function(i){const s=e._playWhenLoaded;e.sound=i,s&&e.play()};this.off("load",t),this.once("load",t),this.load()}return e}pause(){let e=!1;const t=this.instances;for(let i=0,s=t.length;i<s;i++)t[i].pause()&&(e=!0);return e}resume(){let e=!1;const t=this.instances;for(let i=0,s=t.length;i<s;i++)t[i].resume()&&(e=!0);return e}stop(){let e=!1;const t=this.instances;let i=t.length;for(;i--;)t[i].stop(),e=!0;return t.length=0,e}load(){if(!this._hasAsset())return;const e=this._assets.get(this._asset);if(!e){this._assets.off(`add:${this._asset}`,this._onAssetAdd,this),this._assets.once(`add:${this._asset}`,this._onAssetAdd,this);return}if(e.off("remove",this._onAssetRemoved,this),e.on("remove",this._onAssetRemoved,this),!e.resource){e.off("load",this._onAssetLoad,this),e.once("load",this._onAssetLoad,this),this._assets.load(e);return}this.fire("load",e.resource)}setExternalNodes(e,t){if(!e){console.error("The firstNode must have a valid AudioNode");return}if(t||(t=e),this._firstNode=e,this._lastNode=t,!this._overlap){const i=this.instances;for(let s=0,n=i.length;s<n;s++)i[s].setExternalNodes(e,t)}}clearExternalNodes(){if(this._firstNode=null,this._lastNode=null,!this._overlap){const e=this.instances;for(let t=0,i=e.length;t<i;t++)e[t].clearExternalNodes()}}getExternalNodes(){return[this._firstNode,this._lastNode]}_hasAsset(){return this._asset!=null}_createInstance(){let e=null;const t=this._component;let i=null;if(this._hasAsset()){const n=this._assets.get(this._asset);n&&(i=n.resource)}const s=tCe;return s.volume=this._volume*t.volume,s.pitch=this._pitch*t.pitch,s.loop=this._loop,s.startTime=this._startTime,s.duration=this._duration,s.onPlay=this._onInstancePlayHandler,s.onPause=this._onInstancePauseHandler,s.onResume=this._onInstanceResumeHandler,s.onStop=this._onInstanceStopHandler,s.onEnd=this._onInstanceEndHandler,t.positional?(s.position.copy(t.entity.getPosition()),s.maxDistance=t.maxDistance,s.refDistance=t.refDistance,s.rollOffFactor=t.rollOffFactor,s.distanceModel=t.distanceModel,e=new Md(this._manager,i,s)):e=new Io(this._manager,i,s),this._firstNode&&e.setExternalNodes(this._firstNode,this._lastNode),e}_onInstancePlay(e){this.fire("play",e),this._component.fire("play",this,e)}_onInstancePause(e){this.fire("pause",e),this._component.fire("pause",this,e)}_onInstanceResume(e){this.fire("resume",e),this._component.fire("resume",this,e)}_onInstanceStop(e){const t=this.instances.indexOf(e);t!==-1&&this.instances.splice(t,1),this.fire("stop",e),this._component.fire("stop",this,e)}_onInstanceEnd(e){const t=this.instances.indexOf(e);t!==-1&&this.instances.splice(t,1),this.fire("end",e),this._component.fire("end",this,e)}_onAssetAdd(e){this.load()}_onAssetLoad(e){this.load()}_onAssetRemoved(e){e.off("remove",this._onAssetRemoved,this),this._assets.off(`add:${e.id}`,this._onAssetAdd,this),this.stop()}updatePosition(e){const t=this.instances;for(let i=0,s=t.length;i<s;i++)t[i].position=e}set asset(e){const t=this._asset;if(t){this._assets.off(`add:${t}`,this._onAssetAdd,this);const i=this._assets.get(t);i&&i.off("remove",this._onAssetRemoved,this)}this._asset=e,this._asset instanceof be&&(this._asset=this._asset.id),this._hasAsset()&&this._component.enabled&&this._component.entity.enabled&&this.load()}get asset(){return this._asset}set autoPlay(e){this._autoPlay=!!e}get autoPlay(){return this._autoPlay}set duration(e){if(this._duration=Math.max(0,Number(e)||0)||null,!this._overlap){const t=this.instances;for(let i=0,s=t.length;i<s;i++)t[i].duration=this._duration}}get duration(){let e=0;if(this._hasAsset()){const t=this._assets.get(this._asset);e=t!=null&&t.resource?t.resource.duration:0}return this._duration!=null?this._duration%(e||1):e}get isLoaded(){if(this._hasAsset()){const e=this._assets.get(this._asset);if(e)return!!e.resource}return!1}get isPaused(){const e=this.instances,t=e.length;if(t===0)return!1;for(let i=0;i<t;i++)if(!e[i].isPaused)return!1;return!0}get isPlaying(){const e=this.instances;for(let t=0,i=e.length;t<i;t++)if(e[t].isPlaying)return!0;return!1}get isStopped(){const e=this.instances;for(let t=0,i=e.length;t<i;t++)if(!e[t].isStopped)return!1;return!0}set loop(e){this._loop=!!e;const t=this.instances;for(let i=0,s=t.length;i<s;i++)t[i].loop=this._loop}get loop(){return this._loop}set overlap(e){this._overlap=!!e}get overlap(){return this._overlap}set pitch(e){if(this._pitch=Math.max(Number(e)||0,.01),!this._overlap){const t=this.instances;for(let i=0,s=t.length;i<s;i++)t[i].pitch=this.pitch*this._component.pitch}}get pitch(){return this._pitch}set startTime(e){if(this._startTime=Math.max(0,Number(e)||0),!this._overlap){const t=this.instances;for(let i=0,s=t.length;i<s;i++)t[i].startTime=this._startTime}}get startTime(){return this._startTime}set volume(e){if(this._volume=Q.clamp(Number(e)||0,0,1),!this._overlap){const t=this.instances;for(let i=0,s=t.length;i<s;i++)t[i].volume=this._volume*this._component.volume}}get volume(){return this._volume}};Fl.EVENT_PLAY="play",Fl.EVENT_PAUSE="pause",Fl.EVENT_RESUME="resume",Fl.EVENT_STOP="stop",Fl.EVENT_END="end",Fl.EVENT_LOAD="load";let Zg=Fl;const yu=class yu extends ke{_updateSoundInstances(e,t,i){const s=this._slots;for(const n in s){const a=s[n];if(!a.overlap){const o=a.instances;for(let l=0,c=o.length;l<c;l++)o[l][e]=i?a[e]*t:t}}}set distanceModel(e){this._distanceModel=e,this._updateSoundInstances("distanceModel",e,!1)}get distanceModel(){return this._distanceModel}set maxDistance(e){this._maxDistance=e,this._updateSoundInstances("maxDistance",e,!1)}get maxDistance(){return this._maxDistance}set refDistance(e){this._refDistance=e,this._updateSoundInstances("refDistance",e,!1)}get refDistance(){return this._refDistance}set rollOffFactor(e){this._rollOffFactor=e,this._updateSoundInstances("rollOffFactor",e,!1)}get rollOffFactor(){return this._rollOffFactor}set pitch(e){this._pitch=e,this._updateSoundInstances("pitch",e,!0)}get pitch(){return this._pitch}set volume(e){this._volume=e,this._updateSoundInstances("volume",e,!0)}get volume(){return this._volume}set positional(e){this._positional=e;const t=this._slots;for(const i in t){const s=t[i];if(!s.overlap){const n=s.instances,a=n.length;for(let o=a-1;o>=0;o--){const l=n[o].isPlaying||n[o].isSuspended,c=n[o].currentTime;l&&n[o].stop();const u=s._createInstance();l&&(u.play(),u.currentTime=c),n.push(u)}}}}get positional(){return this._positional}set slots(e){const t=this._slots;if(t)for(const s in t)t[s].stop();const i={};for(const s in e)e[s]instanceof Zg?i[e[s].name]=e[s]:e[s].name&&(i[e[s].name]=new Zg(this,e[s].name,e[s]));this._slots=i,this.enabled&&this.entity.enabled&&this.onEnable()}get slots(){return this._slots}onEnable(){if(this.system._inTools)return;const e=this._slots,t=this._playingBeforeDisable;for(const i in e){const s=e[i];s.autoPlay&&s.isStopped?s.play():t[i]?s.resume():s.isLoaded||s.load()}}onDisable(){const e=this._slots,t={};for(const i in e)e[i].overlap||e[i].isPlaying&&(e[i].pause(),t[i]=!0);this._playingBeforeDisable=t}onRemove(){this.off()}addSlot(e,t){const i=this._slots;if(i[e])return null;const s=new Zg(this,e,t);return i[e]=s,s.autoPlay&&this.enabled&&this.entity.enabled&&s.play(),s}removeSlot(e){const t=this._slots;t[e]&&(t[e].stop(),delete t[e])}slot(e){return this._slots[e]}_getSlotProperty(e,t){if(!this.enabled||!this.entity.enabled)return;const i=this._slots[e];if(i)return i[t]}isPlaying(e){return this._getSlotProperty(e,"isPlaying")||!1}isLoaded(e){return this._getSlotProperty(e,"isLoaded")||!1}isPaused(e){return this._getSlotProperty(e,"isPaused")||!1}isStopped(e){return this._getSlotProperty(e,"isStopped")||!1}play(e){if(!this.enabled||!this.entity.enabled)return null;const t=this._slots[e];return t?t.play():null}pause(e){const t=this._slots;if(e){const i=t[e];if(!i)return;i.pause()}else for(const i in t)t[i].pause()}resume(e){const t=this._slots;if(e){const i=t[e];if(!i)return;i.isPaused&&i.resume()}else for(const i in t)t[i].resume()}stop(e){const t=this._slots;if(e){const i=t[e];if(!i)return;i.stop()}else for(const i in t)t[i].stop()}constructor(...e){super(...e),this._volume=1,this._pitch=1,this._positional=!0,this._refDistance=1,this._maxDistance=1e4,this._rollOffFactor=1,this._distanceModel=u3,this._slots={},this._playingBeforeDisable={}}};yu.EVENT_PLAY="play",yu.EVENT_PAUSE="pause",yu.EVENT_RESUME="resume",yu.EVENT_STOP="stop",yu.EVENT_END="end";let Ob=yu;class iCe{constructor(){this.enabled=!0}}const AY=["enabled"];class rCe extends si{constructor(e){super(e),this.id="sound",this.ComponentType=Ob,this.DataType=iCe,this.schema=AY,this.manager=e.soundManager,this.app.systems.on("update",this.onUpdate,this),this.on("beforeremove",this.onBeforeRemove,this)}set volume(e){this.manager.volume=e}get volume(){return this.manager.volume}get context(){return Ey()?this.manager.context:null}initializeComponentData(e,t,i){i=["volume","pitch","positional","refDistance","maxDistance","rollOffFactor","distanceModel","slots"];for(let s=0;s<i.length;s++)t.hasOwnProperty(i[s])&&(e[i[s]]=t[i[s]]);super.initializeComponentData(e,t,["enabled"])}cloneComponent(e,t){const i=e.sound,s=i.slots,n={};for(const o in s){const l=s[o];n[o]={name:l.name,volume:l.volume,pitch:l.pitch,loop:l.loop,duration:l.duration,startTime:l.startTime,overlap:l.overlap,autoPlay:l.autoPlay,asset:l.asset}}const a={distanceModel:i.distanceModel,enabled:i.enabled,maxDistance:i.maxDistance,pitch:i.pitch,positional:i.positional,refDistance:i.refDistance,rollOffFactor:i.rollOffFactor,slots:n,volume:i.volume};return this.addComponent(t,a)}onUpdate(e){const t=this.store;for(const i in t)if(t.hasOwnProperty(i)){const n=t[i].entity;if(n.enabled){const a=n.sound;if(a.enabled&&a.positional){const o=n.getPosition(),l=a.slots;for(const c in l)l[c].updatePosition(o)}}}}onBeforeRemove(e,t){const i=t.slots;for(const s in i)i[s].overlap||i[s].stop();t.onRemove()}destroy(){super.destroy(),this.app.systems.off("update",this.onUpdate,this)}}ke._buildAccessors(Ob.prototype,AY);const sV="simple",nV="animated",Bl=class Bl extends Te{constructor(e,t){super(),this._evtSetMeshes=null,this._component=e,this._frame=0,this._sprite=null,this._spriteAsset=null,this.spriteAsset=t.spriteAsset,this.name=t.name,this.fps=t.fps||0,this.loop=t.loop||!1,this._playing=!1,this._paused=!1,this._time=0}get duration(){if(this._sprite){const e=this.fps||Number.MIN_VALUE;return this._sprite.frameKeys.length/Math.abs(e)}return 0}set frame(e){this._setFrame(e);const t=this.fps||Number.MIN_VALUE;this._setTime(this._frame/t)}get frame(){return this._frame}get isPaused(){return this._paused}get isPlaying(){return this._playing}set sprite(e){var t;if(this._sprite&&((t=this._evtSetMeshes)==null||t.off(),this._evtSetMeshes=null,this._sprite.off("set:pixelsPerUnit",this._onSpritePpuChanged,this),this._sprite.off("set:atlas",this._onSpriteMeshesChange,this),this._sprite.atlas&&this._sprite.atlas.off("set:texture",this._onSpriteMeshesChange,this)),this._sprite=e,this._sprite&&(this._evtSetMeshes=this._sprite.on("set:meshes",this._onSpriteMeshesChange,this),this._sprite.on("set:pixelsPerUnit",this._onSpritePpuChanged,this),this._sprite.on("set:atlas",this._onSpriteMeshesChange,this),this._sprite.atlas&&this._sprite.atlas.on("set:texture",this._onSpriteMeshesChange,this)),this._component.currentClip===this){let i;!e||!e.atlas?(i=this._component._meshInstance,i&&(i.deleteParameter("texture_emissiveMap"),i.deleteParameter("texture_opacityMap")),this._component._hideModel()):(e.atlas.texture&&(i=this._component._meshInstance,i&&(i.setParameter("texture_emissiveMap",e.atlas.texture),i.setParameter("texture_opacityMap",e.atlas.texture)),this._component.enabled&&this._component.entity.enabled&&this._component._showModel()),this.time&&this.fps?this.time=this.time:this.frame=this.frame)}}get sprite(){return this._sprite}set spriteAsset(e){const t=this._component.system.app.assets;let i=e;if(e instanceof be&&(i=e.id),this._spriteAsset!==i){if(this._spriteAsset){const s=t.get(this._spriteAsset);s&&this._unbindSpriteAsset(s)}if(this._spriteAsset=i,this._spriteAsset){const s=t.get(this._spriteAsset);s?this._bindSpriteAsset(s):(this.sprite=null,t.on(`add:${this._spriteAsset}`,this._onSpriteAssetAdded,this))}else this.sprite=null}}get spriteAsset(){return this._spriteAsset}set time(e){this._setTime(e),this._sprite?this.frame=Math.min(this._sprite.frameKeys.length-1,Math.floor(this._time*Math.abs(this.fps))):this.frame=0}get time(){return this._time}_onSpriteAssetAdded(e){this._component.system.app.assets.off(`add:${e.id}`,this._onSpriteAssetAdded,this),this._spriteAsset===e.id&&this._bindSpriteAsset(e)}_bindSpriteAsset(e){e.on("load",this._onSpriteAssetLoad,this),e.on("remove",this._onSpriteAssetRemove,this),e.resource?this._onSpriteAssetLoad(e):this._component.system.app.assets.load(e)}_unbindSpriteAsset(e){e&&(e.off("load",this._onSpriteAssetLoad,this),e.off("remove",this._onSpriteAssetRemove,this),e.resource&&!e.resource.atlas&&this._component.system.app.assets.off(`load:${e.data.textureAtlasAsset}`,this._onTextureAtlasLoad,this))}_onSpriteAssetLoad(e){if(!e.resource)this.sprite=null;else if(e.resource.atlas)this.sprite=e.resource;else{const t=e.data.textureAtlasAsset,i=this._component.system.app.assets;i.off(`load:${t}`,this._onTextureAtlasLoad,this),i.once(`load:${t}`,this._onTextureAtlasLoad,this)}}_onTextureAtlasLoad(e){const t=this._spriteAsset;t instanceof be?this._onSpriteAssetLoad(t):this._onSpriteAssetLoad(this._component.system.app.assets.get(t))}_onSpriteAssetRemove(e){this.sprite=null}_onSpriteMeshesChange(){this._component.currentClip===this&&this._component._showFrame(this.frame)}_onSpritePpuChanged(){this._component.currentClip===this&&this.sprite.renderMode!==Ca&&this._component._showFrame(this.frame)}_update(e){if(this.fps===0||!this._playing||this._paused||!this._sprite)return;const t=this.fps<0?-1:1,i=this._time+e*this._component.speed*t,s=this.duration,n=i>s||i<0;this._setTime(i);let a=this.frame;this._sprite?a=Math.floor(this._sprite.frameKeys.length*this._time/s):a=0,a!==this._frame&&this._setFrame(a),n&&(this.loop?(this.fire("loop"),this._component.fire("loop",this)):(this._playing=!1,this._paused=!1,this.fire("end"),this._component.fire("end",this)))}_setTime(e){this._time=e;const t=this.duration;this._time<0?this.loop?this._time=this._time%t+t:this._time=0:this._time>t&&(this.loop?this._time%=t:this._time=t)}_setFrame(e){this._sprite?this._frame=Q.clamp(e,0,this._sprite.frameKeys.length-1):this._frame=e,this._component.currentClip===this&&this._component._showFrame(this._frame)}_destroy(){if(this._spriteAsset){const e=this._component.system.app.assets;this._unbindSpriteAsset(e.get(this._spriteAsset))}this._sprite&&(this.sprite=null),this._spriteAsset&&(this.spriteAsset=null)}play(){this._playing||(this._playing=!0,this._paused=!1,this.frame=0,this.fire("play"),this._component.fire("play",this))}pause(){!this._playing||this._paused||(this._paused=!0,this.fire("pause"),this._component.fire("pause",this))}resume(){this._paused&&(this._paused=!1,this.fire("resume"),this._component.fire("resume",this))}stop(){this._playing&&(this._playing=!1,this._paused=!1,this._time=0,this.frame=0,this.fire("stop"),this._component.fire("stop",this))}};Bl.EVENT_PLAY="play",Bl.EVENT_PAUSE="pause",Bl.EVENT_RESUME="resume",Bl.EVENT_STOP="stop",Bl.EVENT_END="end",Bl.EVENT_LOOP="loop";let Qg=Bl;const aV="texture_emissiveMap",oV="texture_opacityMap",lV="material_emissive",cV="material_opacity",sCe="innerOffset",nCe="outerScale",aCe="atlasRect",Ul=class Ul extends ke{constructor(e,t){super(e,t),this._evtLayersChanged=null,this._evtLayerAdded=null,this._evtLayerRemoved=null,this._type=sV,this._material=e.defaultMaterial,this._color=new ae(1,1,1,1),this._colorUniform=new Float32Array(3),this._speed=1,this._flipX=!1,this._flipY=!1,this._width=1,this._height=1,this._drawOrder=0,this._layers=[nl],this._outerScale=new ee(1,1),this._outerScaleUniform=new Float32Array(2),this._innerOffset=new ce,this._innerOffsetUniform=new Float32Array(4),this._atlasRect=new ce,this._atlasRectUniform=new Float32Array(4),this._batchGroupId=-1,this._batchGroup=null,this._node=new Xt,this._model=new al,this._model.graph=this._node,this._meshInstance=null,t.addChild(this._model.graph),this._model._entity=t,this._updateAabbFunc=this._updateAabb.bind(this),this._addedModel=!1,this._autoPlayClip=null,this._clips={},this._defaultClip=new Qg(this,{name:this.entity.name,fps:0,loop:!1,spriteAsset:null}),this._currentClip=this._defaultClip}set type(e){this._type!==e&&(this._type=e,this._type===sV?(this.stop(),this._currentClip=this._defaultClip,this.enabled&&this.entity.enabled&&(this._currentClip.frame=this.frame,this._currentClip.sprite?this._showModel():this._hideModel())):this._type===nV&&(this.stop(),this._autoPlayClip&&this._tryAutoPlay(),this._currentClip&&this._currentClip.isPlaying&&this.enabled&&this.entity.enabled?this._showModel():this._hideModel()))}get type(){return this._type}set frame(e){this._currentClip.frame=e}get frame(){return this._currentClip.frame}set spriteAsset(e){this._defaultClip.spriteAsset=e}get spriteAsset(){return this._defaultClip._spriteAsset}set sprite(e){this._currentClip.sprite=e}get sprite(){return this._currentClip.sprite}set material(e){this._material=e,this._meshInstance&&(this._meshInstance.material=e)}get material(){return this._material}set color(e){this._color.r=e.r,this._color.g=e.g,this._color.b=e.b,this._meshInstance&&(this._colorUniform[0]=this._color.r,this._colorUniform[1]=this._color.g,this._colorUniform[2]=this._color.b,this._meshInstance.setParameter(lV,this._colorUniform))}get color(){return this._color}set opacity(e){this._color.a=e,this._meshInstance&&this._meshInstance.setParameter(cV,e)}get opacity(){return this._color.a}set clips(e){if(!e){for(const t in this._clips)this.removeClip(t);return}for(const t in this._clips){let i=!1;for(const s in e)if(e[s].name===t){i=!0,this._clips[t].fps=e[s].fps,this._clips[t].loop=e[s].loop,e[s].hasOwnProperty("sprite")?this._clips[t].sprite=e[s].sprite:e[s].hasOwnProperty("spriteAsset")&&(this._clips[t].spriteAsset=e[s].spriteAsset);break}i||this.removeClip(t)}for(const t in e)this._clips[e[t].name]||this.addClip(e[t]);this._autoPlayClip&&this._tryAutoPlay(),(!this._currentClip||!this._currentClip.sprite)&&this._hideModel()}get clips(){return this._clips}get currentClip(){return this._currentClip}set speed(e){this._speed=e}get speed(){return this._speed}set flipX(e){this._flipX!==e&&(this._flipX=e,this._updateTransform())}get flipX(){return this._flipX}set flipY(e){this._flipY!==e&&(this._flipY=e,this._updateTransform())}get flipY(){return this._flipY}set width(e){e!==this._width&&(this._width=e,this._outerScale.x=this._width,this.sprite&&(this.sprite.renderMode===Oi||this.sprite.renderMode===Li)&&this._updateTransform())}get width(){return this._width}set height(e){e!==this._height&&(this._height=e,this._outerScale.y=this.height,this.sprite&&(this.sprite.renderMode===Oi||this.sprite.renderMode===Li)&&this._updateTransform())}get height(){return this._height}set batchGroupId(e){var i,s;if(this._batchGroupId===e)return;const t=this._batchGroupId;this._batchGroupId=e,this.entity.enabled&&t>=0&&((i=this.system.app.batcher)==null||i.remove(Bi.SPRITE,t,this.entity)),this.entity.enabled&&e>=0?(s=this.system.app.batcher)==null||s.insert(Bi.SPRITE,e,this.entity):t>=0&&this._currentClip&&this._currentClip.sprite&&this.enabled&&this.entity.enabled&&this._showModel()}get batchGroupId(){return this._batchGroupId}set autoPlayClip(e){this._autoPlayClip=e instanceof Qg?e.name:e,this._tryAutoPlay()}get autoPlayClip(){return this._autoPlayClip}set drawOrder(e){this._drawOrder=e,this._meshInstance&&(this._meshInstance.drawOrder=e)}get drawOrder(){return this._drawOrder}set layers(e){this._addedModel&&this._hideModel(),this._layers=e,this._meshInstance&&this.enabled&&this.entity.enabled&&this._showModel()}get layers(){return this._layers}get aabb(){return this._meshInstance?this._meshInstance.aabb:null}onEnable(){var s;const e=this.system.app,t=e.scene,i=t.layers;this._evtLayersChanged=t.on("set:layers",this._onLayersChanged,this),i&&(this._evtLayerAdded=i.on("add",this._onLayerAdded,this),this._evtLayerRemoved=i.on("remove",this._onLayerRemoved,this)),this._showModel(),this._autoPlayClip&&this._tryAutoPlay(),this._batchGroupId>=0&&((s=e.batcher)==null||s.insert(Bi.SPRITE,this._batchGroupId,this.entity))}onDisable(){var s,n,a,o;const e=this.system.app,i=e.scene.layers;(s=this._evtLayersChanged)==null||s.off(),this._evtLayersChanged=null,i&&((n=this._evtLayerAdded)==null||n.off(),this._evtLayerAdded=null,(a=this._evtLayerRemoved)==null||a.off(),this._evtLayerRemoved=null),this.stop(),this._hideModel(),this._batchGroupId>=0&&((o=e.batcher)==null||o.remove(Bi.SPRITE,this._batchGroupId,this.entity))}onDestroy(){var e;this._currentClip=null,this._defaultClip&&(this._defaultClip._destroy(),this._defaultClip=null);for(const t in this._clips)this._clips[t]._destroy();this._clips=null,this._hideModel(),this._model=null,(e=this._node)==null||e.remove(),this._node=null,this._meshInstance&&(this._meshInstance.material=null,this._meshInstance.mesh=null,this._meshInstance=null)}_showModel(){if(this._addedModel||!this._meshInstance)return;const e=[this._meshInstance];for(let t=0,i=this._layers.length;t<i;t++){const s=this.system.app.scene.layers.getLayerById(this._layers[t]);s&&s.addMeshInstances(e)}this._addedModel=!0}_hideModel(){if(!this._addedModel||!this._meshInstance)return;const e=[this._meshInstance];for(let t=0,i=this._layers.length;t<i;t++){const s=this.system.app.scene.layers.getLayerById(this._layers[t]);s&&s.removeMeshInstances(e)}this._addedModel=!1}_showFrame(e){if(!this.sprite)return;const t=this.sprite.meshes[e];if(!t){this._meshInstance&&(this._meshInstance.mesh=null,this._meshInstance.visible=!1);return}let i;if(this.sprite.renderMode===Li?i=this.system.default9SlicedMaterialSlicedMode:this.sprite.renderMode===Oi?i=this.system.default9SlicedMaterialTiledMode:i=this.system.defaultMaterial,this._meshInstance||(this._meshInstance=new Dt(t,this._material,this._node),this._meshInstance.castShadow=!1,this._meshInstance.receiveShadow=!1,this._meshInstance.drawOrder=this._drawOrder,this._model.meshInstances.push(this._meshInstance),this._colorUniform[0]=this._color.r,this._colorUniform[1]=this._color.g,this._colorUniform[2]=this._color.b,this._meshInstance.setParameter(lV,this._colorUniform),this._meshInstance.setParameter(cV,this._color.a),this.enabled&&this.entity.enabled&&this._showModel()),this._meshInstance.material!==i&&(this._meshInstance.material=i),this._meshInstance.mesh!==t&&(this._meshInstance.mesh=t,this._meshInstance.visible=!0,this._meshInstance._aabbVer=-1),this.sprite.atlas&&this.sprite.atlas.texture?(this._meshInstance.setParameter(aV,this.sprite.atlas.texture),this._meshInstance.setParameter(oV,this.sprite.atlas.texture)):(this._meshInstance.deleteParameter(aV),this._meshInstance.deleteParameter(oV)),this.sprite.atlas&&(this.sprite.renderMode===Li||this.sprite.renderMode===Oi)){this._meshInstance._updateAabbFunc=this._updateAabbFunc;const s=this.sprite.atlas.frames[this.sprite.frameKeys[e]];if(s){const n=2/s.rect.z,a=2/s.rect.w;this._innerOffset.set(s.border.x*n,s.border.y*a,s.border.z*n,s.border.w*a);const o=this.sprite.atlas.texture;this._atlasRect.set(s.rect.x/o.width,s.rect.y/o.height,s.rect.z/o.width,s.rect.w/o.height)}else this._innerOffset.set(0,0,0,0);this._innerOffsetUniform[0]=this._innerOffset.x,this._innerOffsetUniform[1]=this._innerOffset.y,this._innerOffsetUniform[2]=this._innerOffset.z,this._innerOffsetUniform[3]=this._innerOffset.w,this._meshInstance.setParameter(sCe,this._innerOffsetUniform),this._atlasRectUniform[0]=this._atlasRect.x,this._atlasRectUniform[1]=this._atlasRect.y,this._atlasRectUniform[2]=this._atlasRect.z,this._atlasRectUniform[3]=this._atlasRect.w,this._meshInstance.setParameter(aCe,this._atlasRectUniform)}else this._meshInstance._updateAabbFunc=null;this._updateTransform()}_updateTransform(){let e=this.flipX?-1:1,t=this.flipY?-1:1,i=0,s=0;if(this.sprite&&(this.sprite.renderMode===Li||this.sprite.renderMode===Oi)){let n=1,a=1;if(this.sprite.atlas){const c=this.sprite.atlas.frames[this.sprite.frameKeys[this.frame]];c&&(n=c.rect.z,a=c.rect.w,i=(.5-c.pivot.x)*this._width,s=(.5-c.pivot.y)*this._height)}const o=n/this.sprite.pixelsPerUnit,l=a/this.sprite.pixelsPerUnit;this._outerScale.set(Math.max(this._width,this._innerOffset.x*o),Math.max(this._height,this._innerOffset.y*l)),e*=o,t*=l,this._outerScale.x/=o,this._outerScale.y/=l,e*=Q.clamp(this._width/(this._innerOffset.x*o),1e-4,1),t*=Q.clamp(this._height/(this._innerOffset.y*l),1e-4,1),this._meshInstance&&(this._outerScaleUniform[0]=this._outerScale.x,this._outerScaleUniform[1]=this._outerScale.y,this._meshInstance.setParameter(nCe,this._outerScaleUniform))}this._node.setLocalScale(e,t,1),this._node.setLocalPosition(i,s,0)}_updateAabb(e){return e.center.set(0,0,0),e.halfExtents.set(this._outerScale.x*.5,this._outerScale.y*.5,.001),e.setFromTransformedAabb(e,this._node.getWorldTransform()),e}_tryAutoPlay(){if(!this._autoPlayClip||this.type!==nV)return;const e=this._clips[this._autoPlayClip];e&&!e.isPlaying&&(!this._currentClip||!this._currentClip.isPlaying)&&this.enabled&&this.entity.enabled&&this.play(e.name)}_onLayersChanged(e,t){e.off("add",this.onLayerAdded,this),e.off("remove",this.onLayerRemoved,this),t.on("add",this.onLayerAdded,this),t.on("remove",this.onLayerRemoved,this),this.enabled&&this.entity.enabled&&this._showModel()}_onLayerAdded(e){this.layers.indexOf(e.id)<0||this._addedModel&&this.enabled&&this.entity.enabled&&this._meshInstance&&e.addMeshInstances([this._meshInstance])}_onLayerRemoved(e){!this._meshInstance||this.layers.indexOf(e.id)<0||e.removeMeshInstances([this._meshInstance])}removeModelFromLayers(){for(let e=0;e<this.layers.length;e++){const t=this.system.app.scene.layers.getLayerById(this.layers[e]);t&&t.removeMeshInstances([this._meshInstance])}}addClip(e){const t=new Qg(this,{name:e.name,fps:e.fps,loop:e.loop,spriteAsset:e.spriteAsset});return this._clips[e.name]=t,t.name&&t.name===this._autoPlayClip&&this._tryAutoPlay(),t}removeClip(e){delete this._clips[e]}clip(e){return this._clips[e]}play(e){const t=this._clips[e],i=this._currentClip;return i&&i!==t&&(i._playing=!1),this._currentClip=t,this._currentClip&&(this._currentClip=t,this._currentClip.play()),t}pause(){this._currentClip!==this._defaultClip&&this._currentClip.isPlaying&&this._currentClip.pause()}resume(){this._currentClip!==this._defaultClip&&this._currentClip.isPaused&&this._currentClip.resume()}stop(){this._currentClip!==this._defaultClip&&this._currentClip.stop()}};Ul.EVENT_PLAY="play",Ul.EVENT_PAUSE="pause",Ul.EVENT_RESUME="resume",Ul.EVENT_STOP="stop",Ul.EVENT_END="end",Ul.EVENT_LOOP="loop";let Nb=Ul;class oCe{constructor(){this.enabled=!0}}const CY=["enabled"];class lCe extends si{constructor(e){super(e),this.id="sprite",this.ComponentType=Nb,this.DataType=oCe,this.schema=CY,this._defaultTexture=null,this._defaultMaterial=null,this._default9SlicedMaterialSlicedMode=null,this._default9SlicedMaterialTiledMode=null,this.app.systems.on("update",this.onUpdate,this),this.on("beforeremove",this.onBeforeRemove,this)}set defaultMaterial(e){this._defaultMaterial=e}get defaultMaterial(){if(!this._defaultMaterial){const e=new we(this.app.graphicsDevice,{width:1,height:1,format:Ms,name:"sprite"}),t=new Uint8Array(e.lock());t[0]=t[1]=t[2]=t[3]=255,e.unlock();const i=new Ns;i.diffuse.set(0,0,0),i.emissive.set(1,1,1),i.emissiveMap=e,i.opacityMap=e,i.opacityMapChannel="a",i.useLighting=!1,i.useTonemap=!1,i.useFog=!1,i.useSkybox=!1,i.blendType=fh,i.depthWrite=!1,i.pixelSnap=!1,i.cull=Vi,i.update(),this._defaultTexture=e,this._defaultMaterial=i}return this._defaultMaterial}set default9SlicedMaterialSlicedMode(e){this._default9SlicedMaterialSlicedMode=e}get default9SlicedMaterialSlicedMode(){if(!this._default9SlicedMaterialSlicedMode){const e=this.defaultMaterial.clone();e.nineSlicedMode=Li,e.update(),this._default9SlicedMaterialSlicedMode=e}return this._default9SlicedMaterialSlicedMode}set default9SlicedMaterialTiledMode(e){this._default9SlicedMaterialTiledMode=e}get default9SlicedMaterialTiledMode(){if(!this._default9SlicedMaterialTiledMode){const e=this.defaultMaterial.clone();e.nineSlicedMode=Oi,e.update(),this._default9SlicedMaterialTiledMode=e}return this._default9SlicedMaterialTiledMode}destroy(){super.destroy(),this.app.systems.off("update",this.onUpdate,this),this._defaultTexture&&(this._defaultTexture.destroy(),this._defaultTexture=null)}initializeComponentData(e,t,i){if(t.enabled!==void 0&&(e.enabled=t.enabled),e.type=t.type,t.layers&&Array.isArray(t.layers)&&(e.layers=t.layers.slice(0)),t.drawOrder!==void 0&&(e.drawOrder=t.drawOrder),t.color!==void 0&&(t.color instanceof ae?e.color.set(t.color.r,t.color.g,t.color.b,t.opacity??1):e.color.set(t.color[0],t.color[1],t.color[2],t.opacity??1),e.color=e.color),t.opacity!==void 0&&(e.opacity=t.opacity),t.flipX!==void 0&&(e.flipX=t.flipX),t.flipY!==void 0&&(e.flipY=t.flipY),t.width!==void 0&&(e.width=t.width),t.height!==void 0&&(e.height=t.height),t.spriteAsset!==void 0&&(e.spriteAsset=t.spriteAsset),t.sprite&&(e.sprite=t.sprite),t.frame!==void 0&&(e.frame=t.frame),t.clips)for(const s in t.clips)e.addClip(t.clips[s]);t.speed!==void 0&&(e.speed=t.speed),t.autoPlayClip&&(e.autoPlayClip=t.autoPlayClip),e.batchGroupId=t.batchGroupId===void 0||t.batchGroupId===null?-1:t.batchGroupId,super.initializeComponentData(e,t,i)}cloneComponent(e,t){const i=e.sprite;return this.addComponent(t,{enabled:i.enabled,type:i.type,spriteAsset:i.spriteAsset,sprite:i.sprite,width:i.width,height:i.height,frame:i.frame,color:i.color.clone(),opacity:i.opacity,flipX:i.flipX,flipY:i.flipY,speed:i.speed,clips:i.clips,autoPlayClip:i.autoPlayClip,batchGroupId:i.batchGroupId,drawOrder:i.drawOrder,layers:i.layers.slice(0)})}onUpdate(e){const t=this.store;for(const i in t)if(t.hasOwnProperty(i)){const s=t[i];if(s.data.enabled&&s.entity.enabled){const n=s.entity.sprite;n._currentClip&&n._currentClip._update(e)}}}onBeforeRemove(e,t){t.onDestroy()}}ke._buildAccessors(Nb.prototype,CY);const hf=class hf extends ke{constructor(e,t){super(e,t),this._oldState=!0,this._size=new O,this.on("set_enabled",this._onSetEnabled,this)}set size(e){e instanceof O?this._size.copy(e):e instanceof Array&&e.length>=3&&this.size.set(e[0],e[1],e[2])}get size(){return this._size}onEnable(){this._checkState()}onDisable(){this._checkState()}_onSetEnabled(e,t,i){this._checkState()}_checkState(){const e=this.enabled&&this.entity.enabled;e!==this._oldState&&(this._oldState=e,this.fire("enable"),this.fire("state",this.enabled))}_onBeforeRemove(){this.fire("remove")}};hf.EVENT_ENABLE="enable",hf.EVENT_DISABLE="disable",hf.EVENT_STATE="state",hf.EVENT_REMOVE="remove";let kb=hf;class cCe{constructor(){this.enabled=!0}}const PY=["enabled"];class uCe extends si{constructor(e){super(e),this.id="zone",this.ComponentType=kb,this.DataType=cCe,this.schema=PY,this.on("beforeremove",this._onBeforeRemove,this)}initializeComponentData(e,t,i){e.enabled=t.hasOwnProperty("enabled")?!!t.enabled:!0,t.size&&(t.size instanceof O?e.size.copy(t.size):t.size instanceof Array&&t.size.length>=3&&e.size.set(t.size[0],t.size[1],t.size[2]))}cloneComponent(e,t){const i={enabled:e.zone.enabled,size:e.zone.size};return this.addComponent(t,i)}_onBeforeRemove(e,t){t._onBeforeRemove()}}ke._buildAccessors(kb.prototype,PY);class hCe{constructor(e,t){this.effect=e,this.inputTarget=t,this.outputTarget=null,this.name=e.constructor.name}}class dCe{constructor(e,t){this.app=e,this.camera=t,this.destinationRenderTarget=null,this.effects=[],this.enabled=!1,this.depthTarget=null,t.on("set:rect",this.onCameraRectChanged,this)}_allocateColorBuffer(e,t){const i=this.camera.rect,s=this.destinationRenderTarget,n=this.app.graphicsDevice,a=Math.floor(i.z*((s==null?void 0:s.width)??n.width)),o=Math.floor(i.w*((s==null?void 0:s.height)??n.height));return new we(n,{name:t,format:e,width:a,height:o,mipmaps:!1,minFilter:qe,magFilter:qe,addressU:ge,addressV:ge})}_createOffscreenTarget(e,t){const i=this.app.graphicsDevice,n=(this.destinationRenderTarget??i.backBuffer).isColorBufferSrgb(0),a=(t&&i.getRenderableHdrFormat([wi,or],!0))??(n?Ms:ct),o=`${this.camera.entity.name}-posteffect-${this.effects.length}`,l=this._allocateColorBuffer(a,o);return new Zi({colorBuffer:l,depth:e,stencil:e&&this.app.graphicsDevice.supportsStencil,samples:e?i.samples:1})}_resizeOffscreenTarget(e){const t=e.colorBuffer.format,i=e.colorBuffer.name;e.destroyFrameBuffers(),e.destroyTextureBuffers(),e._colorBuffer=this._allocateColorBuffer(t,i),e._colorBuffers=[e._colorBuffer]}_destroyOffscreenTarget(e){e.destroyTextureBuffers(),e.destroy()}addEffect(e){const t=this.effects,i=t.length===0,s=this._createOffscreenTarget(i,e.hdr),n=new hCe(e,s);t.push(n),this._sourceTarget=n.inputTarget,t.length>1&&(t[t.length-2].outputTarget=n.inputTarget),this._newPostEffect=e,e.needsDepthBuffer&&this._requestDepthMap(),this.enable(),this._newPostEffect=void 0}removeEffect(e){let t=-1;for(let i=0,s=this.effects.length;i<s;i++)if(this.effects[i].effect===e){t=i;break}t>=0&&(t>0?this.effects[t-1].outputTarget=t+1<this.effects.length?this.effects[t+1].inputTarget:null:this.effects.length>1&&(this.effects[1].inputTarget._depth||(this._destroyOffscreenTarget(this.effects[1].inputTarget),this.effects[1].inputTarget=this._createOffscreenTarget(!0,this.effects[1].hdr),this._sourceTarget=this.effects[1].inputTarget),this.camera.renderTarget=this.effects[1].inputTarget),this._destroyOffscreenTarget(this.effects[t].inputTarget),this.effects.splice(t,1)),this.enabled&&e.needsDepthBuffer&&this._releaseDepthMap(),this.effects.length===0&&this.disable()}_requestDepthMaps(){for(let e=0,t=this.effects.length;e<t;e++){const i=this.effects[e].effect;this._newPostEffect!==i&&i.needsDepthBuffer&&this._requestDepthMap()}}_releaseDepthMaps(){for(let e=0,t=this.effects.length;e<t;e++)this.effects[e].effect.needsDepthBuffer&&this._releaseDepthMap()}_requestDepthMap(){const e=this.app.scene.layers.getLayerById(As);e&&(e.incrementCounter(),this.camera.requestSceneDepthMap(!0))}_releaseDepthMap(){const e=this.app.scene.layers.getLayerById(As);e&&(e.decrementCounter(),this.camera.requestSceneDepthMap(!1))}destroy(){for(let e=0,t=this.effects.length;e<t;e++)this.effects[e].inputTarget.destroy();this.effects.length=0,this.disable()}enable(){!this.enabled&&this.effects.length&&(this.enabled=!0,this._requestDepthMaps(),this.app.graphicsDevice.on("resizecanvas",this._onCanvasResized,this),this.destinationRenderTarget=this.camera.renderTarget,this.camera.renderTarget=this.effects[0].inputTarget,this.camera.onPostprocessing=()=>{if(this.enabled){let e=null;const t=this.effects.length;if(t)for(let i=0;i<t;i++){const s=this.effects[i];let n=s.outputTarget;i===t-1&&(e=this.camera.rect,this.destinationRenderTarget&&(n=this.destinationRenderTarget)),s.effect.render(s.inputTarget,n,e)}}})}disable(){this.enabled&&(this.enabled=!1,this.app.graphicsDevice.off("resizecanvas",this._onCanvasResized,this),this._releaseDepthMaps(),this._destroyOffscreenTarget(this._sourceTarget),this.camera.renderTarget=this.destinationRenderTarget,this.camera.onPostprocessing=null)}_onCanvasResized(e,t){const i=this.camera.rect,s=this.destinationRenderTarget;e=(s==null?void 0:s.width)??e,t=(s==null?void 0:s.height)??t,this.camera.camera.aspectRatio=e*i.z/(t*i.w),this.resizeRenderTargets()}resizeRenderTargets(){const e=this.app.graphicsDevice,t=this.destinationRenderTarget,i=(t==null?void 0:t.width)??e.width,s=(t==null?void 0:t.height)??e.height,n=this.camera.rect,a=Math.floor(n.z*i),o=Math.floor(n.w*s),l=this.effects;for(let c=0,u=l.length;c<u;c++){const h=l[c];(h.inputTarget.width!==a||h.inputTarget.height!==o)&&this._resizeOffscreenTarget(h.inputTarget)}}onCameraRectChanged(e,t,i){this.enabled&&this.resizeRenderTargets()}}class IY extends ke{constructor(e,t){super(e,t),this.onPostprocessing=null,this._renderSceneDepthMap=0,this._renderSceneColorMap=0,this._sceneDepthMapRequested=!1,this._sceneColorMapRequested=!1,this._priority=0,this._disablePostEffectsLayer=LE,this._camera=new Iy,this._evtLayersChanged=null,this._evtLayerAdded=null,this._evtLayerRemoved=null,this._camera.node=t,this._postEffects=new dCe(e.app,this)}setShaderPass(e){const t=Va.get(this.system.app.graphicsDevice),i=e?t.allocate(e,{isForward:!0}):null;return this._camera.shaderPassInfo=i,i.index}getShaderPass(){var e;return(e=this._camera.shaderPassInfo)==null?void 0:e.name}set renderPasses(e){this._camera.renderPasses=e||[],this.dirtyLayerCompositionCameras(),this.system.app.scene.updateShaders=!0}get renderPasses(){return this._camera.renderPasses}get shaderParams(){return this._camera.shaderParams}set gammaCorrection(e){this.camera.shaderParams.gammaCorrection=e}get gammaCorrection(){return this.camera.shaderParams.gammaCorrection}set toneMapping(e){this.camera.shaderParams.toneMapping=e}get toneMapping(){return this.camera.shaderParams.toneMapping}set fog(e){this._camera.fogParams=e}get fog(){return this._camera.fogParams}set aperture(e){this._camera.aperture=e}get aperture(){return this._camera.aperture}set aspectRatio(e){this._camera.aspectRatio=e}get aspectRatio(){return this._camera.aspectRatio}set aspectRatioMode(e){this._camera.aspectRatioMode=e}get aspectRatioMode(){return this._camera.aspectRatioMode}set calculateProjection(e){this._camera.calculateProjection=e}get calculateProjection(){return this._camera.calculateProjection}set calculateTransform(e){this._camera.calculateTransform=e}get calculateTransform(){return this._camera.calculateTransform}get camera(){return this._camera}set clearColor(e){this._camera.clearColor=e}get clearColor(){return this._camera.clearColor}set clearColorBuffer(e){this._camera.clearColorBuffer=e,this.dirtyLayerCompositionCameras()}get clearColorBuffer(){return this._camera.clearColorBuffer}set clearDepthBuffer(e){this._camera.clearDepthBuffer=e,this.dirtyLayerCompositionCameras()}get clearDepthBuffer(){return this._camera.clearDepthBuffer}set clearStencilBuffer(e){this._camera.clearStencilBuffer=e,this.dirtyLayerCompositionCameras()}get clearStencilBuffer(){return this._camera.clearStencilBuffer}set cullFaces(e){this._camera.cullFaces=e}get cullFaces(){return this._camera.cullFaces}set disablePostEffectsLayer(e){this._disablePostEffectsLayer=e,this.dirtyLayerCompositionCameras()}get disablePostEffectsLayer(){return this._disablePostEffectsLayer}set farClip(e){this._camera.farClip=e}get farClip(){return this._camera.farClip}set flipFaces(e){this._camera.flipFaces=e}get flipFaces(){return this._camera.flipFaces}set fov(e){this._camera.fov=e}get fov(){return this._camera.fov}get frustum(){return this._camera.frustum}set frustumCulling(e){this._camera.frustumCulling=e}get frustumCulling(){return this._camera.frustumCulling}set horizontalFov(e){this._camera.horizontalFov=e}get horizontalFov(){return this._camera.horizontalFov}set layers(e){const t=this._camera.layers,i=this.system.app.scene;t.forEach(s=>{const n=i.layers.getLayerById(s);n==null||n.removeCamera(this)}),this._camera.layers=e,this.enabled&&this.entity.enabled&&e.forEach(s=>{const n=i.layers.getLayerById(s);n==null||n.addCamera(this)}),this.fire("set:layers")}get layers(){return this._camera.layers}get layersSet(){return this._camera.layersSet}set jitter(e){this._camera.jitter=e}get jitter(){return this._camera.jitter}set nearClip(e){this._camera.nearClip=e}get nearClip(){return this._camera.nearClip}set orthoHeight(e){this._camera.orthoHeight=e}get orthoHeight(){return this._camera.orthoHeight}get postEffects(){return this._postEffects}get postEffectsEnabled(){return this._postEffects.enabled}set priority(e){this._priority=e,this.dirtyLayerCompositionCameras()}get priority(){return this._priority}set projection(e){this._camera.projection=e}get projection(){return this._camera.projection}get projectionMatrix(){return this._camera.projectionMatrix}set rect(e){this._camera.rect=e,this.fire("set:rect",this._camera.rect)}get rect(){return this._camera.rect}set renderSceneColorMap(e){e&&!this._sceneColorMapRequested?(this.requestSceneColorMap(!0),this._sceneColorMapRequested=!0):this._sceneColorMapRequested&&(this.requestSceneColorMap(!1),this._sceneColorMapRequested=!1)}get renderSceneColorMap(){return this._renderSceneColorMap>0}set renderSceneDepthMap(e){e&&!this._sceneDepthMapRequested?(this.requestSceneDepthMap(!0),this._sceneDepthMapRequested=!0):this._sceneDepthMapRequested&&(this.requestSceneDepthMap(!1),this._sceneDepthMapRequested=!1)}get renderSceneDepthMap(){return this._renderSceneDepthMap>0}set renderTarget(e){this._camera.renderTarget=e,this.dirtyLayerCompositionCameras()}get renderTarget(){return this._camera.renderTarget}set scissorRect(e){this._camera.scissorRect=e}get scissorRect(){return this._camera.scissorRect}set sensitivity(e){this._camera.sensitivity=e}get sensitivity(){return this._camera.sensitivity}set shutter(e){this._camera.shutter=e}get shutter(){return this._camera.shutter}get viewMatrix(){return this._camera.viewMatrix}_enableDepthLayer(e){if(this.layers.find(i=>i===As)){const i=this.system.app.scene.layers.getLayerById(As);e?i==null||i.incrementCounter():i==null||i.decrementCounter()}else if(e)return!1;return!0}requestSceneColorMap(e){this._renderSceneColorMap+=e?1:-1,this._enableDepthLayer(e),this.camera._enableRenderPassColorGrab(this.system.app.graphicsDevice,this.renderSceneColorMap),this.system.app.scene.layers.markDirty()}requestSceneDepthMap(e){this._renderSceneDepthMap+=e?1:-1,this._enableDepthLayer(e),this.camera._enableRenderPassDepthGrab(this.system.app.graphicsDevice,this.system.app.renderer,this.renderSceneDepthMap),this.system.app.scene.layers.markDirty()}dirtyLayerCompositionCameras(){const e=this.system.app.scene.layers;e._dirty=!0}screenToWorld(e,t,i,s){const n=this.system.app.graphicsDevice,{width:a,height:o}=n.clientRect;return this._camera.screenToWorld(e,t,i,a,o,s)}worldToScreen(e,t){const i=this.system.app.graphicsDevice,{width:s,height:n}=i.clientRect;return this._camera.worldToScreen(e,s,n,t)}onAppPrerender(){this._camera._viewMatDirty=!0,this._camera._viewProjMatDirty=!0}addCameraToLayers(){const e=this.layers;for(let t=0;t<e.length;t++){const i=this.system.app.scene.layers.getLayerById(e[t]);i&&i.addCamera(this)}}removeCameraFromLayers(){const e=this.layers;for(let t=0;t<e.length;t++){const i=this.system.app.scene.layers.getLayerById(e[t]);i&&i.removeCamera(this)}}onLayersChanged(e,t){this.addCameraToLayers(),e.off("add",this.onLayerAdded,this),e.off("remove",this.onLayerRemoved,this),t.on("add",this.onLayerAdded,this),t.on("remove",this.onLayerRemoved,this)}onLayerAdded(e){this.layers.indexOf(e.id)<0||e.addCamera(this)}onLayerRemoved(e){this.layers.indexOf(e.id)<0||e.removeCamera(this)}onEnable(){var i,s,n;const e=this.system.app.scene,t=e.layers;this.system.addCamera(this),(i=this._evtLayersChanged)==null||i.off(),this._evtLayersChanged=e.on("set:layers",this.onLayersChanged,this),t&&((s=this._evtLayerAdded)==null||s.off(),this._evtLayerAdded=t.on("add",this.onLayerAdded,this),(n=this._evtLayerRemoved)==null||n.off(),this._evtLayerRemoved=t.on("remove",this.onLayerRemoved,this)),this.enabled&&this.entity.enabled&&this.addCameraToLayers(),this.postEffects.enable()}onDisable(){var i,s,n;const t=this.system.app.scene.layers;this.postEffects.disable(),this.removeCameraFromLayers(),(i=this._evtLayersChanged)==null||i.off(),this._evtLayersChanged=null,t&&((s=this._evtLayerAdded)==null||s.off(),this._evtLayerAdded=null,(n=this._evtLayerRemoved)==null||n.off(),this._evtLayerRemoved=null),this.system.removeCamera(this)}onRemove(){this.onDisable(),this.off(),this.camera.destroy()}calculateAspectRatio(e){const t=this.system.app.graphicsDevice,i=e?e.width:t.width,s=e?e.height:t.height;return i*this.rect.z/(s*this.rect.w)}frameUpdate(e){this.aspectRatioMode===N3&&(this.aspectRatio=this.calculateAspectRatio(e))}startXr(e,t,i){this.system.app.xr.start(this,e,t,i)}endXr(e){if(!this._camera.xr){e&&e(new Error("Camera is not in XR"));return}this._camera.xr.end(e)}copy(e){this.aperture=e.aperture,this.aspectRatio=e.aspectRatio,this.aspectRatioMode=e.aspectRatioMode,this.calculateProjection=e.calculateProjection,this.calculateTransform=e.calculateTransform,this.clearColor=e.clearColor,this.clearColorBuffer=e.clearColorBuffer,this.clearDepthBuffer=e.clearDepthBuffer,this.clearStencilBuffer=e.clearStencilBuffer,this.cullFaces=e.cullFaces,this.disablePostEffectsLayer=e.disablePostEffectsLayer,this.farClip=e.farClip,this.flipFaces=e.flipFaces,this.fov=e.fov,this.frustumCulling=e.frustumCulling,this.horizontalFov=e.horizontalFov,this.layers=e.layers,this.nearClip=e.nearClip,this.orthoHeight=e.orthoHeight,this.priority=e.priority,this.projection=e.projection,this.rect=e.rect,this.renderTarget=e.renderTarget,this.scissorRect=e.scissorRect,this.sensitivity=e.sensitivity,this.shutter=e.shutter}}class fCe{constructor(){this.enabled=!0}}const MY=["enabled"];class pCe extends si{constructor(e){super(e),this.cameras=[],this.id="camera",this.ComponentType=IY,this.DataType=fCe,this.schema=MY,this.on("beforeremove",this.onBeforeRemove,this),this.app.on("prerender",this.onAppPrerender,this)}initializeComponentData(e,t,i){i=["aspectRatio","aspectRatioMode","calculateProjection","calculateTransform","clearColor","clearColorBuffer","clearDepthBuffer","clearStencilBuffer","renderSceneColorMap","renderSceneDepthMap","cullFaces","farClip","flipFaces","fog","fov","frustumCulling","horizontalFov","layers","renderTarget","nearClip","orthoHeight","projection","priority","rect","scissorRect","aperture","shutter","sensitivity","gammaCorrection","toneMapping"];for(let s=0;s<i.length;s++){const n=i[s];if(t.hasOwnProperty(n)){const a=t[n];switch(n){case"rect":case"scissorRect":Array.isArray(a)?e[n]=new ce(a[0],a[1],a[2],a[3]):e[n]=a;break;case"clearColor":Array.isArray(a)?e[n]=new ae(a[0],a[1],a[2],a[3]):e[n]=a;break;default:e[n]=a;break}}}super.initializeComponentData(e,t,["enabled"])}cloneComponent(e,t){const i=e.camera;return this.addComponent(t,{aspectRatio:i.aspectRatio,aspectRatioMode:i.aspectRatioMode,calculateProjection:i.calculateProjection,calculateTransform:i.calculateTransform,clearColor:i.clearColor,clearColorBuffer:i.clearColorBuffer,clearDepthBuffer:i.clearDepthBuffer,clearStencilBuffer:i.clearStencilBuffer,renderSceneDepthMap:i.renderSceneDepthMap,renderSceneColorMap:i.renderSceneColorMap,cullFaces:i.cullFaces,enabled:i.enabled,farClip:i.farClip,flipFaces:i.flipFaces,fov:i.fov,frustumCulling:i.frustumCulling,horizontalFov:i.horizontalFov,layers:i.layers,renderTarget:i.renderTarget,nearClip:i.nearClip,orthoHeight:i.orthoHeight,projection:i.projection,priority:i.priority,rect:i.rect,scissorRect:i.scissorRect,aperture:i.aperture,sensitivity:i.sensitivity,shutter:i.shutter,gammaCorrection:i.gammaCorrection,toneMapping:i.toneMapping})}onBeforeRemove(e,t){this.removeCamera(t),t.onRemove()}onAppPrerender(){for(let e=0,t=this.cameras.length;e<t;e++)this.cameras[e].onAppPrerender()}addCamera(e){this.cameras.push(e),rv(this.cameras)}removeCamera(e){const t=this.cameras.indexOf(e);t>=0&&(this.cameras.splice(t,1),rv(this.cameras))}destroy(){this.app.off("prerender",this.onAppPrerender,this),super.destroy()}}ke._buildAccessors(IY.prototype,MY);class RY{constructor(){this.enabled=!0,this.type="directional",this.color=new ae(1,1,1),this.intensity=1,this.luminance=0,this.shape=Wn,this.affectSpecularity=!0,this.castShadows=!1,this.shadowDistance=40,this.shadowIntensity=1,this.shadowResolution=1024,this.shadowBias=.05,this.numCascades=1,this.cascadeBlend=0,this.bakeNumSamples=1,this.bakeArea=0,this.cascadeDistribution=.5,this.normalOffsetBias=0,this.range=10,this.innerConeAngle=40,this.outerConeAngle=45,this.falloffMode=b3,this.shadowType=Un,this.vsmBlurSize=11,this.vsmBlurMode=T3,this.vsmBias=.01*.25,this.cookieAsset=null,this.cookie=null,this.cookieIntensity=1,this.cookieFalloff=!0,this.cookieChannel="rgb",this.cookieAngle=0,this.cookieScale=null,this.cookieOffset=null,this.shadowUpdateMode=O3,this.mask=1,this.affectDynamic=!0,this.affectLightmapped=!1,this.bake=!1,this.bakeDir=!0,this.isStatic=!1,this.layers=[nl],this.penumbraSize=1,this.penumbraFalloff=1,this.shadowSamples=16,this.shadowBlockerSamples=16}}const Jg=Object.keys(new RY);class mCe extends ke{get data(){const e=this.system.store[this.entity.getGuid()];return e?e.data:null}set enabled(e){this._setValue("enabled",e,function(t,i){this.onSetEnabled(null,i,t)})}get enabled(){return this.data.enabled}set light(e){this._setValue("light",e)}get light(){return this.data.light}set type(e){this._setValue("type",e,function(t,i){this.system.changeType(this,i,t),this.refreshProperties()})}get type(){return this.data.type}set color(e){this._setValue("color",e,function(t,i){this.light.setColor(t)},!0)}get color(){return this.data.color}set intensity(e){this._setValue("intensity",e,function(t,i){this.light.intensity=t})}get intensity(){return this.data.intensity}set luminance(e){this._setValue("luminance",e,function(t,i){this.light.luminance=t})}get luminance(){return this.data.luminance}set shape(e){this._setValue("shape",e,function(t,i){this.light.shape=t})}get shape(){return this.data.shape}set affectSpecularity(e){this._setValue("affectSpecularity",e,function(t,i){this.light.affectSpecularity=t})}get affectSpecularity(){return this.data.affectSpecularity}set castShadows(e){this._setValue("castShadows",e,function(t,i){this.light.castShadows=t})}get castShadows(){return this.data.castShadows}set shadowDistance(e){this._setValue("shadowDistance",e,function(t,i){this.light.shadowDistance=t})}get shadowDistance(){return this.data.shadowDistance}set shadowIntensity(e){this._setValue("shadowIntensity",e,function(t,i){this.light.shadowIntensity=t})}get shadowIntensity(){return this.data.shadowIntensity}set shadowResolution(e){this._setValue("shadowResolution",e,function(t,i){this.light.shadowResolution=t})}get shadowResolution(){return this.data.shadowResolution}set shadowBias(e){this._setValue("shadowBias",e,function(t,i){this.light.shadowBias=-.01*Q.clamp(t,0,1)})}get shadowBias(){return this.data.shadowBias}set numCascades(e){this._setValue("numCascades",e,function(t,i){this.light.numCascades=Q.clamp(Math.floor(t),1,4)})}get numCascades(){return this.data.numCascades}set cascadeBlend(e){this._setValue("cascadeBlend",e,function(t,i){this.light.cascadeBlend=Q.clamp(t,0,1)})}get cascadeBlend(){return this.data.cascadeBlend}set bakeNumSamples(e){this._setValue("bakeNumSamples",e,function(t,i){this.light.bakeNumSamples=Q.clamp(Math.floor(t),1,255)})}get bakeNumSamples(){return this.data.bakeNumSamples}set bakeArea(e){this._setValue("bakeArea",e,function(t,i){this.light.bakeArea=Q.clamp(t,0,180)})}get bakeArea(){return this.data.bakeArea}set cascadeDistribution(e){this._setValue("cascadeDistribution",e,function(t,i){this.light.cascadeDistribution=Q.clamp(t,0,1)})}get cascadeDistribution(){return this.data.cascadeDistribution}set normalOffsetBias(e){this._setValue("normalOffsetBias",e,function(t,i){this.light.normalOffsetBias=Q.clamp(t,0,1)})}get normalOffsetBias(){return this.data.normalOffsetBias}set range(e){this._setValue("range",e,function(t,i){this.light.attenuationEnd=t})}get range(){return this.data.range}set innerConeAngle(e){this._setValue("innerConeAngle",e,function(t,i){this.light.innerConeAngle=t})}get innerConeAngle(){return this.data.innerConeAngle}set outerConeAngle(e){this._setValue("outerConeAngle",e,function(t,i){this.light.outerConeAngle=t})}get outerConeAngle(){return this.data.outerConeAngle}set falloffMode(e){this._setValue("falloffMode",e,function(t,i){this.light.falloffMode=t})}get falloffMode(){return this.data.falloffMode}set shadowType(e){this._setValue("shadowType",e,function(t,i){this.light.shadowType=t})}get shadowType(){return this.data.shadowType}set vsmBlurSize(e){this._setValue("vsmBlurSize",e,function(t,i){this.light.vsmBlurSize=t})}get vsmBlurSize(){return this.data.vsmBlurSize}set vsmBlurMode(e){this._setValue("vsmBlurMode",e,function(t,i){this.light.vsmBlurMode=t})}get vsmBlurMode(){return this.data.vsmBlurMode}set vsmBias(e){this._setValue("vsmBias",e,function(t,i){this.light.vsmBias=Q.clamp(t,0,1)})}get vsmBias(){return this.data.vsmBias}set cookieAsset(e){this._setValue("cookieAsset",e,function(t,i){if(!(this._cookieAssetId&&(t instanceof be&&t.id===this._cookieAssetId||t===this._cookieAssetId))){if(this.onCookieAssetRemove(),this._cookieAssetId=null,t instanceof be)this.data.cookieAsset=t.id,this._cookieAssetId=t.id,this.onCookieAssetAdd(t);else if(typeof t=="number"){this._cookieAssetId=t;const s=this.system.app.assets.get(t);s?this.onCookieAssetAdd(s):(this._cookieAssetAdd=!0,this.system.app.assets.on(`add:${this._cookieAssetId}`,this.onCookieAssetAdd,this))}}})}get cookieAsset(){return this.data.cookieAsset}set cookie(e){this._setValue("cookie",e,function(t,i){this.light.cookie=t})}get cookie(){return this.data.cookie}set cookieIntensity(e){this._setValue("cookieIntensity",e,function(t,i){this.light.cookieIntensity=Q.clamp(t,0,1)})}get cookieIntensity(){return this.data.cookieIntensity}set cookieFalloff(e){this._setValue("cookieFalloff",e,function(t,i){this.light.cookieFalloff=t})}get cookieFalloff(){return this.data.cookieFalloff}set cookieChannel(e){this._setValue("cookieChannel",e,function(t,i){this.light.cookieChannel=t})}get cookieChannel(){return this.data.cookieChannel}set cookieAngle(e){this._setValue("cookieAngle",e,function(t,i){if(t!==0||this.cookieScale!==null){this._cookieMatrix||(this._cookieMatrix=new ce);let s=1,n=1;this.cookieScale&&(s=this.cookieScale.x,n=this.cookieScale.y);const a=Math.cos(t*Q.DEG_TO_RAD),o=Math.sin(t*Q.DEG_TO_RAD);this._cookieMatrix.set(a/s,-o/s,o/n,a/n),this.light.cookieTransform=this._cookieMatrix}else this.light.cookieTransform=null})}get cookieAngle(){return this.data.cookieAngle}set cookieScale(e){this._setValue("cookieScale",e,function(t,i){if(t!==null||this.cookieAngle!==0){this._cookieMatrix||(this._cookieMatrix=new ce);const s=t.x,n=t.y,a=Math.cos(this.cookieAngle*Q.DEG_TO_RAD),o=Math.sin(this.cookieAngle*Q.DEG_TO_RAD);this._cookieMatrix.set(a/s,-o/s,o/n,a/n),this.light.cookieTransform=this._cookieMatrix}else this.light.cookieTransform=null},!0)}get cookieScale(){return this.data.cookieScale}set cookieOffset(e){this._setValue("cookieOffset",e,function(t,i){this.light.cookieOffset=t},!0)}get cookieOffset(){return this.data.cookieOffset}set shadowUpdateMode(e){this._setValue("shadowUpdateMode",e,function(t,i){this.light.shadowUpdateMode=t},!0)}get shadowUpdateMode(){return this.data.shadowUpdateMode}set mask(e){this._setValue("mask",e,function(t,i){this.light.mask=t})}get mask(){return this.data.mask}set affectDynamic(e){this._setValue("affectDynamic",e,function(t,i){t?this.light.mask|=Zn:this.light.mask&=-2,this.light.layersDirty()})}get affectDynamic(){return this.data.affectDynamic}set affectLightmapped(e){this._setValue("affectLightmapped",e,function(t,i){t?(this.light.mask|=ph,this.bake&&(this.light.mask&=-5)):(this.light.mask&=-3,this.bake&&(this.light.mask|=Wu))})}get affectLightmapped(){return this.data.affectLightmapped}set bake(e){this._setValue("bake",e,function(t,i){t?(this.light.mask|=Wu,this.affectLightmapped&&(this.light.mask&=-3)):(this.light.mask&=-5,this.affectLightmapped&&(this.light.mask|=ph)),this.light.layersDirty()})}get bake(){return this.data.bake}set bakeDir(e){this._setValue("bakeDir",e,function(t,i){this.light.bakeDir=t})}get bakeDir(){return this.data.bakeDir}set isStatic(e){this._setValue("isStatic",e,function(t,i){this.light.isStatic=t})}get isStatic(){return this.data.isStatic}set layers(e){this._setValue("layers",e,function(t,i){for(let s=0;s<i.length;s++){const n=this.system.app.scene.layers.getLayerById(i[s]);n&&(n.removeLight(this),this.light.removeLayer(n))}for(let s=0;s<t.length;s++){const n=this.system.app.scene.layers.getLayerById(t[s]);n&&this.enabled&&this.entity.enabled&&(n.addLight(this),this.light.addLayer(n))}})}get layers(){return this.data.layers}set shadowUpdateOverrides(e){this.light.shadowUpdateOverrides=e}get shadowUpdateOverrides(){return this.light.shadowUpdateOverrides}set shadowSamples(e){this.light.shadowSamples=e}get shadowSamples(){return this.light.shadowSamples}set shadowBlockerSamples(e){this.light.shadowBlockerSamples=e}get shadowBlockerSamples(){return this.light.shadowBlockerSamples}set penumbraSize(e){this.light.penumbraSize=e}get penumbraSize(){return this.light.penumbraSize}set penumbraFalloff(e){this.light.penumbraFalloff=e}get penumbraFalloff(){return this.light.penumbraFalloff}_setValue(e,t,i,s){const n=this.data,a=n[e];!s&&a===t||(n[e]=t,i&&i.call(this,t,a))}addLightToLayers(){for(let e=0;e<this.layers.length;e++){const t=this.system.app.scene.layers.getLayerById(this.layers[e]);t&&(t.addLight(this),this.light.addLayer(t))}}removeLightFromLayers(){for(let e=0;e<this.layers.length;e++){const t=this.system.app.scene.layers.getLayerById(this.layers[e]);t&&(t.removeLight(this),this.light.removeLayer(t))}}onLayersChanged(e,t){this.enabled&&this.entity.enabled&&this.addLightToLayers(),e.off("add",this.onLayerAdded,this),e.off("remove",this.onLayerRemoved,this),t.on("add",this.onLayerAdded,this),t.on("remove",this.onLayerRemoved,this)}onLayerAdded(e){this.layers.indexOf(e.id)>=0&&this.enabled&&this.entity.enabled&&(e.addLight(this),this.light.addLayer(e))}onLayerRemoved(e){this.layers.indexOf(e.id)>=0&&(e.removeLight(this),this.light.removeLayer(e))}refreshProperties(){for(let e=0;e<Jg.length;e++){const t=Jg[e];this[t]=this[t]}this.enabled&&this.entity.enabled&&this.onEnable()}onCookieAssetSet(){let e=!1;this._cookieAsset.type==="cubemap"&&!this._cookieAsset.loadFaces&&(this._cookieAsset.loadFaces=!0,e=!0),(!this._cookieAsset.resource||e)&&this.system.app.assets.load(this._cookieAsset),this._cookieAsset.resource&&this.onCookieAssetLoad()}onCookieAssetAdd(e){this._cookieAssetId===e.id&&(this._cookieAsset=e,this.light.enabled&&this.onCookieAssetSet(),this._cookieAsset.on("load",this.onCookieAssetLoad,this),this._cookieAsset.on("remove",this.onCookieAssetRemove,this))}onCookieAssetLoad(){!this._cookieAsset||!this._cookieAsset.resource||(this.cookie=this._cookieAsset.resource)}onCookieAssetRemove(){this._cookieAssetId&&(this._cookieAssetAdd&&(this.system.app.assets.off(`add:${this._cookieAssetId}`,this.onCookieAssetAdd,this),this._cookieAssetAdd=!1),this._cookieAsset&&(this._cookieAsset.off("load",this.onCookieAssetLoad,this),this._cookieAsset.off("remove",this.onCookieAssetRemove,this),this._cookieAsset=null),this.cookie=null)}onEnable(){const e=this.system.app.scene,t=e.layers;this.light.enabled=!0,this._evtLayersChanged=e.on("set:layers",this.onLayersChanged,this),t&&(this._evtLayerAdded=t.on("add",this.onLayerAdded,this),this._evtLayerRemoved=t.on("remove",this.onLayerRemoved,this)),this.enabled&&this.entity.enabled&&this.addLightToLayers(),this._cookieAsset&&!this.cookie&&this.onCookieAssetSet()}onDisable(){var i,s,n;const t=this.system.app.scene.layers;this.light.enabled=!1,(i=this._evtLayersChanged)==null||i.off(),this._evtLayersChanged=null,t&&((s=this._evtLayerAdded)==null||s.off(),this._evtLayerAdded=null,(n=this._evtLayerRemoved)==null||n.off(),this._evtLayerRemoved=null),this.removeLightFromLayers()}onRemove(){this.onDisable(),this.light.destroy(),this.cookieAsset=null}constructor(...e){super(...e),this._evtLayersChanged=null,this._evtLayerAdded=null,this._evtLayerRemoved=null,this._cookieAsset=null,this._cookieAssetId=null,this._cookieAssetAdd=!1,this._cookieMatrix=null}}class gCe extends si{constructor(e){super(e),this.id="light",this.ComponentType=mCe,this.DataType=RY,this.on("beforeremove",this._onRemoveComponent,this)}initializeComponentData(e,t){const i={...t};i.type||(i.type=e.data.type),e.data.type=i.type,i.layers&&Array.isArray(i.layers)&&(i.layers=i.layers.slice(0)),i.color&&Array.isArray(i.color)&&(i.color=new ae(i.color[0],i.color[1],i.color[2])),i.cookieOffset&&i.cookieOffset instanceof Array&&(i.cookieOffset=new ee(i.cookieOffset[0],i.cookieOffset[1])),i.cookieScale&&i.cookieScale instanceof Array&&(i.cookieScale=new ee(i.cookieScale[0],i.cookieScale[1])),i.enable&&(console.warn("WARNING: enable: Property is deprecated. Set enabled property instead."),i.enabled=i.enable),i.shape||(i.shape=Wn);const s=new sv(this.app.graphicsDevice,this.app.scene.clusteredLightingEnabled);s.type=MM[i.type],s._node=e.entity,e.data.light=s,super.initializeComponentData(e,i,Jg)}_onRemoveComponent(e,t){t.onRemove()}cloneComponent(e,t){const i=e.light,s=[];let n;for(let a=0;a<Jg.length;a++)n=Jg[a],n!=="light"&&(i[n]&&i[n].clone?s[n]=i[n].clone():s[n]=i[n]);return this.addComponent(t,s)}changeType(e,t,i){t!==i&&(e.light.type=MM[i])}}const _Ce=["x","y","z","w"],vCe=[void 0,void 0,ee,O,ce];function Sp(r,e,t,i){switch(e.type){case"boolean":return!!t;case"number":if(typeof t=="number")return t;if(typeof t=="string"){const s=parseInt(t,10);return isNaN(s)?null:s}else if(typeof t=="boolean")return 0+t;return null;case"json":{const s={};if(Array.isArray(e.schema)){(!t||typeof t!="object")&&(t={});for(let n=0;n<e.schema.length;n++){const a=e.schema[n];if(a.name)if(a.array){s[a.name]=[];const o=Array.isArray(t[a.name])?t[a.name]:[];for(let l=0;l<o.length;l++)s[a.name].push(Sp(r,a,o[l]))}else{const o=t.hasOwnProperty(a.name)?t[a.name]:a.default;s[a.name]=Sp(r,a,o)}}}return s}case"asset":return t instanceof be?t:typeof t=="number"?r.assets.get(t)||null:typeof t=="string"&&r.assets.get(parseInt(t,10))||null;case"entity":return t instanceof Xt?t:typeof t=="string"?r.getEntityFromIndex(t):null;case"rgb":case"rgba":if(t instanceof ae)return i instanceof ae?(i.copy(t),i):t.clone();if(t instanceof Array&&t.length>=3&&t.length<=4){for(let s=0;s<t.length;s++)if(typeof t[s]!="number")return null;return i||(i=new ae),i.r=t[0],i.g=t[1],i.b=t[2],i.a=t.length===3?1:t[3],i}else if(typeof t=="string"&&/#(?:[0-9a-f]{2}){3,4}/i.test(t))return i||(i=new ae),i.fromString(t),i;return null;case"vec2":case"vec3":case"vec4":{const s=parseInt(e.type.slice(3),10),n=vCe[s];if(t instanceof n)return i instanceof n?(i.copy(t),i):t.clone();if(t instanceof Array&&t.length===s){for(let a=0;a<t.length;a++)if(typeof t[a]!="number")return null;i||(i=new n);for(let a=0;a<s;a++)i[_Ce[a]]=t[a];return i}return null}case"curve":if(t){let s;if(t instanceof jn||t instanceof Uu)s=t.clone();else{const n=t.keys[0]instanceof Array?Uu:jn;s=new n(t.keys),s.type=t.type}return s}break}return t}function DY(r,e,t,i){return e.array?t.map((s,n)=>Sp(r,e,s,i?i[n]:null)):Sp(r,e,t,i)}function LY(r,e,t,i){if(t)for(const s in e){const n=e[s],a=t[s];a!==void 0&&(i[s]=DY(r,n,a,i[s]))}}const df=class df{constructor(e){this.scriptType=e,this.index={}}add(e,t){this.index[e]||df.reservedNames.has(e)||(this.index[e]=t,Object.defineProperty(this.scriptType.prototype,e,{get:function(){return this.__attributes[e]},set:function(i){const s="attr",n=`attr:${e}`,a=this.__attributes[e];let o=a;if(a&&t.type!=="json"&&t.type!=="entity"&&a.clone&&(this.hasEvent(s)||this.hasEvent(n))&&(o=a.clone()),t.array){if(this.__attributes[e]=[],i)for(let l=0,c=i.length;l<c;l++)this.__attributes[e].push(Sp(this.app,t,i[l],a?a[l]:null))}else this.__attributes[e]=Sp(this.app,t,i,a);this.fire(s,e,this.__attributes[e],o),this.fire(n,this.__attributes[e],o)}}))}remove(e){return this.index[e]?(delete this.index[e],delete this.scriptType.prototype[e],!0):!1}has(e){return!!this.index[e]}get(e){return this.index[e]||null}};df.assignAttributesToScript=LY,df.attributeToValue=DY,df.reservedNames=new Set(["app","entity","enabled","_enabled","_enabledOld","_destroyed","__attributes","__attributesRaw","__scriptType","__executionOrder","_callbacks","_callbackActive","has","get","on","off","fire","once","hasEvent"]);let cv=df;const h2="initialize",d2="postInitialize",yCe="update",SCe="postUpdate",xCe="swap",pa=class pa extends Te{constructor(e){super(),this.initScript(e)}set enabled(e){this._enabled=!!e,this.enabled!==this._enabledOld&&(this._enabledOld=this.enabled,this.fire(this.enabled?"enable":"disable"),this.fire("state",this.enabled),!this._initialized&&this.enabled&&(this._initialized=!0,this.fire("preInitialize"),this.initialize&&this.entity.script._scriptMethod(this,h2)),this._initialized&&!this._postInitialized&&this.enabled&&!this.entity.script._beingEnabled&&(this._postInitialized=!0,this.postInitialize&&this.entity.script._scriptMethod(this,d2)))}get enabled(){return this._enabled&&!this._destroyed&&this.entity.script.enabled&&this.entity.enabled}initScript(e){const t=this.constructor;this.app=e.app,this.entity=e.entity,this._enabled=typeof e.enabled=="boolean"?e.enabled:!0,this._enabledOld=this.enabled,this.__destroyed=!1,this.__scriptType=t,this.__executionOrder=-1}static get scriptName(){return this.__name}};pa.EVENT_ENABLE="enable",pa.EVENT_DISABLE="disable",pa.EVENT_STATE="state",pa.EVENT_DESTROY="destroy",pa.EVENT_ATTR="attr",pa.EVENT_ERROR="error",pa.__name=null,pa.__getScriptName=OY;let xp=pa;const bCe=/^\s*function(?:\s|\s*\/\*.*\*\/\s*)+([^(\s\/]*)\s*/;function OY(r){if(typeof r!="function")return;if(r.scriptName)return r.scriptName;if("name"in Function.prototype)return r.name;if(r===Function||r===Function.prototype.constructor)return"Function";const e=`${r}`.match(bCe);return e?e[1]:void 0}class e_ extends xp{constructor(e){super(e),this.initScriptType(e)}static get attributes(){return this.hasOwnProperty("__attributes")||(this.__attributes=new cv(this)),this.__attributes}initScript(e){xp.prototype.initScript.call(this,e),this.__attributes={},this.__attributesRaw=e.attributes||{}}initScriptType(e){this.initScript(e)}__initializeAttributes(e){if(!(!e&&!this.__attributesRaw)){for(const t in this.__scriptType.attributes.index)this.__attributesRaw&&this.__attributesRaw.hasOwnProperty(t)?this[t]=this.__attributesRaw[t]:this.__attributes.hasOwnProperty(t)||(this.__scriptType.attributes.index[t].hasOwnProperty("default")?this[t]=this.__scriptType.attributes.index[t].default:this[t]=null);this.__attributesRaw=null}}static extend(e){for(const t in e)e.hasOwnProperty(t)&&(this.prototype[t]=e[t])}}const wCe=r=>r[0].toLowerCase()+r.substring(1),ma=class ma extends ke{constructor(e,t){super(e,t),this._attributeDataMap=new Map,this._scripts=[],this._updateList=new rb({sortBy:"__executionOrder"}),this._postUpdateList=new rb({sortBy:"__executionOrder"}),this._scriptsIndex={},this._destroyedScripts=[],this._destroyed=!1,this._scriptsData=null,this._oldState=!0,this._enabled=!0,this._beingEnabled=!1,this._isLoopingThroughScripts=!1,this._executionOrder=-1,this.on("set_enabled",this._onSetEnabled,this)}set scripts(e){this._scriptsData=e;for(const t in e){if(!e.hasOwnProperty(t))continue;const i=this._scriptsIndex[t];if(i){if(typeof e[t].enabled=="boolean"&&(i.once("preInitialize",()=>{this.initializeAttributes(i)}),i.enabled=!!e[t].enabled),typeof e[t].attributes=="object"){for(const s in e[t].attributes)if(!cv.reservedNames.has(s)){if(!i.__attributes.hasOwnProperty(s)){const n=this.system.app.scripts.get(t);n&&n.attributes.add(s,{})}i[s]=e[t].attributes[s]}}}else console.log(this.order)}}get scripts(){return this._scripts}set enabled(e){const t=this._enabled;this._enabled=e,this.fire("set","enabled",t,e)}get enabled(){return this._enabled}onEnable(){this._beingEnabled=!0,this._checkState(),this.entity._beingEnabled||this.onPostStateChange(),this._beingEnabled=!1}onDisable(){this._checkState()}onPostStateChange(){const e=this._beginLooping();for(let t=0,i=this.scripts.length;t<i;t++){const s=this.scripts[t];s._initialized&&!s._postInitialized&&s.enabled&&(s._postInitialized=!0,s.postInitialize&&this._scriptMethod(s,d2))}this._endLooping(e)}_beginLooping(){const e=this._isLoopingThroughScripts;return this._isLoopingThroughScripts=!0,e}_endLooping(e){this._isLoopingThroughScripts=e,this._isLoopingThroughScripts||this._removeDestroyedScripts()}_onSetEnabled(e,t,i){this._beingEnabled=!0,this._checkState(),this._beingEnabled=!1}_checkState(){const e=this.enabled&&this.entity.enabled;if(e===this._oldState)return;this._oldState=e,this.fire(e?"enable":"disable"),this.fire("state",e),e?this.system._addComponentToEnabled(this):this.system._removeComponentFromEnabled(this);const t=this._beginLooping();for(let i=0,s=this.scripts.length;i<s;i++){const n=this.scripts[i];n.once("preInitialize",()=>{this.initializeAttributes(n)}),n.enabled=n._enabled}this._endLooping(t)}_onBeforeRemove(){this.fire("remove");const e=this._beginLooping();for(let t=0;t<this.scripts.length;t++){const i=this.scripts[t];i&&this.destroy(i.__scriptType.__name)}this._endLooping(e)}_removeDestroyedScripts(){const e=this._destroyedScripts.length;if(e){for(let t=0;t<e;t++){const i=this._destroyedScripts[t];this._removeScriptInstance(i)}this._destroyedScripts.length=0,this._resetExecutionOrder(0,this._scripts.length)}}_onInitializeAttributes(){for(let e=0,t=this.scripts.length;e<t;e++){const i=this.scripts[e];this.initializeAttributes(i)}}initializeAttributes(e){var t;if(e instanceof e_)e.__initializeAttributes();else{const i=e.__scriptType.__name,s=this._attributeDataMap.get(i);if(!s)return;const n=(t=this.system.app.scripts)==null?void 0:t.getSchema(i);LY(this.system.app,n.attributes,s,e)}}_scriptMethod(e,t,i){e[t](i)}_onInitialize(){const e=this._scripts,t=this._beginLooping();for(let i=0,s=e.length;i<s;i++){const n=e[i];!n._initialized&&n.enabled&&(n._initialized=!0,n.initialize&&this._scriptMethod(n,h2))}this._endLooping(t)}_onPostInitialize(){this.onPostStateChange()}_onUpdate(e){const t=this._updateList;if(!t.length)return;const i=this._beginLooping();for(t.loopIndex=0;t.loopIndex<t.length;t.loopIndex++){const s=t.items[t.loopIndex];s.enabled&&this._scriptMethod(s,yCe,e)}this._endLooping(i)}_onPostUpdate(e){const t=this._postUpdateList;if(!t.length)return;const i=this._beginLooping();for(t.loopIndex=0;t.loopIndex<t.length;t.loopIndex++){const s=t.items[t.loopIndex];s.enabled&&this._scriptMethod(s,SCe,e)}this._endLooping(i)}_insertScriptInstance(e,t,i){t===-1?(this._scripts.push(e),e.__executionOrder=i,e.update&&this._updateList.append(e),e.postUpdate&&this._postUpdateList.append(e)):(this._scripts.splice(t,0,e),e.__executionOrder=t,this._resetExecutionOrder(t+1,i+1),e.update&&this._updateList.insert(e),e.postUpdate&&this._postUpdateList.insert(e))}_removeScriptInstance(e){const t=this._scripts.indexOf(e);return t===-1||(this._scripts.splice(t,1),e.update&&this._updateList.remove(e),e.postUpdate&&this._postUpdateList.remove(e)),t}_resetExecutionOrder(e,t){for(let i=e;i<t;i++)this._scripts[i].__executionOrder=i}_resolveEntityScriptAttribute(e,t,i,s,n,a){if(e.array){const o=i.length;if(!o)return;const l=i.slice();for(let c=0;c<o;c++){const u=l[c]instanceof lt?l[c].getGuid():l[c];a[u]&&(l[c]=s?a[u].getGuid():a[u])}n[t]=l}else{if(i instanceof lt)i=i.getGuid();else if(typeof i!="string")return;a[i]&&(n[t]=a[i])}}has(e){if(typeof e=="string")return!!this._scriptsIndex[e];if(!e)return!1;const t=e,i=t.__name,s=this._scriptsIndex[i];return(s&&s.instance)instanceof t}get(e){if(typeof e=="string"){const a=this._scriptsIndex[e];return a?a.instance:null}if(!e)return null;const t=e,i=t.__name,s=this._scriptsIndex[i],n=s&&s.instance;return n instanceof t?n:null}create(e,t={}){const i=this;let s=e,n=e;if(typeof s=="string")s=this.system.app.scripts.get(s);else if(s){const a=OY(s),o=wCe(a);!(s.prototype instanceof e_)&&s.scriptName,s.__name??(s.__name=s.scriptName??o),n=s.__name}if(s){if(!this._scriptsIndex[n]||!this._scriptsIndex[n].instance){const a=new s({app:this.system.app,entity:this.entity,enabled:t.hasOwnProperty("enabled")?t.enabled:!0,attributes:t.attributes||{}});t.properties&&typeof t.properties=="object"&&Object.assign(a,t.properties),a instanceof e_||this._attributeDataMap.set(n,t.attributes);const o=this._scripts.length;let l=-1;return typeof t.ind=="number"&&t.ind!==-1&&o>t.ind&&(l=t.ind),this._insertScriptInstance(a,l,o),this._scriptsIndex[n]={instance:a,onSwap:function(){i.swap(n)}},this[n]=a,t.preloading||this.initializeAttributes(a),this.fire("create",n,a),this.fire(`create:${n}`,a),this.system.app.scripts.on(`swap:${n}`,this._scriptsIndex[n].onSwap),t.preloading||(a.enabled&&!a._initialized&&(a._initialized=!0,a.initialize&&this._scriptMethod(a,h2)),a.enabled&&!a._postInitialized&&(a._postInitialized=!0,a.postInitialize&&this._scriptMethod(a,d2))),a}}else this._scriptsIndex[n]={awaiting:!0,ind:this._scripts.length};return null}destroy(e){let t=e,i=e;typeof i=="string"?i=this.system.app.scripts.get(i):i&&(t=i.__name);const s=this._scriptsIndex[t];if(delete this._scriptsIndex[t],!s)return!1;this._attributeDataMap.delete(t);const n=s.instance;if(n&&!n._destroyed)if(n.enabled=!1,n._destroyed=!0,this._isLoopingThroughScripts)this._destroyedScripts.push(n);else{const a=this._removeScriptInstance(n);a>=0&&this._resetExecutionOrder(a,this._scripts.length)}return this.system.app.scripts.off(`swap:${t}`,s.onSwap),delete this[t],this.fire("destroy",t,n||null),this.fire(`destroy:${t}`,n||null),n&&n.fire("destroy"),!0}swap(e){let t=e,i=e;typeof i=="string"?i=this.system.app.scripts.get(i):i&&(t=i.__name);const s=this._scriptsIndex[t];if(!s||!s.instance)return!1;const n=s.instance,a=this._scripts.indexOf(n),o=new i({app:this.system.app,entity:this.entity,enabled:n.enabled,attributes:n.__attributes});return o.swap?(this.initializeAttributes(o),this._scripts[a]=o,this._scriptsIndex[t].instance=o,this[t]=o,o.__executionOrder=a,n.update&&this._updateList.remove(n),n.postUpdate&&this._postUpdateList.remove(n),o.update&&this._updateList.insert(o),o.postUpdate&&this._postUpdateList.insert(o),this._scriptMethod(o,xCe,n),this.fire("swap",t,o),this.fire(`swap:${t}`,o),!0):!1}resolveDuplicatedEntityReferenceProperties(e,t){var s,n,a;const i=this.entity.script;for(const o in e._scriptsIndex){const l=this.system.app.scripts.get(o);if(!l)continue;const c=e._scriptsIndex[o];if(!c||!c.instance)continue;const u=i[o].__attributesRaw??i._attributeDataMap.get(o),h=i[o].__attributes;if(!u&&!h)continue;const d=!!u,f=c.instance.__attributes??i._attributeDataMap.get(o);for(const p in f){if(!f[p])continue;const m=((s=l.attributes)==null?void 0:s.get(p))??((a=(n=this.system.app.scripts.getSchema(o))==null?void 0:n.attributes)==null?void 0:a[p]);if(m){if(m.type==="entity")this._resolveEntityScriptAttribute(m,p,f[p],d,u||h,t);else if(m.type==="json"&&Array.isArray(m.schema)){const g=f[p],_=u?u[p]:h[p];for(let v=0;v<m.schema.length;v++){const y=m.schema[v];if(y.type==="entity")if(m.array)for(let x=0;x<g.length;x++)this._resolveEntityScriptAttribute(y,y.name,g[x][y.name],d,_[x],t);else this._resolveEntityScriptAttribute(y,y.name,g[y.name],d,_,t)}}}}}}move(e,t){const i=this._scripts.length;if(t>=i||t<0)return!1;let s=e,n=e;typeof n!="string"?n=e.__name:s=null;const a=this._scriptsIndex[n];if(!a||!a.instance)return!1;const o=a.instance;if(s&&!(o instanceof s))return!1;const l=this._scripts.indexOf(o);return l===-1||l===t?!1:(this._scripts.splice(t,0,this._scripts.splice(l,1)[0]),this._resetExecutionOrder(0,i),this._updateList.sort(),this._postUpdateList.sort(),this.fire("move",n,o,t,l),this.fire(`move:${n}`,o,t,l),!0)}};ma.EVENT_CREATE="create",ma.EVENT_DESTROY="destroy",ma.EVENT_ENABLE="enable",ma.EVENT_DISABLE="disable",ma.EVENT_REMOVE="remove",ma.EVENT_STATE="state",ma.EVENT_MOVE="move",ma.EVENT_ERROR="error";let f2=ma;class TCe{constructor(){this.enabled=!0}}const ECe="_onInitializeAttributes",ACe="_onInitialize",CCe="_onPostInitialize",PCe="_onUpdate",ICe="_onPostUpdate";let uS=0;class MCe extends si{constructor(e){super(e),this.id="script",this.ComponentType=f2,this.DataType=TCe,this._components=new rb({sortBy:"_executionOrder"}),this._enabledComponents=new rb({sortBy:"_executionOrder"}),this.preloading=!0,this.on("beforeremove",this._onBeforeRemove,this),this.app.systems.on("initialize",this._onInitialize,this),this.app.systems.on("postInitialize",this._onPostInitialize,this),this.app.systems.on("update",this._onUpdate,this),this.app.systems.on("postUpdate",this._onPostUpdate,this)}initializeComponentData(e,t){if(e._executionOrder=uS++,this._components.append(e),uS>Number.MAX_SAFE_INTEGER&&this._resetExecutionOrder(),e.enabled=t.hasOwnProperty("enabled")?!!t.enabled:!0,e.enabled&&e.entity.enabled&&this._enabledComponents.append(e),t.hasOwnProperty("order")&&t.hasOwnProperty("scripts")){e._scriptsData=t.scripts;for(let i=0;i<t.order.length;i++)e.create(t.order[i],{enabled:t.scripts[t.order[i]].enabled,attributes:t.scripts[t.order[i]].attributes,preloading:this.preloading})}}cloneComponent(e,t){var a;const i=[],s={};for(let o=0;o<e.script._scripts.length;o++){const l=e.script._scripts[o],c=l.__scriptType.__name;i.push(c);const u=((a=e.script._attributeDataMap)==null?void 0:a.get(c))||{};for(const h in l.__attributes)u[h]=l.__attributes[h];s[c]={enabled:l._enabled,attributes:u}}for(const o in e.script._scriptsIndex)o.awaiting&&i.splice(o.ind,0,o);const n={enabled:e.script.enabled,order:i,scripts:s};return this.addComponent(t,n)}_resetExecutionOrder(){uS=0;for(let e=0,t=this._components.length;e<t;e++)this._components.items[e]._executionOrder=uS++}_callComponentMethod(e,t,i){for(e.loopIndex=0;e.loopIndex<e.length;e.loopIndex++)e.items[e.loopIndex][t](i)}_onInitialize(){this.preloading=!1,this._callComponentMethod(this._components,ECe),this._callComponentMethod(this._enabledComponents,ACe)}_onPostInitialize(){this._callComponentMethod(this._enabledComponents,CCe)}_onUpdate(e){this._callComponentMethod(this._enabledComponents,PCe,e)}_onPostUpdate(e){this._callComponentMethod(this._enabledComponents,ICe,e)}_addComponentToEnabled(e){this._enabledComponents.insert(e)}_removeComponentFromEnabled(e){this._enabledComponents.remove(e)}_onBeforeRemove(e,t){this._components.items.indexOf(t)>=0&&t._onBeforeRemove(),this._removeComponentFromEnabled(t),this._components.remove(t)}destroy(){super.destroy(),this.app.systems.off("initialize",this._onInitialize,this),this.app.systems.off("postInitialize",this._onPostInitialize,this),this.app.systems.off("update",this._onUpdate,this),this.app.systems.off("postUpdate",this._onPostUpdate,this)}}class NY extends ke{constructor(e,t){super(e,t),this._layers=[nl],this._instance=null,this._materialTmp=null,this._highQualitySH=!1,this._customAabb=null,this._evtLayersChanged=null,this._evtLayerAdded=null,this._evtLayerRemoved=null,this._castShadows=!1,this._assetReference=new lv("asset",this,e.app.assets,{add:this._onGSplatAssetAdded,load:this._onGSplatAssetLoad,remove:this._onGSplatAssetRemove,unload:this._onGSplatAssetUnload},this),t.on("remove",this.onRemoveChild,this),t.on("removehierarchy",this.onRemoveChild,this),t.on("insert",this.onInsertChild,this),t.on("inserthierarchy",this.onInsertChild,this)}set customAabb(e){var t,i;this._customAabb=e,(i=(t=this._instance)==null?void 0:t.meshInstance)==null||i.setCustomAabb(this._customAabb)}get customAabb(){return this._customAabb}set instance(e){if(this.destroyInstance(),this._instance=e,this._instance){const t=this._instance.meshInstance;t.node||(t.node=this.entity),t.castShadow=this._castShadows,t.setCustomAabb(this._customAabb),this.enabled&&this.entity.enabled&&this.addToLayers()}}get instance(){return this._instance}set material(e){this._instance?this._instance.material=e:this._materialTmp=e}get material(){var e;return((e=this._instance)==null?void 0:e.material)??this._materialTmp??null}set highQualitySH(e){e!==this._highQualitySH&&(this._highQualitySH=e,this._instance&&this._instance.setHighQualitySH(e))}get highQualitySH(){return this._highQualitySH}set castShadows(e){var t;if(this._castShadows!==e){const i=(t=this.instance)==null?void 0:t.meshInstance;if(i){const s=this.layers,n=this.system.app.scene;if(this._castShadows&&!e)for(let a=0;a<s.length;a++){const o=n.layers.getLayerById(this.layers[a]);o&&o.removeShadowCasters([i])}if(i.castShadow=e,!this._castShadows&&e)for(let a=0;a<s.length;a++){const o=n.layers.getLayerById(s[a]);o&&o.addShadowCasters([i])}}this._castShadows=e}}get castShadows(){return this._castShadows}set layers(e){this.removeFromLayers(),this._layers.length=0;for(let t=0;t<e.length;t++)this._layers[t]=e[t];!this.enabled||!this.entity.enabled||this.addToLayers()}get layers(){return this._layers}set asset(e){const t=e instanceof be?e.id:e;this._assetReference.id!==t&&(this._assetReference.asset&&this._assetReference.asset.resource&&this._onGSplatAssetRemove(),this._assetReference.id=t,this._assetReference.asset&&this._onGSplatAssetAdded())}get asset(){return this._assetReference.id}destroyInstance(){var e;this._instance&&(this.removeFromLayers(),(e=this._instance)==null||e.destroy(),this._instance=null)}addToLayers(){var t,i;const e=(t=this.instance)==null?void 0:t.meshInstance;if(e){const s=this.system.app.scene.layers;for(let n=0;n<this._layers.length;n++)(i=s.getLayerById(this._layers[n]))==null||i.addMeshInstances([e])}}removeFromLayers(){var t,i;const e=(t=this.instance)==null?void 0:t.meshInstance;if(e){const s=this.system.app.scene.layers;for(let n=0;n<this._layers.length;n++)(i=s.getLayerById(this._layers[n]))==null||i.removeMeshInstances([e])}}onRemoveChild(){this.removeFromLayers()}onInsertChild(){this._instance&&this.enabled&&this.entity.enabled&&this.addToLayers()}onRemove(){this.destroyInstance(),this.asset=null,this._assetReference.id=null,this.entity.off("remove",this.onRemoveChild,this),this.entity.off("insert",this.onInsertChild,this)}onLayersChanged(e,t){this.addToLayers(),e.off("add",this.onLayerAdded,this),e.off("remove",this.onLayerRemoved,this),t.on("add",this.onLayerAdded,this),t.on("remove",this.onLayerRemoved,this)}onLayerAdded(e){this.layers.indexOf(e.id)<0||this._instance&&e.addMeshInstances(this._instance.meshInstance)}onLayerRemoved(e){this.layers.indexOf(e.id)<0||this._instance&&e.removeMeshInstances(this._instance.meshInstance)}onEnable(){const e=this.system.app.scene,t=e.layers;this._evtLayersChanged=e.on("set:layers",this.onLayersChanged,this),t&&(this._evtLayerAdded=t.on("add",this.onLayerAdded,this),this._evtLayerRemoved=t.on("remove",this.onLayerRemoved,this)),this._instance?this.addToLayers():this.asset&&this._onGSplatAssetAdded()}onDisable(){var i,s,n;const t=this.system.app.scene.layers;(i=this._evtLayersChanged)==null||i.off(),this._evtLayersChanged=null,t&&((s=this._evtLayerAdded)==null||s.off(),this._evtLayerAdded=null,(n=this._evtLayerRemoved)==null||n.off(),this._evtLayerRemoved=null),this.removeFromLayers()}hide(){this._instance&&(this._instance.meshInstance.visible=!1)}show(){this._instance&&(this._instance.meshInstance.visible=!0)}_onGSplatAssetAdded(){this._assetReference.asset&&(this._assetReference.asset.resource?this._onGSplatAssetLoad():this.enabled&&this.entity.enabled&&this.system.app.assets.load(this._assetReference.asset))}_onGSplatAssetLoad(){this.destroyInstance();const e=this._assetReference.asset;e&&(this.instance=new xve(e.resource,{material:this._materialTmp,highQualitySH:this._highQualitySH}),this._materialTmp=null,this.customAabb=this.instance.resource.aabb.clone())}_onGSplatAssetUnload(){this.destroyInstance()}_onGSplatAssetRemove(){this._onGSplatAssetUnload()}}class RCe{constructor(){this.enabled=!0}}const p2=["enabled"],ug=["castShadows","material","highQualitySH","asset","layers"];class DCe extends si{constructor(e){super(e),this.id="gsplat",this.ComponentType=NY,this.DataType=RCe,this.schema=p2,this.on("beforeremove",this.onRemove,this)}initializeComponentData(e,t,i){t.layers&&t.layers.length&&(t.layers=t.layers.slice(0));for(let s=0;s<ug.length;s++)t.hasOwnProperty(ug[s])&&(e[ug[s]]=t[ug[s]]);t.aabbCenter&&t.aabbHalfExtents&&(e.customAabb=new We(new O(t.aabbCenter),new O(t.aabbHalfExtents))),super.initializeComponentData(e,t,p2)}cloneComponent(e,t){const i=e.gsplat,s={};ug.forEach(a=>{a==="material"?s[a]=i[a].clone():s[a]=i[a]}),s.enabled=i.enabled;const n=this.addComponent(t,s);return i.customAabb&&(n.customAabb=i.customAabb.clone()),n}onRemove(e,t){t.onRemove()}}ke._buildAccessors(NY.prototype,p2);const xk=class xk extends Te{set meshes(e){this.decRefMeshes(),this._meshes=e,this.incRefMeshes(),this.fire("set:meshes",e)}get meshes(){return this._meshes}destroy(){this.meshes=null}decRefMeshes(){var e;(e=this._meshes)==null||e.forEach((t,i)=>{t&&(t.decRefCount(),t.refCount<1&&(t.destroy(),this._meshes[i]=null))})}incRefMeshes(){var e;(e=this._meshes)==null||e.forEach(t=>{t==null||t.incRefCount()})}constructor(...e){super(...e),this._meshes=null}};xk.EVENT_SETMESHES="set:meshes";let Fb=xk;function px(r){const e=this;if(!e.resource)return;const t=r.resource,i=t.renders&&t.renders[e.data.renderIndex];i&&(e.resource.meshes=i.resource.meshes)}function uV(r){const e=this;e.registry.off(`load:${r.id}`,px,e),e.registry.on(`load:${r.id}`,px,e),e.registry.off(`remove:${r.id}`,hV,e),e.registry.once(`remove:${r.id}`,hV,e),r.resource?px.call(e,r):e.registry.load(r)}function hV(r){const e=this;e.registry.off(`load:${r.id}`,px,e),e.resource&&e.resource.destroy()}class LCe extends Ot{constructor(e){super(e,"render"),this._registry=e.assets}open(e,t){return new Fb}patch(e,t){if(!e.data.containerAsset)return;const i=t.get(e.data.containerAsset);if(!i){t.once(`add:${e.data.containerAsset}`,uV,e);return}uV.call(e,i)}}class kY{constructor(e,t,i,s){this._paths=e,this._input=t,this._output=i,this._interpolation=s}get paths(){return this._paths}get input(){return this._input}get output(){return this._output}get interpolation(){return this._interpolation}}class Bb{constructor(e,t){this._components=e,this._data=t}get components(){return this._components}get data(){return this._data}}function OCe(r,e){let t;const n=(f,p)=>{switch(p){case t.DT_INT8:return new Int8Array(f.buffer,f.byteOffset,f.byteLength);case t.DT_INT16:return new Int16Array(f.buffer,f.byteOffset,f.byteLength/2);case t.DT_INT32:return new Int32Array(f.buffer,f.byteOffset,f.byteLength/4);case t.DT_UINT8:return new Uint8Array(f.buffer,f.byteOffset,f.byteLength);case t.DT_UINT16:return new Uint16Array(f.buffer,f.byteOffset,f.byteLength/2);case t.DT_UINT32:return new Uint32Array(f.buffer,f.byteOffset,f.byteLength/4);case t.DT_FLOAT32:return new Float32Array(f.buffer,f.byteOffset,f.byteLength/4)}return null},a=f=>{switch(f){case t.DT_INT8:return 1;case t.DT_INT16:return 2;case t.DT_INT32:return 4;case t.DT_UINT8:return 1;case t.DT_UINT16:return 2;case t.DT_UINT32:return 4;case t.DT_FLOAT32:return 4}return 1},o=f=>f.num_components()*a(f.data_type()),l={0:0,1:1,5:2,2:3,7:4,8:5,4:6,3:7},c=(f,p)=>{const m=(M,N,k)=>{M[0]=N[0]-k[0],M[1]=N[1]-k[1],M[2]=N[2]-k[2]},g=(M,N,k)=>{M[0]=N[1]*k[2]-k[1]*N[2],M[1]=N[2]*k[0]-k[2]*N[0],M[2]=N[0]*k[1]-k[0]*N[1]},_=(M,N)=>{const k=M[N+0],V=M[N+1],B=M[N+2],R=1/Math.sqrt(k*k+V*V+B*B);M[N+0]*=R,M[N+1]*=R,M[N+2]*=R},v=(M,N,k)=>{for(let V=0;V<3;++V)M[V]=N[k+V]},y=p.length/3,x=f.length/3,S=new Float32Array(f.length),w=[0,0,0],T=[0,0,0],A=[0,0,0],C=[0,0,0],P=[0,0,0],I=[0,0,0];for(let M=0;M<y;++M){const N=p[M*3+0]*3,k=p[M*3+1]*3,V=p[M*3+2]*3;v(w,f,N),v(T,f,k),v(A,f,V),m(C,T,w),m(P,A,w),g(I,C,P),_(I,0);for(let B=0;B<3;++B)S[N+B]+=I[B],S[k+B]+=I[B],S[V+B]+=I[B]}for(let M=0;M<x;++M)_(S,M*3);return new Uint8Array(S.buffer)},u=f=>{const p={},m=new t.DecoderBuffer;m.Init(f,f.length);const g=new t.Decoder;if(g.GetEncodedGeometryType(m)!==t.TRIANGULAR_MESH)return p.error="Failed to decode draco mesh: not a mesh",p;const _=new t.Mesh,v=g.DecodeBufferToMesh(m,_);if(!v||!v.ok()||t.getPointer(_)===0)return p.error="Failed to decode draco asset",p;const y=_.num_faces()*3,x=_.num_points()<=65535,S=y*(x?2:4),w=t._malloc(S);x?(g.GetTrianglesUInt16Array(_,S,w),p.indices=new Uint16Array(t.HEAPU16.buffer,w,y).slice().buffer):(g.GetTrianglesUInt32Array(_,S,w),p.indices=new Uint32Array(t.HEAPU32.buffer,w,y).slice().buffer),t._free(w);const T=[];for(let N=0;N<_.num_attributes();++N)T.push(g.GetAttribute(_,N));T.sort((N,k)=>(l[N.attribute_type()]??l.length)-(l[k.attribute_type()]??l.length)),p.attributes=T.map(N=>N.unique_id());let A=0;const C=T.map(N=>{const k=A;return A+=Math.ceil(o(N)/4)*4,k}),P=T.some(N=>N.attribute_type()===1),I=C[1];if(!P){for(let N=1;N<C.length;++N)C[N]+=12;A+=12}p.vertices=new ArrayBuffer(_.num_points()*A);const M=new Uint8Array(p.vertices);for(let N=0;N<_.num_attributes();++N){const k=T[N],V=o(k),B=_.num_points()*V,R=t._malloc(B);g.GetAttributeDataArrayForAllPoints(_,k,k.data_type(),B,R);const L=new Uint8Array(t.HEAPU8.buffer,R,B);for(let D=0;D<_.num_points();++D)for(let F=0;F<V;++F)M[D*A+C[N]+F]=L[D*V+F];if(!P&&k.attribute_type()===0){const D=c(n(L,k.data_type()),x?new Uint16Array(p.indices):new Uint32Array(p.indices));for(let F=0;F<_.num_points();++F)for(let j=0;j<12;++j)M[F*A+I+j]=D[F*12+j]}t._free(R)}return t.destroy(_),t.destroy(g),t.destroy(m),p},h=f=>{const p=u(new Uint8Array(f.buffer));self.postMessage({jobId:f.jobId,error:p.error,indices:p.indices,vertices:p.vertices,attributes:p.attributes},[p.indices,p.vertices].filter(m=>m!=null))},d=[];self.onmessage=f=>{const p=f.data;switch(p.type){case"init":self.DracoDecoderModule({instantiateWasm:(m,g)=>(WebAssembly.instantiate(p.module,m).then(_=>g(_)).catch(_=>console.error(`instantiate failed + ${_}`)),{})}).then(m=>{t=m,d.forEach(g=>h(g))});break;case"decodeMesh":t?h(p):d.push(p);break}}}const dV=3;class NCe{constructor(){this.workers=[[],[],[]],this.jobId=0,this.jobQueue=[],this.jobCallbacks=new Map,this.run=(e,t)=>{e.postMessage({type:"decodeMesh",jobId:t.jobId,buffer:t.buffer},[t.buffer])}}init(e){for(e.forEach(t=>{t.addEventListener("message",i=>{const s=i.data,n=this.jobCallbacks.get(s.jobId);if(n&&n(s.error,{indices:s.indices,vertices:s.vertices,attributes:s.attributes}),this.jobCallbacks.delete(s.jobId),this.jobQueue.length>0){const a=this.jobQueue.shift();this.run(t,a)}else{const a=this.workers[2].indexOf(t);if(a!==-1)this.workers[2].splice(a,1),this.workers[1].push(t);else{const o=this.workers[1].indexOf(t);o!==-1&&(this.workers[1].splice(o,1),this.workers[0].push(t))}}})}),this.workers[0]=e;this.jobQueue.length&&(this.workers[0].length||this.workers[1].length);){const t=this.jobQueue.shift();if(this.workers[0].length>0){const i=this.workers[0].shift();this.workers[1].push(i),this.run(i,t)}else{const i=this.workers[1].shift();this.workers[2].push(i),this.run(i,t)}}}enqueueJob(e,t){const i={jobId:this.jobId++,buffer:e};if(this.jobCallbacks.set(i.jobId,t),this.workers[0].length>0){const s=this.workers[0].shift();this.workers[1].push(s),this.run(s,i)}else if(this.workers[1].length>0){const s=this.workers[1].shift();this.workers[2].push(s),this.run(s,i)}else this.jobQueue.push(i)}}const kCe=r=>new Promise((e,t)=>{const i={cache:!0,responseType:"text",retry:dV>0,maxRetries:dV};qt.get(r,i,(s,n)=>{s?t(s):e(n)})}),FCe=r=>{const e=()=>fetch(r).then(i=>i.arrayBuffer()).then(i=>WebAssembly.compile(i)),t=()=>WebAssembly.compileStreaming(fetch(r)).catch(i=>e());return WebAssembly.compileStreaming?t():e()},fV=1;let mx;const BCe=r=>{if(mx)return!0;if(!r){const e=lq.getConfig("DracoDecoderModule");e?r={jsUrl:e.glueUrl,wasmUrl:e.wasmUrl,numWorkers:e.numWorkers}:r={jsUrl:"draco.wasm.js",wasmUrl:"draco.wasm.wasm",numWorkers:fV}}return!r.jsUrl||!r.wasmUrl?!1:(mx=new NCe,Promise.all([kCe(r.jsUrl),FCe(r.wasmUrl)]).then(([e,t])=>{const i=["/* draco */",e,"/* worker */",`(
${OCe.toString()}
)()

`].join(`
`),s=new Blob([i],{type:"application/javascript"}),n=URL.createObjectURL(s),a=Math.max(1,Math.min(16,r.numWorkers||fV)),o=[];for(let l=0;l<a;++l){const c=new Worker(n);c.postMessage({type:"init",module:t}),o.push(c)}mx.init(o)}),!0)},UCe=(r,e)=>BCe()?(mx.enqueueJob(r,e),!0):!1;class zCe{destroy(){this.renders&&this.renders.forEach(e=>{e.meshes=null})}}const FY=r=>/^data:[^\n\r,\u2028\u2029]*,.*$/i.test(r),VCe=r=>r.substring(r.indexOf(":")+1,r.indexOf(";")),uv=r=>{switch(r){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":return 4;case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:return 3}},WE=r=>{switch(r){case 5120:return yE;case 5121:return Vu;case 5122:return SE;case 5123:return wy;case 5124:return Oq;case 5125:return xE;case 5126:return bt;default:return 0}},jCe=r=>{switch(r){case 5120:return 1;case 5121:return 1;case 5122:return 2;case 5123:return 2;case 5124:return 4;case 5125:return 4;case 5126:return 4;default:return 0}},$Ce=r=>{switch(r){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:return null}},Ub={POSITION:Xe,NORMAL:Rs,TANGENT:Xa,COLOR_0:wr,JOINTS_0:Es,WEIGHTS_0:za,TEXCOORD_0:un,TEXCOORD_1:Oh,TEXCOORD_2:gy,TEXCOORD_3:_y,TEXCOORD_4:vy,TEXCOORD_5:yy,TEXCOORD_6:Sy,TEXCOORD_7:xy},pV={[Xe]:0,[Rs]:1,[Xa]:2,[wr]:3,[Es]:4,[za]:5,[un]:6,[Oh]:7,[gy]:8,[_y]:9,[vy]:10,[yy]:11,[Sy]:12,[xy]:13},HCe=r=>{switch(r){case yE:return e=>Math.max(e/127,-1);case Vu:return e=>e/255;case SE:return e=>Math.max(e/32767,-1);case wy:return e=>e/65535;default:return e=>e}},m2=(r,e,t)=>{const i=HCe(t),s=e.length;for(let n=0;n<s;++n)r[n]=i(e[n]);return r},qu=(r,e,t=!1)=>{const i=uv(r.type),s=$Ce(r.componentType);if(!s)return null;let n;if(r.sparse){const a=r.sparse,o={count:a.count,type:"SCALAR"},l=qu(Object.assign(o,a.indices),e,!0),c={count:a.count,type:r.type,componentType:r.componentType},u=qu(Object.assign(c,a.values),e,!0);if(r.hasOwnProperty("bufferView")){const h={bufferView:r.bufferView,byteOffset:r.byteOffset,componentType:r.componentType,count:r.count,type:r.type};n=qu(h,e,!0).slice()}else n=new s(r.count*i);for(let h=0;h<a.count;++h){const d=l[h];for(let f=0;f<i;++f)n[d*i+f]=u[h*i+f]}}else if(r.hasOwnProperty("bufferView")){const a=e[r.bufferView];if(t&&a.hasOwnProperty("byteStride")){const o=i*s.BYTES_PER_ELEMENT,l=new ArrayBuffer(r.count*o),c=new Uint8Array(l);let u=0;for(let h=0;h<r.count;++h){let d=(r.byteOffset||0)+h*a.byteStride;for(let f=0;f<o;++f)c[u++]=a[d++]}n=new s(l)}else n=new s(a.buffer,a.byteOffset+(r.byteOffset||0),r.count*i)}else n=new s(r.count*i);return n},Nf=(r,e)=>{const t=qu(r,e,!0);if(t instanceof Float32Array||!r.normalized)return t;const i=new Float32Array(t.length);return m2(i,t,WE(r.componentType)),i},g2=r=>{let e=r.min,t=r.max;if(!e||!t)return null;if(r.normalized){const i=WE(r.componentType);e=m2([],e,i),t=m2([],t,i)}return new We(new O((t[0]+e[0])*.5,(t[1]+e[1])*.5,(t[2]+e[2])*.5),new O((t[0]-e[0])*.5,(t[1]-e[1])*.5,(t[2]-e[2])*.5))},BY=r=>{if(!r.hasOwnProperty("mode"))return Uo;switch(r.mode){case 0:return _E;case 1:return vE;case 2:return Cq;case 3:return Pq;case 4:return Uo;case 5:return wc;case 6:return zu;default:return Uo}},GCe=r=>{const e=new Uint16Array(r);for(let t=0;t<r;t++)e[t]=t;return e},WCe=(r,e)=>{const t=r[Xe];if(!t||t.components!==3)return;let i;if(t.size!==t.stride){const o=t.stride/Wg[t.type],l=new If[t.type](t.buffer,t.offset,t.count*o);i=new If[t.type](t.count*3);for(let c=0;c<t.count;++c)i[c*3+0]=l[c*o+0],i[c*3+1]=l[c*o+1],i[c*3+2]=l[c*o+2]}else i=new If[t.type](t.buffer,t.offset,t.count*3);const s=t.count;e||(e=GCe(s));const n=U9(i,e),a=new Float32Array(n.length);a.set(n),r[Rs]={buffer:a.buffer,size:12,offset:0,stride:12,count:s,components:3,type:bt}},XCe=r=>{const e=i=>{const s=[];for(let n=0;n<i._levels.length;++n){let a=[];if(i.cubemap)for(let o=0;o<6;++o)a.push(i._levels[n][o]);else a=i._levels[n];s.push(a)}return s},t=new we(r.device,r);return t._levels=e(r),t},qCe=r=>{const e=new be(`${r.name}_clone`,r.type,r.file,r.data,r.options);return e.loaded=!0,e.resource=XCe(r.resource),r.registry.add(e),e},YCe=(r,e)=>{const t=e[Xe];if(!t)return null;const i=t.count,s=[];for(const _ in e)if(e.hasOwnProperty(_)){const v={semantic:_,components:e[_].components,type:e[_].type,normalize:!!e[_].normalize};Ls.isElementValid(r,v)||v.components++,s.push(v)}s.sort((_,v)=>pV[_.semantic]-pV[v.semantic]);let n,a,o,l,c,u;const h=new Ls(r,s);let d=!0;for(n=0;n<h.elements.length;++n)if(c=h.elements[n],l=e[c.name],u=l.offset-t.offset,l.buffer!==t.buffer||l.stride!==c.stride||l.size!==c.size||u!==c.offset){d=!1;break}const f=new Ya(r,h,i),p=f.lock(),m=new Uint32Array(p);let g;if(d)g=new Uint32Array(t.buffer,t.offset,i*f.format.size/4),m.set(g);else{let _,v;for(n=0;n<f.format.elements.length;++n){c=f.format.elements[n],_=c.stride/4,l=e[c.name],v=l.stride/4,g=new Uint32Array(l.buffer,l.offset,(l.count-1)*v+(l.size+3)/4);let y=0,x=c.offset/4;const S=Math.floor((l.size+3)/4);for(a=0;a<i;++a){for(o=0;o<S;++o)m[x+o]=g[y+o];y+=v,x+=_}}}return f.unlock(),f},KCe=(r,e,t,i,s,n)=>{const a={},o=[];for(const u in e)e.hasOwnProperty(u)&&Ub.hasOwnProperty(u)&&(a[u]=e[u],o.push(`${u}:${e[u]}`));o.sort();const l=o.join();let c=n[l];if(!c){const u={};for(const h in a){const d=i[e[h]],f=qu(d,s),p=s[d.bufferView],m=Ub[h],g=uv(d.type)*jCe(d.componentType),_=p&&p.hasOwnProperty("byteStride")?p.byteStride:g;u[m]={buffer:f.buffer,size:g,offset:f.byteOffset,stride:_,count:d.count,components:uv(d.type),type:WE(d.componentType),normalize:d.normalized}}u.hasOwnProperty(Rs)||WCe(u,t),c=YCe(r,u),n[l]=c}return c},ZCe=(r,e,t,i,s,n)=>{let a,o,l;const c=e.joints,u=c.length,h=[];if(e.hasOwnProperty("inverseBindMatrices")){const m=e.inverseBindMatrices,g=qu(t[m],i,!0),_=[];for(a=0;a<u;a++){for(o=0;o<16;o++)_[o]=g[a*16+o];l=new se,l.set(_),h.push(l)}}else for(a=0;a<u;a++)l=new se,h.push(l);const d=[];for(a=0;a<u;a++)d[a]=s[c[a]].name;const f=d.join("#");let p=n.get(f);return p||(p=new $9(r,h,d),n.set(f,p)),p},QCe=(r,e,t,i,s,n,a)=>{var c;const o=new It(r);o.aabb=g2(t[e.attributes.POSITION]);const l=[];for(const[u,h]of Object.entries(e.attributes)){const d=t[h],f=Ub[u],p=WE(d.componentType);l.push({semantic:f,components:uv(d.type),type:p,normalize:d.normalized??(f===wr&&(p===Vu||p===wy))})}if(a.push(new Promise((u,h)=>{const d=e.extensions.KHR_draco_mesh_compression;UCe(i[d.bufferView].slice().buffer,(f,p)=>{var m;if(f)console.log(f),h(f);else{const g={};for(const[T,A]of Object.entries(d.attributes))g[Ub[T]]=p.attributes.indexOf(A);l.sort((T,A)=>g[T.semantic]-g[A.semantic]),(m=e.attributes)!=null&&m.NORMAL||l.splice(1,0,{semantic:"NORMAL",components:3,type:bt});const _=new Ls(r,l),v=p.vertices.byteLength/_.size,y=v<=65535?xc:bc,x=p.indices.byteLength/(v<=65535?2:4),S=new Ya(r,_,v,{data:p.vertices}),w=new dh(r,y,x,Kn,p.indices);o.vertexBuffer=S,o.indexBuffer[0]=w,o.primitive[0].type=BY(e),o.primitive[0].base=0,o.primitive[0].count=w?x:v,o.primitive[0].indexed=!!w,u()}})})),(c=e==null?void 0:e.extensions)!=null&&c.KHR_materials_variants){const u=e.extensions.KHR_materials_variants,h={};u.mappings.forEach(d=>{d.variants.forEach(f=>{h[f]=d.material})}),s[o.id]=h}return n[o.id]=e.material,o},JCe=(r,e,t,i,s,n,a,o,l)=>{const c=[];return e.primitives.forEach(u=>{var h;if((h=u.extensions)!=null&&h.KHR_draco_mesh_compression)c.push(QCe(r,u,t,i,n,a,l));else{let d=u.hasOwnProperty("indices")?qu(t[u.indices],i,!0):null;const f=KCe(r,u.attributes,d,t,i,s),p=BY(u),m=new It(r);if(m.vertexBuffer=f,m.primitive[0].type=p,m.primitive[0].base=0,m.primitive[0].indexed=d!==null,d!==null){let _;d instanceof Uint8Array?_=lM:d instanceof Uint16Array?_=xc:_=bc,_===lM&&r.isWebGPU&&(_=xc,d=new Uint16Array(d));const v=new dh(r,_,d.length,Kn,d);m.indexBuffer[0]=v,m.primitive[0].count=d.length}else m.primitive[0].count=f.numVertices;if(u.hasOwnProperty("extensions")&&u.extensions.hasOwnProperty("KHR_materials_variants")){const _=u.extensions.KHR_materials_variants,v={};_.mappings.forEach(y=>{y.variants.forEach(x=>{v[x]=y.material})}),n[m.id]=v}a[m.id]=u.material;let g=t[u.attributes.POSITION];if(m.aabb=g2(g),u.hasOwnProperty("targets")){const _=[];u.targets.forEach((v,y)=>{const x={};v.hasOwnProperty("POSITION")&&(g=t[v.POSITION],x.deltaPositions=Nf(g,i),x.aabb=g2(g)),v.hasOwnProperty("NORMAL")&&(g=t[v.NORMAL],x.deltaNormals=Nf(g,i)),e.hasOwnProperty("extras")&&e.extras.hasOwnProperty("targetNames")?x.name=e.extras.targetNames[y]:x.name=y.toString(10),e.hasOwnProperty("weights")&&(x.defaultWeight=e.weights[y]),x.preserveData=o.morphPreserveData,_.push(new $E(x))}),m.morph=new F9(_,r,{preferHighPrecision:o.morphPreferHighPrecision})}c.push(m)}}),c},Ni=(r,e,t)=>{var l;let i;const s=r.texCoord;if(s)for(i=0;i<t.length;++i)e[`${t[i]}MapUv`]=s;const n=[0,0],a=[1,1],o=(l=r.extensions)==null?void 0:l.KHR_texture_transform;if(o){const c=o.offset||n,u=o.scale||a,h=o.rotation?-o.rotation*Q.RAD_TO_DEG:0,d=new ee(u[0],u[1]),f=new ee(c[0],1-u[1]-c[1]);for(i=0;i<t.length;++i)e[`${t[i]}MapTiling`]=d,e[`${t[i]}MapOffset`]=f,e[`${t[i]}MapRotation`]=h}},ePe=(r,e,t)=>{let i,s;if(r.hasOwnProperty("diffuseFactor")?(i=r.diffuseFactor,e.diffuse.set(Math.pow(i[0],1/2.2),Math.pow(i[1],1/2.2),Math.pow(i[2],1/2.2)),e.opacity=i[3]):(e.diffuse.set(1,1,1),e.opacity=1),r.hasOwnProperty("diffuseTexture")){const n=r.diffuseTexture;s=t[n.index],e.diffuseMap=s,e.diffuseMapChannel="rgb",e.opacityMap=s,e.opacityMapChannel="a",Ni(n,e,["diffuse","opacity"])}if(e.useMetalness=!1,r.hasOwnProperty("specularFactor")?(i=r.specularFactor,e.specular.set(Math.pow(i[0],1/2.2),Math.pow(i[1],1/2.2),Math.pow(i[2],1/2.2))):e.specular.set(1,1,1),r.hasOwnProperty("glossinessFactor")?e.gloss=r.glossinessFactor:e.gloss=1,r.hasOwnProperty("specularGlossinessTexture")){const n=r.specularGlossinessTexture;e.specularMap=e.glossMap=t[n.index],e.specularMapChannel="rgb",e.glossMapChannel="a",Ni(n,e,["gloss","metalness"])}},tPe=(r,e,t)=>{if(r.hasOwnProperty("clearcoatFactor")?e.clearCoat=r.clearcoatFactor*.25:e.clearCoat=0,r.hasOwnProperty("clearcoatTexture")){const i=r.clearcoatTexture;e.clearCoatMap=t[i.index],e.clearCoatMapChannel="r",Ni(i,e,["clearCoat"])}if(r.hasOwnProperty("clearcoatRoughnessFactor")?e.clearCoatGloss=r.clearcoatRoughnessFactor:e.clearCoatGloss=0,r.hasOwnProperty("clearcoatRoughnessTexture")){const i=r.clearcoatRoughnessTexture;e.clearCoatGlossMap=t[i.index],e.clearCoatGlossMapChannel="g",Ni(i,e,["clearCoatGloss"])}if(r.hasOwnProperty("clearcoatNormalTexture")){const i=r.clearcoatNormalTexture;e.clearCoatNormalMap=t[i.index],Ni(i,e,["clearCoatNormal"]),i.hasOwnProperty("scale")?e.clearCoatBumpiness=i.scale:e.clearCoatBumpiness=1}e.clearCoatGlossInvert=!0},iPe=(r,e,t)=>{e.useLighting=!1,e.emissive.copy(e.diffuse),e.emissiveMap=e.diffuseMap,e.emissiveMapUv=e.diffuseMapUv,e.emissiveMapTiling.copy(e.diffuseMapTiling),e.emissiveMapOffset.copy(e.diffuseMapOffset),e.emissiveMapRotation=e.diffuseMapRotation,e.emissiveMapChannel=e.diffuseMapChannel,e.emissiveVertexColor=e.diffuseVertexColor,e.emissiveVertexColorChannel=e.diffuseVertexColorChannel,e.useLighting=!1,e.useSkybox=!1,e.diffuse.set(1,1,1),e.diffuseMap=null,e.diffuseVertexColor=!1},rPe=(r,e,t)=>{if(e.useMetalnessSpecularColor=!0,r.hasOwnProperty("specularColorTexture")&&(e.specularMap=t[r.specularColorTexture.index],e.specularMapChannel="rgb",Ni(r.specularColorTexture,e,["specular"])),r.hasOwnProperty("specularColorFactor")){const i=r.specularColorFactor;e.specular.set(Math.pow(i[0],1/2.2),Math.pow(i[1],1/2.2),Math.pow(i[2],1/2.2))}else e.specular.set(1,1,1);r.hasOwnProperty("specularFactor")?e.specularityFactor=r.specularFactor:e.specularityFactor=1,r.hasOwnProperty("specularTexture")&&(e.specularityFactorMapChannel="a",e.specularityFactorMap=t[r.specularTexture.index],Ni(r.specularTexture,e,["specularityFactor"]))},sPe=(r,e,t)=>{r.hasOwnProperty("ior")&&(e.refractionIndex=1/r.ior)},nPe=(r,e,t)=>{r.hasOwnProperty("dispersion")&&(e.dispersion=r.dispersion)},aPe=(r,e,t)=>{e.blendType=Ka,e.useDynamicRefraction=!0,r.hasOwnProperty("transmissionFactor")&&(e.refraction=r.transmissionFactor),r.hasOwnProperty("transmissionTexture")&&(e.refractionMapChannel="r",e.refractionMap=t[r.transmissionTexture.index],Ni(r.transmissionTexture,e,["refraction"]))},oPe=(r,e,t)=>{if(e.useSheen=!0,r.hasOwnProperty("sheenColorFactor")){const i=r.sheenColorFactor;e.sheen.set(Math.pow(i[0],1/2.2),Math.pow(i[1],1/2.2),Math.pow(i[2],1/2.2))}else e.sheen.set(1,1,1);r.hasOwnProperty("sheenColorTexture")&&(e.sheenMap=t[r.sheenColorTexture.index],Ni(r.sheenColorTexture,e,["sheen"])),e.sheenGloss=r.hasOwnProperty("sheenRoughnessFactor")?r.sheenRoughnessFactor:0,r.hasOwnProperty("sheenRoughnessTexture")&&(e.sheenGlossMap=t[r.sheenRoughnessTexture.index],e.sheenGlossMapChannel="a",Ni(r.sheenRoughnessTexture,e,["sheenGloss"])),e.sheenGlossInvert=!0},lPe=(r,e,t)=>{if(e.blendType=Ka,e.useDynamicRefraction=!0,r.hasOwnProperty("thicknessFactor")&&(e.thickness=r.thicknessFactor),r.hasOwnProperty("thicknessTexture")&&(e.thicknessMap=t[r.thicknessTexture.index],e.thicknessMapChannel="g",Ni(r.thicknessTexture,e,["thickness"])),r.hasOwnProperty("attenuationDistance")&&(e.attenuationDistance=r.attenuationDistance),r.hasOwnProperty("attenuationColor")){const i=r.attenuationColor;e.attenuation.set(Math.pow(i[0],1/2.2),Math.pow(i[1],1/2.2),Math.pow(i[2],1/2.2))}},cPe=(r,e,t)=>{r.hasOwnProperty("emissiveStrength")&&(e.emissiveIntensity=r.emissiveStrength)},uPe=(r,e,t)=>{e.useIridescence=!0,r.hasOwnProperty("iridescenceFactor")&&(e.iridescence=r.iridescenceFactor),r.hasOwnProperty("iridescenceTexture")&&(e.iridescenceMapChannel="r",e.iridescenceMap=t[r.iridescenceTexture.index],Ni(r.iridescenceTexture,e,["iridescence"])),r.hasOwnProperty("iridescenceIor")&&(e.iridescenceRefractionIndex=r.iridescenceIor),r.hasOwnProperty("iridescenceThicknessMinimum")&&(e.iridescenceThicknessMin=r.iridescenceThicknessMinimum),r.hasOwnProperty("iridescenceThicknessMaximum")&&(e.iridescenceThicknessMax=r.iridescenceThicknessMaximum),r.hasOwnProperty("iridescenceThicknessTexture")&&(e.iridescenceThicknessMapChannel="g",e.iridescenceThicknessMap=t[r.iridescenceThicknessTexture.index],Ni(r.iridescenceThicknessTexture,e,["iridescenceThickness"]))},hPe=(r,e,t)=>{if(e.enableGGXSpecular=!0,r.hasOwnProperty("anisotropyStrength")?e.anisotropyIntensity=r.anisotropyStrength:e.anisotropyIntensity=0,r.hasOwnProperty("anisotropyTexture")){const i=r.anisotropyTexture;e.anisotropyMap=t[i.index],Ni(i,e,["anisotropy"])}r.hasOwnProperty("anisotropyRotation")?e.anisotropyRotation=r.anisotropyRotation*Q.RAD_TO_DEG:e.anisotropyRotation=0},UY=(r,e)=>{const t=new Ns;r.hasOwnProperty("name")&&(t.name=r.name),t.occludeSpecular=OE,t.diffuseVertexColor=!0,t.specularTint=!0,t.specularVertexColor=!0,t.specular.set(1,1,1),t.gloss=1,t.glossInvert=!0,t.useMetalness=!0;let i,s;if(r.hasOwnProperty("pbrMetallicRoughness")){const a=r.pbrMetallicRoughness;if(a.hasOwnProperty("baseColorFactor")&&(i=a.baseColorFactor,t.diffuse.set(Math.pow(i[0],1/2.2),Math.pow(i[1],1/2.2),Math.pow(i[2],1/2.2)),t.opacity=i[3]),a.hasOwnProperty("baseColorTexture")){const o=a.baseColorTexture;s=e[o.index],t.diffuseMap=s,t.diffuseMapChannel="rgb",t.opacityMap=s,t.opacityMapChannel="a",Ni(o,t,["diffuse","opacity"])}if(a.hasOwnProperty("metallicFactor")&&(t.metalness=a.metallicFactor),a.hasOwnProperty("roughnessFactor")&&(t.gloss=a.roughnessFactor),a.hasOwnProperty("metallicRoughnessTexture")){const o=a.metallicRoughnessTexture;t.metalnessMap=t.glossMap=e[o.index],t.metalnessMapChannel="b",t.glossMapChannel="g",Ni(o,t,["gloss","metalness"])}}if(r.hasOwnProperty("normalTexture")){const a=r.normalTexture;t.normalMap=e[a.index],Ni(a,t,["normal"]),a.hasOwnProperty("scale")&&(t.bumpiness=a.scale)}if(r.hasOwnProperty("occlusionTexture")){const a=r.occlusionTexture;t.aoMap=e[a.index],t.aoMapChannel="r",Ni(a,t,["ao"])}if(r.hasOwnProperty("emissiveFactor")&&(i=r.emissiveFactor,t.emissive.set(Math.pow(i[0],1/2.2),Math.pow(i[1],1/2.2),Math.pow(i[2],1/2.2))),r.hasOwnProperty("emissiveTexture")){const a=r.emissiveTexture;t.emissiveMap=e[a.index],Ni(a,t,["emissive"])}if(r.hasOwnProperty("alphaMode"))switch(r.alphaMode){case"MASK":t.blendType=an,r.hasOwnProperty("alphaCutoff")?t.alphaTest=r.alphaCutoff:t.alphaTest=.5;break;case"BLEND":t.blendType=Ka,t.depthWrite=!1;break;default:case"OPAQUE":t.blendType=an;break}else t.blendType=an;r.hasOwnProperty("doubleSided")?(t.twoSidedLighting=r.doubleSided,t.cull=r.doubleSided?Vi:oh):(t.twoSidedLighting=!1,t.cull=oh);const n={KHR_materials_clearcoat:tPe,KHR_materials_emissive_strength:cPe,KHR_materials_ior:sPe,KHR_materials_dispersion:nPe,KHR_materials_iridescence:uPe,KHR_materials_pbrSpecularGlossiness:ePe,KHR_materials_sheen:oPe,KHR_materials_specular:rPe,KHR_materials_transmission:aPe,KHR_materials_unlit:iPe,KHR_materials_volume:lPe,KHR_materials_anisotropy:hPe};if(r.hasOwnProperty("extensions"))for(const a in r.extensions){const o=n[a];o!==void 0&&o(r.extensions[a],t,e)}return t.update(),t},dPe=(r,e,t,i,s,n,a)=>{const o=A=>new Bb(uv(A.type),Nf(A,i)),l={STEP:tY,LINEAR:UM,CUBICSPLINE:zM},c={},u={},h={};let d=1,f;for(f=0;f<r.samplers.length;++f){const A=r.samplers[f];c.hasOwnProperty(A.input)||(c[A.input]=o(t[A.input])),u.hasOwnProperty(A.output)||(u[A.output]=o(t[A.output]));const C=A.hasOwnProperty("interpolation")&&l.hasOwnProperty(A.interpolation)?l[A.interpolation]:UM,P={paths:[],input:A.input,output:A.output,interpolation:C};h[f]=P}const p=[],m={translation:"localPosition",rotation:"localRotation",scale:"localScale"},g=A=>{const C=[];for(;A;)C.unshift(A.name),A=A.parent;return C},_=(A,C,P)=>{const I=u[A.output];if(!I)return;let M;if(n&&n[C.mesh]){const L=n[C.mesh];L.hasOwnProperty("extras")&&L.extras.hasOwnProperty("targetNames")&&(M=L.extras.targetNames)}const N=I.data,k=N.length/c[A.input].data.length,V=N.length/k,B=V*4,R=new ArrayBuffer(B*k);for(let L=0;L<k;L++){const D=new Float32Array(R,B*L,V);for(let $=0;$<V;$++)D[$]=N[$*k+L];const F=new Bb(1,D),j=M!=null&&M[L]?`name.${M[L]}`:L;u[-d]=F;const z={paths:[{entityPath:P,component:"graph",propertyPath:[`weight.${j}`]}],input:A.input,output:-d,interpolation:A.interpolation};d++,h[`morphCurve-${f}-${L}`]=z}};for(f=0;f<r.channels.length;++f){const A=r.channels[f],C=A.target,P=h[A.sampler],I=s[C.node],M=a[C.node],N=g(I);C.path.startsWith("weights")?(_(P,M,N),h[A.sampler].morphCurve=!0):P.paths.push({entityPath:N,component:"graph",propertyPath:[m[C.path]]})}const v=[],y=[],x=[];for(const A in c)v.push(c[A]),c[A]=v.length-1;for(const A in u)y.push(u[A]),u[A]=y.length-1;for(const A in h){const C=h[A];C.morphCurve||(x.push(new kY(C.paths,c[C.input],u[C.output],C.interpolation)),C.paths.length>0&&C.paths[0].propertyPath[0]==="localRotation"&&C.interpolation!==zM&&p.push(x[x.length-1].output))}p.sort();let S=null,w;for(f=0;f<p.length;++f){const A=p[f];if(f===0||A!==S){if(w=y[A],w.components===4){const C=w.data,P=C.length-4;for(let I=0;I<P;I+=4)C[I+0]*C[I+4]+C[I+1]*C[I+5]+C[I+2]*C[I+6]+C[I+3]*C[I+7]<0&&(C[I+4]*=-1,C[I+5]*=-1,C[I+6]*=-1,C[I+7]*=-1)}S=A}}let T=0;for(f=0;f<v.length;f++)w=v[f]._data,T=Math.max(T,w.length===0?0:w[w.length-1]);return new Jo(r.hasOwnProperty("name")?r.name:`animation_${e}`,T,v,y,x)},hS=new se,xd=new O,fPe=(r,e,t)=>{const i=new Xt;if(r.hasOwnProperty("name")&&r.name.length>0?i.name=r.name:i.name=`node_${e}`,r.hasOwnProperty("matrix")&&(hS.data.set(r.matrix),hS.getTranslation(xd),i.setLocalPosition(xd),hS.getEulerAngles(xd),i.setLocalEulerAngles(xd),hS.getScale(xd),i.setLocalScale(xd)),r.hasOwnProperty("rotation")){const s=r.rotation;i.setLocalRotation(s[0],s[1],s[2],s[3])}if(r.hasOwnProperty("translation")){const s=r.translation;i.setLocalPosition(s[0],s[1],s[2])}if(r.hasOwnProperty("scale")){const s=r.scale;i.setLocalScale(s[0],s[1],s[2])}return r.hasOwnProperty("extensions")&&r.extensions.EXT_mesh_gpu_instancing&&t.set(r,{ext:r.extensions.EXT_mesh_gpu_instancing}),i},pPe=(r,e)=>{const t=r.type==="orthographic"?Mf:ba,i=t===Mf?r.orthographic:r.perspective,s={enabled:!1,projection:t,nearClip:i.znear,aspectRatioMode:N3};i.zfar&&(s.farClip=i.zfar),t===Mf?(s.orthoHeight=.5*i.ymag,i.ymag&&(s.aspectRatioMode=PM,s.aspectRatio=i.xmag/i.ymag)):(s.fov=i.yfov*Q.RAD_TO_DEG,i.aspectRatio&&(s.aspectRatioMode=PM,s.aspectRatio=i.aspectRatio));const n=new lt(r.name);return n.addComponent("camera",s),n},mPe=(r,e)=>{const t={enabled:!1,type:r.type==="point"?"omni":r.type,color:r.hasOwnProperty("color")?new ae(r.color):ae.WHITE,range:r.hasOwnProperty("range")?r.range:9999,falloffMode:h9,intensity:r.hasOwnProperty("intensity")?Q.clamp(r.intensity,0,2):1};r.hasOwnProperty("spot")&&(t.innerConeAngle=r.spot.hasOwnProperty("innerConeAngle")?r.spot.innerConeAngle*Q.RAD_TO_DEG:0,t.outerConeAngle=r.spot.hasOwnProperty("outerConeAngle")?r.spot.outerConeAngle*Q.RAD_TO_DEG:Math.PI/4),r.hasOwnProperty("intensity")&&(t.luminance=r.intensity*sv.getLightUnitConversion(MM[t.type],t.outerConeAngle,t.innerConeAngle));const i=new lt(e.name);return i.rotateLocal(90,0,0),i.addComponent("light",t),i},gPe=(r,e,t,i)=>{if(!e.hasOwnProperty("skins")||e.skins.length===0)return[];const s=new Map;return e.skins.map(n=>ZCe(r,n,e.accessors,i,t,s))},_Pe=(r,e,t,i)=>{var u,h,d;const s={},n={},a={},o=[];return{meshes:!i.skipMeshes&&((u=e==null?void 0:e.meshes)==null?void 0:u.length)&&((h=e==null?void 0:e.accessors)==null?void 0:h.length)&&((d=e==null?void 0:e.bufferViews)==null?void 0:d.length)?e.meshes.map(f=>JCe(r,f,e.accessors,t,s,n,a,i,o)):[],meshVariants:n,meshDefaultMaterials:a,promises:o}},vPe=(r,e,t)=>{var a,o,l;if(!r.hasOwnProperty("materials")||r.materials.length===0)return[];const i=(a=t==null?void 0:t.material)==null?void 0:a.preprocess,s=((o=t==null?void 0:t.material)==null?void 0:o.process)??UY,n=(l=t==null?void 0:t.material)==null?void 0:l.postprocess;return r.materials.map(c=>{i&&i(c);const u=s(c,e);return n&&n(c,u),u})},yPe=r=>{if(!r.hasOwnProperty("extensions")||!r.extensions.hasOwnProperty("KHR_materials_variants"))return null;const e=r.extensions.KHR_materials_variants.variants,t={};for(let i=0;i<e.length;i++)t[e[i].name]=i;return t},SPe=(r,e,t,i)=>{var a,o;if(!r.hasOwnProperty("animations")||r.animations.length===0)return[];const s=(a=i==null?void 0:i.animation)==null?void 0:a.preprocess,n=(o=i==null?void 0:i.animation)==null?void 0:o.postprocess;return r.animations.map((l,c)=>{s&&s(l);const u=dPe(l,c,r.accessors,t,e,r.meshes,r.nodes);return n&&n(l,u),u})},xPe=(r,e,t,i)=>{const s=e.accessors;t.forEach((n,a)=>{const o=n.ext.attributes;let l;if(o.hasOwnProperty("TRANSLATION")){const d=s[o.TRANSLATION];l=Nf(d,i)}let c;if(o.hasOwnProperty("ROTATION")){const d=s[o.ROTATION];c=Nf(d,i)}let u;if(o.hasOwnProperty("SCALE")){const d=s[o.SCALE];u=Nf(d,i)}const h=(l?l.length/3:0)||(c?c.length/4:0)||(u?u.length/3:0);if(h){const d=new Float32Array(h*16),f=new O,p=new de,m=new O(1,1,1),g=new se;let _=0;for(let v=0;v<h;v++){const y=v*3;if(l&&f.set(l[y],l[y+1],l[y+2]),c){const x=v*4;p.set(c[x],c[x+1],c[x+2],c[x+3])}u&&m.set(u[y],u[y+1],u[y+2]),g.setTRS(f,p,m);for(let x=0;x<16;x++)d[_++]=g.data[x]}n.matrices=d}})},bPe=(r,e,t)=>{var o,l,c;if(!r.hasOwnProperty("nodes")||r.nodes.length===0)return[];const i=(o=e==null?void 0:e.node)==null?void 0:o.preprocess,s=((l=e==null?void 0:e.node)==null?void 0:l.process)??fPe,n=(c=e==null?void 0:e.node)==null?void 0:c.postprocess,a=r.nodes.map((u,h)=>{i&&i(u);const d=s(u,h,t);return n&&n(u,d),d});for(let u=0;u<r.nodes.length;++u){const h=r.nodes[u];if(h.hasOwnProperty("children")){const d=a[u],f={};for(let p=0;p<h.children.length;++p){const m=a[h.children[p]];m.parent||(f.hasOwnProperty(m.name)?m.name+=f[m.name]++:f[m.name]=1,d.addChild(m))}}}return a},wPe=(r,e)=>{var s;const t=[],i=r.scenes.length;if(i===1&&((s=r.scenes[0].nodes)==null?void 0:s.length)===1){const n=r.scenes[0].nodes[0];t.push(e[n])}else for(let n=0;n<i;n++){const a=r.scenes[n];if(a.nodes){const o=new Xt(a.name);for(let l=0;l<a.nodes.length;l++){const c=e[a.nodes[l]];o.addChild(c)}t.push(o)}}return t},TPe=(r,e,t)=>{var s,n,a;let i=null;if(r.hasOwnProperty("nodes")&&r.hasOwnProperty("cameras")&&r.cameras.length>0){const o=(s=t==null?void 0:t.camera)==null?void 0:s.preprocess,l=((n=t==null?void 0:t.camera)==null?void 0:n.process)??pPe,c=(a=t==null?void 0:t.camera)==null?void 0:a.postprocess;r.nodes.forEach((u,h)=>{if(u.hasOwnProperty("camera")){const d=r.cameras[u.camera];if(d){o&&o(d);const f=l(d,e[h]);c&&c(d,f),f&&(i||(i=new Map),i.set(u,f))}}})}return i},EPe=(r,e,t)=>{var s,n,a;let i=null;if(r.hasOwnProperty("nodes")&&r.hasOwnProperty("extensions")&&r.extensions.hasOwnProperty("KHR_lights_punctual")&&r.extensions.KHR_lights_punctual.hasOwnProperty("lights")){const o=r.extensions.KHR_lights_punctual.lights;if(o.length){const l=(s=t==null?void 0:t.light)==null?void 0:s.preprocess,c=((n=t==null?void 0:t.light)==null?void 0:n.process)??mPe,u=(a=t==null?void 0:t.light)==null?void 0:a.postprocess;r.nodes.forEach((h,d)=>{if(h.hasOwnProperty("extensions")&&h.extensions.hasOwnProperty("KHR_lights_punctual")&&h.extensions.KHR_lights_punctual.hasOwnProperty("light")){const f=h.extensions.KHR_lights_punctual.light,p=o[f];if(p){l&&l(p);const m=c(p,e[d]);u&&u(p,m),m&&(i||(i=new Map),i.set(h,m))}}})}}return i},APe=(r,e,t)=>{r.nodes.forEach(i=>{i.hasOwnProperty("mesh")&&i.hasOwnProperty("skin")&&e[i.mesh].meshes.forEach(n=>{n.skin=t[i.skin]})})},CPe=async(r,e,t,i,s)=>{var C,P;const n=(C=s==null?void 0:s.global)==null?void 0:C.preprocess,a=(P=s==null?void 0:s.global)==null?void 0:P.postprocess;n&&n(e),e.asset&&e.asset.generator;const o=new Map,l=bPe(e,s,o),c=wPe(e,l),u=EPe(e,l,s),h=TPe(e,l,s),d=yPe(e),f=await Promise.all(t),{meshes:p,meshVariants:m,meshDefaultMaterials:g,promises:_}=_Pe(r,e,f,s),v=SPe(e,l,f,s);xPe(r,e,o,f);const y=await Promise.all(i),x=y.map(I=>I.resource),S=vPe(e,x,s),w=gPe(r,e,l,f),T=[];for(let I=0;I<p.length;I++)T[I]=new Fb,T[I].meshes=p[I];APe(e,T,w);const A=new zCe;return A.gltf=e,A.nodes=l,A.scenes=c,A.animations=v,A.textures=y,A.materials=S,A.variants=d,A.meshVariants=m,A.meshDefaultMaterials=g,A.renders=T,A.skins=w,A.lights=u,A.cameras=h,A.nodeInstancingMap=o,a&&a(e,A),await Promise.all(_),A},PPe=(r,e)=>{const t=(s,n)=>{switch(s){case 9728:return qe;case 9729:return _i;case 9984:return rE;case 9985:return nE;case 9986:return sE;case 9987:return lh;default:return n}},i=(s,n)=>{switch(s){case 33071:return ge;case 33648:return CO;case 10497:return zi;default:return n}};r&&(e=e??{},r.minFilter=t(e.minFilter,lh),r.magFilter=t(e.magFilter,_i),r.addressU=i(e.wrapS,zi),r.addressV=i(e.wrapT,zi))};let IPe=0;const Dd=r=>{var e,t,i,s;return((t=(e=r.extensions)==null?void 0:e.KHR_texture_basisu)==null?void 0:t.source)??((s=(i=r.extensions)==null?void 0:i.EXT_texture_webp)==null?void 0:s.source)??r.source},MPe=(r,e,t,i,s)=>{var d,f,p;if(!r.images||r.images.length===0)return[];const n=(d=s==null?void 0:s.image)==null?void 0:d.preprocess,a=(f=s==null?void 0:s.image)==null?void 0:f.processAsync,o=(p=s==null?void 0:s.image)==null?void 0:p.postprocess,l={"image/png":"png","image/jpeg":"jpg","image/basis":"basis","image/ktx":"ktx","image/ktx2":"ktx2","image/vnd-ms.dds":"dds"},c=m=>{const g=new Set;return m.hasOwnProperty("materials")&&m.materials.forEach(_=>{if(_.hasOwnProperty("pbrMetallicRoughness")){const v=_.pbrMetallicRoughness;if(v.hasOwnProperty("baseColorTexture")){const y=m.textures[v.baseColorTexture.index];g.add(Dd(y))}}if(_.hasOwnProperty("emissiveTexture")){const v=m.textures[_.emissiveTexture.index];g.add(Dd(v))}if(_.hasOwnProperty("extensions")){const v=_.extensions.KHR_materials_sheen;if(v&&v.hasOwnProperty("sheenColorTexture")){const S=m.textures[v.sheenColorTexture.index];g.add(Dd(S))}const y=_.extensions.KHR_materials_pbrSpecularGlossiness;if(y&&y.hasOwnProperty("specularGlossinessTexture")){const S=m.textures[y.specularGlossinessTexture.index];g.add(Dd(S))}const x=_.extensions.KHR_materials_specular;if(x&&x.hasOwnProperty("specularColorTexture")){const S=m.textures[x.specularColorTexture.index];g.add(Dd(S))}}}),g},u=(m,g,_,v,y,x)=>new Promise((S,w)=>{const T=A=>{const C=`${m.name||"gltf-texture"}-${IPe++}`,P={url:g||C};if(A&&(P.contents=A.slice(0).buffer),v){const N=l[v];N&&(P.filename=`${P.url}.${N}`)}const I={srgb:x},M=new be(C,"texture",P,I,y);M.on("load",N=>S(N)),M.on("error",N=>w(N)),i.add(M),i.load(M)};_?_.then(A=>T(A)):T(null)}),h=c(r);return r.images.map((m,g)=>{n&&n(m);let _;return a?_=new Promise((v,y)=>{a(m,(x,S)=>{x?y(x):v(S)})}):_=new Promise(v=>{v(null)}),_=_.then(v=>{const y=h.has(g);return v||(m.hasOwnProperty("uri")?FY(m.uri)?u(m,m.uri,null,VCe(m.uri),null,y):u(m,yp.test(m.uri)?m.uri:Ne.join(t,m.uri),null,null,{crossOrigin:"anonymous"},y):m.hasOwnProperty("bufferView")&&m.hasOwnProperty("mimeType")?u(m,null,e[m.bufferView],m.mimeType,null,y):Promise.reject(new Error(`Invalid image found in gltf (neither uri or bufferView found). index=${g}`)))}),o&&(_=_.then(v=>(o(m,v),v))),_})},RPe=(r,e,t)=>{var o,l,c,u,h;if(!((o=r==null?void 0:r.images)!=null&&o.length)||!((l=r==null?void 0:r.textures)!=null&&l.length))return[];const i=(c=t==null?void 0:t.texture)==null?void 0:c.preprocess,s=(u=t==null?void 0:t.texture)==null?void 0:u.processAsync,n=(h=t==null?void 0:t.texture)==null?void 0:h.postprocess,a=new Set;return r.textures.map(d=>{i&&i(d);let f;return s?f=new Promise((p,m)=>{s(d,r.images,(g,_)=>{g?m(g):p(_)})}):f=new Promise(p=>{p(null)}),f=f.then(p=>{p=p??Dd(d);const m=a.has(p);return a.add(p),e[p].then(g=>{const _=m?qCe(g):g;return PPe(_.resource,(r.samplers??[])[d.sampler]),_})}),n&&(f=f.then(p=>(n(d,p),p))),f})},DPe=(r,e,t,i)=>{var o,l,c;if(!r.buffers||r.buffers.length===0)return[];const s=(o=i==null?void 0:i.buffer)==null?void 0:o.preprocess,n=(l=i==null?void 0:i.buffer)==null?void 0:l.processAsync,a=(c=i==null?void 0:i.buffer)==null?void 0:c.postprocess;return r.buffers.map((u,h)=>{s&&s(u);let d;return n?d=new Promise((f,p)=>{n(u,(m,g)=>{m?p(m):f(g)})}):d=new Promise(f=>{f(null)}),d=d.then(f=>{if(f)return f;if(u.hasOwnProperty("uri")){if(FY(u.uri)){const p=atob(u.uri.split(",")[1]),m=new Uint8Array(p.length);for(let g=0;g<p.length;g++)m[g]=p.charCodeAt(g);return m}return new Promise((p,m)=>{qt.get(yp.test(u.uri)?u.uri:Ne.join(t,u.uri),{cache:!0,responseType:"arraybuffer",retry:!1},(g,_)=>{g?m(g):p(new Uint8Array(_))})})}return e}),a&&(d=d.then(f=>(a(r.buffers[h],f),f))),d})},LPe=(r,e)=>{const i=JSON.parse((s=>{if(typeof TextDecoder<"u")return new TextDecoder().decode(s);let n="";for(let a=0;a<s.length;a++)n+=String.fromCharCode(s[a]);return decodeURIComponent(escape(n))})(r));if(i.asset&&i.asset.version&&parseFloat(i.asset.version)<2){e(`Invalid gltf version. Expected version 2.0 or above but found version '${i.asset.version}'.`);return}e(null,i)},OPe=(r,e)=>{const t=r instanceof ArrayBuffer?new DataView(r):new DataView(r.buffer,r.byteOffset,r.byteLength),i=t.getUint32(0,!0),s=t.getUint32(4,!0),n=t.getUint32(8,!0);if(i!==1179937895){e(`Invalid magic number found in glb header. Expected 0x46546C67, found 0x${i.toString(16)}`);return}if(s!==2){e(`Invalid version number found in glb header. Expected 2, found ${s}`);return}if(n<=0||n>t.byteLength){e(`Invalid length found in glb header. Found ${n}`);return}const a=[];let o=12;for(;o<n;){const l=t.getUint32(o,!0);o+l+8>t.byteLength&&e(`Invalid chunk length found in glb. Found ${l}`);const c=t.getUint32(o+4,!0),u=new Uint8Array(t.buffer,t.byteOffset+o+8,l);a.push({length:l,type:c,data:u}),o+=l+8}if(a.length!==1&&a.length!==2){e("Invalid number of chunks found in glb file.");return}if(a[0].type!==1313821514){e(`Invalid chunk type found in glb file. Expected 0x4E4F534A, found 0x${a[0].type.toString(16)}`);return}if(a.length>1&&a[1].type!==5130562){e(`Invalid chunk type found in glb file. Expected 0x004E4942, found 0x${a[1].type.toString(16)}`);return}e(null,{gltfChunk:a[0].data,binaryChunk:a.length===2?a[1].data:null})},NPe=(r,e,t)=>{const i=()=>{const s=new Uint8Array(e);return s[0]===103&&s[1]===108&&s[2]===84&&s[3]===70};r&&r.toLowerCase().endsWith(".glb")||i()?OPe(e,t):t(null,{gltfChunk:e,binaryChunk:null})},kPe=(r,e,t)=>{var o,l,c,u;const i=[],s=(o=t==null?void 0:t.bufferView)==null?void 0:o.preprocess,n=(l=t==null?void 0:t.bufferView)==null?void 0:l.processAsync,a=(c=t==null?void 0:t.bufferView)==null?void 0:c.postprocess;if(!((u=r.bufferViews)!=null&&u.length))return i;for(let h=0;h<r.bufferViews.length;++h){const d=r.bufferViews[h];s&&s(d);let f;n?f=new Promise((p,m)=>{n(d,e,(g,_)=>{g?m(g):p(_)})}):f=new Promise(p=>{p(null)}),f=f.then(p=>p||e[d.buffer].then(m=>new Uint8Array(m.buffer,m.byteOffset+(d.byteOffset||0),d.byteLength))),d.hasOwnProperty("byteStride")&&(f=f.then(p=>(p.byteStride=d.byteStride,p))),a&&(f=f.then(p=>(a(d,p),p))),i.push(f)}return i};class zb{static parse(e,t,i,s,n,a,o){NPe(e,i,(l,c)=>{if(l){o(l);return}LPe(c.gltfChunk,(u,h)=>{if(u){o(u);return}const d=DPe(h,c.binaryChunk,t,a),f=kPe(h,d,a),p=MPe(h,f,t,n,a),m=RPe(h,p,a);CPe(s,h,f,m,a).then(g=>o(null,g)).catch(g=>o(g))})})}static createDefaultMaterial(){return UY({name:"defaultGlbMaterial"},[])}}class FPe extends Ot{constructor(e){super(e,"animation"),this.device=e.graphicsDevice,this.assets=e.assets}load(e,t,i){typeof e=="string"&&(e={load:e,original:e});const s={retry:this.maxRetries>0,maxRetries:this.maxRetries};(e.load.startsWith("blob:")||e.load.startsWith("data:"))&&(Ne.getExtension(e.original).toLowerCase()===".glb"?s.responseType=Os.ResponseType.ARRAY_BUFFER:s.responseType=Os.ResponseType.JSON),qt.get(e.load,s,(n,a)=>{n?t(`Error loading animation resource: ${e.original} [${n}]`):Ne.getExtension(e.original).toLowerCase()===".glb"?zb.parse("filename.glb","",a,this.device,this.assets,(i==null?void 0:i.options)??{},(o,l)=>{var c;if(o)t(o);else{const u=l.animations;if((c=i==null?void 0:i.data)!=null&&c.events)for(let h=0;h<u.length;h++)u[h].events=new nY(Object.values(i.data.events));l.destroy(),t(null,u)}}):t(null,this[`_parseAnimationV${a.animation.version}`](a))})}open(e,t,i){return t}_parseAnimationV3(e){const t=e.animation,i=new fz;i.name=t.name,i.duration=t.duration;for(let s=0;s<t.nodes.length;s++){const n=new dz,a=t.nodes[s];n._name=a.name;for(let o=0;o<a.keys.length;o++){const l=a.keys[o],c=l.time,u=l.pos,h=l.rot,d=l.scale,f=new O(u[0],u[1],u[2]),p=new de().setFromEulerAngles(h[0],h[1],h[2]),m=new O(d[0],d[1],d[2]),g=new hz(c,f,p,m);n._keys.push(g)}i.addNode(n)}return i}_parseAnimationV4(e){const t=e.animation,i=new fz;i.name=t.name,i.duration=t.duration;for(let s=0;s<t.nodes.length;s++){const n=new dz,a=t.nodes[s];n._name=a.name;const o=a.defaults.p,l=a.defaults.r,c=a.defaults.s;for(let u=0;u<a.keys.length;u++){const h=a.keys[u],d=h.t,f=o||h.p,p=l||h.r,m=c||h.s,g=new O(f[0],f[1],f[2]),_=new de().setFromEulerAngles(p[0],p[1],p[2]),v=new O(m[0],m[1],m[2]),y=new hz(d,g,_,v);n._keys.push(y)}i.addNode(n)}return i}}class BPe extends Ot{constructor(e){super(e,"animclip")}load(e,t){typeof e=="string"&&(e={load:e,original:e});const i={retry:this.maxRetries>0,maxRetries:this.maxRetries};e.load.startsWith("blob:")&&(i.responseType=Os.ResponseType.JSON),qt.get(e.load,i,(s,n)=>{s?t(`Error loading animation clip resource: ${e.original} [${s}]`):t(null,n)})}open(e,t){const i=t.name,s=t.duration,n=t.inputs.map(l=>new Bb(1,l)),a=t.outputs.map(l=>new Bb(l.components,l.data)),o=t.curves.map(l=>new kY([l.path],l.inputIndex,l.outputIndex,l.interpolation));return new Jo(i,s,n,a,o)}}class UPe extends Ot{constructor(e){super(e,"animstategraph")}load(e,t){typeof e=="string"&&(e={load:e,original:e});const i={retry:this.maxRetries>0,maxRetries:this.maxRetries};e.load.startsWith("blob:")&&(i.responseType=Os.ResponseType.JSON),qt.get(e.load,i,(s,n)=>{s?t(`Error loading animation state graph resource: ${e.original} [${s}]`):t(null,n)})}open(e,t){return new hx(t)}}const $C=function(){if(typeof window>"u")return!1;const r=window.navigator.userAgent,e=r.indexOf("MSIE ");if(e>0)return parseInt(r.substring(e+5,r.indexOf(".",e)),10);if(r.indexOf("Trident/")>0){const i=r.indexOf("rv:");return parseInt(r.substring(i+3,r.indexOf(".",i)),10)}return!1}(),zPe=[".ogg",".mp3",".wav",".mp4a",".m4a",".mp4",".aac",".opus"];class VPe extends Ot{constructor(e){super(e,"audio"),this.manager=e.soundManager}_isSupported(e){const t=Ne.getExtension(e);return zPe.indexOf(t)>-1}load(e,t){typeof e=="string"&&(e={load:e,original:e});const i=function(n){t(null,new Bpe(n))},s=function(n){let a=`Error loading audio url: ${e.original}`;n&&(a+=`: ${n.message||n}`),console.warn(a),t(a)};if(this._createSound){if(!this._isSupported(e.original)){s(`Audio format for ${e.original} not supported`);return}this._createSound(e.load,i,s)}else s(null)}_createSound(e,t,i){if(Ey()){const s=this.manager;if(!s.context){i("Audio manager has no audio context");return}const n={retry:this.maxRetries>0,maxRetries:this.maxRetries};(e.startsWith("blob:")||e.startsWith("data:"))&&(n.responseType=Os.ResponseType.ARRAY_BUFFER),qt.get(e,n,(a,o)=>{if(a){i(a);return}s.context.decodeAudioData(o,t,i)})}else{let s=null;try{s=new Audio}catch{i("No support for Audio element");return}$C&&document.body.appendChild(s);const n=function(){s.removeEventListener("canplaythrough",n),$C&&document.body.removeChild(s),t(s)};s.onerror=function(){s.onerror=null,$C&&document.body.removeChild(s),i()},s.addEventListener("canplaythrough",n),s.src=e}}}class jPe extends Ot{constructor(e){super(e,"binary")}load(e,t){typeof e=="string"&&(e={load:e,original:e}),qt.get(e.load,{responseType:Os.ResponseType.ARRAY_BUFFER,retry:this.maxRetries>0,maxRetries:this.maxRetries},(i,s)=>{i?t(`Error loading binary resource: ${e.original} [${i}]`):t(null,s)})}openBinary(e){return e.buffer}}class Gl{constructor(e,t,i,s){const n=function(c,u,h){const d=Gl.createAsset(t.name,c,u,h);return i.add(d),d},a=[];for(let c=0;c<e.renders.length;++c)a.push(n("render",e.renders[c],c));const o=[];for(let c=0;c<e.materials.length;++c)o.push(n("material",e.materials[c],c));const l=[];for(let c=0;c<e.animations.length;++c)l.push(n("animation",e.animations[c],c));this.data=e,this._model=null,this._assetName=t.name,this._assets=i,this._defaultMaterial=s,this.renders=a,this.materials=o,this.textures=e.textures,this.animations=l}get model(){if(!this._model){const e=Gl.createModel(this.data,this._defaultMaterial),t=Gl.createAsset(this._assetName,"model",e,0);this._assets.add(t),this._model=t}return this._model}static createAsset(e,t,i,s){const n=new be(`${e}/${t}/${s}`,t,{url:""});return n.resource=i,n.loaded=!0,n}instantiateModelEntity(e){const t=new lt(void 0,this._assets._loader._app);return t.addComponent("model",Object.assign({type:"asset",asset:this.model},e)),t}instantiateRenderEntity(e){const t=this._defaultMaterial,i=[],s=function(o,l,c,u,h,d,f,p){const m=h[c.id],g=m===void 0?t:u[m],_=new Dt(c,g);c.morph&&(_.morphInstance=new vh(c.morph)),f.hasOwnProperty("skin")&&i.push({meshInstance:_,rootBone:o,entity:l});const v=p.get(f);if(v){const y=v.matrices,x=Ls.getDefaultInstancingFormat(c.device),S=new Ya(c.device,x,y.length/16,{data:y});_.setInstancing(S),_.instancingData._destroyVertexBuffer=!0}return _},n=(o,l,c)=>{const u=new lt(void 0,this._assets._loader._app);l._cloneInternal(u),o||(o=u);let h=null,d=null;for(let p=0;p<c.nodes.length;p++)if(c.nodes[p]===l){const g=c.gltf.nodes[p];if(g.hasOwnProperty("mesh")){const _=c.renders[g.mesh].meshes;d=this.renders[g.mesh];for(let v=0;v<_.length;v++){const y=_[v];if(y){const x=s(o,u,y,c.materials,c.meshDefaultMaterials,c.skins,g,c.nodeInstancingMap);h||(h=[]),h.push(x)}}}if(c.lights){const _=c.lights.get(g);_&&u.addChild(_.clone())}if(c.cameras){const _=c.cameras.get(g);_&&_.camera.system.cloneComponent(_,u)}}h&&(u.addComponent("render",Object.assign({type:"asset",meshInstances:h},e)),u.render.assignAsset(d));const f=l.children;for(let p=0;p<f.length;p++){const m=n(o,f[p],c);u.addChild(m)}return u},a=[];for(const o of this.data.scenes)a.push(n(null,o,this.data));return i.forEach(o=>{o.meshInstance.skinInstance=ov.createCachedSkinInstance(o.meshInstance.mesh.skin,o.rootBone,o.entity),o.meshInstance.node.render.rootBone=o.rootBone}),Gl.createSceneHierarchy(a,lt)}getMaterialVariants(){return this.data.variants?Object.keys(this.data.variants):[]}applyMaterialVariant(e,t){const i=t?this.data.variants[t]:null;if(i===void 0)return;const s=e.findComponents("render");for(let n=0;n<s.length;n++){const a=s[n];this._applyMaterialVariant(i,a.meshInstances)}}applyMaterialVariantInstances(e,t){const i=t?this.data.variants[t]:null;i!==void 0&&this._applyMaterialVariant(i,e)}_applyMaterialVariant(e,t){t.forEach(i=>{if(e===null)i.material=this._defaultMaterial;else{const s=this.data.meshVariants[i.mesh.id];s&&(i.material=this.data.materials[s[e]])}})}static createSceneHierarchy(e,t){let i=null;if(e.length===1)i=e[0];else{i=new t("SceneGroup");for(const s of e)i.addChild(s)}return i}static createModel(e,t){const i=function(a,o,l,c,u,h,d){const f=e.meshDefaultMaterials[o.id],p=f===void 0?t:u[f],m=new Dt(o,p,h);if(o.morph){const g=new vh(o.morph);m.morphInstance=g,a.morphInstances.push(g)}if(d.hasOwnProperty("skin")){const g=d.skin,_=l[g];o.skin=_;const v=c[g];m.skinInstance=v,a.skinInstances.push(v)}a.meshInstances.push(m)},s=new al,n=[];for(const a of e.skins){const o=new Cy(a);o.bones=a.bones,n.push(o)}s.graph=Gl.createSceneHierarchy(e.scenes,Xt);for(let a=0;a<e.nodes.length;a++){const o=e.nodes[a];if(o.root===s.graph){const l=e.gltf.nodes[a];if(l.hasOwnProperty("mesh")){const c=e.renders[l.mesh].meshes;for(let u=0;u<c.length;u++){const h=c[u];h&&i(s,h,e.skins,n,e.materials,o,l)}}}}return s}destroy(){const e=this._assets,t=function(s){e.remove(s),s.unload()},i=function(s){s.forEach(n=>{t(n)})};this.animations&&(i(this.animations),this.animations=null),this.textures&&(i(this.textures),this.textures=null),this.materials&&(i(this.materials),this.materials=null),this.renders&&(i(this.renders),this.renders=null),this._model&&(t(this._model),this._model=null),this.data=null,this.assets=null}}class $Pe{constructor(e,t,i){this._device=e,this._assets=t,this._defaultMaterial=zb.createDefaultMaterial(),this.maxRetries=i}_getUrlWithoutParams(e){return e.indexOf("?")>=0?e.split("?")[0]:e}load(e,t,i){be.fetchArrayBuffer(e.load,(s,n)=>{s?t(s):zb.parse(this._getUrlWithoutParams(e.original),Ne.extractPath(e.load),n,this._device,i.registry,i.options,(a,o)=>{a?t(a):t(null,new Gl(o,i,this._assets,this._defaultMaterial))})},i,this.maxRetries)}open(e,t,i){return t}patch(e,t){}}class HPe extends Ot{constructor(e){super(e,"container"),this.glbContainerParser=new $Pe(e.graphicsDevice,e.assets,0),this.parsers={}}set maxRetries(e){this.glbContainerParser.maxRetries=e;for(const t in this.parsers)this.parsers.hasOwnProperty(t)&&(this.parsers[t].maxRetries=e)}get maxRetries(){return this.glbContainerParser.maxRetries}_getUrlWithoutParams(e){return e.indexOf("?")>=0?e.split("?")[0]:e}_getParser(e){const t=e?Ne.getExtension(this._getUrlWithoutParams(e)).toLowerCase().replace(".",""):null;return this.parsers[t]||this.glbContainerParser}load(e,t,i){typeof e=="string"&&(e={load:e,original:e}),this._getParser(e.original).load(e,t,i)}open(e,t,i){return this._getParser(e).open(e,t,i)}}class GPe extends Ot{constructor(e){super(e,"css"),this.decoder=null}load(e,t){typeof e=="string"&&(e={load:e,original:e}),qt.get(e.load,{retry:this.maxRetries>0,maxRetries:this.maxRetries},(i,s)=>{i?t(`Error loading css resource: ${e.original} [${i}]`):t(null,s)})}openBinary(e){return this.decoder??(this.decoder=new TextDecoder("utf-8")),this.decoder.decode(e)}}class WPe extends Ot{constructor(e){super(e,"cubemap"),this._device=e.graphicsDevice,this._registry=e.assets,this._loader=e.loader}load(e,t,i){this.loadAssets(i,t)}open(e,t,i){return i?i.resource:null}patch(e,t){this.loadAssets(e,(i,s)=>{i&&(t.fire("error",e),t.fire(`error:${e.id}`,i,e),e.fire("error",e))})}getAssetIds(e){const t=[];if(t[0]=e.file,(e.loadFaces||!e.file)&&e.data&&e.data.textures)for(let i=0;i<6;++i)t[i+1]=e.data.textures[i];else t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=null;return t}compareAssetIds(e,t){return e&&t?parseInt(e,10)===e||typeof e=="string"?e===t:e.url===t.url:e!==null==(t!==null)}update(e,t,i){const s=e.data||{},n=e._handlerState.assets,a=e._resources;let o,l,c;const u=[null,null,null,null,null,null,null],h=function(){return s.hasOwnProperty("type")?s.type:s.hasOwnProperty("rgbm")?s.rgbm?ch:qa:null};if(!e.loaded||i[0]!==n[0]){if(i[0])if(o=i[0].resource,o.cubemap)for(c=0;c<6;++c)u[c+1]=new we(this._device,{name:`${e.name}_prelitCubemap${o.width>>c}`,cubemap:!0,type:h()||o.type,width:o.width>>c,height:o.height>>c,format:o.format,levels:[o._levels[c]],addressU:ge,addressV:ge,mipmaps:c===0});else u[1]=o}else u[1]=a[1]||null,u[2]=a[2]||null,u[3]=a[3]||null,u[4]=a[4]||null,u[5]=a[5]||null,u[6]=a[6]||null;const d=i.slice(1);if(!e.loaded||!this.cmpArrays(d,n.slice(1))){if(d.indexOf(null)===-1){const f=d.map(_=>_.resource),p=[];for(l=0;l<f[0]._levels.length;++l)p.push(f.map(_=>_._levels[l]));const m=f[0].format,g=new we(this._device,{name:`${e.name}_faces`,cubemap:!0,type:h()||f[0].type,width:f[0].width,height:f[0].height,format:m===Ic?ct:m,mipmaps:s.mipmaps??!0,levels:p,minFilter:s.hasOwnProperty("minFilter")?s.minFilter:f[0].minFilter,magFilter:s.hasOwnProperty("magFilter")?s.magFilter:f[0].magFilter,anisotropy:s.hasOwnProperty("anisotropy")?s.anisotropy:1,addressU:ge,addressV:ge});u[0]=g}}else u[0]=a[0]||null;if(!this.cmpArrays(u,a))for(e.resources=u,e._handlerState.assetIds=t,e._handlerState.assets=i,c=0;c<a.length;++c)a[c]!==null&&u.indexOf(a[c])===-1&&a[c].destroy();for(c=0;c<n.length;++c)n[c]!==null&&i.indexOf(n[c])===-1&&n[c].unload()}cmpArrays(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}resolveId(e){const t=parseInt(e,10);return t===e||t.toString()===e?t:e}loadAssets(e,t){e.hasOwnProperty("_handlerState")||(e._handlerState={assetIds:[null,null,null,null,null,null,null],assets:[null,null,null,null,null,null,null]});const i=this,s=i.getAssetIds(e),n=[null,null,null,null,null,null,null],a=e._handlerState.assetIds,o=e._handlerState.assets,l=i._registry;let c=7;const u=function(p,m){n[p]=m,c--,c===0&&(i.update(e,s,n),t(null,e.resources))},h=function(p,m,g){t(m)},d=function(p,m){m.loaded?u(p,m):(l.once(`load:${m.id}`,u.bind(i,p)),l.once(`error:${m.id}`,h.bind(i,p)),m.loading||l.load(m))};let f;for(let p=0;p<7;++p){const m=this.resolveId(s[p]);if(!m)u(p,null);else if(i.compareAssetIds(m,a[p]))d(p,o[p]);else if(parseInt(m,10)===m)f=l.get(m),f?d(p,f):setTimeout(((g,_)=>{const v=l.get(_);v?d(g,v):h(g,`failed to find dependent cubemap asset=${_}`)}).bind(null,p,m));else{const g=typeof m=="string"?{url:m,filename:m}:m,_=g.url.search(".dds")===-1?{type:"rgbp",addressu:"clamp",addressv:"clamp",mipmaps:!1}:null;f=new be(`${e.name}_part_${p}`,"texture",g,_),l.add(f),d(p,f)}}}}class XPe extends Ot{constructor(e){super(e,"folder")}load(e,t){t(null,null)}}class mV{constructor(e,t){this.type=t&&t.type||Mb,this.em=1,this.textures=e,this.intensity=0,this._data=null,this.data=t}set data(e){if(this._data=e,!!e&&(this._data.intensity!==void 0&&(this.intensity=this._data.intensity),this._data.info||(this._data.info={}),(!this._data.version||this._data.version<2)&&(this._data.info.maps=[{width:this._data.info.width,height:this._data.info.height}],this._data.chars)))for(const t in this._data.chars)this._data.chars[t].map=0}get data(){return this._data}}function HC(r){return r.version<3&&(r.version<2&&(r.info.maps=r.info.maps||[{width:r.info.width,height:r.info.height}]),r.chars=Object.keys(r.chars||{}).reduce((e,t)=>{const i=r.chars[t],s=i.letter!==void 0?i.letter:ix.fromCodePoint(t);return r.version<2&&(i.map=i.map||0),e[s]=i,e},{}),r.version=3),r}class qPe extends Ot{constructor(e){super(e,"font"),this._loader=e.loader,this.maxRetries=0}load(e,t,i){typeof e=="string"&&(e={load:e,original:e});const s=this;Ne.getExtension(e.original)===".json"?qt.get(e.load,{retry:this.maxRetries>0,maxRetries:this.maxRetries},(n,a)=>{if(n)t(`Error loading font resource: ${e.original} [${n}]`);else{const o=HC(a);s._loadTextures(e.load.replace(".json",".png"),o,(l,c)=>{l?t(l):t(null,{data:o,textures:c})})}}):(i&&i.data&&(i.data=HC(i.data)),this._loadTextures(e.load,i&&i.data,t))}_loadTextures(e,t,i){const s=t.info.maps.length;let n=0,a=null;const o=new Array(s),l=this._loader,c=function(u){const h=function(d,f){if(!a){if(d){a=d,i(d);return}f.upload(),o[u]=f,n++,n===s&&i(null,o)}};u===0?l.load(e,"texture",h):l.load(e.replace(".png",`${u}.png`),"texture",h)};for(let u=0;u<s;u++)c(u)}open(e,t,i){let s;return t.textures?s=new mV(t.textures,t.data):s=new mV(t,null),s}patch(e,t){const i=e.resource;!i.data&&e.data?i.data=e.data:!e.data&&i.data&&(e.data=i.data),e.data&&(e.data=HC(e.data))}}const GC=.28209479177387814;class YPe{constructor(e,t,i,s,n,a){const o=(x,S)=>{const w=(1<<S)-1;return(x&w)/w},l=(x,S)=>{x.x=o(S>>>21,11),x.y=o(S>>>11,10),x.z=o(S,11)},c=(x,S)=>{x.x=o(S>>>24,8),x.y=o(S>>>16,8),x.z=o(S>>>8,8),x.w=o(S,8)},u=(x,S)=>{const w=1/(Math.sqrt(2)*.5),T=(o(S>>>20,10)-.5)*w,A=(o(S>>>10,10)-.5)*w,C=(o(S,10)-.5)*w,P=Math.sqrt(1-(T*T+A*A+C*C));switch(S>>>30){case 0:x.set(T,A,C,P);break;case 1:x.set(P,A,C,T);break;case 2:x.set(A,P,C,T);break;case 3:x.set(A,C,P,T);break}},h=(x,S,w)=>x*(1-w)+S*w,{chunkData:d,chunkSize:f,vertexData:p,shData0:m,shData1:g,shData2:_,shBands:v}=e,y=[3,8,15][v-1];this.read=x=>{const S=Math.floor(x/256)*f;if(t&&(l(t,p[x*4+0]),t.x=h(d[S+0],d[S+3],t.x),t.y=h(d[S+1],d[S+4],t.y),t.z=h(d[S+2],d[S+5],t.z)),i&&u(i,p[x*4+1]),s&&(l(s,p[x*4+2]),s.x=h(d[S+6],d[S+9],s.x),s.y=h(d[S+7],d[S+10],s.y),s.z=h(d[S+8],d[S+11],s.z)),n&&(c(n,p[x*4+3]),f>12&&(n.x=h(d[S+12],d[S+15],n.x),n.y=h(d[S+13],d[S+16],n.y),n.z=h(d[S+14],d[S+17],n.z))),a&&v>0){const w=[m,g,_];for(let T=0;T<3;++T)for(let A=0;A<15;++A)a[T*15+A]=A<y?w[T][x*16+A]*(8/255)-4:0}}}}class KPe{createIter(e,t,i,s,n){return new YPe(this,e,t,i,s,n)}calcAabb(e){const{chunkData:t,numChunks:i,chunkSize:s}=this;let n=Math.exp(Math.max(t[9],t[10],t[11])),a=t[0]-n,o=t[1]-n,l=t[2]-n,c=t[3]+n,u=t[4]+n,h=t[5]+n;for(let d=1;d<i;++d){const f=d*s;n=Math.exp(Math.max(t[f+9],t[f+10],t[f+11])),a=Math.min(a,t[f+0]-n),o=Math.min(o,t[f+1]-n),l=Math.min(l,t[f+2]-n),c=Math.max(c,t[f+3]+n),u=Math.max(u,t[f+4]+n),h=Math.max(h,t[f+5]+n)}return e.center.set((a+c)*.5,(o+u)*.5,(l+h)*.5),e.halfExtents.set((c-a)*.5,(u-o)*.5,(h-l)*.5),!0}getCenters(e){const{vertexData:t,chunkData:i,numChunks:s,chunkSize:n}=this;let a,o,l,c,u,h;for(let d=0;d<s;++d){const f=d*n;a=i[f+0],o=i[f+1],l=i[f+2],c=i[f+3],u=i[f+4],h=i[f+5];const p=Math.min(this.numSplats,(d+1)*256);for(let m=d*256;m<p;++m){const g=t[m*4],_=(g>>>21)/2047,v=(g>>>11&1023)/1023,y=(g&2047)/2047;e[m*3+0]=(1-_)*a+_*c,e[m*3+1]=(1-v)*o+v*u,e[m*3+2]=(1-y)*l+y*h}}}getChunks(e){const{chunkData:t,numChunks:i,chunkSize:s}=this;let n,a,o,l,c,u;for(let h=0;h<i;++h){const d=h*s;n=t[d+0],a=t[d+1],o=t[d+2],l=t[d+3],c=t[d+4],u=t[d+5],e[h*6+0]=n,e[h*6+1]=a,e[h*6+2]=o,e[h*6+3]=l,e[h*6+4]=c,e[h*6+5]=u}}calcFocalPoint(e){const{chunkData:t,numChunks:i,chunkSize:s}=this;e.x=0,e.y=0,e.z=0;for(let n=0;n<i;++n){const a=n*s;e.x+=t[a+0]+t[a+3],e.y+=t[a+1]+t[a+4],e.z+=t[a+2]+t[a+5]}e.mulScalar(.5/i)}get isCompressed(){return!0}get numChunks(){return Math.ceil(this.numSplats/256)}get chunkSize(){return this.chunkData.length/this.numChunks}decompress(){const e=["x","y","z","f_dc_0","f_dc_1","f_dc_2","opacity","scale_0","scale_1","scale_2","rot_0","rot_1","rot_2","rot_3"],{shBands:t}=this;if(t>0){const u=[];for(let h=0;h<45;++h)u.push(`f_rest_${h}`);e.splice(e.indexOf("f_dc_0")+1,0,...u)}const i={};e.forEach(u=>{i[u]=new Float32Array(this.numSplats)});const s=new O,n=new de,a=new O,o=new ce,l=t>0?new Float32Array(45):null,c=this.createIter(s,n,a,o,l);for(let u=0;u<this.numSplats;++u)if(c.read(u),i.x[u]=s.x,i.y[u]=s.y,i.z[u]=s.z,i.rot_1[u]=n.x,i.rot_2[u]=n.y,i.rot_3[u]=n.z,i.rot_0[u]=n.w,i.scale_0[u]=a.x,i.scale_1[u]=a.y,i.scale_2[u]=a.z,i.f_dc_0[u]=(o.x-.5)/GC,i.f_dc_1[u]=(o.y-.5)/GC,i.f_dc_2[u]=(o.z-.5)/GC,i.opacity[u]=o.w<=0?-40:o.w>=1?40:-Math.log(1/o.w-1),l)for(let h=0;h<45;++h)i[`f_rest_${h}`][u]=l[h];return new Sh([{name:"vertex",count:this.numSplats,properties:e.map(u=>({name:u,type:"float",byteSize:4,storage:i[u]}))}],this.comments)}}const ZPe=(r,e,t,i,s)=>{for(let n=0;n<s;++n)for(let a=0;a<i;++a)r[n*e+a]=t[n*i+a]};class QPe extends V3{constructor(e,t){super(e,t);const{chunkData:i,chunkSize:s,numChunks:n,numSplats:a,vertexData:o,shBands:l}=t;this.chunks=new Float32Array(n*6),t.getChunks(this.chunks),this.packedTexture=this.createTexture("packedData",Qs,this.evalTextureSize(a),o);const c=this.evalTextureSize(n);c.x*=5,this.chunkTexture=this.createTexture("chunkData",or,c);const u=this.chunkTexture.lock();if(ZPe(u,20,i,s,n),s===12)for(let h=0;h<n;++h)u[h*20+15]=1,u[h*20+16]=1,u[h*20+17]=1;if(this.chunkTexture.unlock(),l>0){const h=this.evalTextureSize(a);this.shTexture0=this.createTexture("shTexture0",Qs,h,new Uint32Array(t.shData0.buffer)),this.shTexture1=this.createTexture("shTexture1",Qs,h,new Uint32Array(t.shData1.buffer)),this.shTexture2=this.createTexture("shTexture2",Qs,h,new Uint32Array(t.shData2.buffer))}else this.shTexture0=null,this.shTexture1=null,this.shTexture2=null}destroy(){var e,t,i,s,n;(e=this.packedTexture)==null||e.destroy(),(t=this.chunkTexture)==null||t.destroy(),(i=this.shTexture0)==null||i.destroy(),(s=this.shTexture1)==null||s.destroy(),(n=this.shTexture2)==null||n.destroy(),super.destroy()}configureMaterial(e){e.setDefine("GSPLAT_COMPRESSED_DATA",!0),e.setParameter("packedTexture",this.packedTexture),e.setParameter("chunkTexture",this.chunkTexture),this.shTexture0?(e.setDefine("SH_BANDS",3),e.setParameter("shTexture0",this.shTexture0),e.setParameter("shTexture1",this.shTexture1),e.setParameter("shTexture2",this.shTexture2)):e.setDefine("SH_BANDS",0)}evalTextureSize(e){const t=Math.ceil(Math.sqrt(e)),i=Math.ceil(e/t);return new ee(t,i)}}const gV=new Uint8Array([112,108,121,10]),_V=new Uint8Array([10,101,110,100,95,104,101,97,100,101,114,10]),_2=new Map([["char",Int8Array],["uchar",Uint8Array],["short",Int16Array],["ushort",Uint16Array],["int",Int32Array],["uint",Uint32Array],["float",Float32Array],["double",Float64Array]]);class JPe{constructor(e,t){this.head=0,this.tail=0,this.reader=e,this.progressFunc=t}async read(){var i;const{value:e,done:t}=await this.reader.read();if(t)throw new Error("Stream finished before end of header");this.push(e),(i=this.progressFunc)==null||i.call(this,e.byteLength)}push(e){if(!this.data)this.data=e,this.view=new DataView(this.data.buffer),this.tail=e.length;else{const t=this.tail-this.head,i=t+e.length;if(this.data.length>=i)this.head>0?(this.data.copyWithin(0,this.head,this.tail),this.data.set(e,t),this.head=0,this.tail=i):(this.data.set(e,this.tail),this.tail+=e.length);else{const s=new Uint8Array(i);this.head>0||this.tail<this.data.length?s.set(this.data.subarray(this.head,this.tail),0):s.set(this.data,0),s.set(e,t),this.data=s,this.view=new DataView(this.data.buffer),this.head=0,this.tail=i}}}compact(){this.head>0&&(this.data.copyWithin(0,this.head,this.tail),this.tail-=this.head,this.head=0)}get remaining(){return this.tail-this.head}getInt8(){const e=this.view.getInt8(this.head);return this.head++,e}getUint8(){const e=this.view.getUint8(this.head);return this.head++,e}getInt16(){const e=this.view.getInt16(this.head,!0);return this.head+=2,e}getUint16(){const e=this.view.getUint16(this.head,!0);return this.head+=2,e}getInt32(){const e=this.view.getInt32(this.head,!0);return this.head+=4,e}getUint32(){const e=this.view.getUint32(this.head,!0);return this.head+=4,e}getFloat32(){const e=this.view.getFloat32(this.head,!0);return this.head+=4,e}getFloat64(){const e=this.view.getFloat64(this.head,!0);return this.head+=8,e}}const eIe=r=>{const e=[],t=[];let i;for(let s=1;s<r.length;++s){const n=r[s].split(" ");switch(n[0]){case"comment":t.push(n.slice(1).join(" "));break;case"format":i=n[1];break;case"element":e.push({name:n[1],count:parseInt(n[2],10),properties:[]});break;case"property":{if(!_2.has(n[1]))throw new Error(`Unrecognized property data type '${n[1]}' in ply header`);e[e.length-1].properties.push({type:n[1],name:n[2],storage:null,byteSize:_2.get(n[1]).BYTES_PER_ELEMENT});break}default:throw new Error(`Unrecognized header value '${n[0]}' in ply header`)}}return{elements:e,format:i,comments:t}},tIe=r=>{const e=["min_x","min_y","min_z","max_x","max_y","max_z","min_scale_x","min_scale_y","min_scale_z","max_scale_x","max_scale_y","max_scale_z","min_r","min_g","min_b","max_r","max_g","max_b"],t=["packed_position","packed_rotation","packed_scale","packed_color"],i=new Array(45).fill("").map((a,o)=>`f_rest_${o}`),s=()=>r[0].name==="chunk"&&r[0].properties.every((a,o)=>a.name===e[o]&&a.type==="float")&&r[1].name==="vertex"&&r[1].properties.every((a,o)=>a.name===t[o]&&a.type==="uint"),n=()=>r[2].name==="sh"&&[9,24,45].indexOf(r[2].properties.length)!==-1&&r[2].properties.every((a,o)=>a.name===i[o]&&a.type==="uchar");return r.length===2&&s()||r.length===3&&s()&&n()},iIe=r=>r.length===1&&r[0].name==="vertex"&&r[0].properties.every(e=>e.type==="float"),rIe=async(r,e,t)=>{const i=new KPe;i.comments=t;const s=e[0].count,n=e[0].properties.length,a=e[1].count,l=(u=>{const h=Math.ceil(Math.sqrt(u)),d=Math.ceil(u/h);return h*d})(a);i.numSplats=a,i.chunkData=new Float32Array(s*n),i.vertexData=new Uint32Array(l*4);const c=async(u,h)=>{const d=new Uint8Array(u);let f=0;for(;f<h;){for(;r.remaining===0;)await r.read();const p=Math.min(h-f,r.remaining),m=r.data;for(let g=0;g<p;++g)d[f++]=m[r.head++]}};if(await c(i.chunkData.buffer,s*n*4),await c(i.vertexData.buffer,a*4*4),e.length===3){const u=l*16,h=new Uint8Array(u),d=new Uint8Array(u),f=new Uint8Array(u),p=1024,m=e[2].properties.length/3,g=new Uint8Array(p*m*3);for(let _=0;_<i.numSplats;_+=p){const v=Math.min(p,i.numSplats-_);await c(g.buffer,v*m*3);for(let y=0;y<v;++y)for(let x=0;x<15;++x){const S=(_+y)*16+x;x<m?(h[S]=g[(y*3+0)*m+x],d[S]=g[(y*3+1)*m+x],f[S]=g[(y*3+2)*m+x]):(h[S]=127,d[S]=127,f[S]=127)}}i.shData0=h,i.shData1=d,i.shData2=f,i.shBands={3:1,8:2,15:3}[m]}else i.shBands=0;return i},sIe=async(r,e,t)=>{const i=e[0],s=i.properties,n=s.length,a=s.map(h=>h.storage),o=s.reduce((h,d)=>h+d.byteSize,0);let l=0,c;const u=()=>{const h=r.data.buffer;(c==null?void 0:c.buffer)!==h&&(c=new Float32Array(h,0,h.byteLength/4))};for(u();l<i.count;){for(;r.remaining<o;)await r.read(),u();const h=Math.min(i.count-l,Math.floor(r.remaining/o));for(let d=0;d<n;++d){const f=a[d];for(let p=0;p<h;++p)f[p+l]=c[p*n+d]}l+=h,r.head+=h*o}return new Sh(e,t)},nIe=async(r,e,t)=>{for(let i=0;i<e.length;++i){const s=e[i],n=s.properties.reduce((l,c)=>l+c.byteSize,0),a=s.properties.map(l=>{if(l.storage)switch(l.type){case"char":return(c,u)=>{l.storage[u]=c.getInt8()};case"uchar":return(c,u)=>{l.storage[u]=c.getUint8()};case"short":return(c,u)=>{l.storage[u]=c.getInt16()};case"ushort":return(c,u)=>{l.storage[u]=c.getUint16()};case"int":return(c,u)=>{l.storage[u]=c.getInt32()};case"uint":return(c,u)=>{l.storage[u]=c.getUint32()};case"float":return(c,u)=>{l.storage[u]=c.getFloat32()};case"double":return(c,u)=>{l.storage[u]=c.getFloat64()};default:throw new Error(`Unsupported property data type '${l.type}' in ply header`)}else return c=>{c.head+=l.byteSize}});let o=0;for(;o<s.count;){for(;r.remaining<n;)await r.read();const l=Math.min(s.count-o,Math.floor(r.remaining/n));for(let c=0;c<l;++c){for(let u=0;u<s.properties.length;++u)a[u](r,o);o++}}}return new Sh(e,t)},aIe=async(r,e=null,t=null)=>{const i=(d,f)=>{const p=d.length-f.length;let m,g;for(m=0;m<=p;++m){for(g=0;g<f.length&&d[m+g]===f[g];++g);if(g===f.length)return m}return-1},s=(d,f)=>{if(d.length<f.length)return!1;for(let p=0;p<f.length;++p)if(d[p]!==f[p])return!1;return!0},n=new JPe(r,t);let a;for(;;){if(await n.read(),n.tail>=gV.length&&!s(n.data,gV))throw new Error("Invalid ply header");if(a=i(n.data,_V),a!==-1)break}const o=new TextDecoder("ascii").decode(n.data.subarray(0,a)).split(`
`),{elements:l,format:c,comments:u}=eIe(o);if(c!=="binary_little_endian")throw new Error("Unsupported ply format");return n.head=a+_V.length,n.compact(),await(async()=>tIe(l)?await rIe(n,l,u):(l.forEach(d=>{d.properties.forEach(f=>{const p=_2.get(f.type);if(p){const m=!e||e(f.name)?new p(d.count):null;f.storage=m}})}),iIe(l)?await sIe(n,l,u):await nIe(n,l,u)))()},oIe=r=>!0;class lIe{constructor(e,t){this.app=e,this.maxRetries=t}async load(e,t,i){var s;try{const n=await(((s=i.file)==null?void 0:s.contents)??fetch(e.load));if(!n||!n.body)t("Error loading resource",null);else{const a=parseInt(n.headers.get("content-length")??"0",10);let o=0;const l=await aIe(n.body.getReader(),i.data.elementFilter??oIe,u=>{o+=u,i&&i.fire("progress",o,a)});i.fire("load:data",l),l.isCompressed||(i.data.reorder??!0)&&l.reorderData();const c=l.isCompressed&&!i.data.decompress?new QPe(this.app.graphicsDevice,l):new W9(this.app.graphicsDevice,l.isCompressed?l.decompress():l);t(null,c)}}catch(n){t(n,null)}}open(e,t){return t}}class cIe{constructor(e,t){this.app=e,this.maxRetries=t}async loadTextures(e,t,i,s){var h,d,f,p,m,g;const{assets:n}=this.app,a=["means","quats","scales","sh0","shN"],o={},l=[];a.forEach(_=>{var y;const v=((y=s[_])==null?void 0:y.files)??[];o[_]=v.map(x=>{var T,A;const S=new be(x,"texture",{url:((A=(T=i.options)==null?void 0:T.mapUrl)==null?void 0:A.call(T,x))??new URL(x,new URL(e.load,window.location.href).toString()).toString(),filename:x},{mipmaps:!1}),w=new Promise((C,P)=>{S.on("load",()=>C(null)),S.on("error",I=>P(I))});return n.add(S),n.load(S),l.push(w),S})}),await Promise.allSettled(l);const c=new X9;c.meta=s,c.numSplats=s.means.shape[0],c.means_l=o.means[0].resource,c.means_u=o.means[1].resource,c.quats=o.quats[0].resource,c.scales=o.scales[0].resource,c.sh0=o.sh0[0].resource,c.sh_centroids=(d=(h=o.shN)==null?void 0:h[0])==null?void 0:d.resource,c.sh_labels=(p=(f=o.shN)==null?void 0:f[1])==null?void 0:p.resource,(((m=i.data)==null?void 0:m.reorder)??!0)&&await c.reorderData();const u=(g=i.data)!=null&&g.decompress?new W9(this.app.graphicsDevice,await c.decompress()):new bve(this.app.graphicsDevice,c);t(null,u)}load(e,t,i){var s;if((s=i.data)!=null&&s.means)this.loadTextures(e,t,i,i.data);else{typeof e=="string"&&(e={load:e,original:e});const n={retry:this.maxRetries>0,maxRetries:this.maxRetries,responseType:Os.ResponseType.JSON};qt.get(e.load,n,(a,o)=>{a?t(`Error loading gsplat meta: ${e.original} [${a}]`):this.loadTextures(e,t,i,o)})}}}class uIe extends Ot{constructor(e){super(e,"gsplat"),this.parsers={ply:new lIe(e,3),json:new cIe(e,3)}}_getUrlWithoutParams(e){return e.indexOf("?")>=0?e.split("?")[0]:e}_getParser(e){const t=Ne.getExtension(this._getUrlWithoutParams(e)).toLowerCase().replace(".","");return this.parsers[t]||this.parsers.ply}load(e,t,i){typeof e=="string"&&(e={load:e,original:e}),this._getParser(e.original).load(e,t,i)}open(e,t,i){return t}}class v2{static setCompressedPRS(e,t,i){const s=i.singleVecs;let n,a;const o=t.___1;o||(n=i.tripleVecs,a=t.___2);let l=o?o[0]:n[a];e.setLocalPosition(s[l],s[l+1],s[l+2]),l=o?o[1]:n[a+1],e.setLocalEulerAngles(s[l],s[l+1],s[l+2]),l=o?o[2]:n[a+2],e.setLocalScale(s[l],s[l+1],s[l+2])}static oneCharToKey(e,t){const i=e.charCodeAt(0)-t.fieldFirstCode;return t.fieldArray[i]}static multCharToKey(e,t){let i=0;for(let s=0;s<e.length;s++)i=i*t.fieldCodeBase+e.charCodeAt(s)-t.fieldFirstCode;return t.fieldArray[i]}}class Vb{constructor(e,t){this._node=e,this._data=t}run(){const e=Object.prototype.toString.call(this._node);return e==="[object Object]"?this._handleMap():e==="[object Array]"?this._handleArray():this._result=this._node,this._result}_handleMap(){this._result={},Object.keys(this._node).forEach(this._handleKey,this)}_handleKey(e){let t=e;const i=e.length;i===1?t=v2.oneCharToKey(e,this._data):i===2&&(t=v2.multCharToKey(e,this._data)),this._result[t]=new Vb(this._node[e],this._data).run()}_handleArray(){this._result=[],this._node.forEach(this._handleArElt,this)}_handleArElt(e){const t=new Vb(e,this._data).run();this._result.push(t)}}class W3{constructor(e,t){this._app=e,this._isTemplate=t}parse(e){const t={};let i=null;const s=e.compressedFormat;s&&!e.entDecompressed&&(e.entDecompressed=!0,e.entities=new Vb(e.entities,s).run());for(const n in e.entities){const a=e.entities[n],o=this._createEntity(a,s);t[n]=o,a.parent===null&&(i=o)}for(const n in e.entities){const a=t[n],o=e.entities[n].children,l=o.length;for(let c=0;c<l;c++){const u=t[o[c]];u&&a.addChild(u)}}return this._openComponentData(i,e.entities),i}_createEntity(e,t){const i=new lt(e.name,this._app);if(i.setGuid(e.resource_id),this._setPosRotScale(i,e,t),i._enabled=e.enabled??!0,this._isTemplate?i._template=!0:i._enabledInHierarchy=i._enabled,i.template=e.template,e.tags)for(let s=0;s<e.tags.length;s++)i.tags.add(e.tags[s]);return i}_setPosRotScale(e,t,i){if(i)v2.setCompressedPRS(e,t,i);else{const s=t.position,n=t.rotation,a=t.scale;e.setLocalPosition(s[0],s[1],s[2]),e.setLocalEulerAngles(n[0],n[1],n[2]),e.setLocalScale(a[0],a[1],a[2])}}_openComponentData(e,t){const i=this._app.systems.list;let s=i.length;const n=t[e.getGuid()];for(let o=0;o<s;o++){const l=i[o],c=n.components[l.id];c&&l.addComponent(e,c)}s=n.children.length;const a=e._children;for(let o=0;o<s;o++)a[o]&&(a[o]=this._openComponentData(a[o],t));return e}}class zY{static load(e,t,i){typeof e=="string"&&(e={load:e,original:e}),qt.get(e.load,{retry:t>0,maxRetries:t},(s,n)=>{if(!s)i(s,n);else{let a=`Error while loading scene JSON ${e.original}`;s.message?(a+=`: ${s.message}`,s.stack&&(a+=`
${s.stack}`)):a+=`: ${s}`,i(a)}})}}class hIe extends Ot{constructor(e){super(e,"hierarchy")}load(e,t){zY.load(e,this.maxRetries,t)}open(e,t){this._app.systems.script.preloading=!0;const s=new W3(this._app,!1).parse(t);return this._app.systems.script.preloading=!1,s}}class dIe extends Ot{constructor(e){super(e,"html"),this.decoder=null}load(e,t){typeof e=="string"&&(e={load:e,original:e}),qt.get(e.load,{retry:this.maxRetries>0,maxRetries:this.maxRetries},(i,s)=>{i?t(`Error loading html resource: ${e.original} [${i}]`):t(null,s)})}openBinary(e){return this.decoder??(this.decoder=new TextDecoder("utf-8")),this.decoder.decode(e)}}class fIe extends Ot{constructor(e){super(e,"json"),this.decoder=null}load(e,t){typeof e=="string"&&(e={load:e,original:e});const i={retry:this.maxRetries>0,maxRetries:this.maxRetries};e.load.startsWith("blob:")&&(i.responseType=Os.ResponseType.JSON),qt.get(e.load,i,(s,n)=>{s?t(`Error loading JSON resource: ${e.original} [${s}]`):t(null,n)})}openBinary(e){return this.decoder??(this.decoder=new TextDecoder("utf-8")),JSON.parse(this.decoder.decode(e))}}class pIe{constructor(){this.removeInvalid=!0,this.valid=!0,this.enumValidators={occludeSpecular:this._createEnumValidator([y9,OE,S9]),cull:this._createEnumValidator([Vi,oh,Gg,Lde]),blendType:this._createEnumValidator([h3,d3,Ka,an,fh,f3,p3,m3,g3,_3,v3]),depthFunc:this._createEnumValidator([Ode,ob,lb,oM,Nde,kde,Fde,Lo])}}setInvalid(e,t){this.valid=!1,this.removeInvalid&&delete t[e]}validate(e){const t=vp,i=W_e,s=e.mappingFormat==="path";for(const n in e){const a=t[n];if(!a){i[n]?delete e[n]:this.valid=!1;continue}if(a.startsWith("enum")){const o=a.split(":")[1];this.enumValidators[o]&&(this.enumValidators[o](e[n])||this.setInvalid(n,e))}else if(a==="number")typeof e[n]!="number"&&this.setInvalid(n,e);else if(a==="boolean")typeof e[n]!="boolean"&&this.setInvalid(n,e);else if(a==="string")typeof e[n]!="string"&&this.setInvalid(n,e);else if(a==="vec2")e[n]instanceof Array&&e[n].length===2||this.setInvalid(n,e);else if(a==="rgb")e[n]instanceof Array&&e[n].length===3||this.setInvalid(n,e);else if(a==="texture")s?typeof e[n]=="string"||e[n]===null||e[n]instanceof we||this.setInvalid(n,e):typeof e[n]=="number"||e[n]===null||e[n]instanceof we||this.setInvalid(n,e);else if(a==="boundingbox")e[n].center&&e[n].center instanceof Array&&e[n].center.length===3||this.setInvalid(n,e),e[n].halfExtents&&e[n].halfExtents instanceof Array&&e[n].halfExtents.length===3||this.setInvalid(n,e);else if(a==="cubemap")typeof e[n]=="number"||e[n]===null||e[n]===void 0||e[n]instanceof we&&e[n].cubemap||this.setInvalid(n,e);else if(a==="chunks"){const o=Object.keys(e[n]);for(let l=0;l<o.length;l++)typeof e[n][o[l]]!="string"&&this.setInvalid(o[l],e[n])}else console.error(`Unknown material type: ${a}`)}return e.validated=!0,this.valid}_createEnumValidator(e){return function(t){return e.indexOf(t)>=0}}}class mIe{constructor(){this._validator=null}parse(e){const t=this.migrate(e),i=this._validate(t),s=new Ns;return this.initialize(s,i),s}initialize(e,t){if(t.validated||(t=this._validate(t)),t.chunks&&t.chunks&&Object.keys(t.chunks).length>0){const i=e.shaderChunks.glsl;Object.entries(t.chunks).forEach(([s,n])=>i.set(s,n))}for(const i in t){const s=vp[i],n=t[i];if(s==="vec2")e[i]=new ee(n[0],n[1]);else if(s==="rgb")e[i]=new ae(n[0],n[1],n[2]);else if(s==="texture")n instanceof we?e[i]=n:e[i]instanceof we&&typeof n=="number"&&n>0||(e[i]=null);else if(s==="cubemap")n instanceof we?e[i]=n:e[i]instanceof we&&typeof n=="number"&&n>0||(e[i]=null),i==="cubeMap"&&!n&&(e.prefilteredCubemaps=null);else if(s==="boundingbox"){const a=new O(n.center[0],n.center[1],n.center[2]),o=new O(n.halfExtents[0],n.halfExtents[1],n.halfExtents[2]);e[i]=new We(a,o)}else e[i]=t[i]}e.update()}migrate(e){e.shader&&delete e.shader,e.mapping_format&&(e.mappingFormat=e.mapping_format,delete e.mapping_format);let t;const i=[["bumpMapFactor","bumpiness"],["aoUvSet","aoMapUv"],["aoMapVertexColor","aoVertexColor"],["diffuseMapVertexColor","diffuseVertexColor"],["emissiveMapVertexColor","emissiveVertexColor"],["specularMapVertexColor","specularVertexColor"],["metalnessMapVertexColor","metalnessVertexColor"],["opacityMapVertexColor","opacityVertexColor"],["glossMapVertexColor","glossVertexColor"],["lightMapVertexColor","lightVertexColor"],["specularMapTint","specularTint"],["metalnessMapTint","metalnessTint"],["clearCoatGlossiness","clearCoatGloss"]];for(t=0;t<i.length;t++){const n=i[t][0],a=i[t][1];e[n]!==void 0&&(e[a]===void 0&&(e[a]=e[n]),delete e[n])}const s=["fresnelFactor","shadowSampleType"];for(t=0;t<s.length;t++){const n=s[t];e.hasOwnProperty(n)&&delete e[n]}return e}_validate(e){return e.validated||(this._validator||(this._validator=new pIe),this._validator.validate(e)),e}}const gIe={aoMap:"white",aoDetailMap:"white",diffuseMap:"gray",diffuseDetailMap:"gray",specularMap:"gray",specularityFactorMap:"white",metalnessMap:"black",glossMap:"gray",sheenMap:"black",sheenGlossMap:"gray",clearCoatMap:"black",clearCoatGlossMap:"gray",clearCoatNormalMap:"normal",refractionMap:"white",emissiveMap:"gray",normalMap:"normal",normalDetailMap:"normal",heightMap:"gray",opacityMap:"gray",sphereMap:"gray",lightMap:"white",thicknessMap:"black",iridescenceMap:"black",iridescenceThicknessMap:"black",envAtlas:"black",anisotropyMap:"black"};class _Ie extends Ot{constructor(e){super(e,"material"),this._assets=e.assets,this._device=e.graphicsDevice,this._parser=new mIe}load(e,t){typeof e=="string"&&(e={load:e,original:e}),qt.get(e.load,{retry:this.maxRetries>0,maxRetries:this.maxRetries},(i,s)=>{i?t&&t(`Error loading material: ${e.original} [${i}]`):t&&(s._engine=!0,t(null,s))})}open(e,t){const i=this._parser.parse(t);return t._engine&&(i._data=t,delete t._engine),i}patch(e,t){e.resource._data&&(e._data=e.resource._data,delete e.resource._data),e.data.name=e.name,e.resource.name=e.name,this._bindAndAssignAssets(e,t),e.off("unload",this._onAssetUnload,this),e.on("unload",this._onAssetUnload,this)}_onAssetUnload(e){delete e.data.parameters,delete e.data.chunks,delete e.data.name}_assignTexture(e,t,i){t.resource[e]=i}_getPlaceholderTexture(e){const t=gIe[e];return Gu(this._device,t)}_assignPlaceholderTexture(e,t){t.resource[e]=this._getPlaceholderTexture(e)}_onTextureLoad(e,t,i){this._assignTexture(e,t,i.resource),t.resource.update()}_onTextureAdd(e,t,i){this._assets.load(i)}_onTextureRemoveOrUnload(e,t,i){const s=t.resource;s&&t.resource[e]===i.resource&&(this._assignPlaceholderTexture(e,t),s.update())}_assignCubemap(e,t,i){if(t.resource[e]=i[0],e==="cubeMap"){const s=i.slice(1);s.every(n=>n)?t.resource.prefilteredCubemaps=s:s[0]&&(t.resource.envAtlas=s[0])}}_onCubemapLoad(e,t,i){this._assignCubemap(e,t,i.resources),this._parser.initialize(t.resource,t.data)}_onCubemapAdd(e,t,i){this._assets.load(i)}_onCubemapRemoveOrUnload(e,t,i){const s=t.resource;t.data.prefilteredCubeMap128===i.resources[1]&&(this._assignCubemap(e,t,[null,null,null,null,null,null,null]),s.update())}_bindAndAssignAssets(e,t){const i=this._parser.migrate(e.data),s=e.resource,n=i.mappingFormat==="path",a=HE;let o,l,c;for(o=0;o<a.length;o++){l=a[o],c=s._assetReferences[l];const h=i[l],d=s[l],f=d===this._getPlaceholderTexture(l),p=i.validated;h&&(!d||!p||f)?(c||(c=new lv(l,e,t,{load:this._onTextureLoad,add:this._onTextureAdd,remove:this._onTextureRemoveOrUnload,unload:this._onTextureRemoveOrUnload},this),s._assetReferences[l]=c),n?c.url=e.getAbsoluteUrl(h):c.id=h,c.asset&&(c.asset.resource?this._assignTexture(l,e,c.asset.resource):this._assignPlaceholderTexture(l,e),t.load(c.asset))):c&&(n?c.url=null:c.id=null)}const u=B3;for(o=0;o<u.length;o++)l=u[o],c=s._assetReferences[l],i[l]&&!e.data.prefilteredCubeMap128&&(c||(c=new lv(l,e,t,{load:this._onCubemapLoad,add:this._onCubemapAdd,remove:this._onCubemapRemoveOrUnload,unload:this._onCubemapRemoveOrUnload},this),s._assetReferences[l]=c),n?c.url=i[l]:c.id=i[l],c.asset&&(c.asset.loaded&&this._assignCubemap(l,e,c.asset.resources),t.load(c.asset)));this._parser.initialize(s,i)}}class vIe{constructor(e){this._device=e.device,this._defaultMaterial=e.defaultMaterial,this._assets=e.assets}parse(e,t,i){zb.parse("filename.glb","",e,this._device,this._assets,(i==null?void 0:i.options)??{},(s,n)=>{if(s)t(s);else{const a=Gl.createModel(n,this._defaultMaterial);n.destroy(),t(null,a)}})}}const yIe={points:_E,lines:vE,lineloop:Cq,linestrip:Pq,triangles:Uo,trianglestrip:wc,trianglefan:zu},SIe={int8:yE,uint8:Vu,int16:SE,uint16:wy,int32:Oq,uint32:xE,float32:bt};class xIe{constructor(e){this._device=e.device,this._defaultMaterial=e.defaultMaterial}parse(e,t){const i=e.model;if(!i){t(null,null);return}if(i.version<=1){t("JsonModelParser#parse: Trying to parse unsupported model format.");return}const s=this._parseNodes(e),n=this._parseSkins(e,s),a=this._parseVertexBuffers(e),o=this._parseIndexBuffers(e,a),l=this._parseMorphs(e,s,a),c=this._parseMeshes(e,n.skins,l.morphs,a,o.buffer,o.data),u=this._parseMeshInstances(e,s,c,n.skins,n.instances,l.morphs,l.instances),h=new al;h.graph=s[0],h.meshInstances=u,h.skinInstances=n.instances,h.morphInstances=l.instances,h.getGraph().syncHierarchy(),t(null,h)}_parseNodes(e){const t=e.model,i=[];let s;for(s=0;s<t.nodes.length;s++){const n=t.nodes[s],a=new Xt(n.name);a.setLocalPosition(n.position[0],n.position[1],n.position[2]),a.setLocalEulerAngles(n.rotation[0],n.rotation[1],n.rotation[2]),a.setLocalScale(n.scale[0],n.scale[1],n.scale[2]),a.scaleCompensation=!!n.scaleCompensation,i.push(a)}for(s=1;s<t.parents.length;s++)i[t.parents[s]].addChild(i[s]);return i}_parseSkins(e,t){const i=e.model,s=[],n=[];let a,o;for(a=0;a<i.skins.length;a++){const l=i.skins[a],c=[];for(o=0;o<l.inverseBindMatrices.length;o++){const f=l.inverseBindMatrices[o];c[o]=new se().set(f)}const u=new $9(this._device,c,l.boneNames);s.push(u);const h=new Cy(u),d=[];for(o=0;o<u.boneNames.length;o++){const f=u.boneNames[o],p=t[0].findByName(f);d.push(p)}h.bones=d,n.push(h)}return{skins:s,instances:n}}_getMorphVertexCount(e,t,i){for(let s=0;s<e.meshes.length;s++){const n=e.meshes[s];if(n.morph===t)return i[n.vertices].numVertices}}_parseMorphs(e,t,i){const s=e.model,n=[],a=[];let o,l,c,u,h,d;if(s.morphs){const f=function(p,m,g){const _=new Float32Array(g*3);for(let v=0;v<m.length;v++){const y=m[v]*3;_[y]=p[v*3],_[y+1]=p[v*3+1],_[y+2]=p[v*3+2]}return _};for(o=0;o<s.morphs.length;o++){for(u=s.morphs[o].targets,d=[],c=this._getMorphVertexCount(s,o,i),l=0;l<u.length;l++){const g=u[l].aabb,_=g.min,v=g.max,y=new We(new O((v[0]+_[0])*.5,(v[1]+_[1])*.5,(v[2]+_[2])*.5),new O((v[0]-_[0])*.5,(v[1]-_[1])*.5,(v[2]-_[2])*.5)),x=u[l].indices;let S=u[l].deltaPositions,w=u[l].deltaNormals;x&&(S=f(S,x,c),w=f(w,x,c)),h=new $E({deltaPositions:S,deltaNormals:w,name:u[l].name,aabb:y}),d.push(h)}const p=new F9(d,this._device);n.push(p);const m=new vh(p);a.push(m)}}return{morphs:n,instances:a}}_parseVertexBuffers(e){const t=e.model,i=[],s={position:Xe,normal:Rs,tangent:Xa,blendWeight:za,blendIndices:Es,color:wr,texCoord0:un,texCoord1:Oh,texCoord2:gy,texCoord3:_y,texCoord4:vy,texCoord5:yy,texCoord6:Sy,texCoord7:xy};for(let n=0;n<t.vertices.length;n++){const a=t.vertices[n],o=[];for(const d in a){const f=a[d];o.push({semantic:s[d],components:f.components,type:SIe[f.type],normalize:s[d]===wr})}const l=new Ls(this._device,o),c=a.position.data.length/a.position.components,u=new Ya(this._device,l,c),h=new Xg(u);for(let d=0;d<c;d++){for(const f in a){const p=a[f];switch(p.components){case 1:h.element[s[f]].set(p.data[d]);break;case 2:h.element[s[f]].set(p.data[d*2],1-p.data[d*2+1]);break;case 3:h.element[s[f]].set(p.data[d*3],p.data[d*3+1],p.data[d*3+2]);break;case 4:h.element[s[f]].set(p.data[d*4],p.data[d*4+1],p.data[d*4+2],p.data[d*4+3]);break}}h.next()}h.end(),i.push(u)}return i}_parseIndexBuffers(e,t){const i=e.model;let s=null,n=null,a,o=0;for(a=0;a<i.meshes.length;a++){const c=i.meshes[a];c.indices!==void 0&&(o+=c.indices.length)}let l=0;for(a=0;a<t.length;a++)l=Math.max(l,t[a].numVertices);return o>0&&(l>65535?(s=new dh(this._device,bc,o),n=new Uint32Array(s.lock())):(s=new dh(this._device,xc,o),n=new Uint16Array(s.lock()))),{buffer:s,data:n}}_parseMeshes(e,t,i,s,n,a){const o=e.model,l=[];let c=0;for(let u=0;u<o.meshes.length;u++){const h=o.meshes[u],d=h.aabb,f=d.min,p=d.max,m=new We(new O((p[0]+f[0])*.5,(p[1]+f[1])*.5,(p[2]+f[2])*.5),new O((p[0]-f[0])*.5,(p[1]-f[1])*.5,(p[2]-f[2])*.5)),g=h.indices!==void 0,_=new It(this._device);_.vertexBuffer=s[h.vertices],_.indexBuffer[0]=g?n:null,_.primitive[0].type=yIe[h.type],_.primitive[0].base=g?h.base+c:h.base,_.primitive[0].count=h.count,_.primitive[0].indexed=g,_.skin=h.skin!==void 0?t[h.skin]:null,_.morph=h.morph!==void 0?i[h.morph]:null,_.aabb=m,g&&(a.set(h.indices,c),c+=h.indices.length),l.push(_)}return n!==null&&n.unlock(),l}_parseMeshInstances(e,t,i,s,n,a,o){const l=e.model,c=[];let u;for(u=0;u<l.meshInstances.length;u++){const h=l.meshInstances[u],d=t[h.node],f=i[h.mesh],p=new Dt(f,this._defaultMaterial,d);if(f.skin){const m=s.indexOf(f.skin);p.skinInstance=n[m]}if(f.morph){const m=a.indexOf(f.morph);p.morphInstance=o[m]}c.push(p)}return c}}class bIe extends Ot{constructor(e){super(e,"model"),this._parsers=[],this.device=e.graphicsDevice,this.assets=e.assets,this.defaultMaterial=Py(this.device),this.addParser(new xIe(this),(t,i)=>Ne.getExtension(t)===".json"),this.addParser(new vIe(this),(t,i)=>Ne.getExtension(t)===".glb")}load(e,t,i){typeof e=="string"&&(e={load:e,original:e});const s={retry:this.maxRetries>0,maxRetries:this.maxRetries};(e.load.startsWith("blob:")||e.load.startsWith("data:"))&&(Ne.getExtension(e.original).toLowerCase()===".glb"?s.responseType=Os.ResponseType.ARRAY_BUFFER:s.responseType=Os.ResponseType.JSON),qt.get(e.load,s,(n,a)=>{if(t)if(n)t(`Error loading model: ${e.original} [${n}]`);else{for(let o=0;o<this._parsers.length;o++){const l=this._parsers[o];if(l.decider(e.original,a)){l.parser.parse(a,(c,u)=>{c?t(c):t(null,u)},i);return}}t("No parsers found")}})}open(e,t){return t}patch(e,t){if(!e.resource)return;const i=e.data,s=this;e.resource.meshInstances.forEach((n,a)=>{if(i.mapping){const o=function(h){h.resource?n.material=h.resource:(h.once("load",o),t.load(h)),h.once("remove",d=>{n.material===d.resource&&(n.material=s.defaultMaterial)})};if(!i.mapping[a]){n.material=s.defaultMaterial;return}const l=i.mapping[a].material,c=i.mapping[a].path;let u;if(l!==void 0)l?(u=t.get(l),u?o(u):t.once(`add:${l}`,o)):n.material=s.defaultMaterial;else if(c){const h=e.getAbsoluteUrl(i.mapping[a].path);u=t.getByUrl(h),u?o(u):t.once(`add:url:${h}`,o)}}})}addParser(e,t){this._parsers.push({parser:e,decider:t})}}class wIe extends Ot{constructor(e){super(e,"scene")}load(e,t){zY.load(e,this.maxRetries,t)}open(e,t){this._app.systems.script.preloading=!0;const s=new W3(this._app,!1).parse(t),n=this._app.scene;return n.root=s,this._app.applySceneSettings(t.settings),this._app.systems.script.preloading=!1,n}}const lT=class lT{static push(e){lT._types.push(e)}};lT._types=[];let Au=lT;const TIe=new Set(["system","entity","create","destroy","swap","move","data","scripts","_scripts","_scriptsIndex","_scriptsData","enabled","_oldState","onEnable","onDisable","onPostStateChange","_onSetEnabled","_checkState","_onBeforeRemove","_onInitializeAttributes","_onInitialize","_onPostInitialize","_onUpdate","_onPostUpdate","_callbacks","_callbackActive","has","get","on","off","fire","once","hasEvent"]),EIe={};cv.reservedNames.forEach((r,e,t)=>{EIe[r]=1});function AIe(r,e,t){if(typeof r!="function")throw new Error(`script class: '${r}' must be a constructor function (i.e. class).`);if(!(r.prototype instanceof xp))throw new Error(`script class: '${e_.__getScriptName(r)}' does not extend pc.Script.`);if(e=e||r.__name||e_.__getScriptName(r),TIe.has(e))throw new Error(`script name: '${e}' is reserved, please change script name`);r.__name=e,Ab.getApplication().scripts.add(r),Au.push(r)}const CIe=r=>r[0].toLowerCase()+r.substring(1);class PIe extends Ot{constructor(e){super(e,"script"),this._scripts={},this._cache={}}clearCache(){for(const e in this._cache){const t=this._cache[e],i=t.parentNode;i&&i.removeChild(t)}this._cache={}}load(e,t){typeof e=="string"&&(e={load:e,original:e});const i=this;this._app;const s=(e.load,(o,l,c)=>{if(o)t(o);else{const u={};for(let d=0;d<Au._types.length;d++)u[Au._types[d].name]=Au._types[d];Au._types.length=0,t(null,u,c);const h=l.split("&hash=")[0];delete i._loader._cache[Lf.makeKey(h,"script")]}}),[n]=e.load.split("?");n.endsWith(".mjs")?this._loadModule(n,s):this._loadScript(e.load,s)}open(e,t){return t}patch(e,t){}_loadScript(e,t){const i=document.head,s=document.createElement("script");this._cache[e]=s,s.async=!1,s.addEventListener("error",a=>{t(`Script: ${a.target.src} failed to load`)},!1);let n=!1;s.onload=s.onreadystatechange=function(){!n&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")&&(n=!0,t(null,e,s))},s.src=e,i.appendChild(s)}_loadModule(e,t){const s=Ye.browser&&window.location.origin!=="null"?window.location.origin+window.location.pathname:import.meta.url,n=new URL(e,s);import(n.toString()).then(a=>{var c,u;const o=n.pathname.split("/").pop(),l=(u=(c=this._app.assets.find(o,"script"))==null?void 0:c.data)==null?void 0:u.scripts;for(const h in a){const d=a[h];if(d.prototype instanceof xp){const p=CIe(d.name);d.scriptName;const m=d.scriptName??p;AIe(d,m),l&&this._app.scripts.addSchema(m,l[m])}}t(null,e,null)}).catch(a=>{t(a)})}}class IIe extends Ot{constructor(e){super(e,"shader"),this.decoder=null}load(e,t){typeof e=="string"&&(e={load:e,original:e}),qt.get(e.load,{retry:this.maxRetries>0,maxRetries:this.maxRetries},(i,s)=>{i?t(`Error loading shader resource: ${e.original} [${i}]`):t(null,s)})}openBinary(e){return this.decoder??(this.decoder=new TextDecoder("utf-8")),this.decoder.decode(e)}}function WC(r){const e=this;e.resource&&(e.resource.atlas=r.resource)}function XC(r){this.registry.load(r)}class MIe extends Ot{constructor(e){super(e,"sprite"),this._assets=e.assets,this._device=e.graphicsDevice}load(e,t){typeof e=="string"&&(e={load:e,original:e}),Ne.getExtension(e.original)===".json"&&qt.get(e.load,{retry:this.maxRetries>0,maxRetries:this.maxRetries},(i,s)=>{i?t(i):t(null,s)})}open(e,t){const i=new k_e(this._device);return e&&(i.__data=t),i}patch(e,t){const i=e.resource;if(i.__data&&(e.data.pixelsPerUnit=i.__data.pixelsPerUnit,e.data.renderMode=i.__data.renderMode,e.data.frameKeys=i.__data.frameKeys,i.__data.textureAtlasAsset)){const s=t.getByUrl(i.__data.textureAtlasAsset);s?e.data.textureAtlasAsset=s.id:console.warn(`Could not find textureatlas with url: ${i.__data.textureAtlasAsset}`)}i.startUpdate(),i.renderMode=e.data.renderMode,i.pixelsPerUnit=e.data.pixelsPerUnit,i.frameKeys=e.data.frameKeys,this._updateAtlas(e),i.endUpdate(),e.off("change",this._onAssetChange,this),e.on("change",this._onAssetChange,this)}_updateAtlas(e){const t=e.resource;if(!e.data.textureAtlasAsset){t.atlas=null;return}this._assets.off(`load:${e.data.textureAtlasAsset}`,WC,e),this._assets.on(`load:${e.data.textureAtlasAsset}`,WC,e);const i=this._assets.get(e.data.textureAtlasAsset);i&&i.resource?t.atlas=i.resource:i?this._assets.load(i):(this._assets.off(`add:${e.data.textureAtlasAsset}`,XC,e),this._assets.on(`add:${e.data.textureAtlasAsset}`,XC,e))}_onAssetChange(e,t,i,s){t==="data"&&i&&i.textureAtlasAsset&&s&&i.textureAtlasAsset!==s.textureAtlasAsset&&(this._assets.off(`load:${s.textureAtlasAsset}`,WC,e),this._assets.off(`add:${s.textureAtlasAsset}`,XC,e))}}class vV{constructor(e,t){this._templateRoot=null,this._app=e,this._data=t}instantiate(){return this._templateRoot||this._parseTemplate(),this._templateRoot.clone()}_parseTemplate(){const e=new W3(this._app,!0);this._templateRoot=e.parse(this._data)}}class RIe extends Ot{constructor(e){super(e,"template"),this.decoder=null}load(e,t){typeof e=="string"&&(e={load:e,original:e});const i={retry:this.maxRetries>0,maxRetries:this.maxRetries};qt.get(e.load,i,(s,n)=>{s?t(`Error requesting template: ${e.original}`):t(s,n)})}open(e,t){return new vV(this._app,t)}openBinary(e){return this.decoder??(this.decoder=new TextDecoder("utf-8")),new vV(this._app,JSON.parse(this.decoder.decode(e)))}}class DIe extends Ot{constructor(e){super(e,"text"),this.decoder=null}load(e,t){typeof e=="string"&&(e={load:e,original:e}),qt.get(e.load,{retry:this.maxRetries>0,maxRetries:this.maxRetries},(i,s)=>{i?t(`Error loading text resource: ${e.original} [${i}]`):t(null,s)})}openBinary(e){return this.decoder??(this.decoder=new TextDecoder("utf-8")),this.decoder.decode(e)}}const dS={repeat:zi,clamp:ge,mirror:CO},fS={nearest:qe,linear:_i,nearest_mip_nearest:rE,linear_mip_nearest:nE,nearest_mip_linear:sE,linear_mip_linear:lh},LIe=/^data\.frames\.(\d+)$/;class OIe extends Ot{constructor(e){super(e,"textureatlas"),this._loader=e.loader}load(e,t){typeof e=="string"&&(e={load:e,original:e});const i=this,s=this._loader.getHandler("texture");Ne.getExtension(e.original)===".json"?qt.get(e.load,{retry:this.maxRetries>0,maxRetries:this.maxRetries},(n,a)=>{if(n)t(n);else{const o=e.original.replace(".json",".png");i._loader.load(o,"texture",(l,c)=>{l?t(l):t(null,{data:a,texture:c})})}}):s.load(e,t)}open(e,t,i){const s=new F_e;if(t.texture&&t.data)s.texture=t.texture,s.__data=t.data;else{const a=this._loader.getHandler("texture").open(e,t,i);if(!a)return null;s.texture=a}return s}patch(e,t){if(!e.resource)return;e.resource.__data&&(e.resource.__data.minfilter!==void 0&&(e.data.minfilter=e.resource.__data.minfilter),e.resource.__data.magfilter!==void 0&&(e.data.magfilter=e.resource.__data.magfilter),e.resource.__data.addressu!==void 0&&(e.data.addressu=e.resource.__data.addressu),e.resource.__data.addressv!==void 0&&(e.data.addressv=e.resource.__data.addressv),e.resource.__data.mipmaps!==void 0&&(e.data.mipmaps=e.resource.__data.mipmaps),e.resource.__data.anisotropy!==void 0&&(e.data.anisotropy=e.resource.__data.anisotropy),e.resource.__data.rgbm!==void 0&&(e.data.rgbm=!!e.resource.__data.rgbm),e.data.frames=e.resource.__data.frames,delete e.resource.__data);const i=e.resource.texture;if(i&&(i.name=e.name,e.data.hasOwnProperty("minfilter")&&i.minFilter!==fS[e.data.minfilter]&&(i.minFilter=fS[e.data.minfilter]),e.data.hasOwnProperty("magfilter")&&i.magFilter!==fS[e.data.magfilter]&&(i.magFilter=fS[e.data.magfilter]),e.data.hasOwnProperty("addressu")&&i.addressU!==dS[e.data.addressu]&&(i.addressU=dS[e.data.addressu]),e.data.hasOwnProperty("addressv")&&i.addressV!==dS[e.data.addressv]&&(i.addressV=dS[e.data.addressv]),e.data.hasOwnProperty("mipmaps")&&i.mipmaps!==e.data.mipmaps&&(i.mipmaps=e.data.mipmaps),e.data.hasOwnProperty("anisotropy")&&i.anisotropy!==e.data.anisotropy&&(i.anisotropy=e.data.anisotropy),e.data.hasOwnProperty("rgbm"))){const n=e.data.rgbm?ch:qa;i.type!==n&&(i.type=n)}e.resource.texture=i;const s={};for(const n in e.data.frames){const a=e.data.frames[n];s[n]={rect:new ce(a.rect),pivot:new ee(a.pivot),border:new ce(a.border)}}e.resource.frames=s,e.off("change",this._onAssetChange,this),e.on("change",this._onAssetChange,this)}_onAssetChange(e,t,i){let s;if(t==="data"||t==="data.frames"){const n={};for(const a in i.frames)s=i.frames[a],n[a]={rect:new ce(s.rect),pivot:new ee(s.pivot),border:new ce(s.border)};e.resource.frames=n}else{const n=t.match(LIe);if(n){const a=n[1];i?(e.resource.frames[a]?(s=e.resource.frames[a],s.rect.set(i.rect[0],i.rect[1],i.rect[2],i.rect[3]),s.pivot.set(i.pivot[0],i.pivot[1]),s.border.set(i.border[0],i.border[1],i.border[2],i.border[3])):e.resource.frames[a]={rect:new ce(i.rect),pivot:new ee(i.pivot),border:new ce(i.border)},e.resource.fire("set:frame",a,e.resource.frames[a])):e.resource.frames[a]&&(delete e.resource.frames[a],e.resource.fire("remove:frame",a))}}}}function NIe(){const r={cTFETC1:0,cTFETC2:1,cTFBC1:2,cTFBC3:3,cTFPVRTC1_4_RGB:8,cTFPVRTC1_4_RGBA:9,cTFASTC_4x4:10,cTFATC_RGB:11,cTFATC_RGBA_INTERPOLATED_ALPHA:12,cTFRGBA32:13,cTFRGB565:14,cTFRGBA4444:16},e={astc:r.cTFASTC_4x4,dxt:r.cTFBC1,etc1:r.cTFETC1,etc2:r.cTFETC1,pvr:r.cTFPVRTC1_4_RGB,atc:r.cTFATC_RGB,none:r.cTFRGB565},t={astc:r.cTFASTC_4x4,dxt:r.cTFBC3,etc1:r.cTFRGBA4444,etc2:r.cTFETC2,pvr:r.cTFPVRTC1_4_RGBA,atc:r.cTFATC_RGBA_INTERPOLATED_ALPHA,none:r.cTFRGBA4444},i={ETC1:21,ETC2_RGB:22,ETC2_RGBA:23,DXT1:8,DXT5:10,PVRTC_4BPP_RGB_1:26,PVRTC_4BPP_RGBA_1:27,ASTC_4x4:28,ATC_RGB:29,ATC_RGBA:30,R8_G8_B8_A8:7,R5_G6_B5:3,R4_G4_B4_A4:5},s=(x,S)=>{switch(x){case r.cTFETC1:return S.formats.etc2?i.ETC2_RGB:i.ETC1;case r.cTFETC2:return i.ETC2_RGBA;case r.cTFBC1:return i.DXT1;case r.cTFBC3:return i.DXT5;case r.cTFPVRTC1_4_RGB:return i.PVRTC_4BPP_RGB_1;case r.cTFPVRTC1_4_RGBA:return i.PVRTC_4BPP_RGBA_1;case r.cTFASTC_4x4:return i.ASTC_4x4;case r.cTFATC_RGB:return i.ATC_RGB;case r.cTFATC_RGBA_INTERPOLATED_ALPHA:return i.ATC_RGBA;case r.cTFRGBA32:return i.R8_G8_B8_A8;case r.cTFRGB565:return i.R5_G6_B5;case r.cTFRGBA4444:return i.R4_G4_B4_A4}},n=x=>{const S=function(w,T){const A=w*.00784313725490196-1,C=T*(2/255)-1,P=Math.sqrt(1-Math.min(1,A*A+C*C));return Math.max(0,Math.min(255,Math.floor((P+1)*.5*255)))};for(let w=0;w<x.length;w+=4){const T=x[w+3],A=x[w+1];x[w+0]=T,x[w+2]=S(T,A),x[w+3]=255}return x},a=x=>{const S=new Uint16Array(x.length/4);for(let w=0;w<x.length;w+=4){const T=x[w+0],A=x[w+1],C=x[w+2];S[w/4]=(T&248)<<8|(A&252)<<3|C>>3}return S},o=(x,S)=>(x&x-1)===0&&(S&S-1)===0,l=()=>typeof performance<"u"?performance.now():0;let c,u,h;const d=(x,S,w)=>{if(w){if(x.formats.astc)return"astc"}else if(S){if(x.formats.etc2)return"etc2"}else{if(x.formats.etc2)return"etc2";if(x.formats.etc1)return"etc1"}return(A=>{for(let C=0;C<A.length;++C){const P=A[C];if(x.formats[P])return P}return"none"})(S?h:u)},f=(x,S,w)=>{switch(w){case r.cTFETC1:case r.cTFETC2:return!0;case r.cTFBC1:case r.cTFBC3:return(x&3)===0&&(S&3)===0;case r.cTFPVRTC1_4_RGB:case r.cTFPVRTC1_4_RGBA:return o(x,S);case r.cTFASTC_4x4:return!0;case r.cTFATC_RGB:case r.cTFATC_RGBA_INTERPOLATED_ALPHA:return!0}return!1},p=(x,S,w)=>{if(!c.KTX2File)throw new Error("Basis transcoder module does not include support for KTX2.");const T=l(),A=new c.KTX2File(new Uint8Array(S)),C=A.getWidth(),P=A.getHeight(),I=A.getLevels(),M=!!A.getHasAlpha(),N=A.isUASTC&&A.isUASTC();if(!C||!P||!I)throw A.close(),A.delete(),new Error(`Invalid image dimensions url=${x} width=${C} height=${P} levels=${I}`);const k=d(w.deviceDetails,M,N),V=!!w.isGGGR&&k==="pvr";let B;if(V?B=r.cTFRGBA32:(B=M?t[k]:e[k],f(C,P,B)||(B=M?r.cTFRGBA32:r.cTFRGB565)),!A.startTranscoding())throw A.close(),A.delete(),new Error(`Failed to start transcoding url=${x}`);let R;const L=[];for(let D=0;D<I;++D){const F=A.getImageTranscodedSizeInBytes(D,0,0,B),j=new Uint8Array(F);if(!A.transcodeImage(j,D,0,0,B,0,-1,-1))throw A.close(),A.delete(),new Error(`Failed to transcode image url=${x}`);const z=B===r.cTFRGB565||B===r.cTFRGBA4444;L.push(z?new Uint16Array(j.buffer):j)}if(A.close(),A.delete(),V)for(B=r.cTFRGB565,R=0;R<L.length;++R)L[R]=a(n(L[R]));return{format:s(B,w.deviceDetails),width:C,height:P,levels:L,cubemap:!1,transcodeTime:l()-T,url:x,unswizzledGGGR:V}},m=(x,S,w)=>{const T=l(),A=new c.BasisFile(new Uint8Array(S)),C=A.getImageWidth(0,0),P=A.getImageHeight(0,0),I=A.getNumImages(),M=A.getNumLevels(0),N=!!A.getHasAlpha(),k=A.isUASTC&&A.isUASTC();if(!C||!P||!I||!M)throw A.close(),A.delete(),new Error(`Invalid image dimensions url=${x} width=${C} height=${P} images=${I} levels=${M}`);const V=d(w.deviceDetails,N,k),B=!!w.isGGGR&&V==="pvr";let R;if(B?R=r.cTFRGBA32:(R=N?t[V]:e[V],f(C,P,R)||(R=N?r.cTFRGBA32:r.cTFRGB565)),!A.startTranscoding())throw A.close(),A.delete(),new Error(`Failed to start transcoding url=${x}`);let L;const D=[];for(let F=0;F<M;++F){const j=A.getImageTranscodedSizeInBytes(0,F,R),z=new Uint8Array(j);if(!A.transcodeImage(z,0,F,R,0,0))if(F===M-1&&j===D[F-1].buffer.byteLength)z.set(new Uint8Array(D[F-1].buffer)),console.warn(`Failed to transcode last mipmap level, using previous level instead url=${x}`);else throw A.close(),A.delete(),new Error(`Failed to transcode image url=${x}`);const $=R===r.cTFRGB565||R===r.cTFRGBA4444;D.push($?new Uint16Array(z.buffer):z)}if(A.close(),A.delete(),B)for(R=r.cTFRGB565,L=0;L<D.length;++L)D[L]=a(n(D[L]));return{format:s(R,w.deviceDetails),width:C,height:P,levels:D,cubemap:!1,transcodeTime:l()-T,url:x,unswizzledGGGR:B}},g=(x,S,w)=>w.isKTX2?p(x,S,w):m(x,S,w),_=(x,S,w)=>{try{const T=g(x,S,w);T.levels=T.levels.map(A=>A.buffer),self.postMessage({url:x,data:T},T.levels)}catch(T){self.postMessage({url:x,err:T},null)}},v=(x,S)=>{const w=(T,A)=>(WebAssembly.instantiate(x.module,T).then(C=>{A(C)}).catch(C=>{console.error(`instantiate failed + ${C}`)}),{});self.BASIS(x.module?{instantiateWasm:w}:null).then(T=>{T.initializeBasis(),c=T,u=x.rgbPriority,h=x.rgbaPriority,S(null)})},y=[];self.onmessage=x=>{const S=x.data;switch(S.type){case"init":v(S.config,()=>{for(let w=0;w<y.length;++w)_(y[w].url,y[w].data,y[w].options);y.length=0});break;case"transcode":c?_(S.url,S.data,S.options):y.push(S);break}}}const kIe=r=>({astc:!!r.extCompressedTextureASTC,atc:!!r.extCompressedTextureATC,dxt:!!r.extCompressedTextureS3TC,etc1:!!r.extCompressedTextureETC1,etc2:!!r.extCompressedTextureETC,pvr:!!r.extCompressedTexturePVRTC}),FIe=(r,e)=>{const t=a=>{const o=["/* basis */",a,"",`(${NIe.toString()})()

`].join(`
`);return new Blob([o],{type:"application/javascript"})},i=()=>{try{if(typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function"){const a=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(a instanceof WebAssembly.Module)return new WebAssembly.Instance(a)instanceof WebAssembly.Instance}}catch{}return!1},s=(a,o)=>{e(null,{workerUrl:URL.createObjectURL(t(a)),module:o,rgbPriority:r.rgbPriority,rgbaPriority:r.rgbaPriority})},n={cache:!0,responseType:"text",retry:r.maxRetries>0,maxRetries:r.maxRetries};if(r.glueUrl&&r.wasmUrl&&i()){let a=null,o=null;qt.get(r.glueUrl,n,(u,h)=>{u?e(u):o?s(h,o):a=h});const l=fetch(r.wasmUrl),c=()=>{l.then(u=>u.arrayBuffer()).then(u=>WebAssembly.compile(u)).then(u=>{a?s(a,u):o=u}).catch(u=>{e(u,null)})};WebAssembly.compileStreaming?WebAssembly.compileStreaming(l).then(u=>{a?s(a,u):o=u}).catch(u=>{c()}):c()}else qt.get(r.fallbackUrl,n,(a,o)=>{a?e(a,null):s(o,null)})};class BIe{constructor(){this.callbacks={},this.queue=[],this.clients=[]}enqueueJob(e,t,i,s){if(this.callbacks.hasOwnProperty(e))this.callbacks[e].push(i);else{this.callbacks[e]=[i];const n={url:e,data:t,options:s};this.clients.length>0?this.clients.shift().run(n):this.queue.push(n)}}enqueueClient(e){this.queue.length>0?e.run(this.queue.shift()):this.clients.push(e)}handleResponse(e,t,i){const s=this.callbacks[e];if(t)for(let n=0;n<s.length;++n)s[n](t);else{i.format===aE||i.format===oE?i.levels=i.levels.map(n=>new Uint16Array(n)):i.levels=i.levels.map(n=>new Uint8Array(n));for(let n=0;n<s.length;++n)s[n](null,i)}delete this.callbacks[e]}}class UIe{constructor(e,t,i){this.queue=e,this.worker=new Worker(t.workerUrl),this.worker.addEventListener("message",s=>{const n=s.data;this.queue.handleResponse(n.url,n.err,n.data),this.eager||this.queue.enqueueClient(this)}),this.worker.postMessage({type:"init",config:t}),this.eager=i}run(e){const t=[];e.data instanceof ArrayBuffer&&t.push(e.data),this.worker.postMessage({type:"transcode",url:e.url,format:e.format,data:e.data,options:e.options},t),this.eager&&this.queue.enqueueClient(this)}}const zIe=1,VIe=["etc2","etc1","astc","dxt","pvr","atc"],jIe=["astc","dxt","etc2","pvr","atc"],$Ie=5,y2=new BIe;let yV=null,S2=!1;function HIe(r){if(!S2){if(!r)r=yV||{};else if(r.lazyInit){yV=r;return}if(!r.glueUrl||!r.wasmUrl||!r.fallbackUrl){const e=lq.getConfig("BASIS");e&&(r={glueUrl:e.glueUrl,wasmUrl:e.wasmUrl,fallbackUrl:e.fallbackUrl,numWorkers:e.numWorkers})}if(r.glueUrl||r.wasmUrl||r.fallbackUrl){S2=!0;const e=Math.max(1,Math.min(16,r.numWorkers||zIe)),t=r.numWorkers===1||(r.hasOwnProperty("eagerWorkers")?r.eagerWorkers:!0);r.rgbPriority=r.rgbPriority||VIe,r.rgbaPriority=r.rgbaPriority||jIe,r.maxRetries=r.hasOwnProperty("maxRetries")?r.maxRetries:$Ie,FIe(r,(i,s)=>{if(i)console.error(`failed to initialize basis worker: ${i}`);else for(let n=0;n<e;++n)y2.enqueueClient(new UIe(y2,s,t))})}}}let qC=null;function VY(r,e,t,i,s){return HIe(),qC||(qC={formats:kIe(r)}),y2.enqueueJob(e,t,i,{deviceDetails:qC,isGGGR:!!(s!=null&&s.isGGGR),isKTX2:!!(s!=null&&s.isKTX2)}),S2}class dm{load(e,t,i){throw new Error("not implemented")}open(e,t,i){throw new Error("not implemented")}}class GIe extends dm{constructor(e,t){super(),this.device=t,this.maxRetries=0}load(e,t,i){const s=this.device,n=a=>{var l,c,u;VY(s,e.load,a,t,{isGGGR:(((u=(c=(l=i==null?void 0:i.file)==null?void 0:l.variants)==null?void 0:c.basis)==null?void 0:u.opt)&8)!==0})||t(`Basis module not found. Asset [${i.name}](${i.getFileUrl()}) basis texture variant will not be loaded.`)};be.fetchArrayBuffer(e.load,(a,o)=>{a?t(a):n(o)},i,this.maxRetries)}open(e,t,i,s={}){const n=s.srgb?gE(t.format):t.format,a=new we(i,{name:e,addressU:t.cubemap?ge:zi,addressV:t.cubemap?ge:zi,width:t.width,height:t.height,format:n,cubemap:t.cubemap,levels:t.levels,...s});return a.upload(),a}}class WIe extends dm{constructor(e,t){super(),this.crossOrigin=e.prefix?"anonymous":null,this.maxRetries=0,this.device=t}load(e,t,i){var o;const s=!!((o=i==null?void 0:i.file)!=null&&o.contents);if(s){if(this.device.supportsImageBitmap){this._loadImageBitmapFromBlob(new Blob([i.file.contents]),t);return}e={load:URL.createObjectURL(new Blob([i.file.contents])),original:e.original}}const n=(l,c)=>{s&&URL.revokeObjectURL(e.load),t(l,c)};let a;i&&i.options&&i.options.hasOwnProperty("crossOrigin")?a=i.options.crossOrigin:yp.test(e.load)&&(a=this.crossOrigin),this.device.supportsImageBitmap?this._loadImageBitmap(e.load,e.original,a,n):this._loadImage(e.load,e.original,a,n)}open(e,t,i,s={}){const n=new we(i,{name:e,width:t.width,height:t.height,format:s.srgb?Ms:ct,...s});return n.setSource(t),n}_loadImage(e,t,i,s){const n=new Image;i&&(n.crossOrigin=i);let a=0;const o=this.maxRetries;let l;n.onload=function(){s(null,n)},n.onerror=function(){if(!l)if(o>0&&++a<=o){const c=Math.pow(2,a)*100;console.log(`Error loading Texture from: '${t}' - Retrying in ${c}ms...`);const h=e.indexOf("?")>=0?"&":"?";l=setTimeout(()=>{n.src=`${e+h}retry=${Date.now()}`,l=null},c)}else s(`Error loading Texture from: '${t}'`)},n.src=e}_loadImageBitmap(e,t,i,s){const n={cache:!0,responseType:"blob",retry:this.maxRetries>0,maxRetries:this.maxRetries};qt.get(e,n,(a,o)=>{a?s(a):this._loadImageBitmapFromBlob(o,s)})}_loadImageBitmapFromBlob(e,t){createImageBitmap(e,{premultiplyAlpha:"none",colorSpaceConversion:"none"}).then(i=>t(null,i)).catch(i=>t(i))}}const YC=[1481919403,3140563232,169478669],XIe={33776:lE,33778:LO,33779:fy,36196:hE,37492:kO,37496:FO,35840:dE,35841:py,35842:fE,35843:my,32849:Ic,32856:ct,35905:NO,35907:Ms,35898:np,34843:cE,34842:wi};function qIe(r,e,t,i){return r===np?new Uint32Array(e,t,i/4):new Uint8Array(e,t,i)}class YIe extends dm{constructor(e){super(),this.maxRetries=0}load(e,t,i){be.fetchArrayBuffer(e.load,t,i,this.maxRetries)}open(e,t,i,s={}){const n=this.parse(t);if(!n)return null;const a=s.srgb?gE(n.format):n.format,o=new we(i,{name:e,addressU:n.cubemap?ge:zi,addressV:n.cubemap?ge:zi,width:n.width,height:n.height,format:a,cubemap:n.cubemap,levels:n.levels,...s});return o.upload(),o}parse(e){const t=new Uint32Array(e);if(YC[0]!==t[0]||YC[1]!==t[1]||YC[2]!==t[2])return null;const i={endianness:t[3],glType:t[4],glTypeSize:t[5],glFormat:t[6],glInternalFormat:t[7],glBaseInternalFormat:t[8],pixelWidth:t[9],pixelHeight:t[10],pixelDepth:t[11],numberOfArrayElements:t[12],numberOfFaces:t[13],numberOfMipmapLevels:t[14],bytesOfKeyValueData:t[15]};if(i.pixelDepth>1||i.numberOfArrayElements!==0)return null;const s=XIe[i.glInternalFormat];if(s===void 0)return null;let n=16+i.bytesOfKeyValueData/4;const a=i.numberOfFaces>1,o=[];for(let l=0;l<(i.numberOfMipmapLevels||1);l++){const c=t[n++];a&&o.push([]);const u=a?o[l]:o;for(let h=0;h<(a?6:1);++h)u.push(qIe(s,e,n*4,c)),n+=c+3>>2}return{format:s,width:i.pixelWidth,height:i.pixelHeight,levels:o,cubemap:a}}}const KIe={KHR_DF_MODEL_UASTC:166};class ZIe extends dm{constructor(e,t){super(),this.maxRetries=0,this.device=t}load(e,t,i){be.fetchArrayBuffer(e.load,(s,n)=>{s?t(s,n):this.parse(n,e,t,i)},i,this.maxRetries)}open(e,t,i,s={}){const n=s.srgb?gE(t.format):t.format,a=new we(i,{name:e,addressU:t.cubemap?ge:zi,addressV:t.cubemap?ge:zi,width:t.width,height:t.height,format:n,cubemap:t.cubemap,levels:t.levels,...s});return a.upload(),a}parse(e,t,i,s){var d,f,p;const n=new cq(e),a=[n.readU32be(),n.readU32be(),n.readU32be()];if(a[0]!==2873840728||a[1]!==540160187||a[2]!==218765834)return null;const o={vkFormat:n.readU32(),typeSize:n.readU32(),pixelWidth:n.readU32(),pixelHeight:n.readU32(),pixelDepth:n.readU32(),layerCount:n.readU32(),faceCount:n.readU32(),levelCount:n.readU32(),supercompressionScheme:n.readU32()},l={dfdByteOffset:n.readU32(),dfdByteLength:n.readU32(),kvdByteOffset:n.readU32(),kvdByteLength:n.readU32(),sgdByteOffset:n.readU64(),sgdByteLength:n.readU64()},c=[];for(let m=0;m<Math.max(1,o.levelCount);++m)c.push({byteOffset:n.readU64(),byteLength:n.readU64(),uncompressedByteLength:n.readU64()});if(n.readU32()!==l.kvdByteOffset-l.dfdByteOffset)return null;n.skip(8);const h=n.readU8();n.skip(l.dfdByteLength-9),n.skip(l.kvdByteLength),o.supercompressionScheme===1||h===KIe.KHR_DF_MODEL_UASTC?VY(this.device,t.load,e,i,{isGGGR:(((p=(f=(d=s==null?void 0:s.file)==null?void 0:d.variants)==null?void 0:f.basis)==null?void 0:p.opt)&8)!==0,isKTX2:!0})||i(`Basis module not found. Asset [${s.name}](${s.getFileUrl()}) basis texture variant will not be loaded.`):i("unsupported KTX2 pixel format")}}class QIe extends dm{constructor(e){super(),this.maxRetries=0}load(e,t,i){be.fetchArrayBuffer(e.load,t,i,this.maxRetries)}open(e,t,i,s={}){const n=new Uint32Array(t,0,32),a=n[4],o=n[3],l=Math.max(n[7],1),c=n[20]===4,u=n[21],h=n[22],d=n[28]===65024,f=827611204,p=894720068,m=113,g=116,_=826496069,v=825438800,y=825504336,x=825439312,S=825504848;let w=!1,T=!1,A=!1,C=!1,P=null,I=1,M;if(c?u===f?(P=lE,w=!0):u===p?(P=fy,w=!0):u===m?(P=wi,I=2):u===g?(P=or,I=4):u===_?(P=hE,w=!0,T=!0):u===v||u===y?(P=u===v?py:my,w=!0,A=!0):(u===x||u===S)&&(P=u===x?dE:fE,w=!0,C=!0):h===32&&(P=ct),!P)return M=new we(i,{width:4,height:4,format:Ic,name:"dds-legacy-empty"}),M;M=new we(i,{name:e,addressU:d?ge:zi,addressV:d?ge:zi,width:a,height:o,format:P,cubemap:d,mipmaps:l>1,...s});let N=128;const k=d?6:1;let V;const B=4,R=4,L=u===f?8:16;let D,F,j;for(let z=0;z<k;z++){let $=a,H=o;for(let G=0;G<l;G++){w?T?V=Math.floor(($+3)/4)*Math.floor((H+3)/4)*8:A?V=Math.max($,16)*Math.max(H,8)/4:C?V=Math.max($,8)*Math.max(H,8)/2:(D=Math.floor(($+B-1)/B),F=Math.floor((H+R-1)/R),j=D*F,V=j*L):V=$*H*4;const Y=P===or?new Float32Array(t,N,V):P===wi?new Uint16Array(t,N,V):new Uint8Array(t,N,V);d?(M._levels[G]||(M._levels[G]=[]),M._levels[G][z]=Y):M._levels[G]=Y,N+=V*I,$=Math.max($*.5,1),H=Math.max(H*.5,1)}}return M.upload(),M}}class JIe extends dm{constructor(e){super(),this.maxRetries=0}load(e,t,i){be.fetchArrayBuffer(e.load,t,i,this.maxRetries),i.data&&!i.data.type&&(i.data.type=ub)}open(e,t,i,s={}){const n=this.parse(t);if(!n)return null;const a=new we(i,{name:e,addressU:zi,addressV:ge,minFilter:qe,magFilter:qe,width:n.width,height:n.height,levels:n.levels,format:ct,type:ub,mipmaps:!1,...s});return a.upload(),a}parse(e){const t=new cq(e);if(!t.readLine().startsWith("#?RADIANCE"))return null;const s={};for(;;){const c=t.readLine();if(c.length===0)break;{const u=c.split("=");u.length===2&&(s[u[0]]=u[1])}}if(!s.hasOwnProperty("FORMAT"))return null;const n=t.readLine().split(" ");if(n.length!==4)return null;const a=parseInt(n[1],10),o=parseInt(n[3],10),l=this._readPixels(t,o,a,n[0]==="-Y");return l?{width:o,height:a,levels:[l]}:null}_readPixels(e,t,i,s){if(t<8||t>32767)return this._readPixelsFlat(e,t,i);const n=[0,0,0,0];if(e.readArray(n),n[0]!==2||n[1]!==2||n[2]&128)return e.skip(-4),this._readPixelsFlat(e,t,i);const a=new ArrayBuffer(t*i*4),o=new Uint8Array(a);let l=s?0:t*4*(i-1),c,u,h,d,f,p;for(u=0;u<i;++u){if(u&&e.readArray(n),(n[2]<<8)+n[3]!==t)return null;for(d=0;d<4;++d)for(c=0;c<t;)if(f=e.readU8(),f>128){if(f-=128,c+f>t)return null;for(p=e.readU8(),h=0;h<f;++h)o[l+d+4*c++]=p}else{if(f===0||c+f>t)return null;for(h=0;h<f;++h)o[l+d+4*c++]=e.readU8()}l+=t*4*(s?1:-1)}return o}_readPixelsFlat(e,t,i){return e.remainingBytes===t*i*4?new Uint8Array(e.arraybuffer,e.offset):null}}const SV={repeat:zi,clamp:ge,mirror:CO},xV={nearest:qe,linear:_i,nearest_mip_nearest:rE,linear_mip_nearest:nE,nearest_mip_linear:sE,linear_mip_linear:lh},eMe={default:qa,rgbm:ch,rgbe:ub,rgbp:Z_,swizzleGGGR:t3},tMe=function(r){const e=zo.calcMipLevelsCount(r._width,r._height),t=function(s){return s instanceof HTMLCanvasElement||s instanceof HTMLImageElement||s instanceof HTMLVideoElement};if(!(r._format===ct||r._format===or)||r._volume||r._compressed||r._levels.length===1||r._levels.length===e||t(r._cubemap?r._levels[0][0]:r._levels[0]))return;const i=function(s,n,a){const o=Math.max(1,s>>1),l=Math.max(1,n>>1),c=new a.constructor(o*l*4),u=Math.floor(s/o),h=Math.floor(n/l),d=u*h;for(let f=0;f<l;++f)for(let p=0;p<o;++p)for(let m=0;m<4;++m){let g=0;for(let _=0;_<h;++_)for(let v=0;v<u;++v)g+=a[(p*u+v+(f*h+_)*s)*4+m];c[(p+f*o)*4+m]=g/d}return c};for(let s=r._levels.length;s<e;++s){const n=Math.max(1,r._width>>s-1),a=Math.max(1,r._height>>s-1);if(r._cubemap){const o=[];for(let l=0;l<6;++l)o.push(i(n,a,r._levels[s-1][l]));r._levels.push(o)}else r._levels.push(i(n,a,r._levels[s-1]))}r._levelsUpdated=r._cubemap?[[!0,!0,!0,!0,!0,!0]]:[!0]};class iMe extends Ot{constructor(e){super(e,"texture");const t=e.assets,i=e.graphicsDevice;this._device=i,this._assets=t,this.imgParser=new WIe(t,i),this.parsers={dds:new QIe(t),ktx:new YIe(t),ktx2:new ZIe(t,i),basis:new GIe(t,i),hdr:new JIe(t)}}set crossOrigin(e){this.imgParser.crossOrigin=e}get crossOrigin(){return this.imgParser.crossOrigin}set maxRetries(e){this.imgParser.maxRetries=e;for(const t in this.parsers)this.parsers.hasOwnProperty(t)&&(this.parsers[t].maxRetries=e)}get maxRetries(){return this.imgParser.maxRetries}_getUrlWithoutParams(e){return e.indexOf("?")>=0?e.split("?")[0]:e}_getParser(e){const t=Ne.getExtension(this._getUrlWithoutParams(e)).toLowerCase().replace(".","");return this.parsers[t]||this.imgParser}_getTextureOptions(e){var i;const t={};if(e){((i=e.name)==null?void 0:i.length)>0&&(t.name=e.name);const s=e.data;s.hasOwnProperty("minfilter")&&(t.minFilter=xV[s.minfilter]),s.hasOwnProperty("magfilter")&&(t.magFilter=xV[s.magfilter]),s.hasOwnProperty("addressu")&&(t.addressU=SV[s.addressu]),s.hasOwnProperty("addressv")&&(t.addressV=SV[s.addressv]),s.hasOwnProperty("mipmaps")&&(t.mipmaps=s.mipmaps),s.hasOwnProperty("anisotropy")&&(t.anisotropy=s.anisotropy),s.hasOwnProperty("flipY")&&(t.flipY=!!s.flipY),s.hasOwnProperty("srgb")&&(t.srgb=!!s.srgb),t.type=qa,s.hasOwnProperty("type")?t.type=eMe[s.type]:s.hasOwnProperty("rgbm")&&s.rgbm?t.type=ch:e.file&&e.file.opt&8&&(t.type=t3)}return t}load(e,t,i){typeof e=="string"&&(e={load:e,original:e}),this._getParser(e.original).load(e,t,i)}open(e,t,i){if(!e)return;const s=this._getTextureOptions(i);let n=this._getParser(e).open(e,t,this._device,s);return n===null?n=new we(this._device,{width:4,height:4,format:Ic}):(tMe(n),t.unswizzledGGGR&&(i.file.variants.basis.opt&=-9)),n}patch(e,t){const i=e.resource;if(!i)return;const s=this._getTextureOptions(e);for(const n of Object.keys(s))i[n]=s[n]}}const rMe="inline",sMe="immersive-vr",t_="immersive-ar",bV="viewer",nMe="left",aMe="cpu-optimized",jY="gpu-optimized",$Y="luminance-alpha",HY="unsigned-short",GY="float32";class oMe{constructor(e){this._supported=Ye.browser&&!!window.XRDOMOverlayState,this._root=null,this._manager=e}get supported(){return this._supported}get available(){return this._supported&&this._manager.active&&this._manager._session.domOverlayState!==null}get state(){return!this._supported||!this._manager.active||!this._manager._session.domOverlayState?null:this._manager._session.domOverlayState.type}set root(e){!this._supported||this._manager.active||(this._root=e)}get root(){return this._root}}const pS=[],wV=[],cT=class cT extends Te{constructor(e,t,i,s=null){super(),this.manager=e,this._xrHitTestSource=t,this._transient=i,this._inputSource=s}remove(){if(!this._xrHitTestSource)return;const e=this.manager.hitTest.sources,t=e.indexOf(this);t!==-1&&e.splice(t,1),this.onStop()}onStop(){this._xrHitTestSource.cancel(),this._xrHitTestSource=null,this.fire("remove"),this.manager.hitTest.fire("remove",this)}update(e){if(this._transient){const t=e.getHitTestResultsForTransientInput(this._xrHitTestSource);for(let i=0;i<t.length;i++){const s=t[i];if(!s.results.length)continue;let n;s.inputSource&&(n=this.manager.input._getByInputSource(s.inputSource)),this.updateHitResults(s.results,n)}}else{const t=e.getHitTestResults(this._xrHitTestSource);if(!t.length)return;this.updateHitResults(t)}}updateHitResults(e,t){if(this._inputSource&&this._inputSource!==t)return;const i=pS.pop()??new O;t?i.copy(t.getOrigin()):i.copy(this.manager.camera.getPosition());let s=1/0,n=null;const a=pS.pop()??new O,o=wV.pop()??new de;for(let l=0;l<e.length;l++){const c=e[l].getPose(this.manager._referenceSpace),u=i.distance(c.transform.position);u>=s||(s=u,n=e[l],a.copy(c.transform.position),o.copy(c.transform.orientation))}this.fire("result",a,o,t||this._inputSource,n),this.manager.hitTest.fire("result",this,a,o,t||this._inputSource,n),pS.push(i),pS.push(a),wV.push(o)}};cT.EVENT_REMOVE="remove",cT.EVENT_RESULT="result";let x2=cT;const zl=class zl extends Te{constructor(e){super(),this._supported=Ye.browser&&!!(window.XRSession&&window.XRSession.prototype.requestHitTestSource),this._available=!1,this._checkingAvailability=!1,this.sources=[],this.manager=e,this._supported&&(this.manager.on("start",this._onSessionStart,this),this.manager.on("end",this._onSessionEnd,this))}_onSessionStart(){if(this.manager.session.enabledFeatures){const e=this.manager.session.enabledFeatures.indexOf("hit-test")!==-1;if(!e)return;this._available=e,this.fire("available")}else this._checkingAvailability||(this._checkingAvailability=!0,this.manager.session.requestReferenceSpace(bV).then(e=>{this.manager.session.requestHitTestSource({space:e}).then(t=>{t.cancel(),this.manager.active&&(this._available=!0,this.fire("available"))}).catch(()=>{})}).catch(()=>{}))}_onSessionEnd(){if(this._available){this._available=!1;for(let e=0;e<this.sources.length;e++)this.sources[e].onStop();this.sources=[],this.fire("unavailable")}}start(e={}){var n,a;if(!this._supported){(n=e.callback)==null||n.call(e,new Error("XR HitTest is not supported"),null);return}if(!this._available){(a=e.callback)==null||a.call(e,new Error("XR HitTest is not available"),null);return}!e.profile&&!e.spaceType&&(e.spaceType=bV);let t;const i=e.offsetRay;if(i){const o=new DOMPoint(i.origin.x,i.origin.y,i.origin.z,1),l=new DOMPoint(i.direction.x,i.direction.y,i.direction.z,0);t=new XRRay(o,l)}const s=e.callback;e.spaceType?this.manager.session.requestReferenceSpace(e.spaceType).then(o=>{if(!this.manager.session){const l=new Error("XR Session is not started (2)");s&&s(l),this.fire("error",l);return}this.manager.session.requestHitTestSource({space:o,entityTypes:e.entityTypes||void 0,offsetRay:t}).then(l=>{this._onHitTestSource(l,!1,e.inputSource,s)}).catch(l=>{s&&s(l),this.fire("error",l)})}).catch(o=>{s&&s(o),this.fire("error",o)}):this.manager.session.requestHitTestSourceForTransientInput({profile:e.profile,entityTypes:e.entityTypes||void 0,offsetRay:t}).then(o=>{this._onHitTestSource(o,!0,e.inputSource,s)}).catch(o=>{s&&s(o),this.fire("error",o)})}_onHitTestSource(e,t,i,s){if(!this.manager.session){e.cancel();const a=new Error("XR Session is not started (3)");s&&s(a),this.fire("error",a);return}const n=new x2(this.manager,e,t,i??null);this.sources.push(n),s&&s(null,n),this.fire("add",n)}update(e){if(this._available)for(let t=0;t<this.sources.length;t++)this.sources[t].update(e)}get supported(){return this._supported}get available(){return this._available}};zl.EVENT_AVAILABLE="available",zl.EVENT_UNAVAILABLE="unavailable",zl.EVENT_ADD="add",zl.EVENT_REMOVE="remove",zl.EVENT_RESULT="result",zl.EVENT_ERROR="error";let b2=zl;const uT=class uT extends Te{constructor(e,t){super(),this._bitmap=null,this._measuredWidth=0,this._trackable=!1,this._tracking=!1,this._emulated=!1,this._pose=null,this._position=new O,this._rotation=new de,this._image=e,this._width=t}get image(){return this._image}set width(e){this._width=e}get width(){return this._width}get trackable(){return this._trackable}get tracking(){return this._tracking}get emulated(){return this._emulated}prepare(){return this._bitmap?{image:this._bitmap,widthInMeters:this._width}:createImageBitmap(this._image).then(e=>(this._bitmap=e,{image:this._bitmap,widthInMeters:this._width}))}destroy(){this._image=null,this._pose=null,this._bitmap&&(this._bitmap.close(),this._bitmap=null)}getPosition(){return this._pose&&this._position.copy(this._pose.transform.position),this._position}getRotation(){return this._pose&&this._rotation.copy(this._pose.transform.orientation),this._rotation}};uT.EVENT_TRACKED="tracked",uT.EVENT_UNTRACKED="untracked";let w2=uT;const bk=class bk extends Te{constructor(e){super(),this._supported=Ye.browser&&!!window.XRImageTrackingResult,this._available=!1,this._images=[],this._manager=e,this._supported&&(this._manager.on("start",this._onSessionStart,this),this._manager.on("end",this._onSessionEnd,this))}add(e,t){if(!this._supported||this._manager.active)return null;const i=new w2(e,t);return this._images.push(i),i}remove(e){if(this._manager.active)return;const t=this._images.indexOf(e);t!==-1&&(e.destroy(),this._images.splice(t,1))}_onSessionStart(){this._manager.session.getTrackedImageScores().then(e=>{this._available=!0;for(let t=0;t<e.length;t++)this._images[t]._trackable=e[t]==="trackable"}).catch(e=>{this._available=!1,this.fire("error",e)})}_onSessionEnd(){this._available=!1;for(let e=0;e<this._images.length;e++){const t=this._images[e];t._pose=null,t._measuredWidth=0,t._tracking&&(t._tracking=!1,t.fire("untracked"))}}prepareImages(e){this._images.length?Promise.all(this._images.map(t=>t.prepare())).then(t=>{e(null,t)}).catch(t=>{e(t,null)}):e(null,null)}update(e){if(!this._available)return;const t=e.getImageTrackingResults(),i={};for(let s=0;s<t.length;s++){i[t[s].index]=t[s];const n=this._images[t[s].index];n._emulated=t[s].trackingState==="emulated",n._measuredWidth=t[s].measuredWidthInMeters,n._pose=e.getPose(t[s].imageSpace,this._manager._referenceSpace)}for(let s=0;s<this._images.length;s++)this._images[s]._tracking&&!i[s]?(this._images[s]._tracking=!1,this._images[s].fire("untracked")):!this._images[s]._tracking&&i[s]&&(this._images[s]._tracking=!0,this._images[s].fire("tracked"))}get supported(){return this._supported}get available(){return this._available}get images(){return this._images}};bk.EVENT_ERROR="error";let T2=bk;class lMe{constructor(e,t){this._joints=[],this._tip=null,this._index=e,this._hand=t,this._hand._fingers.push(this)}get index(){return this._index}get hand(){return this._hand}get joints(){return this._joints}get tip(){return this._tip}}const TV=Ye.browser&&window.XRHand?["thumb-tip","index-finger-tip","middle-finger-tip","ring-finger-tip","pinky-finger-tip"]:[],WY={};for(let r=0;r<TV.length;r++)WY[TV[r]]=!0;class EV{constructor(e,t,i,s=null){this._radius=null,this._localTransform=new se,this._worldTransform=new se,this._localPosition=new O,this._localRotation=new de,this._position=new O,this._rotation=new de,this._dirtyLocal=!0,this._index=e,this._id=t,this._hand=i,this._finger=s,this._wrist=t==="wrist",this._tip=this._finger&&!!WY[t]}update(e){this._dirtyLocal=!0,this._radius=e.radius,this._localPosition.copy(e.transform.position),this._localRotation.copy(e.transform.orientation)}_updateTransforms(){this._dirtyLocal&&(this._dirtyLocal=!1,this._localTransform.setTRS(this._localPosition,this._localRotation,O.ONE));const t=this._hand._manager.camera.parent;t?this._worldTransform.mul2(t.getWorldTransform(),this._localTransform):this._worldTransform.copy(this._localTransform)}getPosition(){return this._updateTransforms(),this._worldTransform.getTranslation(this._position),this._position}getRotation(){return this._updateTransforms(),this._rotation.setFromMat4(this._worldTransform),this._rotation}get id(){return this._id}get index(){return this._index}get hand(){return this._hand}get finger(){return this._finger}get wrist(){return this._wrist}get tip(){return this._tip}get radius(){return this._radius||.005}}let gx=[];const Zc=new O,mS=new O,AV=new O;Ye.browser&&window.XRHand&&(gx=[["thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip"],["index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip"],["middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip"],["ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip"],["pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"]]);const hT=class hT extends Te{constructor(e){super(),this._tracking=!1,this._fingers=[],this._joints=[],this._jointsById={},this._tips=[],this._wrist=null;const t=e._xrInputSource.hand;if(this._manager=e._manager,this._inputSource=e,t.get("wrist")){const i=new EV(0,"wrist",this,null);this._wrist=i,this._joints.push(i),this._jointsById.wrist=i}for(let i=0;i<gx.length;i++){const s=new lMe(i,this);for(let n=0;n<gx[i].length;n++){const a=gx[i][n];if(!t.get(a))continue;const o=new EV(n,a,this,s);this._joints.push(o),this._jointsById[a]=o,o.tip&&(this._tips.push(o),s._tip=o),s._joints.push(o)}}}update(e){const t=this._inputSource._xrInputSource;for(let u=0;u<this._joints.length;u++){const h=this._joints[u],d=t.hand.get(h._id);if(d){let f;if(e.session.visibilityState!=="hidden"&&(f=e.getJointPose(d,this._manager._referenceSpace)),f)h.update(f),h.wrist&&!this._tracking&&(this._tracking=!0,this.fire("tracking"));else if(h.wrist){this._tracking&&(this._tracking=!1,this.fire("trackinglost"));break}}}const i=this._jointsById["thumb-metacarpal"],s=this._jointsById["thumb-tip"],n=this._jointsById["index-finger-phalanx-proximal"],a=this._jointsById["index-finger-tip"],o=this._jointsById["ring-finger-phalanx-proximal"],l=this._jointsById["pinky-finger-phalanx-proximal"];if(i&&s&&n&&a&&o&&l){this._inputSource._dirtyRay=!0,this._inputSource._rayLocal.origin.lerp(s._localPosition,a._localPosition,.5);let u=i,h=l;if(this._inputSource.handedness===nMe){const d=u;u=h,h=d}Zc.sub2(u._localPosition,this._wrist._localPosition),mS.sub2(h._localPosition,this._wrist._localPosition),AV.cross(Zc,mS).normalize(),Zc.lerp(n._localPosition,o._localPosition,.5),Zc.sub(this._wrist._localPosition).normalize(),this._inputSource._rayLocal.direction.lerp(AV,Zc,.5).normalize()}this._fingerIsClosed(1)&&this._fingerIsClosed(2)&&this._fingerIsClosed(3)&&this._fingerIsClosed(4)?this._inputSource._squeezing||(this._inputSource._squeezing=!0,this._inputSource.fire("squeezestart"),this._manager.input.fire("squeezestart",this._inputSource)):this._inputSource._squeezing&&(this._inputSource._squeezing=!1,this._inputSource.fire("squeeze"),this._manager.input.fire("squeeze",this._inputSource),this._inputSource.fire("squeezeend"),this._manager.input.fire("squeezeend",this._inputSource))}_fingerIsClosed(e){const t=this._fingers[e];return Zc.sub2(t.joints[0]._localPosition,t.joints[1]._localPosition).normalize(),mS.sub2(t.joints[2]._localPosition,t.joints[3]._localPosition).normalize(),Zc.dot(mS)<-.8}getJointById(e){return this._jointsById[e]||null}get fingers(){return this._fingers}get joints(){return this._joints}get tips(){return this._tips}get wrist(){return this._wrist}get tracking(){return this._tracking}};hT.EVENT_TRACKING="tracking",hT.EVENT_TRACKINGLOST="trackinglost";let E2=hT;const CV=new O,PV=new de;let cMe=0;const Ws=class Ws extends Te{constructor(e,t){super(),this._ray=new aM,this._rayLocal=new aM,this._grip=!1,this._hand=null,this._velocitiesAvailable=!1,this._velocitiesTimestamp=Qo(),this._localTransform=null,this._worldTransform=null,this._position=new O,this._rotation=new de,this._localPosition=null,this._localPositionLast=null,this._localRotation=null,this._linearVelocity=null,this._dirtyLocal=!0,this._dirtyRay=!1,this._selecting=!1,this._squeezing=!1,this._elementInput=!0,this._elementEntity=null,this._hitTestSources=[],this._id=++cMe,this._manager=e,this._xrInputSource=t,t.hand&&(this._hand=new E2(this))}get id(){return this._id}get inputSource(){return this._xrInputSource}get targetRayMode(){return this._xrInputSource.targetRayMode}get handedness(){return this._xrInputSource.handedness}get profiles(){return this._xrInputSource.profiles}get grip(){return this._grip}get hand(){return this._hand}get gamepad(){return this._xrInputSource.gamepad||null}get selecting(){return this._selecting}get squeezing(){return this._squeezing}set elementInput(e){this._elementInput!==e&&(this._elementInput=e,this._elementInput||(this._elementEntity=null))}get elementInput(){return this._elementInput}get elementEntity(){return this._elementEntity}get hitTestSources(){return this._hitTestSources}update(e){if(this._hand)this._hand.update(e);else{const t=this._xrInputSource.gripSpace;if(t){const s=e.getPose(t,this._manager._referenceSpace);if(s){this._grip||(this._grip=!0,this._localTransform=new se,this._worldTransform=new se,this._localPositionLast=new O,this._localPosition=new O,this._localRotation=new de,this._linearVelocity=new O);const n=Qo(),a=(n-this._velocitiesTimestamp)/1e3;this._velocitiesTimestamp=n,this._dirtyLocal=!0,this._localPositionLast.copy(this._localPosition),this._localPosition.copy(s.transform.position),this._localRotation.copy(s.transform.orientation),this._velocitiesAvailable=!0,this._manager.input.velocitiesSupported&&s.linearVelocity?this._linearVelocity.copy(s.linearVelocity):a>0&&(CV.sub2(this._localPosition,this._localPositionLast).divScalar(a),this._linearVelocity.lerp(this._linearVelocity,CV,.15))}else this._velocitiesAvailable=!1}const i=e.getPose(this._xrInputSource.targetRaySpace,this._manager._referenceSpace);i&&(this._dirtyRay=!0,this._rayLocal.origin.copy(i.transform.position),this._rayLocal.direction.set(0,0,-1),PV.copy(i.transform.orientation),PV.transformVector(this._rayLocal.direction,this._rayLocal.direction))}}_updateTransforms(){this._dirtyLocal&&(this._dirtyLocal=!1,this._localTransform.setTRS(this._localPosition,this._localRotation,O.ONE));const e=this._manager.camera.parent;e?this._worldTransform.mul2(e.getWorldTransform(),this._localTransform):this._worldTransform.copy(this._localTransform)}_updateRayTransforms(){const e=this._dirtyRay;if(this._dirtyRay=!1,this._manager.camera.parent){const i=this._manager.camera.parent.getWorldTransform();i.getTranslation(this._position),this._rotation.setFromMat4(i),this._rotation.transformVector(this._rayLocal.origin,this._ray.origin),this._ray.origin.add(this._position),this._rotation.transformVector(this._rayLocal.direction,this._ray.direction)}else e&&(this._ray.origin.copy(this._rayLocal.origin),this._ray.direction.copy(this._rayLocal.direction))}getPosition(){return this._position?(this._updateTransforms(),this._worldTransform.getTranslation(this._position),this._position):null}getLocalPosition(){return this._localPosition}getRotation(){return this._rotation?(this._updateTransforms(),this._rotation.setFromMat4(this._worldTransform),this._rotation):null}getLocalRotation(){return this._localRotation}getLinearVelocity(){return this._velocitiesAvailable?this._linearVelocity:null}getOrigin(){return this._updateRayTransforms(),this._ray.origin}getDirection(){return this._updateRayTransforms(),this._ray.direction}hitTestStart(e={}){e.inputSource=this,e.profile=this._xrInputSource.profiles[0];const t=e.callback;e.callback=(i,s)=>{s&&this.onHitTestSourceAdd(s),t&&t(i,s)},this._manager.hitTest.start(e)}onHitTestSourceAdd(e){this._hitTestSources.push(e),this.fire("hittest:add",e),e.on("result",(t,i,s,n)=>{s===this&&this.fire("hittest:result",e,t,i,n)}),e.once("remove",()=>{this.onHitTestSourceRemove(e),this.fire("hittest:remove",e)})}onHitTestSourceRemove(e){const t=this._hitTestSources.indexOf(e);t!==-1&&this._hitTestSources.splice(t,1)}};Ws.EVENT_REMOVE="remove",Ws.EVENT_SELECT="select",Ws.EVENT_SELECTSTART="selectstart",Ws.EVENT_SELECTEND="selectend",Ws.EVENT_SQUEEZE="squeeze",Ws.EVENT_SQUEEZESTART="squeezestart",Ws.EVENT_SQUEEZEEND="squeezeend",Ws.EVENT_HITTESTADD="hittest:add",Ws.EVENT_HITTESTREMOVE="hittest:remove",Ws.EVENT_HITTESTRESULT="hittest:result";let A2=Ws;const ga=class ga extends Te{constructor(e){var t,i;super(),this._inputSources=[],this.velocitiesSupported=!1,this.manager=e,this.velocitiesSupported=!!(Ye.browser&&((i=(t=window.XRPose)==null?void 0:t.prototype)!=null&&i.hasOwnProperty("linearVelocity"))),this._onInputSourcesChangeEvt=s=>{this._onInputSourcesChange(s)},this.manager.on("start",this._onSessionStart,this),this.manager.on("end",this._onSessionEnd,this)}_onSessionStart(){const e=this.manager.session;e.addEventListener("inputsourceschange",this._onInputSourcesChangeEvt),e.addEventListener("select",i=>{const s=this._getByInputSource(i.inputSource);s.update(i.frame),s.fire("select",i),this.fire("select",s,i)}),e.addEventListener("selectstart",i=>{const s=this._getByInputSource(i.inputSource);s.update(i.frame),s._selecting=!0,s.fire("selectstart",i),this.fire("selectstart",s,i)}),e.addEventListener("selectend",i=>{const s=this._getByInputSource(i.inputSource);s.update(i.frame),s._selecting=!1,s.fire("selectend",i),this.fire("selectend",s,i)}),e.addEventListener("squeeze",i=>{const s=this._getByInputSource(i.inputSource);s.update(i.frame),s.fire("squeeze",i),this.fire("squeeze",s,i)}),e.addEventListener("squeezestart",i=>{const s=this._getByInputSource(i.inputSource);s.update(i.frame),s._squeezing=!0,s.fire("squeezestart",i),this.fire("squeezestart",s,i)}),e.addEventListener("squeezeend",i=>{const s=this._getByInputSource(i.inputSource);s.update(i.frame),s._squeezing=!1,s.fire("squeezeend",i),this.fire("squeezeend",s,i)});const t=e.inputSources;for(let i=0;i<t.length;i++)this._addInputSource(t[i])}_onSessionEnd(){let e=this._inputSources.length;for(;e--;){const i=this._inputSources[e];this._inputSources.splice(e,1),i.fire("remove"),this.fire("remove",i)}this.manager.session.removeEventListener("inputsourceschange",this._onInputSourcesChangeEvt)}_onInputSourcesChange(e){for(let t=0;t<e.removed.length;t++)this._removeInputSource(e.removed[t]);for(let t=0;t<e.added.length;t++)this._addInputSource(e.added[t])}_getByInputSource(e){for(let t=0;t<this._inputSources.length;t++)if(this._inputSources[t].inputSource===e)return this._inputSources[t];return null}_addInputSource(e){if(this._getByInputSource(e))return;const t=new A2(this.manager,e);this._inputSources.push(t),this.fire("add",t)}_removeInputSource(e){for(let t=0;t<this._inputSources.length;t++){if(this._inputSources[t].inputSource!==e)continue;const i=this._inputSources[t];this._inputSources.splice(t,1);let s=i.hitTestSources.length;for(;s--;)i.hitTestSources[s].remove();i.fire("remove"),this.fire("remove",i);return}}update(e){for(let t=0;t<this._inputSources.length;t++)this._inputSources[t].update(e)}get inputSources(){return this._inputSources}};ga.EVENT_ADD="add",ga.EVENT_REMOVE="remove",ga.EVENT_SELECT="select",ga.EVENT_SELECTSTART="selectstart",ga.EVENT_SELECTEND="selectend",ga.EVENT_SQUEEZE="squeeze",ga.EVENT_SQUEEZESTART="squeezestart",ga.EVENT_SQUEEZEEND="squeezeend";let C2=ga;const bd=new O,IV=new O,KC=new se,MV=new se,dT=class dT extends Te{constructor(e){super(),this._supported=!1,this._available=!1,this._lightProbeRequested=!1,this._lightProbe=null,this._intensity=0,this._rotation=new de,this._color=new ae,this._sphericalHarmonics=new Float32Array(27),this._manager=e,this._manager.on("start",this._onSessionStart,this),this._manager.on("end",this._onSessionEnd,this)}_onSessionStart(){this._manager.session.requestLightProbe&&(this._supported=!0)}_onSessionEnd(){this._supported=!1,this._available=!1,this._lightProbeRequested=!1,this._lightProbe=null}start(){let e;if(this._manager.session||(e=new Error("XR session is not running")),!e&&this._manager.type!==t_&&(e=new Error("XR session type is not AR")),!e&&!this._supported&&(e=new Error("light-estimation is not supported")),(!e&&this._lightProbe||this._lightProbeRequested)&&(e=new Error("light estimation is already requested")),e){this.fire("error",e);return}this._lightProbeRequested=!0,this._manager.session.requestLightProbe().then(t=>{const i=this._lightProbeRequested;this._lightProbeRequested=!1,this._manager.active?i&&(this._lightProbe=t):this.fire("error",new Error("XR session is not active"))}).catch(t=>{this._lightProbeRequested=!1,this.fire("error",t)})}end(){this._lightProbeRequested=!1,this._lightProbe=null,this._available=!1}update(e){if(!this._lightProbe)return;const t=e.getLightEstimate(this._lightProbe);if(!t)return;this._available||(this._available=!0,this.fire("available"));const i=t.primaryLightIntensity;this._intensity=Math.max(1,Math.max(i.x,Math.max(i.y,i.z))),bd.copy(i).mulScalar(1/this._intensity),this._color.set(bd.x,bd.y,bd.z),bd.set(0,0,0),IV.copy(t.primaryLightDirection),KC.setLookAt(IV,bd,O.UP),MV.setFromAxisAngle(O.RIGHT,90),KC.mul(MV),this._rotation.setFromMat4(KC),this._sphericalHarmonics.set(t.sphericalHarmonicsCoefficients)}get supported(){return this._supported}get available(){return this._available}get intensity(){return this._available?this._intensity:null}get color(){return this._available?this._color:null}get rotation(){return this._available?this._rotation:null}get sphericalHarmonics(){return this._available?this._sphericalHarmonics:null}};dT.EVENT_AVAILABLE="available",dT.EVENT_ERROR="error";let P2=dT,uMe=0;const fT=class fT extends Te{constructor(e,t){super(),this._position=new O,this._rotation=new de,this._id=++uMe,this._planeDetection=e,this._xrPlane=t,this._lastChangedTime=t.lastChangedTime,this._orientation=t.orientation}destroy(){this._xrPlane&&(this._xrPlane=null,this.fire("remove"))}update(e){const t=this._planeDetection._manager,i=e.getPose(this._xrPlane.planeSpace,t._referenceSpace);i&&(this._position.copy(i.transform.position),this._rotation.copy(i.transform.orientation)),this._lastChangedTime!==this._xrPlane.lastChangedTime&&(this._lastChangedTime=this._xrPlane.lastChangedTime,this.fire("change"))}getPosition(){return this._position}getRotation(){return this._rotation}get id(){return this._id}get orientation(){return this._orientation}get points(){return this._xrPlane.polygon}get label(){return this._xrPlane.semanticLabel||""}};fT.EVENT_REMOVE="remove",fT.EVENT_CHANGE="change";let I2=fT;const ff=class ff extends Te{constructor(e){super(),this._supported=Ye.browser&&!!window.XRPlane,this._available=!1,this._planesIndex=new Map,this._planes=[],this._manager=e,this._supported&&(this._manager.on("start",this._onSessionStart,this),this._manager.on("end",this._onSessionEnd,this))}_onSessionStart(){this._manager.session.enabledFeatures&&this._manager.session.enabledFeatures.indexOf("plane-detection")!==-1&&(this._available=!0,this.fire("available"))}_onSessionEnd(){for(let e=0;e<this._planes.length;e++)this._planes[e].destroy(),this.fire("remove",this._planes[e]);this._planesIndex.clear(),this._planes.length=0,this._available&&(this._available=!1,this.fire("unavailable"))}update(e){if(!this._available)if(!this._manager.session.enabledFeatures&&e.detectedPlanes.size)this._available=!0,this.fire("available");else return;const t=e.detectedPlanes;for(const[i,s]of this._planesIndex)t.has(i)||(this._planesIndex.delete(i),this._planes.splice(this._planes.indexOf(s),1),s.destroy(),this.fire("remove",s));for(const i of t){let s=this._planesIndex.get(i);s?s.update(e):(s=new I2(this,i),this._planesIndex.set(i,s),this._planes.push(s),s.update(e),this.fire("add",s))}}get supported(){return this._supported}get available(){return this._available}get planes(){return this._planes}};ff.EVENT_AVAILABLE="available",ff.EVENT_UNAVAILABLE="unavailable",ff.EVENT_ADD="add",ff.EVENT_REMOVE="remove";let M2=ff;const pf=class pf extends Te{constructor(e,t,i=null){super(),this._position=new O,this._rotation=new de,this._uuid=null,this._uuidRequests=null,this._anchors=e,this._xrAnchor=t,this._uuid=i}destroy(){if(!this._xrAnchor)return;const e=this._xrAnchor;this._xrAnchor.delete(),this._xrAnchor=null,this.fire("destroy",e,this)}update(e){if(!this._xrAnchor)return;const t=e.getPose(this._xrAnchor.anchorSpace,this._anchors.manager._referenceSpace);if(t){if(this._position.equals(t.transform.position)&&this._rotation.equals(t.transform.orientation))return;this._position.copy(t.transform.position),this._rotation.copy(t.transform.orientation),this.fire("change")}}getPosition(){return this._position}getRotation(){return this._rotation}persist(e){if(!this._anchors.persistence){e==null||e(new Error("Persistent Anchors are not supported"),null);return}if(this._uuid){e==null||e(null,this._uuid);return}if(this._uuidRequests){e&&this._uuidRequests.push(e);return}this._uuidRequests=[],this._xrAnchor.requestPersistentHandle().then(t=>{this._uuid=t,this._anchors._indexByUuid.set(this._uuid,this),e==null||e(null,t);for(const i of this._uuidRequests)i(null,t);this._uuidRequests=null,this.fire("persist",t)}).catch(t=>{e==null||e(t,null);for(const i of this._uuidRequests)i(t,null);this._uuidRequests=null})}forget(e){if(!this._uuid){e==null||e(new Error("Anchor is not persistent"));return}this._anchors.forget(this._uuid,t=>{this._uuid=null,e==null||e(t),this.fire("forget")})}get uuid(){return this._uuid}get persistent(){return!!this._uuid}};pf.EVENT_DESTROY="destroy",pf.EVENT_CHANGE="change",pf.EVENT_PERSIST="persist",pf.EVENT_FORGET="forget";let R2=pf;const Su=class Su extends Te{constructor(e){var t;super(),this._supported=Ye.browser&&!!window.XRAnchor,this._available=!1,this._checkingAvailability=!1,this._persistence=Ye.browser&&!!((t=window==null?void 0:window.XRSession)!=null&&t.prototype.restorePersistentAnchor),this._creationQueue=[],this._index=new Map,this._indexByUuid=new Map,this._list=[],this._callbacksAnchors=new Map,this.manager=e,this._supported&&(this.manager.on("start",this._onSessionStart,this),this.manager.on("end",this._onSessionEnd,this))}_onSessionStart(){var t;const e=((t=this.manager.session.enabledFeatures)==null?void 0:t.indexOf("anchors"))>=0;e&&(this._available=e,this.fire("available"))}_onSessionEnd(){if(!this._available)return;this._available=!1;for(let t=0;t<this._creationQueue.length;t++)this._creationQueue[t].callback&&this._creationQueue[t].callback(new Error("session ended"),null);this._creationQueue.length=0,this._index.clear(),this._indexByUuid.clear();let e=this._list.length;for(;e--;)this._list[e].destroy();this._list.length=0,this.fire("unavailable")}_createAnchor(e,t=null){const i=new R2(this,e,t);return this._index.set(e,i),t&&this._indexByUuid.set(t,i),this._list.push(i),i.once("destroy",this._onAnchorDestroy,this),i}_onAnchorDestroy(e,t){this._index.delete(e),t.uuid&&this._indexByUuid.delete(t.uuid);const i=this._list.indexOf(t);i!==-1&&this._list.splice(i,1),this.fire("destroy",t)}create(e,t,i){if(!this._available){i==null||i(new Error("Anchors API is not available"),null);return}if(window.XRHitTestResult&&e instanceof XRHitTestResult){const s=e;if(i=t,!this._supported){i==null||i(new Error("Anchors API is not supported"),null);return}if(!s.createAnchor){i==null||i(new Error("Creating Anchor from Hit Test is not supported"),null);return}s.createAnchor().then(n=>{const a=this._createAnchor(n);i==null||i(null,a),this.fire("add",a)}).catch(n=>{i==null||i(n,null),this.fire("error",n)})}else this._creationQueue.push({transform:new XRRigidTransform(e,t),callback:i})}restore(e,t){if(!this._available){t==null||t(new Error("Anchors API is not available"),null);return}if(!this._persistence){t==null||t(new Error("Anchor Persistence is not supported"),null);return}if(!this.manager.active){t==null||t(new Error("WebXR session is not active"),null);return}this.manager.session.restorePersistentAnchor(e).then(i=>{const s=this._createAnchor(i,e);t==null||t(null,s),this.fire("add",s)}).catch(i=>{t==null||t(i,null),this.fire("error",i)})}forget(e,t){if(!this._available){t==null||t(new Error("Anchors API is not available"));return}if(!this._persistence){t==null||t(new Error("Anchor Persistence is not supported"));return}if(!this.manager.active){t==null||t(new Error("WebXR session is not active"));return}this.manager.session.deletePersistentAnchor(e).then(()=>{t==null||t(null)}).catch(i=>{t==null||t(i),this.fire("error",i)})}update(e){if(!this._available){!this.manager.session.enabledFeatures&&!this._checkingAvailability&&(this._checkingAvailability=!0,e.createAnchor(new XRRigidTransform,this.manager._referenceSpace).then(t=>{t.delete(),this.manager.active&&(this._available=!0,this.fire("available"))}).catch(()=>{}));return}if(this._creationQueue.length){for(let t=0;t<this._creationQueue.length;t++){const i=this._creationQueue[t];e.createAnchor(i.transform,this.manager._referenceSpace).then(s=>{i.callback&&this._callbacksAnchors.set(s,i.callback)}).catch(s=>{i.callback&&i.callback(s,null),this.fire("error",s)})}this._creationQueue.length=0}for(const[t,i]of this._index)e.trackedAnchors.has(t)||(this._index.delete(t),i.destroy());for(let t=0;t<this._list.length;t++)this._list[t].update(e);for(const t of e.trackedAnchors){if(this._index.has(t))continue;try{const n=t.anchorSpace}catch{continue}const i=this._createAnchor(t);i.update(e);const s=this._callbacksAnchors.get(t);s&&(this._callbacksAnchors.delete(t),s(null,i)),this.fire("add",i)}}get supported(){return this._supported}get available(){return this._available}get persistence(){return this._persistence}get uuids(){return!this._available||!this._persistence||!this.manager.active?null:this.manager.session.persistentAnchors}get list(){return this._list}};Su.EVENT_AVAILABLE="available",Su.EVENT_UNAVAILABLE="unavailable",Su.EVENT_ERROR="error",Su.EVENT_ADD="add",Su.EVENT_DESTROY="destroy";let D2=Su;const pT=class pT extends Te{constructor(e,t){super(),this._lastChanged=0,this._position=new O,this._rotation=new de,this._meshDetection=e,this._xrMesh=t,this._lastChanged=this._xrMesh.lastChangedTime}get xrMesh(){return this._xrMesh}get label(){return this._xrMesh.semanticLabel||""}get vertices(){return this._xrMesh.vertices}get indices(){return this._xrMesh.indices}destroy(){this._xrMesh&&(this._xrMesh=null,this.fire("remove"))}update(e){const t=this._meshDetection._manager,i=e.getPose(this._xrMesh.meshSpace,t._referenceSpace);i&&(this._position.copy(i.transform.position),this._rotation.copy(i.transform.orientation)),this._lastChanged!==this._xrMesh.lastChangedTime&&(this._lastChanged=this._xrMesh.lastChangedTime,this.fire("change"))}getPosition(){return this._position}getRotation(){return this._rotation}};pT.EVENT_REMOVE="remove",pT.EVENT_CHANGE="change";let L2=pT;const mf=class mf extends Te{constructor(e){super(),this._supported=Ye.browser&&!!window.XRMesh,this._available=!1,this._index=new Map,this._list=[],this._manager=e,this._supported&&(this._manager.on("start",this._onSessionStart,this),this._manager.on("end",this._onSessionEnd,this))}update(e){if(!this._available)if(!this._manager.session.enabledFeatures&&e.detectedMeshes.size)this._available=!0,this.fire("available");else return;for(const t of e.detectedMeshes){let i=this._index.get(t);i?i.update(e):(i=new L2(this,t),this._index.set(t,i),this._list.push(i),i.update(e),this.fire("add",i))}for(const t of this._index.values())e.detectedMeshes.has(t.xrMesh)||this._removeMesh(t)}_removeMesh(e){this._index.delete(e.xrMesh),this._list.splice(this._list.indexOf(e),1),e.destroy(),this.fire("remove",e)}_onSessionStart(){if(this._manager.session.enabledFeatures){const e=this._manager.session.enabledFeatures.indexOf("mesh-detection")!==-1;if(!e)return;this._available=e,this.fire("available")}}_onSessionEnd(){if(this._available){this._available=!1;for(const e of this._index.values())this._removeMesh(e);this.fire("unavailable")}}get supported(){return this._supported}get available(){return this._available}get meshes(){return this._list}};mf.EVENT_AVAILABLE="available",mf.EVENT_UNAVAILABLE="unavailable",mf.EVENT_ADD="add",mf.EVENT_REMOVE="remove";let O2=mf;const wk=class wk extends Te{constructor(e,t,i){super(),this._positionData=new Float32Array(3),this._viewport=new ce,this._projMat=new se,this._projViewOffMat=new se,this._viewMat=new se,this._viewOffMat=new se,this._viewMat3=new Ba,this._viewInvMat=new se,this._viewInvOffMat=new se,this._xrCamera=null,this._textureColor=null,this._textureDepth=null,this._depthInfo=null,this._emptyDepthBuffer=new Uint8Array(32),this._depthMatrix=new se,this._manager=e,this._xrView=t;const s=this._manager.app.graphicsDevice;if(this._manager.views.supportedColor&&(this._xrCamera=this._xrView.camera,this._manager.views.availableColor&&this._xrCamera&&(this._textureColor=new we(s,{format:Ic,mipmaps:!1,addressU:ge,addressV:ge,minFilter:_i,magFilter:_i,width:this._xrCamera.width,height:this._xrCamera.height,name:`XrView-${this._xrView.eye}-Color`}))),this._manager.views.supportedDepth&&this._manager.views.availableDepth){const n=this._manager.views.depthGpuOptimized?qe:_i;this._textureDepth=new we(s,{format:this._manager.views.depthPixelFormat,arrayLength:i===1?0:i,mipmaps:!1,addressU:ge,addressV:ge,minFilter:n,magFilter:n,width:4,height:4,name:`XrView-${this._xrView.eye}-Depth`});for(let a=0;a<this._textureDepth._levels.length;a++)this._textureDepth._levels[a]=this._emptyDepthBuffer;this._textureDepth.upload()}(this._textureColor||this._textureDepth)&&s.on("devicelost",this._onDeviceLost,this)}get textureColor(){return this._textureColor}get textureDepth(){return this._textureDepth}get depthUvMatrix(){return this._depthMatrix}get depthValueToMeters(){var e;return((e=this._depthInfo)==null?void 0:e.rawValueToMeters)||0}get eye(){return this._xrView.eye}get viewport(){return this._viewport}get projMat(){return this._projMat}get projViewOffMat(){return this._projViewOffMat}get viewOffMat(){return this._viewOffMat}get viewInvOffMat(){return this._viewInvOffMat}get viewMat3(){return this._viewMat3}get positionData(){return this._positionData}update(e,t){this._xrView=t,this._manager.views.availableColor&&(this._xrCamera=this._xrView.camera);const s=e.session.renderState.baseLayer.getViewport(this._xrView);this._viewport.x=s.x,this._viewport.y=s.y,this._viewport.z=s.width,this._viewport.w=s.height,this._projMat.set(this._xrView.projectionMatrix),this._viewMat.set(this._xrView.transform.inverse.matrix),this._viewInvMat.set(this._xrView.transform.matrix),this._updateTextureColor(),this._updateDepth(e)}_updateTextureColor(){if(!this._manager.views.availableColor||!this._xrCamera||!this._textureColor)return;const e=this._manager.webglBinding;if(!e)return;const t=e.getCameraImage(this._xrCamera);if(!t)return;const i=this._manager.app.graphicsDevice,s=i.gl;if(!this._frameBufferSource)this._frameBufferSource=s.createFramebuffer(),this._frameBuffer=s.createFramebuffer();else{const n=s.COLOR_ATTACHMENT0,a=this._xrCamera.width,o=this._xrCamera.height;i.setFramebuffer(this._frameBufferSource),s.framebufferTexture2D(s.FRAMEBUFFER,n,s.TEXTURE_2D,t,0),i.setFramebuffer(this._frameBuffer),s.framebufferTexture2D(s.FRAMEBUFFER,n,s.TEXTURE_2D,this._textureColor.impl._glTexture,0),s.bindFramebuffer(s.READ_FRAMEBUFFER,this._frameBufferSource),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,this._frameBuffer),s.blitFramebuffer(0,o,a,0,0,0,a,o,s.COLOR_BUFFER_BIT,s.NEAREST)}}_updateDepth(e){var c,u;if(!this._manager.views.availableDepth||!this._textureDepth)return;const t=this._manager.views.depthGpuOptimized,i=t?this._manager.webglBinding:e;if(!i){this._depthInfo=null;return}const s=i.getDepthInformation(this._xrView);if(!s){this._depthInfo=null;return}let n=!this._depthInfo!=!s;this._depthInfo=s;const a=((c=this._depthInfo)==null?void 0:c.width)||4,o=((u=this._depthInfo)==null?void 0:u.height)||4;let l=!1;if((this._textureDepth.width!==a||this._textureDepth.height!==o)&&(this._textureDepth._width=a,this._textureDepth._height=o,n=!0,l=!0),n&&(this._depthInfo?this._depthMatrix.data.set(this._depthInfo.normDepthBufferFromNormView.matrix):this._depthMatrix.setIdentity()),this._depthInfo)if(t){if(this._depthInfo.texture){const h=this._manager.app.graphicsDevice.gl;switch(this._textureDepth.impl._glTexture=this._depthInfo.texture,this._depthInfo.textureType==="texture-array"?this._textureDepth.impl._glTarget=h.TEXTURE_2D_ARRAY:this._textureDepth.impl._glTarget=h.TEXTURE_2D,this._manager.views.depthPixelFormat){case sl:this._textureDepth.impl._glInternalFormat=h.R32F,this._textureDepth.impl._glPixelType=h.FLOAT,this._textureDepth.impl._glFormat=h.RED;break;case Bo:this._textureDepth.impl._glInternalFormat=h.DEPTH_COMPONENT16,this._textureDepth.impl._glPixelType=h.UNSIGNED_SHORT,this._textureDepth.impl._glFormat=h.DEPTH_COMPONENT;break}this._textureDepth.impl._glCreated=!0}}else this._textureDepth._levels[0]=new Uint8Array(this._depthInfo.data),this._textureDepth.upload();else this._textureDepth._levels[0]=this._emptyDepthBuffer,this._textureDepth.upload();l&&this.fire("depth:resize",a,o)}updateTransforms(e){e?(this._viewInvOffMat.mul2(e,this._viewInvMat),this.viewOffMat.copy(this._viewInvOffMat).invert()):(this._viewInvOffMat.copy(this._viewInvMat),this.viewOffMat.copy(this._viewMat)),this._viewMat3.setFromMat4(this._viewOffMat),this._projViewOffMat.mul2(this._projMat,this._viewOffMat),this._positionData[0]=this._viewInvOffMat.data[12],this._positionData[1]=this._viewInvOffMat.data[13],this._positionData[2]=this._viewInvOffMat.data[14]}_onDeviceLost(){this._frameBufferSource=null,this._frameBuffer=null,this._depthInfo=null}getDepth(e,t){var i;return this._manager.views.depthGpuOptimized?null:((i=this._depthInfo)==null?void 0:i.getDepthInMeters(e,t))??null}destroy(){if(this._depthInfo=null,this._textureColor&&(this._textureColor.destroy(),this._textureColor=null),this._textureDepth&&(this._textureDepth.destroy(),this._textureDepth=null),this._frameBufferSource){const e=this._manager.app.graphicsDevice.gl;e.deleteFramebuffer(this._frameBufferSource),this._frameBufferSource=null,e.deleteFramebuffer(this._frameBuffer),this._frameBuffer=null}}};wk.EVENT_DEPTHRESIZE="depth:resize";let N2=wk;const mT=class mT extends Te{constructor(e){super(),this._index=new Map,this._indexTmp=new Map,this._list=[],this._supportedColor=Ye.browser&&!!window.XRCamera&&!!window.XRWebGLBinding,this._supportedDepth=Ye.browser&&!!window.XRDepthInformation,this._availableColor=!1,this._availableDepth=!1,this._depthUsage="",this._depthFormat="",this._depthFormats={[$Y]:RO,[HY]:Bo,[GY]:sl},this._manager=e,this._manager.on("start",this._onSessionStart,this),this._manager.on("end",this._onSessionEnd,this)}get list(){return this._list}get supportedColor(){return this._supportedColor}get supportedDepth(){return this._supportedDepth}get availableColor(){return this._availableColor}get availableDepth(){return this._availableDepth}get depthUsage(){return this._depthUsage}get depthGpuOptimized(){return this._depthUsage===jY}get depthFormat(){return this._depthFormat}get depthPixelFormat(){return this._depthFormats[this._depthFormat]??null}update(e,t){for(let i=0;i<t.length;i++)this._indexTmp.set(t[i].eye,t[i]);for(const[i,s]of this._indexTmp){let n=this._index.get(i);n?n.update(e,s):(n=new N2(this._manager,s,t.length),this._index.set(i,n),this._list.push(n),n.update(e,s),this.fire("add",n))}for(const[i,s]of this._index){if(this._indexTmp.has(i))continue;s.destroy(),this._index.delete(i);const n=this._list.indexOf(s);n!==-1&&this._list.splice(n,1),this.fire("remove",s)}this._indexTmp.clear()}get(e){return this._index.get(e)||null}_onSessionStart(){if(this._manager.type===t_&&this._manager.session.enabledFeatures&&(this._availableColor=this._manager.session.enabledFeatures.indexOf("camera-access")!==-1,this._availableDepth=this._manager.session.enabledFeatures.indexOf("depth-sensing")!==-1,this._availableDepth)){const e=this._manager.session;this._depthUsage=e.depthUsage,this._depthFormat=e.depthDataFormat}}_onSessionEnd(){for(const e of this._index.values())e.destroy();this._index.clear(),this._availableColor=!1,this._availableDepth=!1,this._depthUsage="",this._depthFormat="",this._list.length=0}};mT.EVENT_ADD="add",mT.EVENT_REMOVE="remove";let jb=mT;const xu=class xu extends Te{constructor(e){super(),this._supported=Ye.browser&&!!navigator.xr,this._available={},this._type=null,this._spaceType=null,this._session=null,this._baseLayer=null,this.webglBinding=null,this._referenceSpace=null,this._camera=null,this._localPosition=new O,this._localRotation=new de,this._depthNear=.1,this._depthFar=1e3,this._supportedFrameRates=null,this._width=0,this._height=0,this._framebufferScaleFactor=1,this.app=e,this._available[rMe]=!1,this._available[sMe]=!1,this._available[t_]=!1,this.views=new jb(this),this.domOverlay=new oMe(this),this.hitTest=new b2(this),this.imageTracking=new T2(this),this.planeDetection=new M2(this),this.meshDetection=new O2(this),this.input=new C2(this),this.lightEstimation=new P2(this),this.anchors=new D2(this),this.views=new jb(this),this._supported&&(navigator.xr.addEventListener("devicechange",()=>{this._deviceAvailabilityCheck()}),this._deviceAvailabilityCheck(),this.app.graphicsDevice.on("devicelost",this._onDeviceLost,this),this.app.graphicsDevice.on("devicerestored",this._onDeviceRestored,this))}destroy(){}start(e,t,i,s){let n=s;if(typeof s=="object"&&(n=s.callback),!this._available[t]){n&&n(new Error("XR is not available"));return}if(this._session){n&&n(new Error("XR session is already started"));return}this._camera=e,this._camera.camera.xr=this,this._type=t,this._spaceType=i,this._framebufferScaleFactor=(s==null?void 0:s.framebufferScaleFactor)??1,this._setClipPlanes(e.nearClip,e.farClip);const a={requiredFeatures:[i],optionalFeatures:[]},o=this.app.graphicsDevice;o!=null&&o.isWebGPU&&a.requiredFeatures.push("webgpu");const l=o==null?void 0:o.isWebGL2;if(t===t_){if(a.optionalFeatures.push("light-estimation"),a.optionalFeatures.push("hit-test"),s&&(s.imageTracking&&this.imageTracking.supported&&a.optionalFeatures.push("image-tracking"),s.planeDetection&&a.optionalFeatures.push("plane-detection"),s.meshDetection&&a.optionalFeatures.push("mesh-detection")),this.domOverlay.supported&&this.domOverlay.root&&(a.optionalFeatures.push("dom-overlay"),a.domOverlay={root:this.domOverlay.root}),s&&s.anchors&&this.anchors.supported&&a.optionalFeatures.push("anchors"),s&&s.depthSensing&&this.views.supportedDepth){a.optionalFeatures.push("depth-sensing");const c=[],u=[];if(c.push(jY,aMe),u.push(GY,$Y,HY),s.depthSensing.usagePreference){const h=c.indexOf(s.depthSensing.usagePreference);h!==-1&&c.splice(h,1),c.unshift(s.depthSensing.usagePreference)}if(s.depthSensing.dataFormatPreference){const h=u.indexOf(s.depthSensing.dataFormatPreference);h!==-1&&u.splice(h,1),u.unshift(s.depthSensing.dataFormatPreference)}a.depthSensing={usagePreference:c,dataFormatPreference:u}}l&&s&&s.cameraColor&&this.views.supportedColor&&a.optionalFeatures.push("camera-access")}a.optionalFeatures.push("hand-tracking"),s&&s.optionalFeatures&&(a.optionalFeatures=a.optionalFeatures.concat(s.optionalFeatures)),this.imageTracking.supported&&this.imageTracking.images.length?this.imageTracking.prepareImages((c,u)=>{if(c){n&&n(c),this.fire("error",c);return}u!==null&&(a.trackedImages=u),this._onStartOptionsReady(t,i,a,n)}):this._onStartOptionsReady(t,i,a,n)}_onStartOptionsReady(e,t,i,s){navigator.xr.requestSession(e,i).then(n=>{this._onSessionStart(n,t,s)}).catch(n=>{this._camera.camera.xr=null,this._camera=null,this._type=null,this._spaceType=null,s&&s(n),this.fire("error",n)})}end(e){if(!this._session){e&&e(new Error("XR Session is not initialized"));return}this.webglBinding=null,e&&this.once("end",e),this._session.end()}isAvailable(e){return this._available[e]}_deviceAvailabilityCheck(){for(const e in this._available)this._sessionSupportCheck(e)}initiateRoomCapture(e){if(!this._session){e(new Error("Session is not active"));return}if(!this._session.initiateRoomCapture){e(new Error("Session does not support manual room capture"));return}this._session.initiateRoomCapture().then(()=>{e&&e(null)}).catch(t=>{e&&e(t)})}updateTargetFrameRate(e,t){var i;if(!((i=this._session)!=null&&i.updateTargetFrameRate)){t==null||t(new Error("unable to update frameRate"));return}this._session.updateTargetFrameRate(e).then(()=>{t==null||t()}).catch(s=>{t==null||t(s)})}_sessionSupportCheck(e){navigator.xr.isSessionSupported(e).then(t=>{this._available[e]!==t&&(this._available[e]=t,this.fire("available",e,t),this.fire(`available:${e}`,t))}).catch(t=>{this.fire("error",t)})}_onSessionStart(e,t,i){let s=!1;this._session=e;const n=()=>{this.fire("visibility:change",e.visibilityState)},a=()=>{this._setClipPlanes(this._camera.nearClip,this._camera.farClip)},o=()=>{this._camera&&(this._camera.off("set_nearClip",a),this._camera.off("set_farClip",a),this._camera.camera.xr=null,this._camera=null),e.removeEventListener("end",o),e.removeEventListener("visibilitychange",n),s||this.fire("end"),this._session=null,this._referenceSpace=null,this._width=0,this._height=0,this._type=null,this._spaceType=null,this.app.systems&&this.app.tick()};e.addEventListener("end",o),e.addEventListener("visibilitychange",n),this._camera.on("set_nearClip",a),this._camera.on("set_farClip",a),this._createBaseLayer(),this.session.supportedFrameRates?this._supportedFrameRates=Array.from(this.session.supportedFrameRates):this._supportedFrameRates=null,this._session.addEventListener("frameratechange",()=>{var l;this.fire("frameratechange",(l=this._session)==null?void 0:l.frameRate)}),e.requestReferenceSpace(t).then(l=>{this._referenceSpace=l,this.app.tick(),i&&i(null),this.fire("start")}).catch(l=>{s=!0,e.end(),i&&i(l),this.fire("error",l)})}_setClipPlanes(e,t){this._depthNear===e&&this._depthFar===t||(this._depthNear=e,this._depthFar=t,this._session&&this._session.updateRenderState({depthNear:this._depthNear,depthFar:this._depthFar}))}_createBaseLayer(){const e=this.app.graphicsDevice,t=e.maxPixelRatio/window.devicePixelRatio*this._framebufferScaleFactor;if(this._baseLayer=new XRWebGLLayer(this._session,e.gl,{alpha:!0,depth:!0,stencil:!0,framebufferScaleFactor:t,antialias:!1}),e!=null&&e.isWebGL2&&window.XRWebGLBinding)try{this.webglBinding=new XRWebGLBinding(this._session,e.gl)}catch(i){this.fire("error",i)}this._session.updateRenderState({baseLayer:this._baseLayer,depthNear:this._depthNear,depthFar:this._depthFar})}_onDeviceLost(){this._session&&(this.webglBinding&&(this.webglBinding=null),this._baseLayer=null,this._session.updateRenderState({baseLayer:this._baseLayer,depthNear:this._depthNear,depthFar:this._depthFar}))}_onDeviceRestored(){this._session&&setTimeout(()=>{this.app.graphicsDevice.gl.makeXRCompatible().then(()=>{this._createBaseLayer()}).catch(e=>{this.fire("error",e)})},0)}update(e){if(!this._session)return!1;const t=e.session.renderState.baseLayer.framebufferWidth,i=e.session.renderState.baseLayer.framebufferHeight;(this._width!==t||this._height!==i)&&(this._width=t,this._height=i,this.app.graphicsDevice.setResolution(t,i));const s=e.getViewerPose(this._referenceSpace);if(!s)return!1;const n=this.views.list.length;this.views.update(e,s.views);const a=s.transform.position,o=s.transform.orientation;if(this._localPosition.set(a.x,a.y,a.z),this._localRotation.set(o.x,o.y,o.z,o.w),n===0&&this.views.list.length>0){const l=new se,c=this.views.list[0];l.copy(c.projMat);const u=l.data,h=2*Math.atan(1/u[5])*180/Math.PI,d=u[5]/u[0],f=u[14]/(u[10]+1),p=u[14]/(u[10]-1);this._camera.camera.setXrProperties({aspectRatio:d,farClip:f,fov:h,horizontalFov:!1,nearClip:p})}return this._camera.camera._node.setLocalPosition(this._localPosition),this._camera.camera._node.setLocalRotation(this._localRotation),this.input.update(e),this._type===t_&&(this.hitTest.supported&&this.hitTest.update(e),this.lightEstimation.supported&&this.lightEstimation.update(e),this.imageTracking.supported&&this.imageTracking.update(e),this.anchors.supported&&this.anchors.update(e),this.planeDetection.supported&&this.planeDetection.update(e),this.meshDetection.supported&&this.meshDetection.update(e)),this.fire("update",e),!0}get supported(){return this._supported}get active(){return!!this._session}get type(){return this._type}get spaceType(){return this._spaceType}get session(){return this._session}get frameRate(){var e;return((e=this._session)==null?void 0:e.frameRate)??null}get supportedFrameRates(){return this._supportedFrameRates}get framebufferScaleFactor(){return this._framebufferScaleFactor}set fixedFoveation(e){var t;(((t=this._baseLayer)==null?void 0:t.fixedFoveation)??null)!==null&&(this.app.graphicsDevice.samples>1,this._baseLayer.fixedFoveation=e)}get fixedFoveation(){var e;return((e=this._baseLayer)==null?void 0:e.fixedFoveation)??null}get camera(){return this._camera?this._camera.entity:null}get visibilityState(){return this._session?this._session.visibilityState:null}};xu.EVENT_AVAILABLE="available",xu.EVENT_START="start",xu.EVENT_END="end",xu.EVENT_UPDATE="update",xu.EVENT_ERROR="error";let k2=xu;class XY extends Ab{constructor(e,t={}){super(e);const i=new qwe;i.graphicsDevice=t.graphicsDevice??this.createDevice(e,t),this.addComponentSystems(i),this.addResourceHandles(i),i.elementInput=t.elementInput,i.keyboard=t.keyboard,i.mouse=t.mouse,i.touch=t.touch,i.gamepads=t.gamepads,i.scriptPrefix=t.scriptPrefix,i.assetPrefix=t.assetPrefix,i.scriptsOrder=t.scriptsOrder,i.soundManager=new Fpe,i.lightmapper=oTe,i.batchManager=Fme,i.xr=k2,this.init(i)}createDevice(e,t){return t.graphicsDeviceOptions||(t.graphicsDeviceOptions={}),Ye.browser&&navigator.xr&&(t.graphicsDeviceOptions.xrCompatible=!0),t.graphicsDeviceOptions.alpha=t.graphicsDeviceOptions.alpha||!1,new fpe(e,t.graphicsDeviceOptions)}addComponentSystems(e){e.componentSystems=[o2,JTe,IEe,ATe,DTe,$Ee,L1e,pCe,gCe,MCe,rCe,OTe,M1e,j1e,EEe,BTe,Q1e,eCe,lCe,UEe,REe,uCe,DCe]}addResourceHandles(e){e.resourceHandlers=[LCe,FPe,BPe,UPe,bIe,_Ie,iMe,DIe,fIe,VPe,PIe,wIe,WPe,dIe,GPe,IIe,hIe,XPe,qPe,jPe,OIe,MIe,RIe,HPe,uIe]}}const Vl=class Vl{constructor(){ia(this,"modelCache",new Map);ia(this,"instancePool",[]);ia(this,"canvasPool",[]);ia(this,"maxCacheSize",50);ia(this,"maxPoolSize",5);ia(this,"maxCanvasPool",3);ia(this,"cacheTimeout",5*60*1e3);ia(this,"isPreloadingBatch",!1)}static getInstance(){return Vl.instance||(Vl.instance=new Vl,Vl.instance.initializeCanvasPool()),Vl.instance}initializeCanvasPool(){for(let e=0;e<this.maxCanvasPool;e++){const t=document.createElement("canvas");t.width=512,t.height=512,t.style.width="100%",t.style.height="100%",t.style.display="block",this.canvasPool.push(t)}}getCanvas(){if(this.canvasPool.length>0)return this.canvasPool.pop()||null;const e=document.createElement("canvas");return e.width=512,e.height=512,e.style.width="100%",e.style.height="100%",e.style.display="block",e}returnCanvas(e){if(this.canvasPool.length<this.maxCanvasPool){const t=e.getContext("2d");t&&t.clearRect(0,0,e.width,e.height),this.canvasPool.push(e)}}async preloadModel(e){var t;if(!(!(e!=null&&e.trim())||this.modelCache.has(e)))try{const i=(t=e.split(".").pop())==null?void 0:t.toLowerCase();if(i==="glb"||i==="gltf"){const s=document.createElement("canvas");s.width=1,s.height=1,s.style.display="none",document.body.appendChild(s);const n=new XY(s,{mouse:new pb(s),touch:new mb(s)}),a=new be("preload-model","container",{url:e});return new Promise(o=>{a.ready(()=>{this.modelCache.set(e,{asset:a,timestamp:Date.now()}),n.destroy(),s.remove(),this.cleanupCache(),o()}),a.on("error",()=>{n.destroy(),s.remove(),o()}),n.assets.add(a),n.assets.load(a)})}}catch(i){console.warn("PlayCanvasPreloader: Failed to preload model:",i)}}getPreloadedModel(e){const t=this.modelCache.get(e);return t&&Date.now()-t.timestamp<this.cacheTimeout?t.asset:null}getInstance(){const e=this.instancePool.find(t=>!t.inUse);return e?(e.inUse=!0,e.timestamp=Date.now(),e.app):null}returnInstance(e){const t=this.instancePool.find(i=>i.app===e);t&&(e.root.children.slice().forEach(i=>{i.name!=="camera"&&i.name!=="light"&&i.destroy()}),t.inUse=!1,t.timestamp=Date.now())}cleanupCache(){const e=Date.now(),t=Array.from(this.modelCache.entries());t.forEach(([i,s])=>{e-s.timestamp>this.cacheTimeout&&this.modelCache.delete(i)}),this.modelCache.size>this.maxCacheSize&&t.sort((s,n)=>s[1].timestamp-n[1].timestamp).slice(0,this.modelCache.size-this.maxCacheSize).forEach(([s])=>{this.modelCache.delete(s)})}async aggressiveBatchPreload(e){if(this.isPreloadingBatch)return;this.isPreloadingBatch=!0;const t=e.filter(n=>(n==null?void 0:n.trim())&&!this.modelCache.has(n));console.log(`PlayCanvasPreloader: Starting aggressive preload of ${t.length} models`);const i=5,s=[];for(let n=0;n<t.length;n+=i){const a=t.slice(n,n+i);s.push(Promise.allSettled(a.map(o=>this.preloadModel(o))).then(()=>{console.log(`PlayCanvasPreloader: Completed batch ${n/i+1}/${Math.ceil(t.length/i)}`)}))}await Promise.allSettled(s),this.isPreloadingBatch=!1,console.log(`PlayCanvasPreloader: Completed aggressive preloading. Cache size: ${this.modelCache.size}`)}async batchPreload(e){const t=e.filter(s=>(s==null?void 0:s.trim())&&!this.modelCache.has(s)),i=3;for(let s=0;s<t.length;s+=i){const n=t.slice(s,s+i);await Promise.allSettled(n.map(a=>this.preloadModel(a)))}}getCacheStats(){return{modelCacheSize:this.modelCache.size,instancePoolSize:this.instancePool.length,availableInstances:this.instancePool.filter(e=>!e.inUse).length}}};ia(Vl,"instance");let F2=Vl;const X3=()=>{const r=E.useRef(F2.getInstance()),e=E.useCallback(async u=>{await r.current.preloadModel(u)},[]),t=E.useCallback(async u=>{await r.current.batchPreload(u)},[]),i=E.useCallback(async u=>{await r.current.aggressiveBatchPreload(u)},[]),s=E.useCallback(u=>r.current.getPreloadedModel(u),[]),n=E.useCallback(()=>r.current.getInstance(),[]),a=E.useCallback(u=>{r.current.returnInstance(u)},[]),o=E.useCallback(()=>r.current.getCanvas(),[]),l=E.useCallback(u=>{r.current.returnCanvas(u)},[]),c=E.useCallback(()=>r.current.getCacheStats(),[]);return{preloadModel:e,batchPreload:t,aggressiveBatchPreload:i,getPreloadedModel:s,getInstance:n,returnInstance:a,getCanvas:o,returnCanvas:l,getCacheStats:c}},ZC=new Map,RV=(r,e)=>{let t;return function(...i){t||(r.apply(this,i),t=!0,setTimeout(()=>t=!1,e))}},qY=({splatUrl:r,className:e="",performanceMode:t=!1,lazyLoad:i=!0})=>{const s=E.useRef(null),n=E.useRef(null),a=E.useRef(null);E.useRef(null);const o=E.useRef(null),[l,c]=E.useState(!0),[u,h]=E.useState(null),[d,f]=E.useState(!i),[p,m]=E.useState(!1),[g,_]=E.useState(0),{getPreloadedModel:v,getInstance:y,returnInstance:x}=X3();E.useEffect(()=>{if(!(!i||!n.current))return o.current=new IntersectionObserver(A=>{A.forEach(C=>{C.isIntersecting&&!d?f(!0):!C.isIntersecting&&d&&m(!0)})},{threshold:.1}),o.current.observe(n.current),()=>{o.current&&o.current.disconnect()}},[i,d]);const S=E.useCallback(()=>{if(!s.current)return null;try{const A=new XY(s.current,{mouse:new pb(s.current),touch:new mb(s.current),keyboard:new bM(window)});return A.setCanvasFillMode(q9),A.setCanvasResolution(t?Y9:NM),t&&(A.graphicsDevice.canvas.width=512,A.graphicsDevice.canvas.height=512),A.resizeCanvas(),A}catch(A){return console.error("PlayCanvasViewer: Failed to create PlayCanvas instance:",A),null}},[t,y]),w=E.useCallback(A=>{try{x(A)}catch(C){console.warn("PlayCanvasViewer: Failed to return to pool, destroying:",C),A.destroy()}},[x]),T=E.useCallback(RV((A,C)=>{if(!C.isDragging)return;const P=A.clientX-C.lastMouseX,I=A.clientY-C.lastMouseY;C.orbitAngleX+=I*.01,C.orbitAngleY+=P*.01,C.orbitAngleX=Math.max(-Math.PI/2,Math.min(Math.PI/2,C.orbitAngleX));const M=Math.sin(C.orbitAngleY)*Math.cos(C.orbitAngleX)*C.orbitDistance,N=Math.sin(C.orbitAngleX)*C.orbitDistance,k=Math.cos(C.orbitAngleY)*Math.cos(C.orbitAngleX)*C.orbitDistance;C.camera.setPosition(M,N,k),C.camera.lookAt(0,0,0),C.lastMouseX=A.clientX,C.lastMouseY=A.clientY},16),[]);return E.useEffect(()=>{if(!d||!s.current)return;if(c(!0),h(null),r&&r.includes("playcanv.as")){console.log("PlayCanvasViewer: Detected PlayCanvas URL, embedding via iframe");const D=document.createElement("iframe");D.src=r,D.style.width="100%",D.style.height="100%",D.style.border="none",D.style.borderRadius="8px",D.setAttribute("allowfullscreen",""),D.loading="eager";const F=s.current;return F&&F.parentNode&&(F.style.display="none",F.parentNode.appendChild(D)),c(!1),()=>{var z;const j=(z=F==null?void 0:F.parentNode)==null?void 0:z.querySelectorAll("iframe");j==null||j.forEach($=>$.remove())}}const A=S();if(!A){h("Failed to initialize 3D viewer"),c(!1);return}a.current=A;const C=new lt("camera");C.addComponent("camera",{clearColor:new ae(.1,.1,.1),fov:45,nearClip:.1,farClip:t?100:1e3}),C.setPosition(0,1,5),C.lookAt(0,0,0),A.root.addChild(C);const P=new lt("main-light");P.addComponent("light",{type:Me,color:new ae(1,1,1),intensity:t?.8:1}),P.setEulerAngles(45,30,0),A.root.addChild(P),A.scene.ambientLight=new ae(t?.3:.2,t?.3:.2,t?.4:.3);const I={isDragging:!1,lastMouseX:0,lastMouseY:0,orbitDistance:5,orbitAngleX:0,orbitAngleY:0,camera:C},M=D=>{I.isDragging=!0,I.lastMouseX=D.clientX,I.lastMouseY=D.clientY},N=D=>{T(D,I)},k=()=>{I.isDragging=!1},V=RV(D=>{D.preventDefault(),I.orbitDistance+=D.deltaY*.01,I.orbitDistance=Math.max(1,Math.min(20,I.orbitDistance));const F=Math.sin(I.orbitAngleY)*Math.cos(I.orbitAngleX)*I.orbitDistance,j=Math.sin(I.orbitAngleX)*I.orbitDistance,z=Math.cos(I.orbitAngleY)*Math.cos(I.orbitAngleX)*I.orbitDistance;C.setPosition(F,j,z),C.lookAt(0,0,0)},16),B=s.current;B.addEventListener("mousedown",M),B.addEventListener("mousemove",N),B.addEventListener("mouseup",k),B.addEventListener("wheel",V,{passive:!1});const R=()=>{var j;const D=new Ns;D.diffuse=new ae(.7,.5,.8),t||(D.metalness=.3,D.gloss=.8),D.update();const F=new lt("instant-placeholder");if(F.addComponent("model",{type:"box"}),(j=F.model)!=null&&j.meshInstances&&F.model.meshInstances.forEach(z=>{z.material=D}),A.root.addChild(F),!t){let z=0;const $=H=>{p||(z+=H*.5,F.setEulerAngles(0,z*57.2958,0))};A.on("update",$)}return F};return(async()=>{var F,j;const D=R();if(c(!1),!!(r!=null&&r.trim()))try{console.log(`PlayCanvasViewer: Loading model ${r}`),_(10);const z=v(r);if(z){console.log(`PlayCanvasViewer: Found preloaded model ${r}`),_(80),D.destroy();const H=new lt("preloaded-model");if(H.addComponent("model",{asset:z}),A.root.addChild(H),_(100),!t){let G=0;const Y=W=>{p||(G+=W*.2,H.setEulerAngles(0,G*57.2958,0))};A.on("update",Y)}return}if(ZC.has(r)){_(70);const H=ZC.get(r),G=new lt("cached-model");G.addComponent("model",{asset:H}),A.root.addChild(G),_(100),c(!1);return}const $=(F=r.split(".").pop())==null?void 0:F.toLowerCase();if($==="glb"||$==="gltf"){_(20);const H=new be("model","container",{url:r});H.ready(()=>{try{_(90),ZC.set(r,H);const G=new lt("loaded-model");if(G.addComponent("model",{asset:H}),A.root.addChild(G),_(100),c(!1),!t){let Y=0;const W=ie=>{p||(Y+=ie*.2,G.setEulerAngles(0,Y*57.2958,0))};A.on("update",W)}}catch(G){console.error("PlayCanvasViewer: Error creating model:",G),h("Failed to create model"),c(!1)}}),H.on("error",G=>{console.error("PlayCanvasViewer: Model loading error:",G),h("Failed to load 3D model"),c(!1)}),H.on("load",()=>_(60)),A.assets.add(H),A.assets.load(H)}else{_(50);const H=new Ns;H.diffuse=new ae(.7,.5,.8),t||(H.metalness=.3,H.gloss=.8),H.update();const G=new lt("placeholder");if(G.addComponent("model",{type:"box"}),(j=G.model)!=null&&j.meshInstances&&G.model.meshInstances.forEach(Y=>{Y.material=H}),A.root.addChild(G),_(100),c(!1),!t){let Y=0;A.on("update",W=>{p||(Y+=W,G.setEulerAngles(Y*15,Y*30,0))})}}}catch(z){console.error("PlayCanvasViewer: Error loading model:",z),h("Failed to load 3D model"),c(!1)}})(),A.start(),()=>{B&&(B.removeEventListener("mousedown",M),B.removeEventListener("mousemove",N),B.removeEventListener("mouseup",k),B.removeEventListener("wheel",V)),a.current&&(w(a.current),a.current=null)}},[d,r,t,p,S,w,T]),E.useEffect(()=>{a.current&&(p?a.current.timeScale=0:a.current.timeScale=1)},[p]),b.jsxs("div",{ref:n,className:`relative w-full h-full ${e}`,children:[b.jsx("canvas",{ref:s,className:"w-full h-full rounded-lg",style:{display:"block"}}),l&&b.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",children:b.jsxs("div",{className:"text-center",children:[b.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),b.jsx("p",{className:"text-sm text-gray-600",children:i&&!d?"Preparing 3D viewer...":"Loading 3D model..."}),g>0&&b.jsx("div",{className:"w-32 h-1 bg-gray-200 rounded-full mx-auto mt-2",children:b.jsx("div",{className:"h-1 bg-blue-600 rounded-full transition-all duration-300",style:{width:`${g}%`}})})]})}),u&&b.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg",children:b.jsxs("div",{className:"text-center",children:[b.jsx("p",{className:"text-sm text-red-600 mb-2",children:u}),b.jsx("p",{className:"text-xs text-gray-500",children:"Please check the model file format"})]})}),!l&&!u&&r&&b.jsxs("div",{className:"absolute bottom-2 right-2 bg-black/50 text-white text-xs px-2 py-1 rounded",children:["Drag to rotate • Scroll to zoom",t&&b.jsx("span",{className:"ml-2 text-yellow-300",children:"⚡ Performance Mode"}),p&&b.jsx("span",{className:"ml-2 text-orange-300",children:"⏸ Paused"})]})]})},hMe=({splatUrl:r,imageUrl:e,title:t,performanceMode:i})=>{const[s,n]=E.useState(!!(r!=null&&r.trim())),a=()=>{n(!s)},o=!!(r!=null&&r.trim());return b.jsxs("div",{className:"space-y-4",children:[s&&o?b.jsx("div",{className:"w-full h-64 rounded-lg overflow-hidden",children:b.jsx(qY,{splatUrl:r,className:"h-full",performanceMode:i,lazyLoad:!1})}):e?b.jsx("img",{src:e,alt:t,className:"w-full h-64 object-cover rounded-lg",loading:"lazy"}):b.jsx("div",{className:"w-full h-64 bg-gradient-to-br from-muted to-muted/50 flex items-center justify-center rounded-lg",children:b.jsx("span",{className:"text-muted-foreground text-lg font-medium",children:"No Preview Available"})}),o&&b.jsx(tt,{onClick:a,variant:"outline",className:"w-full","aria-label":s?"Switch to image view":"Switch to 3D view",children:s?b.jsxs(b.Fragment,{children:[b.jsx(Gx,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Back to Image"]}):b.jsxs(b.Fragment,{children:[b.jsx(bf,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),i?"View in 3D (Performance Mode)":"View in 3D"]})})]})},dMe=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Ty(async()=>{const{default:i}=await Promise.resolve().then(()=>ky);return{default:i}},[]).then(({default:i})=>i(...t)):e=fetch,(...t)=>e(...t)};class q3 extends Error{constructor(e,t="FunctionsError",i){super(e),this.name=t,this.context=i}}class fMe extends q3{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class DV extends q3{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class LV extends q3{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var B2;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(B2||(B2={}));var pMe=function(r,e,t,i){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(i.next(u))}catch(h){a(h)}}function l(u){try{c(i.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):s(u.value).then(o,l)}c((i=i.apply(r,e||[])).next())})};class mMe{constructor(e,{headers:t={},customFetch:i,region:s=B2.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=dMe(i)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var i;return pMe(this,void 0,void 0,function*(){try{const{headers:s,method:n,body:a}=t;let o={},{region:l}=t;l||(l=this.region);const c=new URL(`${this.url}/${e}`);l&&l!=="any"&&(o["x-region"]=l,c.searchParams.set("forceFunctionRegion",l));let u;a&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",u=a):typeof a=="string"?(o["Content-Type"]="text/plain",u=a):typeof FormData<"u"&&a instanceof FormData?u=a:(o["Content-Type"]="application/json",u=JSON.stringify(a)));const h=yield this.fetch(c.toString(),{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),s),body:u}).catch(m=>{throw new fMe(m)}),d=h.headers.get("x-relay-error");if(d&&d==="true")throw new DV(h);if(!h.ok)throw new LV(h);let f=((i=h.headers.get("Content-Type"))!==null&&i!==void 0?i:"text/plain").split(";")[0].trim(),p;return f==="application/json"?p=yield h.json():f==="application/octet-stream"?p=yield h.blob():f==="text/event-stream"?p=h:f==="multipart/form-data"?p=yield h.formData():p=yield h.text(),{data:p,error:null,response:h}}catch(s){return{data:null,error:s,response:s instanceof LV||s instanceof DV?s.context:void 0}}})}}var Yr={},Y3={},XE={},Ny={},qE={},YE={},gMe=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},bp=gMe();const _Me=bp.fetch,YY=bp.fetch.bind(bp),KY=bp.Headers,vMe=bp.Request,yMe=bp.Response,ky=Object.freeze(Object.defineProperty({__proto__:null,Headers:KY,Request:vMe,Response:yMe,default:YY,fetch:_Me},Symbol.toStringTag,{value:"Module"})),SMe=Fee(ky);var KE={};Object.defineProperty(KE,"__esModule",{value:!0});let xMe=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};KE.default=xMe;var ZY=xr&&xr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(YE,"__esModule",{value:!0});const bMe=ZY(SMe),wMe=ZY(KE);let TMe=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=bMe.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const i=this.fetch;let s=i(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async n=>{var a,o,l;let c=null,u=null,h=null,d=n.status,f=n.statusText;if(n.ok){if(this.method!=="HEAD"){const _=await n.text();_===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=_:u=JSON.parse(_))}const m=(a=this.headers.Prefer)===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),g=(o=n.headers.get("content-range"))===null||o===void 0?void 0:o.split("/");m&&g&&g.length>1&&(h=parseInt(g[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(c={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,h=null,d=406,f="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{const m=await n.text();try{c=JSON.parse(m),Array.isArray(c)&&n.status===404&&(u=[],c=null,d=200,f="OK")}catch{n.status===404&&m===""?(d=204,f="No Content"):c={message:m}}if(c&&this.isMaybeSingle&&(!((l=c==null?void 0:c.details)===null||l===void 0)&&l.includes("0 rows"))&&(c=null,d=200,f="OK"),c&&this.shouldThrowOnError)throw new wMe.default(c)}return{error:c,data:u,count:h,status:d,statusText:f}});return this.shouldThrowOnError||(s=s.catch(n=>{var a,o,l;return{error:{message:`${(a=n==null?void 0:n.name)!==null&&a!==void 0?a:"FetchError"}: ${n==null?void 0:n.message}`,details:`${(o=n==null?void 0:n.stack)!==null&&o!==void 0?o:""}`,hint:"",code:`${(l=n==null?void 0:n.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}returns(){return this}overrideTypes(){return this}};YE.default=TMe;var EMe=xr&&xr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(qE,"__esModule",{value:!0});const AMe=EMe(YE);let CMe=class extends AMe.default{select(e){let t=!1;const i=(e??"*").split("").map(s=>/\s/.test(s)&&!t?"":(s==='"'&&(t=!t),s)).join("");return this.url.searchParams.set("select",i),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:i,foreignTable:s,referencedTable:n=s}={}){const a=n?`${n}.order`:"order",o=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${i===void 0?"":i?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:i=t}={}){const s=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:i,referencedTable:s=i}={}){const n=typeof s>"u"?"offset":`${s}.offset`,a=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(a,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:i=!1,buffers:s=!1,wal:n=!1,format:a="text"}={}){var o;const l=[e?"analyze":null,t?"verbose":null,i?"settings":null,s?"buffers":null,n?"wal":null].filter(Boolean).join("|"),c=(o=this.headers.Accept)!==null&&o!==void 0?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${a}; for="${c}"; options=${l};`,a==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};qE.default=CMe;var PMe=xr&&xr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ny,"__esModule",{value:!0});const IMe=PMe(qE);let MMe=class extends IMe.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const i=Array.from(new Set(t)).map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`in.(${i})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:i,type:s}={}){let n="";s==="plain"?n="pl":s==="phrase"?n="ph":s==="websearch"&&(n="w");const a=i===void 0?"":`(${i})`;return this.url.searchParams.append(e,`${n}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([t,i])=>{this.url.searchParams.append(t,`eq.${i}`)}),this}not(e,t,i){return this.url.searchParams.append(e,`not.${t}.${i}`),this}or(e,{foreignTable:t,referencedTable:i=t}={}){const s=i?`${i}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,i){return this.url.searchParams.append(e,`${t}.${i}`),this}};Ny.default=MMe;var RMe=xr&&xr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(XE,"__esModule",{value:!0});const hg=RMe(Ny);let DMe=class{constructor(e,{headers:t={},schema:i,fetch:s}){this.url=e,this.headers=t,this.schema=i,this.fetch=s}select(e,{head:t=!1,count:i}={}){const s=t?"HEAD":"GET";let n=!1;const a=(e??"*").split("").map(o=>/\s/.test(o)&&!n?"":(o==='"'&&(n=!n),o)).join("");return this.url.searchParams.set("select",a),i&&(this.headers.Prefer=`count=${i}`),new hg.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:i=!0}={}){const s="POST",n=[];if(this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),i||n.push("missing=default"),this.headers.Prefer=n.join(","),Array.isArray(e)){const a=e.reduce((o,l)=>o.concat(Object.keys(l)),[]);if(a.length>0){const o=[...new Set(a)].map(l=>`"${l}"`);this.url.searchParams.set("columns",o.join(","))}}return new hg.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:i=!1,count:s,defaultToNull:n=!0}={}){const a="POST",o=[`resolution=${i?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&o.push(this.headers.Prefer),s&&o.push(`count=${s}`),n||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const l=e.reduce((c,u)=>c.concat(Object.keys(u)),[]);if(l.length>0){const c=[...new Set(l)].map(u=>`"${u}"`);this.url.searchParams.set("columns",c.join(","))}}return new hg.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const i="PATCH",s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new hg.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",i=[];return e&&i.push(`count=${e}`),this.headers.Prefer&&i.unshift(this.headers.Prefer),this.headers.Prefer=i.join(","),new hg.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};XE.default=DMe;var ZE={},QE={};Object.defineProperty(QE,"__esModule",{value:!0});QE.version=void 0;QE.version="0.0.0-automated";Object.defineProperty(ZE,"__esModule",{value:!0});ZE.DEFAULT_HEADERS=void 0;const LMe=QE;ZE.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${LMe.version}`};var QY=xr&&xr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Y3,"__esModule",{value:!0});const OMe=QY(XE),NMe=QY(Ny),kMe=ZE;let FMe=class JY{constructor(e,{headers:t={},schema:i,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},kMe.DEFAULT_HEADERS),t),this.schemaName=i,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new OMe.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new JY(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:i=!1,get:s=!1,count:n}={}){let a;const o=new URL(`${this.url}/rpc/${e}`);let l;i||s?(a=i?"HEAD":"GET",Object.entries(t).filter(([u,h])=>h!==void 0).map(([u,h])=>[u,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([u,h])=>{o.searchParams.append(u,h)})):(a="POST",l=t);const c=Object.assign({},this.headers);return n&&(c.Prefer=`count=${n}`),new NMe.default({method:a,url:o,headers:c,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}};Y3.default=FMe;var fm=xr&&xr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Yr,"__esModule",{value:!0});Yr.PostgrestError=Yr.PostgrestBuilder=Yr.PostgrestTransformBuilder=Yr.PostgrestFilterBuilder=Yr.PostgrestQueryBuilder=Yr.PostgrestClient=void 0;const eK=fm(Y3);Yr.PostgrestClient=eK.default;const tK=fm(XE);Yr.PostgrestQueryBuilder=tK.default;const iK=fm(Ny);Yr.PostgrestFilterBuilder=iK.default;const rK=fm(qE);Yr.PostgrestTransformBuilder=rK.default;const sK=fm(YE);Yr.PostgrestBuilder=sK.default;const nK=fm(KE);Yr.PostgrestError=nK.default;var BMe=Yr.default={PostgrestClient:eK.default,PostgrestQueryBuilder:tK.default,PostgrestFilterBuilder:iK.default,PostgrestTransformBuilder:rK.default,PostgrestBuilder:sK.default,PostgrestError:nK.default};const{PostgrestClient:UMe,PostgrestQueryBuilder:Bit,PostgrestFilterBuilder:Uit,PostgrestTransformBuilder:zit,PostgrestBuilder:Vit,PostgrestError:jit}=BMe;function zMe(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const VMe=zMe(),jMe="2.11.15",$Me=`realtime-js/${jMe}`,HMe="1.0.0",aK=1e4,GMe=1e3;var i_;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(i_||(i_={}));var pr;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(pr||(pr={}));var Nn;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(Nn||(Nn={}));var U2;(function(r){r.websocket="websocket"})(U2||(U2={}));var du;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(du||(du={}));class WMe{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),i=new TextDecoder;return this._decodeBroadcast(e,t,i)}_decodeBroadcast(e,t,i){const s=t.getUint8(1),n=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=i.decode(e.slice(a,a+s));a=a+s;const l=i.decode(e.slice(a,a+n));a=a+n;const c=JSON.parse(i.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:l,payload:c}}}class oK{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Et;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(Et||(Et={}));const OV=(r,e,t={})=>{var i;const s=(i=t.skipTypes)!==null&&i!==void 0?i:[];return Object.keys(e).reduce((n,a)=>(n[a]=XMe(a,r,e,s),n),{})},XMe=(r,e,t,i)=>{const s=e.find(o=>o.name===r),n=s==null?void 0:s.type,a=t[r];return n&&!i.includes(n)?lK(n,a):z2(a)},lK=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return ZMe(e,t)}switch(r){case Et.bool:return qMe(e);case Et.float4:case Et.float8:case Et.int2:case Et.int4:case Et.int8:case Et.numeric:case Et.oid:return YMe(e);case Et.json:case Et.jsonb:return KMe(e);case Et.timestamp:return QMe(e);case Et.abstime:case Et.date:case Et.daterange:case Et.int4range:case Et.int8range:case Et.money:case Et.reltime:case Et.text:case Et.time:case Et.timestamptz:case Et.timetz:case Et.tsrange:case Et.tstzrange:return z2(e);default:return z2(e)}},z2=r=>r,qMe=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},YMe=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},KMe=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},ZMe=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,i=r[t];if(r[0]==="{"&&i==="}"){let n;const a=r.slice(1,t);try{n=JSON.parse("["+a+"]")}catch{n=a?a.split(","):[]}return n.map(o=>lK(e,o))}return r},QMe=r=>typeof r=="string"?r.replace(" ","T"):r,cK=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class QC{constructor(e,t,i={},s=aK){this.channel=e,this.event=t,this.payload=i,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var i;return this._hasReceived(e)&&t((i=this.receivedResp)===null||i===void 0?void 0:i.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(i=>i.status===e).forEach(i=>i.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var NV;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(NV||(NV={}));class r_{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const i=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(i.state,{},s=>{const{onJoin:n,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=r_.syncState(this.state,s,n,a),this.pendingDiffs.forEach(l=>{this.state=r_.syncDiff(this.state,l,n,a)}),this.pendingDiffs=[],o()}),this.channel._on(i.diff,{},s=>{const{onJoin:n,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=r_.syncDiff(this.state,s,n,a),o())}),this.onJoin((s,n,a)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:n,newPresences:a})}),this.onLeave((s,n,a)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:n,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,i,s){const n=this.cloneDeep(e),a=this.transformState(t),o={},l={};return this.map(n,(c,u)=>{a[c]||(l[c]=u)}),this.map(a,(c,u)=>{const h=n[c];if(h){const d=u.map(g=>g.presence_ref),f=h.map(g=>g.presence_ref),p=u.filter(g=>f.indexOf(g.presence_ref)<0),m=h.filter(g=>d.indexOf(g.presence_ref)<0);p.length>0&&(o[c]=p),m.length>0&&(l[c]=m)}else o[c]=u}),this.syncDiff(n,{joins:o,leaves:l},i,s)}static syncDiff(e,t,i,s){const{joins:n,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return i||(i=()=>{}),s||(s=()=>{}),this.map(n,(o,l)=>{var c;const u=(c=e[o])!==null&&c!==void 0?c:[];if(e[o]=this.cloneDeep(l),u.length>0){const h=e[o].map(f=>f.presence_ref),d=u.filter(f=>h.indexOf(f.presence_ref)<0);e[o].unshift(...d)}i(o,u,l)}),this.map(a,(o,l)=>{let c=e[o];if(!c)return;const u=l.map(h=>h.presence_ref);c=c.filter(h=>u.indexOf(h.presence_ref)<0),e[o]=c,s(o,c,l),c.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(i=>t(i,e[i]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,i)=>{const s=e[i];return"metas"in s?t[i]=s.metas.map(n=>(n.presence_ref=n.phx_ref,delete n.phx_ref,delete n.phx_ref_prev,n)):t[i]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var kV;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(kV||(kV={}));var FV;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(FV||(FV={}));var So;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(So||(So={}));class K3{constructor(e,t={config:{}},i){this.topic=e,this.params=t,this.socket=i,this.bindings={},this.state=pr.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new QC(this,Nn.join,this.params,this.timeout),this.rejoinTimer=new oK(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=pr.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=pr.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=pr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=pr.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Nn.reply,{},(s,n)=>{this._trigger(this._replyEventName(n),s)}),this.presence=new r_(this),this.broadcastEndpointURL=cK(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var i,s;if(this.socket.isConnected()||this.socket.connect(),this.state==pr.closed){const{config:{broadcast:n,presence:a,private:o}}=this.params;this._onError(u=>e==null?void 0:e(So.CHANNEL_ERROR,u)),this._onClose(()=>e==null?void 0:e(So.CLOSED));const l={},c={broadcast:n,presence:a,postgres_changes:(s=(i=this.bindings.postgres_changes)===null||i===void 0?void 0:i.map(u=>u.filter))!==null&&s!==void 0?s:[],private:o};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},l)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:u})=>{var h;if(this.socket.setAuth(),u===void 0){e==null||e(So.SUBSCRIBED);return}else{const d=this.bindings.postgres_changes,f=(h=d==null?void 0:d.length)!==null&&h!==void 0?h:0,p=[];for(let m=0;m<f;m++){const g=d[m],{filter:{event:_,schema:v,table:y,filter:x}}=g,S=u&&u[m];if(S&&S.event===_&&S.schema===v&&S.table===y&&S.filter===x)p.push(Object.assign(Object.assign({},g),{id:S.id}));else{this.unsubscribe(),this.state=pr.errored,e==null||e(So.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=p,e&&e(So.SUBSCRIBED);return}}).receive("error",u=>{this.state=pr.errored,e==null||e(So.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(So.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,i){return this._on(e,t,i)}async send(e,t={}){var i,s;if(!this._canPush()&&e.type==="broadcast"){const{event:n,payload:a}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:a,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(i=t.timeout)!==null&&i!==void 0?i:this.timeout);return await((s=c.body)===null||s===void 0?void 0:s.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(n=>{var a,o,l;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||l===void 0)&&l.ack)&&n("ok"),c.receive("ok",()=>n("ok")),c.receive("error",()=>n("error")),c.receive("timeout",()=>n("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=pr.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Nn.close,"leave",this._joinRef())};this.joinPush.destroy();let i=null;return new Promise(s=>{i=new QC(this,Nn.leave,{},e),i.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),i.send(),this._canPush()||i.trigger("ok",{})}).finally(()=>{i==null||i.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,i){const s=new AbortController,n=setTimeout(()=>s.abort(),i),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(n),a}_push(e,t,i=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new QC(this,e,t,i);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,i){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,i){var s,n;const a=e.toLocaleLowerCase(),{close:o,error:l,leave:c,join:u}=Nn;if(i&&[o,l,c,u].indexOf(a)>=0&&i!==this._joinRef())return;let d=this._onMessage(a,t,i);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(f=>{var p,m,g;return((p=f.filter)===null||p===void 0?void 0:p.event)==="*"||((g=(m=f.filter)===null||m===void 0?void 0:m.event)===null||g===void 0?void 0:g.toLocaleLowerCase())===a}).map(f=>f.callback(d,i)):(n=this.bindings[a])===null||n===void 0||n.filter(f=>{var p,m,g,_,v,y;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in f){const x=f.id,S=(p=f.filter)===null||p===void 0?void 0:p.event;return x&&((m=t.ids)===null||m===void 0?void 0:m.includes(x))&&(S==="*"||(S==null?void 0:S.toLocaleLowerCase())===((g=t.data)===null||g===void 0?void 0:g.type.toLocaleLowerCase()))}else{const x=(v=(_=f==null?void 0:f.filter)===null||_===void 0?void 0:_.event)===null||v===void 0?void 0:v.toLocaleLowerCase();return x==="*"||x===((y=t==null?void 0:t.event)===null||y===void 0?void 0:y.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===a}).map(f=>{if(typeof d=="object"&&"ids"in d){const p=d.data,{schema:m,table:g,commit_timestamp:_,type:v,errors:y}=p;d=Object.assign(Object.assign({},{schema:m,table:g,commit_timestamp:_,eventType:v,new:{},old:{},errors:y}),this._getPayloadRecords(p))}f.callback(d,i)})}_isClosed(){return this.state===pr.closed}_isJoined(){return this.state===pr.joined}_isJoining(){return this.state===pr.joining}_isLeaving(){return this.state===pr.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,i){const s=e.toLocaleLowerCase(),n={type:s,filter:t,callback:i};return this.bindings[s]?this.bindings[s].push(n):this.bindings[s]=[n],this}_off(e,t){const i=e.toLocaleLowerCase();return this.bindings[i]=this.bindings[i].filter(s=>{var n;return!(((n=s.type)===null||n===void 0?void 0:n.toLocaleLowerCase())===i&&K3.isEqual(s.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const i in e)if(e[i]!==t[i])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Nn.close,{},e)}_onError(e){this._on(Nn.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=pr.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=OV(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=OV(e.columns,e.old_record)),t}}const BV=()=>{},JMe=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class e2e{constructor(e,t){var i;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=aK,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=BV,this.ref=0,this.logger=BV,this.conn=null,this.sendBuffer=[],this.serializer=new WMe,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=n=>{let a;return n?a=n:typeof fetch>"u"?a=(...o)=>Ty(async()=>{const{default:l}=await import("./index-DY_d7J9m.js");return{default:l}},[]).then(({default:l})=>l(...o)):a=fetch,(...o)=>a(...o)},this.endPoint=`${e}/${U2.websocket}`,this.httpEndpoint=cK(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=(i=t==null?void 0:t.params)===null||i===void 0?void 0:i.apikey;if(s&&(this.accessTokenValue=s,this.apiKey=s),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:n=>[1e3,2e3,5e3,1e4][n-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(n,a)=>a(JSON.stringify(n)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new oK(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=VMe),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:HMe}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(i=>i.teardown()))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,i){this.logger(e,t,i)}connectionState(){switch(this.conn&&this.conn.readyState){case i_.connecting:return du.Connecting;case i_.open:return du.Open;case i_.closing:return du.Closing;default:return du.Closed}}isConnected(){return this.connectionState()===du.Open}channel(e,t={config:{}}){const i=`realtime:${e}`,s=this.getChannels().find(n=>n.topic===i);if(s)return s;{const n=new K3(`realtime:${e}`,t,this);return this.channels.push(n),n}}push(e){const{topic:t,event:i,payload:s,ref:n}=e,a=()=>{this.encode(e,o=>{var l;(l=this.conn)===null||l===void 0||l.send(o)})};this.log("push",`${t} ${i} (${n})`,s),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(i=>{const s={access_token:t,version:$Me};t&&i.updateJoinPayload(s),i.joinedOnce&&i._isJoined()&&i._push(Nn.access_token,{access_token:t})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(GMe,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(i=>i.topic===e&&(i._isJoined()||i._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:i,event:s,payload:n,ref:a}=t;i==="phoenix"&&s==="phx_reply"&&this.heartbeatCallback(t.payload.status=="ok"?"ok":"error"),a&&a===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${n.status||""} ${i} ${s} ${a&&"("+a+")"||""}`,n),Array.from(this.channels).filter(o=>o._isMember(i)).forEach(o=>o._trigger(s,n,a)),this.stateChangeCallbacks.message.forEach(o=>o(t))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(Nn.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const i=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${i}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const i=new Blob([JMe],{type:"application/javascript"});t=URL.createObjectURL(i)}return t}}class Z3 extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Wi(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class t2e extends Z3{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class V2 extends Z3{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var i2e=function(r,e,t,i){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(i.next(u))}catch(h){a(h)}}function l(u){try{c(i.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):s(u.value).then(o,l)}c((i=i.apply(r,e||[])).next())})};const uK=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Ty(async()=>{const{default:i}=await Promise.resolve().then(()=>ky);return{default:i}},void 0).then(({default:i})=>i(...t)):e=fetch,(...t)=>e(...t)},r2e=()=>i2e(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Ty(()=>Promise.resolve().then(()=>ky),void 0)).Response:Response}),j2=r=>{if(Array.isArray(r))return r.map(t=>j2(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,i])=>{const s=t.replace(/([-_][a-z])/gi,n=>n.toUpperCase().replace(/[-_]/g,""));e[s]=j2(i)}),e};var Fh=function(r,e,t,i){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(i.next(u))}catch(h){a(h)}}function l(u){try{c(i.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):s(u.value).then(o,l)}c((i=i.apply(r,e||[])).next())})};const JC=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),s2e=(r,e,t)=>Fh(void 0,void 0,void 0,function*(){const i=yield r2e();r instanceof i&&!(t!=null&&t.noResolveJson)?r.json().then(s=>{e(new t2e(JC(s),r.status||500))}).catch(s=>{e(new V2(JC(s),s))}):e(new V2(JC(r),r))}),n2e=(r,e,t,i)=>{const s={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),i&&(s.body=JSON.stringify(i)),Object.assign(Object.assign({},s),t))};function Fy(r,e,t,i,s,n){return Fh(this,void 0,void 0,function*(){return new Promise((a,o)=>{r(t,n2e(e,i,s,n)).then(l=>{if(!l.ok)throw l;return i!=null&&i.noResolveJson?l:l.json()}).then(l=>a(l)).catch(l=>s2e(l,o,i))})})}function $b(r,e,t,i){return Fh(this,void 0,void 0,function*(){return Fy(r,"GET",e,t,i)})}function Ml(r,e,t,i,s){return Fh(this,void 0,void 0,function*(){return Fy(r,"POST",e,i,s,t)})}function a2e(r,e,t,i,s){return Fh(this,void 0,void 0,function*(){return Fy(r,"PUT",e,i,s,t)})}function o2e(r,e,t,i){return Fh(this,void 0,void 0,function*(){return Fy(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),i)})}function hK(r,e,t,i,s){return Fh(this,void 0,void 0,function*(){return Fy(r,"DELETE",e,i,s,t)})}var $r=function(r,e,t,i){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(i.next(u))}catch(h){a(h)}}function l(u){try{c(i.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):s(u.value).then(o,l)}c((i=i.apply(r,e||[])).next())})};const l2e={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},UV={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class c2e{constructor(e,t={},i,s){this.url=e,this.headers=t,this.bucketId=i,this.fetch=uK(s)}uploadOrUpdate(e,t,i,s){return $r(this,void 0,void 0,function*(){try{let n;const a=Object.assign(Object.assign({},UV),s);let o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const l=a.metadata;typeof Blob<"u"&&i instanceof Blob?(n=new FormData,n.append("cacheControl",a.cacheControl),l&&n.append("metadata",this.encodeMetadata(l)),n.append("",i)):typeof FormData<"u"&&i instanceof FormData?(n=i,n.append("cacheControl",a.cacheControl),l&&n.append("metadata",this.encodeMetadata(l))):(n=i,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,l&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),s!=null&&s.headers&&(o=Object.assign(Object.assign({},o),s.headers));const c=this._removeEmptyFolders(t),u=this._getFinalPath(c),h=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:n,headers:o},a!=null&&a.duplex?{duplex:a.duplex}:{})),d=yield h.json();return h.ok?{data:{path:c,id:d.Id,fullPath:d.Key},error:null}:{data:null,error:d}}catch(n){if(Wi(n))return{data:null,error:n};throw n}})}upload(e,t,i){return $r(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,i)})}uploadToSignedUrl(e,t,i,s){return $r(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),a=this._getFinalPath(n),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let l;const c=Object.assign({upsert:UV.upsert},s),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&i instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",i)):typeof FormData<"u"&&i instanceof FormData?(l=i,l.append("cacheControl",c.cacheControl)):(l=i,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const h=yield this.fetch(o.toString(),{method:"PUT",body:l,headers:u}),d=yield h.json();return h.ok?{data:{path:n,fullPath:d.Key},error:null}:{data:null,error:d}}catch(l){if(Wi(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return $r(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e);const s=Object.assign({},this.headers);t!=null&&t.upsert&&(s["x-upsert"]="true");const n=yield Ml(this.fetch,`${this.url}/object/upload/sign/${i}`,{},{headers:s}),a=new URL(this.url+n.url),o=a.searchParams.get("token");if(!o)throw new Z3("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:o},error:null}}catch(i){if(Wi(i))return{data:null,error:i};throw i}})}update(e,t,i){return $r(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,i)})}move(e,t,i){return $r(this,void 0,void 0,function*(){try{return{data:yield Ml(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:i==null?void 0:i.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(Wi(s))return{data:null,error:s};throw s}})}copy(e,t,i){return $r(this,void 0,void 0,function*(){try{return{data:{path:(yield Ml(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:i==null?void 0:i.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(Wi(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,i){return $r(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),n=yield Ml(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},i!=null&&i.transform?{transform:i.transform}:{}),{headers:this.headers});const a=i!=null&&i.download?`&download=${i.download===!0?"":i.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${a}`)},{data:n,error:null}}catch(s){if(Wi(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,i){return $r(this,void 0,void 0,function*(){try{const s=yield Ml(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=i!=null&&i.download?`&download=${i.download===!0?"":i.download}`:"";return{data:s.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${n}`):null})),error:null}}catch(s){if(Wi(s))return{data:null,error:s};throw s}})}download(e,t){return $r(this,void 0,void 0,function*(){const s=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),a=n?`?${n}`:"";try{const o=this._getFinalPath(e);return{data:yield(yield $b(this.fetch,`${this.url}/${s}/${o}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(Wi(o))return{data:null,error:o};throw o}})}info(e){return $r(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const i=yield $b(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:j2(i),error:null}}catch(i){if(Wi(i))return{data:null,error:i};throw i}})}exists(e){return $r(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield o2e(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(i){if(Wi(i)&&i instanceof V2){const s=i.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:i}}throw i}})}getPublicUrl(e,t){const i=this._getFinalPath(e),s=[],n=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";n!==""&&s.push(n);const o=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&s.push(l);let c=s.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${i}${c}`)}}}remove(e){return $r(this,void 0,void 0,function*(){try{return{data:yield hK(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Wi(t))return{data:null,error:t};throw t}})}list(e,t,i){return $r(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},l2e),t),{prefix:e||""});return{data:yield Ml(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},i),error:null}}catch(s){if(Wi(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const u2e="2.7.1",h2e={"X-Client-Info":`storage-js/${u2e}`};var wd=function(r,e,t,i){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(i.next(u))}catch(h){a(h)}}function l(u){try{c(i.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):s(u.value).then(o,l)}c((i=i.apply(r,e||[])).next())})};class d2e{constructor(e,t={},i){this.url=e,this.headers=Object.assign(Object.assign({},h2e),t),this.fetch=uK(i)}listBuckets(){return wd(this,void 0,void 0,function*(){try{return{data:yield $b(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Wi(e))return{data:null,error:e};throw e}})}getBucket(e){return wd(this,void 0,void 0,function*(){try{return{data:yield $b(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Wi(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return wd(this,void 0,void 0,function*(){try{return{data:yield Ml(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(i){if(Wi(i))return{data:null,error:i};throw i}})}updateBucket(e,t){return wd(this,void 0,void 0,function*(){try{return{data:yield a2e(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(i){if(Wi(i))return{data:null,error:i};throw i}})}emptyBucket(e){return wd(this,void 0,void 0,function*(){try{return{data:yield Ml(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Wi(t))return{data:null,error:t};throw t}})}deleteBucket(e){return wd(this,void 0,void 0,function*(){try{return{data:yield hK(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Wi(t))return{data:null,error:t};throw t}})}}class f2e extends d2e{constructor(e,t={},i){super(e,t,i)}from(e){return new c2e(this.url,this.headers,e,this.fetch)}}const p2e="2.50.3";let Rg="";typeof Deno<"u"?Rg="deno":typeof document<"u"?Rg="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Rg="react-native":Rg="node";const m2e={"X-Client-Info":`supabase-js-${Rg}/${p2e}`},g2e={headers:m2e},_2e={schema:"public"},v2e={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},y2e={};var S2e=function(r,e,t,i){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(i.next(u))}catch(h){a(h)}}function l(u){try{c(i.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):s(u.value).then(o,l)}c((i=i.apply(r,e||[])).next())})};const x2e=r=>{let e;return r?e=r:typeof fetch>"u"?e=YY:e=fetch,(...t)=>e(...t)},b2e=()=>typeof Headers>"u"?KY:Headers,w2e=(r,e,t)=>{const i=x2e(t),s=b2e();return(n,a)=>S2e(void 0,void 0,void 0,function*(){var o;const l=(o=yield e())!==null&&o!==void 0?o:r;let c=new s(a==null?void 0:a.headers);return c.has("apikey")||c.set("apikey",r),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),i(n,Object.assign(Object.assign({},a),{headers:c}))})};var T2e=function(r,e,t,i){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(i.next(u))}catch(h){a(h)}}function l(u){try{c(i.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):s(u.value).then(o,l)}c((i=i.apply(r,e||[])).next())})};function E2e(r){return r.endsWith("/")?r:r+"/"}function A2e(r,e){var t,i;const{db:s,auth:n,realtime:a,global:o}=r,{db:l,auth:c,realtime:u,global:h}=e,d={db:Object.assign(Object.assign({},l),s),auth:Object.assign(Object.assign({},c),n),realtime:Object.assign(Object.assign({},u),a),global:Object.assign(Object.assign(Object.assign({},h),o),{headers:Object.assign(Object.assign({},(t=h==null?void 0:h.headers)!==null&&t!==void 0?t:{}),(i=o==null?void 0:o.headers)!==null&&i!==void 0?i:{})}),accessToken:()=>T2e(this,void 0,void 0,function*(){return""})};return r.accessToken?d.accessToken=r.accessToken:delete d.accessToken,d}const dK="2.70.0",Ld=30*1e3,$2=3,eP=$2*Ld,C2e="http://localhost:9999",P2e="supabase.auth.token",I2e={"X-Client-Info":`gotrue-js/${dK}`},H2="X-Supabase-Api-Version",fK={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},M2e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,R2e=6e5;class Q3 extends Error{constructor(e,t,i){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=i}}function De(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class D2e extends Q3{constructor(e,t,i){super(e,t,i),this.name="AuthApiError",this.status=t,this.code=i}}function L2e(r){return De(r)&&r.name==="AuthApiError"}class pK extends Q3{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Dc extends Q3{constructor(e,t,i,s){super(e,i,s),this.name=t,this.status=i}}class El extends Dc{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function O2e(r){return De(r)&&r.name==="AuthSessionMissingError"}class gS extends Dc{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class _S extends Dc{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class vS extends Dc{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function N2e(r){return De(r)&&r.name==="AuthImplicitGrantRedirectError"}class zV extends Dc{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class G2 extends Dc{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function tP(r){return De(r)&&r.name==="AuthRetryableFetchError"}class VV extends Dc{constructor(e,t,i){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=i}}class s_ extends Dc{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Hb="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),jV=` 	
\r=`.split(""),k2e=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<jV.length;e+=1)r[jV[e].charCodeAt(0)]=-2;for(let e=0;e<Hb.length;e+=1)r[Hb[e].charCodeAt(0)]=e;return r})();function $V(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const i=e.queue>>e.queuedBits-6&63;t(Hb[i]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const i=e.queue>>e.queuedBits-6&63;t(Hb[i]),e.queuedBits-=6}}function mK(r,e,t){const i=k2e[r];if(i>-1)for(e.queue=e.queue<<6|i,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(i===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function HV(r){const e=[],t=a=>{e.push(String.fromCodePoint(a))},i={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},n=a=>{U2e(a,i,t)};for(let a=0;a<r.length;a+=1)mK(r.charCodeAt(a),s,n);return e.join("")}function F2e(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function B2e(r,e){for(let t=0;t<r.length;t+=1){let i=r.charCodeAt(t);if(i>55295&&i<=56319){const s=(i-55296)*1024&65535;i=(r.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}F2e(i,e)}}function U2e(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let i=1;i<6;i+=1)if(!(r>>7-i&1)){e.utf8seq=i;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function z2e(r){const e=[],t={queue:0,queuedBits:0},i=s=>{e.push(s)};for(let s=0;s<r.length;s+=1)mK(r.charCodeAt(s),t,i);return new Uint8Array(e)}function V2e(r){const e=[];return B2e(r,t=>e.push(t)),new Uint8Array(e)}function j2e(r){const e=[],t={queue:0,queuedBits:0},i=s=>{e.push(s)};return r.forEach(s=>$V(s,t,i)),$V(null,t,i),e.join("")}function $2e(r){return Math.round(Date.now()/1e3)+r}function H2e(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const An=()=>typeof window<"u"&&typeof document<"u",Qc={tested:!1,writable:!1},n_=()=>{if(!An())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Qc.tested)return Qc.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),Qc.tested=!0,Qc.writable=!0}catch{Qc.tested=!0,Qc.writable=!1}return Qc.writable};function G2e(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,n)=>{e[n]=s})}catch{}return t.searchParams.forEach((i,s)=>{e[s]=i}),e}const gK=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Ty(async()=>{const{default:i}=await Promise.resolve().then(()=>ky);return{default:i}},void 0).then(({default:i})=>i(...t)):e=fetch,(...t)=>e(...t)},W2e=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",_K=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},yS=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},SS=async(r,e)=>{await r.removeItem(e)};class JE{constructor(){this.promise=new JE.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}JE.promiseConstructor=Promise;function iP(r){const e=r.split(".");if(e.length!==3)throw new s_("Invalid JWT structure");for(let i=0;i<e.length;i++)if(!M2e.test(e[i]))throw new s_("JWT not in base64url format");return{header:JSON.parse(HV(e[0])),payload:JSON.parse(HV(e[1])),signature:z2e(e[2]),raw:{header:e[0],payload:e[1]}}}async function X2e(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function q2e(r,e){return new Promise((i,s)=>{(async()=>{for(let n=0;n<1/0;n++)try{const a=await r(n);if(!e(n,null,a)){i(a);return}}catch(a){if(!e(n,a)){s(a);return}}})()})}function Y2e(r){return("0"+r.toString(16)).substr(-2)}function K2e(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",i=t.length;let s="";for(let n=0;n<56;n++)s+=t.charAt(Math.floor(Math.random()*i));return s}return crypto.getRandomValues(e),Array.from(e,Y2e).join("")}async function Z2e(r){const t=new TextEncoder().encode(r),i=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(i);return Array.from(s).map(n=>String.fromCharCode(n)).join("")}async function Q2e(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await Z2e(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Td(r,e,t=!1){const i=K2e();let s=i;t&&(s+="/PASSWORD_RECOVERY"),await _K(r,`${e}-code-verifier`,s);const n=await Q2e(i);return[n,i===n?"plain":"s256"]}const J2e=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function eRe(r){const e=r.headers.get(H2);if(!e||!e.match(J2e))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function tRe(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function iRe(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const rRe=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ed(r){if(!rRe.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}var sRe=function(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(r);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(t[i[s]]=r[i[s]]);return t};const ou=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),nRe=[502,503,504];async function GV(r){var e;if(!W2e(r))throw new G2(ou(r),0);if(nRe.includes(r.status))throw new G2(ou(r),r.status);let t;try{t=await r.json()}catch(n){throw new pK(ou(n),n)}let i;const s=eRe(r);if(s&&s.getTime()>=fK["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?i=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(i=t.error_code),i){if(i==="weak_password")throw new VV(ou(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(i==="session_not_found")throw new El}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((n,a)=>n&&typeof a=="string",!0))throw new VV(ou(t),r.status,t.weak_password.reasons);throw new D2e(ou(t),r.status||500,i)}const aRe=(r,e,t,i)=>{const s={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(i),Object.assign(Object.assign({},s),t))};async function Ve(r,e,t,i){var s;const n=Object.assign({},i==null?void 0:i.headers);n[H2]||(n[H2]=fK["2024-01-01"].name),i!=null&&i.jwt&&(n.Authorization=`Bearer ${i.jwt}`);const a=(s=i==null?void 0:i.query)!==null&&s!==void 0?s:{};i!=null&&i.redirectTo&&(a.redirect_to=i.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await oRe(r,e,t+o,{headers:n,noResolveJson:i==null?void 0:i.noResolveJson},{},i==null?void 0:i.body);return i!=null&&i.xform?i==null?void 0:i.xform(l):{data:Object.assign({},l),error:null}}async function oRe(r,e,t,i,s,n){const a=aRe(e,i,s,n);let o;try{o=await r(t,Object.assign({},a))}catch(l){throw console.error(l),new G2(ou(l),0)}if(o.ok||await GV(o),i!=null&&i.noResolveJson)return o;try{return await o.json()}catch(l){await GV(l)}}function go(r){var e;let t=null;hRe(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=$2e(r.expires_in)));const i=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:i},error:null}}function WV(r){const e=go(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,i)=>t&&typeof i=="string",!0)&&(e.data.weak_password=r.weak_password),e}function Wl(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function lRe(r){return{data:r,error:null}}function cRe(r){const{action_link:e,email_otp:t,hashed_token:i,redirect_to:s,verification_type:n}=r,a=sRe(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:i,redirect_to:s,verification_type:n},l=Object.assign({},a);return{data:{properties:o,user:l},error:null}}function uRe(r){return r}function hRe(r){return r.access_token&&r.refresh_token&&r.expires_in}const rP=["global","local","others"];var dRe=function(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(r);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(t[i[s]]=r[i[s]]);return t};class fRe{constructor({url:e="",headers:t={},fetch:i}){this.url=e,this.headers=t,this.fetch=gK(i),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=rP[0]){if(rP.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${rP.join(", ")}`);try{return await Ve(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(i){if(De(i))return{data:null,error:i};throw i}}async inviteUserByEmail(e,t={}){try{return await Ve(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Wl})}catch(i){if(De(i))return{data:{user:null},error:i};throw i}}async generateLink(e){try{const{options:t}=e,i=dRe(e,["options"]),s=Object.assign(Object.assign({},i),t);return"newEmail"in i&&(s.new_email=i==null?void 0:i.newEmail,delete s.newEmail),await Ve(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:cRe,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(De(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Ve(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Wl})}catch(t){if(De(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,i,s,n,a,o,l;try{const c={nextPage:null,lastPage:0,total:0},u=await Ve(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&i!==void 0?i:"",per_page:(n=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&n!==void 0?n:""},xform:uRe});if(u.error)throw u.error;const h=await u.json(),d=(a=u.headers.get("x-total-count"))!==null&&a!==void 0?a:0,f=(l=(o=u.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(p=>{const m=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),g=JSON.parse(p.split(";")[1].split("=")[1]);c[`${g}Page`]=m}),c.total=parseInt(d)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(c){if(De(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){Ed(e);try{return await Ve(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Wl})}catch(t){if(De(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Ed(e);try{return await Ve(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Wl})}catch(i){if(De(i))return{data:{user:null},error:i};throw i}}async deleteUser(e,t=!1){Ed(e);try{return await Ve(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Wl})}catch(i){if(De(i))return{data:{user:null},error:i};throw i}}async _listFactors(e){Ed(e.userId);try{const{data:t,error:i}=await Ve(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:i}}catch(t){if(De(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Ed(e.userId),Ed(e.id);try{return{data:await Ve(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(De(t))return{data:null,error:t};throw t}}}const pRe={getItem:r=>n_()?globalThis.localStorage.getItem(r):null,setItem:(r,e)=>{n_()&&globalThis.localStorage.setItem(r,e)},removeItem:r=>{n_()&&globalThis.localStorage.removeItem(r)}};function XV(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function mRe(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Ad={debug:!!(globalThis&&n_()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class vK extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class gRe extends vK{}async function _Re(r,e,t){Ad.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const i=new globalThis.AbortController;return e>0&&setTimeout(()=>{i.abort(),Ad.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:i.signal},async s=>{if(s){Ad.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,s.name);try{return await t()}finally{Ad.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,s.name)}}else{if(e===0)throw Ad.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new gRe(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(Ad.debug)try{const n=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(n,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}mRe();const vRe={url:C2e,storageKey:P2e,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:I2e,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function qV(r,e,t){return await t()}class hv{constructor(e){var t,i;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=hv.nextInstanceID,hv.nextInstanceID+=1,this.instanceID>0&&An()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},vRe),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new fRe({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=gK(s.fetch),this.lock=s.lock||qV,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:An()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=_Re:this.lock=qV,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:n_()?this.storage=pRe:(this.memoryStorage={},this.storage=XV(this.memoryStorage)):(this.memoryStorage={},this.storage=XV(this.memoryStorage)),An()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",n)}(i=this.broadcastChannel)===null||i===void 0||i.addEventListener("message",async n=>{this._debug("received broadcast notification from other tab or client",n),await this._notifyAllSubscribers(n.data.event,n.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${dK}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=G2e(window.location.href);let i="none";if(this._isImplicitGrantCallback(t)?i="implicit":await this._isPKCECallback(t)&&(i="pkce"),An()&&this.detectSessionInUrl&&i!=="none"){const{data:s,error:n}=await this._getSessionFromURL(t,i);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),N2e(n)){const l=(e=n.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:n}}return await this._removeSession(),{error:n}}const{session:a,redirectType:o}=s;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return De(t)?{error:t}:{error:new pK("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,i,s;try{const n=await Ve(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(i=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:go}),{data:a,error:o}=n;if(o||!a)return{data:{user:null,session:null},error:o};const l=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(n){if(De(n))return{data:{user:null,session:null},error:n};throw n}}async signUp(e){var t,i,s;try{let n;if("email"in e){const{email:u,password:h,options:d}=e;let f=null,p=null;this.flowType==="pkce"&&([f,p]=await Td(this.storage,this.storageKey)),n=await Ve(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d==null?void 0:d.emailRedirectTo,body:{email:u,password:h,data:(t=d==null?void 0:d.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken},code_challenge:f,code_challenge_method:p},xform:go})}else if("phone"in e){const{phone:u,password:h,options:d}=e;n=await Ve(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(i=d==null?void 0:d.data)!==null&&i!==void 0?i:{},channel:(s=d==null?void 0:d.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:go})}else throw new _S("You must provide either an email or phone number and a password");const{data:a,error:o}=n;if(o||!a)return{data:{user:null,session:null},error:o};const l=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(n){if(De(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(e){try{let t;if("email"in e){const{email:n,password:a,options:o}=e;t=await Ve(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:WV})}else if("phone"in e){const{phone:n,password:a,options:o}=e;t=await Ve(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:WV})}else throw new _S("You must provide either an email or phone number and a password");const{data:i,error:s}=t;return s?{data:{user:null,session:null},error:s}:!i||!i.session||!i.user?{data:{user:null,session:null},error:new gS}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign({user:i.user,session:i.session},i.weak_password?{weakPassword:i.weak_password}:null),error:s})}catch(t){if(De(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,i,s,n;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(i=e.options)===null||i===void 0?void 0:i.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(n=e.options)===null||n===void 0?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,i,s,n,a,o,l,c,u,h,d,f;let p,m;if("message"in e)p=e.message,m=e.signature;else{const{chain:g,wallet:_,statement:v,options:y}=e;let x;if(An())if(typeof _=="object")x=_;else{const w=window;if("solana"in w&&typeof w.solana=="object"&&("signIn"in w.solana&&typeof w.solana.signIn=="function"||"signMessage"in w.solana&&typeof w.solana.signMessage=="function"))x=w.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof _!="object"||!(y!=null&&y.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");x=_}const S=new URL((t=y==null?void 0:y.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in x&&x.signIn){const w=await x.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},y==null?void 0:y.signInWithSolana),{version:"1",domain:S.host,uri:S.href}),v?{statement:v}:null));let T;if(Array.isArray(w)&&w[0]&&typeof w[0]=="object")T=w[0];else if(w&&typeof w=="object"&&"signedMessage"in w&&"signature"in w)T=w;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in T&&"signature"in T&&(typeof T.signedMessage=="string"||T.signedMessage instanceof Uint8Array)&&T.signature instanceof Uint8Array)p=typeof T.signedMessage=="string"?T.signedMessage:new TextDecoder().decode(T.signedMessage),m=T.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in x)||typeof x.signMessage!="function"||!("publicKey"in x)||typeof x!="object"||!x.publicKey||!("toBase58"in x.publicKey)||typeof x.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");p=[`${S.host} wants you to sign in with your Solana account:`,x.publicKey.toBase58(),...v?["",v,""]:[""],"Version: 1",`URI: ${S.href}`,`Issued At: ${(s=(i=y==null?void 0:y.signInWithSolana)===null||i===void 0?void 0:i.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((n=y==null?void 0:y.signInWithSolana)===null||n===void 0)&&n.notBefore?[`Not Before: ${y.signInWithSolana.notBefore}`]:[],...!((a=y==null?void 0:y.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${y.signInWithSolana.expirationTime}`]:[],...!((o=y==null?void 0:y.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${y.signInWithSolana.chainId}`]:[],...!((l=y==null?void 0:y.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${y.signInWithSolana.nonce}`]:[],...!((c=y==null?void 0:y.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${y.signInWithSolana.requestId}`]:[],...!((h=(u=y==null?void 0:y.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||h===void 0)&&h.length?["Resources",...y.signInWithSolana.resources.map(T=>`- ${T}`)]:[]].join(`
`);const w=await x.signMessage(new TextEncoder().encode(p),"utf8");if(!w||!(w instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");m=w}}try{const{data:g,error:_}=await Ve(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:p,signature:j2e(m)},!((d=e.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:go});if(_)throw _;return!g||!g.session||!g.user?{data:{user:null,session:null},error:new gS}:(g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),{data:Object.assign({},g),error:_})}catch(g){if(De(g))return{data:{user:null,session:null},error:g};throw g}}async _exchangeCodeForSession(e){const t=await yS(this.storage,`${this.storageKey}-code-verifier`),[i,s]=(t??"").split("/");try{const{data:n,error:a}=await Ve(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:i},xform:go});if(await SS(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!n||!n.session||!n.user?{data:{user:null,session:null,redirectType:null},error:new gS}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign(Object.assign({},n),{redirectType:s??null}),error:a})}catch(n){if(De(n))return{data:{user:null,session:null,redirectType:null},error:n};throw n}}async signInWithIdToken(e){try{const{options:t,provider:i,token:s,access_token:n,nonce:a}=e,o=await Ve(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:i,id_token:s,access_token:n,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:go}),{data:l,error:c}=o;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new gS}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(t){if(De(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,i,s,n,a;try{if("email"in e){const{email:o,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await Td(this.storage,this.storageKey));const{error:h}=await Ve(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(i=l==null?void 0:l.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:o,options:l}=e,{data:c,error:u}=await Ve(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(s=l==null?void 0:l.data)!==null&&s!==void 0?s:{},create_user:(n=l==null?void 0:l.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(a=l==null?void 0:l.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:u}}throw new _S("You must provide either an email or phone number.")}catch(o){if(De(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,i;try{let s,n;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,n=(i=e.options)===null||i===void 0?void 0:i.captchaToken);const{data:a,error:o}=await Ve(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:s,xform:go});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const l=a.session,c=a.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(De(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,i,s;try{let n=null,a=null;return this.flowType==="pkce"&&([n,a]=await Td(this.storage,this.storageKey)),await Ve(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&i!==void 0?i:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:a}),headers:this.headers,xform:lRe})}catch(n){if(De(n))return{data:null,error:n};throw n}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:i}=e;if(i)throw i;if(!t)throw new El;const{error:s}=await Ve(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(De(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:i,type:s,options:n}=e,{error:a}=await Ve(this.fetch,"POST",t,{headers:this.headers,body:{email:i,type:s,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},redirectTo:n==null?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:i,type:s,options:n}=e,{data:a,error:o}=await Ve(this.fetch,"POST",t,{headers:this.headers,body:{phone:i,type:s,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o}}throw new _S("You must provide either an email or phone number and a type")}catch(t){if(De(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const i=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await i,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const i=t();for(this.pendingInLock.push((async()=>{try{await i}catch{}})()),await i;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await i}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await yS(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const i=e.expires_at?e.expires_at*1e3-Date.now()<eP:!1;if(this._debug("#__loadSession()",`session has${i?"":" not"} expired`,"expires_at",e.expires_at),!i){if(this.storage.isServer){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,u)=>(!a&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,u))})}return{data:{session:e},error:null}}const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await Ve(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Wl}):await this._useSession(async t=>{var i,s,n;const{data:a,error:o}=t;if(o)throw o;return!(!((i=a.session)===null||i===void 0)&&i.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new El}:await Ve(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(n=(s=a.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0,xform:Wl})})}catch(t){if(De(t))return O2e(t)&&(await this._removeSession(),await SS(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async i=>{const{data:s,error:n}=i;if(n)throw n;if(!s.session)throw new El;const a=s.session;let o=null,l=null;this.flowType==="pkce"&&e.email!=null&&([o,l]=await Td(this.storage,this.storageKey));const{data:c,error:u}=await Ve(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:l}),jwt:a.access_token,xform:Wl});if(u)throw u;return a.user=c.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(i){if(De(i))return{data:{user:null},error:i};throw i}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new El;const t=Date.now()/1e3;let i=t,s=!0,n=null;const{payload:a}=iP(e.access_token);if(a.exp&&(i=a.exp,s=i<=t),s){const{session:o,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!o)return{data:{user:null,session:null},error:null};n=o}else{const{data:o,error:l}=await this._getUser(e.access_token);if(l)throw l;n={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:i-t,expires_at:i},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if(De(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var i;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(i=a.session)!==null&&i!==void 0?i:void 0}if(!(e!=null&&e.refresh_token))throw new El;const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(De(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!An())throw new vS("No browser detected.");if(e.error||e.error_description||e.error_code)throw new vS(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new zV("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new vS("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new zV("No code detected.");const{data:v,error:y}=await this._exchangeCodeForSession(e.code);if(y)throw y;const x=new URL(window.location.href);return x.searchParams.delete("code"),window.history.replaceState(window.history.state,"",x.toString()),{data:{session:v.session,redirectType:null},error:null}}const{provider_token:i,provider_refresh_token:s,access_token:n,refresh_token:a,expires_in:o,expires_at:l,token_type:c}=e;if(!n||!o||!a||!c)throw new vS("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(o);let d=u+h;l&&(d=parseInt(l));const f=d-u;f*1e3<=Ld&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${h}s`);const p=d-h;u-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,d,u):u-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,d,u);const{data:m,error:g}=await this._getUser(n);if(g)throw g;const _={provider_token:i,provider_refresh_token:s,access_token:n,expires_in:h,expires_at:d,refresh_token:a,token_type:c,user:m.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:_,redirectType:e.type},error:null}}catch(i){if(De(i))return{data:{session:null,redirectType:null},error:i};throw i}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await yS(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var i;const{data:s,error:n}=t;if(n)return{error:n};const a=(i=s.session)===null||i===void 0?void 0:i.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(L2e(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return e!=="others"&&(await this._removeSession(),await SS(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=H2e(),i={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,i),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:i}}}async _emitInitialSession(e){return await this._useSession(async t=>{var i,s;try{const{data:{session:n},error:a}=t;if(a)throw a;await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(n){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let i=null,s=null;this.flowType==="pkce"&&([i,s]=await Td(this.storage,this.storageKey,!0));try{return await Ve(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:i,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(De(n))return{data:null,error:n};throw n}}async getUserIdentities(){var e;try{const{data:t,error:i}=await this.getUser();if(i)throw i;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(De(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:i,error:s}=await this._useSession(async n=>{var a,o,l,c,u;const{data:h,error:d}=n;if(d)throw d;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await Ve(this.fetch,"GET",f,{headers:this.headers,jwt:(u=(c=h.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(s)throw s;return An()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(i==null?void 0:i.url),{data:{provider:e.provider,url:i==null?void 0:i.url},error:null}}catch(i){if(De(i))return{data:{provider:e.provider,url:null},error:i};throw i}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var i,s;const{data:n,error:a}=t;if(a)throw a;return await Ve(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(i=n.session)===null||i===void 0?void 0:i.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(De(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const i=Date.now();return await q2e(async s=>(s>0&&await X2e(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await Ve(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:go})),(s,n)=>{const a=200*Math.pow(2,s);return n&&tP(n)&&Date.now()+a-i<Ld})}catch(i){if(this._debug(t,"error",i),De(i))return{data:{session:null,user:null},error:i};throw i}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const i=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",i),An()&&!t.skipBrowserRedirect&&window.location.assign(i),{data:{provider:e,url:i},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const i=await yS(this.storage,this.storageKey);if(this._debug(t,"session from storage",i),!this._isValidSession(i)){this._debug(t,"session is not valid"),i!==null&&await this._removeSession();return}const s=((e=i.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<eP;if(this._debug(t,`session has${s?"":" not"} expired with margin of ${eP}s`),s){if(this.autoRefreshToken&&i.refresh_token){const{error:n}=await this._callRefreshToken(i.refresh_token);n&&(console.error(n),tP(n)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",n),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(t,"error",i),console.error(i);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,i;if(!e)throw new El;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new JE;const{data:n,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!n.session)throw new El;await this._saveSession(n.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",n.session);const o={session:n.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(n){if(this._debug(s,"error",n),De(n)){const a={session:null,error:n};return tP(n)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(i=this.refreshingDeferred)===null||i===void 0||i.reject(n),n}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,i=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${i}`);try{this.broadcastChannel&&i&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(l){n.push(l)}});if(await Promise.all(a),n.length>0){for(let o=0;o<n.length;o+=1)console.error(n[o]);throw n[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await _K(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await SS(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&An()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Ld);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:i}}=t;if(!i||!i.refresh_token||!i.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((i.expires_at*1e3-e)/Ld);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Ld}ms, refresh threshold is ${$2} ticks`),s<=$2&&await this._callRefreshToken(i.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof vK)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!An()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,i){const s=[`provider=${encodeURIComponent(t)}`];if(i!=null&&i.redirectTo&&s.push(`redirect_to=${encodeURIComponent(i.redirectTo)}`),i!=null&&i.scopes&&s.push(`scopes=${encodeURIComponent(i.scopes)}`),this.flowType==="pkce"){const[n,a]=await Td(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(n)}`,code_challenge_method:`${encodeURIComponent(a)}`});s.push(o.toString())}if(i!=null&&i.queryParams){const n=new URLSearchParams(i.queryParams);s.push(n.toString())}return i!=null&&i.skipBrowserRedirect&&s.push(`skip_http_redirect=${i.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var i;const{data:s,error:n}=t;return n?{data:null,error:n}:await Ve(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(i=s==null?void 0:s.session)===null||i===void 0?void 0:i.access_token})})}catch(t){if(De(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var i,s;const{data:n,error:a}=t;if(a)return{data:null,error:a};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await Ve(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(i=n==null?void 0:n.session)===null||i===void 0?void 0:i.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((s=l==null?void 0:l.totp)===null||s===void 0)&&s.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if(De(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var i;const{data:s,error:n}=t;if(n)return{data:null,error:n};const{data:a,error:o}=await Ve(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(i=s==null?void 0:s.session)===null||i===void 0?void 0:i.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(t){if(De(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var i;const{data:s,error:n}=t;return n?{data:null,error:n}:await Ve(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(i=s==null?void 0:s.session)===null||i===void 0?void 0:i.access_token})})}catch(t){if(De(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:i}=await this._challenge({factorId:e.factorId});return i?{data:null,error:i}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const i=(e==null?void 0:e.factors)||[],s=i.filter(a=>a.factor_type==="totp"&&a.status==="verified"),n=i.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:i,totp:s,phone:n},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,i;const{data:{session:s},error:n}=e;if(n)return{data:null,error:n};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=iP(s.access_token);let o=null;a.aal&&(o=a.aal);let l=o;((i=(t=s.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&i!==void 0?i:[]).length>0&&(l="aal2");const u=a.amr||[];return{data:{currentLevel:o,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,t={keys:[]}){let i=t.keys.find(a=>a.kid===e);if(i||(i=this.jwks.keys.find(a=>a.kid===e),i&&this.jwks_cached_at+R2e>Date.now()))return i;const{data:s,error:n}=await Ve(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(n)throw n;if(!s.keys||s.keys.length===0)throw new s_("JWKS is empty");if(this.jwks=s,this.jwks_cached_at=Date.now(),i=s.keys.find(a=>a.kid===e),!i)throw new s_("No matching signing key found in JWKS");return i}async getClaims(e,t={keys:[]}){try{let i=e;if(!i){const{data:f,error:p}=await this.getSession();if(p||!f.session)return{data:null,error:p};i=f.session.access_token}const{header:s,payload:n,signature:a,raw:{header:o,payload:l}}=iP(i);if(tRe(n.exp),!s.kid||s.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:f}=await this.getUser(i);if(f)throw f;return{data:{claims:n,header:s,signature:a},error:null}}const c=iRe(s.alg),u=await this.fetchJwk(s.kid,t),h=await crypto.subtle.importKey("jwk",u,c,!0,["verify"]);if(!await crypto.subtle.verify(c,h,a,V2e(`${o}.${l}`)))throw new s_("Invalid JWT signature");return{data:{claims:n,header:s,signature:a},error:null}}catch(i){if(De(i))return{data:null,error:i};throw i}}}hv.nextInstanceID=0;const yRe=hv;class SRe extends yRe{constructor(e){super(e)}}var xRe=function(r,e,t,i){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(i.next(u))}catch(h){a(h)}}function l(u){try{c(i.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):s(u.value).then(o,l)}c((i=i.apply(r,e||[])).next())})};class bRe{constructor(e,t,i){var s,n,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const o=E2e(e),l=new URL(o);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,u={db:_2e,realtime:y2e,auth:Object.assign(Object.assign({},v2e),{storageKey:c}),global:g2e},h=A2e(i??{},u);this.storageKey=(s=h.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(n=h.global.headers)!==null&&n!==void 0?n:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(d,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=h.auth)!==null&&a!==void 0?a:{},this.headers,h.global.fetch),this.fetch=w2e(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new UMe(new URL("rest/v1",l).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),h.accessToken||this._listenForAuthEvents()}get functions(){return new mMe(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new f2e(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},i={}){return this.rest.rpc(e,t,i)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return xRe(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:i}=yield this.auth.getSession();return(t=(e=i.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:i,storage:s,storageKey:n,flowType:a,lock:o,debug:l},c,u){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new SRe({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),c),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:i,storage:s,flowType:a,lock:o,debug:l,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new e2e(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,i)=>{this._handleTokenChanged(t,"CLIENT",i==null?void 0:i.access_token)})}_handleTokenChanged(e,t,i){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==i?this.changedAccessToken=i:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const wRe=(r,e,t)=>new bRe(r,e,t),TRe="https://ybtwcsrqofyfoskwlmug.supabase.co",ERe="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlidHdjc3Jxb2Z5Zm9za3dsbXVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAyNzcyMzQsImV4cCI6MjA2NTg1MzIzNH0.5YUQ9JqQy08Nq5k8LjujK6uZ13VYNPcK8kp1pLvAHgg",nt=wRe(TRe,ERe),ti=E.forwardRef(({className:r,type:e,...t},i)=>b.jsx("input",{type:e,className:ye("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:i,...t}));ti.displayName="Input";const yK=E.forwardRef(({className:r,...e},t)=>b.jsx("textarea",{className:ye("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...e}));yK.displayName="Textarea";var ARe="Label",SK=E.forwardRef((r,e)=>b.jsx(Ee.label,{...r,ref:e,onMouseDown:t=>{var s;t.target.closest("button, input, select, textarea")||((s=r.onMouseDown)==null||s.call(r,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));SK.displayName=ARe;var xK=SK;const CRe=kT("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Ht=E.forwardRef(({className:r,...e},t)=>b.jsx(xK,{ref:t,className:ye(CRe(),r),...e}));Ht.displayName=xK.displayName;const PRe=({menuItemId:r,menuItemTitle:e,onClose:t,onSubmit:i})=>{const[s,n]=E.useState(""),[a,o]=E.useState(""),[l,c]=E.useState(0),[u,h]=E.useState(""),[d,f]=E.useState(0),[p,m]=E.useState(!1),{toast:g}=Ar(),_=async y=>{if(y.preventDefault(),!s.trim()||l===0){g({title:"Missing information",description:"Please provide your name and rating.",variant:"destructive"});return}m(!0);try{const{error:x}=await nt.from("menu_item_reviews").insert({menu_item_id:r,customer_name:s.trim(),customer_email:a.trim()||null,rating:l,review_text:u.trim()||null});if(x)throw x;i()}catch(x){g({title:"Error submitting review",description:x.message,variant:"destructive"})}finally{m(!1)}},v=()=>b.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(y=>b.jsx("button",{type:"button",className:"focus:outline-none",onMouseEnter:()=>f(y),onMouseLeave:()=>f(0),onClick:()=>c(y),children:b.jsx(ip,{className:`w-8 h-8 transition-colors ${y<=(d||l)?"text-yellow-400 fill-yellow-400":"text-gray-300 hover:text-yellow-200"}`})},y))});return b.jsx(wO,{open:!0,onOpenChange:t,children:b.jsxs(eE,{className:"sm:max-w-md",children:[b.jsx(tE,{children:b.jsxs(iE,{children:["Review: ",e]})}),b.jsxs("form",{onSubmit:_,className:"space-y-4",children:[b.jsxs("div",{className:"space-y-2",children:[b.jsx(Ht,{htmlFor:"name",children:"Your Name *"}),b.jsx(ti,{id:"name",value:s,onChange:y=>n(y.target.value),placeholder:"Enter your name",required:!0})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(Ht,{htmlFor:"email",children:"Email (optional)"}),b.jsx(ti,{id:"email",type:"email",value:a,onChange:y=>o(y.target.value),placeholder:"Enter your email"})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(Ht,{children:"Rating *"}),b.jsxs("div",{className:"flex items-center gap-2",children:[v(),b.jsx("span",{className:"text-sm text-gray-600 ml-2",children:l>0?`${l} star${l!==1?"s":""}`:"Click to rate"})]})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(Ht,{htmlFor:"review",children:"Your Review (optional)"}),b.jsx(yK,{id:"review",value:u,onChange:y=>h(y.target.value),placeholder:"Share your experience with this menu item...",rows:4})]}),b.jsxs(iq,{className:"gap-2",children:[b.jsx(tt,{type:"button",variant:"outline",onClick:t,children:"Cancel"}),b.jsx(tt,{type:"submit",disabled:p,children:p?"Submitting...":"Submit Review"})]})]})]})})},IRe=({menuItemId:r,menuItemTitle:e})=>{const[t,i]=E.useState([]),[s,n]=E.useState(0),[a,o]=E.useState(0),[l,c]=E.useState(!1),[u,h]=E.useState(!0),{toast:d}=Ar();E.useEffect(()=>{f()},[r]);const f=async()=>{try{const{data:_,error:v}=await nt.from("menu_item_reviews").select("*").eq("menu_item_id",r).order("created_at",{ascending:!1});if(v)throw v;if(i(_||[]),o((_==null?void 0:_.length)||0),_&&_.length>0){const y=_.reduce((x,S)=>x+S.rating,0)/_.length;n(Math.round(y*10)/10)}else n(0)}catch(_){d({title:"Error loading reviews",description:_.message,variant:"destructive"})}finally{h(!1)}},p=()=>{c(!1),f(),d({title:"Review submitted",description:"Thank you for your feedback!"})},m=(_,v="sm")=>{const y=v==="sm"?"w-4 h-4":"w-5 h-5";return b.jsx("div",{className:"flex",children:[1,2,3,4,5].map(x=>b.jsx(ip,{className:`${y} ${x<=_?"text-yellow-400 fill-yellow-400":"text-gray-300"}`},x))})},g=_=>new Date(_).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return u?b.jsx("div",{className:"space-y-4",children:b.jsxs("div",{className:"animate-pulse",children:[b.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-2"}),b.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})}):b.jsxs("div",{className:"space-y-4",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{className:"flex items-center gap-4",children:[b.jsxs("div",{className:"flex items-center gap-1",children:[m(s,"md"),b.jsx("span",{className:"font-semibold text-lg ml-1",children:s>0?s.toFixed(1):"No ratings"})]}),b.jsxs(Eo,{variant:"secondary",className:"flex items-center gap-1",children:[b.jsx(jF,{className:"w-3 h-3"}),a," ",a===1?"review":"reviews"]})]}),b.jsx(tt,{variant:"outline",size:"sm",onClick:()=>c(!0),children:"Write a Review"})]}),l&&b.jsx(PRe,{menuItemId:r,menuItemTitle:e,onClose:()=>c(!1),onSubmit:p}),t.length>0?b.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:t.map(_=>b.jsx(Vt,{className:"border-l-4 border-l-blue-200",children:b.jsxs(jt,{className:"p-4",children:[b.jsx("div",{className:"flex items-start justify-between mb-2",children:b.jsxs("div",{children:[b.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m(_.rating),b.jsx("span",{className:"font-medium text-sm",children:_.customer_name})]}),b.jsx("p",{className:"text-xs text-gray-500",children:g(_.created_at)})]})}),_.review_text&&b.jsx("p",{className:"text-sm text-gray-700 mt-2",children:_.review_text})]})},_.id))}):b.jsxs("div",{className:"text-center py-8 text-gray-500",children:[b.jsx(jF,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),b.jsx("p",{className:"text-sm",children:"No reviews yet. Be the first to review this item!"})]})]})},MRe=({menuItemId:r,title:e,description:t,price:i,allergens:s,isVegetarian:n,isVegan:a,isGlutenFree:o,isNutFree:l,imageUrl:c,splatUrl:u,performanceMode:h,onClose:d})=>b.jsxs(eE,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[b.jsxs(tE,{children:[b.jsx("div",{className:"flex items-center gap-3 mb-2",children:b.jsxs(tt,{variant:"ghost",size:"sm",onClick:d,className:"flex items-center gap-2 text-muted-foreground hover:text-foreground","aria-label":"Close dialog and return to menu",children:[b.jsx(Gx,{className:"w-4 h-4","aria-hidden":"true"}),"Back to Menu"]})}),b.jsx(iE,{className:"text-2xl font-bold",children:e}),b.jsx(TO,{className:"text-lg",children:t})]}),b.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6",children:[b.jsx(hMe,{splatUrl:u,imageUrl:c,title:e,performanceMode:h}),b.jsxs("div",{className:"space-y-6",children:[b.jsx("div",{className:"flex items-center gap-4",children:b.jsx(Eo,{variant:"outline",className:"text-2xl font-bold px-4 py-2",children:NX(i)})}),b.jsxs("section",{"aria-labelledby":"dietary-info-title",children:[b.jsx("h4",{id:"dietary-info-title",className:"font-semibold text-lg mb-3",children:"Dietary Information"}),b.jsx(rq,{isVegetarian:n,isVegan:a,isGlutenFree:o,isNutFree:l,variant:"detailed"})]}),b.jsxs("section",{"aria-labelledby":"allergen-info-title",children:[b.jsxs("h4",{id:"allergen-info-title",className:"font-semibold text-lg flex items-center gap-2 mb-3",children:[b.jsx(bse,{className:"w-5 h-5","aria-hidden":"true"}),"Allergen Information"]}),b.jsxs("p",{className:"text-muted-foreground",children:[b.jsx("strong",{children:"Contains:"})," ",(s==null?void 0:s.length)>0?s.join(", "):"None"]})]})]})]}),b.jsx("section",{className:"mt-8","aria-labelledby":"reviews-title",children:b.jsx(IRe,{menuItemId:r,menuItemTitle:e})})]}),RRe=()=>(Ar(),{trackView:E.useCallback(async e=>{try{let t=sessionStorage.getItem("menu_session_id");t||(t=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,sessionStorage.setItem("menu_session_id",t));const{error:i}=await nt.from("menu_item_views").insert({menu_item_id:e,user_session:t,ip_address:null});i&&console.error("Error tracking menu item view:",i)}catch(t){console.error("Error tracking view:",t)}},[])}),bK=({menuItemId:r,title:e,description:t,price:i,allergens:s=[],isVegetarian:n,isVegan:a,isGlutenFree:o,isNutFree:l,imageUrl:c,splatUrl:u})=>{const{trackView:h}=RRe(),{preloadModel:d}=X3(),f=E.useRef(!1),p=E.useRef(!1),m=E.useRef(null),[g,_]=E.useState(!1),[v,y]=E.useState(LB());E.useEffect(()=>{y(LB())},[]),E.useEffect(()=>{if(!f.current){const T=setTimeout(()=>{h(r),f.current=!0},Do.DELAYS.VIEW_TRACKING_MS);return()=>clearTimeout(T)}},[r,h]),E.useEffect(()=>{if(!p.current&&(u!=null&&u.trim())&&m.current){const T=new IntersectionObserver(A=>{A.forEach(C=>{C.isIntersecting&&!p.current&&setTimeout(()=>{d(u),p.current=!0},Do.DELAYS.MODEL_PRELOAD_MS)})},{threshold:Do.INTERSECTION_OBSERVER.THRESHOLD,rootMargin:Do.INTERSECTION_OBSERVER.ROOT_MARGIN});return T.observe(m.current),()=>T.disconnect()}},[u,d]);const x=()=>{u!=null&&u.trim()&&!p.current&&(d(u),p.current=!0),_(!0)},S=()=>{_(!1)},w=!!(u!=null&&u.trim());return b.jsxs(wO,{open:g,onOpenChange:_,children:[b.jsx(ede,{asChild:!0,children:b.jsx(Vt,{ref:m,className:"cursor-pointer transition-all duration-200 hover:shadow-lg border border-border rounded-lg shadow-sm hover:bg-muted/50 bg-card",onClick:x,role:"button",tabIndex:0,"aria-label":`View details for ${e}`,children:b.jsx(jt,{className:"p-4",children:b.jsxs("div",{className:"flex space-x-4",children:[b.jsxs("div",{className:"w-20 h-20 flex-shrink-0 relative",children:[c?b.jsx("img",{src:c,alt:e,className:"w-full h-full object-cover rounded-lg",loading:"lazy"}):b.jsx("div",{className:"w-full h-full bg-muted rounded-lg flex items-center justify-center",children:b.jsx("span",{className:"text-muted-foreground text-xs",children:"No Image"})}),w&&b.jsx("div",{className:"absolute -top-1 -right-1",title:"3D model available",children:b.jsx("div",{className:"bg-primary text-primary-foreground rounded-full p-1",children:b.jsx(bf,{className:"w-3 h-3"})})})]}),b.jsxs("div",{className:"flex-1 min-w-0",children:[b.jsxs("div",{className:"flex justify-between items-start mb-1",children:[b.jsx("h3",{className:"font-semibold text-foreground text-base leading-tight line-clamp-1",children:e}),b.jsx(Eo,{variant:"secondary",className:"ml-2 font-semibold",children:NX(i)})]}),b.jsx("p",{className:"text-muted-foreground text-sm line-clamp-2 mb-2",children:t}),b.jsx(rq,{isVegetarian:n,isVegan:a,isGlutenFree:o,isNutFree:l,variant:"compact"})]})]})})})}),b.jsx(MRe,{menuItemId:r,title:e,description:t,price:i,allergens:s,isVegetarian:n,isVegan:a,isGlutenFree:o,isNutFree:l,imageUrl:c,splatUrl:u,performanceMode:v.performanceMode,onClose:S})]})},DRe=({hasItems:r})=>b.jsxs("div",{className:"text-center py-16",children:[b.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"No menu items found"}),b.jsx("p",{className:"text-gray-500",children:r?"No items match your current filters. Try adjusting your selection.":"The restaurant hasn't added any menu items yet."})]}),LRe=r=>{const{aggressiveBatchPreload:e}=X3();E.useEffect(()=>{const t=[];if(r.forEach(i=>{var s;(s=i.model_url)!=null&&s.trim()&&t.push(i.model_url)}),t.length>0){console.log(`MenuPreloader: Starting aggressive preload of ${t.length} models`);const i=setTimeout(()=>{e(t)},100);return()=>clearTimeout(i)}},[r,e])},ORe=({filteredItems:r,totalItemsCount:e})=>(LRe(r.map(t=>({model_url:t.model_url}))),r.length===0?b.jsx(DRe,{hasItems:e>0}):b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",role:"grid","aria-label":"Menu items",children:r.map(t=>b.jsx("div",{role:"gridcell",children:b.jsx(bK,{menuItemId:t.id,title:t.title,description:t.description||"",price:t.price,allergens:t.allergens,isVegetarian:t.is_vegetarian,isVegan:t.is_vegan,isGlutenFree:t.is_gluten_free,isNutFree:t.is_nut_free,imageUrl:t.image_url,splatUrl:t.model_url})},t.id))})),NRe=()=>{const[r,e]=E.useState([]),[t,i]=E.useState(!0),{toast:s}=Ar();return E.useEffect(()=>{(async()=>{try{const{data:a,error:o}=await nt.from("menu_item_reviews").select("menu_item_id").then(h=>{if(h.error)throw h.error;const d={};return h.data.forEach(f=>{d[f.menu_item_id]=(d[f.menu_item_id]||0)+1}),{data:d,error:null}});if(o)throw o;const l=Object.keys(a||{});if(l.length===0){e([]);return}const{data:c,error:u}=await nt.from("menu_items").select("*").eq("is_active",!0).in("id",l);if(u)throw u;if(c){const h=c.map(d=>({...d,reviewCount:a[d.id]||0})).sort((d,f)=>f.reviewCount-d.reviewCount).slice(0,3);e(h)}}catch(a){console.error("Error fetching featured items:",a),s({title:"Error loading featured items",description:a.message,variant:"destructive"}),e([])}finally{i(!1)}})()},[s]),{featuredItems:r,loading:t}},kRe=()=>{const{featuredItems:r,loading:e}=NRe();return e?b.jsx("div",{className:"py-8",children:b.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:b.jsx(yO,{})})}):r.length===0?null:b.jsx("section",{className:"py-8 bg-muted/30","aria-labelledby":"featured-items-title",children:b.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[b.jsxs("div",{className:"flex items-center space-x-2 mb-6",children:[b.jsx(ip,{className:"w-6 h-6 text-primary fill-primary","aria-hidden":"true"}),b.jsx("h2",{id:"featured-items-title",className:"text-2xl font-bold text-foreground",children:"Featured Items"}),b.jsx("span",{className:"text-sm text-muted-foreground",children:"Most reviewed dishes"})]}),b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",role:"grid","aria-label":"Featured menu items",children:r.map(t=>b.jsxs("div",{className:"relative",role:"gridcell",children:[b.jsx("div",{className:"bg-card rounded-lg border border-border hover:shadow-lg transition-shadow duration-200",children:b.jsx(bK,{menuItemId:t.id,title:t.title,description:t.description||"",price:t.price,allergens:t.allergens,isVegetarian:t.is_vegetarian,isVegan:t.is_vegan,isGlutenFree:t.is_gluten_free,isNutFree:t.is_nut_free,imageUrl:t.image_url,splatUrl:t.model_url})}),b.jsxs("div",{className:"absolute -top-3 -right-3 bg-primary text-primary-foreground text-xs font-bold px-3 py-1 rounded-full shadow-lg border-2 border-background","aria-label":`${t.reviewCount} ${JI(t.reviewCount,"review")}`,children:["⭐ ",t.reviewCount," ",JI(t.reviewCount,"review")]})]},t.id))})]})})},sP=[{id:"placeholder-1",title:"Classic Caesar Salad",description:"Fresh romaine lettuce, parmesan cheese, croutons, and our signature Caesar dressing",price:12.99,category:"appetizers",allergens:["dairy","gluten"],is_vegetarian:!0,is_vegan:!1,is_gluten_free:!1,is_nut_free:!0,image_url:"https://images.unsplash.com/photo-1618160702438-9b02ab6515c9?w=400&h=300&fit=crop",is_active:!0},{id:"placeholder-2",title:"Grilled Salmon",description:"Atlantic salmon grilled to perfection, served with roasted vegetables and lemon butter sauce",price:24.99,category:"main course",allergens:["fish"],is_vegetarian:!1,is_vegan:!1,is_gluten_free:!0,is_nut_free:!0,image_url:"https://images.unsplash.com/photo-1506744038136-46273834b3fb?w=400&h=300&fit=crop",is_active:!0},{id:"placeholder-3",title:"Vegan Buddha Bowl",description:"Quinoa, roasted chickpeas, avocado, sweet potato, and tahini dressing",price:16.99,category:"main course",allergens:["sesame"],is_vegetarian:!0,is_vegan:!0,is_gluten_free:!0,is_nut_free:!0,image_url:"https://images.unsplash.com/photo-1501854140801-50d01698950b?w=400&h=300&fit=crop",is_active:!0},{id:"placeholder-4",title:"Chocolate Lava Cake",description:"Warm chocolate cake with a molten center, served with vanilla ice cream",price:8.99,category:"desserts",allergens:["dairy","eggs","gluten"],is_vegetarian:!0,is_vegan:!1,is_gluten_free:!1,is_nut_free:!0,image_url:"https://images.unsplash.com/photo-1582562124811-c09040d0a901?w=400&h=300&fit=crop",is_active:!0},{id:"placeholder-5",title:"Margherita Pizza",description:"Traditional pizza with fresh mozzarella, tomato sauce, and basil",price:18.99,category:"pizza",allergens:["dairy","gluten"],is_vegetarian:!0,is_vegan:!1,is_gluten_free:!1,is_nut_free:!0,image_url:"https://images.unsplash.com/photo-1518770660439-4636190af475?w=400&h=300&fit=crop",is_active:!0},{id:"placeholder-6",title:"Craft Beer Selection",description:"Local craft beer rotating selection - ask your server for today's options",price:6.99,category:"drinks",allergens:["gluten"],is_vegetarian:!0,is_vegan:!0,is_gluten_free:!1,is_nut_free:!0,is_active:!0},{id:"placeholder-7",title:"Truffle Pasta",description:"Handmade fettuccine with truffle cream sauce and wild mushrooms",price:22.99,category:"pasta",allergens:["dairy","eggs","gluten"],is_vegetarian:!0,is_vegan:!1,is_gluten_free:!1,is_nut_free:!0,image_url:"https://images.unsplash.com/photo-1461749280684-dccba630e2f6?w=400&h=300&fit=crop",is_active:!0},{id:"placeholder-8",title:"Thai Green Curry",description:"Spicy coconut curry with vegetables, served with jasmine rice",price:19.99,category:"main course",allergens:[],is_vegetarian:!0,is_vegan:!0,is_gluten_free:!0,is_nut_free:!1,image_url:"https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=400&h=300&fit=crop",is_active:!0}],YV=r=>({appetizers:"🥗",main:"🍖","main course":"🍖","main courses":"🍖",desserts:"🍰",dessert:"🍰",drinks:"🥤",drink:"🥤",beverages:"🥤",salads:"🥗",salad:"🥗",pizza:"🍕",pasta:"🍝",soup:"🍲",soups:"🍲"})[r.toLowerCase()]||"🍽️",FRe=()=>{const[r,e]=E.useState([]),[t,i]=E.useState(null),[s,n]=E.useState([{id:"all",name:"All",icon:"🍽️"}]),[a,o]=E.useState(!0),{toast:l}=Ar(),c=async()=>{try{const{data:u,error:h}=await nt.from("restaurants").select("*").single();h&&h.code!=="PGRST116"?console.log("Restaurant not found, using defaults"):i(u);const{data:d,error:f}=await nt.from("menu_items").select("*").eq("is_active",!0).order("sort_order",{ascending:!0});if(f)throw f;const p=d&&d.length>0?d:sP;e(p);const m=[...new Set(p.map(_=>_.category))],g=[{id:"all",name:"All",icon:"🍽️"},...m.map(_=>({id:_,name:_.charAt(0).toUpperCase()+_.slice(1),icon:YV(_)}))];n(g)}catch(u){l({title:"Error loading menu",description:u.message,variant:"destructive"}),e(sP);const h=[...new Set(sP.map(f=>f.category))],d=[{id:"all",name:"All",icon:"🍽️"},...h.map(f=>({id:f,name:f.charAt(0).toUpperCase()+f.slice(1),icon:YV(f)}))];n(d)}finally{o(!1)}};return E.useEffect(()=>{c()},[]),{menuItems:r,restaurant:t,categories:s,loading:a}},BRe=r=>{const[e,t]=E.useState("all"),[i,s]=E.useState({vegetarian:!1,vegan:!1,glutenFree:!1,nutFree:!1}),n=l=>{t(l)},a=(l,c)=>{s(u=>({...u,[l]:c}))},o=r.filter(l=>!(e!=="all"&&l.category.toLowerCase()!==e.toLowerCase()||i.vegetarian&&!l.is_vegetarian||i.vegan&&!l.is_vegan||i.glutenFree&&!l.is_gluten_free||i.nutFree&&!l.is_nut_free));return{activeCategory:e,dietaryFilters:i,filteredItems:o,handleCategoryChange:n,handleFilterChange:a}},URe=()=>{const{menuItems:r,restaurant:e,categories:t,loading:i}=FRe(),{activeCategory:s,dietaryFilters:n,filteredItems:a,handleCategoryChange:o,handleFilterChange:l}=BRe(r);return i?b.jsx(yO,{}):b.jsxs("div",{className:"min-h-screen bg-background",children:[b.jsx(Bhe,{restaurant:e}),b.jsx(kRe,{}),b.jsx("div",{className:"sticky top-0 bg-background/95 backdrop-blur-sm border-b border-border z-40",children:b.jsx("div",{className:"max-w-7xl mx-auto",children:b.jsx("div",{className:"flex items-center justify-between py-3 px-4 sm:px-6 lg:px-8",children:b.jsxs("div",{className:"flex items-center space-x-6",children:[b.jsx(Lhe,{categories:t,activeCategory:s,onCategoryChange:o}),b.jsx(Ohe,{filters:n,onFilterChange:l})]})})})}),b.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:b.jsx(ORe,{filteredItems:a,totalItemsCount:r.length})})]})},zRe=({onAuthSuccess:r})=>{const[e,t]=E.useState(!1),[i,s]=E.useState(""),[n,a]=E.useState(""),[o,l]=E.useState(!1),{toast:c}=Ar(),u=async h=>{h.preventDefault(),l(!0);try{if(e){const d=`${window.location.origin}/`,{error:f}=await nt.auth.signUp({email:i,password:n,options:{emailRedirectTo:d}});if(f)throw f;c({title:"Check your email",description:"We've sent you a confirmation link to complete your registration."})}else{const{data:d,error:f}=await nt.auth.signInWithPassword({email:i,password:n});if(f)throw f;d.user&&r(d.user)}}catch(d){c({title:"Authentication Error",description:d.message,variant:"destructive"})}finally{l(!1)}};return b.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:b.jsxs(Vt,{className:"w-full max-w-md",children:[b.jsxs(Dr,{children:[b.jsx(Lr,{children:e?"Create Account":"Sign In"}),b.jsx(Or,{children:e?"Create your restaurant admin account":"Sign in to manage your restaurant menu"})]}),b.jsxs(jt,{children:[b.jsxs("form",{onSubmit:u,className:"space-y-4",children:[b.jsxs("div",{children:[b.jsx(Ht,{htmlFor:"email",children:"Email"}),b.jsx(ti,{id:"email",type:"email",value:i,onChange:h=>s(h.target.value),required:!0})]}),b.jsxs("div",{children:[b.jsx(Ht,{htmlFor:"password",children:"Password"}),b.jsx(ti,{id:"password",type:"password",value:n,onChange:h=>a(h.target.value),required:!0})]}),b.jsx(tt,{type:"submit",className:"w-full",disabled:o,children:o?"Loading...":e?"Sign Up":"Sign In"})]}),b.jsx("div",{className:"mt-4 text-center",children:b.jsx("button",{type:"button",onClick:()=>t(!e),className:"text-sm text-blue-600 hover:underline",children:e?"Already have an account? Sign in":"Don't have an account? Sign up"})})]})]})})},KV=({restaurant:r,onUpdate:e})=>{const[t,i]=E.useState(!r),[s,n]=E.useState(!1),[a,o]=E.useState({name:(r==null?void 0:r.name)||"",description:(r==null?void 0:r.description)||"",address:(r==null?void 0:r.address)||"",phone:(r==null?void 0:r.phone)||"",email:(r==null?void 0:r.email)||""}),{toast:l}=Ar(),c=async h=>{h.preventDefault(),n(!0);try{if(r){const{data:d,error:f}=await nt.from("restaurants").update(a).eq("id",r.id).select().single();if(f)throw f;e(d)}else{const{data:d}=await nt.auth.getUser();if(!d.user)throw new Error("User not authenticated");const{data:f,error:p}=await nt.from("restaurants").insert([{...a,user_id:d.user.id}]).select().single();if(p)throw p;e(f)}i(!1),l({title:"Success",description:"Restaurant profile saved successfully"})}catch(d){l({title:"Error",description:d.message,variant:"destructive"})}finally{n(!1)}},u=()=>{r&&(o({name:r.name,description:r.description||"",address:r.address||"",phone:r.phone||"",email:r.email||""}),i(!1))};return b.jsxs(Vt,{children:[b.jsx(Dr,{children:b.jsxs("div",{className:"flex justify-between items-center",children:[b.jsxs("div",{children:[b.jsx(Lr,{children:"Restaurant Profile"}),b.jsx(Or,{children:r?"Your restaurant information":"Set up your restaurant profile"})]}),r&&!t&&b.jsx(tt,{onClick:()=>i(!0),variant:"outline",children:"Edit"})]})}),b.jsx(jt,{children:t?b.jsxs("form",{onSubmit:c,className:"space-y-4",children:[b.jsxs("div",{children:[b.jsx(Ht,{htmlFor:"name",children:"Restaurant Name *"}),b.jsx(ti,{id:"name",value:a.name,onChange:h=>o({...a,name:h.target.value}),required:!0})]}),b.jsxs("div",{children:[b.jsx(Ht,{htmlFor:"description",children:"Description"}),b.jsx(ti,{id:"description",value:a.description,onChange:h=>o({...a,description:h.target.value}),placeholder:"Tell customers about your restaurant"})]}),b.jsxs("div",{children:[b.jsx(Ht,{htmlFor:"address",children:"Address"}),b.jsx(ti,{id:"address",value:a.address,onChange:h=>o({...a,address:h.target.value})})]}),b.jsxs("div",{children:[b.jsx(Ht,{htmlFor:"phone",children:"Phone"}),b.jsx(ti,{id:"phone",value:a.phone,onChange:h=>o({...a,phone:h.target.value})})]}),b.jsxs("div",{children:[b.jsx(Ht,{htmlFor:"email",children:"Email"}),b.jsx(ti,{id:"email",type:"email",value:a.email,onChange:h=>o({...a,email:h.target.value})})]}),b.jsxs("div",{className:"flex gap-2",children:[b.jsx(tt,{type:"submit",disabled:s,children:s?"Saving...":"Save"}),r&&b.jsx(tt,{type:"button",variant:"outline",onClick:u,children:"Cancel"})]})]}):r?b.jsxs("div",{className:"space-y-3",children:[b.jsxs("div",{children:[b.jsx("h3",{className:"font-semibold text-lg",children:r.name}),r.description&&b.jsx("p",{className:"text-gray-600",children:r.description})]}),r.address&&b.jsxs("div",{children:[b.jsx("span",{className:"font-medium",children:"Address: "}),b.jsx("span",{className:"text-gray-600",children:r.address})]}),r.phone&&b.jsxs("div",{children:[b.jsx("span",{className:"font-medium",children:"Phone: "}),b.jsx("span",{className:"text-gray-600",children:r.phone})]}),r.email&&b.jsxs("div",{children:[b.jsx("span",{className:"font-medium",children:"Email: "}),b.jsx("span",{className:"text-gray-600",children:r.email})]})]}):null})]})};function ZV(r,[e,t]){return Math.min(t,Math.max(e,r))}var VRe=[" ","Enter","ArrowUp","ArrowDown"],jRe=[" ","Enter"],bh="Select",[eA,tA,$Re]=LT(bh),[pm,$it]=Ga(bh,[$Re,om]),iA=om(),[HRe,Lc]=pm(bh),[GRe,WRe]=pm(bh),wK=r=>{const{__scopeSelect:e,children:t,open:i,defaultOpen:s,onOpenChange:n,value:a,defaultValue:o,onValueChange:l,dir:c,name:u,autoComplete:h,disabled:d,required:f,form:p}=r,m=iA(e),[g,_]=E.useState(null),[v,y]=E.useState(null),[x,S]=E.useState(!1),w=rO(c),[T,A]=rh({prop:i,defaultProp:s??!1,onChange:n,caller:bh}),[C,P]=rh({prop:a,defaultProp:o,onChange:l,caller:bh}),I=E.useRef(null),M=g?p||!!g.closest("form"):!0,[N,k]=E.useState(new Set),V=Array.from(N).map(B=>B.props.value).join(";");return b.jsx(j8,{...m,children:b.jsxs(HRe,{required:f,scope:e,trigger:g,onTriggerChange:_,valueNode:v,onValueNodeChange:y,valueNodeHasChildren:x,onValueNodeHasChildrenChange:S,contentId:Fo(),value:C,onValueChange:P,open:T,onOpenChange:A,dir:w,triggerPointerDownPosRef:I,disabled:d,children:[b.jsx(eA.Provider,{scope:e,children:b.jsx(GRe,{scope:r.__scopeSelect,onNativeOptionAdd:E.useCallback(B=>{k(R=>new Set(R).add(B))},[]),onNativeOptionRemove:E.useCallback(B=>{k(R=>{const L=new Set(R);return L.delete(B),L})},[]),children:t})}),M?b.jsxs(XK,{"aria-hidden":!0,required:f,tabIndex:-1,name:u,autoComplete:h,value:C,onChange:B=>P(B.target.value),disabled:d,form:p,children:[C===void 0?b.jsx("option",{value:""}):null,Array.from(N)]},V):null]})})};wK.displayName=bh;var TK="SelectTrigger",EK=E.forwardRef((r,e)=>{const{__scopeSelect:t,disabled:i=!1,...s}=r,n=iA(t),a=Lc(TK,t),o=a.disabled||i,l=Ze(e,a.onTriggerChange),c=tA(t),u=E.useRef("touch"),[h,d,f]=YK(m=>{const g=c().filter(y=>!y.disabled),_=g.find(y=>y.value===a.value),v=KK(g,m,_);v!==void 0&&a.onValueChange(v.value)}),p=m=>{o||(a.onOpenChange(!0),f()),m&&(a.triggerPointerDownPosRef.current={x:Math.round(m.pageX),y:Math.round(m.pageY)})};return b.jsx(YL,{asChild:!0,...n,children:b.jsx(Ee.button,{type:"button",role:"combobox","aria-controls":a.contentId,"aria-expanded":a.open,"aria-required":a.required,"aria-autocomplete":"none",dir:a.dir,"data-state":a.open?"open":"closed",disabled:o,"data-disabled":o?"":void 0,"data-placeholder":qK(a.value)?"":void 0,...s,ref:l,onClick:le(s.onClick,m=>{m.currentTarget.focus(),u.current!=="mouse"&&p(m)}),onPointerDown:le(s.onPointerDown,m=>{u.current=m.pointerType;const g=m.target;g.hasPointerCapture(m.pointerId)&&g.releasePointerCapture(m.pointerId),m.button===0&&m.ctrlKey===!1&&m.pointerType==="mouse"&&(p(m),m.preventDefault())}),onKeyDown:le(s.onKeyDown,m=>{const g=h.current!=="";!(m.ctrlKey||m.altKey||m.metaKey)&&m.key.length===1&&d(m.key),!(g&&m.key===" ")&&VRe.includes(m.key)&&(p(),m.preventDefault())})})})});EK.displayName=TK;var AK="SelectValue",CK=E.forwardRef((r,e)=>{const{__scopeSelect:t,className:i,style:s,children:n,placeholder:a="",...o}=r,l=Lc(AK,t),{onValueNodeHasChildrenChange:c}=l,u=n!==void 0,h=Ze(e,l.onValueNodeChange);return ar(()=>{c(u)},[c,u]),b.jsx(Ee.span,{...o,ref:h,style:{pointerEvents:"none"},children:qK(l.value)?b.jsx(b.Fragment,{children:a}):n})});CK.displayName=AK;var XRe="SelectIcon",PK=E.forwardRef((r,e)=>{const{__scopeSelect:t,children:i,...s}=r;return b.jsx(Ee.span,{"aria-hidden":!0,...s,ref:e,children:i||"▼"})});PK.displayName=XRe;var qRe="SelectPortal",IK=r=>b.jsx(ny,{asChild:!0,...r});IK.displayName=qRe;var wh="SelectContent",MK=E.forwardRef((r,e)=>{const t=Lc(wh,r.__scopeSelect),[i,s]=E.useState();if(ar(()=>{s(new DocumentFragment)},[]),!t.open){const n=i;return n?tn.createPortal(b.jsx(RK,{scope:r.__scopeSelect,children:b.jsx(eA.Slot,{scope:r.__scopeSelect,children:b.jsx("div",{children:r.children})})}),n):null}return b.jsx(DK,{...r,ref:e})});MK.displayName=wh;var Cn=10,[RK,Oc]=pm(wh),YRe="SelectContentImpl",KRe=ih("SelectContent.RemoveScroll"),DK=E.forwardRef((r,e)=>{const{__scopeSelect:t,position:i="item-aligned",onCloseAutoFocus:s,onEscapeKeyDown:n,onPointerDownOutside:a,side:o,sideOffset:l,align:c,alignOffset:u,arrowPadding:h,collisionBoundary:d,collisionPadding:f,sticky:p,hideWhenDetached:m,avoidCollisions:g,..._}=r,v=Lc(wh,t),[y,x]=E.useState(null),[S,w]=E.useState(null),T=Ze(e,W=>x(W)),[A,C]=E.useState(null),[P,I]=E.useState(null),M=tA(t),[N,k]=E.useState(!1),V=E.useRef(!1);E.useEffect(()=>{if(y)return nO(y)},[y]),sO();const B=E.useCallback(W=>{const[ie,...q]=M().map(X=>X.ref.current),[K]=q.slice(-1),te=document.activeElement;for(const X of W)if(X===te||(X==null||X.scrollIntoView({block:"nearest"}),X===ie&&S&&(S.scrollTop=0),X===K&&S&&(S.scrollTop=S.scrollHeight),X==null||X.focus(),document.activeElement!==te))return},[M,S]),R=E.useCallback(()=>B([A,y]),[B,A,y]);E.useEffect(()=>{N&&R()},[N,R]);const{onOpenChange:L,triggerPointerDownPosRef:D}=v;E.useEffect(()=>{if(y){let W={x:0,y:0};const ie=K=>{var te,X;W={x:Math.abs(Math.round(K.pageX)-(((te=D.current)==null?void 0:te.x)??0)),y:Math.abs(Math.round(K.pageY)-(((X=D.current)==null?void 0:X.y)??0))}},q=K=>{W.x<=10&&W.y<=10?K.preventDefault():y.contains(K.target)||L(!1),document.removeEventListener("pointermove",ie),D.current=null};return D.current!==null&&(document.addEventListener("pointermove",ie),document.addEventListener("pointerup",q,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",ie),document.removeEventListener("pointerup",q,{capture:!0})}}},[y,L,D]),E.useEffect(()=>{const W=()=>L(!1);return window.addEventListener("blur",W),window.addEventListener("resize",W),()=>{window.removeEventListener("blur",W),window.removeEventListener("resize",W)}},[L]);const[F,j]=YK(W=>{const ie=M().filter(te=>!te.disabled),q=ie.find(te=>te.ref.current===document.activeElement),K=KK(ie,W,q);K&&setTimeout(()=>K.ref.current.focus())}),z=E.useCallback((W,ie,q)=>{const K=!V.current&&!q;(v.value!==void 0&&v.value===ie||K)&&(C(W),K&&(V.current=!0))},[v.value]),$=E.useCallback(()=>y==null?void 0:y.focus(),[y]),H=E.useCallback((W,ie,q)=>{const K=!V.current&&!q;(v.value!==void 0&&v.value===ie||K)&&I(W)},[v.value]),G=i==="popper"?W2:LK,Y=G===W2?{side:o,sideOffset:l,align:c,alignOffset:u,arrowPadding:h,collisionBoundary:d,collisionPadding:f,sticky:p,hideWhenDetached:m,avoidCollisions:g}:{};return b.jsx(RK,{scope:t,content:y,viewport:S,onViewportChange:w,itemRefCallback:z,selectedItem:A,onItemLeave:$,itemTextRefCallback:H,focusSelectedItem:R,selectedItemText:P,position:i,isPositioned:N,searchRef:F,children:b.jsx(qT,{as:KRe,allowPinchZoom:!0,children:b.jsx(WT,{asChild:!0,trapped:v.open,onMountAutoFocus:W=>{W.preventDefault()},onUnmountAutoFocus:le(s,W=>{var ie;(ie=v.trigger)==null||ie.focus({preventScroll:!0}),W.preventDefault()}),children:b.jsx(rm,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:n,onPointerDownOutside:a,onFocusOutside:W=>W.preventDefault(),onDismiss:()=>v.onOpenChange(!1),children:b.jsx(G,{role:"listbox",id:v.contentId,"data-state":v.open?"open":"closed",dir:v.dir,onContextMenu:W=>W.preventDefault(),..._,...Y,onPlaced:()=>k(!0),ref:T,style:{display:"flex",flexDirection:"column",outline:"none",..._.style},onKeyDown:le(_.onKeyDown,W=>{const ie=W.ctrlKey||W.altKey||W.metaKey;if(W.key==="Tab"&&W.preventDefault(),!ie&&W.key.length===1&&j(W.key),["ArrowUp","ArrowDown","Home","End"].includes(W.key)){let K=M().filter(te=>!te.disabled).map(te=>te.ref.current);if(["ArrowUp","End"].includes(W.key)&&(K=K.slice().reverse()),["ArrowUp","ArrowDown"].includes(W.key)){const te=W.target,X=K.indexOf(te);K=K.slice(X+1)}setTimeout(()=>B(K)),W.preventDefault()}})})})})})})});DK.displayName=YRe;var ZRe="SelectItemAlignedPosition",LK=E.forwardRef((r,e)=>{const{__scopeSelect:t,onPlaced:i,...s}=r,n=Lc(wh,t),a=Oc(wh,t),[o,l]=E.useState(null),[c,u]=E.useState(null),h=Ze(e,T=>u(T)),d=tA(t),f=E.useRef(!1),p=E.useRef(!0),{viewport:m,selectedItem:g,selectedItemText:_,focusSelectedItem:v}=a,y=E.useCallback(()=>{if(n.trigger&&n.valueNode&&o&&c&&m&&g&&_){const T=n.trigger.getBoundingClientRect(),A=c.getBoundingClientRect(),C=n.valueNode.getBoundingClientRect(),P=_.getBoundingClientRect();if(n.dir!=="rtl"){const te=P.left-A.left,X=C.left-te,_e=T.left-X,pe=T.width+_e,ze=Math.max(pe,A.width),Fe=window.innerWidth-Cn,vt=ZV(X,[Cn,Math.max(Cn,Fe-ze)]);o.style.minWidth=pe+"px",o.style.left=vt+"px"}else{const te=A.right-P.right,X=window.innerWidth-C.right-te,_e=window.innerWidth-T.right-X,pe=T.width+_e,ze=Math.max(pe,A.width),Fe=window.innerWidth-Cn,vt=ZV(X,[Cn,Math.max(Cn,Fe-ze)]);o.style.minWidth=pe+"px",o.style.right=vt+"px"}const I=d(),M=window.innerHeight-Cn*2,N=m.scrollHeight,k=window.getComputedStyle(c),V=parseInt(k.borderTopWidth,10),B=parseInt(k.paddingTop,10),R=parseInt(k.borderBottomWidth,10),L=parseInt(k.paddingBottom,10),D=V+B+N+L+R,F=Math.min(g.offsetHeight*5,D),j=window.getComputedStyle(m),z=parseInt(j.paddingTop,10),$=parseInt(j.paddingBottom,10),H=T.top+T.height/2-Cn,G=M-H,Y=g.offsetHeight/2,W=g.offsetTop+Y,ie=V+B+W,q=D-ie;if(ie<=H){const te=I.length>0&&g===I[I.length-1].ref.current;o.style.bottom="0px";const X=c.clientHeight-m.offsetTop-m.offsetHeight,_e=Math.max(G,Y+(te?$:0)+X+R),pe=ie+_e;o.style.height=pe+"px"}else{const te=I.length>0&&g===I[0].ref.current;o.style.top="0px";const _e=Math.max(H,V+m.offsetTop+(te?z:0)+Y)+q;o.style.height=_e+"px",m.scrollTop=ie-H+m.offsetTop}o.style.margin=`${Cn}px 0`,o.style.minHeight=F+"px",o.style.maxHeight=M+"px",i==null||i(),requestAnimationFrame(()=>f.current=!0)}},[d,n.trigger,n.valueNode,o,c,m,g,_,n.dir,i]);ar(()=>y(),[y]);const[x,S]=E.useState();ar(()=>{c&&S(window.getComputedStyle(c).zIndex)},[c]);const w=E.useCallback(T=>{T&&p.current===!0&&(y(),v==null||v(),p.current=!1)},[y,v]);return b.jsx(JRe,{scope:t,contentWrapper:o,shouldExpandOnScrollRef:f,onScrollButtonChange:w,children:b.jsx("div",{ref:l,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:x},children:b.jsx(Ee.div,{...s,ref:h,style:{boxSizing:"border-box",maxHeight:"100%",...s.style}})})})});LK.displayName=ZRe;var QRe="SelectPopperPosition",W2=E.forwardRef((r,e)=>{const{__scopeSelect:t,align:i="start",collisionPadding:s=Cn,...n}=r,a=iA(t);return b.jsx(KL,{...a,...n,ref:e,align:i,collisionPadding:s,style:{boxSizing:"border-box",...n.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});W2.displayName=QRe;var[JRe,J3]=pm(wh,{}),X2="SelectViewport",OK=E.forwardRef((r,e)=>{const{__scopeSelect:t,nonce:i,...s}=r,n=Oc(X2,t),a=J3(X2,t),o=Ze(e,n.onViewportChange),l=E.useRef(0);return b.jsxs(b.Fragment,{children:[b.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:i}),b.jsx(eA.Slot,{scope:t,children:b.jsx(Ee.div,{"data-radix-select-viewport":"",role:"presentation",...s,ref:o,style:{position:"relative",flex:1,overflow:"hidden auto",...s.style},onScroll:le(s.onScroll,c=>{const u=c.currentTarget,{contentWrapper:h,shouldExpandOnScrollRef:d}=a;if(d!=null&&d.current&&h){const f=Math.abs(l.current-u.scrollTop);if(f>0){const p=window.innerHeight-Cn*2,m=parseFloat(h.style.minHeight),g=parseFloat(h.style.height),_=Math.max(m,g);if(_<p){const v=_+f,y=Math.min(p,v),x=v-y;h.style.height=y+"px",h.style.bottom==="0px"&&(u.scrollTop=x>0?x:0,h.style.justifyContent="flex-end")}}}l.current=u.scrollTop})})})]})});OK.displayName=X2;var NK="SelectGroup",[eDe,tDe]=pm(NK),iDe=E.forwardRef((r,e)=>{const{__scopeSelect:t,...i}=r,s=Fo();return b.jsx(eDe,{scope:t,id:s,children:b.jsx(Ee.div,{role:"group","aria-labelledby":s,...i,ref:e})})});iDe.displayName=NK;var kK="SelectLabel",FK=E.forwardRef((r,e)=>{const{__scopeSelect:t,...i}=r,s=tDe(kK,t);return b.jsx(Ee.div,{id:s.id,...i,ref:e})});FK.displayName=kK;var Gb="SelectItem",[rDe,BK]=pm(Gb),UK=E.forwardRef((r,e)=>{const{__scopeSelect:t,value:i,disabled:s=!1,textValue:n,...a}=r,o=Lc(Gb,t),l=Oc(Gb,t),c=o.value===i,[u,h]=E.useState(n??""),[d,f]=E.useState(!1),p=Ze(e,v=>{var y;return(y=l.itemRefCallback)==null?void 0:y.call(l,v,i,s)}),m=Fo(),g=E.useRef("touch"),_=()=>{s||(o.onValueChange(i),o.onOpenChange(!1))};if(i==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return b.jsx(rDe,{scope:t,value:i,disabled:s,textId:m,isSelected:c,onItemTextChange:E.useCallback(v=>{h(y=>y||((v==null?void 0:v.textContent)??"").trim())},[]),children:b.jsx(eA.ItemSlot,{scope:t,value:i,disabled:s,textValue:u,children:b.jsx(Ee.div,{role:"option","aria-labelledby":m,"data-highlighted":d?"":void 0,"aria-selected":c&&d,"data-state":c?"checked":"unchecked","aria-disabled":s||void 0,"data-disabled":s?"":void 0,tabIndex:s?void 0:-1,...a,ref:p,onFocus:le(a.onFocus,()=>f(!0)),onBlur:le(a.onBlur,()=>f(!1)),onClick:le(a.onClick,()=>{g.current!=="mouse"&&_()}),onPointerUp:le(a.onPointerUp,()=>{g.current==="mouse"&&_()}),onPointerDown:le(a.onPointerDown,v=>{g.current=v.pointerType}),onPointerMove:le(a.onPointerMove,v=>{var y;g.current=v.pointerType,s?(y=l.onItemLeave)==null||y.call(l):g.current==="mouse"&&v.currentTarget.focus({preventScroll:!0})}),onPointerLeave:le(a.onPointerLeave,v=>{var y;v.currentTarget===document.activeElement&&((y=l.onItemLeave)==null||y.call(l))}),onKeyDown:le(a.onKeyDown,v=>{var x;((x=l.searchRef)==null?void 0:x.current)!==""&&v.key===" "||(jRe.includes(v.key)&&_(),v.key===" "&&v.preventDefault())})})})})});UK.displayName=Gb;var Dg="SelectItemText",zK=E.forwardRef((r,e)=>{const{__scopeSelect:t,className:i,style:s,...n}=r,a=Lc(Dg,t),o=Oc(Dg,t),l=BK(Dg,t),c=WRe(Dg,t),[u,h]=E.useState(null),d=Ze(e,_=>h(_),l.onItemTextChange,_=>{var v;return(v=o.itemTextRefCallback)==null?void 0:v.call(o,_,l.value,l.disabled)}),f=u==null?void 0:u.textContent,p=E.useMemo(()=>b.jsx("option",{value:l.value,disabled:l.disabled,children:f},l.value),[l.disabled,l.value,f]),{onNativeOptionAdd:m,onNativeOptionRemove:g}=c;return ar(()=>(m(p),()=>g(p)),[m,g,p]),b.jsxs(b.Fragment,{children:[b.jsx(Ee.span,{id:l.textId,...n,ref:d}),l.isSelected&&a.valueNode&&!a.valueNodeHasChildren?tn.createPortal(n.children,a.valueNode):null]})});zK.displayName=Dg;var VK="SelectItemIndicator",jK=E.forwardRef((r,e)=>{const{__scopeSelect:t,...i}=r;return BK(VK,t).isSelected?b.jsx(Ee.span,{"aria-hidden":!0,...i,ref:e}):null});jK.displayName=VK;var q2="SelectScrollUpButton",$K=E.forwardRef((r,e)=>{const t=Oc(q2,r.__scopeSelect),i=J3(q2,r.__scopeSelect),[s,n]=E.useState(!1),a=Ze(e,i.onScrollButtonChange);return ar(()=>{if(t.viewport&&t.isPositioned){let o=function(){const c=l.scrollTop>0;n(c)};const l=t.viewport;return o(),l.addEventListener("scroll",o),()=>l.removeEventListener("scroll",o)}},[t.viewport,t.isPositioned]),s?b.jsx(GK,{...r,ref:a,onAutoScroll:()=>{const{viewport:o,selectedItem:l}=t;o&&l&&(o.scrollTop=o.scrollTop-l.offsetHeight)}}):null});$K.displayName=q2;var Y2="SelectScrollDownButton",HK=E.forwardRef((r,e)=>{const t=Oc(Y2,r.__scopeSelect),i=J3(Y2,r.__scopeSelect),[s,n]=E.useState(!1),a=Ze(e,i.onScrollButtonChange);return ar(()=>{if(t.viewport&&t.isPositioned){let o=function(){const c=l.scrollHeight-l.clientHeight,u=Math.ceil(l.scrollTop)<c;n(u)};const l=t.viewport;return o(),l.addEventListener("scroll",o),()=>l.removeEventListener("scroll",o)}},[t.viewport,t.isPositioned]),s?b.jsx(GK,{...r,ref:a,onAutoScroll:()=>{const{viewport:o,selectedItem:l}=t;o&&l&&(o.scrollTop=o.scrollTop+l.offsetHeight)}}):null});HK.displayName=Y2;var GK=E.forwardRef((r,e)=>{const{__scopeSelect:t,onAutoScroll:i,...s}=r,n=Oc("SelectScrollButton",t),a=E.useRef(null),o=tA(t),l=E.useCallback(()=>{a.current!==null&&(window.clearInterval(a.current),a.current=null)},[]);return E.useEffect(()=>()=>l(),[l]),ar(()=>{var u;const c=o().find(h=>h.ref.current===document.activeElement);(u=c==null?void 0:c.ref.current)==null||u.scrollIntoView({block:"nearest"})},[o]),b.jsx(Ee.div,{"aria-hidden":!0,...s,ref:e,style:{flexShrink:0,...s.style},onPointerDown:le(s.onPointerDown,()=>{a.current===null&&(a.current=window.setInterval(i,50))}),onPointerMove:le(s.onPointerMove,()=>{var c;(c=n.onItemLeave)==null||c.call(n),a.current===null&&(a.current=window.setInterval(i,50))}),onPointerLeave:le(s.onPointerLeave,()=>{l()})})}),sDe="SelectSeparator",WK=E.forwardRef((r,e)=>{const{__scopeSelect:t,...i}=r;return b.jsx(Ee.div,{"aria-hidden":!0,...i,ref:e})});WK.displayName=sDe;var K2="SelectArrow",nDe=E.forwardRef((r,e)=>{const{__scopeSelect:t,...i}=r,s=iA(t),n=Lc(K2,t),a=Oc(K2,t);return n.open&&a.position==="popper"?b.jsx(ZL,{...s,...i,ref:e}):null});nDe.displayName=K2;var aDe="SelectBubbleInput",XK=E.forwardRef(({__scopeSelect:r,value:e,...t},i)=>{const s=E.useRef(null),n=Ze(i,s),a=CX(e);return E.useEffect(()=>{const o=s.current;if(!o)return;const l=window.HTMLSelectElement.prototype,u=Object.getOwnPropertyDescriptor(l,"value").set;if(a!==e&&u){const h=new Event("change",{bubbles:!0});u.call(o,e),o.dispatchEvent(h)}},[a,e]),b.jsx(Ee.select,{...t,style:{...zW,...t.style},ref:n,defaultValue:e})});XK.displayName=aDe;function qK(r){return r===""||r===void 0}function YK(r){const e=is(r),t=E.useRef(""),i=E.useRef(0),s=E.useCallback(a=>{const o=t.current+a;e(o),function l(c){t.current=c,window.clearTimeout(i.current),c!==""&&(i.current=window.setTimeout(()=>l(""),1e3))}(o)},[e]),n=E.useCallback(()=>{t.current="",window.clearTimeout(i.current)},[]);return E.useEffect(()=>()=>window.clearTimeout(i.current),[]),[t,s,n]}function KK(r,e,t){const s=e.length>1&&Array.from(e).every(c=>c===e[0])?e[0]:e,n=t?r.indexOf(t):-1;let a=oDe(r,Math.max(n,0));s.length===1&&(a=a.filter(c=>c!==t));const l=a.find(c=>c.textValue.toLowerCase().startsWith(s.toLowerCase()));return l!==t?l:void 0}function oDe(r,e){return r.map((t,i)=>r[(e+i)%r.length])}var lDe=wK,ZK=EK,cDe=CK,uDe=PK,hDe=IK,QK=MK,dDe=OK,JK=FK,e7=UK,fDe=zK,pDe=jK,t7=$K,i7=HK,r7=WK;const mDe=lDe,gDe=cDe,s7=E.forwardRef(({className:r,children:e,...t},i)=>b.jsxs(ZK,{ref:i,className:ye("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...t,children:[e,b.jsx(uDe,{asChild:!0,children:b.jsx(FT,{className:"h-4 w-4 opacity-50"})})]}));s7.displayName=ZK.displayName;const n7=E.forwardRef(({className:r,...e},t)=>b.jsx(t7,{ref:t,className:ye("flex cursor-default items-center justify-center py-1",r),...e,children:b.jsx(use,{className:"h-4 w-4"})}));n7.displayName=t7.displayName;const a7=E.forwardRef(({className:r,...e},t)=>b.jsx(i7,{ref:t,className:ye("flex cursor-default items-center justify-center py-1",r),...e,children:b.jsx(FT,{className:"h-4 w-4"})}));a7.displayName=i7.displayName;const o7=E.forwardRef(({className:r,children:e,position:t="popper",...i},s)=>b.jsx(hDe,{children:b.jsxs(QK,{ref:s,className:ye("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:t,...i,children:[b.jsx(n7,{}),b.jsx(dDe,{className:ye("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:e}),b.jsx(a7,{})]})}));o7.displayName=QK.displayName;const _De=E.forwardRef(({className:r,...e},t)=>b.jsx(JK,{ref:t,className:ye("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...e}));_De.displayName=JK.displayName;const l7=E.forwardRef(({className:r,children:e,...t},i)=>b.jsxs(e7,{ref:i,className:ye("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...t,children:[b.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:b.jsx(pDe,{children:b.jsx(NL,{className:"h-4 w-4"})})}),b.jsx(fDe,{children:e})]}));l7.displayName=e7.displayName;const vDe=E.forwardRef(({className:r,...e},t)=>b.jsx(r7,{ref:t,className:ye("-mx-1 my-1 h-px bg-muted",r),...e}));vDe.displayName=r7.displayName;const a_=({bucket:r,currentUrl:e,onUpload:t,onRemove:i,label:s,accept:n})=>{const[a,o]=E.useState(!1),{toast:l}=Ar(),c=async f=>{try{if(o(!0),!f.target.files||f.target.files.length===0)throw new Error("You must select a file to upload.");const p=f.target.files[0],m=p.name.split(".").pop(),_=`${`${Math.random()}.${m}`}`,{data:v}=await nt.auth.getUser();if(!v.user)throw new Error("User not authenticated");const{error:y}=await nt.storage.from(r).upload(_,p,{metadata:{user_id:v.user.id}});if(y)throw y;const{data:x}=nt.storage.from(r).getPublicUrl(_);t(x.publicUrl),l({title:"Success",description:"File uploaded successfully"})}catch(p){l({title:"Error",description:p.message,variant:"destructive"})}finally{o(!1)}},u=async()=>{if(e)try{const f=e.split("/"),p=f[f.length-1],{error:m}=await nt.storage.from(r).remove([p]);if(m)throw m;i(),l({title:"Success",description:"File removed successfully"})}catch(f){l({title:"Error",description:f.message,variant:"destructive"})}},h=()=>r==="menu-images"||r==="restaurant-branding"?b.jsx(gse,{className:"w-4 h-4"}):r==="gaussian-splats"?b.jsx(Rse,{className:"w-4 h-4"}):b.jsx(pse,{className:"w-4 h-4"}),d=()=>r==="menu-images"?"Image uploaded":r==="restaurant-branding"?"Branding asset uploaded":r==="gaussian-splats"?"Gaussian splat uploaded":"3D model uploaded";return b.jsxs("div",{children:[b.jsx(Ht,{children:s}),b.jsx("div",{className:"mt-2",children:e?b.jsxs("div",{className:"flex items-center gap-2 p-3 border rounded-md bg-gray-50",children:[h(),b.jsx("span",{className:"text-sm text-gray-600 flex-1",children:d()}),b.jsx(tt,{type:"button",variant:"outline",size:"sm",onClick:u,className:"text-red-600 hover:text-red-800",children:b.jsx(kL,{className:"w-4 h-4"})})]}):b.jsxs("div",{children:[b.jsx(ti,{type:"file",accept:n,onChange:c,disabled:a,className:"hidden",id:`file-upload-${r}`}),b.jsxs(Ht,{htmlFor:`file-upload-${r}`,className:"flex items-center justify-center gap-2 p-4 border-2 border-dashed border-gray-300 rounded-md cursor-pointer hover:border-gray-400 transition-colors",children:[b.jsx(Pse,{className:"w-5 h-5"}),b.jsx("span",{children:a?"Uploading...":`Click to upload ${s.toLowerCase()}`})]})]})})]})},yDe=[{value:"Inter",label:"Inter (Modern)"},{value:"Georgia",label:"Georgia (Classic)"},{value:"Arial",label:"Arial (Clean)"},{value:"Times New Roman",label:"Times New Roman (Traditional)"},{value:"Roboto",label:"Roboto (Friendly)"},{value:"Playfair Display",label:"Playfair Display (Elegant)"}],SDe=({restaurant:r,onUpdate:e})=>{const[t,i]=E.useState(!1),[s,n]=E.useState(!1),[a,o]=E.useState({logo_url:r.logo_url||"",banner_url:r.banner_url||"",background_color:r.background_color||"#f9fafb",background_image_url:r.background_image_url||"",primary_color:r.primary_color||"#1e40af",secondary_color:r.secondary_color||"#64748b",font_family:r.font_family||"Inter"}),{toast:l}=Ar(),c=async()=>{n(!0);try{const{data:h,error:d}=await nt.from("restaurants").update(a).eq("id",r.id).select().single();if(d)throw d;e(h),i(!1),l({title:"Success",description:"Branding settings saved successfully"})}catch(h){l({title:"Error",description:h.message,variant:"destructive"})}finally{n(!1)}},u=()=>{o({logo_url:r.logo_url||"",banner_url:r.banner_url||"",background_color:r.background_color||"#f9fafb",background_image_url:r.background_image_url||"",primary_color:r.primary_color||"#1e40af",secondary_color:r.secondary_color||"#64748b",font_family:r.font_family||"Inter"}),i(!1)};return t?b.jsxs(Vt,{children:[b.jsxs(Dr,{children:[b.jsxs(Lr,{className:"flex items-center gap-2",children:[b.jsx(B1,{className:"w-5 h-5"}),"Customize Restaurant Branding"]}),b.jsx(Or,{children:"Upload your logo and banner, choose colors, and select fonts to match your brand"})]}),b.jsx(jt,{children:b.jsxs("div",{className:"space-y-6",children:[b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[b.jsx(a_,{bucket:"restaurant-branding",currentUrl:a.logo_url,onUpload:h=>o({...a,logo_url:h}),onRemove:()=>o({...a,logo_url:""}),label:"Restaurant Logo",accept:"image/*"}),b.jsx(a_,{bucket:"restaurant-branding",currentUrl:a.banner_url,onUpload:h=>o({...a,banner_url:h}),onRemove:()=>o({...a,banner_url:""}),label:"Banner Image",accept:"image/*"})]}),b.jsxs("div",{className:"space-y-4",children:[b.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[b.jsx(B1,{className:"w-4 h-4"}),"Colors"]}),b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[b.jsxs("div",{children:[b.jsx(Ht,{htmlFor:"primary-color",children:"Primary Color"}),b.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[b.jsx(ti,{id:"primary-color",type:"color",value:a.primary_color,onChange:h=>o({...a,primary_color:h.target.value}),className:"w-12 h-10 p-1 border rounded"}),b.jsx(ti,{type:"text",value:a.primary_color,onChange:h=>o({...a,primary_color:h.target.value}),placeholder:"#1e40af",className:"flex-1"})]})]}),b.jsxs("div",{children:[b.jsx(Ht,{htmlFor:"secondary-color",children:"Secondary Color"}),b.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[b.jsx(ti,{id:"secondary-color",type:"color",value:a.secondary_color,onChange:h=>o({...a,secondary_color:h.target.value}),className:"w-12 h-10 p-1 border rounded"}),b.jsx(ti,{type:"text",value:a.secondary_color,onChange:h=>o({...a,secondary_color:h.target.value}),placeholder:"#64748b",className:"flex-1"})]})]}),b.jsxs("div",{children:[b.jsx(Ht,{htmlFor:"background-color",children:"Background Color"}),b.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[b.jsx(ti,{id:"background-color",type:"color",value:a.background_color,onChange:h=>o({...a,background_color:h.target.value}),className:"w-12 h-10 p-1 border rounded"}),b.jsx(ti,{type:"text",value:a.background_color,onChange:h=>o({...a,background_color:h.target.value}),placeholder:"#f9fafb",className:"flex-1"})]})]})]})]}),b.jsxs("div",{children:[b.jsxs(Ht,{className:"flex items-center gap-2 mb-2",children:[b.jsx(Cse,{className:"w-4 h-4"}),"Font Family"]}),b.jsxs(mDe,{value:a.font_family,onValueChange:h=>o({...a,font_family:h}),children:[b.jsx(s7,{children:b.jsx(gDe,{})}),b.jsx(o7,{children:yDe.map(h=>b.jsx(l7,{value:h.value,children:b.jsx("span",{style:{fontFamily:h.value},children:h.label})},h.value))})]})]}),b.jsx(a_,{bucket:"restaurant-branding",currentUrl:a.background_image_url,onUpload:h=>o({...a,background_image_url:h}),onRemove:()=>o({...a,background_image_url:""}),label:"Background Image (Optional)",accept:"image/*"}),b.jsxs("div",{children:[b.jsx("h4",{className:"font-medium mb-3",children:"Preview"}),b.jsxs("div",{className:"p-6 rounded-lg border relative overflow-hidden",style:{backgroundColor:a.background_color,fontFamily:a.font_family,backgroundImage:a.background_image_url?`url(${a.background_image_url})`:"none",backgroundSize:"cover",backgroundPosition:"center"},children:[a.background_image_url&&b.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-90"}),b.jsxs("div",{className:"relative",children:[a.logo_url&&b.jsx("img",{src:a.logo_url,alt:"Logo",className:"h-12 mb-4 object-contain"}),b.jsx("div",{className:"text-2xl font-bold mb-2",style:{color:a.primary_color},children:r.name}),b.jsx("div",{className:"text-base mb-4",style:{color:a.secondary_color},children:"Welcome to our restaurant"}),b.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[b.jsx("div",{className:"font-semibold mb-1",style:{color:a.primary_color},children:"Sample Menu Item"}),b.jsx("div",{className:"text-sm",style:{color:a.secondary_color},children:"This is how your menu items will appear with your chosen styling."})]})]})]})]}),b.jsxs("div",{className:"flex gap-2 pt-4 border-t",children:[b.jsx(tt,{onClick:c,disabled:s,children:s?"Saving...":"Save Changes"}),b.jsx(tt,{variant:"outline",onClick:u,children:"Cancel"})]})]})})]}):b.jsxs(Vt,{children:[b.jsx(Dr,{children:b.jsxs("div",{className:"flex justify-between items-center",children:[b.jsxs("div",{children:[b.jsxs(Lr,{className:"flex items-center gap-2",children:[b.jsx(B1,{className:"w-5 h-5"}),"Restaurant Branding"]}),b.jsx(Or,{children:"Customize your menu page appearance with logos, colors, and fonts"})]}),b.jsx(tt,{onClick:()=>i(!0),variant:"outline",children:"Customize"})]})}),b.jsx(jt,{children:b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[b.jsxs("div",{children:[b.jsx("h4",{className:"font-medium mb-3",children:"Current Branding"}),b.jsxs("div",{className:"space-y-2 text-sm",children:[b.jsxs("div",{children:[b.jsx("span",{className:"font-medium",children:"Logo: "}),b.jsx("span",{className:"text-gray-600",children:r.logo_url?"Uploaded":"Not set"})]}),b.jsxs("div",{children:[b.jsx("span",{className:"font-medium",children:"Banner: "}),b.jsx("span",{className:"text-gray-600",children:r.banner_url?"Uploaded":"Not set"})]}),b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx("span",{className:"font-medium",children:"Primary Color: "}),b.jsx("div",{className:"w-4 h-4 rounded border",style:{backgroundColor:r.primary_color||"#1e40af"}}),b.jsx("span",{className:"text-gray-600",children:r.primary_color||"#1e40af"})]}),b.jsxs("div",{children:[b.jsx("span",{className:"font-medium",children:"Font: "}),b.jsx("span",{className:"text-gray-600",children:r.font_family||"Inter"})]})]})]}),b.jsxs("div",{children:[b.jsx("h4",{className:"font-medium mb-3",children:"Preview"}),b.jsxs("div",{className:"p-4 rounded-lg border",style:{backgroundColor:r.background_color||"#f9fafb",fontFamily:r.font_family||"Inter"},children:[b.jsx("div",{className:"text-lg font-bold mb-2",style:{color:r.primary_color||"#1e40af"},children:r.name}),b.jsx("div",{className:"text-sm",style:{color:r.secondary_color||"#64748b"},children:"Sample menu item description"})]})]})]})})]})},xDe=({restaurantId:r,menuItem:e,onSave:t,onCancel:i})=>{const[s,n]=E.useState(!1),[a,o]=E.useState({title:"",description:"",price:"",category:"",allergens:[],is_vegetarian:!1,is_vegan:!1,is_gluten_free:!1,is_nut_free:!1,is_active:!0,image_url:"",model_url:""}),[l,c]=E.useState(""),{toast:u}=Ar();E.useEffect(()=>{e&&o({title:e.title,description:e.description||"",price:e.price.toString(),category:e.category,allergens:e.allergens,is_vegetarian:e.is_vegetarian,is_vegan:e.is_vegan,is_gluten_free:e.is_gluten_free,is_nut_free:e.is_nut_free,is_active:e.is_active,image_url:e.image_url||"",model_url:e.model_url||""})},[e]);const h=async p=>{p.preventDefault(),n(!0);try{const m=parseFloat(a.price);if(isNaN(m))throw new Error("Please enter a valid price");const g={title:a.title,description:a.description||null,price:m,category:a.category,allergens:a.allergens,is_vegetarian:a.is_vegetarian,is_vegan:a.is_vegan,is_gluten_free:a.is_gluten_free,is_nut_free:a.is_nut_free,is_active:a.is_active,image_url:a.image_url||null,model_url:a.model_url||null,restaurant_id:r};if(e){const{error:_}=await nt.from("menu_items").update(g).eq("id",e.id);if(_)throw _;u({title:"Success",description:"Menu item updated successfully"})}else{const{data:_}=await nt.from("menu_items").select("sort_order").eq("restaurant_id",r).order("sort_order",{ascending:!1}).limit(1),v=_&&_.length>0?(_[0].sort_order||0)+1:1,{error:y}=await nt.from("menu_items").insert([{...g,sort_order:v}]);if(y)throw y;u({title:"Success",description:"Menu item created successfully"})}t()}catch(m){u({title:"Error",description:m.message,variant:"destructive"})}finally{n(!1)}},d=()=>{l.trim()&&!a.allergens.includes(l.trim())&&(o({...a,allergens:[...a.allergens,l.trim()]}),c(""))},f=p=>{o({...a,allergens:a.allergens.filter(m=>m!==p)})};return b.jsx(wO,{open:!0,onOpenChange:i,children:b.jsxs(eE,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[b.jsxs(tE,{children:[b.jsx(iE,{children:e?"Edit Menu Item":"Add New Menu Item"}),b.jsx(TO,{children:e?"Update the details of your menu item":"Create a new menu item for your restaurant"})]}),b.jsxs("form",{onSubmit:h,className:"space-y-6",children:[b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[b.jsxs("div",{children:[b.jsx(Ht,{htmlFor:"title",children:"Title *"}),b.jsx(ti,{id:"title",value:a.title,onChange:p=>o({...a,title:p.target.value}),required:!0})]}),b.jsxs("div",{children:[b.jsx(Ht,{htmlFor:"category",children:"Category *"}),b.jsx(ti,{id:"category",value:a.category,onChange:p=>o({...a,category:p.target.value}),placeholder:"e.g., Appetizer, Main Course, Dessert",required:!0})]})]}),b.jsxs("div",{children:[b.jsx(Ht,{htmlFor:"description",children:"Description"}),b.jsx(ti,{id:"description",value:a.description,onChange:p=>o({...a,description:p.target.value}),placeholder:"Describe your menu item"})]}),b.jsxs("div",{children:[b.jsx(Ht,{htmlFor:"price",children:"Price ($) *"}),b.jsx(ti,{id:"price",type:"number",step:"0.01",min:"0",value:a.price,onChange:p=>o({...a,price:p.target.value}),required:!0})]}),b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[b.jsx(a_,{bucket:"menu-images",currentUrl:a.image_url,onUpload:p=>o({...a,image_url:p}),onRemove:()=>o({...a,image_url:""}),label:"Menu Item Image",accept:"image/*"}),b.jsxs("div",{className:"space-y-4",children:[b.jsx(a_,{bucket:"3d-models",currentUrl:a.model_url,onUpload:p=>o({...a,model_url:p}),onRemove:()=>o({...a,model_url:""}),label:"3D Model File",accept:".glb,.gltf,.obj,.fbx"}),b.jsxs("div",{children:[b.jsx(Ht,{htmlFor:"playcanvas-url",children:"Or PlayCanvas Link"}),b.jsx(ti,{id:"playcanvas-url",value:a.model_url,onChange:p=>o({...a,model_url:p.target.value}),placeholder:"https://playcanv.as/p/..."})]})]})]}),b.jsxs("div",{children:[b.jsx(Ht,{children:"Dietary Options"}),b.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-2",children:[b.jsxs("label",{className:"flex items-center space-x-2",children:[b.jsx("input",{type:"checkbox",checked:a.is_vegetarian,onChange:p=>o({...a,is_vegetarian:p.target.checked})}),b.jsx("span",{children:"Vegetarian"})]}),b.jsxs("label",{className:"flex items-center space-x-2",children:[b.jsx("input",{type:"checkbox",checked:a.is_vegan,onChange:p=>o({...a,is_vegan:p.target.checked})}),b.jsx("span",{children:"Vegan"})]}),b.jsxs("label",{className:"flex items-center space-x-2",children:[b.jsx("input",{type:"checkbox",checked:a.is_gluten_free,onChange:p=>o({...a,is_gluten_free:p.target.checked})}),b.jsx("span",{children:"Gluten-Free"})]}),b.jsxs("label",{className:"flex items-center space-x-2",children:[b.jsx("input",{type:"checkbox",checked:a.is_nut_free,onChange:p=>o({...a,is_nut_free:p.target.checked})}),b.jsx("span",{children:"Nut-Free"})]})]})]}),b.jsxs("div",{children:[b.jsx(Ht,{children:"Allergens"}),b.jsxs("div",{className:"flex gap-2 mt-2",children:[b.jsx(ti,{value:l,onChange:p=>c(p.target.value),placeholder:"Add allergen",onKeyPress:p=>p.key==="Enter"&&(p.preventDefault(),d())}),b.jsx(tt,{type:"button",onClick:d,variant:"outline",children:"Add"})]}),a.allergens.length>0&&b.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:a.allergens.map(p=>b.jsxs("div",{className:"bg-gray-100 px-2 py-1 rounded-md flex items-center gap-1 text-sm",children:[p,b.jsx("button",{type:"button",onClick:()=>f(p),className:"text-red-500 hover:text-red-700",children:b.jsx(kL,{className:"w-3 h-3"})})]},p))})]}),b.jsx("div",{children:b.jsxs("label",{className:"flex items-center space-x-2",children:[b.jsx("input",{type:"checkbox",checked:a.is_active,onChange:p=>o({...a,is_active:p.target.checked})}),b.jsx("span",{children:"Active (visible to customers)"})]})}),b.jsxs("div",{className:"flex gap-2 pt-4",children:[b.jsx(tt,{type:"submit",disabled:s,children:s?"Saving...":e?"Update":"Create"}),b.jsx(tt,{type:"button",variant:"outline",onClick:i,children:"Cancel"})]})]})]})})};var By={},bDe=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},c7={},Bs={};let eN;const wDe=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];Bs.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return e*4+17};Bs.getSymbolTotalCodewords=function(e){return wDe[e]};Bs.getBCHDigit=function(r){let e=0;for(;r!==0;)e++,r>>>=1;return e};Bs.setToSJISFunction=function(e){if(typeof e!="function")throw new Error('"toSJISFunc" is not a valid function.');eN=e};Bs.isKanjiModeEnabled=function(){return typeof eN<"u"};Bs.toSJIS=function(e){return eN(e)};var rA={};(function(r){r.L={bit:1},r.M={bit:0},r.Q={bit:3},r.H={bit:2};function e(t){if(typeof t!="string")throw new Error("Param is not a string");switch(t.toLowerCase()){case"l":case"low":return r.L;case"m":case"medium":return r.M;case"q":case"quartile":return r.Q;case"h":case"high":return r.H;default:throw new Error("Unknown EC Level: "+t)}}r.isValid=function(i){return i&&typeof i.bit<"u"&&i.bit>=0&&i.bit<4},r.from=function(i,s){if(r.isValid(i))return i;try{return e(i)}catch{return s}}})(rA);function u7(){this.buffer=[],this.length=0}u7.prototype={get:function(r){const e=Math.floor(r/8);return(this.buffer[e]>>>7-r%8&1)===1},put:function(r,e){for(let t=0;t<e;t++)this.putBit((r>>>e-t-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(r){const e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),r&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var TDe=u7;function Uy(r){if(!r||r<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=r,this.data=new Uint8Array(r*r),this.reservedBit=new Uint8Array(r*r)}Uy.prototype.set=function(r,e,t,i){const s=r*this.size+e;this.data[s]=t,i&&(this.reservedBit[s]=!0)};Uy.prototype.get=function(r,e){return this.data[r*this.size+e]};Uy.prototype.xor=function(r,e,t){this.data[r*this.size+e]^=t};Uy.prototype.isReserved=function(r,e){return this.reservedBit[r*this.size+e]};var EDe=Uy,h7={};(function(r){const e=Bs.getSymbolSize;r.getRowColCoords=function(i){if(i===1)return[];const s=Math.floor(i/7)+2,n=e(i),a=n===145?26:Math.ceil((n-13)/(2*s-2))*2,o=[n-7];for(let l=1;l<s-1;l++)o[l]=o[l-1]-a;return o.push(6),o.reverse()},r.getPositions=function(i){const s=[],n=r.getRowColCoords(i),a=n.length;for(let o=0;o<a;o++)for(let l=0;l<a;l++)o===0&&l===0||o===0&&l===a-1||o===a-1&&l===0||s.push([n[o],n[l]]);return s}})(h7);var d7={};const ADe=Bs.getSymbolSize,QV=7;d7.getPositions=function(e){const t=ADe(e);return[[0,0],[t-QV,0],[0,t-QV]]};var f7={};(function(r){r.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const e={N1:3,N2:3,N3:40,N4:10};r.isValid=function(s){return s!=null&&s!==""&&!isNaN(s)&&s>=0&&s<=7},r.from=function(s){return r.isValid(s)?parseInt(s,10):void 0},r.getPenaltyN1=function(s){const n=s.size;let a=0,o=0,l=0,c=null,u=null;for(let h=0;h<n;h++){o=l=0,c=u=null;for(let d=0;d<n;d++){let f=s.get(h,d);f===c?o++:(o>=5&&(a+=e.N1+(o-5)),c=f,o=1),f=s.get(d,h),f===u?l++:(l>=5&&(a+=e.N1+(l-5)),u=f,l=1)}o>=5&&(a+=e.N1+(o-5)),l>=5&&(a+=e.N1+(l-5))}return a},r.getPenaltyN2=function(s){const n=s.size;let a=0;for(let o=0;o<n-1;o++)for(let l=0;l<n-1;l++){const c=s.get(o,l)+s.get(o,l+1)+s.get(o+1,l)+s.get(o+1,l+1);(c===4||c===0)&&a++}return a*e.N2},r.getPenaltyN3=function(s){const n=s.size;let a=0,o=0,l=0;for(let c=0;c<n;c++){o=l=0;for(let u=0;u<n;u++)o=o<<1&2047|s.get(c,u),u>=10&&(o===1488||o===93)&&a++,l=l<<1&2047|s.get(u,c),u>=10&&(l===1488||l===93)&&a++}return a*e.N3},r.getPenaltyN4=function(s){let n=0;const a=s.data.length;for(let l=0;l<a;l++)n+=s.data[l];return Math.abs(Math.ceil(n*100/a/5)-10)*e.N4};function t(i,s,n){switch(i){case r.Patterns.PATTERN000:return(s+n)%2===0;case r.Patterns.PATTERN001:return s%2===0;case r.Patterns.PATTERN010:return n%3===0;case r.Patterns.PATTERN011:return(s+n)%3===0;case r.Patterns.PATTERN100:return(Math.floor(s/2)+Math.floor(n/3))%2===0;case r.Patterns.PATTERN101:return s*n%2+s*n%3===0;case r.Patterns.PATTERN110:return(s*n%2+s*n%3)%2===0;case r.Patterns.PATTERN111:return(s*n%3+(s+n)%2)%2===0;default:throw new Error("bad maskPattern:"+i)}}r.applyMask=function(s,n){const a=n.size;for(let o=0;o<a;o++)for(let l=0;l<a;l++)n.isReserved(l,o)||n.xor(l,o,t(s,l,o))},r.getBestMask=function(s,n){const a=Object.keys(r.Patterns).length;let o=0,l=1/0;for(let c=0;c<a;c++){n(c),r.applyMask(c,s);const u=r.getPenaltyN1(s)+r.getPenaltyN2(s)+r.getPenaltyN3(s)+r.getPenaltyN4(s);r.applyMask(c,s),u<l&&(l=u,o=c)}return o}})(f7);var sA={};const tc=rA,xS=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],bS=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];sA.getBlocksCount=function(e,t){switch(t){case tc.L:return xS[(e-1)*4+0];case tc.M:return xS[(e-1)*4+1];case tc.Q:return xS[(e-1)*4+2];case tc.H:return xS[(e-1)*4+3];default:return}};sA.getTotalCodewordsCount=function(e,t){switch(t){case tc.L:return bS[(e-1)*4+0];case tc.M:return bS[(e-1)*4+1];case tc.Q:return bS[(e-1)*4+2];case tc.H:return bS[(e-1)*4+3];default:return}};var p7={},nA={};const o_=new Uint8Array(512),Wb=new Uint8Array(256);(function(){let e=1;for(let t=0;t<255;t++)o_[t]=e,Wb[e]=t,e<<=1,e&256&&(e^=285);for(let t=255;t<512;t++)o_[t]=o_[t-255]})();nA.log=function(e){if(e<1)throw new Error("log("+e+")");return Wb[e]};nA.exp=function(e){return o_[e]};nA.mul=function(e,t){return e===0||t===0?0:o_[Wb[e]+Wb[t]]};(function(r){const e=nA;r.mul=function(i,s){const n=new Uint8Array(i.length+s.length-1);for(let a=0;a<i.length;a++)for(let o=0;o<s.length;o++)n[a+o]^=e.mul(i[a],s[o]);return n},r.mod=function(i,s){let n=new Uint8Array(i);for(;n.length-s.length>=0;){const a=n[0];for(let l=0;l<s.length;l++)n[l]^=e.mul(s[l],a);let o=0;for(;o<n.length&&n[o]===0;)o++;n=n.slice(o)}return n},r.generateECPolynomial=function(i){let s=new Uint8Array([1]);for(let n=0;n<i;n++)s=r.mul(s,new Uint8Array([1,e.exp(n)]));return s}})(p7);const m7=p7;function tN(r){this.genPoly=void 0,this.degree=r,this.degree&&this.initialize(this.degree)}tN.prototype.initialize=function(e){this.degree=e,this.genPoly=m7.generateECPolynomial(this.degree)};tN.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");const t=new Uint8Array(e.length+this.degree);t.set(e);const i=m7.mod(t,this.genPoly),s=this.degree-i.length;if(s>0){const n=new Uint8Array(this.degree);return n.set(i,s),n}return i};var CDe=tN,g7={},Nc={},iN={};iN.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40};var Za={};const _7="[0-9]+",PDe="[A-Z $%*+\\-./:]+";let dv="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";dv=dv.replace(/u/g,"\\u");const IDe="(?:(?![A-Z0-9 $%*+\\-./:]|"+dv+`)(?:.|[\r
]))+`;Za.KANJI=new RegExp(dv,"g");Za.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");Za.BYTE=new RegExp(IDe,"g");Za.NUMERIC=new RegExp(_7,"g");Za.ALPHANUMERIC=new RegExp(PDe,"g");const MDe=new RegExp("^"+dv+"$"),RDe=new RegExp("^"+_7+"$"),DDe=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");Za.testKanji=function(e){return MDe.test(e)};Za.testNumeric=function(e){return RDe.test(e)};Za.testAlphanumeric=function(e){return DDe.test(e)};(function(r){const e=iN,t=Za;r.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},r.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},r.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},r.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},r.MIXED={bit:-1},r.getCharCountIndicator=function(n,a){if(!n.ccBits)throw new Error("Invalid mode: "+n);if(!e.isValid(a))throw new Error("Invalid version: "+a);return a>=1&&a<10?n.ccBits[0]:a<27?n.ccBits[1]:n.ccBits[2]},r.getBestModeForData=function(n){return t.testNumeric(n)?r.NUMERIC:t.testAlphanumeric(n)?r.ALPHANUMERIC:t.testKanji(n)?r.KANJI:r.BYTE},r.toString=function(n){if(n&&n.id)return n.id;throw new Error("Invalid mode")},r.isValid=function(n){return n&&n.bit&&n.ccBits};function i(s){if(typeof s!="string")throw new Error("Param is not a string");switch(s.toLowerCase()){case"numeric":return r.NUMERIC;case"alphanumeric":return r.ALPHANUMERIC;case"kanji":return r.KANJI;case"byte":return r.BYTE;default:throw new Error("Unknown mode: "+s)}}r.from=function(n,a){if(r.isValid(n))return n;try{return i(n)}catch{return a}}})(Nc);(function(r){const e=Bs,t=sA,i=rA,s=Nc,n=iN,a=7973,o=e.getBCHDigit(a);function l(d,f,p){for(let m=1;m<=40;m++)if(f<=r.getCapacity(m,p,d))return m}function c(d,f){return s.getCharCountIndicator(d,f)+4}function u(d,f){let p=0;return d.forEach(function(m){const g=c(m.mode,f);p+=g+m.getBitsLength()}),p}function h(d,f){for(let p=1;p<=40;p++)if(u(d,p)<=r.getCapacity(p,f,s.MIXED))return p}r.from=function(f,p){return n.isValid(f)?parseInt(f,10):p},r.getCapacity=function(f,p,m){if(!n.isValid(f))throw new Error("Invalid QR Code version");typeof m>"u"&&(m=s.BYTE);const g=e.getSymbolTotalCodewords(f),_=t.getTotalCodewordsCount(f,p),v=(g-_)*8;if(m===s.MIXED)return v;const y=v-c(m,f);switch(m){case s.NUMERIC:return Math.floor(y/10*3);case s.ALPHANUMERIC:return Math.floor(y/11*2);case s.KANJI:return Math.floor(y/13);case s.BYTE:default:return Math.floor(y/8)}},r.getBestVersionForData=function(f,p){let m;const g=i.from(p,i.M);if(Array.isArray(f)){if(f.length>1)return h(f,g);if(f.length===0)return 1;m=f[0]}else m=f;return l(m.mode,m.getLength(),g)},r.getEncodedBits=function(f){if(!n.isValid(f)||f<7)throw new Error("Invalid QR Code version");let p=f<<12;for(;e.getBCHDigit(p)-o>=0;)p^=a<<e.getBCHDigit(p)-o;return f<<12|p}})(g7);var v7={};const Z2=Bs,y7=1335,LDe=21522,JV=Z2.getBCHDigit(y7);v7.getEncodedBits=function(e,t){const i=e.bit<<3|t;let s=i<<10;for(;Z2.getBCHDigit(s)-JV>=0;)s^=y7<<Z2.getBCHDigit(s)-JV;return(i<<10|s)^LDe};var S7={};const ODe=Nc;function wp(r){this.mode=ODe.NUMERIC,this.data=r.toString()}wp.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)};wp.prototype.getLength=function(){return this.data.length};wp.prototype.getBitsLength=function(){return wp.getBitsLength(this.data.length)};wp.prototype.write=function(e){let t,i,s;for(t=0;t+3<=this.data.length;t+=3)i=this.data.substr(t,3),s=parseInt(i,10),e.put(s,10);const n=this.data.length-t;n>0&&(i=this.data.substr(t),s=parseInt(i,10),e.put(s,n*3+1))};var NDe=wp;const kDe=Nc,nP=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function Tp(r){this.mode=kDe.ALPHANUMERIC,this.data=r}Tp.getBitsLength=function(e){return 11*Math.floor(e/2)+6*(e%2)};Tp.prototype.getLength=function(){return this.data.length};Tp.prototype.getBitsLength=function(){return Tp.getBitsLength(this.data.length)};Tp.prototype.write=function(e){let t;for(t=0;t+2<=this.data.length;t+=2){let i=nP.indexOf(this.data[t])*45;i+=nP.indexOf(this.data[t+1]),e.put(i,11)}this.data.length%2&&e.put(nP.indexOf(this.data[t]),6)};var FDe=Tp;const BDe=Nc;function Ep(r){this.mode=BDe.BYTE,typeof r=="string"?this.data=new TextEncoder().encode(r):this.data=new Uint8Array(r)}Ep.getBitsLength=function(e){return e*8};Ep.prototype.getLength=function(){return this.data.length};Ep.prototype.getBitsLength=function(){return Ep.getBitsLength(this.data.length)};Ep.prototype.write=function(r){for(let e=0,t=this.data.length;e<t;e++)r.put(this.data[e],8)};var UDe=Ep;const zDe=Nc,VDe=Bs;function Ap(r){this.mode=zDe.KANJI,this.data=r}Ap.getBitsLength=function(e){return e*13};Ap.prototype.getLength=function(){return this.data.length};Ap.prototype.getBitsLength=function(){return Ap.getBitsLength(this.data.length)};Ap.prototype.write=function(r){let e;for(e=0;e<this.data.length;e++){let t=VDe.toSJIS(this.data[e]);if(t>=33088&&t<=40956)t-=33088;else if(t>=57408&&t<=60351)t-=49472;else throw new Error("Invalid SJIS character: "+this.data[e]+`
Make sure your charset is UTF-8`);t=(t>>>8&255)*192+(t&255),r.put(t,13)}};var jDe=Ap,x7={exports:{}};(function(r){var e={single_source_shortest_paths:function(t,i,s){var n={},a={};a[i]=0;var o=e.PriorityQueue.make();o.push(i,0);for(var l,c,u,h,d,f,p,m,g;!o.empty();){l=o.pop(),c=l.value,h=l.cost,d=t[c]||{};for(u in d)d.hasOwnProperty(u)&&(f=d[u],p=h+f,m=a[u],g=typeof a[u]>"u",(g||m>p)&&(a[u]=p,o.push(u,p),n[u]=c))}if(typeof s<"u"&&typeof a[s]>"u"){var _=["Could not find a path from ",i," to ",s,"."].join("");throw new Error(_)}return n},extract_shortest_path_from_predecessor_list:function(t,i){for(var s=[],n=i;n;)s.push(n),t[n],n=t[n];return s.reverse(),s},find_path:function(t,i,s){var n=e.single_source_shortest_paths(t,i,s);return e.extract_shortest_path_from_predecessor_list(n,s)},PriorityQueue:{make:function(t){var i=e.PriorityQueue,s={},n;t=t||{};for(n in i)i.hasOwnProperty(n)&&(s[n]=i[n]);return s.queue=[],s.sorter=t.sorter||i.default_sorter,s},default_sorter:function(t,i){return t.cost-i.cost},push:function(t,i){var s={value:t,cost:i};this.queue.push(s),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};r.exports=e})(x7);var $De=x7.exports;(function(r){const e=Nc,t=NDe,i=FDe,s=UDe,n=jDe,a=Za,o=Bs,l=$De;function c(_){return unescape(encodeURIComponent(_)).length}function u(_,v,y){const x=[];let S;for(;(S=_.exec(y))!==null;)x.push({data:S[0],index:S.index,mode:v,length:S[0].length});return x}function h(_){const v=u(a.NUMERIC,e.NUMERIC,_),y=u(a.ALPHANUMERIC,e.ALPHANUMERIC,_);let x,S;return o.isKanjiModeEnabled()?(x=u(a.BYTE,e.BYTE,_),S=u(a.KANJI,e.KANJI,_)):(x=u(a.BYTE_KANJI,e.BYTE,_),S=[]),v.concat(y,x,S).sort(function(T,A){return T.index-A.index}).map(function(T){return{data:T.data,mode:T.mode,length:T.length}})}function d(_,v){switch(v){case e.NUMERIC:return t.getBitsLength(_);case e.ALPHANUMERIC:return i.getBitsLength(_);case e.KANJI:return n.getBitsLength(_);case e.BYTE:return s.getBitsLength(_)}}function f(_){return _.reduce(function(v,y){const x=v.length-1>=0?v[v.length-1]:null;return x&&x.mode===y.mode?(v[v.length-1].data+=y.data,v):(v.push(y),v)},[])}function p(_){const v=[];for(let y=0;y<_.length;y++){const x=_[y];switch(x.mode){case e.NUMERIC:v.push([x,{data:x.data,mode:e.ALPHANUMERIC,length:x.length},{data:x.data,mode:e.BYTE,length:x.length}]);break;case e.ALPHANUMERIC:v.push([x,{data:x.data,mode:e.BYTE,length:x.length}]);break;case e.KANJI:v.push([x,{data:x.data,mode:e.BYTE,length:c(x.data)}]);break;case e.BYTE:v.push([{data:x.data,mode:e.BYTE,length:c(x.data)}])}}return v}function m(_,v){const y={},x={start:{}};let S=["start"];for(let w=0;w<_.length;w++){const T=_[w],A=[];for(let C=0;C<T.length;C++){const P=T[C],I=""+w+C;A.push(I),y[I]={node:P,lastCount:0},x[I]={};for(let M=0;M<S.length;M++){const N=S[M];y[N]&&y[N].node.mode===P.mode?(x[N][I]=d(y[N].lastCount+P.length,P.mode)-d(y[N].lastCount,P.mode),y[N].lastCount+=P.length):(y[N]&&(y[N].lastCount=P.length),x[N][I]=d(P.length,P.mode)+4+e.getCharCountIndicator(P.mode,v))}}S=A}for(let w=0;w<S.length;w++)x[S[w]].end=0;return{map:x,table:y}}function g(_,v){let y;const x=e.getBestModeForData(_);if(y=e.from(v,x),y!==e.BYTE&&y.bit<x.bit)throw new Error('"'+_+'" cannot be encoded with mode '+e.toString(y)+`.
 Suggested mode is: `+e.toString(x));switch(y===e.KANJI&&!o.isKanjiModeEnabled()&&(y=e.BYTE),y){case e.NUMERIC:return new t(_);case e.ALPHANUMERIC:return new i(_);case e.KANJI:return new n(_);case e.BYTE:return new s(_)}}r.fromArray=function(v){return v.reduce(function(y,x){return typeof x=="string"?y.push(g(x,null)):x.data&&y.push(g(x.data,x.mode)),y},[])},r.fromString=function(v,y){const x=h(v,o.isKanjiModeEnabled()),S=p(x),w=m(S,y),T=l.find_path(w.map,"start","end"),A=[];for(let C=1;C<T.length-1;C++)A.push(w.table[T[C]].node);return r.fromArray(f(A))},r.rawSplit=function(v){return r.fromArray(h(v,o.isKanjiModeEnabled()))}})(S7);const aA=Bs,aP=rA,HDe=TDe,GDe=EDe,WDe=h7,XDe=d7,Q2=f7,J2=sA,qDe=CDe,Xb=g7,YDe=v7,KDe=Nc,oP=S7;function ZDe(r,e){const t=r.size,i=XDe.getPositions(e);for(let s=0;s<i.length;s++){const n=i[s][0],a=i[s][1];for(let o=-1;o<=7;o++)if(!(n+o<=-1||t<=n+o))for(let l=-1;l<=7;l++)a+l<=-1||t<=a+l||(o>=0&&o<=6&&(l===0||l===6)||l>=0&&l<=6&&(o===0||o===6)||o>=2&&o<=4&&l>=2&&l<=4?r.set(n+o,a+l,!0,!0):r.set(n+o,a+l,!1,!0))}}function QDe(r){const e=r.size;for(let t=8;t<e-8;t++){const i=t%2===0;r.set(t,6,i,!0),r.set(6,t,i,!0)}}function JDe(r,e){const t=WDe.getPositions(e);for(let i=0;i<t.length;i++){const s=t[i][0],n=t[i][1];for(let a=-2;a<=2;a++)for(let o=-2;o<=2;o++)a===-2||a===2||o===-2||o===2||a===0&&o===0?r.set(s+a,n+o,!0,!0):r.set(s+a,n+o,!1,!0)}}function eLe(r,e){const t=r.size,i=Xb.getEncodedBits(e);let s,n,a;for(let o=0;o<18;o++)s=Math.floor(o/3),n=o%3+t-8-3,a=(i>>o&1)===1,r.set(s,n,a,!0),r.set(n,s,a,!0)}function lP(r,e,t){const i=r.size,s=YDe.getEncodedBits(e,t);let n,a;for(n=0;n<15;n++)a=(s>>n&1)===1,n<6?r.set(n,8,a,!0):n<8?r.set(n+1,8,a,!0):r.set(i-15+n,8,a,!0),n<8?r.set(8,i-n-1,a,!0):n<9?r.set(8,15-n-1+1,a,!0):r.set(8,15-n-1,a,!0);r.set(i-8,8,1,!0)}function tLe(r,e){const t=r.size;let i=-1,s=t-1,n=7,a=0;for(let o=t-1;o>0;o-=2)for(o===6&&o--;;){for(let l=0;l<2;l++)if(!r.isReserved(s,o-l)){let c=!1;a<e.length&&(c=(e[a]>>>n&1)===1),r.set(s,o-l,c),n--,n===-1&&(a++,n=7)}if(s+=i,s<0||t<=s){s-=i,i=-i;break}}}function iLe(r,e,t){const i=new HDe;t.forEach(function(l){i.put(l.mode.bit,4),i.put(l.getLength(),KDe.getCharCountIndicator(l.mode,r)),l.write(i)});const s=aA.getSymbolTotalCodewords(r),n=J2.getTotalCodewordsCount(r,e),a=(s-n)*8;for(i.getLengthInBits()+4<=a&&i.put(0,4);i.getLengthInBits()%8!==0;)i.putBit(0);const o=(a-i.getLengthInBits())/8;for(let l=0;l<o;l++)i.put(l%2?17:236,8);return rLe(i,r,e)}function rLe(r,e,t){const i=aA.getSymbolTotalCodewords(e),s=J2.getTotalCodewordsCount(e,t),n=i-s,a=J2.getBlocksCount(e,t),o=i%a,l=a-o,c=Math.floor(i/a),u=Math.floor(n/a),h=u+1,d=c-u,f=new qDe(d);let p=0;const m=new Array(a),g=new Array(a);let _=0;const v=new Uint8Array(r.buffer);for(let T=0;T<a;T++){const A=T<l?u:h;m[T]=v.slice(p,p+A),g[T]=f.encode(m[T]),p+=A,_=Math.max(_,A)}const y=new Uint8Array(i);let x=0,S,w;for(S=0;S<_;S++)for(w=0;w<a;w++)S<m[w].length&&(y[x++]=m[w][S]);for(S=0;S<d;S++)for(w=0;w<a;w++)y[x++]=g[w][S];return y}function sLe(r,e,t,i){let s;if(Array.isArray(r))s=oP.fromArray(r);else if(typeof r=="string"){let c=e;if(!c){const u=oP.rawSplit(r);c=Xb.getBestVersionForData(u,t)}s=oP.fromString(r,c||40)}else throw new Error("Invalid data");const n=Xb.getBestVersionForData(s,t);if(!n)throw new Error("The amount of data is too big to be stored in a QR Code");if(!e)e=n;else if(e<n)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+n+`.
`);const a=iLe(e,t,s),o=aA.getSymbolSize(e),l=new GDe(o);return ZDe(l,e),QDe(l),JDe(l,e),lP(l,t,0),e>=7&&eLe(l,e),tLe(l,a),isNaN(i)&&(i=Q2.getBestMask(l,lP.bind(null,l,t))),Q2.applyMask(i,l),lP(l,t,i),{modules:l,version:e,errorCorrectionLevel:t,maskPattern:i,segments:s}}c7.create=function(e,t){if(typeof e>"u"||e==="")throw new Error("No input text");let i=aP.M,s,n;return typeof t<"u"&&(i=aP.from(t.errorCorrectionLevel,aP.M),s=Xb.from(t.version),n=Q2.from(t.maskPattern),t.toSJISFunc&&aA.setToSJISFunction(t.toSJISFunc)),sLe(e,s,i,n)};var b7={},rN={};(function(r){function e(t){if(typeof t=="number"&&(t=t.toString()),typeof t!="string")throw new Error("Color should be defined as hex string");let i=t.slice().replace("#","").split("");if(i.length<3||i.length===5||i.length>8)throw new Error("Invalid hex color: "+t);(i.length===3||i.length===4)&&(i=Array.prototype.concat.apply([],i.map(function(n){return[n,n]}))),i.length===6&&i.push("F","F");const s=parseInt(i.join(""),16);return{r:s>>24&255,g:s>>16&255,b:s>>8&255,a:s&255,hex:"#"+i.slice(0,6).join("")}}r.getOptions=function(i){i||(i={}),i.color||(i.color={});const s=typeof i.margin>"u"||i.margin===null||i.margin<0?4:i.margin,n=i.width&&i.width>=21?i.width:void 0,a=i.scale||4;return{width:n,scale:n?4:a,margin:s,color:{dark:e(i.color.dark||"#000000ff"),light:e(i.color.light||"#ffffffff")},type:i.type,rendererOpts:i.rendererOpts||{}}},r.getScale=function(i,s){return s.width&&s.width>=i+s.margin*2?s.width/(i+s.margin*2):s.scale},r.getImageWidth=function(i,s){const n=r.getScale(i,s);return Math.floor((i+s.margin*2)*n)},r.qrToImageData=function(i,s,n){const a=s.modules.size,o=s.modules.data,l=r.getScale(a,n),c=Math.floor((a+n.margin*2)*l),u=n.margin*l,h=[n.color.light,n.color.dark];for(let d=0;d<c;d++)for(let f=0;f<c;f++){let p=(d*c+f)*4,m=n.color.light;if(d>=u&&f>=u&&d<c-u&&f<c-u){const g=Math.floor((d-u)/l),_=Math.floor((f-u)/l);m=h[o[g*a+_]?1:0]}i[p++]=m.r,i[p++]=m.g,i[p++]=m.b,i[p]=m.a}}})(rN);(function(r){const e=rN;function t(s,n,a){s.clearRect(0,0,n.width,n.height),n.style||(n.style={}),n.height=a,n.width=a,n.style.height=a+"px",n.style.width=a+"px"}function i(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}r.render=function(n,a,o){let l=o,c=a;typeof l>"u"&&(!a||!a.getContext)&&(l=a,a=void 0),a||(c=i()),l=e.getOptions(l);const u=e.getImageWidth(n.modules.size,l),h=c.getContext("2d"),d=h.createImageData(u,u);return e.qrToImageData(d.data,n,l),t(h,c,u),h.putImageData(d,0,0),c},r.renderToDataURL=function(n,a,o){let l=o;typeof l>"u"&&(!a||!a.getContext)&&(l=a,a=void 0),l||(l={});const c=r.render(n,a,l),u=l.type||"image/png",h=l.rendererOpts||{};return c.toDataURL(u,h.quality)}})(b7);var w7={};const nLe=rN;function e4(r,e){const t=r.a/255,i=e+'="'+r.hex+'"';return t<1?i+" "+e+'-opacity="'+t.toFixed(2).slice(1)+'"':i}function cP(r,e,t){let i=r+e;return typeof t<"u"&&(i+=" "+t),i}function aLe(r,e,t){let i="",s=0,n=!1,a=0;for(let o=0;o<r.length;o++){const l=Math.floor(o%e),c=Math.floor(o/e);!l&&!n&&(n=!0),r[o]?(a++,o>0&&l>0&&r[o-1]||(i+=n?cP("M",l+t,.5+c+t):cP("m",s,0),s=0,n=!1),l+1<e&&r[o+1]||(i+=cP("h",a),a=0)):s++}return i}w7.render=function(e,t,i){const s=nLe.getOptions(t),n=e.modules.size,a=e.modules.data,o=n+s.margin*2,l=s.color.light.a?"<path "+e4(s.color.light,"fill")+' d="M0 0h'+o+"v"+o+'H0z"/>':"",c="<path "+e4(s.color.dark,"stroke")+' d="'+aLe(a,n,s.margin)+'"/>',u='viewBox="0 0 '+o+" "+o+'"',d='<svg xmlns="http://www.w3.org/2000/svg" '+(s.width?'width="'+s.width+'" height="'+s.width+'" ':"")+u+' shape-rendering="crispEdges">'+l+c+`</svg>
`;return typeof i=="function"&&i(null,d),d};const oLe=bDe,eR=c7,T7=b7,lLe=w7;function sN(r,e,t,i,s){const n=[].slice.call(arguments,1),a=n.length,o=typeof n[a-1]=="function";if(!o&&!oLe())throw new Error("Callback required as last argument");if(o){if(a<2)throw new Error("Too few arguments provided");a===2?(s=t,t=e,e=i=void 0):a===3&&(e.getContext&&typeof s>"u"?(s=i,i=void 0):(s=i,i=t,t=e,e=void 0))}else{if(a<1)throw new Error("Too few arguments provided");return a===1?(t=e,e=i=void 0):a===2&&!e.getContext&&(i=t,t=e,e=void 0),new Promise(function(l,c){try{const u=eR.create(t,i);l(r(u,e,i))}catch(u){c(u)}})}try{const l=eR.create(t,i);s(null,r(l,e,i))}catch(l){s(l)}}By.create=eR.create;By.toCanvas=sN.bind(null,T7.render);By.toDataURL=sN.bind(null,T7.renderToDataURL);By.toString=sN.bind(null,function(r,e,t){return lLe.render(r,t)});const cLe=({restaurantId:r,restaurantName:e})=>{const[t,i]=E.useState(""),[s,n]=E.useState(!0);E.useEffect(()=>{a()},[r]);const a=async()=>{try{n(!0);const h=`${window.location.origin}/`,d=await By.toDataURL(h,{width:256,margin:2,color:{dark:"#1f2937",light:"#ffffff"}});i(d)}catch(h){console.error("Error generating QR code:",h)}finally{n(!1)}},o=()=>{if(!t)return;const h=document.createElement("a");h.download=`${e.replace(/\s+/g,"_")}_menu_qr_code.png`,h.href=t,document.body.appendChild(h),h.click(),document.body.removeChild(h)},l=()=>{const h=`${window.location.origin}/`,d=`Check out ${e}'s digital menu! Visit: ${h}`;navigator.share?navigator.share({text:d}).catch(f=>{console.log("Share failed:",f),c(d)}):c(d)},c=h=>{const f=`sms:?body=${encodeURIComponent(h)}`;window.open(f,"_self")},u=()=>{if(!t)return;const h=window.open("","_blank");h&&(h.document.write(`
        <html>
          <head>
            <title>${e} - Menu QR Code</title>
            <style>
              body {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                margin: 0;
                padding: 20px;
                font-family: Arial, sans-serif;
              }
              .qr-container {
                text-align: center;
                border: 1px solid #ccc;
                padding: 20px;
                border-radius: 8px;
              }
              h1 {
                margin-bottom: 10px;
                color: #1f2937;
              }
              p {
                margin-bottom: 20px;
                color: #6b7280;
              }
              img {
                max-width: 100%;
                height: auto;
              }
            </style>
          </head>
          <body>
            <div class="qr-container">
              <h1>${e}</h1>
              <p>Scan to view our digital menu</p>
              <img src="${t}" alt="Menu QR Code" />
              <p style="margin-top: 20px; font-size: 12px;">Point your camera at this QR code to access our menu</p>
            </div>
          </body>
        </html>
      `),h.document.close(),h.print())};return s?b.jsxs(Vt,{children:[b.jsxs(Dr,{children:[b.jsxs(Lr,{className:"flex items-center gap-2",children:[b.jsx($F,{className:"w-5 h-5"}),"Menu QR Code"]}),b.jsx(Or,{children:"Generate QR code for easy menu access"})]}),b.jsx(jt,{children:b.jsx("div",{className:"flex items-center justify-center h-64",children:b.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})})]}):b.jsxs(Vt,{children:[b.jsxs(Dr,{children:[b.jsxs(Lr,{className:"flex items-center gap-2",children:[b.jsx($F,{className:"w-5 h-5"}),"Menu QR Code"]}),b.jsx(Or,{children:"Let customers scan this QR code to access your digital menu"})]}),b.jsxs(jt,{className:"space-y-4",children:[b.jsx("div",{className:"flex justify-center",children:b.jsx("div",{className:"bg-white p-4 rounded-lg border",children:b.jsx("img",{src:t,alt:"Menu QR Code",className:"w-64 h-64"})})}),b.jsxs("div",{className:"text-center space-y-2",children:[b.jsx("p",{className:"text-sm text-gray-600",children:"Customers can scan this code with their phone camera to view your menu"}),b.jsxs("p",{className:"text-xs text-gray-500",children:["Menu URL: ",window.location.origin,"/"]})]}),b.jsxs("div",{className:"flex gap-2 justify-center",children:[b.jsxs(tt,{onClick:o,variant:"outline",children:[b.jsx(dse,{className:"w-4 h-4 mr-2"}),"Download"]}),b.jsxs(tt,{onClick:l,variant:"outline",children:[b.jsx(l8,{className:"w-4 h-4 mr-2"}),"Share via Text"]}),b.jsx(tt,{onClick:u,variant:"outline",children:"Print"})]})]})]})},uLe=({onSignOut:r})=>b.jsx("header",{className:"bg-white shadow-sm border-b",children:b.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:b.jsxs("div",{className:"flex justify-between items-center",children:[b.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Restaurant Admin"}),b.jsxs(tt,{onClick:r,variant:"outline",children:[b.jsx(_se,{className:"w-4 h-4 mr-2"}),"Sign Out"]})]})})}),hLe=({activeTab:r,onTabChange:e})=>b.jsxs("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg w-fit",children:[b.jsx("button",{onClick:()=>e("menu"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${r==="menu"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Menu Management"}),b.jsxs("button",{onClick:()=>e("analytics"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors flex items-center gap-2 ${r==="analytics"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[b.jsx(lse,{className:"w-4 h-4"}),"Analytics"]})]});function dLe(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return E.useMemo(()=>i=>{e.forEach(s=>s(i))},e)}const oA=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function mm(r){const e=Object.prototype.toString.call(r);return e==="[object Window]"||e==="[object global]"}function nN(r){return"nodeType"in r}function rs(r){var e,t;return r?mm(r)?r:nN(r)&&(e=(t=r.ownerDocument)==null?void 0:t.defaultView)!=null?e:window:window}function aN(r){const{Document:e}=rs(r);return r instanceof e}function zy(r){return mm(r)?!1:r instanceof rs(r).HTMLElement}function E7(r){return r instanceof rs(r).SVGElement}function gm(r){return r?mm(r)?r.document:nN(r)?aN(r)?r:zy(r)||E7(r)?r.ownerDocument:document:document:document}const ja=oA?E.useLayoutEffect:E.useEffect;function oN(r){const e=E.useRef(r);return ja(()=>{e.current=r}),E.useCallback(function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return e.current==null?void 0:e.current(...i)},[])}function fLe(){const r=E.useRef(null),e=E.useCallback((i,s)=>{r.current=setInterval(i,s)},[]),t=E.useCallback(()=>{r.current!==null&&(clearInterval(r.current),r.current=null)},[]);return[e,t]}function fv(r,e){e===void 0&&(e=[r]);const t=E.useRef(r);return ja(()=>{t.current!==r&&(t.current=r)},e),t}function Vy(r,e){const t=E.useRef();return E.useMemo(()=>{const i=r(t.current);return t.current=i,i},[...e])}function qb(r){const e=oN(r),t=E.useRef(null),i=E.useCallback(s=>{s!==t.current&&(e==null||e(s,t.current)),t.current=s},[]);return[t,i]}function tR(r){const e=E.useRef();return E.useEffect(()=>{e.current=r},[r]),e.current}let uP={};function jy(r,e){return E.useMemo(()=>{if(e)return e;const t=uP[r]==null?0:uP[r]+1;return uP[r]=t,r+"-"+t},[r,e])}function A7(r){return function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];return i.reduce((n,a)=>{const o=Object.entries(a);for(const[l,c]of o){const u=n[l];u!=null&&(n[l]=u+r*c)}return n},{...e})}}const kf=A7(1),pv=A7(-1);function pLe(r){return"clientX"in r&&"clientY"in r}function lN(r){if(!r)return!1;const{KeyboardEvent:e}=rs(r.target);return e&&r instanceof e}function mLe(r){if(!r)return!1;const{TouchEvent:e}=rs(r.target);return e&&r instanceof e}function iR(r){if(mLe(r)){if(r.touches&&r.touches.length){const{clientX:e,clientY:t}=r.touches[0];return{x:e,y:t}}else if(r.changedTouches&&r.changedTouches.length){const{clientX:e,clientY:t}=r.changedTouches[0];return{x:e,y:t}}}return pLe(r)?{x:r.clientX,y:r.clientY}:null}const mv=Object.freeze({Translate:{toString(r){if(!r)return;const{x:e,y:t}=r;return"translate3d("+(e?Math.round(e):0)+"px, "+(t?Math.round(t):0)+"px, 0)"}},Scale:{toString(r){if(!r)return;const{scaleX:e,scaleY:t}=r;return"scaleX("+e+") scaleY("+t+")"}},Transform:{toString(r){if(r)return[mv.Translate.toString(r),mv.Scale.toString(r)].join(" ")}},Transition:{toString(r){let{property:e,duration:t,easing:i}=r;return e+" "+t+"ms "+i}}}),t4="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function gLe(r){return r.matches(t4)?r:r.querySelector(t4)}const _Le={display:"none"};function vLe(r){let{id:e,value:t}=r;return U.createElement("div",{id:e,style:_Le},t)}function yLe(r){let{id:e,announcement:t,ariaLiveType:i="assertive"}=r;const s={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return U.createElement("div",{id:e,style:s,role:"status","aria-live":i,"aria-atomic":!0},t)}function SLe(){const[r,e]=E.useState("");return{announce:E.useCallback(i=>{i!=null&&e(i)},[]),announcement:r}}const C7=E.createContext(null);function xLe(r){const e=E.useContext(C7);E.useEffect(()=>{if(!e)throw new Error("useDndMonitor must be used within a children of <DndContext>");return e(r)},[r,e])}function bLe(){const[r]=E.useState(()=>new Set),e=E.useCallback(i=>(r.add(i),()=>r.delete(i)),[r]);return[E.useCallback(i=>{let{type:s,event:n}=i;r.forEach(a=>{var o;return(o=a[s])==null?void 0:o.call(a,n)})},[r]),e]}const wLe={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},TLe={onDragStart(r){let{active:e}=r;return"Picked up draggable item "+e.id+"."},onDragOver(r){let{active:e,over:t}=r;return t?"Draggable item "+e.id+" was moved over droppable area "+t.id+".":"Draggable item "+e.id+" is no longer over a droppable area."},onDragEnd(r){let{active:e,over:t}=r;return t?"Draggable item "+e.id+" was dropped over droppable area "+t.id:"Draggable item "+e.id+" was dropped."},onDragCancel(r){let{active:e}=r;return"Dragging was cancelled. Draggable item "+e.id+" was dropped."}};function ELe(r){let{announcements:e=TLe,container:t,hiddenTextDescribedById:i,screenReaderInstructions:s=wLe}=r;const{announce:n,announcement:a}=SLe(),o=jy("DndLiveRegion"),[l,c]=E.useState(!1);if(E.useEffect(()=>{c(!0)},[]),xLe(E.useMemo(()=>({onDragStart(h){let{active:d}=h;n(e.onDragStart({active:d}))},onDragMove(h){let{active:d,over:f}=h;e.onDragMove&&n(e.onDragMove({active:d,over:f}))},onDragOver(h){let{active:d,over:f}=h;n(e.onDragOver({active:d,over:f}))},onDragEnd(h){let{active:d,over:f}=h;n(e.onDragEnd({active:d,over:f}))},onDragCancel(h){let{active:d,over:f}=h;n(e.onDragCancel({active:d,over:f}))}}),[n,e])),!l)return null;const u=U.createElement(U.Fragment,null,U.createElement(vLe,{id:i,value:s.draggable}),U.createElement(yLe,{id:o,announcement:a}));return t?tn.createPortal(u,t):u}var Di;(function(r){r.DragStart="dragStart",r.DragMove="dragMove",r.DragEnd="dragEnd",r.DragCancel="dragCancel",r.DragOver="dragOver",r.RegisterDroppable="registerDroppable",r.SetDroppableDisabled="setDroppableDisabled",r.UnregisterDroppable="unregisterDroppable"})(Di||(Di={}));function Yb(){}function i4(r,e){return E.useMemo(()=>({sensor:r,options:e??{}}),[r,e])}function ALe(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return E.useMemo(()=>[...e].filter(i=>i!=null),[...e])}const Qn=Object.freeze({x:0,y:0});function P7(r,e){return Math.sqrt(Math.pow(r.x-e.x,2)+Math.pow(r.y-e.y,2))}function I7(r,e){let{data:{value:t}}=r,{data:{value:i}}=e;return t-i}function CLe(r,e){let{data:{value:t}}=r,{data:{value:i}}=e;return i-t}function r4(r){let{left:e,top:t,height:i,width:s}=r;return[{x:e,y:t},{x:e+s,y:t},{x:e,y:t+i},{x:e+s,y:t+i}]}function M7(r,e){if(!r||r.length===0)return null;const[t]=r;return t[e]}function s4(r,e,t){return e===void 0&&(e=r.left),t===void 0&&(t=r.top),{x:e+r.width*.5,y:t+r.height*.5}}const PLe=r=>{let{collisionRect:e,droppableRects:t,droppableContainers:i}=r;const s=s4(e,e.left,e.top),n=[];for(const a of i){const{id:o}=a,l=t.get(o);if(l){const c=P7(s4(l),s);n.push({id:o,data:{droppableContainer:a,value:c}})}}return n.sort(I7)},ILe=r=>{let{collisionRect:e,droppableRects:t,droppableContainers:i}=r;const s=r4(e),n=[];for(const a of i){const{id:o}=a,l=t.get(o);if(l){const c=r4(l),u=s.reduce((d,f,p)=>d+P7(c[p],f),0),h=Number((u/4).toFixed(4));n.push({id:o,data:{droppableContainer:a,value:h}})}}return n.sort(I7)};function MLe(r,e){const t=Math.max(e.top,r.top),i=Math.max(e.left,r.left),s=Math.min(e.left+e.width,r.left+r.width),n=Math.min(e.top+e.height,r.top+r.height),a=s-i,o=n-t;if(i<s&&t<n){const l=e.width*e.height,c=r.width*r.height,u=a*o,h=u/(l+c-u);return Number(h.toFixed(4))}return 0}const RLe=r=>{let{collisionRect:e,droppableRects:t,droppableContainers:i}=r;const s=[];for(const n of i){const{id:a}=n,o=t.get(a);if(o){const l=MLe(o,e);l>0&&s.push({id:a,data:{droppableContainer:n,value:l}})}}return s.sort(CLe)};function DLe(r,e,t){return{...r,scaleX:e&&t?e.width/t.width:1,scaleY:e&&t?e.height/t.height:1}}function R7(r,e){return r&&e?{x:r.left-e.left,y:r.top-e.top}:Qn}function LLe(r){return function(t){for(var i=arguments.length,s=new Array(i>1?i-1:0),n=1;n<i;n++)s[n-1]=arguments[n];return s.reduce((a,o)=>({...a,top:a.top+r*o.y,bottom:a.bottom+r*o.y,left:a.left+r*o.x,right:a.right+r*o.x}),{...t})}}const OLe=LLe(1);function NLe(r){if(r.startsWith("matrix3d(")){const e=r.slice(9,-1).split(/, /);return{x:+e[12],y:+e[13],scaleX:+e[0],scaleY:+e[5]}}else if(r.startsWith("matrix(")){const e=r.slice(7,-1).split(/, /);return{x:+e[4],y:+e[5],scaleX:+e[0],scaleY:+e[3]}}return null}function kLe(r,e,t){const i=NLe(e);if(!i)return r;const{scaleX:s,scaleY:n,x:a,y:o}=i,l=r.left-a-(1-s)*parseFloat(t),c=r.top-o-(1-n)*parseFloat(t.slice(t.indexOf(" ")+1)),u=s?r.width/s:r.width,h=n?r.height/n:r.height;return{width:u,height:h,top:c,right:l+u,bottom:c+h,left:l}}const FLe={ignoreTransform:!1};function _m(r,e){e===void 0&&(e=FLe);let t=r.getBoundingClientRect();if(e.ignoreTransform){const{transform:c,transformOrigin:u}=rs(r).getComputedStyle(r);c&&(t=kLe(t,c,u))}const{top:i,left:s,width:n,height:a,bottom:o,right:l}=t;return{top:i,left:s,width:n,height:a,bottom:o,right:l}}function n4(r){return _m(r,{ignoreTransform:!0})}function BLe(r){const e=r.innerWidth,t=r.innerHeight;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}function ULe(r,e){return e===void 0&&(e=rs(r).getComputedStyle(r)),e.position==="fixed"}function zLe(r,e){e===void 0&&(e=rs(r).getComputedStyle(r));const t=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(s=>{const n=e[s];return typeof n=="string"?t.test(n):!1})}function lA(r,e){const t=[];function i(s){if(e!=null&&t.length>=e||!s)return t;if(aN(s)&&s.scrollingElement!=null&&!t.includes(s.scrollingElement))return t.push(s.scrollingElement),t;if(!zy(s)||E7(s)||t.includes(s))return t;const n=rs(r).getComputedStyle(s);return s!==r&&zLe(s,n)&&t.push(s),ULe(s,n)?t:i(s.parentNode)}return r?i(r):t}function D7(r){const[e]=lA(r,1);return e??null}function hP(r){return!oA||!r?null:mm(r)?r:nN(r)?aN(r)||r===gm(r).scrollingElement?window:zy(r)?r:null:null}function L7(r){return mm(r)?r.scrollX:r.scrollLeft}function O7(r){return mm(r)?r.scrollY:r.scrollTop}function rR(r){return{x:L7(r),y:O7(r)}}var Yi;(function(r){r[r.Forward=1]="Forward",r[r.Backward=-1]="Backward"})(Yi||(Yi={}));function N7(r){return!oA||!r?!1:r===document.scrollingElement}function k7(r){const e={x:0,y:0},t=N7(r)?{height:window.innerHeight,width:window.innerWidth}:{height:r.clientHeight,width:r.clientWidth},i={x:r.scrollWidth-t.width,y:r.scrollHeight-t.height},s=r.scrollTop<=e.y,n=r.scrollLeft<=e.x,a=r.scrollTop>=i.y,o=r.scrollLeft>=i.x;return{isTop:s,isLeft:n,isBottom:a,isRight:o,maxScroll:i,minScroll:e}}const VLe={x:.2,y:.2};function jLe(r,e,t,i,s){let{top:n,left:a,right:o,bottom:l}=t;i===void 0&&(i=10),s===void 0&&(s=VLe);const{isTop:c,isBottom:u,isLeft:h,isRight:d}=k7(r),f={x:0,y:0},p={x:0,y:0},m={height:e.height*s.y,width:e.width*s.x};return!c&&n<=e.top+m.height?(f.y=Yi.Backward,p.y=i*Math.abs((e.top+m.height-n)/m.height)):!u&&l>=e.bottom-m.height&&(f.y=Yi.Forward,p.y=i*Math.abs((e.bottom-m.height-l)/m.height)),!d&&o>=e.right-m.width?(f.x=Yi.Forward,p.x=i*Math.abs((e.right-m.width-o)/m.width)):!h&&a<=e.left+m.width&&(f.x=Yi.Backward,p.x=i*Math.abs((e.left+m.width-a)/m.width)),{direction:f,speed:p}}function $Le(r){if(r===document.scrollingElement){const{innerWidth:n,innerHeight:a}=window;return{top:0,left:0,right:n,bottom:a,width:n,height:a}}const{top:e,left:t,right:i,bottom:s}=r.getBoundingClientRect();return{top:e,left:t,right:i,bottom:s,width:r.clientWidth,height:r.clientHeight}}function F7(r){return r.reduce((e,t)=>kf(e,rR(t)),Qn)}function HLe(r){return r.reduce((e,t)=>e+L7(t),0)}function GLe(r){return r.reduce((e,t)=>e+O7(t),0)}function WLe(r,e){if(e===void 0&&(e=_m),!r)return;const{top:t,left:i,bottom:s,right:n}=e(r);D7(r)&&(s<=0||n<=0||t>=window.innerHeight||i>=window.innerWidth)&&r.scrollIntoView({block:"center",inline:"center"})}const XLe=[["x",["left","right"],HLe],["y",["top","bottom"],GLe]];class cN{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const i=lA(t),s=F7(i);this.rect={...e},this.width=e.width,this.height=e.height;for(const[n,a,o]of XLe)for(const l of a)Object.defineProperty(this,l,{get:()=>{const c=o(i),u=s[n]-c;return this.rect[l]+u},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class l_{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(t=>{var i;return(i=this.target)==null?void 0:i.removeEventListener(...t)})},this.target=e}add(e,t,i){var s;(s=this.target)==null||s.addEventListener(e,t,i),this.listeners.push([e,t,i])}}function qLe(r){const{EventTarget:e}=rs(r);return r instanceof e?r:gm(r)}function dP(r,e){const t=Math.abs(r.x),i=Math.abs(r.y);return typeof e=="number"?Math.sqrt(t**2+i**2)>e:"x"in e&&"y"in e?t>e.x&&i>e.y:"x"in e?t>e.x:"y"in e?i>e.y:!1}var Ys;(function(r){r.Click="click",r.DragStart="dragstart",r.Keydown="keydown",r.ContextMenu="contextmenu",r.Resize="resize",r.SelectionChange="selectionchange",r.VisibilityChange="visibilitychange"})(Ys||(Ys={}));function a4(r){r.preventDefault()}function YLe(r){r.stopPropagation()}var He;(function(r){r.Space="Space",r.Down="ArrowDown",r.Right="ArrowRight",r.Left="ArrowLeft",r.Up="ArrowUp",r.Esc="Escape",r.Enter="Enter",r.Tab="Tab"})(He||(He={}));const B7={start:[He.Space,He.Enter],cancel:[He.Esc],end:[He.Space,He.Enter,He.Tab]},KLe=(r,e)=>{let{currentCoordinates:t}=e;switch(r.code){case He.Right:return{...t,x:t.x+25};case He.Left:return{...t,x:t.x-25};case He.Down:return{...t,y:t.y+25};case He.Up:return{...t,y:t.y-25}}};class uN{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:t}}=e;this.props=e,this.listeners=new l_(gm(t)),this.windowListeners=new l_(rs(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Ys.Resize,this.handleCancel),this.windowListeners.add(Ys.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Ys.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:t}=this.props,i=e.node.current;i&&WLe(i),t(Qn)}handleKeyDown(e){if(lN(e)){const{active:t,context:i,options:s}=this.props,{keyboardCodes:n=B7,coordinateGetter:a=KLe,scrollBehavior:o="smooth"}=s,{code:l}=e;if(n.end.includes(l)){this.handleEnd(e);return}if(n.cancel.includes(l)){this.handleCancel(e);return}const{collisionRect:c}=i.current,u=c?{x:c.left,y:c.top}:Qn;this.referenceCoordinates||(this.referenceCoordinates=u);const h=a(e,{active:t,context:i.current,currentCoordinates:u});if(h){const d=pv(h,u),f={x:0,y:0},{scrollableAncestors:p}=i.current;for(const m of p){const g=e.code,{isTop:_,isRight:v,isLeft:y,isBottom:x,maxScroll:S,minScroll:w}=k7(m),T=$Le(m),A={x:Math.min(g===He.Right?T.right-T.width/2:T.right,Math.max(g===He.Right?T.left:T.left+T.width/2,h.x)),y:Math.min(g===He.Down?T.bottom-T.height/2:T.bottom,Math.max(g===He.Down?T.top:T.top+T.height/2,h.y))},C=g===He.Right&&!v||g===He.Left&&!y,P=g===He.Down&&!x||g===He.Up&&!_;if(C&&A.x!==h.x){const I=m.scrollLeft+d.x,M=g===He.Right&&I<=S.x||g===He.Left&&I>=w.x;if(M&&!d.y){m.scrollTo({left:I,behavior:o});return}M?f.x=m.scrollLeft-I:f.x=g===He.Right?m.scrollLeft-S.x:m.scrollLeft-w.x,f.x&&m.scrollBy({left:-f.x,behavior:o});break}else if(P&&A.y!==h.y){const I=m.scrollTop+d.y,M=g===He.Down&&I<=S.y||g===He.Up&&I>=w.y;if(M&&!d.x){m.scrollTo({top:I,behavior:o});return}M?f.y=m.scrollTop-I:f.y=g===He.Down?m.scrollTop-S.y:m.scrollTop-w.y,f.y&&m.scrollBy({top:-f.y,behavior:o});break}}this.handleMove(e,kf(pv(h,this.referenceCoordinates),f))}}}handleMove(e,t){const{onMove:i}=this.props;e.preventDefault(),i(t)}handleEnd(e){const{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){const{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}uN.activators=[{eventName:"onKeyDown",handler:(r,e,t)=>{let{keyboardCodes:i=B7,onActivation:s}=e,{active:n}=t;const{code:a}=r.nativeEvent;if(i.start.includes(a)){const o=n.activatorNode.current;return o&&r.target!==o?!1:(r.preventDefault(),s==null||s({event:r.nativeEvent}),!0)}return!1}}];function o4(r){return!!(r&&"distance"in r)}function l4(r){return!!(r&&"delay"in r)}class hN{constructor(e,t,i){var s;i===void 0&&(i=qLe(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;const{event:n}=e,{target:a}=n;this.props=e,this.events=t,this.document=gm(a),this.documentListeners=new l_(this.document),this.listeners=new l_(i),this.windowListeners=new l_(rs(a)),this.initialCoordinates=(s=iR(n))!=null?s:Qn,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:i}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(Ys.Resize,this.handleCancel),this.windowListeners.add(Ys.DragStart,a4),this.windowListeners.add(Ys.VisibilityChange,this.handleCancel),this.windowListeners.add(Ys.ContextMenu,a4),this.documentListeners.add(Ys.Keydown,this.handleKeydown),t){if(i!=null&&i({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(l4(t)){this.timeoutId=setTimeout(this.handleStart,t.delay),this.handlePending(t);return}if(o4(t)){this.handlePending(t);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){const{active:i,onPending:s}=this.props;s(i,e,this.initialCoordinates,t)}handleStart(){const{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(Ys.Click,YLe,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Ys.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;const{activated:i,initialCoordinates:s,props:n}=this,{onMove:a,options:{activationConstraint:o}}=n;if(!s)return;const l=(t=iR(e))!=null?t:Qn,c=pv(s,l);if(!i&&o){if(o4(o)){if(o.tolerance!=null&&dP(c,o.tolerance))return this.handleCancel();if(dP(c,o.distance))return this.handleStart()}if(l4(o)&&dP(c,o.tolerance))return this.handleCancel();this.handlePending(o,c);return}e.cancelable&&e.preventDefault(),a(l)}handleEnd(){const{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){const{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===He.Esc&&this.handleCancel()}removeTextSelection(){var e;(e=this.document.getSelection())==null||e.removeAllRanges()}}const ZLe={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class dN extends hN{constructor(e){const{event:t}=e,i=gm(t.target);super(e,ZLe,i)}}dN.activators=[{eventName:"onPointerDown",handler:(r,e)=>{let{nativeEvent:t}=r,{onActivation:i}=e;return!t.isPrimary||t.button!==0?!1:(i==null||i({event:t}),!0)}}];const QLe={move:{name:"mousemove"},end:{name:"mouseup"}};var sR;(function(r){r[r.RightClick=2]="RightClick"})(sR||(sR={}));class JLe extends hN{constructor(e){super(e,QLe,gm(e.event.target))}}JLe.activators=[{eventName:"onMouseDown",handler:(r,e)=>{let{nativeEvent:t}=r,{onActivation:i}=e;return t.button===sR.RightClick?!1:(i==null||i({event:t}),!0)}}];const fP={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class eOe extends hN{constructor(e){super(e,fP)}static setup(){return window.addEventListener(fP.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(fP.move.name,e)};function e(){}}}eOe.activators=[{eventName:"onTouchStart",handler:(r,e)=>{let{nativeEvent:t}=r,{onActivation:i}=e;const{touches:s}=t;return s.length>1?!1:(i==null||i({event:t}),!0)}}];var c_;(function(r){r[r.Pointer=0]="Pointer",r[r.DraggableRect=1]="DraggableRect"})(c_||(c_={}));var Kb;(function(r){r[r.TreeOrder=0]="TreeOrder",r[r.ReversedTreeOrder=1]="ReversedTreeOrder"})(Kb||(Kb={}));function tOe(r){let{acceleration:e,activator:t=c_.Pointer,canScroll:i,draggingRect:s,enabled:n,interval:a=5,order:o=Kb.TreeOrder,pointerCoordinates:l,scrollableAncestors:c,scrollableAncestorRects:u,delta:h,threshold:d}=r;const f=rOe({delta:h,disabled:!n}),[p,m]=fLe(),g=E.useRef({x:0,y:0}),_=E.useRef({x:0,y:0}),v=E.useMemo(()=>{switch(t){case c_.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case c_.DraggableRect:return s}},[t,s,l]),y=E.useRef(null),x=E.useCallback(()=>{const w=y.current;if(!w)return;const T=g.current.x*_.current.x,A=g.current.y*_.current.y;w.scrollBy(T,A)},[]),S=E.useMemo(()=>o===Kb.TreeOrder?[...c].reverse():c,[o,c]);E.useEffect(()=>{if(!n||!c.length||!v){m();return}for(const w of S){if((i==null?void 0:i(w))===!1)continue;const T=c.indexOf(w),A=u[T];if(!A)continue;const{direction:C,speed:P}=jLe(w,A,v,e,d);for(const I of["x","y"])f[I][C[I]]||(P[I]=0,C[I]=0);if(P.x>0||P.y>0){m(),y.current=w,p(x,a),g.current=P,_.current=C;return}}g.current={x:0,y:0},_.current={x:0,y:0},m()},[e,x,i,m,n,a,JSON.stringify(v),JSON.stringify(f),p,c,S,u,JSON.stringify(d)])}const iOe={x:{[Yi.Backward]:!1,[Yi.Forward]:!1},y:{[Yi.Backward]:!1,[Yi.Forward]:!1}};function rOe(r){let{delta:e,disabled:t}=r;const i=tR(e);return Vy(s=>{if(t||!i||!s)return iOe;const n={x:Math.sign(e.x-i.x),y:Math.sign(e.y-i.y)};return{x:{[Yi.Backward]:s.x[Yi.Backward]||n.x===-1,[Yi.Forward]:s.x[Yi.Forward]||n.x===1},y:{[Yi.Backward]:s.y[Yi.Backward]||n.y===-1,[Yi.Forward]:s.y[Yi.Forward]||n.y===1}}},[t,e,i])}function sOe(r,e){const t=e!=null?r.get(e):void 0,i=t?t.node.current:null;return Vy(s=>{var n;return e==null?null:(n=i??s)!=null?n:null},[i,e])}function nOe(r,e){return E.useMemo(()=>r.reduce((t,i)=>{const{sensor:s}=i,n=s.activators.map(a=>({eventName:a.eventName,handler:e(a.handler,i)}));return[...t,...n]},[]),[r,e])}var gv;(function(r){r[r.Always=0]="Always",r[r.BeforeDragging=1]="BeforeDragging",r[r.WhileDragging=2]="WhileDragging"})(gv||(gv={}));var nR;(function(r){r.Optimized="optimized"})(nR||(nR={}));const c4=new Map;function aOe(r,e){let{dragging:t,dependencies:i,config:s}=e;const[n,a]=E.useState(null),{frequency:o,measure:l,strategy:c}=s,u=E.useRef(r),h=g(),d=fv(h),f=E.useCallback(function(_){_===void 0&&(_=[]),!d.current&&a(v=>v===null?_:v.concat(_.filter(y=>!v.includes(y))))},[d]),p=E.useRef(null),m=Vy(_=>{if(h&&!t)return c4;if(!_||_===c4||u.current!==r||n!=null){const v=new Map;for(let y of r){if(!y)continue;if(n&&n.length>0&&!n.includes(y.id)&&y.rect.current){v.set(y.id,y.rect.current);continue}const x=y.node.current,S=x?new cN(l(x),x):null;y.rect.current=S,S&&v.set(y.id,S)}return v}return _},[r,n,t,h,l]);return E.useEffect(()=>{u.current=r},[r]),E.useEffect(()=>{h||f()},[t,h]),E.useEffect(()=>{n&&n.length>0&&a(null)},[JSON.stringify(n)]),E.useEffect(()=>{h||typeof o!="number"||p.current!==null||(p.current=setTimeout(()=>{f(),p.current=null},o))},[o,h,f,...i]),{droppableRects:m,measureDroppableContainers:f,measuringScheduled:n!=null};function g(){switch(c){case gv.Always:return!1;case gv.BeforeDragging:return t;default:return!t}}}function U7(r,e){return Vy(t=>r?t||(typeof e=="function"?e(r):r):null,[e,r])}function oOe(r,e){return U7(r,e)}function lOe(r){let{callback:e,disabled:t}=r;const i=oN(e),s=E.useMemo(()=>{if(t||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:n}=window;return new n(i)},[i,t]);return E.useEffect(()=>()=>s==null?void 0:s.disconnect(),[s]),s}function cA(r){let{callback:e,disabled:t}=r;const i=oN(e),s=E.useMemo(()=>{if(t||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:n}=window;return new n(i)},[t]);return E.useEffect(()=>()=>s==null?void 0:s.disconnect(),[s]),s}function cOe(r){return new cN(_m(r),r)}function u4(r,e,t){e===void 0&&(e=cOe);const[i,s]=E.useState(null);function n(){s(l=>{if(!r)return null;if(r.isConnected===!1){var c;return(c=l??t)!=null?c:null}const u=e(r);return JSON.stringify(l)===JSON.stringify(u)?l:u})}const a=lOe({callback(l){if(r)for(const c of l){const{type:u,target:h}=c;if(u==="childList"&&h instanceof HTMLElement&&h.contains(r)){n();break}}}}),o=cA({callback:n});return ja(()=>{n(),r?(o==null||o.observe(r),a==null||a.observe(document.body,{childList:!0,subtree:!0})):(o==null||o.disconnect(),a==null||a.disconnect())},[r]),i}function uOe(r){const e=U7(r);return R7(r,e)}const h4=[];function hOe(r){const e=E.useRef(r),t=Vy(i=>r?i&&i!==h4&&r&&e.current&&r.parentNode===e.current.parentNode?i:lA(r):h4,[r]);return E.useEffect(()=>{e.current=r},[r]),t}function dOe(r){const[e,t]=E.useState(null),i=E.useRef(r),s=E.useCallback(n=>{const a=hP(n.target);a&&t(o=>o?(o.set(a,rR(a)),new Map(o)):null)},[]);return E.useEffect(()=>{const n=i.current;if(r!==n){a(n);const o=r.map(l=>{const c=hP(l);return c?(c.addEventListener("scroll",s,{passive:!0}),[c,rR(c)]):null}).filter(l=>l!=null);t(o.length?new Map(o):null),i.current=r}return()=>{a(r),a(n)};function a(o){o.forEach(l=>{const c=hP(l);c==null||c.removeEventListener("scroll",s)})}},[s,r]),E.useMemo(()=>r.length?e?Array.from(e.values()).reduce((n,a)=>kf(n,a),Qn):F7(r):Qn,[r,e])}function d4(r,e){e===void 0&&(e=[]);const t=E.useRef(null);return E.useEffect(()=>{t.current=null},e),E.useEffect(()=>{const i=r!==Qn;i&&!t.current&&(t.current=r),!i&&t.current&&(t.current=null)},[r]),t.current?pv(r,t.current):Qn}function fOe(r){E.useEffect(()=>{if(!oA)return;const e=r.map(t=>{let{sensor:i}=t;return i.setup==null?void 0:i.setup()});return()=>{for(const t of e)t==null||t()}},r.map(e=>{let{sensor:t}=e;return t}))}function pOe(r,e){return E.useMemo(()=>r.reduce((t,i)=>{let{eventName:s,handler:n}=i;return t[s]=a=>{n(a,e)},t},{}),[r,e])}function z7(r){return E.useMemo(()=>r?BLe(r):null,[r])}const f4=[];function mOe(r,e){e===void 0&&(e=_m);const[t]=r,i=z7(t?rs(t):null),[s,n]=E.useState(f4);function a(){n(()=>r.length?r.map(l=>N7(l)?i:new cN(e(l),l)):f4)}const o=cA({callback:a});return ja(()=>{o==null||o.disconnect(),a(),r.forEach(l=>o==null?void 0:o.observe(l))},[r]),s}function gOe(r){if(!r)return null;if(r.children.length>1)return r;const e=r.children[0];return zy(e)?e:r}function _Oe(r){let{measure:e}=r;const[t,i]=E.useState(null),s=E.useCallback(c=>{for(const{target:u}of c)if(zy(u)){i(h=>{const d=e(u);return h?{...h,width:d.width,height:d.height}:d});break}},[e]),n=cA({callback:s}),a=E.useCallback(c=>{const u=gOe(c);n==null||n.disconnect(),u&&(n==null||n.observe(u)),i(u?e(u):null)},[e,n]),[o,l]=qb(a);return E.useMemo(()=>({nodeRef:o,rect:t,setRef:l}),[t,o,l])}const vOe=[{sensor:dN,options:{}},{sensor:uN,options:{}}],yOe={current:{}},_x={draggable:{measure:n4},droppable:{measure:n4,strategy:gv.WhileDragging,frequency:nR.Optimized},dragOverlay:{measure:_m}};class u_ extends Map{get(e){var t;return e!=null&&(t=super.get(e))!=null?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,i;return(t=(i=this.get(e))==null?void 0:i.node.current)!=null?t:void 0}}const SOe={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new u_,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Yb},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:_x,measureDroppableContainers:Yb,windowRect:null,measuringScheduled:!1},xOe={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Yb,draggableNodes:new Map,over:null,measureDroppableContainers:Yb},uA=E.createContext(xOe),V7=E.createContext(SOe);function bOe(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new u_}}}function wOe(r,e){switch(e.type){case Di.DragStart:return{...r,draggable:{...r.draggable,initialCoordinates:e.initialCoordinates,active:e.active}};case Di.DragMove:return r.draggable.active==null?r:{...r,draggable:{...r.draggable,translate:{x:e.coordinates.x-r.draggable.initialCoordinates.x,y:e.coordinates.y-r.draggable.initialCoordinates.y}}};case Di.DragEnd:case Di.DragCancel:return{...r,draggable:{...r.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Di.RegisterDroppable:{const{element:t}=e,{id:i}=t,s=new u_(r.droppable.containers);return s.set(i,t),{...r,droppable:{...r.droppable,containers:s}}}case Di.SetDroppableDisabled:{const{id:t,key:i,disabled:s}=e,n=r.droppable.containers.get(t);if(!n||i!==n.key)return r;const a=new u_(r.droppable.containers);return a.set(t,{...n,disabled:s}),{...r,droppable:{...r.droppable,containers:a}}}case Di.UnregisterDroppable:{const{id:t,key:i}=e,s=r.droppable.containers.get(t);if(!s||i!==s.key)return r;const n=new u_(r.droppable.containers);return n.delete(t),{...r,droppable:{...r.droppable,containers:n}}}default:return r}}function TOe(r){let{disabled:e}=r;const{active:t,activatorEvent:i,draggableNodes:s}=E.useContext(uA),n=tR(i),a=tR(t==null?void 0:t.id);return E.useEffect(()=>{if(!e&&!i&&n&&a!=null){if(!lN(n)||document.activeElement===n.target)return;const o=s.get(a);if(!o)return;const{activatorNode:l,node:c}=o;if(!l.current&&!c.current)return;requestAnimationFrame(()=>{for(const u of[l.current,c.current]){if(!u)continue;const h=gLe(u);if(h){h.focus();break}}})}},[i,e,s,a,n]),null}function EOe(r,e){let{transform:t,...i}=e;return r!=null&&r.length?r.reduce((s,n)=>n({transform:s,...i}),t):t}function AOe(r){return E.useMemo(()=>({draggable:{..._x.draggable,...r==null?void 0:r.draggable},droppable:{..._x.droppable,...r==null?void 0:r.droppable},dragOverlay:{..._x.dragOverlay,...r==null?void 0:r.dragOverlay}}),[r==null?void 0:r.draggable,r==null?void 0:r.droppable,r==null?void 0:r.dragOverlay])}function COe(r){let{activeNode:e,measure:t,initialRect:i,config:s=!0}=r;const n=E.useRef(!1),{x:a,y:o}=typeof s=="boolean"?{x:s,y:s}:s;ja(()=>{if(!a&&!o||!e){n.current=!1;return}if(n.current||!i)return;const c=e==null?void 0:e.node.current;if(!c||c.isConnected===!1)return;const u=t(c),h=R7(u,i);if(a||(h.x=0),o||(h.y=0),n.current=!0,Math.abs(h.x)>0||Math.abs(h.y)>0){const d=D7(c);d&&d.scrollBy({top:h.y,left:h.x})}},[e,a,o,i,t])}const j7=E.createContext({...Qn,scaleX:1,scaleY:1});var Rl;(function(r){r[r.Uninitialized=0]="Uninitialized",r[r.Initializing=1]="Initializing",r[r.Initialized=2]="Initialized"})(Rl||(Rl={}));const POe=E.memo(function(e){var t,i,s,n;let{id:a,accessibility:o,autoScroll:l=!0,children:c,sensors:u=vOe,collisionDetection:h=RLe,measuring:d,modifiers:f,...p}=e;const m=E.useReducer(wOe,void 0,bOe),[g,_]=m,[v,y]=bLe(),[x,S]=E.useState(Rl.Uninitialized),w=x===Rl.Initialized,{draggable:{active:T,nodes:A,translate:C},droppable:{containers:P}}=g,I=T!=null?A.get(T):null,M=E.useRef({initial:null,translated:null}),N=E.useMemo(()=>{var yi;return T!=null?{id:T,data:(yi=I==null?void 0:I.data)!=null?yi:yOe,rect:M}:null},[T,I]),k=E.useRef(null),[V,B]=E.useState(null),[R,L]=E.useState(null),D=fv(p,Object.values(p)),F=jy("DndDescribedBy",a),j=E.useMemo(()=>P.getEnabled(),[P]),z=AOe(d),{droppableRects:$,measureDroppableContainers:H,measuringScheduled:G}=aOe(j,{dragging:w,dependencies:[C.x,C.y],config:z.droppable}),Y=sOe(A,T),W=E.useMemo(()=>R?iR(R):null,[R]),ie=a1(),q=oOe(Y,z.draggable.measure);COe({activeNode:T!=null?A.get(T):null,config:ie.layoutShiftCompensation,initialRect:q,measure:z.draggable.measure});const K=u4(Y,z.draggable.measure,q),te=u4(Y?Y.parentElement:null),X=E.useRef({activatorEvent:null,active:null,activeNode:Y,collisionRect:null,collisions:null,droppableRects:$,draggableNodes:A,draggingNode:null,draggingNodeRect:null,droppableContainers:P,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),_e=P.getNodeFor((t=X.current.over)==null?void 0:t.id),pe=_Oe({measure:z.dragOverlay.measure}),ze=(i=pe.nodeRef.current)!=null?i:Y,Fe=w?(s=pe.rect)!=null?s:K:null,vt=!!(pe.nodeRef.current&&pe.rect),ne=uOe(vt?null:K),vi=z7(ze?rs(ze):null),pi=hOe(w?_e??Y:null),ni=mOe(pi),Ci=EOe(f,{transform:{x:C.x-ne.x,y:C.y-ne.y,scaleX:1,scaleY:1},activatorEvent:R,active:N,activeNodeRect:K,containerNodeRect:te,draggingNodeRect:Fe,over:X.current.over,overlayNodeRect:pe.rect,scrollableAncestors:pi,scrollableAncestorRects:ni,windowRect:vi}),er=W?kf(W,C):null,lr=dOe(pi),Cr=d4(lr),Ae=d4(lr,[K]),$i=kf(Ci,Cr),ns=Fe?OLe(Fe,Ci):null,mn=N&&ns?h({active:N,collisionRect:ns,droppableRects:$,droppableContainers:j,pointerCoordinates:er}):null,Ja=M7(mn,"id"),[as,hl]=E.useState(null),Mm=vt?Ci:kf(Ci,Ae),dl=DLe(Mm,(n=as==null?void 0:as.rect)!=null?n:null,K),Hh=E.useRef(null),eo=E.useCallback((yi,ai)=>{let{sensor:Pr,options:ve}=ai;if(k.current==null)return;const Le=A.get(k.current);if(!Le)return;const Be=yi.nativeEvent,oi=new Pr({active:k.current,activeNode:Le,event:Be,options:ve,context:X,onAbort(Tt){if(!A.get(Tt))return;const{onDragAbort:li}=D.current,Gi={id:Tt};li==null||li(Gi),v({type:"onDragAbort",event:Gi})},onPending(Tt,cr,li,Gi){if(!A.get(Tt))return;const{onDragPending:Dm}=D.current,fl={id:Tt,constraint:cr,initialCoordinates:li,offset:Gi};Dm==null||Dm(fl),v({type:"onDragPending",event:fl})},onStart(Tt){const cr=k.current;if(cr==null)return;const li=A.get(cr);if(!li)return;const{onDragStart:Gi}=D.current,Rm={activatorEvent:Be,active:{id:cr,data:li.data,rect:M}};tn.unstable_batchedUpdates(()=>{Gi==null||Gi(Rm),S(Rl.Initializing),_({type:Di.DragStart,initialCoordinates:Tt,active:cr}),v({type:"onDragStart",event:Rm}),B(Hh.current),L(Be)})},onMove(Tt){_({type:Di.DragMove,coordinates:Tt})},onEnd:Hi(Di.DragEnd),onCancel:Hi(Di.DragCancel)});Hh.current=oi;function Hi(Tt){return async function(){const{active:li,collisions:Gi,over:Rm,scrollAdjustedTranslate:Dm}=X.current;let fl=null;if(li&&Dm){const{cancelDrop:Lm}=D.current;fl={activatorEvent:Be,active:li,collisions:Gi,delta:Dm,over:Rm},Tt===Di.DragEnd&&typeof Lm=="function"&&await Promise.resolve(Lm(fl))&&(Tt=Di.DragCancel)}k.current=null,tn.unstable_batchedUpdates(()=>{_({type:Tt}),S(Rl.Uninitialized),hl(null),B(null),L(null),Hh.current=null;const Lm=Tt===Di.DragEnd?"onDragEnd":"onDragCancel";if(fl){const o1=D.current[Lm];o1==null||o1(fl),v({type:Lm,event:fl})}})}}},[A]),n1=E.useCallback((yi,ai)=>(Pr,ve)=>{const Le=Pr.nativeEvent,Be=A.get(ve);if(k.current!==null||!Be||Le.dndKit||Le.defaultPrevented)return;const oi={active:Be};yi(Pr,ai.options,oi)===!0&&(Le.dndKit={capturedBy:ai.sensor},k.current=ve,eo(Pr,ai))},[A,eo]),Qy=nOe(u,n1);fOe(u),ja(()=>{K&&x===Rl.Initializing&&S(Rl.Initialized)},[K,x]),E.useEffect(()=>{const{onDragMove:yi}=D.current,{active:ai,activatorEvent:Pr,collisions:ve,over:Le}=X.current;if(!ai||!Pr)return;const Be={active:ai,activatorEvent:Pr,collisions:ve,delta:{x:$i.x,y:$i.y},over:Le};tn.unstable_batchedUpdates(()=>{yi==null||yi(Be),v({type:"onDragMove",event:Be})})},[$i.x,$i.y]),E.useEffect(()=>{const{active:yi,activatorEvent:ai,collisions:Pr,droppableContainers:ve,scrollAdjustedTranslate:Le}=X.current;if(!yi||k.current==null||!ai||!Le)return;const{onDragOver:Be}=D.current,oi=ve.get(Ja),Hi=oi&&oi.rect.current?{id:oi.id,rect:oi.rect.current,data:oi.data,disabled:oi.disabled}:null,Tt={active:yi,activatorEvent:ai,collisions:Pr,delta:{x:Le.x,y:Le.y},over:Hi};tn.unstable_batchedUpdates(()=>{hl(Hi),Be==null||Be(Tt),v({type:"onDragOver",event:Tt})})},[Ja]),ja(()=>{X.current={activatorEvent:R,active:N,activeNode:Y,collisionRect:ns,collisions:mn,droppableRects:$,draggableNodes:A,draggingNode:ze,draggingNodeRect:Fe,droppableContainers:P,over:as,scrollableAncestors:pi,scrollAdjustedTranslate:$i},M.current={initial:Fe,translated:ns}},[N,Y,mn,ns,A,ze,Fe,$,P,as,pi,$i]),tOe({...ie,delta:C,draggingRect:ns,pointerCoordinates:er,scrollableAncestors:pi,scrollableAncestorRects:ni});const Jy=E.useMemo(()=>({active:N,activeNode:Y,activeNodeRect:K,activatorEvent:R,collisions:mn,containerNodeRect:te,dragOverlay:pe,draggableNodes:A,droppableContainers:P,droppableRects:$,over:as,measureDroppableContainers:H,scrollableAncestors:pi,scrollableAncestorRects:ni,measuringConfiguration:z,measuringScheduled:G,windowRect:vi}),[N,Y,K,R,mn,te,pe,A,P,$,as,H,pi,ni,z,G,vi]),e0=E.useMemo(()=>({activatorEvent:R,activators:Qy,active:N,activeNodeRect:K,ariaDescribedById:{draggable:F},dispatch:_,draggableNodes:A,over:as,measureDroppableContainers:H}),[R,Qy,N,K,_,F,A,as,H]);return U.createElement(C7.Provider,{value:y},U.createElement(uA.Provider,{value:e0},U.createElement(V7.Provider,{value:Jy},U.createElement(j7.Provider,{value:dl},c)),U.createElement(TOe,{disabled:(o==null?void 0:o.restoreFocus)===!1})),U.createElement(ELe,{...o,hiddenTextDescribedById:F}));function a1(){const yi=(V==null?void 0:V.autoScrollEnabled)===!1,ai=typeof l=="object"?l.enabled===!1:l===!1,Pr=w&&!yi&&!ai;return typeof l=="object"?{...l,enabled:Pr}:{enabled:Pr}}}),IOe=E.createContext(null),p4="button",MOe="Draggable";function ROe(r){let{id:e,data:t,disabled:i=!1,attributes:s}=r;const n=jy(MOe),{activators:a,activatorEvent:o,active:l,activeNodeRect:c,ariaDescribedById:u,draggableNodes:h,over:d}=E.useContext(uA),{role:f=p4,roleDescription:p="draggable",tabIndex:m=0}=s??{},g=(l==null?void 0:l.id)===e,_=E.useContext(g?j7:IOe),[v,y]=qb(),[x,S]=qb(),w=pOe(a,e),T=fv(t);ja(()=>(h.set(e,{id:e,key:n,node:v,activatorNode:x,data:T}),()=>{const C=h.get(e);C&&C.key===n&&h.delete(e)}),[h,e]);const A=E.useMemo(()=>({role:f,tabIndex:m,"aria-disabled":i,"aria-pressed":g&&f===p4?!0:void 0,"aria-roledescription":p,"aria-describedby":u.draggable}),[i,f,m,g,p,u.draggable]);return{active:l,activatorEvent:o,activeNodeRect:c,attributes:A,isDragging:g,listeners:i?void 0:w,node:v,over:d,setNodeRef:y,setActivatorNodeRef:S,transform:_}}function DOe(){return E.useContext(V7)}const LOe="Droppable",OOe={timeout:25};function NOe(r){let{data:e,disabled:t=!1,id:i,resizeObserverConfig:s}=r;const n=jy(LOe),{active:a,dispatch:o,over:l,measureDroppableContainers:c}=E.useContext(uA),u=E.useRef({disabled:t}),h=E.useRef(!1),d=E.useRef(null),f=E.useRef(null),{disabled:p,updateMeasurementsFor:m,timeout:g}={...OOe,...s},_=fv(m??i),v=E.useCallback(()=>{if(!h.current){h.current=!0;return}f.current!=null&&clearTimeout(f.current),f.current=setTimeout(()=>{c(Array.isArray(_.current)?_.current:[_.current]),f.current=null},g)},[g]),y=cA({callback:v,disabled:p||!a}),x=E.useCallback((A,C)=>{y&&(C&&(y.unobserve(C),h.current=!1),A&&y.observe(A))},[y]),[S,w]=qb(x),T=fv(e);return E.useEffect(()=>{!y||!S.current||(y.disconnect(),h.current=!1,y.observe(S.current))},[S,y]),E.useEffect(()=>(o({type:Di.RegisterDroppable,element:{id:i,key:n,disabled:t,node:S,rect:d,data:T}}),()=>o({type:Di.UnregisterDroppable,key:n,id:i})),[i]),E.useEffect(()=>{t!==u.current.disabled&&(o({type:Di.SetDroppableDisabled,id:i,key:n,disabled:t}),u.current.disabled=t)},[i,n,t,o]),{active:a,rect:d,isOver:(l==null?void 0:l.id)===i,node:S,over:l,setNodeRef:w}}function fN(r,e,t){const i=r.slice();return i.splice(t<0?i.length+t:t,0,i.splice(e,1)[0]),i}function kOe(r,e){return r.reduce((t,i,s)=>{const n=e.get(i);return n&&(t[s]=n),t},Array(r.length))}function wS(r){return r!==null&&r>=0}function FOe(r,e){if(r===e)return!0;if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function BOe(r){return typeof r=="boolean"?{draggable:r,droppable:r}:r}const $7=r=>{let{rects:e,activeIndex:t,overIndex:i,index:s}=r;const n=fN(e,i,t),a=e[s],o=n[s];return!o||!a?null:{x:o.left-a.left,y:o.top-a.top,scaleX:o.width/a.width,scaleY:o.height/a.height}},TS={scaleX:1,scaleY:1},UOe=r=>{var e;let{activeIndex:t,activeNodeRect:i,index:s,rects:n,overIndex:a}=r;const o=(e=n[t])!=null?e:i;if(!o)return null;if(s===t){const c=n[a];return c?{x:0,y:t<a?c.top+c.height-(o.top+o.height):c.top-o.top,...TS}:null}const l=zOe(n,s,t);return s>t&&s<=a?{x:0,y:-o.height-l,...TS}:s<t&&s>=a?{x:0,y:o.height+l,...TS}:{x:0,y:0,...TS}};function zOe(r,e,t){const i=r[e],s=r[e-1],n=r[e+1];return i?t<e?s?i.top-(s.top+s.height):n?n.top-(i.top+i.height):0:n?n.top-(i.top+i.height):s?i.top-(s.top+s.height):0:0}const H7="Sortable",G7=U.createContext({activeIndex:-1,containerId:H7,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:$7,disabled:{draggable:!1,droppable:!1}});function VOe(r){let{children:e,id:t,items:i,strategy:s=$7,disabled:n=!1}=r;const{active:a,dragOverlay:o,droppableRects:l,over:c,measureDroppableContainers:u}=DOe(),h=jy(H7,t),d=o.rect!==null,f=E.useMemo(()=>i.map(w=>typeof w=="object"&&"id"in w?w.id:w),[i]),p=a!=null,m=a?f.indexOf(a.id):-1,g=c?f.indexOf(c.id):-1,_=E.useRef(f),v=!FOe(f,_.current),y=g!==-1&&m===-1||v,x=BOe(n);ja(()=>{v&&p&&u(f)},[v,f,p,u]),E.useEffect(()=>{_.current=f},[f]);const S=E.useMemo(()=>({activeIndex:m,containerId:h,disabled:x,disableTransforms:y,items:f,overIndex:g,useDragOverlay:d,sortedRects:kOe(f,l),strategy:s}),[m,h,x.draggable,x.droppable,y,f,g,l,d,s]);return U.createElement(G7.Provider,{value:S},e)}const jOe=r=>{let{id:e,items:t,activeIndex:i,overIndex:s}=r;return fN(t,i,s).indexOf(e)},$Oe=r=>{let{containerId:e,isSorting:t,wasDragging:i,index:s,items:n,newIndex:a,previousItems:o,previousContainerId:l,transition:c}=r;return!c||!i||o!==n&&s===a?!1:t?!0:a!==s&&e===l},HOe={duration:200,easing:"ease"},W7="transform",GOe=mv.Transition.toString({property:W7,duration:0,easing:"linear"}),WOe={roleDescription:"sortable"};function XOe(r){let{disabled:e,index:t,node:i,rect:s}=r;const[n,a]=E.useState(null),o=E.useRef(t);return ja(()=>{if(!e&&t!==o.current&&i.current){const l=s.current;if(l){const c=_m(i.current,{ignoreTransform:!0}),u={x:l.left-c.left,y:l.top-c.top,scaleX:l.width/c.width,scaleY:l.height/c.height};(u.x||u.y)&&a(u)}}t!==o.current&&(o.current=t)},[e,t,i,s]),E.useEffect(()=>{n&&a(null)},[n]),n}function qOe(r){let{animateLayoutChanges:e=$Oe,attributes:t,disabled:i,data:s,getNewIndex:n=jOe,id:a,strategy:o,resizeObserverConfig:l,transition:c=HOe}=r;const{items:u,containerId:h,activeIndex:d,disabled:f,disableTransforms:p,sortedRects:m,overIndex:g,useDragOverlay:_,strategy:v}=E.useContext(G7),y=YOe(i,f),x=u.indexOf(a),S=E.useMemo(()=>({sortable:{containerId:h,index:x,items:u},...s}),[h,s,x,u]),w=E.useMemo(()=>u.slice(u.indexOf(a)),[u,a]),{rect:T,node:A,isOver:C,setNodeRef:P}=NOe({id:a,data:S,disabled:y.droppable,resizeObserverConfig:{updateMeasurementsFor:w,...l}}),{active:I,activatorEvent:M,activeNodeRect:N,attributes:k,setNodeRef:V,listeners:B,isDragging:R,over:L,setActivatorNodeRef:D,transform:F}=ROe({id:a,data:S,attributes:{...WOe,...t},disabled:y.draggable}),j=dLe(P,V),z=!!I,$=z&&!p&&wS(d)&&wS(g),H=!_&&R,G=H&&$?F:null,W=$?G??(o??v)({rects:m,activeNodeRect:N,activeIndex:d,overIndex:g,index:x}):null,ie=wS(d)&&wS(g)?n({id:a,items:u,activeIndex:d,overIndex:g}):x,q=I==null?void 0:I.id,K=E.useRef({activeId:q,items:u,newIndex:ie,containerId:h}),te=u!==K.current.items,X=e({active:I,containerId:h,isDragging:R,isSorting:z,id:a,index:x,items:u,newIndex:K.current.newIndex,previousItems:K.current.items,previousContainerId:K.current.containerId,transition:c,wasDragging:K.current.activeId!=null}),_e=XOe({disabled:!X,index:x,node:A,rect:T});return E.useEffect(()=>{z&&K.current.newIndex!==ie&&(K.current.newIndex=ie),h!==K.current.containerId&&(K.current.containerId=h),u!==K.current.items&&(K.current.items=u)},[z,ie,h,u]),E.useEffect(()=>{if(q===K.current.activeId)return;if(q!=null&&K.current.activeId==null){K.current.activeId=q;return}const ze=setTimeout(()=>{K.current.activeId=q},50);return()=>clearTimeout(ze)},[q]),{active:I,activeIndex:d,attributes:k,data:S,rect:T,index:x,newIndex:ie,items:u,isOver:C,isSorting:z,isDragging:R,listeners:B,node:A,overIndex:g,over:L,setNodeRef:j,setActivatorNodeRef:D,setDroppableNodeRef:P,setDraggableNodeRef:V,transform:_e??W,transition:pe()};function pe(){if(_e||te&&K.current.newIndex===x)return GOe;if(!(H&&!lN(M)||!c)&&(z||X))return mv.Transition.toString({...c,property:W7})}}function YOe(r,e){var t,i;return typeof r=="boolean"?{draggable:r,droppable:!1}:{draggable:(t=r==null?void 0:r.draggable)!=null?t:e.draggable,droppable:(i=r==null?void 0:r.droppable)!=null?i:e.droppable}}function Zb(r){if(!r)return!1;const e=r.data.current;return!!(e&&"sortable"in e&&typeof e.sortable=="object"&&"containerId"in e.sortable&&"items"in e.sortable&&"index"in e.sortable)}const KOe=[He.Down,He.Right,He.Up,He.Left],ZOe=(r,e)=>{let{context:{active:t,collisionRect:i,droppableRects:s,droppableContainers:n,over:a,scrollableAncestors:o}}=e;if(KOe.includes(r.code)){if(r.preventDefault(),!t||!i)return;const l=[];n.getEnabled().forEach(h=>{if(!h||h!=null&&h.disabled)return;const d=s.get(h.id);if(d)switch(r.code){case He.Down:i.top<d.top&&l.push(h);break;case He.Up:i.top>d.top&&l.push(h);break;case He.Left:i.left>d.left&&l.push(h);break;case He.Right:i.left<d.left&&l.push(h);break}});const c=ILe({collisionRect:i,droppableRects:s,droppableContainers:l});let u=M7(c,"id");if(u===(a==null?void 0:a.id)&&c.length>1&&(u=c[1].id),u!=null){const h=n.get(t.id),d=n.get(u),f=d?s.get(d.id):null,p=d==null?void 0:d.node.current;if(p&&f&&h&&d){const g=lA(p).some((w,T)=>o[T]!==w),_=X7(h,d),v=QOe(h,d),y=g||!_?{x:0,y:0}:{x:v?i.width-f.width:0,y:v?i.height-f.height:0},x={x:f.left,y:f.top};return y.x&&y.y?x:pv(x,y)}}}};function X7(r,e){return!Zb(r)||!Zb(e)?!1:r.data.current.sortable.containerId===e.data.current.sortable.containerId}function QOe(r,e){return!Zb(r)||!Zb(e)||!X7(r,e)?!1:r.data.current.sortable.index<e.data.current.sortable.index}const JOe=({item:r,onEdit:e,onDelete:t})=>{const{toast:i}=Ar(),{attributes:s,listeners:n,setNodeRef:a,transform:o,transition:l,isDragging:c}=qOe({id:r.id}),u={transform:mv.Transform.toString(o),transition:l},h=async p=>{if(confirm("Are you sure you want to delete this menu item?"))try{const{error:m}=await nt.from("menu_items").delete().eq("id",p);if(m)throw m;i({title:"Success",description:"Menu item deleted successfully"}),t()}catch(m){i({title:"Error",description:m.message,variant:"destructive"})}},d=async(p,m)=>{try{const{error:g}=await nt.from("menu_items").update({is_active:!m}).eq("id",p);if(g)throw g;i({title:"Success",description:`Menu item ${m?"deactivated":"activated"}`}),t()}catch(g){i({title:"Error",description:g.message,variant:"destructive"})}},f=p=>{const m=[];return p.is_vegetarian&&m.push("Vegetarian"),p.is_vegan&&m.push("Vegan"),p.is_gluten_free&&m.push("Gluten-Free"),p.is_nut_free&&m.push("Nut-Free"),m};return b.jsx(Vt,{ref:a,style:u,className:`${r.is_active?"":"opacity-60"} ${c?"shadow-lg ring-2 ring-blue-500 ring-opacity-50":""} transition-all duration-200`,children:b.jsx(jt,{className:"p-4",children:b.jsxs("div",{className:"flex justify-between items-start",children:[b.jsxs("div",{className:"flex items-center gap-3 flex-1 cursor-grab active:cursor-grabbing",...s,...n,children:[b.jsx(mse,{className:"w-5 h-5 text-gray-400 hover:text-gray-600 flex-shrink-0"}),b.jsxs("div",{className:"flex-1 min-w-0",children:[b.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[b.jsx("h3",{className:"text-lg font-semibold truncate",children:r.title}),b.jsx(Eo,{variant:"outline",children:r.category}),!r.is_active&&b.jsx(Eo,{variant:"secondary",children:"Inactive"}),b.jsxs(Eo,{variant:"outline",className:"text-xs",children:["#",r.sort_order]})]}),r.description&&b.jsx("p",{className:"text-gray-600 mb-2 line-clamp-2",children:r.description}),b.jsxs("div",{className:"flex items-center gap-4 mb-2 flex-wrap",children:[b.jsxs("span",{className:"text-xl font-bold text-green-600",children:["$",r.price.toFixed(2)]}),f(r).map(p=>b.jsx(Eo,{variant:"secondary",className:"text-xs",children:p},p))]}),r.allergens.length>0&&b.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[b.jsx("span",{className:"font-medium",children:"Allergens: "}),r.allergens.join(", ")]}),b.jsxs("div",{className:"flex gap-2",children:[r.image_url&&b.jsx(Eo,{variant:"outline",className:"text-xs",children:"📷 Image"}),r.model_url&&b.jsx(Eo,{variant:"outline",className:"text-xs",children:"🎯 3D Model"})]})]})]}),b.jsxs("div",{className:"flex gap-2 ml-4 flex-shrink-0",children:[b.jsx(tt,{onClick:()=>d(r.id,r.is_active),variant:"outline",size:"sm",children:r.is_active?b.jsx(fse,{className:"w-4 h-4"}):b.jsx(bf,{className:"w-4 h-4"})}),b.jsx(tt,{onClick:()=>e(r),variant:"outline",size:"sm",children:b.jsx(wse,{className:"w-4 h-4"})}),b.jsx(tt,{onClick:()=>h(r.id),variant:"outline",size:"sm",className:"text-red-600 hover:text-red-800",children:b.jsx(Ese,{className:"w-4 h-4"})})]})]})})})},e3e=({menuItems:r,onEdit:e,onDelete:t,onReorder:i})=>{const{toast:s}=Ar(),n=ALe(i4(dN,{activationConstraint:{distance:8}}),i4(uN,{coordinateGetter:ZOe})),a=async o=>{const{active:l,over:c}=o;if(l.id!==(c==null?void 0:c.id)){const u=r.findIndex(p=>p.id===l.id),h=r.findIndex(p=>p.id===(c==null?void 0:c.id)),f=fN(r,u,h).map((p,m)=>({...p,sort_order:m+1}));i(f);try{const p=f.map((m,g)=>({id:m.id,sort_order:g+1}));for(const m of p){const{error:g}=await nt.from("menu_items").update({sort_order:m.sort_order}).eq("id",m.id);if(g)throw g}s({title:"Success",description:"Menu items reordered successfully"})}catch(p){s({title:"Error",description:"Failed to save new order: "+p.message,variant:"destructive"}),t()}}};return r.length===0?b.jsx("div",{className:"text-center py-8 text-gray-500",children:'No menu items yet. Click "Add Menu Item" to get started.'}):b.jsxs("div",{className:"space-y-4",children:[b.jsx("div",{className:"text-sm text-gray-600 mb-4 flex items-center gap-2",children:b.jsx("span",{children:"💡 Tip: Drag and drop items to reorder them on your menu"})}),b.jsx(POe,{sensors:n,collisionDetection:PLe,onDragEnd:a,children:b.jsx(VOe,{items:r.map(o=>o.id),strategy:UOe,children:r.map(o=>b.jsx(JOe,{item:o,onEdit:e,onDelete:t},o.id))})})]})},t3e=({menuItems:r,onAddMenuItem:e,onEditMenuItem:t,onDeleteMenuItem:i,onReorderItems:s})=>b.jsxs(Vt,{children:[b.jsx(Dr,{children:b.jsxs("div",{className:"flex justify-between items-center",children:[b.jsxs("div",{children:[b.jsx(Lr,{children:"Menu Items"}),b.jsx(Or,{children:"Manage your restaurant's menu items"})]}),b.jsxs(tt,{onClick:e,children:[b.jsx(Sse,{className:"w-4 h-4 mr-2"}),"Add Menu Item"]})]})}),b.jsx(jt,{children:b.jsx(e3e,{menuItems:r,onEdit:t,onDelete:i,onReorder:s})})]});var i3e=Array.isArray,ss=i3e,r3e=typeof xr=="object"&&xr&&xr.Object===Object&&xr,q7=r3e,s3e=q7,n3e=typeof self=="object"&&self&&self.Object===Object&&self,a3e=s3e||n3e||Function("return this")(),Qa=a3e,o3e=Qa,l3e=o3e.Symbol,$y=l3e,m4=$y,Y7=Object.prototype,c3e=Y7.hasOwnProperty,u3e=Y7.toString,dg=m4?m4.toStringTag:void 0;function h3e(r){var e=c3e.call(r,dg),t=r[dg];try{r[dg]=void 0;var i=!0}catch{}var s=u3e.call(r);return i&&(e?r[dg]=t:delete r[dg]),s}var d3e=h3e,f3e=Object.prototype,p3e=f3e.toString;function m3e(r){return p3e.call(r)}var g3e=m3e,g4=$y,_3e=d3e,v3e=g3e,y3e="[object Null]",S3e="[object Undefined]",_4=g4?g4.toStringTag:void 0;function x3e(r){return r==null?r===void 0?S3e:y3e:_4&&_4 in Object(r)?_3e(r):v3e(r)}var ol=x3e;function b3e(r){return r!=null&&typeof r=="object"}var ll=b3e,w3e=ol,T3e=ll,E3e="[object Symbol]";function A3e(r){return typeof r=="symbol"||T3e(r)&&w3e(r)==E3e}var vm=A3e,C3e=ss,P3e=vm,I3e=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,M3e=/^\w*$/;function R3e(r,e){if(C3e(r))return!1;var t=typeof r;return t=="number"||t=="symbol"||t=="boolean"||r==null||P3e(r)?!0:M3e.test(r)||!I3e.test(r)||e!=null&&r in Object(e)}var pN=R3e;function D3e(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}var kc=D3e;const ym=pt(kc);var L3e=ol,O3e=kc,N3e="[object AsyncFunction]",k3e="[object Function]",F3e="[object GeneratorFunction]",B3e="[object Proxy]";function U3e(r){if(!O3e(r))return!1;var e=L3e(r);return e==k3e||e==F3e||e==N3e||e==B3e}var mN=U3e;const Ce=pt(mN);var z3e=Qa,V3e=z3e["__core-js_shared__"],j3e=V3e,pP=j3e,v4=function(){var r=/[^.]+$/.exec(pP&&pP.keys&&pP.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function $3e(r){return!!v4&&v4 in r}var H3e=$3e,G3e=Function.prototype,W3e=G3e.toString;function X3e(r){if(r!=null){try{return W3e.call(r)}catch{}try{return r+""}catch{}}return""}var K7=X3e,q3e=mN,Y3e=H3e,K3e=kc,Z3e=K7,Q3e=/[\\^$.*+?()[\]{}|]/g,J3e=/^\[object .+?Constructor\]$/,eNe=Function.prototype,tNe=Object.prototype,iNe=eNe.toString,rNe=tNe.hasOwnProperty,sNe=RegExp("^"+iNe.call(rNe).replace(Q3e,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function nNe(r){if(!K3e(r)||Y3e(r))return!1;var e=q3e(r)?sNe:J3e;return e.test(Z3e(r))}var aNe=nNe;function oNe(r,e){return r==null?void 0:r[e]}var lNe=oNe,cNe=aNe,uNe=lNe;function hNe(r,e){var t=uNe(r,e);return cNe(t)?t:void 0}var Bh=hNe,dNe=Bh,fNe=dNe(Object,"create"),hA=fNe,y4=hA;function pNe(){this.__data__=y4?y4(null):{},this.size=0}var mNe=pNe;function gNe(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}var _Ne=gNe,vNe=hA,yNe="__lodash_hash_undefined__",SNe=Object.prototype,xNe=SNe.hasOwnProperty;function bNe(r){var e=this.__data__;if(vNe){var t=e[r];return t===yNe?void 0:t}return xNe.call(e,r)?e[r]:void 0}var wNe=bNe,TNe=hA,ENe=Object.prototype,ANe=ENe.hasOwnProperty;function CNe(r){var e=this.__data__;return TNe?e[r]!==void 0:ANe.call(e,r)}var PNe=CNe,INe=hA,MNe="__lodash_hash_undefined__";function RNe(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=INe&&e===void 0?MNe:e,this}var DNe=RNe,LNe=mNe,ONe=_Ne,NNe=wNe,kNe=PNe,FNe=DNe;function Sm(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var i=r[e];this.set(i[0],i[1])}}Sm.prototype.clear=LNe;Sm.prototype.delete=ONe;Sm.prototype.get=NNe;Sm.prototype.has=kNe;Sm.prototype.set=FNe;var BNe=Sm;function UNe(){this.__data__=[],this.size=0}var zNe=UNe;function VNe(r,e){return r===e||r!==r&&e!==e}var gN=VNe,jNe=gN;function $Ne(r,e){for(var t=r.length;t--;)if(jNe(r[t][0],e))return t;return-1}var dA=$Ne,HNe=dA,GNe=Array.prototype,WNe=GNe.splice;function XNe(r){var e=this.__data__,t=HNe(e,r);if(t<0)return!1;var i=e.length-1;return t==i?e.pop():WNe.call(e,t,1),--this.size,!0}var qNe=XNe,YNe=dA;function KNe(r){var e=this.__data__,t=YNe(e,r);return t<0?void 0:e[t][1]}var ZNe=KNe,QNe=dA;function JNe(r){return QNe(this.__data__,r)>-1}var eke=JNe,tke=dA;function ike(r,e){var t=this.__data__,i=tke(t,r);return i<0?(++this.size,t.push([r,e])):t[i][1]=e,this}var rke=ike,ske=zNe,nke=qNe,ake=ZNe,oke=eke,lke=rke;function xm(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var i=r[e];this.set(i[0],i[1])}}xm.prototype.clear=ske;xm.prototype.delete=nke;xm.prototype.get=ake;xm.prototype.has=oke;xm.prototype.set=lke;var fA=xm,cke=Bh,uke=Qa,hke=cke(uke,"Map"),_N=hke,S4=BNe,dke=fA,fke=_N;function pke(){this.size=0,this.__data__={hash:new S4,map:new(fke||dke),string:new S4}}var mke=pke;function gke(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}var _ke=gke,vke=_ke;function yke(r,e){var t=r.__data__;return vke(e)?t[typeof e=="string"?"string":"hash"]:t.map}var pA=yke,Ske=pA;function xke(r){var e=Ske(this,r).delete(r);return this.size-=e?1:0,e}var bke=xke,wke=pA;function Tke(r){return wke(this,r).get(r)}var Eke=Tke,Ake=pA;function Cke(r){return Ake(this,r).has(r)}var Pke=Cke,Ike=pA;function Mke(r,e){var t=Ike(this,r),i=t.size;return t.set(r,e),this.size+=t.size==i?0:1,this}var Rke=Mke,Dke=mke,Lke=bke,Oke=Eke,Nke=Pke,kke=Rke;function bm(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var i=r[e];this.set(i[0],i[1])}}bm.prototype.clear=Dke;bm.prototype.delete=Lke;bm.prototype.get=Oke;bm.prototype.has=Nke;bm.prototype.set=kke;var vN=bm,Z7=vN,Fke="Expected a function";function yN(r,e){if(typeof r!="function"||e!=null&&typeof e!="function")throw new TypeError(Fke);var t=function(){var i=arguments,s=e?e.apply(this,i):i[0],n=t.cache;if(n.has(s))return n.get(s);var a=r.apply(this,i);return t.cache=n.set(s,a)||n,a};return t.cache=new(yN.Cache||Z7),t}yN.Cache=Z7;var Q7=yN;const Bke=pt(Q7);var Uke=Q7,zke=500;function Vke(r){var e=Uke(r,function(i){return t.size===zke&&t.clear(),i}),t=e.cache;return e}var jke=Vke,$ke=jke,Hke=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Gke=/\\(\\)?/g,Wke=$ke(function(r){var e=[];return r.charCodeAt(0)===46&&e.push(""),r.replace(Hke,function(t,i,s,n){e.push(s?n.replace(Gke,"$1"):i||t)}),e}),Xke=Wke;function qke(r,e){for(var t=-1,i=r==null?0:r.length,s=Array(i);++t<i;)s[t]=e(r[t],t,r);return s}var SN=qke,x4=$y,Yke=SN,Kke=ss,Zke=vm,b4=x4?x4.prototype:void 0,w4=b4?b4.toString:void 0;function J7(r){if(typeof r=="string")return r;if(Kke(r))return Yke(r,J7)+"";if(Zke(r))return w4?w4.call(r):"";var e=r+"";return e=="0"&&1/r==-1/0?"-0":e}var Qke=J7,Jke=Qke;function eFe(r){return r==null?"":Jke(r)}var eZ=eFe,tFe=ss,iFe=pN,rFe=Xke,sFe=eZ;function nFe(r,e){return tFe(r)?r:iFe(r,e)?[r]:rFe(sFe(r))}var tZ=nFe,aFe=vm;function oFe(r){if(typeof r=="string"||aFe(r))return r;var e=r+"";return e=="0"&&1/r==-1/0?"-0":e}var mA=oFe,lFe=tZ,cFe=mA;function uFe(r,e){e=lFe(e,r);for(var t=0,i=e.length;r!=null&&t<i;)r=r[cFe(e[t++])];return t&&t==i?r:void 0}var xN=uFe,hFe=xN;function dFe(r,e,t){var i=r==null?void 0:hFe(r,e);return i===void 0?t:i}var iZ=dFe;const Cs=pt(iZ);function fFe(r){return r==null}var pFe=fFe;const Pe=pt(pFe);var mFe=ol,gFe=ss,_Fe=ll,vFe="[object String]";function yFe(r){return typeof r=="string"||!gFe(r)&&_Fe(r)&&mFe(r)==vFe}var SFe=yFe;const Th=pt(SFe);var rZ={exports:{}},mt={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bN=Symbol.for("react.element"),wN=Symbol.for("react.portal"),gA=Symbol.for("react.fragment"),_A=Symbol.for("react.strict_mode"),vA=Symbol.for("react.profiler"),yA=Symbol.for("react.provider"),SA=Symbol.for("react.context"),xFe=Symbol.for("react.server_context"),xA=Symbol.for("react.forward_ref"),bA=Symbol.for("react.suspense"),wA=Symbol.for("react.suspense_list"),TA=Symbol.for("react.memo"),EA=Symbol.for("react.lazy"),bFe=Symbol.for("react.offscreen"),sZ;sZ=Symbol.for("react.module.reference");function fn(r){if(typeof r=="object"&&r!==null){var e=r.$$typeof;switch(e){case bN:switch(r=r.type,r){case gA:case vA:case _A:case bA:case wA:return r;default:switch(r=r&&r.$$typeof,r){case xFe:case SA:case xA:case EA:case TA:case yA:return r;default:return e}}case wN:return e}}}mt.ContextConsumer=SA;mt.ContextProvider=yA;mt.Element=bN;mt.ForwardRef=xA;mt.Fragment=gA;mt.Lazy=EA;mt.Memo=TA;mt.Portal=wN;mt.Profiler=vA;mt.StrictMode=_A;mt.Suspense=bA;mt.SuspenseList=wA;mt.isAsyncMode=function(){return!1};mt.isConcurrentMode=function(){return!1};mt.isContextConsumer=function(r){return fn(r)===SA};mt.isContextProvider=function(r){return fn(r)===yA};mt.isElement=function(r){return typeof r=="object"&&r!==null&&r.$$typeof===bN};mt.isForwardRef=function(r){return fn(r)===xA};mt.isFragment=function(r){return fn(r)===gA};mt.isLazy=function(r){return fn(r)===EA};mt.isMemo=function(r){return fn(r)===TA};mt.isPortal=function(r){return fn(r)===wN};mt.isProfiler=function(r){return fn(r)===vA};mt.isStrictMode=function(r){return fn(r)===_A};mt.isSuspense=function(r){return fn(r)===bA};mt.isSuspenseList=function(r){return fn(r)===wA};mt.isValidElementType=function(r){return typeof r=="string"||typeof r=="function"||r===gA||r===vA||r===_A||r===bA||r===wA||r===bFe||typeof r=="object"&&r!==null&&(r.$$typeof===EA||r.$$typeof===TA||r.$$typeof===yA||r.$$typeof===SA||r.$$typeof===xA||r.$$typeof===sZ||r.getModuleId!==void 0)};mt.typeOf=fn;rZ.exports=mt;var wFe=rZ.exports,TFe=ol,EFe=ll,AFe="[object Number]";function CFe(r){return typeof r=="number"||EFe(r)&&TFe(r)==AFe}var nZ=CFe;const PFe=pt(nZ);var IFe=nZ;function MFe(r){return IFe(r)&&r!=+r}var RFe=MFe;const Hy=pt(RFe);var Nr=function(e){return e===0?0:e>0?1:-1},Cu=function(e){return Th(e)&&e.indexOf("%")===e.length-1},oe=function(e){return PFe(e)&&!Hy(e)},DFe=function(e){return Pe(e)},Ui=function(e){return oe(e)||Th(e)},LFe=0,wm=function(e){var t=++LFe;return"".concat(e||"").concat(t)},kr=function(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!oe(e)&&!Th(e))return i;var n;if(Cu(e)){var a=e.indexOf("%");n=t*parseFloat(e.slice(0,a))/100}else n=+e;return Hy(n)&&(n=i),s&&n>t&&(n=t),n},Od=function(e){if(!e)return null;var t=Object.keys(e);return t&&t.length?e[t[0]]:null},OFe=function(e){if(!Array.isArray(e))return!1;for(var t=e.length,i={},s=0;s<t;s++)if(!i[e[s]])i[e[s]]=!0;else return!0;return!1},Ss=function(e,t){return oe(e)&&oe(t)?function(i){return e+i*(t-e)}:function(){return t}};function Qb(r,e,t){return!r||!r.length?null:r.find(function(i){return i&&(typeof e=="function"?e(i):Cs(i,e))===t})}var NFe=function(e,t){return oe(e)&&oe(t)?e-t:Th(e)&&Th(t)?e.localeCompare(t):e instanceof Date&&t instanceof Date?e.getTime()-t.getTime():String(e).localeCompare(String(t))};function Ff(r,e){for(var t in r)if({}.hasOwnProperty.call(r,t)&&(!{}.hasOwnProperty.call(e,t)||r[t]!==e[t]))return!1;for(var i in e)if({}.hasOwnProperty.call(e,i)&&!{}.hasOwnProperty.call(r,i))return!1;return!0}function aR(r){"@babel/helpers - typeof";return aR=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},aR(r)}var kFe=["viewBox","children"],FFe=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],T4=["points","pathLength"],mP={svg:kFe,polygon:T4,polyline:T4},TN=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],Jb=function(e,t){if(!e||typeof e=="function"||typeof e=="boolean")return null;var i=e;if(E.isValidElement(e)&&(i=e.props),!ym(i))return null;var s={};return Object.keys(i).forEach(function(n){TN.includes(n)&&(s[n]=t||function(a){return i[n](i,a)})}),s},BFe=function(e,t,i){return function(s){return e(t,i,s),null}},Eh=function(e,t,i){if(!ym(e)||aR(e)!=="object")return null;var s=null;return Object.keys(e).forEach(function(n){var a=e[n];TN.includes(n)&&typeof a=="function"&&(s||(s={}),s[n]=BFe(a,t,i))}),s},UFe=["children"],zFe=["children"];function E4(r,e){if(r==null)return{};var t=VFe(r,e),i,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(r,i)&&(t[i]=r[i])}return t}function VFe(r,e){if(r==null)return{};var t={};for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(e.indexOf(i)>=0)continue;t[i]=r[i]}return t}function oR(r){"@babel/helpers - typeof";return oR=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oR(r)}var A4={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},jo=function(e){return typeof e=="string"?e:e?e.displayName||e.name||"Component":""},C4=null,gP=null,EN=function r(e){if(e===C4&&Array.isArray(gP))return gP;var t=[];return E.Children.forEach(e,function(i){Pe(i)||(wFe.isFragment(i)?t=t.concat(r(i.props.children)):t.push(i))}),gP=t,C4=e,t};function Ps(r,e){var t=[],i=[];return Array.isArray(e)?i=e.map(function(s){return jo(s)}):i=[jo(e)],EN(r).forEach(function(s){var n=Cs(s,"type.displayName")||Cs(s,"type.name");i.indexOf(n)!==-1&&t.push(s)}),t}function _s(r,e){var t=Ps(r,e);return t&&t[0]}var P4=function(e){if(!e||!e.props)return!1;var t=e.props,i=t.width,s=t.height;return!(!oe(i)||i<=0||!oe(s)||s<=0)},jFe=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],$Fe=function(e){return e&&e.type&&Th(e.type)&&jFe.indexOf(e.type)>=0},HFe=function(e){return e&&oR(e)==="object"&&"clipDot"in e},GFe=function(e,t,i,s){var n,a=(n=mP==null?void 0:mP[s])!==null&&n!==void 0?n:[];return t.startsWith("data-")||!Ce(e)&&(s&&a.includes(t)||FFe.includes(t))||i&&TN.includes(t)},Se=function(e,t,i){if(!e||typeof e=="function"||typeof e=="boolean")return null;var s=e;if(E.isValidElement(e)&&(s=e.props),!ym(s))return null;var n={};return Object.keys(s).forEach(function(a){var o;GFe((o=s)===null||o===void 0?void 0:o[a],a,t,i)&&(n[a]=s[a])}),n},lR=function r(e,t){if(e===t)return!0;var i=E.Children.count(e);if(i!==E.Children.count(t))return!1;if(i===0)return!0;if(i===1)return I4(Array.isArray(e)?e[0]:e,Array.isArray(t)?t[0]:t);for(var s=0;s<i;s++){var n=e[s],a=t[s];if(Array.isArray(n)||Array.isArray(a)){if(!r(n,a))return!1}else if(!I4(n,a))return!1}return!0},I4=function(e,t){if(Pe(e)&&Pe(t))return!0;if(!Pe(e)&&!Pe(t)){var i=e.props||{},s=i.children,n=E4(i,UFe),a=t.props||{},o=a.children,l=E4(a,zFe);return s&&o?Ff(n,l)&&lR(s,o):!s&&!o?Ff(n,l):!1}return!1},M4=function(e,t){var i=[],s={};return EN(e).forEach(function(n,a){if($Fe(n))i.push(n);else if(n){var o=jo(n.type),l=t[o]||{},c=l.handler,u=l.once;if(c&&(!u||!s[o])){var h=c(n,o,a);i.push(h),s[o]=!0}}}),i},WFe=function(e){var t=e&&e.type;return t&&A4[t]?A4[t]:null},XFe=function(e,t){return EN(t).indexOf(e)},qFe=["children","width","height","viewBox","className","style","title","desc"];function cR(){return cR=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},cR.apply(this,arguments)}function YFe(r,e){if(r==null)return{};var t=KFe(r,e),i,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(r,i)&&(t[i]=r[i])}return t}function KFe(r,e){if(r==null)return{};var t={};for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(e.indexOf(i)>=0)continue;t[i]=r[i]}return t}function uR(r){var e=r.children,t=r.width,i=r.height,s=r.viewBox,n=r.className,a=r.style,o=r.title,l=r.desc,c=YFe(r,qFe),u=s||{width:t,height:i,x:0,y:0},h=Re("recharts-surface",n);return U.createElement("svg",cR({},Se(c,!0,"svg"),{className:h,width:t,height:i,style:a,viewBox:"".concat(u.x," ").concat(u.y," ").concat(u.width," ").concat(u.height)}),U.createElement("title",null,o),U.createElement("desc",null,l),e)}var ZFe=["children","className"];function hR(){return hR=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},hR.apply(this,arguments)}function QFe(r,e){if(r==null)return{};var t=JFe(r,e),i,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(r,i)&&(t[i]=r[i])}return t}function JFe(r,e){if(r==null)return{};var t={};for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(e.indexOf(i)>=0)continue;t[i]=r[i]}return t}var et=U.forwardRef(function(r,e){var t=r.children,i=r.className,s=QFe(r,ZFe),n=Re("recharts-layer",i);return U.createElement("g",hR({className:n},Se(s,!0),{ref:e}),t)}),$o=function(e,t){for(var i=arguments.length,s=new Array(i>2?i-2:0),n=2;n<i;n++)s[n-2]=arguments[n]};function eBe(r,e,t){var i=-1,s=r.length;e<0&&(e=-e>s?0:s+e),t=t>s?s:t,t<0&&(t+=s),s=e>t?0:t-e>>>0,e>>>=0;for(var n=Array(s);++i<s;)n[i]=r[i+e];return n}var tBe=eBe,iBe=tBe;function rBe(r,e,t){var i=r.length;return t=t===void 0?i:t,!e&&t>=i?r:iBe(r,e,t)}var sBe=rBe,nBe="\\ud800-\\udfff",aBe="\\u0300-\\u036f",oBe="\\ufe20-\\ufe2f",lBe="\\u20d0-\\u20ff",cBe=aBe+oBe+lBe,uBe="\\ufe0e\\ufe0f",hBe="\\u200d",dBe=RegExp("["+hBe+nBe+cBe+uBe+"]");function fBe(r){return dBe.test(r)}var aZ=fBe;function pBe(r){return r.split("")}var mBe=pBe,oZ="\\ud800-\\udfff",gBe="\\u0300-\\u036f",_Be="\\ufe20-\\ufe2f",vBe="\\u20d0-\\u20ff",yBe=gBe+_Be+vBe,SBe="\\ufe0e\\ufe0f",xBe="["+oZ+"]",dR="["+yBe+"]",fR="\\ud83c[\\udffb-\\udfff]",bBe="(?:"+dR+"|"+fR+")",lZ="[^"+oZ+"]",cZ="(?:\\ud83c[\\udde6-\\uddff]){2}",uZ="[\\ud800-\\udbff][\\udc00-\\udfff]",wBe="\\u200d",hZ=bBe+"?",dZ="["+SBe+"]?",TBe="(?:"+wBe+"(?:"+[lZ,cZ,uZ].join("|")+")"+dZ+hZ+")*",EBe=dZ+hZ+TBe,ABe="(?:"+[lZ+dR+"?",dR,cZ,uZ,xBe].join("|")+")",CBe=RegExp(fR+"(?="+fR+")|"+ABe+EBe,"g");function PBe(r){return r.match(CBe)||[]}var IBe=PBe,MBe=mBe,RBe=aZ,DBe=IBe;function LBe(r){return RBe(r)?DBe(r):MBe(r)}var OBe=LBe,NBe=sBe,kBe=aZ,FBe=OBe,BBe=eZ;function UBe(r){return function(e){e=BBe(e);var t=kBe(e)?FBe(e):void 0,i=t?t[0]:e.charAt(0),s=t?NBe(t,1).join(""):e.slice(1);return i[r]()+s}}var zBe=UBe,VBe=zBe,jBe=VBe("toUpperCase"),$Be=jBe;const AA=pt($Be);function Ct(r){return function(){return r}}const fZ=Math.cos,ew=Math.sin,ta=Math.sqrt,tw=Math.PI,CA=2*tw,pR=Math.PI,mR=2*pR,lu=1e-6,HBe=mR-lu;function pZ(r){this._+=r[0];for(let e=1,t=r.length;e<t;++e)this._+=arguments[e]+r[e]}function GBe(r){let e=Math.floor(r);if(!(e>=0))throw new Error(`invalid digits: ${r}`);if(e>15)return pZ;const t=10**e;return function(i){this._+=i[0];for(let s=1,n=i.length;s<n;++s)this._+=Math.round(arguments[s]*t)/t+i[s]}}class WBe{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?pZ:GBe(e)}moveTo(e,t){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,t){this._append`L${this._x1=+e},${this._y1=+t}`}quadraticCurveTo(e,t,i,s){this._append`Q${+e},${+t},${this._x1=+i},${this._y1=+s}`}bezierCurveTo(e,t,i,s,n,a){this._append`C${+e},${+t},${+i},${+s},${this._x1=+n},${this._y1=+a}`}arcTo(e,t,i,s,n){if(e=+e,t=+t,i=+i,s=+s,n=+n,n<0)throw new Error(`negative radius: ${n}`);let a=this._x1,o=this._y1,l=i-e,c=s-t,u=a-e,h=o-t,d=u*u+h*h;if(this._x1===null)this._append`M${this._x1=e},${this._y1=t}`;else if(d>lu)if(!(Math.abs(h*l-c*u)>lu)||!n)this._append`L${this._x1=e},${this._y1=t}`;else{let f=i-a,p=s-o,m=l*l+c*c,g=f*f+p*p,_=Math.sqrt(m),v=Math.sqrt(d),y=n*Math.tan((pR-Math.acos((m+d-g)/(2*_*v)))/2),x=y/v,S=y/_;Math.abs(x-1)>lu&&this._append`L${e+x*u},${t+x*h}`,this._append`A${n},${n},0,0,${+(h*f>u*p)},${this._x1=e+S*l},${this._y1=t+S*c}`}}arc(e,t,i,s,n,a){if(e=+e,t=+t,i=+i,a=!!a,i<0)throw new Error(`negative radius: ${i}`);let o=i*Math.cos(s),l=i*Math.sin(s),c=e+o,u=t+l,h=1^a,d=a?s-n:n-s;this._x1===null?this._append`M${c},${u}`:(Math.abs(this._x1-c)>lu||Math.abs(this._y1-u)>lu)&&this._append`L${c},${u}`,i&&(d<0&&(d=d%mR+mR),d>HBe?this._append`A${i},${i},0,1,${h},${e-o},${t-l}A${i},${i},0,1,${h},${this._x1=c},${this._y1=u}`:d>lu&&this._append`A${i},${i},0,${+(d>=pR)},${h},${this._x1=e+i*Math.cos(n)},${this._y1=t+i*Math.sin(n)}`)}rect(e,t,i,s){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${i=+i}v${+s}h${-i}Z`}toString(){return this._}}function AN(r){let e=3;return r.digits=function(t){if(!arguments.length)return e;if(t==null)e=null;else{const i=Math.floor(t);if(!(i>=0))throw new RangeError(`invalid digits: ${t}`);e=i}return r},()=>new WBe(e)}function CN(r){return typeof r=="object"&&"length"in r?r:Array.from(r)}function mZ(r){this._context=r}mZ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(r,e){switch(r=+r,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(r,e):this._context.moveTo(r,e);break;case 1:this._point=2;default:this._context.lineTo(r,e);break}}};function PA(r){return new mZ(r)}function gZ(r){return r[0]}function _Z(r){return r[1]}function vZ(r,e){var t=Ct(!0),i=null,s=PA,n=null,a=AN(o);r=typeof r=="function"?r:r===void 0?gZ:Ct(r),e=typeof e=="function"?e:e===void 0?_Z:Ct(e);function o(l){var c,u=(l=CN(l)).length,h,d=!1,f;for(i==null&&(n=s(f=a())),c=0;c<=u;++c)!(c<u&&t(h=l[c],c,l))===d&&((d=!d)?n.lineStart():n.lineEnd()),d&&n.point(+r(h,c,l),+e(h,c,l));if(f)return n=null,f+""||null}return o.x=function(l){return arguments.length?(r=typeof l=="function"?l:Ct(+l),o):r},o.y=function(l){return arguments.length?(e=typeof l=="function"?l:Ct(+l),o):e},o.defined=function(l){return arguments.length?(t=typeof l=="function"?l:Ct(!!l),o):t},o.curve=function(l){return arguments.length?(s=l,i!=null&&(n=s(i)),o):s},o.context=function(l){return arguments.length?(l==null?i=n=null:n=s(i=l),o):i},o}function ES(r,e,t){var i=null,s=Ct(!0),n=null,a=PA,o=null,l=AN(c);r=typeof r=="function"?r:r===void 0?gZ:Ct(+r),e=typeof e=="function"?e:Ct(e===void 0?0:+e),t=typeof t=="function"?t:t===void 0?_Z:Ct(+t);function c(h){var d,f,p,m=(h=CN(h)).length,g,_=!1,v,y=new Array(m),x=new Array(m);for(n==null&&(o=a(v=l())),d=0;d<=m;++d){if(!(d<m&&s(g=h[d],d,h))===_)if(_=!_)f=d,o.areaStart(),o.lineStart();else{for(o.lineEnd(),o.lineStart(),p=d-1;p>=f;--p)o.point(y[p],x[p]);o.lineEnd(),o.areaEnd()}_&&(y[d]=+r(g,d,h),x[d]=+e(g,d,h),o.point(i?+i(g,d,h):y[d],t?+t(g,d,h):x[d]))}if(v)return o=null,v+""||null}function u(){return vZ().defined(s).curve(a).context(n)}return c.x=function(h){return arguments.length?(r=typeof h=="function"?h:Ct(+h),i=null,c):r},c.x0=function(h){return arguments.length?(r=typeof h=="function"?h:Ct(+h),c):r},c.x1=function(h){return arguments.length?(i=h==null?null:typeof h=="function"?h:Ct(+h),c):i},c.y=function(h){return arguments.length?(e=typeof h=="function"?h:Ct(+h),t=null,c):e},c.y0=function(h){return arguments.length?(e=typeof h=="function"?h:Ct(+h),c):e},c.y1=function(h){return arguments.length?(t=h==null?null:typeof h=="function"?h:Ct(+h),c):t},c.lineX0=c.lineY0=function(){return u().x(r).y(e)},c.lineY1=function(){return u().x(r).y(t)},c.lineX1=function(){return u().x(i).y(e)},c.defined=function(h){return arguments.length?(s=typeof h=="function"?h:Ct(!!h),c):s},c.curve=function(h){return arguments.length?(a=h,n!=null&&(o=a(n)),c):a},c.context=function(h){return arguments.length?(h==null?n=o=null:o=a(n=h),c):n},c}class yZ{constructor(e,t){this._context=e,this._x=t}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(e,t){switch(e=+e,t=+t,this._point){case 0:{this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+e)/2,this._y0,this._x0,t,e,t):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+t)/2,e,this._y0,e,t);break}}this._x0=e,this._y0=t}}function XBe(r){return new yZ(r,!0)}function qBe(r){return new yZ(r,!1)}const PN={draw(r,e){const t=ta(e/tw);r.moveTo(t,0),r.arc(0,0,t,0,CA)}},YBe={draw(r,e){const t=ta(e/5)/2;r.moveTo(-3*t,-t),r.lineTo(-t,-t),r.lineTo(-t,-3*t),r.lineTo(t,-3*t),r.lineTo(t,-t),r.lineTo(3*t,-t),r.lineTo(3*t,t),r.lineTo(t,t),r.lineTo(t,3*t),r.lineTo(-t,3*t),r.lineTo(-t,t),r.lineTo(-3*t,t),r.closePath()}},SZ=ta(1/3),KBe=SZ*2,ZBe={draw(r,e){const t=ta(e/KBe),i=t*SZ;r.moveTo(0,-t),r.lineTo(i,0),r.lineTo(0,t),r.lineTo(-i,0),r.closePath()}},QBe={draw(r,e){const t=ta(e),i=-t/2;r.rect(i,i,t,t)}},JBe=.8908130915292852,xZ=ew(tw/10)/ew(7*tw/10),eUe=ew(CA/10)*xZ,tUe=-fZ(CA/10)*xZ,iUe={draw(r,e){const t=ta(e*JBe),i=eUe*t,s=tUe*t;r.moveTo(0,-t),r.lineTo(i,s);for(let n=1;n<5;++n){const a=CA*n/5,o=fZ(a),l=ew(a);r.lineTo(l*t,-o*t),r.lineTo(o*i-l*s,l*i+o*s)}r.closePath()}},_P=ta(3),rUe={draw(r,e){const t=-ta(e/(_P*3));r.moveTo(0,t*2),r.lineTo(-_P*t,-t),r.lineTo(_P*t,-t),r.closePath()}},$s=-.5,Hs=ta(3)/2,gR=1/ta(12),sUe=(gR/2+1)*3,nUe={draw(r,e){const t=ta(e/sUe),i=t/2,s=t*gR,n=i,a=t*gR+t,o=-n,l=a;r.moveTo(i,s),r.lineTo(n,a),r.lineTo(o,l),r.lineTo($s*i-Hs*s,Hs*i+$s*s),r.lineTo($s*n-Hs*a,Hs*n+$s*a),r.lineTo($s*o-Hs*l,Hs*o+$s*l),r.lineTo($s*i+Hs*s,$s*s-Hs*i),r.lineTo($s*n+Hs*a,$s*a-Hs*n),r.lineTo($s*o+Hs*l,$s*l-Hs*o),r.closePath()}};function aUe(r,e){let t=null,i=AN(s);r=typeof r=="function"?r:Ct(r||PN),e=typeof e=="function"?e:Ct(e===void 0?64:+e);function s(){let n;if(t||(t=n=i()),r.apply(this,arguments).draw(t,+e.apply(this,arguments)),n)return t=null,n+""||null}return s.type=function(n){return arguments.length?(r=typeof n=="function"?n:Ct(n),s):r},s.size=function(n){return arguments.length?(e=typeof n=="function"?n:Ct(+n),s):e},s.context=function(n){return arguments.length?(t=n??null,s):t},s}function iw(){}function rw(r,e,t){r._context.bezierCurveTo((2*r._x0+r._x1)/3,(2*r._y0+r._y1)/3,(r._x0+2*r._x1)/3,(r._y0+2*r._y1)/3,(r._x0+4*r._x1+e)/6,(r._y0+4*r._y1+t)/6)}function bZ(r){this._context=r}bZ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:rw(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(r,e){switch(r=+r,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(r,e):this._context.moveTo(r,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:rw(this,r,e);break}this._x0=this._x1,this._x1=r,this._y0=this._y1,this._y1=e}};function oUe(r){return new bZ(r)}function wZ(r){this._context=r}wZ.prototype={areaStart:iw,areaEnd:iw,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(r,e){switch(r=+r,e=+e,this._point){case 0:this._point=1,this._x2=r,this._y2=e;break;case 1:this._point=2,this._x3=r,this._y3=e;break;case 2:this._point=3,this._x4=r,this._y4=e,this._context.moveTo((this._x0+4*this._x1+r)/6,(this._y0+4*this._y1+e)/6);break;default:rw(this,r,e);break}this._x0=this._x1,this._x1=r,this._y0=this._y1,this._y1=e}};function lUe(r){return new wZ(r)}function TZ(r){this._context=r}TZ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(r,e){switch(r=+r,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var t=(this._x0+4*this._x1+r)/6,i=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(t,i):this._context.moveTo(t,i);break;case 3:this._point=4;default:rw(this,r,e);break}this._x0=this._x1,this._x1=r,this._y0=this._y1,this._y1=e}};function cUe(r){return new TZ(r)}function EZ(r){this._context=r}EZ.prototype={areaStart:iw,areaEnd:iw,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(r,e){r=+r,e=+e,this._point?this._context.lineTo(r,e):(this._point=1,this._context.moveTo(r,e))}};function uUe(r){return new EZ(r)}function R4(r){return r<0?-1:1}function D4(r,e,t){var i=r._x1-r._x0,s=e-r._x1,n=(r._y1-r._y0)/(i||s<0&&-0),a=(t-r._y1)/(s||i<0&&-0),o=(n*s+a*i)/(i+s);return(R4(n)+R4(a))*Math.min(Math.abs(n),Math.abs(a),.5*Math.abs(o))||0}function L4(r,e){var t=r._x1-r._x0;return t?(3*(r._y1-r._y0)/t-e)/2:e}function vP(r,e,t){var i=r._x0,s=r._y0,n=r._x1,a=r._y1,o=(n-i)/3;r._context.bezierCurveTo(i+o,s+o*e,n-o,a-o*t,n,a)}function sw(r){this._context=r}sw.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:vP(this,this._t0,L4(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(r,e){var t=NaN;if(r=+r,e=+e,!(r===this._x1&&e===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(r,e):this._context.moveTo(r,e);break;case 1:this._point=2;break;case 2:this._point=3,vP(this,L4(this,t=D4(this,r,e)),t);break;default:vP(this,this._t0,t=D4(this,r,e));break}this._x0=this._x1,this._x1=r,this._y0=this._y1,this._y1=e,this._t0=t}}};function AZ(r){this._context=new CZ(r)}(AZ.prototype=Object.create(sw.prototype)).point=function(r,e){sw.prototype.point.call(this,e,r)};function CZ(r){this._context=r}CZ.prototype={moveTo:function(r,e){this._context.moveTo(e,r)},closePath:function(){this._context.closePath()},lineTo:function(r,e){this._context.lineTo(e,r)},bezierCurveTo:function(r,e,t,i,s,n){this._context.bezierCurveTo(e,r,i,t,n,s)}};function hUe(r){return new sw(r)}function dUe(r){return new AZ(r)}function PZ(r){this._context=r}PZ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var r=this._x,e=this._y,t=r.length;if(t)if(this._line?this._context.lineTo(r[0],e[0]):this._context.moveTo(r[0],e[0]),t===2)this._context.lineTo(r[1],e[1]);else for(var i=O4(r),s=O4(e),n=0,a=1;a<t;++n,++a)this._context.bezierCurveTo(i[0][n],s[0][n],i[1][n],s[1][n],r[a],e[a]);(this._line||this._line!==0&&t===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(r,e){this._x.push(+r),this._y.push(+e)}};function O4(r){var e,t=r.length-1,i,s=new Array(t),n=new Array(t),a=new Array(t);for(s[0]=0,n[0]=2,a[0]=r[0]+2*r[1],e=1;e<t-1;++e)s[e]=1,n[e]=4,a[e]=4*r[e]+2*r[e+1];for(s[t-1]=2,n[t-1]=7,a[t-1]=8*r[t-1]+r[t],e=1;e<t;++e)i=s[e]/n[e-1],n[e]-=i,a[e]-=i*a[e-1];for(s[t-1]=a[t-1]/n[t-1],e=t-2;e>=0;--e)s[e]=(a[e]-s[e+1])/n[e];for(n[t-1]=(r[t]+s[t-1])/2,e=0;e<t-1;++e)n[e]=2*r[e+1]-s[e+1];return[s,n]}function fUe(r){return new PZ(r)}function IA(r,e){this._context=r,this._t=e}IA.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(r,e){switch(r=+r,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(r,e):this._context.moveTo(r,e);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(r,e);else{var t=this._x*(1-this._t)+r*this._t;this._context.lineTo(t,this._y),this._context.lineTo(t,e)}break}}this._x=r,this._y=e}};function pUe(r){return new IA(r,.5)}function mUe(r){return new IA(r,0)}function gUe(r){return new IA(r,1)}function Cp(r,e){if((a=r.length)>1)for(var t=1,i,s,n=r[e[0]],a,o=n.length;t<a;++t)for(s=n,n=r[e[t]],i=0;i<o;++i)n[i][1]+=n[i][0]=isNaN(s[i][1])?s[i][0]:s[i][1]}function _R(r){for(var e=r.length,t=new Array(e);--e>=0;)t[e]=e;return t}function _Ue(r,e){return r[e]}function vUe(r){const e=[];return e.key=r,e}function yUe(){var r=Ct([]),e=_R,t=Cp,i=_Ue;function s(n){var a=Array.from(r.apply(this,arguments),vUe),o,l=a.length,c=-1,u;for(const h of n)for(o=0,++c;o<l;++o)(a[o][c]=[0,+i(h,a[o].key,c,n)]).data=h;for(o=0,u=CN(e(a));o<l;++o)a[u[o]].index=o;return t(a,u),a}return s.keys=function(n){return arguments.length?(r=typeof n=="function"?n:Ct(Array.from(n)),s):r},s.value=function(n){return arguments.length?(i=typeof n=="function"?n:Ct(+n),s):i},s.order=function(n){return arguments.length?(e=n==null?_R:typeof n=="function"?n:Ct(Array.from(n)),s):e},s.offset=function(n){return arguments.length?(t=n??Cp,s):t},s}function SUe(r,e){if((i=r.length)>0){for(var t,i,s=0,n=r[0].length,a;s<n;++s){for(a=t=0;t<i;++t)a+=r[t][s][1]||0;if(a)for(t=0;t<i;++t)r[t][s][1]/=a}Cp(r,e)}}function xUe(r,e){if((s=r.length)>0){for(var t=0,i=r[e[0]],s,n=i.length;t<n;++t){for(var a=0,o=0;a<s;++a)o+=r[a][t][1]||0;i[t][1]+=i[t][0]=-o/2}Cp(r,e)}}function bUe(r,e){if(!(!((a=r.length)>0)||!((n=(s=r[e[0]]).length)>0))){for(var t=0,i=1,s,n,a;i<n;++i){for(var o=0,l=0,c=0;o<a;++o){for(var u=r[e[o]],h=u[i][1]||0,d=u[i-1][1]||0,f=(h-d)/2,p=0;p<o;++p){var m=r[e[p]],g=m[i][1]||0,_=m[i-1][1]||0;f+=g-_}l+=h,c+=f*h}s[i-1][1]+=s[i-1][0]=t,l&&(t-=c/l)}s[i-1][1]+=s[i-1][0]=t,Cp(r,e)}}function _v(r){"@babel/helpers - typeof";return _v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_v(r)}var wUe=["type","size","sizeType"];function vR(){return vR=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},vR.apply(this,arguments)}function N4(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function k4(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?N4(Object(t),!0).forEach(function(i){TUe(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):N4(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function TUe(r,e,t){return e=EUe(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function EUe(r){var e=AUe(r,"string");return _v(e)=="symbol"?e:e+""}function AUe(r,e){if(_v(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(_v(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function CUe(r,e){if(r==null)return{};var t=PUe(r,e),i,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(r,i)&&(t[i]=r[i])}return t}function PUe(r,e){if(r==null)return{};var t={};for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(e.indexOf(i)>=0)continue;t[i]=r[i]}return t}var IZ={symbolCircle:PN,symbolCross:YBe,symbolDiamond:ZBe,symbolSquare:QBe,symbolStar:iUe,symbolTriangle:rUe,symbolWye:nUe},IUe=Math.PI/180,MUe=function(e){var t="symbol".concat(AA(e));return IZ[t]||PN},RUe=function(e,t,i){if(t==="area")return e;switch(i){case"cross":return 5*e*e/9;case"diamond":return .5*e*e/Math.sqrt(3);case"square":return e*e;case"star":{var s=18*IUe;return 1.25*e*e*(Math.tan(s)-Math.tan(s*2)*Math.pow(Math.tan(s),2))}case"triangle":return Math.sqrt(3)*e*e/4;case"wye":return(21-10*Math.sqrt(3))*e*e/8;default:return Math.PI*e*e/4}},DUe=function(e,t){IZ["symbol".concat(AA(e))]=t},IN=function(e){var t=e.type,i=t===void 0?"circle":t,s=e.size,n=s===void 0?64:s,a=e.sizeType,o=a===void 0?"area":a,l=CUe(e,wUe),c=k4(k4({},l),{},{type:i,size:n,sizeType:o}),u=function(){var g=MUe(i),_=aUe().type(g).size(RUe(n,o,i));return _()},h=c.className,d=c.cx,f=c.cy,p=Se(c,!0);return d===+d&&f===+f&&n===+n?U.createElement("path",vR({},p,{className:Re("recharts-symbols",h),transform:"translate(".concat(d,", ").concat(f,")"),d:u()})):null};IN.registerSymbol=DUe;function Pp(r){"@babel/helpers - typeof";return Pp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pp(r)}function yR(){return yR=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},yR.apply(this,arguments)}function F4(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function LUe(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?F4(Object(t),!0).forEach(function(i){vv(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):F4(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function OUe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function NUe(r,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,RZ(i.key),i)}}function kUe(r,e,t){return e&&NUe(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function FUe(r,e,t){return e=nw(e),BUe(r,MZ()?Reflect.construct(e,t||[],nw(r).constructor):e.apply(r,t))}function BUe(r,e){if(e&&(Pp(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return UUe(r)}function UUe(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function MZ(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(MZ=function(){return!!r})()}function nw(r){return nw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},nw(r)}function zUe(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&SR(r,e)}function SR(r,e){return SR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},SR(r,e)}function vv(r,e,t){return e=RZ(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function RZ(r){var e=VUe(r,"string");return Pp(e)=="symbol"?e:e+""}function VUe(r,e){if(Pp(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Pp(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var Gs=32,MN=function(r){function e(){return OUe(this,e),FUe(this,e,arguments)}return zUe(e,r),kUe(e,[{key:"renderIcon",value:function(i){var s=this.props.inactiveColor,n=Gs/2,a=Gs/6,o=Gs/3,l=i.inactive?s:i.color;if(i.type==="plainline")return U.createElement("line",{strokeWidth:4,fill:"none",stroke:l,strokeDasharray:i.payload.strokeDasharray,x1:0,y1:n,x2:Gs,y2:n,className:"recharts-legend-icon"});if(i.type==="line")return U.createElement("path",{strokeWidth:4,fill:"none",stroke:l,d:"M0,".concat(n,"h").concat(o,`
            A`).concat(a,",").concat(a,",0,1,1,").concat(2*o,",").concat(n,`
            H`).concat(Gs,"M").concat(2*o,",").concat(n,`
            A`).concat(a,",").concat(a,",0,1,1,").concat(o,",").concat(n),className:"recharts-legend-icon"});if(i.type==="rect")return U.createElement("path",{stroke:"none",fill:l,d:"M0,".concat(Gs/8,"h").concat(Gs,"v").concat(Gs*3/4,"h").concat(-Gs,"z"),className:"recharts-legend-icon"});if(U.isValidElement(i.legendIcon)){var c=LUe({},i);return delete c.legendIcon,U.cloneElement(i.legendIcon,c)}return U.createElement(IN,{fill:l,cx:n,cy:n,size:Gs,sizeType:"diameter",type:i.type})}},{key:"renderItems",value:function(){var i=this,s=this.props,n=s.payload,a=s.iconSize,o=s.layout,l=s.formatter,c=s.inactiveColor,u={x:0,y:0,width:Gs,height:Gs},h={display:o==="horizontal"?"inline-block":"block",marginRight:10},d={display:"inline-block",verticalAlign:"middle",marginRight:4};return n.map(function(f,p){var m=f.formatter||l,g=Re(vv(vv({"recharts-legend-item":!0},"legend-item-".concat(p),!0),"inactive",f.inactive));if(f.type==="none")return null;var _=Ce(f.value)?null:f.value;$o(!Ce(f.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var v=f.inactive?c:f.color;return U.createElement("li",yR({className:g,style:h,key:"legend-item-".concat(p)},Eh(i.props,f,p)),U.createElement(uR,{width:a,height:a,viewBox:u,style:d},i.renderIcon(f)),U.createElement("span",{className:"recharts-legend-item-text",style:{color:v}},m?m(_,f,p):_))})}},{key:"render",value:function(){var i=this.props,s=i.payload,n=i.layout,a=i.align;if(!s||!s.length)return null;var o={padding:0,margin:0,textAlign:n==="horizontal"?a:"left"};return U.createElement("ul",{className:"recharts-default-legend",style:o},this.renderItems())}}])}(E.PureComponent);vv(MN,"displayName","Legend");vv(MN,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var jUe=fA;function $Ue(){this.__data__=new jUe,this.size=0}var HUe=$Ue;function GUe(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t}var WUe=GUe;function XUe(r){return this.__data__.get(r)}var qUe=XUe;function YUe(r){return this.__data__.has(r)}var KUe=YUe,ZUe=fA,QUe=_N,JUe=vN,eze=200;function tze(r,e){var t=this.__data__;if(t instanceof ZUe){var i=t.__data__;if(!QUe||i.length<eze-1)return i.push([r,e]),this.size=++t.size,this;t=this.__data__=new JUe(i)}return t.set(r,e),this.size=t.size,this}var ize=tze,rze=fA,sze=HUe,nze=WUe,aze=qUe,oze=KUe,lze=ize;function Tm(r){var e=this.__data__=new rze(r);this.size=e.size}Tm.prototype.clear=sze;Tm.prototype.delete=nze;Tm.prototype.get=aze;Tm.prototype.has=oze;Tm.prototype.set=lze;var DZ=Tm,cze="__lodash_hash_undefined__";function uze(r){return this.__data__.set(r,cze),this}var hze=uze;function dze(r){return this.__data__.has(r)}var fze=dze,pze=vN,mze=hze,gze=fze;function aw(r){var e=-1,t=r==null?0:r.length;for(this.__data__=new pze;++e<t;)this.add(r[e])}aw.prototype.add=aw.prototype.push=mze;aw.prototype.has=gze;var LZ=aw;function _ze(r,e){for(var t=-1,i=r==null?0:r.length;++t<i;)if(e(r[t],t,r))return!0;return!1}var OZ=_ze;function vze(r,e){return r.has(e)}var NZ=vze,yze=LZ,Sze=OZ,xze=NZ,bze=1,wze=2;function Tze(r,e,t,i,s,n){var a=t&bze,o=r.length,l=e.length;if(o!=l&&!(a&&l>o))return!1;var c=n.get(r),u=n.get(e);if(c&&u)return c==e&&u==r;var h=-1,d=!0,f=t&wze?new yze:void 0;for(n.set(r,e),n.set(e,r);++h<o;){var p=r[h],m=e[h];if(i)var g=a?i(m,p,h,e,r,n):i(p,m,h,r,e,n);if(g!==void 0){if(g)continue;d=!1;break}if(f){if(!Sze(e,function(_,v){if(!xze(f,v)&&(p===_||s(p,_,t,i,n)))return f.push(v)})){d=!1;break}}else if(!(p===m||s(p,m,t,i,n))){d=!1;break}}return n.delete(r),n.delete(e),d}var kZ=Tze,Eze=Qa,Aze=Eze.Uint8Array,Cze=Aze;function Pze(r){var e=-1,t=Array(r.size);return r.forEach(function(i,s){t[++e]=[s,i]}),t}var Ize=Pze;function Mze(r){var e=-1,t=Array(r.size);return r.forEach(function(i){t[++e]=i}),t}var RN=Mze,B4=$y,U4=Cze,Rze=gN,Dze=kZ,Lze=Ize,Oze=RN,Nze=1,kze=2,Fze="[object Boolean]",Bze="[object Date]",Uze="[object Error]",zze="[object Map]",Vze="[object Number]",jze="[object RegExp]",$ze="[object Set]",Hze="[object String]",Gze="[object Symbol]",Wze="[object ArrayBuffer]",Xze="[object DataView]",z4=B4?B4.prototype:void 0,yP=z4?z4.valueOf:void 0;function qze(r,e,t,i,s,n,a){switch(t){case Xze:if(r.byteLength!=e.byteLength||r.byteOffset!=e.byteOffset)return!1;r=r.buffer,e=e.buffer;case Wze:return!(r.byteLength!=e.byteLength||!n(new U4(r),new U4(e)));case Fze:case Bze:case Vze:return Rze(+r,+e);case Uze:return r.name==e.name&&r.message==e.message;case jze:case Hze:return r==e+"";case zze:var o=Lze;case $ze:var l=i&Nze;if(o||(o=Oze),r.size!=e.size&&!l)return!1;var c=a.get(r);if(c)return c==e;i|=kze,a.set(r,e);var u=Dze(o(r),o(e),i,s,n,a);return a.delete(r),u;case Gze:if(yP)return yP.call(r)==yP.call(e)}return!1}var Yze=qze;function Kze(r,e){for(var t=-1,i=e.length,s=r.length;++t<i;)r[s+t]=e[t];return r}var FZ=Kze,Zze=FZ,Qze=ss;function Jze(r,e,t){var i=e(r);return Qze(r)?i:Zze(i,t(r))}var eVe=Jze;function tVe(r,e){for(var t=-1,i=r==null?0:r.length,s=0,n=[];++t<i;){var a=r[t];e(a,t,r)&&(n[s++]=a)}return n}var iVe=tVe;function rVe(){return[]}var sVe=rVe,nVe=iVe,aVe=sVe,oVe=Object.prototype,lVe=oVe.propertyIsEnumerable,V4=Object.getOwnPropertySymbols,cVe=V4?function(r){return r==null?[]:(r=Object(r),nVe(V4(r),function(e){return lVe.call(r,e)}))}:aVe,uVe=cVe;function hVe(r,e){for(var t=-1,i=Array(r);++t<r;)i[t]=e(t);return i}var dVe=hVe,fVe=ol,pVe=ll,mVe="[object Arguments]";function gVe(r){return pVe(r)&&fVe(r)==mVe}var _Ve=gVe,j4=_Ve,vVe=ll,BZ=Object.prototype,yVe=BZ.hasOwnProperty,SVe=BZ.propertyIsEnumerable,xVe=j4(function(){return arguments}())?j4:function(r){return vVe(r)&&yVe.call(r,"callee")&&!SVe.call(r,"callee")},DN=xVe,ow={exports:{}};function bVe(){return!1}var wVe=bVe;ow.exports;(function(r,e){var t=Qa,i=wVe,s=e&&!e.nodeType&&e,n=s&&!0&&r&&!r.nodeType&&r,a=n&&n.exports===s,o=a?t.Buffer:void 0,l=o?o.isBuffer:void 0,c=l||i;r.exports=c})(ow,ow.exports);var UZ=ow.exports,TVe=9007199254740991,EVe=/^(?:0|[1-9]\d*)$/;function AVe(r,e){var t=typeof r;return e=e??TVe,!!e&&(t=="number"||t!="symbol"&&EVe.test(r))&&r>-1&&r%1==0&&r<e}var LN=AVe,CVe=9007199254740991;function PVe(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=CVe}var ON=PVe,IVe=ol,MVe=ON,RVe=ll,DVe="[object Arguments]",LVe="[object Array]",OVe="[object Boolean]",NVe="[object Date]",kVe="[object Error]",FVe="[object Function]",BVe="[object Map]",UVe="[object Number]",zVe="[object Object]",VVe="[object RegExp]",jVe="[object Set]",$Ve="[object String]",HVe="[object WeakMap]",GVe="[object ArrayBuffer]",WVe="[object DataView]",XVe="[object Float32Array]",qVe="[object Float64Array]",YVe="[object Int8Array]",KVe="[object Int16Array]",ZVe="[object Int32Array]",QVe="[object Uint8Array]",JVe="[object Uint8ClampedArray]",e4e="[object Uint16Array]",t4e="[object Uint32Array]",zt={};zt[XVe]=zt[qVe]=zt[YVe]=zt[KVe]=zt[ZVe]=zt[QVe]=zt[JVe]=zt[e4e]=zt[t4e]=!0;zt[DVe]=zt[LVe]=zt[GVe]=zt[OVe]=zt[WVe]=zt[NVe]=zt[kVe]=zt[FVe]=zt[BVe]=zt[UVe]=zt[zVe]=zt[VVe]=zt[jVe]=zt[$Ve]=zt[HVe]=!1;function i4e(r){return RVe(r)&&MVe(r.length)&&!!zt[IVe(r)]}var r4e=i4e;function s4e(r){return function(e){return r(e)}}var zZ=s4e,lw={exports:{}};lw.exports;(function(r,e){var t=q7,i=e&&!e.nodeType&&e,s=i&&!0&&r&&!r.nodeType&&r,n=s&&s.exports===i,a=n&&t.process,o=function(){try{var l=s&&s.require&&s.require("util").types;return l||a&&a.binding&&a.binding("util")}catch{}}();r.exports=o})(lw,lw.exports);var n4e=lw.exports,a4e=r4e,o4e=zZ,$4=n4e,H4=$4&&$4.isTypedArray,l4e=H4?o4e(H4):a4e,VZ=l4e,c4e=dVe,u4e=DN,h4e=ss,d4e=UZ,f4e=LN,p4e=VZ,m4e=Object.prototype,g4e=m4e.hasOwnProperty;function _4e(r,e){var t=h4e(r),i=!t&&u4e(r),s=!t&&!i&&d4e(r),n=!t&&!i&&!s&&p4e(r),a=t||i||s||n,o=a?c4e(r.length,String):[],l=o.length;for(var c in r)(e||g4e.call(r,c))&&!(a&&(c=="length"||s&&(c=="offset"||c=="parent")||n&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||f4e(c,l)))&&o.push(c);return o}var v4e=_4e,y4e=Object.prototype;function S4e(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||y4e;return r===t}var x4e=S4e;function b4e(r,e){return function(t){return r(e(t))}}var jZ=b4e,w4e=jZ,T4e=w4e(Object.keys,Object),E4e=T4e,A4e=x4e,C4e=E4e,P4e=Object.prototype,I4e=P4e.hasOwnProperty;function M4e(r){if(!A4e(r))return C4e(r);var e=[];for(var t in Object(r))I4e.call(r,t)&&t!="constructor"&&e.push(t);return e}var R4e=M4e,D4e=mN,L4e=ON;function O4e(r){return r!=null&&L4e(r.length)&&!D4e(r)}var MA=O4e,N4e=v4e,k4e=R4e,F4e=MA;function B4e(r){return F4e(r)?N4e(r):k4e(r)}var NN=B4e,U4e=eVe,z4e=uVe,V4e=NN;function j4e(r){return U4e(r,V4e,z4e)}var $4e=j4e,G4=$4e,H4e=1,G4e=Object.prototype,W4e=G4e.hasOwnProperty;function X4e(r,e,t,i,s,n){var a=t&H4e,o=G4(r),l=o.length,c=G4(e),u=c.length;if(l!=u&&!a)return!1;for(var h=l;h--;){var d=o[h];if(!(a?d in e:W4e.call(e,d)))return!1}var f=n.get(r),p=n.get(e);if(f&&p)return f==e&&p==r;var m=!0;n.set(r,e),n.set(e,r);for(var g=a;++h<l;){d=o[h];var _=r[d],v=e[d];if(i)var y=a?i(v,_,d,e,r,n):i(_,v,d,r,e,n);if(!(y===void 0?_===v||s(_,v,t,i,n):y)){m=!1;break}g||(g=d=="constructor")}if(m&&!g){var x=r.constructor,S=e.constructor;x!=S&&"constructor"in r&&"constructor"in e&&!(typeof x=="function"&&x instanceof x&&typeof S=="function"&&S instanceof S)&&(m=!1)}return n.delete(r),n.delete(e),m}var q4e=X4e,Y4e=Bh,K4e=Qa,Z4e=Y4e(K4e,"DataView"),Q4e=Z4e,J4e=Bh,eje=Qa,tje=J4e(eje,"Promise"),ije=tje,rje=Bh,sje=Qa,nje=rje(sje,"Set"),$Z=nje,aje=Bh,oje=Qa,lje=aje(oje,"WeakMap"),cje=lje,xR=Q4e,bR=_N,wR=ije,TR=$Z,ER=cje,HZ=ol,Em=K7,W4="[object Map]",uje="[object Object]",X4="[object Promise]",q4="[object Set]",Y4="[object WeakMap]",K4="[object DataView]",hje=Em(xR),dje=Em(bR),fje=Em(wR),pje=Em(TR),mje=Em(ER),cu=HZ;(xR&&cu(new xR(new ArrayBuffer(1)))!=K4||bR&&cu(new bR)!=W4||wR&&cu(wR.resolve())!=X4||TR&&cu(new TR)!=q4||ER&&cu(new ER)!=Y4)&&(cu=function(r){var e=HZ(r),t=e==uje?r.constructor:void 0,i=t?Em(t):"";if(i)switch(i){case hje:return K4;case dje:return W4;case fje:return X4;case pje:return q4;case mje:return Y4}return e});var gje=cu,SP=DZ,_je=kZ,vje=Yze,yje=q4e,Z4=gje,Q4=ss,J4=UZ,Sje=VZ,xje=1,ej="[object Arguments]",tj="[object Array]",AS="[object Object]",bje=Object.prototype,ij=bje.hasOwnProperty;function wje(r,e,t,i,s,n){var a=Q4(r),o=Q4(e),l=a?tj:Z4(r),c=o?tj:Z4(e);l=l==ej?AS:l,c=c==ej?AS:c;var u=l==AS,h=c==AS,d=l==c;if(d&&J4(r)){if(!J4(e))return!1;a=!0,u=!1}if(d&&!u)return n||(n=new SP),a||Sje(r)?_je(r,e,t,i,s,n):vje(r,e,l,t,i,s,n);if(!(t&xje)){var f=u&&ij.call(r,"__wrapped__"),p=h&&ij.call(e,"__wrapped__");if(f||p){var m=f?r.value():r,g=p?e.value():e;return n||(n=new SP),s(m,g,t,i,n)}}return d?(n||(n=new SP),yje(r,e,t,i,s,n)):!1}var Tje=wje,Eje=Tje,rj=ll;function GZ(r,e,t,i,s){return r===e?!0:r==null||e==null||!rj(r)&&!rj(e)?r!==r&&e!==e:Eje(r,e,t,i,GZ,s)}var kN=GZ,Aje=DZ,Cje=kN,Pje=1,Ije=2;function Mje(r,e,t,i){var s=t.length,n=s,a=!i;if(r==null)return!n;for(r=Object(r);s--;){var o=t[s];if(a&&o[2]?o[1]!==r[o[0]]:!(o[0]in r))return!1}for(;++s<n;){o=t[s];var l=o[0],c=r[l],u=o[1];if(a&&o[2]){if(c===void 0&&!(l in r))return!1}else{var h=new Aje;if(i)var d=i(c,u,l,r,e,h);if(!(d===void 0?Cje(u,c,Pje|Ije,i,h):d))return!1}}return!0}var Rje=Mje,Dje=kc;function Lje(r){return r===r&&!Dje(r)}var WZ=Lje,Oje=WZ,Nje=NN;function kje(r){for(var e=Nje(r),t=e.length;t--;){var i=e[t],s=r[i];e[t]=[i,s,Oje(s)]}return e}var Fje=kje;function Bje(r,e){return function(t){return t==null?!1:t[r]===e&&(e!==void 0||r in Object(t))}}var XZ=Bje,Uje=Rje,zje=Fje,Vje=XZ;function jje(r){var e=zje(r);return e.length==1&&e[0][2]?Vje(e[0][0],e[0][1]):function(t){return t===r||Uje(t,r,e)}}var $je=jje;function Hje(r,e){return r!=null&&e in Object(r)}var Gje=Hje,Wje=tZ,Xje=DN,qje=ss,Yje=LN,Kje=ON,Zje=mA;function Qje(r,e,t){e=Wje(e,r);for(var i=-1,s=e.length,n=!1;++i<s;){var a=Zje(e[i]);if(!(n=r!=null&&t(r,a)))break;r=r[a]}return n||++i!=s?n:(s=r==null?0:r.length,!!s&&Kje(s)&&Yje(a,s)&&(qje(r)||Xje(r)))}var Jje=Qje,e$e=Gje,t$e=Jje;function i$e(r,e){return r!=null&&t$e(r,e,e$e)}var r$e=i$e,s$e=kN,n$e=iZ,a$e=r$e,o$e=pN,l$e=WZ,c$e=XZ,u$e=mA,h$e=1,d$e=2;function f$e(r,e){return o$e(r)&&l$e(e)?c$e(u$e(r),e):function(t){var i=n$e(t,r);return i===void 0&&i===e?a$e(t,r):s$e(e,i,h$e|d$e)}}var p$e=f$e;function m$e(r){return r}var Am=m$e;function g$e(r){return function(e){return e==null?void 0:e[r]}}var _$e=g$e,v$e=xN;function y$e(r){return function(e){return v$e(e,r)}}var S$e=y$e,x$e=_$e,b$e=S$e,w$e=pN,T$e=mA;function E$e(r){return w$e(r)?x$e(T$e(r)):b$e(r)}var A$e=E$e,C$e=$je,P$e=p$e,I$e=Am,M$e=ss,R$e=A$e;function D$e(r){return typeof r=="function"?r:r==null?I$e:typeof r=="object"?M$e(r)?P$e(r[0],r[1]):C$e(r):R$e(r)}var Fc=D$e;function L$e(r,e,t,i){for(var s=r.length,n=t+(i?1:-1);i?n--:++n<s;)if(e(r[n],n,r))return n;return-1}var O$e=L$e;function N$e(r){return r!==r}var k$e=N$e;function F$e(r,e,t){for(var i=t-1,s=r.length;++i<s;)if(r[i]===e)return i;return-1}var B$e=F$e,U$e=O$e,z$e=k$e,V$e=B$e;function j$e(r,e,t){return e===e?V$e(r,e,t):U$e(r,z$e,t)}var $$e=j$e,H$e=$$e;function G$e(r,e){var t=r==null?0:r.length;return!!t&&H$e(r,e,0)>-1}var W$e=G$e;function X$e(r,e,t){for(var i=-1,s=r==null?0:r.length;++i<s;)if(t(e,r[i]))return!0;return!1}var q$e=X$e;function Y$e(){}var K$e=Y$e,xP=$Z,Z$e=K$e,Q$e=RN,J$e=1/0,e5e=xP&&1/Q$e(new xP([,-0]))[1]==J$e?function(r){return new xP(r)}:Z$e,t5e=e5e,i5e=LZ,r5e=W$e,s5e=q$e,n5e=NZ,a5e=t5e,o5e=RN,l5e=200;function c5e(r,e,t){var i=-1,s=r5e,n=r.length,a=!0,o=[],l=o;if(t)a=!1,s=s5e;else if(n>=l5e){var c=e?null:a5e(r);if(c)return o5e(c);a=!1,s=n5e,l=new i5e}else l=e?[]:o;e:for(;++i<n;){var u=r[i],h=e?e(u):u;if(u=t||u!==0?u:0,a&&h===h){for(var d=l.length;d--;)if(l[d]===h)continue e;e&&l.push(h),o.push(u)}else s(l,h,t)||(l!==o&&l.push(h),o.push(u))}return o}var u5e=c5e,h5e=Fc,d5e=u5e;function f5e(r,e){return r&&r.length?d5e(r,h5e(e)):[]}var p5e=f5e;const sj=pt(p5e);function qZ(r,e,t){return e===!0?sj(r,t):Ce(e)?sj(r,e):r}function Ip(r){"@babel/helpers - typeof";return Ip=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ip(r)}var m5e=["ref"];function nj(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function po(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?nj(Object(t),!0).forEach(function(i){RA(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):nj(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function g5e(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function aj(r,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,KZ(i.key),i)}}function _5e(r,e,t){return e&&aj(r.prototype,e),t&&aj(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}function v5e(r,e,t){return e=cw(e),y5e(r,YZ()?Reflect.construct(e,t||[],cw(r).constructor):e.apply(r,t))}function y5e(r,e){if(e&&(Ip(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return S5e(r)}function S5e(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function YZ(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(YZ=function(){return!!r})()}function cw(r){return cw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},cw(r)}function x5e(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&AR(r,e)}function AR(r,e){return AR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},AR(r,e)}function RA(r,e,t){return e=KZ(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function KZ(r){var e=b5e(r,"string");return Ip(e)=="symbol"?e:e+""}function b5e(r,e){if(Ip(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Ip(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function w5e(r,e){if(r==null)return{};var t=T5e(r,e),i,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(r,i)&&(t[i]=r[i])}return t}function T5e(r,e){if(r==null)return{};var t={};for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(e.indexOf(i)>=0)continue;t[i]=r[i]}return t}function E5e(r){return r.value}function A5e(r,e){if(U.isValidElement(r))return U.cloneElement(r,e);if(typeof r=="function")return U.createElement(r,e);e.ref;var t=w5e(e,m5e);return U.createElement(MN,t)}var oj=1,Bf=function(r){function e(){var t;g5e(this,e);for(var i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return t=v5e(this,e,[].concat(s)),RA(t,"lastBoundingBox",{width:-1,height:-1}),t}return x5e(e,r),_5e(e,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var i=this.wrapperNode.getBoundingClientRect();return i.height=this.wrapperNode.offsetHeight,i.width=this.wrapperNode.offsetWidth,i}return null}},{key:"updateBBox",value:function(){var i=this.props.onBBoxUpdate,s=this.getBBox();s?(Math.abs(s.width-this.lastBoundingBox.width)>oj||Math.abs(s.height-this.lastBoundingBox.height)>oj)&&(this.lastBoundingBox.width=s.width,this.lastBoundingBox.height=s.height,i&&i(s)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,i&&i(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?po({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(i){var s=this.props,n=s.layout,a=s.align,o=s.verticalAlign,l=s.margin,c=s.chartWidth,u=s.chartHeight,h,d;if(!i||(i.left===void 0||i.left===null)&&(i.right===void 0||i.right===null))if(a==="center"&&n==="vertical"){var f=this.getBBoxSnapshot();h={left:((c||0)-f.width)/2}}else h=a==="right"?{right:l&&l.right||0}:{left:l&&l.left||0};if(!i||(i.top===void 0||i.top===null)&&(i.bottom===void 0||i.bottom===null))if(o==="middle"){var p=this.getBBoxSnapshot();d={top:((u||0)-p.height)/2}}else d=o==="bottom"?{bottom:l&&l.bottom||0}:{top:l&&l.top||0};return po(po({},h),d)}},{key:"render",value:function(){var i=this,s=this.props,n=s.content,a=s.width,o=s.height,l=s.wrapperStyle,c=s.payloadUniqBy,u=s.payload,h=po(po({position:"absolute",width:a||"auto",height:o||"auto"},this.getDefaultPosition(l)),l);return U.createElement("div",{className:"recharts-legend-wrapper",style:h,ref:function(f){i.wrapperNode=f}},A5e(n,po(po({},this.props),{},{payload:qZ(u,c,E5e)})))}}],[{key:"getWithHeight",value:function(i,s){var n=po(po({},this.defaultProps),i.props),a=n.layout;return a==="vertical"&&oe(i.props.height)?{height:i.props.height}:a==="horizontal"?{width:i.props.width||s}:null}}])}(E.PureComponent);RA(Bf,"displayName","Legend");RA(Bf,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var lj=$y,C5e=DN,P5e=ss,cj=lj?lj.isConcatSpreadable:void 0;function I5e(r){return P5e(r)||C5e(r)||!!(cj&&r&&r[cj])}var M5e=I5e,R5e=FZ,D5e=M5e;function ZZ(r,e,t,i,s){var n=-1,a=r.length;for(t||(t=D5e),s||(s=[]);++n<a;){var o=r[n];e>0&&t(o)?e>1?ZZ(o,e-1,t,i,s):R5e(s,o):i||(s[s.length]=o)}return s}var QZ=ZZ;function L5e(r){return function(e,t,i){for(var s=-1,n=Object(e),a=i(e),o=a.length;o--;){var l=a[r?o:++s];if(t(n[l],l,n)===!1)break}return e}}var O5e=L5e,N5e=O5e,k5e=N5e(),F5e=k5e,B5e=F5e,U5e=NN;function z5e(r,e){return r&&B5e(r,e,U5e)}var JZ=z5e,V5e=MA;function j5e(r,e){return function(t,i){if(t==null)return t;if(!V5e(t))return r(t,i);for(var s=t.length,n=e?s:-1,a=Object(t);(e?n--:++n<s)&&i(a[n],n,a)!==!1;);return t}}var $5e=j5e,H5e=JZ,G5e=$5e,W5e=G5e(H5e),FN=W5e,X5e=FN,q5e=MA;function Y5e(r,e){var t=-1,i=q5e(r)?Array(r.length):[];return X5e(r,function(s,n,a){i[++t]=e(s,n,a)}),i}var eQ=Y5e;function K5e(r,e){var t=r.length;for(r.sort(e);t--;)r[t]=r[t].value;return r}var Z5e=K5e,uj=vm;function Q5e(r,e){if(r!==e){var t=r!==void 0,i=r===null,s=r===r,n=uj(r),a=e!==void 0,o=e===null,l=e===e,c=uj(e);if(!o&&!c&&!n&&r>e||n&&a&&l&&!o&&!c||i&&a&&l||!t&&l||!s)return 1;if(!i&&!n&&!c&&r<e||c&&t&&s&&!i&&!n||o&&t&&s||!a&&s||!l)return-1}return 0}var J5e=Q5e,eHe=J5e;function tHe(r,e,t){for(var i=-1,s=r.criteria,n=e.criteria,a=s.length,o=t.length;++i<a;){var l=eHe(s[i],n[i]);if(l){if(i>=o)return l;var c=t[i];return l*(c=="desc"?-1:1)}}return r.index-e.index}var iHe=tHe,bP=SN,rHe=xN,sHe=Fc,nHe=eQ,aHe=Z5e,oHe=zZ,lHe=iHe,cHe=Am,uHe=ss;function hHe(r,e,t){e.length?e=bP(e,function(n){return uHe(n)?function(a){return rHe(a,n.length===1?n[0]:n)}:n}):e=[cHe];var i=-1;e=bP(e,oHe(sHe));var s=nHe(r,function(n,a,o){var l=bP(e,function(c){return c(n)});return{criteria:l,index:++i,value:n}});return aHe(s,function(n,a){return lHe(n,a,t)})}var dHe=hHe;function fHe(r,e,t){switch(t.length){case 0:return r.call(e);case 1:return r.call(e,t[0]);case 2:return r.call(e,t[0],t[1]);case 3:return r.call(e,t[0],t[1],t[2])}return r.apply(e,t)}var pHe=fHe,mHe=pHe,hj=Math.max;function gHe(r,e,t){return e=hj(e===void 0?r.length-1:e,0),function(){for(var i=arguments,s=-1,n=hj(i.length-e,0),a=Array(n);++s<n;)a[s]=i[e+s];s=-1;for(var o=Array(e+1);++s<e;)o[s]=i[s];return o[e]=t(a),mHe(r,this,o)}}var _He=gHe;function vHe(r){return function(){return r}}var yHe=vHe,SHe=Bh,xHe=function(){try{var r=SHe(Object,"defineProperty");return r({},"",{}),r}catch{}}(),tQ=xHe,bHe=yHe,dj=tQ,wHe=Am,THe=dj?function(r,e){return dj(r,"toString",{configurable:!0,enumerable:!1,value:bHe(e),writable:!0})}:wHe,EHe=THe,AHe=800,CHe=16,PHe=Date.now;function IHe(r){var e=0,t=0;return function(){var i=PHe(),s=CHe-(i-t);if(t=i,s>0){if(++e>=AHe)return arguments[0]}else e=0;return r.apply(void 0,arguments)}}var MHe=IHe,RHe=EHe,DHe=MHe,LHe=DHe(RHe),OHe=LHe,NHe=Am,kHe=_He,FHe=OHe;function BHe(r,e){return FHe(kHe(r,e,NHe),r+"")}var UHe=BHe,zHe=gN,VHe=MA,jHe=LN,$He=kc;function HHe(r,e,t){if(!$He(t))return!1;var i=typeof e;return(i=="number"?VHe(t)&&jHe(e,t.length):i=="string"&&e in t)?zHe(t[e],r):!1}var DA=HHe,GHe=QZ,WHe=dHe,XHe=UHe,fj=DA,qHe=XHe(function(r,e){if(r==null)return[];var t=e.length;return t>1&&fj(r,e[0],e[1])?e=[]:t>2&&fj(e[0],e[1],e[2])&&(e=[e[0]]),WHe(r,GHe(e,1),[])}),YHe=qHe;const BN=pt(YHe);function yv(r){"@babel/helpers - typeof";return yv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yv(r)}function CR(){return CR=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},CR.apply(this,arguments)}function KHe(r,e){return eGe(r)||JHe(r,e)||QHe(r,e)||ZHe()}function ZHe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function QHe(r,e){if(r){if(typeof r=="string")return pj(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return pj(r,e)}}function pj(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=r[t];return i}function JHe(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var i,s,n,a,o=[],l=!0,c=!1;try{if(n=(t=t.call(r)).next,e!==0)for(;!(l=(i=n.call(t)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(u){c=!0,s=u}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(c)throw s}}return o}}function eGe(r){if(Array.isArray(r))return r}function mj(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function wP(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?mj(Object(t),!0).forEach(function(i){tGe(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):mj(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function tGe(r,e,t){return e=iGe(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function iGe(r){var e=rGe(r,"string");return yv(e)=="symbol"?e:e+""}function rGe(r,e){if(yv(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(yv(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function sGe(r){return Array.isArray(r)&&Ui(r[0])&&Ui(r[1])?r.join(" ~ "):r}var nGe=function(e){var t=e.separator,i=t===void 0?" : ":t,s=e.contentStyle,n=s===void 0?{}:s,a=e.itemStyle,o=a===void 0?{}:a,l=e.labelStyle,c=l===void 0?{}:l,u=e.payload,h=e.formatter,d=e.itemSorter,f=e.wrapperClassName,p=e.labelClassName,m=e.label,g=e.labelFormatter,_=e.accessibilityLayer,v=_===void 0?!1:_,y=function(){if(u&&u.length){var M={padding:0,margin:0},N=(d?BN(u,d):u).map(function(k,V){if(k.type==="none")return null;var B=wP({display:"block",paddingTop:4,paddingBottom:4,color:k.color||"#000"},o),R=k.formatter||h||sGe,L=k.value,D=k.name,F=L,j=D;if(R&&F!=null&&j!=null){var z=R(L,D,k,V,u);if(Array.isArray(z)){var $=KHe(z,2);F=$[0],j=$[1]}else F=z}return U.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(V),style:B},Ui(j)?U.createElement("span",{className:"recharts-tooltip-item-name"},j):null,Ui(j)?U.createElement("span",{className:"recharts-tooltip-item-separator"},i):null,U.createElement("span",{className:"recharts-tooltip-item-value"},F),U.createElement("span",{className:"recharts-tooltip-item-unit"},k.unit||""))});return U.createElement("ul",{className:"recharts-tooltip-item-list",style:M},N)}return null},x=wP({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},n),S=wP({margin:0},c),w=!Pe(m),T=w?m:"",A=Re("recharts-default-tooltip",f),C=Re("recharts-tooltip-label",p);w&&g&&u!==void 0&&u!==null&&(T=g(m,u));var P=v?{role:"status","aria-live":"assertive"}:{};return U.createElement("div",CR({className:A,style:x},P),U.createElement("p",{className:C,style:S},U.isValidElement(T)?T:"".concat(T)),y())};function Sv(r){"@babel/helpers - typeof";return Sv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Sv(r)}function CS(r,e,t){return e=aGe(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function aGe(r){var e=oGe(r,"string");return Sv(e)=="symbol"?e:e+""}function oGe(r,e){if(Sv(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Sv(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}var fg="recharts-tooltip-wrapper",lGe={visibility:"hidden"};function cGe(r){var e=r.coordinate,t=r.translateX,i=r.translateY;return Re(fg,CS(CS(CS(CS({},"".concat(fg,"-right"),oe(t)&&e&&oe(e.x)&&t>=e.x),"".concat(fg,"-left"),oe(t)&&e&&oe(e.x)&&t<e.x),"".concat(fg,"-bottom"),oe(i)&&e&&oe(e.y)&&i>=e.y),"".concat(fg,"-top"),oe(i)&&e&&oe(e.y)&&i<e.y))}function gj(r){var e=r.allowEscapeViewBox,t=r.coordinate,i=r.key,s=r.offsetTopLeft,n=r.position,a=r.reverseDirection,o=r.tooltipDimension,l=r.viewBox,c=r.viewBoxDimension;if(n&&oe(n[i]))return n[i];var u=t[i]-o-s,h=t[i]+s;if(e[i])return a[i]?u:h;if(a[i]){var d=u,f=l[i];return d<f?Math.max(h,l[i]):Math.max(u,l[i])}var p=h+o,m=l[i]+c;return p>m?Math.max(u,l[i]):Math.max(h,l[i])}function uGe(r){var e=r.translateX,t=r.translateY,i=r.useTranslate3d;return{transform:i?"translate3d(".concat(e,"px, ").concat(t,"px, 0)"):"translate(".concat(e,"px, ").concat(t,"px)")}}function hGe(r){var e=r.allowEscapeViewBox,t=r.coordinate,i=r.offsetTopLeft,s=r.position,n=r.reverseDirection,a=r.tooltipBox,o=r.useTranslate3d,l=r.viewBox,c,u,h;return a.height>0&&a.width>0&&t?(u=gj({allowEscapeViewBox:e,coordinate:t,key:"x",offsetTopLeft:i,position:s,reverseDirection:n,tooltipDimension:a.width,viewBox:l,viewBoxDimension:l.width}),h=gj({allowEscapeViewBox:e,coordinate:t,key:"y",offsetTopLeft:i,position:s,reverseDirection:n,tooltipDimension:a.height,viewBox:l,viewBoxDimension:l.height}),c=uGe({translateX:u,translateY:h,useTranslate3d:o})):c=lGe,{cssProperties:c,cssClasses:cGe({translateX:u,translateY:h,coordinate:t})}}function Mp(r){"@babel/helpers - typeof";return Mp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mp(r)}function _j(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function vj(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?_j(Object(t),!0).forEach(function(i){IR(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):_j(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function dGe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function fGe(r,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,rQ(i.key),i)}}function pGe(r,e,t){return e&&fGe(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function mGe(r,e,t){return e=uw(e),gGe(r,iQ()?Reflect.construct(e,t||[],uw(r).constructor):e.apply(r,t))}function gGe(r,e){if(e&&(Mp(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _Ge(r)}function _Ge(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function iQ(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(iQ=function(){return!!r})()}function uw(r){return uw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},uw(r)}function vGe(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&PR(r,e)}function PR(r,e){return PR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},PR(r,e)}function IR(r,e,t){return e=rQ(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function rQ(r){var e=yGe(r,"string");return Mp(e)=="symbol"?e:e+""}function yGe(r,e){if(Mp(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Mp(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var yj=1,SGe=function(r){function e(){var t;dGe(this,e);for(var i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return t=mGe(this,e,[].concat(s)),IR(t,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),IR(t,"handleKeyDown",function(a){if(a.key==="Escape"){var o,l,c,u;t.setState({dismissed:!0,dismissedAtCoordinate:{x:(o=(l=t.props.coordinate)===null||l===void 0?void 0:l.x)!==null&&o!==void 0?o:0,y:(c=(u=t.props.coordinate)===null||u===void 0?void 0:u.y)!==null&&c!==void 0?c:0}})}}),t}return vGe(e,r),pGe(e,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var i=this.wrapperNode.getBoundingClientRect();(Math.abs(i.width-this.state.lastBoundingBox.width)>yj||Math.abs(i.height-this.state.lastBoundingBox.height)>yj)&&this.setState({lastBoundingBox:{width:i.width,height:i.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var i,s;this.props.active&&this.updateBBox(),this.state.dismissed&&(((i=this.props.coordinate)===null||i===void 0?void 0:i.x)!==this.state.dismissedAtCoordinate.x||((s=this.props.coordinate)===null||s===void 0?void 0:s.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var i=this,s=this.props,n=s.active,a=s.allowEscapeViewBox,o=s.animationDuration,l=s.animationEasing,c=s.children,u=s.coordinate,h=s.hasPayload,d=s.isAnimationActive,f=s.offset,p=s.position,m=s.reverseDirection,g=s.useTranslate3d,_=s.viewBox,v=s.wrapperStyle,y=hGe({allowEscapeViewBox:a,coordinate:u,offsetTopLeft:f,position:p,reverseDirection:m,tooltipBox:this.state.lastBoundingBox,useTranslate3d:g,viewBox:_}),x=y.cssClasses,S=y.cssProperties,w=vj(vj({transition:d&&n?"transform ".concat(o,"ms ").concat(l):void 0},S),{},{pointerEvents:"none",visibility:!this.state.dismissed&&n&&h?"visible":"hidden",position:"absolute",top:0,left:0},v);return U.createElement("div",{tabIndex:-1,className:x,style:w,ref:function(A){i.wrapperNode=A}},c)}}])}(E.PureComponent),xGe=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},Uh={isSsr:xGe()};function Rp(r){"@babel/helpers - typeof";return Rp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Rp(r)}function Sj(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function xj(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Sj(Object(t),!0).forEach(function(i){UN(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Sj(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function bGe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function wGe(r,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,nQ(i.key),i)}}function TGe(r,e,t){return e&&wGe(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function EGe(r,e,t){return e=hw(e),AGe(r,sQ()?Reflect.construct(e,t||[],hw(r).constructor):e.apply(r,t))}function AGe(r,e){if(e&&(Rp(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return CGe(r)}function CGe(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function sQ(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(sQ=function(){return!!r})()}function hw(r){return hw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},hw(r)}function PGe(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&MR(r,e)}function MR(r,e){return MR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},MR(r,e)}function UN(r,e,t){return e=nQ(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function nQ(r){var e=IGe(r,"string");return Rp(e)=="symbol"?e:e+""}function IGe(r,e){if(Rp(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Rp(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function MGe(r){return r.dataKey}function RGe(r,e){return U.isValidElement(r)?U.cloneElement(r,e):typeof r=="function"?U.createElement(r,e):U.createElement(nGe,e)}var va=function(r){function e(){return bGe(this,e),EGe(this,e,arguments)}return PGe(e,r),TGe(e,[{key:"render",value:function(){var i=this,s=this.props,n=s.active,a=s.allowEscapeViewBox,o=s.animationDuration,l=s.animationEasing,c=s.content,u=s.coordinate,h=s.filterNull,d=s.isAnimationActive,f=s.offset,p=s.payload,m=s.payloadUniqBy,g=s.position,_=s.reverseDirection,v=s.useTranslate3d,y=s.viewBox,x=s.wrapperStyle,S=p??[];h&&S.length&&(S=qZ(p.filter(function(T){return T.value!=null&&(T.hide!==!0||i.props.includeHidden)}),m,MGe));var w=S.length>0;return U.createElement(SGe,{allowEscapeViewBox:a,animationDuration:o,animationEasing:l,isAnimationActive:d,active:n,coordinate:u,hasPayload:w,offset:f,position:g,reverseDirection:_,useTranslate3d:v,viewBox:y,wrapperStyle:x},RGe(c,xj(xj({},this.props),{},{payload:S})))}}])}(E.PureComponent);UN(va,"displayName","Tooltip");UN(va,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!Uh.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var DGe=Qa,LGe=function(){return DGe.Date.now()},OGe=LGe,NGe=/\s/;function kGe(r){for(var e=r.length;e--&&NGe.test(r.charAt(e)););return e}var FGe=kGe,BGe=FGe,UGe=/^\s+/;function zGe(r){return r&&r.slice(0,BGe(r)+1).replace(UGe,"")}var VGe=zGe,jGe=VGe,bj=kc,$Ge=vm,wj=NaN,HGe=/^[-+]0x[0-9a-f]+$/i,GGe=/^0b[01]+$/i,WGe=/^0o[0-7]+$/i,XGe=parseInt;function qGe(r){if(typeof r=="number")return r;if($Ge(r))return wj;if(bj(r)){var e=typeof r.valueOf=="function"?r.valueOf():r;r=bj(e)?e+"":e}if(typeof r!="string")return r===0?r:+r;r=jGe(r);var t=GGe.test(r);return t||WGe.test(r)?XGe(r.slice(2),t?2:8):HGe.test(r)?wj:+r}var aQ=qGe,YGe=kc,TP=OGe,Tj=aQ,KGe="Expected a function",ZGe=Math.max,QGe=Math.min;function JGe(r,e,t){var i,s,n,a,o,l,c=0,u=!1,h=!1,d=!0;if(typeof r!="function")throw new TypeError(KGe);e=Tj(e)||0,YGe(t)&&(u=!!t.leading,h="maxWait"in t,n=h?ZGe(Tj(t.maxWait)||0,e):n,d="trailing"in t?!!t.trailing:d);function f(w){var T=i,A=s;return i=s=void 0,c=w,a=r.apply(A,T),a}function p(w){return c=w,o=setTimeout(_,e),u?f(w):a}function m(w){var T=w-l,A=w-c,C=e-T;return h?QGe(C,n-A):C}function g(w){var T=w-l,A=w-c;return l===void 0||T>=e||T<0||h&&A>=n}function _(){var w=TP();if(g(w))return v(w);o=setTimeout(_,m(w))}function v(w){return o=void 0,d&&i?f(w):(i=s=void 0,a)}function y(){o!==void 0&&clearTimeout(o),c=0,i=l=s=o=void 0}function x(){return o===void 0?a:v(TP())}function S(){var w=TP(),T=g(w);if(i=arguments,s=this,l=w,T){if(o===void 0)return p(l);if(h)return clearTimeout(o),o=setTimeout(_,e),f(l)}return o===void 0&&(o=setTimeout(_,e)),a}return S.cancel=y,S.flush=x,S}var eWe=JGe,tWe=eWe,iWe=kc,rWe="Expected a function";function sWe(r,e,t){var i=!0,s=!0;if(typeof r!="function")throw new TypeError(rWe);return iWe(t)&&(i="leading"in t?!!t.leading:i,s="trailing"in t?!!t.trailing:s),tWe(r,e,{leading:i,maxWait:e,trailing:s})}var nWe=sWe;const oQ=pt(nWe);function xv(r){"@babel/helpers - typeof";return xv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xv(r)}function Ej(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function PS(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ej(Object(t),!0).forEach(function(i){aWe(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Ej(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function aWe(r,e,t){return e=oWe(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function oWe(r){var e=lWe(r,"string");return xv(e)=="symbol"?e:e+""}function lWe(r,e){if(xv(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(xv(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function cWe(r,e){return fWe(r)||dWe(r,e)||hWe(r,e)||uWe()}function uWe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hWe(r,e){if(r){if(typeof r=="string")return Aj(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Aj(r,e)}}function Aj(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=r[t];return i}function dWe(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var i,s,n,a,o=[],l=!0,c=!1;try{if(n=(t=t.call(r)).next,e!==0)for(;!(l=(i=n.call(t)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(u){c=!0,s=u}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(c)throw s}}return o}}function fWe(r){if(Array.isArray(r))return r}var vx=E.forwardRef(function(r,e){var t=r.aspect,i=r.initialDimension,s=i===void 0?{width:-1,height:-1}:i,n=r.width,a=n===void 0?"100%":n,o=r.height,l=o===void 0?"100%":o,c=r.minWidth,u=c===void 0?0:c,h=r.minHeight,d=r.maxHeight,f=r.children,p=r.debounce,m=p===void 0?0:p,g=r.id,_=r.className,v=r.onResize,y=r.style,x=y===void 0?{}:y,S=E.useRef(null),w=E.useRef();w.current=v,E.useImperativeHandle(e,function(){return Object.defineProperty(S.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),S.current},configurable:!0})});var T=E.useState({containerWidth:s.width,containerHeight:s.height}),A=cWe(T,2),C=A[0],P=A[1],I=E.useCallback(function(N,k){P(function(V){var B=Math.round(N),R=Math.round(k);return V.containerWidth===B&&V.containerHeight===R?V:{containerWidth:B,containerHeight:R}})},[]);E.useEffect(function(){var N=function(D){var F,j=D[0].contentRect,z=j.width,$=j.height;I(z,$),(F=w.current)===null||F===void 0||F.call(w,z,$)};m>0&&(N=oQ(N,m,{trailing:!0,leading:!1}));var k=new ResizeObserver(N),V=S.current.getBoundingClientRect(),B=V.width,R=V.height;return I(B,R),k.observe(S.current),function(){k.disconnect()}},[I,m]);var M=E.useMemo(function(){var N=C.containerWidth,k=C.containerHeight;if(N<0||k<0)return null;$o(Cu(a)||Cu(l),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,a,l),$o(!t||t>0,"The aspect(%s) must be greater than zero.",t);var V=Cu(a)?N:a,B=Cu(l)?k:l;t&&t>0&&(V?B=V/t:B&&(V=B*t),d&&B>d&&(B=d)),$o(V>0||B>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,V,B,a,l,u,h,t);var R=!Array.isArray(f)&&jo(f.type).endsWith("Chart");return U.Children.map(f,function(L){return U.isValidElement(L)?E.cloneElement(L,PS({width:V,height:B},R?{style:PS({height:"100%",width:"100%",maxHeight:B,maxWidth:V},L.props.style)}:{})):L})},[t,f,l,d,h,u,C,a]);return U.createElement("div",{id:g?"".concat(g):void 0,className:Re("recharts-responsive-container",_),style:PS(PS({},x),{},{width:a,height:l,minWidth:u,minHeight:h,maxHeight:d}),ref:S},M)}),LA=function(e){return null};LA.displayName="Cell";function bv(r){"@babel/helpers - typeof";return bv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bv(r)}function Cj(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function RR(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Cj(Object(t),!0).forEach(function(i){pWe(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Cj(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function pWe(r,e,t){return e=mWe(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function mWe(r){var e=gWe(r,"string");return bv(e)=="symbol"?e:e+""}function gWe(r,e){if(bv(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(bv(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}var Cd={widthCache:{},cacheCount:0},_We=2e3,vWe={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},Pj="recharts_measurement_span";function yWe(r){var e=RR({},r);return Object.keys(e).forEach(function(t){e[t]||delete e[t]}),e}var h_=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e==null||Uh.isSsr)return{width:0,height:0};var i=yWe(t),s=JSON.stringify({text:e,copyStyle:i});if(Cd.widthCache[s])return Cd.widthCache[s];try{var n=document.getElementById(Pj);n||(n=document.createElement("span"),n.setAttribute("id",Pj),n.setAttribute("aria-hidden","true"),document.body.appendChild(n));var a=RR(RR({},vWe),i);Object.assign(n.style,a),n.textContent="".concat(e);var o=n.getBoundingClientRect(),l={width:o.width,height:o.height};return Cd.widthCache[s]=l,++Cd.cacheCount>_We&&(Cd.cacheCount=0,Cd.widthCache={}),l}catch{return{width:0,height:0}}},SWe=function(e){return{top:e.top+window.scrollY-document.documentElement.clientTop,left:e.left+window.scrollX-document.documentElement.clientLeft}};function wv(r){"@babel/helpers - typeof";return wv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wv(r)}function dw(r,e){return TWe(r)||wWe(r,e)||bWe(r,e)||xWe()}function xWe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bWe(r,e){if(r){if(typeof r=="string")return Ij(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ij(r,e)}}function Ij(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=r[t];return i}function wWe(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var i,s,n,a,o=[],l=!0,c=!1;try{if(n=(t=t.call(r)).next,e===0){if(Object(t)!==t)return;l=!1}else for(;!(l=(i=n.call(t)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(u){c=!0,s=u}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(c)throw s}}return o}}function TWe(r){if(Array.isArray(r))return r}function EWe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Mj(r,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,CWe(i.key),i)}}function AWe(r,e,t){return e&&Mj(r.prototype,e),t&&Mj(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}function CWe(r){var e=PWe(r,"string");return wv(e)=="symbol"?e:e+""}function PWe(r,e){if(wv(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(wv(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var Rj=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,Dj=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,IWe=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,MWe=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,lQ={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},RWe=Object.keys(lQ),Qd="NaN";function DWe(r,e){return r*lQ[e]}var IS=function(){function r(e,t){EWe(this,r),this.num=e,this.unit=t,this.num=e,this.unit=t,Number.isNaN(e)&&(this.unit=""),t!==""&&!IWe.test(t)&&(this.num=NaN,this.unit=""),RWe.includes(t)&&(this.num=DWe(e,t),this.unit="px")}return AWe(r,[{key:"add",value:function(t){return this.unit!==t.unit?new r(NaN,""):new r(this.num+t.num,this.unit)}},{key:"subtract",value:function(t){return this.unit!==t.unit?new r(NaN,""):new r(this.num-t.num,this.unit)}},{key:"multiply",value:function(t){return this.unit!==""&&t.unit!==""&&this.unit!==t.unit?new r(NaN,""):new r(this.num*t.num,this.unit||t.unit)}},{key:"divide",value:function(t){return this.unit!==""&&t.unit!==""&&this.unit!==t.unit?new r(NaN,""):new r(this.num/t.num,this.unit||t.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(t){var i,s=(i=MWe.exec(t))!==null&&i!==void 0?i:[],n=dw(s,3),a=n[1],o=n[2];return new r(parseFloat(a),o??"")}}])}();function cQ(r){if(r.includes(Qd))return Qd;for(var e=r;e.includes("*")||e.includes("/");){var t,i=(t=Rj.exec(e))!==null&&t!==void 0?t:[],s=dw(i,4),n=s[1],a=s[2],o=s[3],l=IS.parse(n??""),c=IS.parse(o??""),u=a==="*"?l.multiply(c):l.divide(c);if(u.isNaN())return Qd;e=e.replace(Rj,u.toString())}for(;e.includes("+")||/.-\d+(?:\.\d+)?/.test(e);){var h,d=(h=Dj.exec(e))!==null&&h!==void 0?h:[],f=dw(d,4),p=f[1],m=f[2],g=f[3],_=IS.parse(p??""),v=IS.parse(g??""),y=m==="+"?_.add(v):_.subtract(v);if(y.isNaN())return Qd;e=e.replace(Dj,y.toString())}return e}var Lj=/\(([^()]*)\)/;function LWe(r){for(var e=r;e.includes("(");){var t=Lj.exec(e),i=dw(t,2),s=i[1];e=e.replace(Lj,cQ(s))}return e}function OWe(r){var e=r.replace(/\s+/g,"");return e=LWe(e),e=cQ(e),e}function NWe(r){try{return OWe(r)}catch{return Qd}}function EP(r){var e=NWe(r.slice(5,-1));return e===Qd?"":e}var kWe=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],FWe=["dx","dy","angle","className","breakAll"];function DR(){return DR=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},DR.apply(this,arguments)}function Oj(r,e){if(r==null)return{};var t=BWe(r,e),i,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(r,i)&&(t[i]=r[i])}return t}function BWe(r,e){if(r==null)return{};var t={};for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(e.indexOf(i)>=0)continue;t[i]=r[i]}return t}function Nj(r,e){return jWe(r)||VWe(r,e)||zWe(r,e)||UWe()}function UWe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zWe(r,e){if(r){if(typeof r=="string")return kj(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return kj(r,e)}}function kj(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=r[t];return i}function VWe(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var i,s,n,a,o=[],l=!0,c=!1;try{if(n=(t=t.call(r)).next,e===0){if(Object(t)!==t)return;l=!1}else for(;!(l=(i=n.call(t)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(u){c=!0,s=u}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(c)throw s}}return o}}function jWe(r){if(Array.isArray(r))return r}var uQ=/[ \f\n\r\t\v\u2028\u2029]+/,hQ=function(e){var t=e.children,i=e.breakAll,s=e.style;try{var n=[];Pe(t)||(i?n=t.toString().split(""):n=t.toString().split(uQ));var a=n.map(function(l){return{word:l,width:h_(l,s).width}}),o=i?0:h_(" ",s).width;return{wordsWithComputedWidth:a,spaceWidth:o}}catch{return null}},$We=function(e,t,i,s,n){var a=e.maxLines,o=e.children,l=e.style,c=e.breakAll,u=oe(a),h=o,d=function(){var V=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return V.reduce(function(B,R){var L=R.word,D=R.width,F=B[B.length-1];if(F&&(s==null||n||F.width+D+i<Number(s)))F.words.push(L),F.width+=D+i;else{var j={words:[L],width:D};B.push(j)}return B},[])},f=d(t),p=function(V){return V.reduce(function(B,R){return B.width>R.width?B:R})};if(!u)return f;for(var m="…",g=function(V){var B=h.slice(0,V),R=hQ({breakAll:c,style:l,children:B+m}).wordsWithComputedWidth,L=d(R),D=L.length>a||p(L).width>Number(s);return[D,L]},_=0,v=h.length-1,y=0,x;_<=v&&y<=h.length-1;){var S=Math.floor((_+v)/2),w=S-1,T=g(w),A=Nj(T,2),C=A[0],P=A[1],I=g(S),M=Nj(I,1),N=M[0];if(!C&&!N&&(_=S+1),C&&N&&(v=S-1),!C&&N){x=P;break}y++}return x||f},Fj=function(e){var t=Pe(e)?[]:e.toString().split(uQ);return[{words:t}]},HWe=function(e){var t=e.width,i=e.scaleToFit,s=e.children,n=e.style,a=e.breakAll,o=e.maxLines;if((t||i)&&!Uh.isSsr){var l,c,u=hQ({breakAll:a,children:s,style:n});if(u){var h=u.wordsWithComputedWidth,d=u.spaceWidth;l=h,c=d}else return Fj(s);return $We({breakAll:a,children:s,maxLines:o,style:n},l,c,t,i)}return Fj(s)},Bj="#808080",Ah=function(e){var t=e.x,i=t===void 0?0:t,s=e.y,n=s===void 0?0:s,a=e.lineHeight,o=a===void 0?"1em":a,l=e.capHeight,c=l===void 0?"0.71em":l,u=e.scaleToFit,h=u===void 0?!1:u,d=e.textAnchor,f=d===void 0?"start":d,p=e.verticalAnchor,m=p===void 0?"end":p,g=e.fill,_=g===void 0?Bj:g,v=Oj(e,kWe),y=E.useMemo(function(){return HWe({breakAll:v.breakAll,children:v.children,maxLines:v.maxLines,scaleToFit:h,style:v.style,width:v.width})},[v.breakAll,v.children,v.maxLines,h,v.style,v.width]),x=v.dx,S=v.dy,w=v.angle,T=v.className,A=v.breakAll,C=Oj(v,FWe);if(!Ui(i)||!Ui(n))return null;var P=i+(oe(x)?x:0),I=n+(oe(S)?S:0),M;switch(m){case"start":M=EP("calc(".concat(c,")"));break;case"middle":M=EP("calc(".concat((y.length-1)/2," * -").concat(o," + (").concat(c," / 2))"));break;default:M=EP("calc(".concat(y.length-1," * -").concat(o,")"));break}var N=[];if(h){var k=y[0].width,V=v.width;N.push("scale(".concat((oe(V)?V/k:1)/k,")"))}return w&&N.push("rotate(".concat(w,", ").concat(P,", ").concat(I,")")),N.length&&(C.transform=N.join(" ")),U.createElement("text",DR({},Se(C,!0),{x:P,y:I,className:Re("recharts-text",T),textAnchor:f,fill:_.includes("url")?Bj:_}),y.map(function(B,R){var L=B.words.join(A?"":" ");return U.createElement("tspan",{x:P,dy:R===0?M:o,key:"".concat(L,"-").concat(R)},L)}))};function gc(r,e){return r==null||e==null?NaN:r<e?-1:r>e?1:r>=e?0:NaN}function GWe(r,e){return r==null||e==null?NaN:e<r?-1:e>r?1:e>=r?0:NaN}function zN(r){let e,t,i;r.length!==2?(e=gc,t=(o,l)=>gc(r(o),l),i=(o,l)=>r(o)-l):(e=r===gc||r===GWe?r:WWe,t=r,i=r);function s(o,l,c=0,u=o.length){if(c<u){if(e(l,l)!==0)return u;do{const h=c+u>>>1;t(o[h],l)<0?c=h+1:u=h}while(c<u)}return c}function n(o,l,c=0,u=o.length){if(c<u){if(e(l,l)!==0)return u;do{const h=c+u>>>1;t(o[h],l)<=0?c=h+1:u=h}while(c<u)}return c}function a(o,l,c=0,u=o.length){const h=s(o,l,c,u-1);return h>c&&i(o[h-1],l)>-i(o[h],l)?h-1:h}return{left:s,center:a,right:n}}function WWe(){return 0}function dQ(r){return r===null?NaN:+r}function*XWe(r,e){for(let t of r)t!=null&&(t=+t)>=t&&(yield t)}const qWe=zN(gc),Gy=qWe.right;zN(dQ).center;class Uj extends Map{constructor(e,t=ZWe){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),e!=null)for(const[i,s]of e)this.set(i,s)}get(e){return super.get(zj(this,e))}has(e){return super.has(zj(this,e))}set(e,t){return super.set(YWe(this,e),t)}delete(e){return super.delete(KWe(this,e))}}function zj({_intern:r,_key:e},t){const i=e(t);return r.has(i)?r.get(i):t}function YWe({_intern:r,_key:e},t){const i=e(t);return r.has(i)?r.get(i):(r.set(i,t),t)}function KWe({_intern:r,_key:e},t){const i=e(t);return r.has(i)&&(t=r.get(i),r.delete(i)),t}function ZWe(r){return r!==null&&typeof r=="object"?r.valueOf():r}function QWe(r=gc){if(r===gc)return fQ;if(typeof r!="function")throw new TypeError("compare is not a function");return(e,t)=>{const i=r(e,t);return i||i===0?i:(r(t,t)===0)-(r(e,e)===0)}}function fQ(r,e){return(r==null||!(r>=r))-(e==null||!(e>=e))||(r<e?-1:r>e?1:0)}const JWe=Math.sqrt(50),e8e=Math.sqrt(10),t8e=Math.sqrt(2);function fw(r,e,t){const i=(e-r)/Math.max(0,t),s=Math.floor(Math.log10(i)),n=i/Math.pow(10,s),a=n>=JWe?10:n>=e8e?5:n>=t8e?2:1;let o,l,c;return s<0?(c=Math.pow(10,-s)/a,o=Math.round(r*c),l=Math.round(e*c),o/c<r&&++o,l/c>e&&--l,c=-c):(c=Math.pow(10,s)*a,o=Math.round(r/c),l=Math.round(e/c),o*c<r&&++o,l*c>e&&--l),l<o&&.5<=t&&t<2?fw(r,e,t*2):[o,l,c]}function LR(r,e,t){if(e=+e,r=+r,t=+t,!(t>0))return[];if(r===e)return[r];const i=e<r,[s,n,a]=i?fw(e,r,t):fw(r,e,t);if(!(n>=s))return[];const o=n-s+1,l=new Array(o);if(i)if(a<0)for(let c=0;c<o;++c)l[c]=(n-c)/-a;else for(let c=0;c<o;++c)l[c]=(n-c)*a;else if(a<0)for(let c=0;c<o;++c)l[c]=(s+c)/-a;else for(let c=0;c<o;++c)l[c]=(s+c)*a;return l}function OR(r,e,t){return e=+e,r=+r,t=+t,fw(r,e,t)[2]}function NR(r,e,t){e=+e,r=+r,t=+t;const i=e<r,s=i?OR(e,r,t):OR(r,e,t);return(i?-1:1)*(s<0?1/-s:s)}function Vj(r,e){let t;for(const i of r)i!=null&&(t<i||t===void 0&&i>=i)&&(t=i);return t}function jj(r,e){let t;for(const i of r)i!=null&&(t>i||t===void 0&&i>=i)&&(t=i);return t}function pQ(r,e,t=0,i=1/0,s){if(e=Math.floor(e),t=Math.floor(Math.max(0,t)),i=Math.floor(Math.min(r.length-1,i)),!(t<=e&&e<=i))return r;for(s=s===void 0?fQ:QWe(s);i>t;){if(i-t>600){const l=i-t+1,c=e-t+1,u=Math.log(l),h=.5*Math.exp(2*u/3),d=.5*Math.sqrt(u*h*(l-h)/l)*(c-l/2<0?-1:1),f=Math.max(t,Math.floor(e-c*h/l+d)),p=Math.min(i,Math.floor(e+(l-c)*h/l+d));pQ(r,e,f,p,s)}const n=r[e];let a=t,o=i;for(pg(r,t,e),s(r[i],n)>0&&pg(r,t,i);a<o;){for(pg(r,a,o),++a,--o;s(r[a],n)<0;)++a;for(;s(r[o],n)>0;)--o}s(r[t],n)===0?pg(r,t,o):(++o,pg(r,o,i)),o<=e&&(t=o+1),e<=o&&(i=o-1)}return r}function pg(r,e,t){const i=r[e];r[e]=r[t],r[t]=i}function i8e(r,e,t){if(r=Float64Array.from(XWe(r)),!(!(i=r.length)||isNaN(e=+e))){if(e<=0||i<2)return jj(r);if(e>=1)return Vj(r);var i,s=(i-1)*e,n=Math.floor(s),a=Vj(pQ(r,n).subarray(0,n+1)),o=jj(r.subarray(n+1));return a+(o-a)*(s-n)}}function r8e(r,e,t=dQ){if(!(!(i=r.length)||isNaN(e=+e))){if(e<=0||i<2)return+t(r[0],0,r);if(e>=1)return+t(r[i-1],i-1,r);var i,s=(i-1)*e,n=Math.floor(s),a=+t(r[n],n,r),o=+t(r[n+1],n+1,r);return a+(o-a)*(s-n)}}function s8e(r,e,t){r=+r,e=+e,t=(s=arguments.length)<2?(e=r,r=0,1):s<3?1:+t;for(var i=-1,s=Math.max(0,Math.ceil((e-r)/t))|0,n=new Array(s);++i<s;)n[i]=r+i*t;return n}function pn(r,e){switch(arguments.length){case 0:break;case 1:this.range(r);break;default:this.range(e).domain(r);break}return this}function cl(r,e){switch(arguments.length){case 0:break;case 1:{typeof r=="function"?this.interpolator(r):this.range(r);break}default:{this.domain(r),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}const kR=Symbol("implicit");function VN(){var r=new Uj,e=[],t=[],i=kR;function s(n){let a=r.get(n);if(a===void 0){if(i!==kR)return i;r.set(n,a=e.push(n)-1)}return t[a%t.length]}return s.domain=function(n){if(!arguments.length)return e.slice();e=[],r=new Uj;for(const a of n)r.has(a)||r.set(a,e.push(a)-1);return s},s.range=function(n){return arguments.length?(t=Array.from(n),s):t.slice()},s.unknown=function(n){return arguments.length?(i=n,s):i},s.copy=function(){return VN(e,t).unknown(i)},pn.apply(s,arguments),s}function Tv(){var r=VN().unknown(void 0),e=r.domain,t=r.range,i=0,s=1,n,a,o=!1,l=0,c=0,u=.5;delete r.unknown;function h(){var d=e().length,f=s<i,p=f?s:i,m=f?i:s;n=(m-p)/Math.max(1,d-l+c*2),o&&(n=Math.floor(n)),p+=(m-p-n*(d-l))*u,a=n*(1-l),o&&(p=Math.round(p),a=Math.round(a));var g=s8e(d).map(function(_){return p+n*_});return t(f?g.reverse():g)}return r.domain=function(d){return arguments.length?(e(d),h()):e()},r.range=function(d){return arguments.length?([i,s]=d,i=+i,s=+s,h()):[i,s]},r.rangeRound=function(d){return[i,s]=d,i=+i,s=+s,o=!0,h()},r.bandwidth=function(){return a},r.step=function(){return n},r.round=function(d){return arguments.length?(o=!!d,h()):o},r.padding=function(d){return arguments.length?(l=Math.min(1,c=+d),h()):l},r.paddingInner=function(d){return arguments.length?(l=Math.min(1,d),h()):l},r.paddingOuter=function(d){return arguments.length?(c=+d,h()):c},r.align=function(d){return arguments.length?(u=Math.max(0,Math.min(1,d)),h()):u},r.copy=function(){return Tv(e(),[i,s]).round(o).paddingInner(l).paddingOuter(c).align(u)},pn.apply(h(),arguments)}function mQ(r){var e=r.copy;return r.padding=r.paddingOuter,delete r.paddingInner,delete r.paddingOuter,r.copy=function(){return mQ(e())},r}function d_(){return mQ(Tv.apply(null,arguments).paddingInner(1))}function jN(r,e,t){r.prototype=e.prototype=t,t.constructor=r}function gQ(r,e){var t=Object.create(r.prototype);for(var i in e)t[i]=e[i];return t}function Wy(){}var Ev=.7,pw=1/Ev,Uf="\\s*([+-]?\\d+)\\s*",Av="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Na="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",n8e=/^#([0-9a-f]{3,8})$/,a8e=new RegExp(`^rgb\\(${Uf},${Uf},${Uf}\\)$`),o8e=new RegExp(`^rgb\\(${Na},${Na},${Na}\\)$`),l8e=new RegExp(`^rgba\\(${Uf},${Uf},${Uf},${Av}\\)$`),c8e=new RegExp(`^rgba\\(${Na},${Na},${Na},${Av}\\)$`),u8e=new RegExp(`^hsl\\(${Av},${Na},${Na}\\)$`),h8e=new RegExp(`^hsla\\(${Av},${Na},${Na},${Av}\\)$`),$j={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};jN(Wy,Cv,{copy(r){return Object.assign(new this.constructor,this,r)},displayable(){return this.rgb().displayable()},hex:Hj,formatHex:Hj,formatHex8:d8e,formatHsl:f8e,formatRgb:Gj,toString:Gj});function Hj(){return this.rgb().formatHex()}function d8e(){return this.rgb().formatHex8()}function f8e(){return _Q(this).formatHsl()}function Gj(){return this.rgb().formatRgb()}function Cv(r){var e,t;return r=(r+"").trim().toLowerCase(),(e=n8e.exec(r))?(t=e[1].length,e=parseInt(e[1],16),t===6?Wj(e):t===3?new Zr(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?MS(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?MS(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=a8e.exec(r))?new Zr(e[1],e[2],e[3],1):(e=o8e.exec(r))?new Zr(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=l8e.exec(r))?MS(e[1],e[2],e[3],e[4]):(e=c8e.exec(r))?MS(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=u8e.exec(r))?Yj(e[1],e[2]/100,e[3]/100,1):(e=h8e.exec(r))?Yj(e[1],e[2]/100,e[3]/100,e[4]):$j.hasOwnProperty(r)?Wj($j[r]):r==="transparent"?new Zr(NaN,NaN,NaN,0):null}function Wj(r){return new Zr(r>>16&255,r>>8&255,r&255,1)}function MS(r,e,t,i){return i<=0&&(r=e=t=NaN),new Zr(r,e,t,i)}function p8e(r){return r instanceof Wy||(r=Cv(r)),r?(r=r.rgb(),new Zr(r.r,r.g,r.b,r.opacity)):new Zr}function FR(r,e,t,i){return arguments.length===1?p8e(r):new Zr(r,e,t,i??1)}function Zr(r,e,t,i){this.r=+r,this.g=+e,this.b=+t,this.opacity=+i}jN(Zr,FR,gQ(Wy,{brighter(r){return r=r==null?pw:Math.pow(pw,r),new Zr(this.r*r,this.g*r,this.b*r,this.opacity)},darker(r){return r=r==null?Ev:Math.pow(Ev,r),new Zr(this.r*r,this.g*r,this.b*r,this.opacity)},rgb(){return this},clamp(){return new Zr(Yu(this.r),Yu(this.g),Yu(this.b),mw(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Xj,formatHex:Xj,formatHex8:m8e,formatRgb:qj,toString:qj}));function Xj(){return`#${Pu(this.r)}${Pu(this.g)}${Pu(this.b)}`}function m8e(){return`#${Pu(this.r)}${Pu(this.g)}${Pu(this.b)}${Pu((isNaN(this.opacity)?1:this.opacity)*255)}`}function qj(){const r=mw(this.opacity);return`${r===1?"rgb(":"rgba("}${Yu(this.r)}, ${Yu(this.g)}, ${Yu(this.b)}${r===1?")":`, ${r})`}`}function mw(r){return isNaN(r)?1:Math.max(0,Math.min(1,r))}function Yu(r){return Math.max(0,Math.min(255,Math.round(r)||0))}function Pu(r){return r=Yu(r),(r<16?"0":"")+r.toString(16)}function Yj(r,e,t,i){return i<=0?r=e=t=NaN:t<=0||t>=1?r=e=NaN:e<=0&&(r=NaN),new Vn(r,e,t,i)}function _Q(r){if(r instanceof Vn)return new Vn(r.h,r.s,r.l,r.opacity);if(r instanceof Wy||(r=Cv(r)),!r)return new Vn;if(r instanceof Vn)return r;r=r.rgb();var e=r.r/255,t=r.g/255,i=r.b/255,s=Math.min(e,t,i),n=Math.max(e,t,i),a=NaN,o=n-s,l=(n+s)/2;return o?(e===n?a=(t-i)/o+(t<i)*6:t===n?a=(i-e)/o+2:a=(e-t)/o+4,o/=l<.5?n+s:2-n-s,a*=60):o=l>0&&l<1?0:a,new Vn(a,o,l,r.opacity)}function g8e(r,e,t,i){return arguments.length===1?_Q(r):new Vn(r,e,t,i??1)}function Vn(r,e,t,i){this.h=+r,this.s=+e,this.l=+t,this.opacity=+i}jN(Vn,g8e,gQ(Wy,{brighter(r){return r=r==null?pw:Math.pow(pw,r),new Vn(this.h,this.s,this.l*r,this.opacity)},darker(r){return r=r==null?Ev:Math.pow(Ev,r),new Vn(this.h,this.s,this.l*r,this.opacity)},rgb(){var r=this.h%360+(this.h<0)*360,e=isNaN(r)||isNaN(this.s)?0:this.s,t=this.l,i=t+(t<.5?t:1-t)*e,s=2*t-i;return new Zr(AP(r>=240?r-240:r+120,s,i),AP(r,s,i),AP(r<120?r+240:r-120,s,i),this.opacity)},clamp(){return new Vn(Kj(this.h),RS(this.s),RS(this.l),mw(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const r=mw(this.opacity);return`${r===1?"hsl(":"hsla("}${Kj(this.h)}, ${RS(this.s)*100}%, ${RS(this.l)*100}%${r===1?")":`, ${r})`}`}}));function Kj(r){return r=(r||0)%360,r<0?r+360:r}function RS(r){return Math.max(0,Math.min(1,r||0))}function AP(r,e,t){return(r<60?e+(t-e)*r/60:r<180?t:r<240?e+(t-e)*(240-r)/60:e)*255}const $N=r=>()=>r;function _8e(r,e){return function(t){return r+t*e}}function v8e(r,e,t){return r=Math.pow(r,t),e=Math.pow(e,t)-r,t=1/t,function(i){return Math.pow(r+i*e,t)}}function y8e(r){return(r=+r)==1?vQ:function(e,t){return t-e?v8e(e,t,r):$N(isNaN(e)?t:e)}}function vQ(r,e){var t=e-r;return t?_8e(r,t):$N(isNaN(r)?e:r)}const Zj=function r(e){var t=y8e(e);function i(s,n){var a=t((s=FR(s)).r,(n=FR(n)).r),o=t(s.g,n.g),l=t(s.b,n.b),c=vQ(s.opacity,n.opacity);return function(u){return s.r=a(u),s.g=o(u),s.b=l(u),s.opacity=c(u),s+""}}return i.gamma=r,i}(1);function S8e(r,e){e||(e=[]);var t=r?Math.min(e.length,r.length):0,i=e.slice(),s;return function(n){for(s=0;s<t;++s)i[s]=r[s]*(1-n)+e[s]*n;return i}}function x8e(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function b8e(r,e){var t=e?e.length:0,i=r?Math.min(t,r.length):0,s=new Array(i),n=new Array(t),a;for(a=0;a<i;++a)s[a]=Cm(r[a],e[a]);for(;a<t;++a)n[a]=e[a];return function(o){for(a=0;a<i;++a)n[a]=s[a](o);return n}}function w8e(r,e){var t=new Date;return r=+r,e=+e,function(i){return t.setTime(r*(1-i)+e*i),t}}function gw(r,e){return r=+r,e=+e,function(t){return r*(1-t)+e*t}}function T8e(r,e){var t={},i={},s;(r===null||typeof r!="object")&&(r={}),(e===null||typeof e!="object")&&(e={});for(s in e)s in r?t[s]=Cm(r[s],e[s]):i[s]=e[s];return function(n){for(s in t)i[s]=t[s](n);return i}}var BR=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,CP=new RegExp(BR.source,"g");function E8e(r){return function(){return r}}function A8e(r){return function(e){return r(e)+""}}function C8e(r,e){var t=BR.lastIndex=CP.lastIndex=0,i,s,n,a=-1,o=[],l=[];for(r=r+"",e=e+"";(i=BR.exec(r))&&(s=CP.exec(e));)(n=s.index)>t&&(n=e.slice(t,n),o[a]?o[a]+=n:o[++a]=n),(i=i[0])===(s=s[0])?o[a]?o[a]+=s:o[++a]=s:(o[++a]=null,l.push({i:a,x:gw(i,s)})),t=CP.lastIndex;return t<e.length&&(n=e.slice(t),o[a]?o[a]+=n:o[++a]=n),o.length<2?l[0]?A8e(l[0].x):E8e(e):(e=l.length,function(c){for(var u=0,h;u<e;++u)o[(h=l[u]).i]=h.x(c);return o.join("")})}function Cm(r,e){var t=typeof e,i;return e==null||t==="boolean"?$N(e):(t==="number"?gw:t==="string"?(i=Cv(e))?(e=i,Zj):C8e:e instanceof Cv?Zj:e instanceof Date?w8e:x8e(e)?S8e:Array.isArray(e)?b8e:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?T8e:gw)(r,e)}function HN(r,e){return r=+r,e=+e,function(t){return Math.round(r*(1-t)+e*t)}}function P8e(r,e){e===void 0&&(e=r,r=Cm);for(var t=0,i=e.length-1,s=e[0],n=new Array(i<0?0:i);t<i;)n[t]=r(s,s=e[++t]);return function(a){var o=Math.max(0,Math.min(i-1,Math.floor(a*=i)));return n[o](a-o)}}function I8e(r){return function(){return r}}function _w(r){return+r}var Qj=[0,1];function Fr(r){return r}function UR(r,e){return(e-=r=+r)?function(t){return(t-r)/e}:I8e(isNaN(e)?NaN:.5)}function M8e(r,e){var t;return r>e&&(t=r,r=e,e=t),function(i){return Math.max(r,Math.min(e,i))}}function R8e(r,e,t){var i=r[0],s=r[1],n=e[0],a=e[1];return s<i?(i=UR(s,i),n=t(a,n)):(i=UR(i,s),n=t(n,a)),function(o){return n(i(o))}}function D8e(r,e,t){var i=Math.min(r.length,e.length)-1,s=new Array(i),n=new Array(i),a=-1;for(r[i]<r[0]&&(r=r.slice().reverse(),e=e.slice().reverse());++a<i;)s[a]=UR(r[a],r[a+1]),n[a]=t(e[a],e[a+1]);return function(o){var l=Gy(r,o,1,i)-1;return n[l](s[l](o))}}function Xy(r,e){return e.domain(r.domain()).range(r.range()).interpolate(r.interpolate()).clamp(r.clamp()).unknown(r.unknown())}function OA(){var r=Qj,e=Qj,t=Cm,i,s,n,a=Fr,o,l,c;function u(){var d=Math.min(r.length,e.length);return a!==Fr&&(a=M8e(r[0],r[d-1])),o=d>2?D8e:R8e,l=c=null,h}function h(d){return d==null||isNaN(d=+d)?n:(l||(l=o(r.map(i),e,t)))(i(a(d)))}return h.invert=function(d){return a(s((c||(c=o(e,r.map(i),gw)))(d)))},h.domain=function(d){return arguments.length?(r=Array.from(d,_w),u()):r.slice()},h.range=function(d){return arguments.length?(e=Array.from(d),u()):e.slice()},h.rangeRound=function(d){return e=Array.from(d),t=HN,u()},h.clamp=function(d){return arguments.length?(a=d?!0:Fr,u()):a!==Fr},h.interpolate=function(d){return arguments.length?(t=d,u()):t},h.unknown=function(d){return arguments.length?(n=d,h):n},function(d,f){return i=d,s=f,u()}}function GN(){return OA()(Fr,Fr)}function L8e(r){return Math.abs(r=Math.round(r))>=1e21?r.toLocaleString("en").replace(/,/g,""):r.toString(10)}function vw(r,e){if((t=(r=e?r.toExponential(e-1):r.toExponential()).indexOf("e"))<0)return null;var t,i=r.slice(0,t);return[i.length>1?i[0]+i.slice(2):i,+r.slice(t+1)]}function Dp(r){return r=vw(Math.abs(r)),r?r[1]:NaN}function O8e(r,e){return function(t,i){for(var s=t.length,n=[],a=0,o=r[0],l=0;s>0&&o>0&&(l+o+1>i&&(o=Math.max(1,i-l)),n.push(t.substring(s-=o,s+o)),!((l+=o+1)>i));)o=r[a=(a+1)%r.length];return n.reverse().join(e)}}function N8e(r){return function(e){return e.replace(/[0-9]/g,function(t){return r[+t]})}}var k8e=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Pv(r){if(!(e=k8e.exec(r)))throw new Error("invalid format: "+r);var e;return new WN({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Pv.prototype=WN.prototype;function WN(r){this.fill=r.fill===void 0?" ":r.fill+"",this.align=r.align===void 0?">":r.align+"",this.sign=r.sign===void 0?"-":r.sign+"",this.symbol=r.symbol===void 0?"":r.symbol+"",this.zero=!!r.zero,this.width=r.width===void 0?void 0:+r.width,this.comma=!!r.comma,this.precision=r.precision===void 0?void 0:+r.precision,this.trim=!!r.trim,this.type=r.type===void 0?"":r.type+""}WN.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function F8e(r){e:for(var e=r.length,t=1,i=-1,s;t<e;++t)switch(r[t]){case".":i=s=t;break;case"0":i===0&&(i=t),s=t;break;default:if(!+r[t])break e;i>0&&(i=0);break}return i>0?r.slice(0,i)+r.slice(s+1):r}var yQ;function B8e(r,e){var t=vw(r,e);if(!t)return r+"";var i=t[0],s=t[1],n=s-(yQ=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,a=i.length;return n===a?i:n>a?i+new Array(n-a+1).join("0"):n>0?i.slice(0,n)+"."+i.slice(n):"0."+new Array(1-n).join("0")+vw(r,Math.max(0,e+n-1))[0]}function Jj(r,e){var t=vw(r,e);if(!t)return r+"";var i=t[0],s=t[1];return s<0?"0."+new Array(-s).join("0")+i:i.length>s+1?i.slice(0,s+1)+"."+i.slice(s+1):i+new Array(s-i.length+2).join("0")}const e$={"%":(r,e)=>(r*100).toFixed(e),b:r=>Math.round(r).toString(2),c:r=>r+"",d:L8e,e:(r,e)=>r.toExponential(e),f:(r,e)=>r.toFixed(e),g:(r,e)=>r.toPrecision(e),o:r=>Math.round(r).toString(8),p:(r,e)=>Jj(r*100,e),r:Jj,s:B8e,X:r=>Math.round(r).toString(16).toUpperCase(),x:r=>Math.round(r).toString(16)};function t$(r){return r}var i$=Array.prototype.map,r$=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function U8e(r){var e=r.grouping===void 0||r.thousands===void 0?t$:O8e(i$.call(r.grouping,Number),r.thousands+""),t=r.currency===void 0?"":r.currency[0]+"",i=r.currency===void 0?"":r.currency[1]+"",s=r.decimal===void 0?".":r.decimal+"",n=r.numerals===void 0?t$:N8e(i$.call(r.numerals,String)),a=r.percent===void 0?"%":r.percent+"",o=r.minus===void 0?"−":r.minus+"",l=r.nan===void 0?"NaN":r.nan+"";function c(h){h=Pv(h);var d=h.fill,f=h.align,p=h.sign,m=h.symbol,g=h.zero,_=h.width,v=h.comma,y=h.precision,x=h.trim,S=h.type;S==="n"?(v=!0,S="g"):e$[S]||(y===void 0&&(y=12),x=!0,S="g"),(g||d==="0"&&f==="=")&&(g=!0,d="0",f="=");var w=m==="$"?t:m==="#"&&/[boxX]/.test(S)?"0"+S.toLowerCase():"",T=m==="$"?i:/[%p]/.test(S)?a:"",A=e$[S],C=/[defgprs%]/.test(S);y=y===void 0?6:/[gprs]/.test(S)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y));function P(I){var M=w,N=T,k,V,B;if(S==="c")N=A(I)+N,I="";else{I=+I;var R=I<0||1/I<0;if(I=isNaN(I)?l:A(Math.abs(I),y),x&&(I=F8e(I)),R&&+I==0&&p!=="+"&&(R=!1),M=(R?p==="("?p:o:p==="-"||p==="("?"":p)+M,N=(S==="s"?r$[8+yQ/3]:"")+N+(R&&p==="("?")":""),C){for(k=-1,V=I.length;++k<V;)if(B=I.charCodeAt(k),48>B||B>57){N=(B===46?s+I.slice(k+1):I.slice(k))+N,I=I.slice(0,k);break}}}v&&!g&&(I=e(I,1/0));var L=M.length+I.length+N.length,D=L<_?new Array(_-L+1).join(d):"";switch(v&&g&&(I=e(D+I,D.length?_-N.length:1/0),D=""),f){case"<":I=M+I+N+D;break;case"=":I=M+D+I+N;break;case"^":I=D.slice(0,L=D.length>>1)+M+I+N+D.slice(L);break;default:I=D+M+I+N;break}return n(I)}return P.toString=function(){return h+""},P}function u(h,d){var f=c((h=Pv(h),h.type="f",h)),p=Math.max(-8,Math.min(8,Math.floor(Dp(d)/3)))*3,m=Math.pow(10,-p),g=r$[8+p/3];return function(_){return f(m*_)+g}}return{format:c,formatPrefix:u}}var DS,XN,SQ;z8e({thousands:",",grouping:[3],currency:["$",""]});function z8e(r){return DS=U8e(r),XN=DS.format,SQ=DS.formatPrefix,DS}function V8e(r){return Math.max(0,-Dp(Math.abs(r)))}function j8e(r,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Dp(e)/3)))*3-Dp(Math.abs(r)))}function $8e(r,e){return r=Math.abs(r),e=Math.abs(e)-r,Math.max(0,Dp(e)-Dp(r))+1}function xQ(r,e,t,i){var s=NR(r,e,t),n;switch(i=Pv(i??",f"),i.type){case"s":{var a=Math.max(Math.abs(r),Math.abs(e));return i.precision==null&&!isNaN(n=j8e(s,a))&&(i.precision=n),SQ(i,a)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(n=$8e(s,Math.max(Math.abs(r),Math.abs(e))))&&(i.precision=n-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(n=V8e(s))&&(i.precision=n-(i.type==="%")*2);break}}return XN(i)}function Bc(r){var e=r.domain;return r.ticks=function(t){var i=e();return LR(i[0],i[i.length-1],t??10)},r.tickFormat=function(t,i){var s=e();return xQ(s[0],s[s.length-1],t??10,i)},r.nice=function(t){t==null&&(t=10);var i=e(),s=0,n=i.length-1,a=i[s],o=i[n],l,c,u=10;for(o<a&&(c=a,a=o,o=c,c=s,s=n,n=c);u-- >0;){if(c=OR(a,o,t),c===l)return i[s]=a,i[n]=o,e(i);if(c>0)a=Math.floor(a/c)*c,o=Math.ceil(o/c)*c;else if(c<0)a=Math.ceil(a*c)/c,o=Math.floor(o*c)/c;else break;l=c}return r},r}function yw(){var r=GN();return r.copy=function(){return Xy(r,yw())},pn.apply(r,arguments),Bc(r)}function bQ(r){var e;function t(i){return i==null||isNaN(i=+i)?e:i}return t.invert=t,t.domain=t.range=function(i){return arguments.length?(r=Array.from(i,_w),t):r.slice()},t.unknown=function(i){return arguments.length?(e=i,t):e},t.copy=function(){return bQ(r).unknown(e)},r=arguments.length?Array.from(r,_w):[0,1],Bc(t)}function wQ(r,e){r=r.slice();var t=0,i=r.length-1,s=r[t],n=r[i],a;return n<s&&(a=t,t=i,i=a,a=s,s=n,n=a),r[t]=e.floor(s),r[i]=e.ceil(n),r}function s$(r){return Math.log(r)}function n$(r){return Math.exp(r)}function H8e(r){return-Math.log(-r)}function G8e(r){return-Math.exp(-r)}function W8e(r){return isFinite(r)?+("1e"+r):r<0?0:r}function X8e(r){return r===10?W8e:r===Math.E?Math.exp:e=>Math.pow(r,e)}function q8e(r){return r===Math.E?Math.log:r===10&&Math.log10||r===2&&Math.log2||(r=Math.log(r),e=>Math.log(e)/r)}function a$(r){return(e,t)=>-r(-e,t)}function qN(r){const e=r(s$,n$),t=e.domain;let i=10,s,n;function a(){return s=q8e(i),n=X8e(i),t()[0]<0?(s=a$(s),n=a$(n),r(H8e,G8e)):r(s$,n$),e}return e.base=function(o){return arguments.length?(i=+o,a()):i},e.domain=function(o){return arguments.length?(t(o),a()):t()},e.ticks=o=>{const l=t();let c=l[0],u=l[l.length-1];const h=u<c;h&&([c,u]=[u,c]);let d=s(c),f=s(u),p,m;const g=o==null?10:+o;let _=[];if(!(i%1)&&f-d<g){if(d=Math.floor(d),f=Math.ceil(f),c>0){for(;d<=f;++d)for(p=1;p<i;++p)if(m=d<0?p/n(-d):p*n(d),!(m<c)){if(m>u)break;_.push(m)}}else for(;d<=f;++d)for(p=i-1;p>=1;--p)if(m=d>0?p/n(-d):p*n(d),!(m<c)){if(m>u)break;_.push(m)}_.length*2<g&&(_=LR(c,u,g))}else _=LR(d,f,Math.min(f-d,g)).map(n);return h?_.reverse():_},e.tickFormat=(o,l)=>{if(o==null&&(o=10),l==null&&(l=i===10?"s":","),typeof l!="function"&&(!(i%1)&&(l=Pv(l)).precision==null&&(l.trim=!0),l=XN(l)),o===1/0)return l;const c=Math.max(1,i*o/e.ticks().length);return u=>{let h=u/n(Math.round(s(u)));return h*i<i-.5&&(h*=i),h<=c?l(u):""}},e.nice=()=>t(wQ(t(),{floor:o=>n(Math.floor(s(o))),ceil:o=>n(Math.ceil(s(o)))})),e}function TQ(){const r=qN(OA()).domain([1,10]);return r.copy=()=>Xy(r,TQ()).base(r.base()),pn.apply(r,arguments),r}function o$(r){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/r))}}function l$(r){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*r}}function YN(r){var e=1,t=r(o$(e),l$(e));return t.constant=function(i){return arguments.length?r(o$(e=+i),l$(e)):e},Bc(t)}function EQ(){var r=YN(OA());return r.copy=function(){return Xy(r,EQ()).constant(r.constant())},pn.apply(r,arguments)}function c$(r){return function(e){return e<0?-Math.pow(-e,r):Math.pow(e,r)}}function Y8e(r){return r<0?-Math.sqrt(-r):Math.sqrt(r)}function K8e(r){return r<0?-r*r:r*r}function KN(r){var e=r(Fr,Fr),t=1;function i(){return t===1?r(Fr,Fr):t===.5?r(Y8e,K8e):r(c$(t),c$(1/t))}return e.exponent=function(s){return arguments.length?(t=+s,i()):t},Bc(e)}function ZN(){var r=KN(OA());return r.copy=function(){return Xy(r,ZN()).exponent(r.exponent())},pn.apply(r,arguments),r}function Z8e(){return ZN.apply(null,arguments).exponent(.5)}function u$(r){return Math.sign(r)*r*r}function Q8e(r){return Math.sign(r)*Math.sqrt(Math.abs(r))}function AQ(){var r=GN(),e=[0,1],t=!1,i;function s(n){var a=Q8e(r(n));return isNaN(a)?i:t?Math.round(a):a}return s.invert=function(n){return r.invert(u$(n))},s.domain=function(n){return arguments.length?(r.domain(n),s):r.domain()},s.range=function(n){return arguments.length?(r.range((e=Array.from(n,_w)).map(u$)),s):e.slice()},s.rangeRound=function(n){return s.range(n).round(!0)},s.round=function(n){return arguments.length?(t=!!n,s):t},s.clamp=function(n){return arguments.length?(r.clamp(n),s):r.clamp()},s.unknown=function(n){return arguments.length?(i=n,s):i},s.copy=function(){return AQ(r.domain(),e).round(t).clamp(r.clamp()).unknown(i)},pn.apply(s,arguments),Bc(s)}function CQ(){var r=[],e=[],t=[],i;function s(){var a=0,o=Math.max(1,e.length);for(t=new Array(o-1);++a<o;)t[a-1]=r8e(r,a/o);return n}function n(a){return a==null||isNaN(a=+a)?i:e[Gy(t,a)]}return n.invertExtent=function(a){var o=e.indexOf(a);return o<0?[NaN,NaN]:[o>0?t[o-1]:r[0],o<t.length?t[o]:r[r.length-1]]},n.domain=function(a){if(!arguments.length)return r.slice();r=[];for(let o of a)o!=null&&!isNaN(o=+o)&&r.push(o);return r.sort(gc),s()},n.range=function(a){return arguments.length?(e=Array.from(a),s()):e.slice()},n.unknown=function(a){return arguments.length?(i=a,n):i},n.quantiles=function(){return t.slice()},n.copy=function(){return CQ().domain(r).range(e).unknown(i)},pn.apply(n,arguments)}function PQ(){var r=0,e=1,t=1,i=[.5],s=[0,1],n;function a(l){return l!=null&&l<=l?s[Gy(i,l,0,t)]:n}function o(){var l=-1;for(i=new Array(t);++l<t;)i[l]=((l+1)*e-(l-t)*r)/(t+1);return a}return a.domain=function(l){return arguments.length?([r,e]=l,r=+r,e=+e,o()):[r,e]},a.range=function(l){return arguments.length?(t=(s=Array.from(l)).length-1,o()):s.slice()},a.invertExtent=function(l){var c=s.indexOf(l);return c<0?[NaN,NaN]:c<1?[r,i[0]]:c>=t?[i[t-1],e]:[i[c-1],i[c]]},a.unknown=function(l){return arguments.length&&(n=l),a},a.thresholds=function(){return i.slice()},a.copy=function(){return PQ().domain([r,e]).range(s).unknown(n)},pn.apply(Bc(a),arguments)}function IQ(){var r=[.5],e=[0,1],t,i=1;function s(n){return n!=null&&n<=n?e[Gy(r,n,0,i)]:t}return s.domain=function(n){return arguments.length?(r=Array.from(n),i=Math.min(r.length,e.length-1),s):r.slice()},s.range=function(n){return arguments.length?(e=Array.from(n),i=Math.min(r.length,e.length-1),s):e.slice()},s.invertExtent=function(n){var a=e.indexOf(n);return[r[a-1],r[a]]},s.unknown=function(n){return arguments.length?(t=n,s):t},s.copy=function(){return IQ().domain(r).range(e).unknown(t)},pn.apply(s,arguments)}const PP=new Date,IP=new Date;function ji(r,e,t,i){function s(n){return r(n=arguments.length===0?new Date:new Date(+n)),n}return s.floor=n=>(r(n=new Date(+n)),n),s.ceil=n=>(r(n=new Date(n-1)),e(n,1),r(n),n),s.round=n=>{const a=s(n),o=s.ceil(n);return n-a<o-n?a:o},s.offset=(n,a)=>(e(n=new Date(+n),a==null?1:Math.floor(a)),n),s.range=(n,a,o)=>{const l=[];if(n=s.ceil(n),o=o==null?1:Math.floor(o),!(n<a)||!(o>0))return l;let c;do l.push(c=new Date(+n)),e(n,o),r(n);while(c<n&&n<a);return l},s.filter=n=>ji(a=>{if(a>=a)for(;r(a),!n(a);)a.setTime(a-1)},(a,o)=>{if(a>=a)if(o<0)for(;++o<=0;)for(;e(a,-1),!n(a););else for(;--o>=0;)for(;e(a,1),!n(a););}),t&&(s.count=(n,a)=>(PP.setTime(+n),IP.setTime(+a),r(PP),r(IP),Math.floor(t(PP,IP))),s.every=n=>(n=Math.floor(n),!isFinite(n)||!(n>0)?null:n>1?s.filter(i?a=>i(a)%n===0:a=>s.count(0,a)%n===0):s)),s}const Sw=ji(()=>{},(r,e)=>{r.setTime(+r+e)},(r,e)=>e-r);Sw.every=r=>(r=Math.floor(r),!isFinite(r)||!(r>0)?null:r>1?ji(e=>{e.setTime(Math.floor(e/r)*r)},(e,t)=>{e.setTime(+e+t*r)},(e,t)=>(t-e)/r):Sw);Sw.range;const Oo=1e3,rn=Oo*60,No=rn*60,el=No*24,QN=el*7,h$=el*30,MP=el*365,Iu=ji(r=>{r.setTime(r-r.getMilliseconds())},(r,e)=>{r.setTime(+r+e*Oo)},(r,e)=>(e-r)/Oo,r=>r.getUTCSeconds());Iu.range;const JN=ji(r=>{r.setTime(r-r.getMilliseconds()-r.getSeconds()*Oo)},(r,e)=>{r.setTime(+r+e*rn)},(r,e)=>(e-r)/rn,r=>r.getMinutes());JN.range;const ek=ji(r=>{r.setUTCSeconds(0,0)},(r,e)=>{r.setTime(+r+e*rn)},(r,e)=>(e-r)/rn,r=>r.getUTCMinutes());ek.range;const tk=ji(r=>{r.setTime(r-r.getMilliseconds()-r.getSeconds()*Oo-r.getMinutes()*rn)},(r,e)=>{r.setTime(+r+e*No)},(r,e)=>(e-r)/No,r=>r.getHours());tk.range;const ik=ji(r=>{r.setUTCMinutes(0,0,0)},(r,e)=>{r.setTime(+r+e*No)},(r,e)=>(e-r)/No,r=>r.getUTCHours());ik.range;const qy=ji(r=>r.setHours(0,0,0,0),(r,e)=>r.setDate(r.getDate()+e),(r,e)=>(e-r-(e.getTimezoneOffset()-r.getTimezoneOffset())*rn)/el,r=>r.getDate()-1);qy.range;const NA=ji(r=>{r.setUTCHours(0,0,0,0)},(r,e)=>{r.setUTCDate(r.getUTCDate()+e)},(r,e)=>(e-r)/el,r=>r.getUTCDate()-1);NA.range;const MQ=ji(r=>{r.setUTCHours(0,0,0,0)},(r,e)=>{r.setUTCDate(r.getUTCDate()+e)},(r,e)=>(e-r)/el,r=>Math.floor(r/el));MQ.range;function zh(r){return ji(e=>{e.setDate(e.getDate()-(e.getDay()+7-r)%7),e.setHours(0,0,0,0)},(e,t)=>{e.setDate(e.getDate()+t*7)},(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*rn)/QN)}const kA=zh(0),xw=zh(1),J8e=zh(2),e6e=zh(3),Lp=zh(4),t6e=zh(5),i6e=zh(6);kA.range;xw.range;J8e.range;e6e.range;Lp.range;t6e.range;i6e.range;function Vh(r){return ji(e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-r)%7),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t*7)},(e,t)=>(t-e)/QN)}const FA=Vh(0),bw=Vh(1),r6e=Vh(2),s6e=Vh(3),Op=Vh(4),n6e=Vh(5),a6e=Vh(6);FA.range;bw.range;r6e.range;s6e.range;Op.range;n6e.range;a6e.range;const rk=ji(r=>{r.setDate(1),r.setHours(0,0,0,0)},(r,e)=>{r.setMonth(r.getMonth()+e)},(r,e)=>e.getMonth()-r.getMonth()+(e.getFullYear()-r.getFullYear())*12,r=>r.getMonth());rk.range;const sk=ji(r=>{r.setUTCDate(1),r.setUTCHours(0,0,0,0)},(r,e)=>{r.setUTCMonth(r.getUTCMonth()+e)},(r,e)=>e.getUTCMonth()-r.getUTCMonth()+(e.getUTCFullYear()-r.getUTCFullYear())*12,r=>r.getUTCMonth());sk.range;const tl=ji(r=>{r.setMonth(0,1),r.setHours(0,0,0,0)},(r,e)=>{r.setFullYear(r.getFullYear()+e)},(r,e)=>e.getFullYear()-r.getFullYear(),r=>r.getFullYear());tl.every=r=>!isFinite(r=Math.floor(r))||!(r>0)?null:ji(e=>{e.setFullYear(Math.floor(e.getFullYear()/r)*r),e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t*r)});tl.range;const il=ji(r=>{r.setUTCMonth(0,1),r.setUTCHours(0,0,0,0)},(r,e)=>{r.setUTCFullYear(r.getUTCFullYear()+e)},(r,e)=>e.getUTCFullYear()-r.getUTCFullYear(),r=>r.getUTCFullYear());il.every=r=>!isFinite(r=Math.floor(r))||!(r>0)?null:ji(e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/r)*r),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t*r)});il.range;function RQ(r,e,t,i,s,n){const a=[[Iu,1,Oo],[Iu,5,5*Oo],[Iu,15,15*Oo],[Iu,30,30*Oo],[n,1,rn],[n,5,5*rn],[n,15,15*rn],[n,30,30*rn],[s,1,No],[s,3,3*No],[s,6,6*No],[s,12,12*No],[i,1,el],[i,2,2*el],[t,1,QN],[e,1,h$],[e,3,3*h$],[r,1,MP]];function o(c,u,h){const d=u<c;d&&([c,u]=[u,c]);const f=h&&typeof h.range=="function"?h:l(c,u,h),p=f?f.range(c,+u+1):[];return d?p.reverse():p}function l(c,u,h){const d=Math.abs(u-c)/h,f=zN(([,,g])=>g).right(a,d);if(f===a.length)return r.every(NR(c/MP,u/MP,h));if(f===0)return Sw.every(Math.max(NR(c,u,h),1));const[p,m]=a[d/a[f-1][2]<a[f][2]/d?f-1:f];return p.every(m)}return[o,l]}const[o6e,l6e]=RQ(il,sk,FA,MQ,ik,ek),[c6e,u6e]=RQ(tl,rk,kA,qy,tk,JN);function RP(r){if(0<=r.y&&r.y<100){var e=new Date(-1,r.m,r.d,r.H,r.M,r.S,r.L);return e.setFullYear(r.y),e}return new Date(r.y,r.m,r.d,r.H,r.M,r.S,r.L)}function DP(r){if(0<=r.y&&r.y<100){var e=new Date(Date.UTC(-1,r.m,r.d,r.H,r.M,r.S,r.L));return e.setUTCFullYear(r.y),e}return new Date(Date.UTC(r.y,r.m,r.d,r.H,r.M,r.S,r.L))}function mg(r,e,t){return{y:r,m:e,d:t,H:0,M:0,S:0,L:0}}function h6e(r){var e=r.dateTime,t=r.date,i=r.time,s=r.periods,n=r.days,a=r.shortDays,o=r.months,l=r.shortMonths,c=gg(s),u=_g(s),h=gg(n),d=_g(n),f=gg(a),p=_g(a),m=gg(o),g=_g(o),_=gg(l),v=_g(l),y={a:R,A:L,b:D,B:F,c:null,d:_$,e:_$,f:O6e,g:H6e,G:W6e,H:R6e,I:D6e,j:L6e,L:DQ,m:N6e,M:k6e,p:j,q:z,Q:S$,s:x$,S:F6e,u:B6e,U:U6e,V:z6e,w:V6e,W:j6e,x:null,X:null,y:$6e,Y:G6e,Z:X6e,"%":y$},x={a:$,A:H,b:G,B:Y,c:null,d:v$,e:v$,f:Z6e,g:oXe,G:cXe,H:q6e,I:Y6e,j:K6e,L:OQ,m:Q6e,M:J6e,p:W,q:ie,Q:S$,s:x$,S:eXe,u:tXe,U:iXe,V:rXe,w:sXe,W:nXe,x:null,X:null,y:aXe,Y:lXe,Z:uXe,"%":y$},S={a:P,A:I,b:M,B:N,c:k,d:m$,e:m$,f:C6e,g:p$,G:f$,H:g$,I:g$,j:w6e,L:A6e,m:b6e,M:T6e,p:C,q:x6e,Q:I6e,s:M6e,S:E6e,u:g6e,U:_6e,V:v6e,w:m6e,W:y6e,x:V,X:B,y:p$,Y:f$,Z:S6e,"%":P6e};y.x=w(t,y),y.X=w(i,y),y.c=w(e,y),x.x=w(t,x),x.X=w(i,x),x.c=w(e,x);function w(q,K){return function(te){var X=[],_e=-1,pe=0,ze=q.length,Fe,vt,ne;for(te instanceof Date||(te=new Date(+te));++_e<ze;)q.charCodeAt(_e)===37&&(X.push(q.slice(pe,_e)),(vt=d$[Fe=q.charAt(++_e)])!=null?Fe=q.charAt(++_e):vt=Fe==="e"?" ":"0",(ne=K[Fe])&&(Fe=ne(te,vt)),X.push(Fe),pe=_e+1);return X.push(q.slice(pe,_e)),X.join("")}}function T(q,K){return function(te){var X=mg(1900,void 0,1),_e=A(X,q,te+="",0),pe,ze;if(_e!=te.length)return null;if("Q"in X)return new Date(X.Q);if("s"in X)return new Date(X.s*1e3+("L"in X?X.L:0));if(K&&!("Z"in X)&&(X.Z=0),"p"in X&&(X.H=X.H%12+X.p*12),X.m===void 0&&(X.m="q"in X?X.q:0),"V"in X){if(X.V<1||X.V>53)return null;"w"in X||(X.w=1),"Z"in X?(pe=DP(mg(X.y,0,1)),ze=pe.getUTCDay(),pe=ze>4||ze===0?bw.ceil(pe):bw(pe),pe=NA.offset(pe,(X.V-1)*7),X.y=pe.getUTCFullYear(),X.m=pe.getUTCMonth(),X.d=pe.getUTCDate()+(X.w+6)%7):(pe=RP(mg(X.y,0,1)),ze=pe.getDay(),pe=ze>4||ze===0?xw.ceil(pe):xw(pe),pe=qy.offset(pe,(X.V-1)*7),X.y=pe.getFullYear(),X.m=pe.getMonth(),X.d=pe.getDate()+(X.w+6)%7)}else("W"in X||"U"in X)&&("w"in X||(X.w="u"in X?X.u%7:"W"in X?1:0),ze="Z"in X?DP(mg(X.y,0,1)).getUTCDay():RP(mg(X.y,0,1)).getDay(),X.m=0,X.d="W"in X?(X.w+6)%7+X.W*7-(ze+5)%7:X.w+X.U*7-(ze+6)%7);return"Z"in X?(X.H+=X.Z/100|0,X.M+=X.Z%100,DP(X)):RP(X)}}function A(q,K,te,X){for(var _e=0,pe=K.length,ze=te.length,Fe,vt;_e<pe;){if(X>=ze)return-1;if(Fe=K.charCodeAt(_e++),Fe===37){if(Fe=K.charAt(_e++),vt=S[Fe in d$?K.charAt(_e++):Fe],!vt||(X=vt(q,te,X))<0)return-1}else if(Fe!=te.charCodeAt(X++))return-1}return X}function C(q,K,te){var X=c.exec(K.slice(te));return X?(q.p=u.get(X[0].toLowerCase()),te+X[0].length):-1}function P(q,K,te){var X=f.exec(K.slice(te));return X?(q.w=p.get(X[0].toLowerCase()),te+X[0].length):-1}function I(q,K,te){var X=h.exec(K.slice(te));return X?(q.w=d.get(X[0].toLowerCase()),te+X[0].length):-1}function M(q,K,te){var X=_.exec(K.slice(te));return X?(q.m=v.get(X[0].toLowerCase()),te+X[0].length):-1}function N(q,K,te){var X=m.exec(K.slice(te));return X?(q.m=g.get(X[0].toLowerCase()),te+X[0].length):-1}function k(q,K,te){return A(q,e,K,te)}function V(q,K,te){return A(q,t,K,te)}function B(q,K,te){return A(q,i,K,te)}function R(q){return a[q.getDay()]}function L(q){return n[q.getDay()]}function D(q){return l[q.getMonth()]}function F(q){return o[q.getMonth()]}function j(q){return s[+(q.getHours()>=12)]}function z(q){return 1+~~(q.getMonth()/3)}function $(q){return a[q.getUTCDay()]}function H(q){return n[q.getUTCDay()]}function G(q){return l[q.getUTCMonth()]}function Y(q){return o[q.getUTCMonth()]}function W(q){return s[+(q.getUTCHours()>=12)]}function ie(q){return 1+~~(q.getUTCMonth()/3)}return{format:function(q){var K=w(q+="",y);return K.toString=function(){return q},K},parse:function(q){var K=T(q+="",!1);return K.toString=function(){return q},K},utcFormat:function(q){var K=w(q+="",x);return K.toString=function(){return q},K},utcParse:function(q){var K=T(q+="",!0);return K.toString=function(){return q},K}}}var d$={"-":"",_:" ",0:"0"},Ji=/^\s*\d+/,d6e=/^%/,f6e=/[\\^$*+?|[\]().{}]/g;function it(r,e,t){var i=r<0?"-":"",s=(i?-r:r)+"",n=s.length;return i+(n<t?new Array(t-n+1).join(e)+s:s)}function p6e(r){return r.replace(f6e,"\\$&")}function gg(r){return new RegExp("^(?:"+r.map(p6e).join("|")+")","i")}function _g(r){return new Map(r.map((e,t)=>[e.toLowerCase(),t]))}function m6e(r,e,t){var i=Ji.exec(e.slice(t,t+1));return i?(r.w=+i[0],t+i[0].length):-1}function g6e(r,e,t){var i=Ji.exec(e.slice(t,t+1));return i?(r.u=+i[0],t+i[0].length):-1}function _6e(r,e,t){var i=Ji.exec(e.slice(t,t+2));return i?(r.U=+i[0],t+i[0].length):-1}function v6e(r,e,t){var i=Ji.exec(e.slice(t,t+2));return i?(r.V=+i[0],t+i[0].length):-1}function y6e(r,e,t){var i=Ji.exec(e.slice(t,t+2));return i?(r.W=+i[0],t+i[0].length):-1}function f$(r,e,t){var i=Ji.exec(e.slice(t,t+4));return i?(r.y=+i[0],t+i[0].length):-1}function p$(r,e,t){var i=Ji.exec(e.slice(t,t+2));return i?(r.y=+i[0]+(+i[0]>68?1900:2e3),t+i[0].length):-1}function S6e(r,e,t){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(t,t+6));return i?(r.Z=i[1]?0:-(i[2]+(i[3]||"00")),t+i[0].length):-1}function x6e(r,e,t){var i=Ji.exec(e.slice(t,t+1));return i?(r.q=i[0]*3-3,t+i[0].length):-1}function b6e(r,e,t){var i=Ji.exec(e.slice(t,t+2));return i?(r.m=i[0]-1,t+i[0].length):-1}function m$(r,e,t){var i=Ji.exec(e.slice(t,t+2));return i?(r.d=+i[0],t+i[0].length):-1}function w6e(r,e,t){var i=Ji.exec(e.slice(t,t+3));return i?(r.m=0,r.d=+i[0],t+i[0].length):-1}function g$(r,e,t){var i=Ji.exec(e.slice(t,t+2));return i?(r.H=+i[0],t+i[0].length):-1}function T6e(r,e,t){var i=Ji.exec(e.slice(t,t+2));return i?(r.M=+i[0],t+i[0].length):-1}function E6e(r,e,t){var i=Ji.exec(e.slice(t,t+2));return i?(r.S=+i[0],t+i[0].length):-1}function A6e(r,e,t){var i=Ji.exec(e.slice(t,t+3));return i?(r.L=+i[0],t+i[0].length):-1}function C6e(r,e,t){var i=Ji.exec(e.slice(t,t+6));return i?(r.L=Math.floor(i[0]/1e3),t+i[0].length):-1}function P6e(r,e,t){var i=d6e.exec(e.slice(t,t+1));return i?t+i[0].length:-1}function I6e(r,e,t){var i=Ji.exec(e.slice(t));return i?(r.Q=+i[0],t+i[0].length):-1}function M6e(r,e,t){var i=Ji.exec(e.slice(t));return i?(r.s=+i[0],t+i[0].length):-1}function _$(r,e){return it(r.getDate(),e,2)}function R6e(r,e){return it(r.getHours(),e,2)}function D6e(r,e){return it(r.getHours()%12||12,e,2)}function L6e(r,e){return it(1+qy.count(tl(r),r),e,3)}function DQ(r,e){return it(r.getMilliseconds(),e,3)}function O6e(r,e){return DQ(r,e)+"000"}function N6e(r,e){return it(r.getMonth()+1,e,2)}function k6e(r,e){return it(r.getMinutes(),e,2)}function F6e(r,e){return it(r.getSeconds(),e,2)}function B6e(r){var e=r.getDay();return e===0?7:e}function U6e(r,e){return it(kA.count(tl(r)-1,r),e,2)}function LQ(r){var e=r.getDay();return e>=4||e===0?Lp(r):Lp.ceil(r)}function z6e(r,e){return r=LQ(r),it(Lp.count(tl(r),r)+(tl(r).getDay()===4),e,2)}function V6e(r){return r.getDay()}function j6e(r,e){return it(xw.count(tl(r)-1,r),e,2)}function $6e(r,e){return it(r.getFullYear()%100,e,2)}function H6e(r,e){return r=LQ(r),it(r.getFullYear()%100,e,2)}function G6e(r,e){return it(r.getFullYear()%1e4,e,4)}function W6e(r,e){var t=r.getDay();return r=t>=4||t===0?Lp(r):Lp.ceil(r),it(r.getFullYear()%1e4,e,4)}function X6e(r){var e=r.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+it(e/60|0,"0",2)+it(e%60,"0",2)}function v$(r,e){return it(r.getUTCDate(),e,2)}function q6e(r,e){return it(r.getUTCHours(),e,2)}function Y6e(r,e){return it(r.getUTCHours()%12||12,e,2)}function K6e(r,e){return it(1+NA.count(il(r),r),e,3)}function OQ(r,e){return it(r.getUTCMilliseconds(),e,3)}function Z6e(r,e){return OQ(r,e)+"000"}function Q6e(r,e){return it(r.getUTCMonth()+1,e,2)}function J6e(r,e){return it(r.getUTCMinutes(),e,2)}function eXe(r,e){return it(r.getUTCSeconds(),e,2)}function tXe(r){var e=r.getUTCDay();return e===0?7:e}function iXe(r,e){return it(FA.count(il(r)-1,r),e,2)}function NQ(r){var e=r.getUTCDay();return e>=4||e===0?Op(r):Op.ceil(r)}function rXe(r,e){return r=NQ(r),it(Op.count(il(r),r)+(il(r).getUTCDay()===4),e,2)}function sXe(r){return r.getUTCDay()}function nXe(r,e){return it(bw.count(il(r)-1,r),e,2)}function aXe(r,e){return it(r.getUTCFullYear()%100,e,2)}function oXe(r,e){return r=NQ(r),it(r.getUTCFullYear()%100,e,2)}function lXe(r,e){return it(r.getUTCFullYear()%1e4,e,4)}function cXe(r,e){var t=r.getUTCDay();return r=t>=4||t===0?Op(r):Op.ceil(r),it(r.getUTCFullYear()%1e4,e,4)}function uXe(){return"+0000"}function y$(){return"%"}function S$(r){return+r}function x$(r){return Math.floor(+r/1e3)}var Pd,kQ,FQ;hXe({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function hXe(r){return Pd=h6e(r),kQ=Pd.format,Pd.parse,FQ=Pd.utcFormat,Pd.utcParse,Pd}function dXe(r){return new Date(r)}function fXe(r){return r instanceof Date?+r:+new Date(+r)}function nk(r,e,t,i,s,n,a,o,l,c){var u=GN(),h=u.invert,d=u.domain,f=c(".%L"),p=c(":%S"),m=c("%I:%M"),g=c("%I %p"),_=c("%a %d"),v=c("%b %d"),y=c("%B"),x=c("%Y");function S(w){return(l(w)<w?f:o(w)<w?p:a(w)<w?m:n(w)<w?g:i(w)<w?s(w)<w?_:v:t(w)<w?y:x)(w)}return u.invert=function(w){return new Date(h(w))},u.domain=function(w){return arguments.length?d(Array.from(w,fXe)):d().map(dXe)},u.ticks=function(w){var T=d();return r(T[0],T[T.length-1],w??10)},u.tickFormat=function(w,T){return T==null?S:c(T)},u.nice=function(w){var T=d();return(!w||typeof w.range!="function")&&(w=e(T[0],T[T.length-1],w??10)),w?d(wQ(T,w)):u},u.copy=function(){return Xy(u,nk(r,e,t,i,s,n,a,o,l,c))},u}function pXe(){return pn.apply(nk(c6e,u6e,tl,rk,kA,qy,tk,JN,Iu,kQ).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function mXe(){return pn.apply(nk(o6e,l6e,il,sk,FA,NA,ik,ek,Iu,FQ).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function BA(){var r=0,e=1,t,i,s,n,a=Fr,o=!1,l;function c(h){return h==null||isNaN(h=+h)?l:a(s===0?.5:(h=(n(h)-t)*s,o?Math.max(0,Math.min(1,h)):h))}c.domain=function(h){return arguments.length?([r,e]=h,t=n(r=+r),i=n(e=+e),s=t===i?0:1/(i-t),c):[r,e]},c.clamp=function(h){return arguments.length?(o=!!h,c):o},c.interpolator=function(h){return arguments.length?(a=h,c):a};function u(h){return function(d){var f,p;return arguments.length?([f,p]=d,a=h(f,p),c):[a(0),a(1)]}}return c.range=u(Cm),c.rangeRound=u(HN),c.unknown=function(h){return arguments.length?(l=h,c):l},function(h){return n=h,t=h(r),i=h(e),s=t===i?0:1/(i-t),c}}function Uc(r,e){return e.domain(r.domain()).interpolator(r.interpolator()).clamp(r.clamp()).unknown(r.unknown())}function BQ(){var r=Bc(BA()(Fr));return r.copy=function(){return Uc(r,BQ())},cl.apply(r,arguments)}function UQ(){var r=qN(BA()).domain([1,10]);return r.copy=function(){return Uc(r,UQ()).base(r.base())},cl.apply(r,arguments)}function zQ(){var r=YN(BA());return r.copy=function(){return Uc(r,zQ()).constant(r.constant())},cl.apply(r,arguments)}function ak(){var r=KN(BA());return r.copy=function(){return Uc(r,ak()).exponent(r.exponent())},cl.apply(r,arguments)}function gXe(){return ak.apply(null,arguments).exponent(.5)}function VQ(){var r=[],e=Fr;function t(i){if(i!=null&&!isNaN(i=+i))return e((Gy(r,i,1)-1)/(r.length-1))}return t.domain=function(i){if(!arguments.length)return r.slice();r=[];for(let s of i)s!=null&&!isNaN(s=+s)&&r.push(s);return r.sort(gc),t},t.interpolator=function(i){return arguments.length?(e=i,t):e},t.range=function(){return r.map((i,s)=>e(s/(r.length-1)))},t.quantiles=function(i){return Array.from({length:i+1},(s,n)=>i8e(r,n/i))},t.copy=function(){return VQ(e).domain(r)},cl.apply(t,arguments)}function UA(){var r=0,e=.5,t=1,i=1,s,n,a,o,l,c=Fr,u,h=!1,d;function f(m){return isNaN(m=+m)?d:(m=.5+((m=+u(m))-n)*(i*m<i*n?o:l),c(h?Math.max(0,Math.min(1,m)):m))}f.domain=function(m){return arguments.length?([r,e,t]=m,s=u(r=+r),n=u(e=+e),a=u(t=+t),o=s===n?0:.5/(n-s),l=n===a?0:.5/(a-n),i=n<s?-1:1,f):[r,e,t]},f.clamp=function(m){return arguments.length?(h=!!m,f):h},f.interpolator=function(m){return arguments.length?(c=m,f):c};function p(m){return function(g){var _,v,y;return arguments.length?([_,v,y]=g,c=P8e(m,[_,v,y]),f):[c(0),c(.5),c(1)]}}return f.range=p(Cm),f.rangeRound=p(HN),f.unknown=function(m){return arguments.length?(d=m,f):d},function(m){return u=m,s=m(r),n=m(e),a=m(t),o=s===n?0:.5/(n-s),l=n===a?0:.5/(a-n),i=n<s?-1:1,f}}function jQ(){var r=Bc(UA()(Fr));return r.copy=function(){return Uc(r,jQ())},cl.apply(r,arguments)}function $Q(){var r=qN(UA()).domain([.1,1,10]);return r.copy=function(){return Uc(r,$Q()).base(r.base())},cl.apply(r,arguments)}function HQ(){var r=YN(UA());return r.copy=function(){return Uc(r,HQ()).constant(r.constant())},cl.apply(r,arguments)}function ok(){var r=KN(UA());return r.copy=function(){return Uc(r,ok()).exponent(r.exponent())},cl.apply(r,arguments)}function _Xe(){return ok.apply(null,arguments).exponent(.5)}const b$=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:Tv,scaleDiverging:jQ,scaleDivergingLog:$Q,scaleDivergingPow:ok,scaleDivergingSqrt:_Xe,scaleDivergingSymlog:HQ,scaleIdentity:bQ,scaleImplicit:kR,scaleLinear:yw,scaleLog:TQ,scaleOrdinal:VN,scalePoint:d_,scalePow:ZN,scaleQuantile:CQ,scaleQuantize:PQ,scaleRadial:AQ,scaleSequential:BQ,scaleSequentialLog:UQ,scaleSequentialPow:ak,scaleSequentialQuantile:VQ,scaleSequentialSqrt:gXe,scaleSequentialSymlog:zQ,scaleSqrt:Z8e,scaleSymlog:EQ,scaleThreshold:IQ,scaleTime:pXe,scaleUtc:mXe,tickFormat:xQ},Symbol.toStringTag,{value:"Module"}));var vXe=vm;function yXe(r,e,t){for(var i=-1,s=r.length;++i<s;){var n=r[i],a=e(n);if(a!=null&&(o===void 0?a===a&&!vXe(a):t(a,o)))var o=a,l=n}return l}var zA=yXe;function SXe(r,e){return r>e}var GQ=SXe,xXe=zA,bXe=GQ,wXe=Am;function TXe(r){return r&&r.length?xXe(r,wXe,bXe):void 0}var EXe=TXe;const VA=pt(EXe);function AXe(r,e){return r<e}var WQ=AXe,CXe=zA,PXe=WQ,IXe=Am;function MXe(r){return r&&r.length?CXe(r,IXe,PXe):void 0}var RXe=MXe;const jA=pt(RXe);var DXe=SN,LXe=Fc,OXe=eQ,NXe=ss;function kXe(r,e){var t=NXe(r)?DXe:OXe;return t(r,LXe(e))}var FXe=kXe,BXe=QZ,UXe=FXe;function zXe(r,e){return BXe(UXe(r,e),1)}var VXe=zXe;const jXe=pt(VXe);var $Xe=kN;function HXe(r,e){return $Xe(r,e)}var GXe=HXe;const Yy=pt(GXe);var Pm=1e9,WXe={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},ck,Qt=!0,hn="[DecimalError] ",Ku=hn+"Invalid argument: ",lk=hn+"Exponent out of range: ",Im=Math.floor,uu=Math.pow,XXe=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,xs,Xi=1e7,$t=7,XQ=9007199254740991,ww=Im(XQ/$t),he={};he.absoluteValue=he.abs=function(){var r=new this.constructor(this);return r.s&&(r.s=1),r};he.comparedTo=he.cmp=function(r){var e,t,i,s,n=this;if(r=new n.constructor(r),n.s!==r.s)return n.s||-r.s;if(n.e!==r.e)return n.e>r.e^n.s<0?1:-1;for(i=n.d.length,s=r.d.length,e=0,t=i<s?i:s;e<t;++e)if(n.d[e]!==r.d[e])return n.d[e]>r.d[e]^n.s<0?1:-1;return i===s?0:i>s^n.s<0?1:-1};he.decimalPlaces=he.dp=function(){var r=this,e=r.d.length-1,t=(e-r.e)*$t;if(e=r.d[e],e)for(;e%10==0;e/=10)t--;return t<0?0:t};he.dividedBy=he.div=function(r){return Ho(this,new this.constructor(r))};he.dividedToIntegerBy=he.idiv=function(r){var e=this,t=e.constructor;return wt(Ho(e,new t(r),0,1),t.precision)};he.equals=he.eq=function(r){return!this.cmp(r)};he.exponent=function(){return Ei(this)};he.greaterThan=he.gt=function(r){return this.cmp(r)>0};he.greaterThanOrEqualTo=he.gte=function(r){return this.cmp(r)>=0};he.isInteger=he.isint=function(){return this.e>this.d.length-2};he.isNegative=he.isneg=function(){return this.s<0};he.isPositive=he.ispos=function(){return this.s>0};he.isZero=function(){return this.s===0};he.lessThan=he.lt=function(r){return this.cmp(r)<0};he.lessThanOrEqualTo=he.lte=function(r){return this.cmp(r)<1};he.logarithm=he.log=function(r){var e,t=this,i=t.constructor,s=i.precision,n=s+5;if(r===void 0)r=new i(10);else if(r=new i(r),r.s<1||r.eq(xs))throw Error(hn+"NaN");if(t.s<1)throw Error(hn+(t.s?"NaN":"-Infinity"));return t.eq(xs)?new i(0):(Qt=!1,e=Ho(Iv(t,n),Iv(r,n),n),Qt=!0,wt(e,s))};he.minus=he.sub=function(r){var e=this;return r=new e.constructor(r),e.s==r.s?KQ(e,r):qQ(e,(r.s=-r.s,r))};he.modulo=he.mod=function(r){var e,t=this,i=t.constructor,s=i.precision;if(r=new i(r),!r.s)throw Error(hn+"NaN");return t.s?(Qt=!1,e=Ho(t,r,0,1).times(r),Qt=!0,t.minus(e)):wt(new i(t),s)};he.naturalExponential=he.exp=function(){return YQ(this)};he.naturalLogarithm=he.ln=function(){return Iv(this)};he.negated=he.neg=function(){var r=new this.constructor(this);return r.s=-r.s||0,r};he.plus=he.add=function(r){var e=this;return r=new e.constructor(r),e.s==r.s?qQ(e,r):KQ(e,(r.s=-r.s,r))};he.precision=he.sd=function(r){var e,t,i,s=this;if(r!==void 0&&r!==!!r&&r!==1&&r!==0)throw Error(Ku+r);if(e=Ei(s)+1,i=s.d.length-1,t=i*$t+1,i=s.d[i],i){for(;i%10==0;i/=10)t--;for(i=s.d[0];i>=10;i/=10)t++}return r&&e>t?e:t};he.squareRoot=he.sqrt=function(){var r,e,t,i,s,n,a,o=this,l=o.constructor;if(o.s<1){if(!o.s)return new l(0);throw Error(hn+"NaN")}for(r=Ei(o),Qt=!1,s=Math.sqrt(+o),s==0||s==1/0?(e=Ma(o.d),(e.length+r)%2==0&&(e+="0"),s=Math.sqrt(e),r=Im((r+1)/2)-(r<0||r%2),s==1/0?e="5e"+r:(e=s.toExponential(),e=e.slice(0,e.indexOf("e")+1)+r),i=new l(e)):i=new l(s.toString()),t=l.precision,s=a=t+3;;)if(n=i,i=n.plus(Ho(o,n,a+2)).times(.5),Ma(n.d).slice(0,a)===(e=Ma(i.d)).slice(0,a)){if(e=e.slice(a-3,a+1),s==a&&e=="4999"){if(wt(n,t+1,0),n.times(n).eq(o)){i=n;break}}else if(e!="9999")break;a+=4}return Qt=!0,wt(i,t)};he.times=he.mul=function(r){var e,t,i,s,n,a,o,l,c,u=this,h=u.constructor,d=u.d,f=(r=new h(r)).d;if(!u.s||!r.s)return new h(0);for(r.s*=u.s,t=u.e+r.e,l=d.length,c=f.length,l<c&&(n=d,d=f,f=n,a=l,l=c,c=a),n=[],a=l+c,i=a;i--;)n.push(0);for(i=c;--i>=0;){for(e=0,s=l+i;s>i;)o=n[s]+f[i]*d[s-i-1]+e,n[s--]=o%Xi|0,e=o/Xi|0;n[s]=(n[s]+e)%Xi|0}for(;!n[--a];)n.pop();return e?++t:n.shift(),r.d=n,r.e=t,Qt?wt(r,h.precision):r};he.toDecimalPlaces=he.todp=function(r,e){var t=this,i=t.constructor;return t=new i(t),r===void 0?t:($a(r,0,Pm),e===void 0?e=i.rounding:$a(e,0,8),wt(t,r+Ei(t)+1,e))};he.toExponential=function(r,e){var t,i=this,s=i.constructor;return r===void 0?t=Ch(i,!0):($a(r,0,Pm),e===void 0?e=s.rounding:$a(e,0,8),i=wt(new s(i),r+1,e),t=Ch(i,!0,r+1)),t};he.toFixed=function(r,e){var t,i,s=this,n=s.constructor;return r===void 0?Ch(s):($a(r,0,Pm),e===void 0?e=n.rounding:$a(e,0,8),i=wt(new n(s),r+Ei(s)+1,e),t=Ch(i.abs(),!1,r+Ei(i)+1),s.isneg()&&!s.isZero()?"-"+t:t)};he.toInteger=he.toint=function(){var r=this,e=r.constructor;return wt(new e(r),Ei(r)+1,e.rounding)};he.toNumber=function(){return+this};he.toPower=he.pow=function(r){var e,t,i,s,n,a,o=this,l=o.constructor,c=12,u=+(r=new l(r));if(!r.s)return new l(xs);if(o=new l(o),!o.s){if(r.s<1)throw Error(hn+"Infinity");return o}if(o.eq(xs))return o;if(i=l.precision,r.eq(xs))return wt(o,i);if(e=r.e,t=r.d.length-1,a=e>=t,n=o.s,a){if((t=u<0?-u:u)<=XQ){for(s=new l(xs),e=Math.ceil(i/$t+4),Qt=!1;t%2&&(s=s.times(o),T$(s.d,e)),t=Im(t/2),t!==0;)o=o.times(o),T$(o.d,e);return Qt=!0,r.s<0?new l(xs).div(s):wt(s,i)}}else if(n<0)throw Error(hn+"NaN");return n=n<0&&r.d[Math.max(e,t)]&1?-1:1,o.s=1,Qt=!1,s=r.times(Iv(o,i+c)),Qt=!0,s=YQ(s),s.s=n,s};he.toPrecision=function(r,e){var t,i,s=this,n=s.constructor;return r===void 0?(t=Ei(s),i=Ch(s,t<=n.toExpNeg||t>=n.toExpPos)):($a(r,1,Pm),e===void 0?e=n.rounding:$a(e,0,8),s=wt(new n(s),r,e),t=Ei(s),i=Ch(s,r<=t||t<=n.toExpNeg,r)),i};he.toSignificantDigits=he.tosd=function(r,e){var t=this,i=t.constructor;return r===void 0?(r=i.precision,e=i.rounding):($a(r,1,Pm),e===void 0?e=i.rounding:$a(e,0,8)),wt(new i(t),r,e)};he.toString=he.valueOf=he.val=he.toJSON=he[Symbol.for("nodejs.util.inspect.custom")]=function(){var r=this,e=Ei(r),t=r.constructor;return Ch(r,e<=t.toExpNeg||e>=t.toExpPos)};function qQ(r,e){var t,i,s,n,a,o,l,c,u=r.constructor,h=u.precision;if(!r.s||!e.s)return e.s||(e=new u(r)),Qt?wt(e,h):e;if(l=r.d,c=e.d,a=r.e,s=e.e,l=l.slice(),n=a-s,n){for(n<0?(i=l,n=-n,o=c.length):(i=c,s=a,o=l.length),a=Math.ceil(h/$t),o=a>o?a+1:o+1,n>o&&(n=o,i.length=1),i.reverse();n--;)i.push(0);i.reverse()}for(o=l.length,n=c.length,o-n<0&&(n=o,i=c,c=l,l=i),t=0;n;)t=(l[--n]=l[n]+c[n]+t)/Xi|0,l[n]%=Xi;for(t&&(l.unshift(t),++s),o=l.length;l[--o]==0;)l.pop();return e.d=l,e.e=s,Qt?wt(e,h):e}function $a(r,e,t){if(r!==~~r||r<e||r>t)throw Error(Ku+r)}function Ma(r){var e,t,i,s=r.length-1,n="",a=r[0];if(s>0){for(n+=a,e=1;e<s;e++)i=r[e]+"",t=$t-i.length,t&&(n+=Dl(t)),n+=i;a=r[e],i=a+"",t=$t-i.length,t&&(n+=Dl(t))}else if(a===0)return"0";for(;a%10===0;)a/=10;return n+a}var Ho=function(){function r(i,s){var n,a=0,o=i.length;for(i=i.slice();o--;)n=i[o]*s+a,i[o]=n%Xi|0,a=n/Xi|0;return a&&i.unshift(a),i}function e(i,s,n,a){var o,l;if(n!=a)l=n>a?1:-1;else for(o=l=0;o<n;o++)if(i[o]!=s[o]){l=i[o]>s[o]?1:-1;break}return l}function t(i,s,n){for(var a=0;n--;)i[n]-=a,a=i[n]<s[n]?1:0,i[n]=a*Xi+i[n]-s[n];for(;!i[0]&&i.length>1;)i.shift()}return function(i,s,n,a){var o,l,c,u,h,d,f,p,m,g,_,v,y,x,S,w,T,A,C=i.constructor,P=i.s==s.s?1:-1,I=i.d,M=s.d;if(!i.s)return new C(i);if(!s.s)throw Error(hn+"Division by zero");for(l=i.e-s.e,T=M.length,S=I.length,f=new C(P),p=f.d=[],c=0;M[c]==(I[c]||0);)++c;if(M[c]>(I[c]||0)&&--l,n==null?v=n=C.precision:a?v=n+(Ei(i)-Ei(s))+1:v=n,v<0)return new C(0);if(v=v/$t+2|0,c=0,T==1)for(u=0,M=M[0],v++;(c<S||u)&&v--;c++)y=u*Xi+(I[c]||0),p[c]=y/M|0,u=y%M|0;else{for(u=Xi/(M[0]+1)|0,u>1&&(M=r(M,u),I=r(I,u),T=M.length,S=I.length),x=T,m=I.slice(0,T),g=m.length;g<T;)m[g++]=0;A=M.slice(),A.unshift(0),w=M[0],M[1]>=Xi/2&&++w;do u=0,o=e(M,m,T,g),o<0?(_=m[0],T!=g&&(_=_*Xi+(m[1]||0)),u=_/w|0,u>1?(u>=Xi&&(u=Xi-1),h=r(M,u),d=h.length,g=m.length,o=e(h,m,d,g),o==1&&(u--,t(h,T<d?A:M,d))):(u==0&&(o=u=1),h=M.slice()),d=h.length,d<g&&h.unshift(0),t(m,h,g),o==-1&&(g=m.length,o=e(M,m,T,g),o<1&&(u++,t(m,T<g?A:M,g))),g=m.length):o===0&&(u++,m=[0]),p[c++]=u,o&&m[0]?m[g++]=I[x]||0:(m=[I[x]],g=1);while((x++<S||m[0]!==void 0)&&v--)}return p[0]||p.shift(),f.e=l,wt(f,a?n+Ei(f)+1:n)}}();function YQ(r,e){var t,i,s,n,a,o,l=0,c=0,u=r.constructor,h=u.precision;if(Ei(r)>16)throw Error(lk+Ei(r));if(!r.s)return new u(xs);for(Qt=!1,o=h,a=new u(.03125);r.abs().gte(.1);)r=r.times(a),c+=5;for(i=Math.log(uu(2,c))/Math.LN10*2+5|0,o+=i,t=s=n=new u(xs),u.precision=o;;){if(s=wt(s.times(r),o),t=t.times(++l),a=n.plus(Ho(s,t,o)),Ma(a.d).slice(0,o)===Ma(n.d).slice(0,o)){for(;c--;)n=wt(n.times(n),o);return u.precision=h,e==null?(Qt=!0,wt(n,h)):n}n=a}}function Ei(r){for(var e=r.e*$t,t=r.d[0];t>=10;t/=10)e++;return e}function LP(r,e,t){if(e>r.LN10.sd())throw Qt=!0,t&&(r.precision=t),Error(hn+"LN10 precision limit exceeded");return wt(new r(r.LN10),e)}function Dl(r){for(var e="";r--;)e+="0";return e}function Iv(r,e){var t,i,s,n,a,o,l,c,u,h=1,d=10,f=r,p=f.d,m=f.constructor,g=m.precision;if(f.s<1)throw Error(hn+(f.s?"NaN":"-Infinity"));if(f.eq(xs))return new m(0);if(e==null?(Qt=!1,c=g):c=e,f.eq(10))return e==null&&(Qt=!0),LP(m,c);if(c+=d,m.precision=c,t=Ma(p),i=t.charAt(0),n=Ei(f),Math.abs(n)<15e14){for(;i<7&&i!=1||i==1&&t.charAt(1)>3;)f=f.times(r),t=Ma(f.d),i=t.charAt(0),h++;n=Ei(f),i>1?(f=new m("0."+t),n++):f=new m(i+"."+t.slice(1))}else return l=LP(m,c+2,g).times(n+""),f=Iv(new m(i+"."+t.slice(1)),c-d).plus(l),m.precision=g,e==null?(Qt=!0,wt(f,g)):f;for(o=a=f=Ho(f.minus(xs),f.plus(xs),c),u=wt(f.times(f),c),s=3;;){if(a=wt(a.times(u),c),l=o.plus(Ho(a,new m(s),c)),Ma(l.d).slice(0,c)===Ma(o.d).slice(0,c))return o=o.times(2),n!==0&&(o=o.plus(LP(m,c+2,g).times(n+""))),o=Ho(o,new m(h),c),m.precision=g,e==null?(Qt=!0,wt(o,g)):o;o=l,s+=2}}function w$(r,e){var t,i,s;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(i=e.search(/e/i))>0?(t<0&&(t=i),t+=+e.slice(i+1),e=e.substring(0,i)):t<0&&(t=e.length),i=0;e.charCodeAt(i)===48;)++i;for(s=e.length;e.charCodeAt(s-1)===48;)--s;if(e=e.slice(i,s),e){if(s-=i,t=t-i-1,r.e=Im(t/$t),r.d=[],i=(t+1)%$t,t<0&&(i+=$t),i<s){for(i&&r.d.push(+e.slice(0,i)),s-=$t;i<s;)r.d.push(+e.slice(i,i+=$t));e=e.slice(i),i=$t-e.length}else i-=s;for(;i--;)e+="0";if(r.d.push(+e),Qt&&(r.e>ww||r.e<-ww))throw Error(lk+t)}else r.s=0,r.e=0,r.d=[0];return r}function wt(r,e,t){var i,s,n,a,o,l,c,u,h=r.d;for(a=1,n=h[0];n>=10;n/=10)a++;if(i=e-a,i<0)i+=$t,s=e,c=h[u=0];else{if(u=Math.ceil((i+1)/$t),n=h.length,u>=n)return r;for(c=n=h[u],a=1;n>=10;n/=10)a++;i%=$t,s=i-$t+a}if(t!==void 0&&(n=uu(10,a-s-1),o=c/n%10|0,l=e<0||h[u+1]!==void 0||c%n,l=t<4?(o||l)&&(t==0||t==(r.s<0?3:2)):o>5||o==5&&(t==4||l||t==6&&(i>0?s>0?c/uu(10,a-s):0:h[u-1])%10&1||t==(r.s<0?8:7))),e<1||!h[0])return l?(n=Ei(r),h.length=1,e=e-n-1,h[0]=uu(10,($t-e%$t)%$t),r.e=Im(-e/$t)||0):(h.length=1,h[0]=r.e=r.s=0),r;if(i==0?(h.length=u,n=1,u--):(h.length=u+1,n=uu(10,$t-i),h[u]=s>0?(c/uu(10,a-s)%uu(10,s)|0)*n:0),l)for(;;)if(u==0){(h[0]+=n)==Xi&&(h[0]=1,++r.e);break}else{if(h[u]+=n,h[u]!=Xi)break;h[u--]=0,n=1}for(i=h.length;h[--i]===0;)h.pop();if(Qt&&(r.e>ww||r.e<-ww))throw Error(lk+Ei(r));return r}function KQ(r,e){var t,i,s,n,a,o,l,c,u,h,d=r.constructor,f=d.precision;if(!r.s||!e.s)return e.s?e.s=-e.s:e=new d(r),Qt?wt(e,f):e;if(l=r.d,h=e.d,i=e.e,c=r.e,l=l.slice(),a=c-i,a){for(u=a<0,u?(t=l,a=-a,o=h.length):(t=h,i=c,o=l.length),s=Math.max(Math.ceil(f/$t),o)+2,a>s&&(a=s,t.length=1),t.reverse(),s=a;s--;)t.push(0);t.reverse()}else{for(s=l.length,o=h.length,u=s<o,u&&(o=s),s=0;s<o;s++)if(l[s]!=h[s]){u=l[s]<h[s];break}a=0}for(u&&(t=l,l=h,h=t,e.s=-e.s),o=l.length,s=h.length-o;s>0;--s)l[o++]=0;for(s=h.length;s>a;){if(l[--s]<h[s]){for(n=s;n&&l[--n]===0;)l[n]=Xi-1;--l[n],l[s]+=Xi}l[s]-=h[s]}for(;l[--o]===0;)l.pop();for(;l[0]===0;l.shift())--i;return l[0]?(e.d=l,e.e=i,Qt?wt(e,f):e):new d(0)}function Ch(r,e,t){var i,s=Ei(r),n=Ma(r.d),a=n.length;return e?(t&&(i=t-a)>0?n=n.charAt(0)+"."+n.slice(1)+Dl(i):a>1&&(n=n.charAt(0)+"."+n.slice(1)),n=n+(s<0?"e":"e+")+s):s<0?(n="0."+Dl(-s-1)+n,t&&(i=t-a)>0&&(n+=Dl(i))):s>=a?(n+=Dl(s+1-a),t&&(i=t-s-1)>0&&(n=n+"."+Dl(i))):((i=s+1)<a&&(n=n.slice(0,i)+"."+n.slice(i)),t&&(i=t-a)>0&&(s+1===a&&(n+="."),n+=Dl(i))),r.s<0?"-"+n:n}function T$(r,e){if(r.length>e)return r.length=e,!0}function ZQ(r){var e,t,i;function s(n){var a=this;if(!(a instanceof s))return new s(n);if(a.constructor=s,n instanceof s){a.s=n.s,a.e=n.e,a.d=(n=n.d)?n.slice():n;return}if(typeof n=="number"){if(n*0!==0)throw Error(Ku+n);if(n>0)a.s=1;else if(n<0)n=-n,a.s=-1;else{a.s=0,a.e=0,a.d=[0];return}if(n===~~n&&n<1e7){a.e=0,a.d=[n];return}return w$(a,n.toString())}else if(typeof n!="string")throw Error(Ku+n);if(n.charCodeAt(0)===45?(n=n.slice(1),a.s=-1):a.s=1,XXe.test(n))w$(a,n);else throw Error(Ku+n)}if(s.prototype=he,s.ROUND_UP=0,s.ROUND_DOWN=1,s.ROUND_CEIL=2,s.ROUND_FLOOR=3,s.ROUND_HALF_UP=4,s.ROUND_HALF_DOWN=5,s.ROUND_HALF_EVEN=6,s.ROUND_HALF_CEIL=7,s.ROUND_HALF_FLOOR=8,s.clone=ZQ,s.config=s.set=qXe,r===void 0&&(r={}),r)for(i=["precision","rounding","toExpNeg","toExpPos","LN10"],e=0;e<i.length;)r.hasOwnProperty(t=i[e++])||(r[t]=this[t]);return s.config(r),s}function qXe(r){if(!r||typeof r!="object")throw Error(hn+"Object expected");var e,t,i,s=["precision",1,Pm,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(e=0;e<s.length;e+=3)if((i=r[t=s[e]])!==void 0)if(Im(i)===i&&i>=s[e+1]&&i<=s[e+2])this[t]=i;else throw Error(Ku+t+": "+i);if((i=r[t="LN10"])!==void 0)if(i==Math.LN10)this[t]=new this(i);else throw Error(Ku+t+": "+i);return this}var ck=ZQ(WXe);xs=new ck(1);const _t=ck;function YXe(r){return JXe(r)||QXe(r)||ZXe(r)||KXe()}function KXe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ZXe(r,e){if(r){if(typeof r=="string")return zR(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return zR(r,e)}}function QXe(r){if(typeof Symbol<"u"&&Symbol.iterator in Object(r))return Array.from(r)}function JXe(r){if(Array.isArray(r))return zR(r)}function zR(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=r[t];return i}var eqe=function(e){return e},QQ={},JQ=function(e){return e===QQ},E$=function(e){return function t(){return arguments.length===0||arguments.length===1&&JQ(arguments.length<=0?void 0:arguments[0])?t:e.apply(void 0,arguments)}},tqe=function r(e,t){return e===1?t:E$(function(){for(var i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];var a=s.filter(function(o){return o!==QQ}).length;return a>=e?t.apply(void 0,s):r(e-a,E$(function(){for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];var u=s.map(function(h){return JQ(h)?l.shift():h});return t.apply(void 0,YXe(u).concat(l))}))})},$A=function(e){return tqe(e.length,e)},VR=function(e,t){for(var i=[],s=e;s<t;++s)i[s-e]=s;return i},iqe=$A(function(r,e){return Array.isArray(e)?e.map(r):Object.keys(e).map(function(t){return e[t]}).map(r)}),rqe=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(!t.length)return eqe;var s=t.reverse(),n=s[0],a=s.slice(1);return function(){return a.reduce(function(o,l){return l(o)},n.apply(void 0,arguments))}},jR=function(e){return Array.isArray(e)?e.reverse():e.split("").reverse.join("")},eJ=function(e){var t=null,i=null;return function(){for(var s=arguments.length,n=new Array(s),a=0;a<s;a++)n[a]=arguments[a];return t&&n.every(function(o,l){return o===t[l]})||(t=n,i=e.apply(void 0,n)),i}};function sqe(r){var e;return r===0?e=1:e=Math.floor(new _t(r).abs().log(10).toNumber())+1,e}function nqe(r,e,t){for(var i=new _t(r),s=0,n=[];i.lt(e)&&s<1e5;)n.push(i.toNumber()),i=i.add(t),s++;return n}var aqe=$A(function(r,e,t){var i=+r,s=+e;return i+t*(s-i)}),oqe=$A(function(r,e,t){var i=e-+r;return i=i||1/0,(t-r)/i}),lqe=$A(function(r,e,t){var i=e-+r;return i=i||1/0,Math.max(0,Math.min(1,(t-r)/i))});const HA={rangeStep:nqe,getDigitCount:sqe,interpolateNumber:aqe,uninterpolateNumber:oqe,uninterpolateTruncation:lqe};function $R(r){return hqe(r)||uqe(r)||tJ(r)||cqe()}function cqe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uqe(r){if(typeof Symbol<"u"&&Symbol.iterator in Object(r))return Array.from(r)}function hqe(r){if(Array.isArray(r))return HR(r)}function Mv(r,e){return pqe(r)||fqe(r,e)||tJ(r,e)||dqe()}function dqe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tJ(r,e){if(r){if(typeof r=="string")return HR(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return HR(r,e)}}function HR(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=r[t];return i}function fqe(r,e){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(r)))){var t=[],i=!0,s=!1,n=void 0;try{for(var a=r[Symbol.iterator](),o;!(i=(o=a.next()).done)&&(t.push(o.value),!(e&&t.length===e));i=!0);}catch(l){s=!0,n=l}finally{try{!i&&a.return!=null&&a.return()}finally{if(s)throw n}}return t}}function pqe(r){if(Array.isArray(r))return r}function iJ(r){var e=Mv(r,2),t=e[0],i=e[1],s=t,n=i;return t>i&&(s=i,n=t),[s,n]}function rJ(r,e,t){if(r.lte(0))return new _t(0);var i=HA.getDigitCount(r.toNumber()),s=new _t(10).pow(i),n=r.div(s),a=i!==1?.05:.1,o=new _t(Math.ceil(n.div(a).toNumber())).add(t).mul(a),l=o.mul(s);return e?l:new _t(Math.ceil(l))}function mqe(r,e,t){var i=1,s=new _t(r);if(!s.isint()&&t){var n=Math.abs(r);n<1?(i=new _t(10).pow(HA.getDigitCount(r)-1),s=new _t(Math.floor(s.div(i).toNumber())).mul(i)):n>1&&(s=new _t(Math.floor(r)))}else r===0?s=new _t(Math.floor((e-1)/2)):t||(s=new _t(Math.floor(r)));var a=Math.floor((e-1)/2),o=rqe(iqe(function(l){return s.add(new _t(l-a).mul(i)).toNumber()}),VR);return o(0,e)}function sJ(r,e,t,i){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((e-r)/(t-1)))return{step:new _t(0),tickMin:new _t(0),tickMax:new _t(0)};var n=rJ(new _t(e).sub(r).div(t-1),i,s),a;r<=0&&e>=0?a=new _t(0):(a=new _t(r).add(e).div(2),a=a.sub(new _t(a).mod(n)));var o=Math.ceil(a.sub(r).div(n).toNumber()),l=Math.ceil(new _t(e).sub(a).div(n).toNumber()),c=o+l+1;return c>t?sJ(r,e,t,i,s+1):(c<t&&(l=e>0?l+(t-c):l,o=e>0?o:o+(t-c)),{step:n,tickMin:a.sub(new _t(o).mul(n)),tickMax:a.add(new _t(l).mul(n))})}function gqe(r){var e=Mv(r,2),t=e[0],i=e[1],s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=Math.max(s,2),o=iJ([t,i]),l=Mv(o,2),c=l[0],u=l[1];if(c===-1/0||u===1/0){var h=u===1/0?[c].concat($R(VR(0,s-1).map(function(){return 1/0}))):[].concat($R(VR(0,s-1).map(function(){return-1/0})),[u]);return t>i?jR(h):h}if(c===u)return mqe(c,s,n);var d=sJ(c,u,a,n),f=d.step,p=d.tickMin,m=d.tickMax,g=HA.rangeStep(p,m.add(new _t(.1).mul(f)),f);return t>i?jR(g):g}function _qe(r,e){var t=Mv(r,2),i=t[0],s=t[1],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=iJ([i,s]),o=Mv(a,2),l=o[0],c=o[1];if(l===-1/0||c===1/0)return[i,s];if(l===c)return[l];var u=Math.max(e,2),h=rJ(new _t(c).sub(l).div(u-1),n,0),d=[].concat($R(HA.rangeStep(new _t(l),new _t(c).sub(new _t(.99).mul(h)),h)),[c]);return i>s?jR(d):d}var vqe=eJ(gqe),yqe=eJ(_qe),Sqe="Invariant failed";function Ph(r,e){throw new Error(Sqe)}var xqe=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function Np(r){"@babel/helpers - typeof";return Np=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Np(r)}function Tw(){return Tw=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},Tw.apply(this,arguments)}function bqe(r,e){return Aqe(r)||Eqe(r,e)||Tqe(r,e)||wqe()}function wqe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Tqe(r,e){if(r){if(typeof r=="string")return A$(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return A$(r,e)}}function A$(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=r[t];return i}function Eqe(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var i,s,n,a,o=[],l=!0,c=!1;try{if(n=(t=t.call(r)).next,e!==0)for(;!(l=(i=n.call(t)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(u){c=!0,s=u}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(c)throw s}}return o}}function Aqe(r){if(Array.isArray(r))return r}function Cqe(r,e){if(r==null)return{};var t=Pqe(r,e),i,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(r,i)&&(t[i]=r[i])}return t}function Pqe(r,e){if(r==null)return{};var t={};for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(e.indexOf(i)>=0)continue;t[i]=r[i]}return t}function Iqe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Mqe(r,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,oJ(i.key),i)}}function Rqe(r,e,t){return e&&Mqe(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function Dqe(r,e,t){return e=Ew(e),Lqe(r,nJ()?Reflect.construct(e,t||[],Ew(r).constructor):e.apply(r,t))}function Lqe(r,e){if(e&&(Np(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Oqe(r)}function Oqe(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function nJ(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(nJ=function(){return!!r})()}function Ew(r){return Ew=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ew(r)}function Nqe(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&GR(r,e)}function GR(r,e){return GR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},GR(r,e)}function aJ(r,e,t){return e=oJ(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function oJ(r){var e=kqe(r,"string");return Np(e)=="symbol"?e:e+""}function kqe(r,e){if(Np(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Np(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var Ky=function(r){function e(){return Iqe(this,e),Dqe(this,e,arguments)}return Nqe(e,r),Rqe(e,[{key:"render",value:function(){var i=this.props,s=i.offset,n=i.layout,a=i.width,o=i.dataKey,l=i.data,c=i.dataPointFormatter,u=i.xAxis,h=i.yAxis,d=Cqe(i,xqe),f=Se(d,!1);this.props.direction==="x"&&u.type!=="number"&&Ph();var p=l.map(function(m){var g=c(m,o),_=g.x,v=g.y,y=g.value,x=g.errorVal;if(!x)return null;var S=[],w,T;if(Array.isArray(x)){var A=bqe(x,2);w=A[0],T=A[1]}else w=T=x;if(n==="vertical"){var C=u.scale,P=v+s,I=P+a,M=P-a,N=C(y-w),k=C(y+T);S.push({x1:k,y1:I,x2:k,y2:M}),S.push({x1:N,y1:P,x2:k,y2:P}),S.push({x1:N,y1:I,x2:N,y2:M})}else if(n==="horizontal"){var V=h.scale,B=_+s,R=B-a,L=B+a,D=V(y-w),F=V(y+T);S.push({x1:R,y1:F,x2:L,y2:F}),S.push({x1:B,y1:D,x2:B,y2:F}),S.push({x1:R,y1:D,x2:L,y2:D})}return U.createElement(et,Tw({className:"recharts-errorBar",key:"bar-".concat(S.map(function(j){return"".concat(j.x1,"-").concat(j.x2,"-").concat(j.y1,"-").concat(j.y2)}))},f),S.map(function(j){return U.createElement("line",Tw({},j,{key:"line-".concat(j.x1,"-").concat(j.x2,"-").concat(j.y1,"-").concat(j.y2)}))}))});return U.createElement(et,{className:"recharts-errorBars"},p)}}])}(U.Component);aJ(Ky,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});aJ(Ky,"displayName","ErrorBar");function Rv(r){"@babel/helpers - typeof";return Rv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Rv(r)}function C$(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function Jc(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?C$(Object(t),!0).forEach(function(i){Fqe(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):C$(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function Fqe(r,e,t){return e=Bqe(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Bqe(r){var e=Uqe(r,"string");return Rv(e)=="symbol"?e:e+""}function Uqe(r,e){if(Rv(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Rv(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}var lJ=function(e){var t=e.children,i=e.formattedGraphicalItems,s=e.legendWidth,n=e.legendContent,a=_s(t,Bf);if(!a)return null;var o=Bf.defaultProps,l=o!==void 0?Jc(Jc({},o),a.props):{},c;return a.props&&a.props.payload?c=a.props&&a.props.payload:n==="children"?c=(i||[]).reduce(function(u,h){var d=h.item,f=h.props,p=f.sectors||f.data||[];return u.concat(p.map(function(m){return{type:a.props.iconType||d.props.legendType,value:m.name,color:m.fill,payload:m}}))},[]):c=(i||[]).map(function(u){var h=u.item,d=h.type.defaultProps,f=d!==void 0?Jc(Jc({},d),h.props):{},p=f.dataKey,m=f.name,g=f.legendType,_=f.hide;return{inactive:_,dataKey:p,type:l.iconType||g||"square",color:uk(h),value:m||p,payload:f}}),Jc(Jc(Jc({},l),Bf.getWithHeight(a,s)),{},{payload:c,item:a})};function Dv(r){"@babel/helpers - typeof";return Dv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dv(r)}function P$(r){return $qe(r)||jqe(r)||Vqe(r)||zqe()}function zqe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Vqe(r,e){if(r){if(typeof r=="string")return WR(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return WR(r,e)}}function jqe(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function $qe(r){if(Array.isArray(r))return WR(r)}function WR(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=r[t];return i}function I$(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function fi(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?I$(Object(t),!0).forEach(function(i){zf(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):I$(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function zf(r,e,t){return e=Hqe(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Hqe(r){var e=Gqe(r,"string");return Dv(e)=="symbol"?e:e+""}function Gqe(r,e){if(Dv(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Dv(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function ki(r,e,t){return Pe(r)||Pe(e)?t:Ui(e)?Cs(r,e,t):Ce(e)?e(r):t}function f_(r,e,t,i){var s=jXe(r,function(o){return ki(o,e)});if(t==="number"){var n=s.filter(function(o){return oe(o)||parseFloat(o)});return n.length?[jA(n),VA(n)]:[1/0,-1/0]}var a=i?s.filter(function(o){return!Pe(o)}):s;return a.map(function(o){return Ui(o)||o instanceof Date?o:""})}var Wqe=function(e){var t,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],s=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,a=-1,o=(t=i==null?void 0:i.length)!==null&&t!==void 0?t:0;if(o<=1)return 0;if(n&&n.axisType==="angleAxis"&&Math.abs(Math.abs(n.range[1]-n.range[0])-360)<=1e-6)for(var l=n.range,c=0;c<o;c++){var u=c>0?s[c-1].coordinate:s[o-1].coordinate,h=s[c].coordinate,d=c>=o-1?s[0].coordinate:s[c+1].coordinate,f=void 0;if(Nr(h-u)!==Nr(d-h)){var p=[];if(Nr(d-h)===Nr(l[1]-l[0])){f=d;var m=h+l[1]-l[0];p[0]=Math.min(m,(m+u)/2),p[1]=Math.max(m,(m+u)/2)}else{f=u;var g=d+l[1]-l[0];p[0]=Math.min(h,(g+h)/2),p[1]=Math.max(h,(g+h)/2)}var _=[Math.min(h,(f+h)/2),Math.max(h,(f+h)/2)];if(e>_[0]&&e<=_[1]||e>=p[0]&&e<=p[1]){a=s[c].index;break}}else{var v=Math.min(u,d),y=Math.max(u,d);if(e>(v+h)/2&&e<=(y+h)/2){a=s[c].index;break}}}else for(var x=0;x<o;x++)if(x===0&&e<=(i[x].coordinate+i[x+1].coordinate)/2||x>0&&x<o-1&&e>(i[x].coordinate+i[x-1].coordinate)/2&&e<=(i[x].coordinate+i[x+1].coordinate)/2||x===o-1&&e>(i[x].coordinate+i[x-1].coordinate)/2){a=i[x].index;break}return a},uk=function(e){var t,i=e,s=i.type.displayName,n=(t=e.type)!==null&&t!==void 0&&t.defaultProps?fi(fi({},e.type.defaultProps),e.props):e.props,a=n.stroke,o=n.fill,l;switch(s){case"Line":l=a;break;case"Area":case"Radar":l=a&&a!=="none"?a:o;break;default:l=o;break}return l},Xqe=function(e){var t=e.barSize,i=e.totalSize,s=e.stackGroups,n=s===void 0?{}:s;if(!n)return{};for(var a={},o=Object.keys(n),l=0,c=o.length;l<c;l++)for(var u=n[o[l]].stackGroups,h=Object.keys(u),d=0,f=h.length;d<f;d++){var p=u[h[d]],m=p.items,g=p.cateAxisId,_=m.filter(function(T){return jo(T.type).indexOf("Bar")>=0});if(_&&_.length){var v=_[0].type.defaultProps,y=v!==void 0?fi(fi({},v),_[0].props):_[0].props,x=y.barSize,S=y[g];a[S]||(a[S]=[]);var w=Pe(x)?t:x;a[S].push({item:_[0],stackList:_.slice(1),barSize:Pe(w)?void 0:kr(w,i,0)})}}return a},qqe=function(e){var t=e.barGap,i=e.barCategoryGap,s=e.bandSize,n=e.sizeList,a=n===void 0?[]:n,o=e.maxBarSize,l=a.length;if(l<1)return null;var c=kr(t,s,0,!0),u,h=[];if(a[0].barSize===+a[0].barSize){var d=!1,f=s/l,p=a.reduce(function(x,S){return x+S.barSize||0},0);p+=(l-1)*c,p>=s&&(p-=(l-1)*c,c=0),p>=s&&f>0&&(d=!0,f*=.9,p=l*f);var m=(s-p)/2>>0,g={offset:m-c,size:0};u=a.reduce(function(x,S){var w={item:S.item,position:{offset:g.offset+g.size+c,size:d?f:S.barSize}},T=[].concat(P$(x),[w]);return g=T[T.length-1].position,S.stackList&&S.stackList.length&&S.stackList.forEach(function(A){T.push({item:A,position:g})}),T},h)}else{var _=kr(i,s,0,!0);s-2*_-(l-1)*c<=0&&(c=0);var v=(s-2*_-(l-1)*c)/l;v>1&&(v>>=0);var y=o===+o?Math.min(v,o):v;u=a.reduce(function(x,S,w){var T=[].concat(P$(x),[{item:S.item,position:{offset:_+(v+c)*w+(v-y)/2,size:y}}]);return S.stackList&&S.stackList.length&&S.stackList.forEach(function(A){T.push({item:A,position:T[T.length-1].position})}),T},h)}return u},Yqe=function(e,t,i,s){var n=i.children,a=i.width,o=i.margin,l=a-(o.left||0)-(o.right||0),c=lJ({children:n,legendWidth:l});if(c){var u=s||{},h=u.width,d=u.height,f=c.align,p=c.verticalAlign,m=c.layout;if((m==="vertical"||m==="horizontal"&&p==="middle")&&f!=="center"&&oe(e[f]))return fi(fi({},e),{},zf({},f,e[f]+(h||0)));if((m==="horizontal"||m==="vertical"&&f==="center")&&p!=="middle"&&oe(e[p]))return fi(fi({},e),{},zf({},p,e[p]+(d||0)))}return e},Kqe=function(e,t,i){return Pe(t)?!0:e==="horizontal"?t==="yAxis":e==="vertical"||i==="x"?t==="xAxis":i==="y"?t==="yAxis":!0},cJ=function(e,t,i,s,n){var a=t.props.children,o=Ps(a,Ky).filter(function(c){return Kqe(s,n,c.props.direction)});if(o&&o.length){var l=o.map(function(c){return c.props.dataKey});return e.reduce(function(c,u){var h=ki(u,i);if(Pe(h))return c;var d=Array.isArray(h)?[jA(h),VA(h)]:[h,h],f=l.reduce(function(p,m){var g=ki(u,m,0),_=d[0]-Math.abs(Array.isArray(g)?g[0]:g),v=d[1]+Math.abs(Array.isArray(g)?g[1]:g);return[Math.min(_,p[0]),Math.max(v,p[1])]},[1/0,-1/0]);return[Math.min(f[0],c[0]),Math.max(f[1],c[1])]},[1/0,-1/0])}return null},Zqe=function(e,t,i,s,n){var a=t.map(function(o){return cJ(e,o,i,n,s)}).filter(function(o){return!Pe(o)});return a&&a.length?a.reduce(function(o,l){return[Math.min(o[0],l[0]),Math.max(o[1],l[1])]},[1/0,-1/0]):null},uJ=function(e,t,i,s,n){var a=t.map(function(l){var c=l.props.dataKey;return i==="number"&&c&&cJ(e,l,c,s)||f_(e,c,i,n)});if(i==="number")return a.reduce(function(l,c){return[Math.min(l[0],c[0]),Math.max(l[1],c[1])]},[1/0,-1/0]);var o={};return a.reduce(function(l,c){for(var u=0,h=c.length;u<h;u++)o[c[u]]||(o[c[u]]=!0,l.push(c[u]));return l},[])},hJ=function(e,t){return e==="horizontal"&&t==="xAxis"||e==="vertical"&&t==="yAxis"||e==="centric"&&t==="angleAxis"||e==="radial"&&t==="radiusAxis"},Mu=function(e,t,i){if(!e)return null;var s=e.scale,n=e.duplicateDomain,a=e.type,o=e.range,l=e.realScaleType==="scaleBand"?s.bandwidth()/2:2,c=(t||i)&&a==="category"&&s.bandwidth?s.bandwidth()/l:0;if(c=e.axisType==="angleAxis"&&(o==null?void 0:o.length)>=2?Nr(o[0]-o[1])*2*c:c,t&&(e.ticks||e.niceTicks)){var u=(e.ticks||e.niceTicks).map(function(h){var d=n?n.indexOf(h):h;return{coordinate:s(d)+c,value:h,offset:c}});return u.filter(function(h){return!Hy(h.coordinate)})}return e.isCategorical&&e.categoricalDomain?e.categoricalDomain.map(function(h,d){return{coordinate:s(h)+c,value:h,index:d,offset:c}}):s.ticks&&!i?s.ticks(e.tickCount).map(function(h){return{coordinate:s(h)+c,value:h,offset:c}}):s.domain().map(function(h,d){return{coordinate:s(h)+c,value:n?n[h]:h,index:d,offset:c}})},OP=new WeakMap,LS=function(e,t){if(typeof t!="function")return e;OP.has(e)||OP.set(e,new WeakMap);var i=OP.get(e);if(i.has(t))return i.get(t);var s=function(){e.apply(void 0,arguments),t.apply(void 0,arguments)};return i.set(t,s),s},dJ=function(e,t,i){var s=e.scale,n=e.type,a=e.layout,o=e.axisType;if(s==="auto")return a==="radial"&&o==="radiusAxis"?{scale:Tv(),realScaleType:"band"}:a==="radial"&&o==="angleAxis"?{scale:yw(),realScaleType:"linear"}:n==="category"&&t&&(t.indexOf("LineChart")>=0||t.indexOf("AreaChart")>=0||t.indexOf("ComposedChart")>=0&&!i)?{scale:d_(),realScaleType:"point"}:n==="category"?{scale:Tv(),realScaleType:"band"}:{scale:yw(),realScaleType:"linear"};if(Th(s)){var l="scale".concat(AA(s));return{scale:(b$[l]||d_)(),realScaleType:b$[l]?l:"point"}}return Ce(s)?{scale:s}:{scale:d_(),realScaleType:"point"}},M$=1e-4,fJ=function(e){var t=e.domain();if(!(!t||t.length<=2)){var i=t.length,s=e.range(),n=Math.min(s[0],s[1])-M$,a=Math.max(s[0],s[1])+M$,o=e(t[0]),l=e(t[i-1]);(o<n||o>a||l<n||l>a)&&e.domain([t[0],t[i-1]])}},Qqe=function(e,t){if(!e)return null;for(var i=0,s=e.length;i<s;i++)if(e[i].item===t)return e[i].position;return null},Jqe=function(e,t){if(!t||t.length!==2||!oe(t[0])||!oe(t[1]))return e;var i=Math.min(t[0],t[1]),s=Math.max(t[0],t[1]),n=[e[0],e[1]];return(!oe(e[0])||e[0]<i)&&(n[0]=i),(!oe(e[1])||e[1]>s)&&(n[1]=s),n[0]>s&&(n[0]=s),n[1]<i&&(n[1]=i),n},e9e=function(e){var t=e.length;if(!(t<=0))for(var i=0,s=e[0].length;i<s;++i)for(var n=0,a=0,o=0;o<t;++o){var l=Hy(e[o][i][1])?e[o][i][0]:e[o][i][1];l>=0?(e[o][i][0]=n,e[o][i][1]=n+l,n=e[o][i][1]):(e[o][i][0]=a,e[o][i][1]=a+l,a=e[o][i][1])}},t9e=function(e){var t=e.length;if(!(t<=0))for(var i=0,s=e[0].length;i<s;++i)for(var n=0,a=0;a<t;++a){var o=Hy(e[a][i][1])?e[a][i][0]:e[a][i][1];o>=0?(e[a][i][0]=n,e[a][i][1]=n+o,n=e[a][i][1]):(e[a][i][0]=0,e[a][i][1]=0)}},i9e={sign:e9e,expand:SUe,none:Cp,silhouette:xUe,wiggle:bUe,positive:t9e},r9e=function(e,t,i){var s=t.map(function(o){return o.props.dataKey}),n=i9e[i],a=yUe().keys(s).value(function(o,l){return+ki(o,l,0)}).order(_R).offset(n);return a(e)},s9e=function(e,t,i,s,n,a){if(!e)return null;var o=a?t.reverse():t,l={},c=o.reduce(function(h,d){var f,p=(f=d.type)!==null&&f!==void 0&&f.defaultProps?fi(fi({},d.type.defaultProps),d.props):d.props,m=p.stackId,g=p.hide;if(g)return h;var _=p[i],v=h[_]||{hasStack:!1,stackGroups:{}};if(Ui(m)){var y=v.stackGroups[m]||{numericAxisId:i,cateAxisId:s,items:[]};y.items.push(d),v.hasStack=!0,v.stackGroups[m]=y}else v.stackGroups[wm("_stackId_")]={numericAxisId:i,cateAxisId:s,items:[d]};return fi(fi({},h),{},zf({},_,v))},l),u={};return Object.keys(c).reduce(function(h,d){var f=c[d];if(f.hasStack){var p={};f.stackGroups=Object.keys(f.stackGroups).reduce(function(m,g){var _=f.stackGroups[g];return fi(fi({},m),{},zf({},g,{numericAxisId:i,cateAxisId:s,items:_.items,stackedData:r9e(e,_.items,n)}))},p)}return fi(fi({},h),{},zf({},d,f))},u)},pJ=function(e,t){var i=t.realScaleType,s=t.type,n=t.tickCount,a=t.originalDomain,o=t.allowDecimals,l=i||t.scale;if(l!=="auto"&&l!=="linear")return null;if(n&&s==="number"&&a&&(a[0]==="auto"||a[1]==="auto")){var c=e.domain();if(!c.length)return null;var u=vqe(c,n,o);return e.domain([jA(u),VA(u)]),{niceTicks:u}}if(n&&s==="number"){var h=e.domain(),d=yqe(h,n,o);return{niceTicks:d}}return null};function R$(r){var e=r.axis,t=r.ticks,i=r.bandSize,s=r.entry,n=r.index,a=r.dataKey;if(e.type==="category"){if(!e.allowDuplicatedCategory&&e.dataKey&&!Pe(s[e.dataKey])){var o=Qb(t,"value",s[e.dataKey]);if(o)return o.coordinate+i/2}return t[n]?t[n].coordinate+i/2:null}var l=ki(s,Pe(a)?e.dataKey:a);return Pe(l)?null:e.scale(l)}var D$=function(e){var t=e.axis,i=e.ticks,s=e.offset,n=e.bandSize,a=e.entry,o=e.index;if(t.type==="category")return i[o]?i[o].coordinate+s:null;var l=ki(a,t.dataKey,t.domain[o]);return Pe(l)?null:t.scale(l)-n/2+s},n9e=function(e){var t=e.numericAxis,i=t.scale.domain();if(t.type==="number"){var s=Math.min(i[0],i[1]),n=Math.max(i[0],i[1]);return s<=0&&n>=0?0:n<0?n:s}return i[0]},a9e=function(e,t){var i,s=(i=e.type)!==null&&i!==void 0&&i.defaultProps?fi(fi({},e.type.defaultProps),e.props):e.props,n=s.stackId;if(Ui(n)){var a=t[n];if(a){var o=a.items.indexOf(e);return o>=0?a.stackedData[o]:null}}return null},o9e=function(e){return e.reduce(function(t,i){return[jA(i.concat([t[0]]).filter(oe)),VA(i.concat([t[1]]).filter(oe))]},[1/0,-1/0])},mJ=function(e,t,i){return Object.keys(e).reduce(function(s,n){var a=e[n],o=a.stackedData,l=o.reduce(function(c,u){var h=o9e(u.slice(t,i+1));return[Math.min(c[0],h[0]),Math.max(c[1],h[1])]},[1/0,-1/0]);return[Math.min(l[0],s[0]),Math.max(l[1],s[1])]},[1/0,-1/0]).map(function(s){return s===1/0||s===-1/0?0:s})},L$=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,O$=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,XR=function(e,t,i){if(Ce(e))return e(t,i);if(!Array.isArray(e))return t;var s=[];if(oe(e[0]))s[0]=i?e[0]:Math.min(e[0],t[0]);else if(L$.test(e[0])){var n=+L$.exec(e[0])[1];s[0]=t[0]-n}else Ce(e[0])?s[0]=e[0](t[0]):s[0]=t[0];if(oe(e[1]))s[1]=i?e[1]:Math.max(e[1],t[1]);else if(O$.test(e[1])){var a=+O$.exec(e[1])[1];s[1]=t[1]+a}else Ce(e[1])?s[1]=e[1](t[1]):s[1]=t[1];return s},Aw=function(e,t,i){if(e&&e.scale&&e.scale.bandwidth){var s=e.scale.bandwidth();if(!i||s>0)return s}if(e&&t&&t.length>=2){for(var n=BN(t,function(h){return h.coordinate}),a=1/0,o=1,l=n.length;o<l;o++){var c=n[o],u=n[o-1];a=Math.min((c.coordinate||0)-(u.coordinate||0),a)}return a===1/0?0:a}return i?void 0:0},N$=function(e,t,i){return!e||!e.length||Yy(e,Cs(i,"type.defaultProps.domain"))?t:e},gJ=function(e,t){var i=e.type.defaultProps?fi(fi({},e.type.defaultProps),e.props):e.props,s=i.dataKey,n=i.name,a=i.unit,o=i.formatter,l=i.tooltipType,c=i.chartType,u=i.hide;return fi(fi({},Se(e,!1)),{},{dataKey:s,unit:a,formatter:o,name:n||s,color:uk(e),value:ki(t,s),type:l,payload:t,chartType:c,hide:u})};function Lv(r){"@babel/helpers - typeof";return Lv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Lv(r)}function k$(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function xo(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?k$(Object(t),!0).forEach(function(i){_J(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):k$(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function _J(r,e,t){return e=l9e(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function l9e(r){var e=c9e(r,"string");return Lv(e)=="symbol"?e:e+""}function c9e(r,e){if(Lv(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Lv(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function u9e(r,e){return p9e(r)||f9e(r,e)||d9e(r,e)||h9e()}function h9e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function d9e(r,e){if(r){if(typeof r=="string")return F$(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return F$(r,e)}}function F$(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=r[t];return i}function f9e(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var i,s,n,a,o=[],l=!0,c=!1;try{if(n=(t=t.call(r)).next,e!==0)for(;!(l=(i=n.call(t)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(u){c=!0,s=u}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(c)throw s}}return o}}function p9e(r){if(Array.isArray(r))return r}var Cw=Math.PI/180,m9e=function(e){return e*180/Math.PI},Lt=function(e,t,i,s){return{x:e+Math.cos(-Cw*s)*i,y:t+Math.sin(-Cw*s)*i}},vJ=function(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(e-(i.left||0)-(i.right||0)),Math.abs(t-(i.top||0)-(i.bottom||0)))/2},g9e=function(e,t,i,s,n){var a=e.width,o=e.height,l=e.startAngle,c=e.endAngle,u=kr(e.cx,a,a/2),h=kr(e.cy,o,o/2),d=vJ(a,o,i),f=kr(e.innerRadius,d,0),p=kr(e.outerRadius,d,d*.8),m=Object.keys(t);return m.reduce(function(g,_){var v=t[_],y=v.domain,x=v.reversed,S;if(Pe(v.range))s==="angleAxis"?S=[l,c]:s==="radiusAxis"&&(S=[f,p]),x&&(S=[S[1],S[0]]);else{S=v.range;var w=S,T=u9e(w,2);l=T[0],c=T[1]}var A=dJ(v,n),C=A.realScaleType,P=A.scale;P.domain(y).range(S),fJ(P);var I=pJ(P,xo(xo({},v),{},{realScaleType:C})),M=xo(xo(xo({},v),I),{},{range:S,radius:p,realScaleType:C,scale:P,cx:u,cy:h,innerRadius:f,outerRadius:p,startAngle:l,endAngle:c});return xo(xo({},g),{},_J({},_,M))},{})},_9e=function(e,t){var i=e.x,s=e.y,n=t.x,a=t.y;return Math.sqrt(Math.pow(i-n,2)+Math.pow(s-a,2))},v9e=function(e,t){var i=e.x,s=e.y,n=t.cx,a=t.cy,o=_9e({x:i,y:s},{x:n,y:a});if(o<=0)return{radius:o};var l=(i-n)/o,c=Math.acos(l);return s>a&&(c=2*Math.PI-c),{radius:o,angle:m9e(c),angleInRadian:c}},y9e=function(e){var t=e.startAngle,i=e.endAngle,s=Math.floor(t/360),n=Math.floor(i/360),a=Math.min(s,n);return{startAngle:t-a*360,endAngle:i-a*360}},S9e=function(e,t){var i=t.startAngle,s=t.endAngle,n=Math.floor(i/360),a=Math.floor(s/360),o=Math.min(n,a);return e+o*360},B$=function(e,t){var i=e.x,s=e.y,n=v9e({x:i,y:s},t),a=n.radius,o=n.angle,l=t.innerRadius,c=t.outerRadius;if(a<l||a>c)return!1;if(a===0)return!0;var u=y9e(t),h=u.startAngle,d=u.endAngle,f=o,p;if(h<=d){for(;f>d;)f-=360;for(;f<h;)f+=360;p=f>=h&&f<=d}else{for(;f>h;)f-=360;for(;f<d;)f+=360;p=f>=d&&f<=h}return p?xo(xo({},t),{},{radius:a,angle:S9e(f,t)}):null},yJ=function(e){return!E.isValidElement(e)&&!Ce(e)&&typeof e!="boolean"?e.className:""};function Ov(r){"@babel/helpers - typeof";return Ov=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ov(r)}var x9e=["offset"];function b9e(r){return A9e(r)||E9e(r)||T9e(r)||w9e()}function w9e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function T9e(r,e){if(r){if(typeof r=="string")return qR(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return qR(r,e)}}function E9e(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function A9e(r){if(Array.isArray(r))return qR(r)}function qR(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=r[t];return i}function C9e(r,e){if(r==null)return{};var t=P9e(r,e),i,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(r,i)&&(t[i]=r[i])}return t}function P9e(r,e){if(r==null)return{};var t={};for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(e.indexOf(i)>=0)continue;t[i]=r[i]}return t}function U$(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function Ii(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?U$(Object(t),!0).forEach(function(i){I9e(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):U$(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function I9e(r,e,t){return e=M9e(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function M9e(r){var e=R9e(r,"string");return Ov(e)=="symbol"?e:e+""}function R9e(r,e){if(Ov(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Ov(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function Nv(){return Nv=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},Nv.apply(this,arguments)}var D9e=function(e){var t=e.value,i=e.formatter,s=Pe(e.children)?t:e.children;return Ce(i)?i(s):s},L9e=function(e,t){var i=Nr(t-e),s=Math.min(Math.abs(t-e),360);return i*s},O9e=function(e,t,i){var s=e.position,n=e.viewBox,a=e.offset,o=e.className,l=n,c=l.cx,u=l.cy,h=l.innerRadius,d=l.outerRadius,f=l.startAngle,p=l.endAngle,m=l.clockWise,g=(h+d)/2,_=L9e(f,p),v=_>=0?1:-1,y,x;s==="insideStart"?(y=f+v*a,x=m):s==="insideEnd"?(y=p-v*a,x=!m):s==="end"&&(y=p+v*a,x=m),x=_<=0?x:!x;var S=Lt(c,u,g,y),w=Lt(c,u,g,y+(x?1:-1)*359),T="M".concat(S.x,",").concat(S.y,`
    A`).concat(g,",").concat(g,",0,1,").concat(x?0:1,`,
    `).concat(w.x,",").concat(w.y),A=Pe(e.id)?wm("recharts-radial-line-"):e.id;return U.createElement("text",Nv({},i,{dominantBaseline:"central",className:Re("recharts-radial-bar-label",o)}),U.createElement("defs",null,U.createElement("path",{id:A,d:T})),U.createElement("textPath",{xlinkHref:"#".concat(A)},t))},N9e=function(e){var t=e.viewBox,i=e.offset,s=e.position,n=t,a=n.cx,o=n.cy,l=n.innerRadius,c=n.outerRadius,u=n.startAngle,h=n.endAngle,d=(u+h)/2;if(s==="outside"){var f=Lt(a,o,c+i,d),p=f.x,m=f.y;return{x:p,y:m,textAnchor:p>=a?"start":"end",verticalAnchor:"middle"}}if(s==="center")return{x:a,y:o,textAnchor:"middle",verticalAnchor:"middle"};if(s==="centerTop")return{x:a,y:o,textAnchor:"middle",verticalAnchor:"start"};if(s==="centerBottom")return{x:a,y:o,textAnchor:"middle",verticalAnchor:"end"};var g=(l+c)/2,_=Lt(a,o,g,d),v=_.x,y=_.y;return{x:v,y,textAnchor:"middle",verticalAnchor:"middle"}},k9e=function(e){var t=e.viewBox,i=e.parentViewBox,s=e.offset,n=e.position,a=t,o=a.x,l=a.y,c=a.width,u=a.height,h=u>=0?1:-1,d=h*s,f=h>0?"end":"start",p=h>0?"start":"end",m=c>=0?1:-1,g=m*s,_=m>0?"end":"start",v=m>0?"start":"end";if(n==="top"){var y={x:o+c/2,y:l-h*s,textAnchor:"middle",verticalAnchor:f};return Ii(Ii({},y),i?{height:Math.max(l-i.y,0),width:c}:{})}if(n==="bottom"){var x={x:o+c/2,y:l+u+d,textAnchor:"middle",verticalAnchor:p};return Ii(Ii({},x),i?{height:Math.max(i.y+i.height-(l+u),0),width:c}:{})}if(n==="left"){var S={x:o-g,y:l+u/2,textAnchor:_,verticalAnchor:"middle"};return Ii(Ii({},S),i?{width:Math.max(S.x-i.x,0),height:u}:{})}if(n==="right"){var w={x:o+c+g,y:l+u/2,textAnchor:v,verticalAnchor:"middle"};return Ii(Ii({},w),i?{width:Math.max(i.x+i.width-w.x,0),height:u}:{})}var T=i?{width:c,height:u}:{};return n==="insideLeft"?Ii({x:o+g,y:l+u/2,textAnchor:v,verticalAnchor:"middle"},T):n==="insideRight"?Ii({x:o+c-g,y:l+u/2,textAnchor:_,verticalAnchor:"middle"},T):n==="insideTop"?Ii({x:o+c/2,y:l+d,textAnchor:"middle",verticalAnchor:p},T):n==="insideBottom"?Ii({x:o+c/2,y:l+u-d,textAnchor:"middle",verticalAnchor:f},T):n==="insideTopLeft"?Ii({x:o+g,y:l+d,textAnchor:v,verticalAnchor:p},T):n==="insideTopRight"?Ii({x:o+c-g,y:l+d,textAnchor:_,verticalAnchor:p},T):n==="insideBottomLeft"?Ii({x:o+g,y:l+u-d,textAnchor:v,verticalAnchor:f},T):n==="insideBottomRight"?Ii({x:o+c-g,y:l+u-d,textAnchor:_,verticalAnchor:f},T):ym(n)&&(oe(n.x)||Cu(n.x))&&(oe(n.y)||Cu(n.y))?Ii({x:o+kr(n.x,c),y:l+kr(n.y,u),textAnchor:"end",verticalAnchor:"end"},T):Ii({x:o+c/2,y:l+u/2,textAnchor:"middle",verticalAnchor:"middle"},T)},F9e=function(e){return"cx"in e&&oe(e.cx)};function Ki(r){var e=r.offset,t=e===void 0?5:e,i=C9e(r,x9e),s=Ii({offset:t},i),n=s.viewBox,a=s.position,o=s.value,l=s.children,c=s.content,u=s.className,h=u===void 0?"":u,d=s.textBreakAll;if(!n||Pe(o)&&Pe(l)&&!E.isValidElement(c)&&!Ce(c))return null;if(E.isValidElement(c))return E.cloneElement(c,s);var f;if(Ce(c)){if(f=E.createElement(c,s),E.isValidElement(f))return f}else f=D9e(s);var p=F9e(n),m=Se(s,!0);if(p&&(a==="insideStart"||a==="insideEnd"||a==="end"))return O9e(s,f,m);var g=p?N9e(s):k9e(s);return U.createElement(Ah,Nv({className:Re("recharts-label",h)},m,g,{breakAll:d}),f)}Ki.displayName="Label";var SJ=function(e){var t=e.cx,i=e.cy,s=e.angle,n=e.startAngle,a=e.endAngle,o=e.r,l=e.radius,c=e.innerRadius,u=e.outerRadius,h=e.x,d=e.y,f=e.top,p=e.left,m=e.width,g=e.height,_=e.clockWise,v=e.labelViewBox;if(v)return v;if(oe(m)&&oe(g)){if(oe(h)&&oe(d))return{x:h,y:d,width:m,height:g};if(oe(f)&&oe(p))return{x:f,y:p,width:m,height:g}}return oe(h)&&oe(d)?{x:h,y:d,width:0,height:0}:oe(t)&&oe(i)?{cx:t,cy:i,startAngle:n||s||0,endAngle:a||s||0,innerRadius:c||0,outerRadius:u||l||o||0,clockWise:_}:e.viewBox?e.viewBox:{}},B9e=function(e,t){return e?e===!0?U.createElement(Ki,{key:"label-implicit",viewBox:t}):Ui(e)?U.createElement(Ki,{key:"label-implicit",viewBox:t,value:e}):E.isValidElement(e)?e.type===Ki?E.cloneElement(e,{key:"label-implicit",viewBox:t}):U.createElement(Ki,{key:"label-implicit",content:e,viewBox:t}):Ce(e)?U.createElement(Ki,{key:"label-implicit",content:e,viewBox:t}):ym(e)?U.createElement(Ki,Nv({viewBox:t},e,{key:"label-implicit"})):null:null},U9e=function(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&i&&!e.label)return null;var s=e.children,n=SJ(e),a=Ps(s,Ki).map(function(l,c){return E.cloneElement(l,{viewBox:t||n,key:"label-".concat(c)})});if(!i)return a;var o=B9e(e.label,t||n);return[o].concat(b9e(a))};Ki.parseViewBox=SJ;Ki.renderCallByParent=U9e;function z9e(r){var e=r==null?0:r.length;return e?r[e-1]:void 0}var V9e=z9e;const j9e=pt(V9e);function kv(r){"@babel/helpers - typeof";return kv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kv(r)}var $9e=["valueAccessor"],H9e=["data","dataKey","clockWise","id","textBreakAll"];function G9e(r){return Y9e(r)||q9e(r)||X9e(r)||W9e()}function W9e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function X9e(r,e){if(r){if(typeof r=="string")return YR(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return YR(r,e)}}function q9e(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function Y9e(r){if(Array.isArray(r))return YR(r)}function YR(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=r[t];return i}function Pw(){return Pw=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},Pw.apply(this,arguments)}function z$(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function V$(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?z$(Object(t),!0).forEach(function(i){K9e(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):z$(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function K9e(r,e,t){return e=Z9e(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Z9e(r){var e=Q9e(r,"string");return kv(e)=="symbol"?e:e+""}function Q9e(r,e){if(kv(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(kv(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function j$(r,e){if(r==null)return{};var t=J9e(r,e),i,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(r,i)&&(t[i]=r[i])}return t}function J9e(r,e){if(r==null)return{};var t={};for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(e.indexOf(i)>=0)continue;t[i]=r[i]}return t}var eYe=function(e){return Array.isArray(e.value)?j9e(e.value):e.value};function Go(r){var e=r.valueAccessor,t=e===void 0?eYe:e,i=j$(r,$9e),s=i.data,n=i.dataKey,a=i.clockWise,o=i.id,l=i.textBreakAll,c=j$(i,H9e);return!s||!s.length?null:U.createElement(et,{className:"recharts-label-list"},s.map(function(u,h){var d=Pe(n)?t(u,h):ki(u&&u.payload,n),f=Pe(o)?{}:{id:"".concat(o,"-").concat(h)};return U.createElement(Ki,Pw({},Se(u,!0),c,f,{parentViewBox:u.parentViewBox,value:d,textBreakAll:l,viewBox:Ki.parseViewBox(Pe(a)?u:V$(V$({},u),{},{clockWise:a})),key:"label-".concat(h),index:h}))}))}Go.displayName="LabelList";function tYe(r,e){return r?r===!0?U.createElement(Go,{key:"labelList-implicit",data:e}):U.isValidElement(r)||Ce(r)?U.createElement(Go,{key:"labelList-implicit",data:e,content:r}):ym(r)?U.createElement(Go,Pw({data:e},r,{key:"labelList-implicit"})):null:null}function iYe(r,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!r||!r.children&&t&&!r.label)return null;var i=r.children,s=Ps(i,Go).map(function(a,o){return E.cloneElement(a,{data:e,key:"labelList-".concat(o)})});if(!t)return s;var n=tYe(r.label,e);return[n].concat(G9e(s))}Go.renderCallByParent=iYe;function Fv(r){"@babel/helpers - typeof";return Fv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fv(r)}function KR(){return KR=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},KR.apply(this,arguments)}function $$(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function H$(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?$$(Object(t),!0).forEach(function(i){rYe(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):$$(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function rYe(r,e,t){return e=sYe(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function sYe(r){var e=nYe(r,"string");return Fv(e)=="symbol"?e:e+""}function nYe(r,e){if(Fv(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Fv(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}var aYe=function(e,t){var i=Nr(t-e),s=Math.min(Math.abs(t-e),359.999);return i*s},OS=function(e){var t=e.cx,i=e.cy,s=e.radius,n=e.angle,a=e.sign,o=e.isExternal,l=e.cornerRadius,c=e.cornerIsExternal,u=l*(o?1:-1)+s,h=Math.asin(l/u)/Cw,d=c?n:n+a*h,f=Lt(t,i,u,d),p=Lt(t,i,s,d),m=c?n-a*h:n,g=Lt(t,i,u*Math.cos(h*Cw),m);return{center:f,circleTangency:p,lineTangency:g,theta:h}},xJ=function(e){var t=e.cx,i=e.cy,s=e.innerRadius,n=e.outerRadius,a=e.startAngle,o=e.endAngle,l=aYe(a,o),c=a+l,u=Lt(t,i,n,a),h=Lt(t,i,n,c),d="M ".concat(u.x,",").concat(u.y,`
    A `).concat(n,",").concat(n,`,0,
    `).concat(+(Math.abs(l)>180),",").concat(+(a>c),`,
    `).concat(h.x,",").concat(h.y,`
  `);if(s>0){var f=Lt(t,i,s,a),p=Lt(t,i,s,c);d+="L ".concat(p.x,",").concat(p.y,`
            A `).concat(s,",").concat(s,`,0,
            `).concat(+(Math.abs(l)>180),",").concat(+(a<=c),`,
            `).concat(f.x,",").concat(f.y," Z")}else d+="L ".concat(t,",").concat(i," Z");return d},oYe=function(e){var t=e.cx,i=e.cy,s=e.innerRadius,n=e.outerRadius,a=e.cornerRadius,o=e.forceCornerRadius,l=e.cornerIsExternal,c=e.startAngle,u=e.endAngle,h=Nr(u-c),d=OS({cx:t,cy:i,radius:n,angle:c,sign:h,cornerRadius:a,cornerIsExternal:l}),f=d.circleTangency,p=d.lineTangency,m=d.theta,g=OS({cx:t,cy:i,radius:n,angle:u,sign:-h,cornerRadius:a,cornerIsExternal:l}),_=g.circleTangency,v=g.lineTangency,y=g.theta,x=l?Math.abs(c-u):Math.abs(c-u)-m-y;if(x<0)return o?"M ".concat(p.x,",").concat(p.y,`
        a`).concat(a,",").concat(a,",0,0,1,").concat(a*2,`,0
        a`).concat(a,",").concat(a,",0,0,1,").concat(-a*2,`,0
      `):xJ({cx:t,cy:i,innerRadius:s,outerRadius:n,startAngle:c,endAngle:u});var S="M ".concat(p.x,",").concat(p.y,`
    A`).concat(a,",").concat(a,",0,0,").concat(+(h<0),",").concat(f.x,",").concat(f.y,`
    A`).concat(n,",").concat(n,",0,").concat(+(x>180),",").concat(+(h<0),",").concat(_.x,",").concat(_.y,`
    A`).concat(a,",").concat(a,",0,0,").concat(+(h<0),",").concat(v.x,",").concat(v.y,`
  `);if(s>0){var w=OS({cx:t,cy:i,radius:s,angle:c,sign:h,isExternal:!0,cornerRadius:a,cornerIsExternal:l}),T=w.circleTangency,A=w.lineTangency,C=w.theta,P=OS({cx:t,cy:i,radius:s,angle:u,sign:-h,isExternal:!0,cornerRadius:a,cornerIsExternal:l}),I=P.circleTangency,M=P.lineTangency,N=P.theta,k=l?Math.abs(c-u):Math.abs(c-u)-C-N;if(k<0&&a===0)return"".concat(S,"L").concat(t,",").concat(i,"Z");S+="L".concat(M.x,",").concat(M.y,`
      A`).concat(a,",").concat(a,",0,0,").concat(+(h<0),",").concat(I.x,",").concat(I.y,`
      A`).concat(s,",").concat(s,",0,").concat(+(k>180),",").concat(+(h>0),",").concat(T.x,",").concat(T.y,`
      A`).concat(a,",").concat(a,",0,0,").concat(+(h<0),",").concat(A.x,",").concat(A.y,"Z")}else S+="L".concat(t,",").concat(i,"Z");return S},lYe={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},bJ=function(e){var t=H$(H$({},lYe),e),i=t.cx,s=t.cy,n=t.innerRadius,a=t.outerRadius,o=t.cornerRadius,l=t.forceCornerRadius,c=t.cornerIsExternal,u=t.startAngle,h=t.endAngle,d=t.className;if(a<n||u===h)return null;var f=Re("recharts-sector",d),p=a-n,m=kr(o,p,0,!0),g;return m>0&&Math.abs(u-h)<360?g=oYe({cx:i,cy:s,innerRadius:n,outerRadius:a,cornerRadius:Math.min(m,p/2),forceCornerRadius:l,cornerIsExternal:c,startAngle:u,endAngle:h}):g=xJ({cx:i,cy:s,innerRadius:n,outerRadius:a,startAngle:u,endAngle:h}),U.createElement("path",KR({},Se(t,!0),{className:f,d:g,role:"img"}))};function Bv(r){"@babel/helpers - typeof";return Bv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bv(r)}function ZR(){return ZR=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},ZR.apply(this,arguments)}function G$(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function W$(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?G$(Object(t),!0).forEach(function(i){cYe(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):G$(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function cYe(r,e,t){return e=uYe(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function uYe(r){var e=hYe(r,"string");return Bv(e)=="symbol"?e:e+""}function hYe(r,e){if(Bv(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Bv(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}var X$={curveBasisClosed:lUe,curveBasisOpen:cUe,curveBasis:oUe,curveBumpX:XBe,curveBumpY:qBe,curveLinearClosed:uUe,curveLinear:PA,curveMonotoneX:hUe,curveMonotoneY:dUe,curveNatural:fUe,curveStep:pUe,curveStepAfter:gUe,curveStepBefore:mUe},NS=function(e){return e.x===+e.x&&e.y===+e.y},vg=function(e){return e.x},yg=function(e){return e.y},dYe=function(e,t){if(Ce(e))return e;var i="curve".concat(AA(e));return(i==="curveMonotone"||i==="curveBump")&&t?X$["".concat(i).concat(t==="vertical"?"Y":"X")]:X$[i]||PA},fYe=function(e){var t=e.type,i=t===void 0?"linear":t,s=e.points,n=s===void 0?[]:s,a=e.baseLine,o=e.layout,l=e.connectNulls,c=l===void 0?!1:l,u=dYe(i,o),h=c?n.filter(function(m){return NS(m)}):n,d;if(Array.isArray(a)){var f=c?a.filter(function(m){return NS(m)}):a,p=h.map(function(m,g){return W$(W$({},m),{},{base:f[g]})});return o==="vertical"?d=ES().y(yg).x1(vg).x0(function(m){return m.base.x}):d=ES().x(vg).y1(yg).y0(function(m){return m.base.y}),d.defined(NS).curve(u),d(p)}return o==="vertical"&&oe(a)?d=ES().y(yg).x1(vg).x0(a):oe(a)?d=ES().x(vg).y1(yg).y0(a):d=vZ().x(vg).y(yg),d.defined(NS).curve(u),d(h)},Iw=function(e){var t=e.className,i=e.points,s=e.path,n=e.pathRef;if((!i||!i.length)&&!s)return null;var a=i&&i.length?fYe(e):s;return E.createElement("path",ZR({},Se(e,!1),Jb(e),{className:Re("recharts-curve",t),d:a,ref:n}))},wJ={exports:{}},pYe="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",mYe=pYe,gYe=mYe;function TJ(){}function EJ(){}EJ.resetWarningCache=TJ;var _Ye=function(){function r(i,s,n,a,o,l){if(l!==gYe){var c=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw c.name="Invariant Violation",c}}r.isRequired=r;function e(){return r}var t={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:e,element:r,elementType:r,instanceOf:e,node:r,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:EJ,resetWarningCache:TJ};return t.PropTypes=t,t};wJ.exports=_Ye();var vYe=wJ.exports;const ot=pt(vYe);var yYe=Object.getOwnPropertyNames,SYe=Object.getOwnPropertySymbols,xYe=Object.prototype.hasOwnProperty;function q$(r,e){return function(i,s,n){return r(i,s,n)&&e(i,s,n)}}function kS(r){return function(t,i,s){if(!t||!i||typeof t!="object"||typeof i!="object")return r(t,i,s);var n=s.cache,a=n.get(t),o=n.get(i);if(a&&o)return a===i&&o===t;n.set(t,i),n.set(i,t);var l=r(t,i,s);return n.delete(t),n.delete(i),l}}function Y$(r){return yYe(r).concat(SYe(r))}var bYe=Object.hasOwn||function(r,e){return xYe.call(r,e)};function jh(r,e){return r===e||!r&&!e&&r!==r&&e!==e}var wYe="__v",TYe="__o",EYe="_owner",K$=Object.getOwnPropertyDescriptor,Z$=Object.keys;function AYe(r,e,t){var i=r.length;if(e.length!==i)return!1;for(;i-- >0;)if(!t.equals(r[i],e[i],i,i,r,e,t))return!1;return!0}function CYe(r,e){return jh(r.getTime(),e.getTime())}function PYe(r,e){return r.name===e.name&&r.message===e.message&&r.cause===e.cause&&r.stack===e.stack}function IYe(r,e){return r===e}function Q$(r,e,t){var i=r.size;if(i!==e.size)return!1;if(!i)return!0;for(var s=new Array(i),n=r.entries(),a,o,l=0;(a=n.next())&&!a.done;){for(var c=e.entries(),u=!1,h=0;(o=c.next())&&!o.done;){if(s[h]){h++;continue}var d=a.value,f=o.value;if(t.equals(d[0],f[0],l,h,r,e,t)&&t.equals(d[1],f[1],d[0],f[0],r,e,t)){u=s[h]=!0;break}h++}if(!u)return!1;l++}return!0}var MYe=jh;function RYe(r,e,t){var i=Z$(r),s=i.length;if(Z$(e).length!==s)return!1;for(;s-- >0;)if(!AJ(r,e,t,i[s]))return!1;return!0}function Sg(r,e,t){var i=Y$(r),s=i.length;if(Y$(e).length!==s)return!1;for(var n,a,o;s-- >0;)if(n=i[s],!AJ(r,e,t,n)||(a=K$(r,n),o=K$(e,n),(a||o)&&(!a||!o||a.configurable!==o.configurable||a.enumerable!==o.enumerable||a.writable!==o.writable)))return!1;return!0}function DYe(r,e){return jh(r.valueOf(),e.valueOf())}function LYe(r,e){return r.source===e.source&&r.flags===e.flags}function J$(r,e,t){var i=r.size;if(i!==e.size)return!1;if(!i)return!0;for(var s=new Array(i),n=r.values(),a,o;(a=n.next())&&!a.done;){for(var l=e.values(),c=!1,u=0;(o=l.next())&&!o.done;){if(!s[u]&&t.equals(a.value,o.value,a.value,o.value,r,e,t)){c=s[u]=!0;break}u++}if(!c)return!1}return!0}function OYe(r,e){var t=r.length;if(e.length!==t)return!1;for(;t-- >0;)if(r[t]!==e[t])return!1;return!0}function NYe(r,e){return r.hostname===e.hostname&&r.pathname===e.pathname&&r.protocol===e.protocol&&r.port===e.port&&r.hash===e.hash&&r.username===e.username&&r.password===e.password}function AJ(r,e,t,i){return(i===EYe||i===TYe||i===wYe)&&(r.$$typeof||e.$$typeof)?!0:bYe(e,i)&&t.equals(r[i],e[i],i,i,r,e,t)}var kYe="[object Arguments]",FYe="[object Boolean]",BYe="[object Date]",UYe="[object Error]",zYe="[object Map]",VYe="[object Number]",jYe="[object Object]",$Ye="[object RegExp]",HYe="[object Set]",GYe="[object String]",WYe="[object URL]",XYe=Array.isArray,e5=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,t5=Object.assign,qYe=Object.prototype.toString.call.bind(Object.prototype.toString);function YYe(r){var e=r.areArraysEqual,t=r.areDatesEqual,i=r.areErrorsEqual,s=r.areFunctionsEqual,n=r.areMapsEqual,a=r.areNumbersEqual,o=r.areObjectsEqual,l=r.arePrimitiveWrappersEqual,c=r.areRegExpsEqual,u=r.areSetsEqual,h=r.areTypedArraysEqual,d=r.areUrlsEqual;return function(p,m,g){if(p===m)return!0;if(p==null||m==null)return!1;var _=typeof p;if(_!==typeof m)return!1;if(_!=="object")return _==="number"?a(p,m,g):_==="function"?s(p,m,g):!1;var v=p.constructor;if(v!==m.constructor)return!1;if(v===Object)return o(p,m,g);if(XYe(p))return e(p,m,g);if(e5!=null&&e5(p))return h(p,m,g);if(v===Date)return t(p,m,g);if(v===RegExp)return c(p,m,g);if(v===Map)return n(p,m,g);if(v===Set)return u(p,m,g);var y=qYe(p);return y===BYe?t(p,m,g):y===$Ye?c(p,m,g):y===zYe?n(p,m,g):y===HYe?u(p,m,g):y===jYe?typeof p.then!="function"&&typeof m.then!="function"&&o(p,m,g):y===WYe?d(p,m,g):y===UYe?i(p,m,g):y===kYe?o(p,m,g):y===FYe||y===VYe||y===GYe?l(p,m,g):!1}}function KYe(r){var e=r.circular,t=r.createCustomConfig,i=r.strict,s={areArraysEqual:i?Sg:AYe,areDatesEqual:CYe,areErrorsEqual:PYe,areFunctionsEqual:IYe,areMapsEqual:i?q$(Q$,Sg):Q$,areNumbersEqual:MYe,areObjectsEqual:i?Sg:RYe,arePrimitiveWrappersEqual:DYe,areRegExpsEqual:LYe,areSetsEqual:i?q$(J$,Sg):J$,areTypedArraysEqual:i?Sg:OYe,areUrlsEqual:NYe};if(t&&(s=t5({},s,t(s))),e){var n=kS(s.areArraysEqual),a=kS(s.areMapsEqual),o=kS(s.areObjectsEqual),l=kS(s.areSetsEqual);s=t5({},s,{areArraysEqual:n,areMapsEqual:a,areObjectsEqual:o,areSetsEqual:l})}return s}function ZYe(r){return function(e,t,i,s,n,a,o){return r(e,t,o)}}function QYe(r){var e=r.circular,t=r.comparator,i=r.createState,s=r.equals,n=r.strict;if(i)return function(l,c){var u=i(),h=u.cache,d=h===void 0?e?new WeakMap:void 0:h,f=u.meta;return t(l,c,{cache:d,equals:s,meta:f,strict:n})};if(e)return function(l,c){return t(l,c,{cache:new WeakMap,equals:s,meta:void 0,strict:n})};var a={cache:void 0,equals:s,meta:void 0,strict:n};return function(l,c){return t(l,c,a)}}var JYe=zc();zc({strict:!0});zc({circular:!0});zc({circular:!0,strict:!0});zc({createInternalComparator:function(){return jh}});zc({strict:!0,createInternalComparator:function(){return jh}});zc({circular:!0,createInternalComparator:function(){return jh}});zc({circular:!0,createInternalComparator:function(){return jh},strict:!0});function zc(r){r===void 0&&(r={});var e=r.circular,t=e===void 0?!1:e,i=r.createInternalComparator,s=r.createState,n=r.strict,a=n===void 0?!1:n,o=KYe(r),l=YYe(o),c=i?i(l):ZYe(l);return QYe({circular:t,comparator:l,createState:s,equals:c,strict:a})}function eKe(r){typeof requestAnimationFrame<"u"&&requestAnimationFrame(r)}function i5(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=-1,i=function s(n){t<0&&(t=n),n-t>e?(r(n),t=-1):eKe(s)};requestAnimationFrame(i)}function QR(r){"@babel/helpers - typeof";return QR=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},QR(r)}function tKe(r){return nKe(r)||sKe(r)||rKe(r)||iKe()}function iKe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rKe(r,e){if(r){if(typeof r=="string")return r5(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return r5(r,e)}}function r5(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=r[t];return i}function sKe(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function nKe(r){if(Array.isArray(r))return r}function aKe(){var r={},e=function(){return null},t=!1,i=function s(n){if(!t){if(Array.isArray(n)){if(!n.length)return;var a=n,o=tKe(a),l=o[0],c=o.slice(1);if(typeof l=="number"){i5(s.bind(null,c),l);return}s(l),i5(s.bind(null,c));return}QR(n)==="object"&&(r=n,e(r)),typeof n=="function"&&n()}};return{stop:function(){t=!0},start:function(n){t=!1,i(n)},subscribe:function(n){return e=n,function(){e=function(){return null}}}}}function Uv(r){"@babel/helpers - typeof";return Uv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Uv(r)}function s5(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function n5(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?s5(Object(t),!0).forEach(function(i){CJ(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):s5(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function CJ(r,e,t){return e=oKe(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function oKe(r){var e=lKe(r,"string");return Uv(e)==="symbol"?e:String(e)}function lKe(r,e){if(Uv(r)!=="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Uv(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}var cKe=function(e,t){return[Object.keys(e),Object.keys(t)].reduce(function(i,s){return i.filter(function(n){return s.includes(n)})})},uKe=function(e){return e},hKe=function(e){return e.replace(/([A-Z])/g,function(t){return"-".concat(t.toLowerCase())})},p_=function(e,t){return Object.keys(t).reduce(function(i,s){return n5(n5({},i),{},CJ({},s,e(s,t[s])))},{})},a5=function(e,t,i){return e.map(function(s){return"".concat(hKe(s)," ").concat(t,"ms ").concat(i)}).join(",")};function dKe(r,e){return mKe(r)||pKe(r,e)||PJ(r,e)||fKe()}function fKe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pKe(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var i,s,n,a,o=[],l=!0,c=!1;try{if(n=(t=t.call(r)).next,e!==0)for(;!(l=(i=n.call(t)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(u){c=!0,s=u}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(c)throw s}}return o}}function mKe(r){if(Array.isArray(r))return r}function gKe(r){return yKe(r)||vKe(r)||PJ(r)||_Ke()}function _Ke(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function PJ(r,e){if(r){if(typeof r=="string")return JR(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return JR(r,e)}}function vKe(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function yKe(r){if(Array.isArray(r))return JR(r)}function JR(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=r[t];return i}var Mw=1e-4,IJ=function(e,t){return[0,3*e,3*t-6*e,3*e-3*t+1]},MJ=function(e,t){return e.map(function(i,s){return i*Math.pow(t,s)}).reduce(function(i,s){return i+s})},o5=function(e,t){return function(i){var s=IJ(e,t);return MJ(s,i)}},SKe=function(e,t){return function(i){var s=IJ(e,t),n=[].concat(gKe(s.map(function(a,o){return a*o}).slice(1)),[0]);return MJ(n,i)}},l5=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var s=t[0],n=t[1],a=t[2],o=t[3];if(t.length===1)switch(t[0]){case"linear":s=0,n=0,a=1,o=1;break;case"ease":s=.25,n=.1,a=.25,o=1;break;case"ease-in":s=.42,n=0,a=1,o=1;break;case"ease-out":s=.42,n=0,a=.58,o=1;break;case"ease-in-out":s=0,n=0,a=.58,o=1;break;default:{var l=t[0].split("(");if(l[0]==="cubic-bezier"&&l[1].split(")")[0].split(",").length===4){var c=l[1].split(")")[0].split(",").map(function(g){return parseFloat(g)}),u=dKe(c,4);s=u[0],n=u[1],a=u[2],o=u[3]}}}var h=o5(s,a),d=o5(n,o),f=SKe(s,a),p=function(_){return _>1?1:_<0?0:_},m=function(_){for(var v=_>1?1:_,y=v,x=0;x<8;++x){var S=h(y)-v,w=f(y);if(Math.abs(S-v)<Mw||w<Mw)return d(y);y=p(y-S/w)}return d(y)};return m.isStepper=!1,m},xKe=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.stiff,i=t===void 0?100:t,s=e.damping,n=s===void 0?8:s,a=e.dt,o=a===void 0?17:a,l=function(u,h,d){var f=-(u-h)*i,p=d*n,m=d+(f-p)*o/1e3,g=d*o/1e3+u;return Math.abs(g-h)<Mw&&Math.abs(m)<Mw?[h,0]:[g,m]};return l.isStepper=!0,l.dt=o,l},bKe=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var s=t[0];if(typeof s=="string")switch(s){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return l5(s);case"spring":return xKe();default:if(s.split("(")[0]==="cubic-bezier")return l5(s)}return typeof s=="function"?s:null};function zv(r){"@babel/helpers - typeof";return zv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zv(r)}function c5(r){return EKe(r)||TKe(r)||RJ(r)||wKe()}function wKe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function TKe(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function EKe(r){if(Array.isArray(r))return tD(r)}function u5(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function tr(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?u5(Object(t),!0).forEach(function(i){eD(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):u5(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function eD(r,e,t){return e=AKe(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function AKe(r){var e=CKe(r,"string");return zv(e)==="symbol"?e:String(e)}function CKe(r,e){if(zv(r)!=="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(zv(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function PKe(r,e){return RKe(r)||MKe(r,e)||RJ(r,e)||IKe()}function IKe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RJ(r,e){if(r){if(typeof r=="string")return tD(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return tD(r,e)}}function tD(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=r[t];return i}function MKe(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var i,s,n,a,o=[],l=!0,c=!1;try{if(n=(t=t.call(r)).next,e!==0)for(;!(l=(i=n.call(t)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(u){c=!0,s=u}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(c)throw s}}return o}}function RKe(r){if(Array.isArray(r))return r}var Rw=function(e,t,i){return e+(t-e)*i},iD=function(e){var t=e.from,i=e.to;return t!==i},DKe=function r(e,t,i){var s=p_(function(n,a){if(iD(a)){var o=e(a.from,a.to,a.velocity),l=PKe(o,2),c=l[0],u=l[1];return tr(tr({},a),{},{from:c,velocity:u})}return a},t);return i<1?p_(function(n,a){return iD(a)?tr(tr({},a),{},{velocity:Rw(a.velocity,s[n].velocity,i),from:Rw(a.from,s[n].from,i)}):a},t):r(e,s,i-1)};const LKe=function(r,e,t,i,s){var n=cKe(r,e),a=n.reduce(function(g,_){return tr(tr({},g),{},eD({},_,[r[_],e[_]]))},{}),o=n.reduce(function(g,_){return tr(tr({},g),{},eD({},_,{from:r[_],velocity:0,to:e[_]}))},{}),l=-1,c,u,h=function(){return null},d=function(){return p_(function(_,v){return v.from},o)},f=function(){return!Object.values(o).filter(iD).length},p=function(_){c||(c=_);var v=_-c,y=v/t.dt;o=DKe(t,o,y),s(tr(tr(tr({},r),e),d())),c=_,f()||(l=requestAnimationFrame(h))},m=function(_){u||(u=_);var v=(_-u)/i,y=p_(function(S,w){return Rw.apply(void 0,c5(w).concat([t(v)]))},a);if(s(tr(tr(tr({},r),e),y)),v<1)l=requestAnimationFrame(h);else{var x=p_(function(S,w){return Rw.apply(void 0,c5(w).concat([t(1)]))},a);s(tr(tr(tr({},r),e),x))}};return h=t.isStepper?p:m,function(){return requestAnimationFrame(h),function(){cancelAnimationFrame(l)}}};function kp(r){"@babel/helpers - typeof";return kp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kp(r)}var OKe=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function NKe(r,e){if(r==null)return{};var t=kKe(r,e),i,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(r,i)&&(t[i]=r[i])}return t}function kKe(r,e){if(r==null)return{};var t={},i=Object.keys(r),s,n;for(n=0;n<i.length;n++)s=i[n],!(e.indexOf(s)>=0)&&(t[s]=r[s]);return t}function NP(r){return zKe(r)||UKe(r)||BKe(r)||FKe()}function FKe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function BKe(r,e){if(r){if(typeof r=="string")return rD(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return rD(r,e)}}function UKe(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function zKe(r){if(Array.isArray(r))return rD(r)}function rD(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=r[t];return i}function h5(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function Tn(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?h5(Object(t),!0).forEach(function(i){Lg(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):h5(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function Lg(r,e,t){return e=DJ(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function VKe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function jKe(r,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,DJ(i.key),i)}}function $Ke(r,e,t){return e&&jKe(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function DJ(r){var e=HKe(r,"string");return kp(e)==="symbol"?e:String(e)}function HKe(r,e){if(kp(r)!=="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(kp(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function GKe(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&sD(r,e)}function sD(r,e){return sD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},sD(r,e)}function WKe(r){var e=XKe();return function(){var i=Dw(r),s;if(e){var n=Dw(this).constructor;s=Reflect.construct(i,arguments,n)}else s=i.apply(this,arguments);return nD(this,s)}}function nD(r,e){if(e&&(kp(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return aD(r)}function aD(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function XKe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Dw(r){return Dw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Dw(r)}var Ha=function(r){GKe(t,r);var e=WKe(t);function t(i,s){var n;VKe(this,t),n=e.call(this,i,s);var a=n.props,o=a.isActive,l=a.attributeName,c=a.from,u=a.to,h=a.steps,d=a.children,f=a.duration;if(n.handleStyleChange=n.handleStyleChange.bind(aD(n)),n.changeStyle=n.changeStyle.bind(aD(n)),!o||f<=0)return n.state={style:{}},typeof d=="function"&&(n.state={style:u}),nD(n);if(h&&h.length)n.state={style:h[0].style};else if(c){if(typeof d=="function")return n.state={style:c},nD(n);n.state={style:l?Lg({},l,c):c}}else n.state={style:{}};return n}return $Ke(t,[{key:"componentDidMount",value:function(){var s=this.props,n=s.isActive,a=s.canBegin;this.mounted=!0,!(!n||!a)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(s){var n=this.props,a=n.isActive,o=n.canBegin,l=n.attributeName,c=n.shouldReAnimate,u=n.to,h=n.from,d=this.state.style;if(o){if(!a){var f={style:l?Lg({},l,u):u};this.state&&d&&(l&&d[l]!==u||!l&&d!==u)&&this.setState(f);return}if(!(JYe(s.to,u)&&s.canBegin&&s.isActive)){var p=!s.canBegin||!s.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var m=p||c?h:s.to;if(this.state&&d){var g={style:l?Lg({},l,m):m};(l&&d[l]!==m||!l&&d!==m)&&this.setState(g)}this.runAnimation(Tn(Tn({},this.props),{},{from:m,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var s=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),s&&s()}},{key:"handleStyleChange",value:function(s){this.changeStyle(s)}},{key:"changeStyle",value:function(s){this.mounted&&this.setState({style:s})}},{key:"runJSAnimation",value:function(s){var n=this,a=s.from,o=s.to,l=s.duration,c=s.easing,u=s.begin,h=s.onAnimationEnd,d=s.onAnimationStart,f=LKe(a,o,bKe(c),l,this.changeStyle),p=function(){n.stopJSAnimation=f()};this.manager.start([d,u,p,l,h])}},{key:"runStepAnimation",value:function(s){var n=this,a=s.steps,o=s.begin,l=s.onAnimationStart,c=a[0],u=c.style,h=c.duration,d=h===void 0?0:h,f=function(m,g,_){if(_===0)return m;var v=g.duration,y=g.easing,x=y===void 0?"ease":y,S=g.style,w=g.properties,T=g.onAnimationEnd,A=_>0?a[_-1]:g,C=w||Object.keys(S);if(typeof x=="function"||x==="spring")return[].concat(NP(m),[n.runJSAnimation.bind(n,{from:A.style,to:S,duration:v,easing:x}),v]);var P=a5(C,v,x),I=Tn(Tn(Tn({},A.style),S),{},{transition:P});return[].concat(NP(m),[I,v,T]).filter(uKe)};return this.manager.start([l].concat(NP(a.reduce(f,[u,Math.max(d,o)])),[s.onAnimationEnd]))}},{key:"runAnimation",value:function(s){this.manager||(this.manager=aKe());var n=s.begin,a=s.duration,o=s.attributeName,l=s.to,c=s.easing,u=s.onAnimationStart,h=s.onAnimationEnd,d=s.steps,f=s.children,p=this.manager;if(this.unSubscribe=p.subscribe(this.handleStyleChange),typeof c=="function"||typeof f=="function"||c==="spring"){this.runJSAnimation(s);return}if(d.length>1){this.runStepAnimation(s);return}var m=o?Lg({},o,l):l,g=a5(Object.keys(m),a,c);p.start([u,n,Tn(Tn({},m),{},{transition:g}),a,h])}},{key:"render",value:function(){var s=this.props,n=s.children;s.begin;var a=s.duration;s.attributeName,s.easing;var o=s.isActive;s.steps,s.from,s.to,s.canBegin,s.onAnimationEnd,s.shouldReAnimate,s.onAnimationReStart;var l=NKe(s,OKe),c=E.Children.count(n),u=this.state.style;if(typeof n=="function")return n(u);if(!o||c===0||a<=0)return n;var h=function(f){var p=f.props,m=p.style,g=m===void 0?{}:m,_=p.className,v=E.cloneElement(f,Tn(Tn({},l),{},{style:Tn(Tn({},g),u),className:_}));return v};return c===1?h(E.Children.only(n)):U.createElement("div",null,E.Children.map(n,function(d){return h(d)}))}}]),t}(E.PureComponent);Ha.displayName="Animate";Ha.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};Ha.propTypes={from:ot.oneOfType([ot.object,ot.string]),to:ot.oneOfType([ot.object,ot.string]),attributeName:ot.string,duration:ot.number,begin:ot.number,easing:ot.oneOfType([ot.string,ot.func]),steps:ot.arrayOf(ot.shape({duration:ot.number.isRequired,style:ot.object.isRequired,easing:ot.oneOfType([ot.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),ot.func]),properties:ot.arrayOf("string"),onAnimationEnd:ot.func})),children:ot.oneOfType([ot.node,ot.func]),isActive:ot.bool,canBegin:ot.bool,onAnimationEnd:ot.func,shouldReAnimate:ot.bool,onAnimationStart:ot.func,onAnimationReStart:ot.func};function Vv(r){"@babel/helpers - typeof";return Vv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vv(r)}function Lw(){return Lw=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},Lw.apply(this,arguments)}function qKe(r,e){return QKe(r)||ZKe(r,e)||KKe(r,e)||YKe()}function YKe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function KKe(r,e){if(r){if(typeof r=="string")return d5(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return d5(r,e)}}function d5(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=r[t];return i}function ZKe(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var i,s,n,a,o=[],l=!0,c=!1;try{if(n=(t=t.call(r)).next,e!==0)for(;!(l=(i=n.call(t)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(u){c=!0,s=u}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(c)throw s}}return o}}function QKe(r){if(Array.isArray(r))return r}function f5(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function p5(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?f5(Object(t),!0).forEach(function(i){JKe(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):f5(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function JKe(r,e,t){return e=e7e(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function e7e(r){var e=t7e(r,"string");return Vv(e)=="symbol"?e:e+""}function t7e(r,e){if(Vv(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Vv(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}var m5=function(e,t,i,s,n){var a=Math.min(Math.abs(i)/2,Math.abs(s)/2),o=s>=0?1:-1,l=i>=0?1:-1,c=s>=0&&i>=0||s<0&&i<0?1:0,u;if(a>0&&n instanceof Array){for(var h=[0,0,0,0],d=0,f=4;d<f;d++)h[d]=n[d]>a?a:n[d];u="M".concat(e,",").concat(t+o*h[0]),h[0]>0&&(u+="A ".concat(h[0],",").concat(h[0],",0,0,").concat(c,",").concat(e+l*h[0],",").concat(t)),u+="L ".concat(e+i-l*h[1],",").concat(t),h[1]>0&&(u+="A ".concat(h[1],",").concat(h[1],",0,0,").concat(c,`,
        `).concat(e+i,",").concat(t+o*h[1])),u+="L ".concat(e+i,",").concat(t+s-o*h[2]),h[2]>0&&(u+="A ".concat(h[2],",").concat(h[2],",0,0,").concat(c,`,
        `).concat(e+i-l*h[2],",").concat(t+s)),u+="L ".concat(e+l*h[3],",").concat(t+s),h[3]>0&&(u+="A ".concat(h[3],",").concat(h[3],",0,0,").concat(c,`,
        `).concat(e,",").concat(t+s-o*h[3])),u+="Z"}else if(a>0&&n===+n&&n>0){var p=Math.min(a,n);u="M ".concat(e,",").concat(t+o*p,`
            A `).concat(p,",").concat(p,",0,0,").concat(c,",").concat(e+l*p,",").concat(t,`
            L `).concat(e+i-l*p,",").concat(t,`
            A `).concat(p,",").concat(p,",0,0,").concat(c,",").concat(e+i,",").concat(t+o*p,`
            L `).concat(e+i,",").concat(t+s-o*p,`
            A `).concat(p,",").concat(p,",0,0,").concat(c,",").concat(e+i-l*p,",").concat(t+s,`
            L `).concat(e+l*p,",").concat(t+s,`
            A `).concat(p,",").concat(p,",0,0,").concat(c,",").concat(e,",").concat(t+s-o*p," Z")}else u="M ".concat(e,",").concat(t," h ").concat(i," v ").concat(s," h ").concat(-i," Z");return u},i7e=function(e,t){if(!e||!t)return!1;var i=e.x,s=e.y,n=t.x,a=t.y,o=t.width,l=t.height;if(Math.abs(o)>0&&Math.abs(l)>0){var c=Math.min(n,n+o),u=Math.max(n,n+o),h=Math.min(a,a+l),d=Math.max(a,a+l);return i>=c&&i<=u&&s>=h&&s<=d}return!1},r7e={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},hk=function(e){var t=p5(p5({},r7e),e),i=E.useRef(),s=E.useState(-1),n=qKe(s,2),a=n[0],o=n[1];E.useEffect(function(){if(i.current&&i.current.getTotalLength)try{var x=i.current.getTotalLength();x&&o(x)}catch{}},[]);var l=t.x,c=t.y,u=t.width,h=t.height,d=t.radius,f=t.className,p=t.animationEasing,m=t.animationDuration,g=t.animationBegin,_=t.isAnimationActive,v=t.isUpdateAnimationActive;if(l!==+l||c!==+c||u!==+u||h!==+h||u===0||h===0)return null;var y=Re("recharts-rectangle",f);return v?U.createElement(Ha,{canBegin:a>0,from:{width:u,height:h,x:l,y:c},to:{width:u,height:h,x:l,y:c},duration:m,animationEasing:p,isActive:v},function(x){var S=x.width,w=x.height,T=x.x,A=x.y;return U.createElement(Ha,{canBegin:a>0,from:"0px ".concat(a===-1?1:a,"px"),to:"".concat(a,"px 0px"),attributeName:"strokeDasharray",begin:g,duration:m,isActive:_,easing:p},U.createElement("path",Lw({},Se(t,!0),{className:y,d:m5(T,A,S,w,d),ref:i})))}):U.createElement("path",Lw({},Se(t,!0),{className:y,d:m5(l,c,u,h,d)}))},s7e=["points","className","baseLinePoints","connectNulls"];function Jd(){return Jd=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},Jd.apply(this,arguments)}function n7e(r,e){if(r==null)return{};var t=a7e(r,e),i,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(r,i)&&(t[i]=r[i])}return t}function a7e(r,e){if(r==null)return{};var t={};for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(e.indexOf(i)>=0)continue;t[i]=r[i]}return t}function g5(r){return u7e(r)||c7e(r)||l7e(r)||o7e()}function o7e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function l7e(r,e){if(r){if(typeof r=="string")return oD(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return oD(r,e)}}function c7e(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function u7e(r){if(Array.isArray(r))return oD(r)}function oD(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=r[t];return i}var _5=function(e){return e&&e.x===+e.x&&e.y===+e.y},h7e=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=[[]];return e.forEach(function(i){_5(i)?t[t.length-1].push(i):t[t.length-1].length>0&&t.push([])}),_5(e[0])&&t[t.length-1].push(e[0]),t[t.length-1].length<=0&&(t=t.slice(0,-1)),t},m_=function(e,t){var i=h7e(e);t&&(i=[i.reduce(function(n,a){return[].concat(g5(n),g5(a))},[])]);var s=i.map(function(n){return n.reduce(function(a,o,l){return"".concat(a).concat(l===0?"M":"L").concat(o.x,",").concat(o.y)},"")}).join("");return i.length===1?"".concat(s,"Z"):s},d7e=function(e,t,i){var s=m_(e,i);return"".concat(s.slice(-1)==="Z"?s.slice(0,-1):s,"L").concat(m_(t.reverse(),i).slice(1))},f7e=function(e){var t=e.points,i=e.className,s=e.baseLinePoints,n=e.connectNulls,a=n7e(e,s7e);if(!t||!t.length)return null;var o=Re("recharts-polygon",i);if(s&&s.length){var l=a.stroke&&a.stroke!=="none",c=d7e(t,s,n);return U.createElement("g",{className:o},U.createElement("path",Jd({},Se(a,!0),{fill:c.slice(-1)==="Z"?a.fill:"none",stroke:"none",d:c})),l?U.createElement("path",Jd({},Se(a,!0),{fill:"none",d:m_(t,n)})):null,l?U.createElement("path",Jd({},Se(a,!0),{fill:"none",d:m_(s,n)})):null)}var u=m_(t,n);return U.createElement("path",Jd({},Se(a,!0),{fill:u.slice(-1)==="Z"?a.fill:"none",className:o,d:u}))};function lD(){return lD=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},lD.apply(this,arguments)}var GA=function(e){var t=e.cx,i=e.cy,s=e.r,n=e.className,a=Re("recharts-dot",n);return t===+t&&i===+i&&s===+s?E.createElement("circle",lD({},Se(e,!1),Jb(e),{className:a,cx:t,cy:i,r:s})):null};function jv(r){"@babel/helpers - typeof";return jv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jv(r)}var p7e=["x","y","top","left","width","height","className"];function cD(){return cD=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},cD.apply(this,arguments)}function v5(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function m7e(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?v5(Object(t),!0).forEach(function(i){g7e(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):v5(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function g7e(r,e,t){return e=_7e(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function _7e(r){var e=v7e(r,"string");return jv(e)=="symbol"?e:e+""}function v7e(r,e){if(jv(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(jv(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function y7e(r,e){if(r==null)return{};var t=S7e(r,e),i,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(r,i)&&(t[i]=r[i])}return t}function S7e(r,e){if(r==null)return{};var t={};for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(e.indexOf(i)>=0)continue;t[i]=r[i]}return t}var x7e=function(e,t,i,s,n,a){return"M".concat(e,",").concat(n,"v").concat(s,"M").concat(a,",").concat(t,"h").concat(i)},b7e=function(e){var t=e.x,i=t===void 0?0:t,s=e.y,n=s===void 0?0:s,a=e.top,o=a===void 0?0:a,l=e.left,c=l===void 0?0:l,u=e.width,h=u===void 0?0:u,d=e.height,f=d===void 0?0:d,p=e.className,m=y7e(e,p7e),g=m7e({x:i,y:n,top:o,left:c,width:h,height:f},m);return!oe(i)||!oe(n)||!oe(h)||!oe(f)||!oe(o)||!oe(c)?null:U.createElement("path",cD({},Se(g,!0),{className:Re("recharts-cross",p),d:x7e(i,n,h,f,o,c)}))},w7e=zA,T7e=GQ,E7e=Fc;function A7e(r,e){return r&&r.length?w7e(r,E7e(e),T7e):void 0}var C7e=A7e;const P7e=pt(C7e);var I7e=zA,M7e=Fc,R7e=WQ;function D7e(r,e){return r&&r.length?I7e(r,M7e(e),R7e):void 0}var L7e=D7e;const O7e=pt(L7e);var N7e=["cx","cy","angle","ticks","axisLine"],k7e=["ticks","tick","angle","tickFormatter","stroke"];function Fp(r){"@babel/helpers - typeof";return Fp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fp(r)}function g_(){return g_=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},g_.apply(this,arguments)}function y5(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function eu(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?y5(Object(t),!0).forEach(function(i){WA(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):y5(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function S5(r,e){if(r==null)return{};var t=F7e(r,e),i,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(r,i)&&(t[i]=r[i])}return t}function F7e(r,e){if(r==null)return{};var t={};for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(e.indexOf(i)>=0)continue;t[i]=r[i]}return t}function B7e(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function x5(r,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,OJ(i.key),i)}}function U7e(r,e,t){return e&&x5(r.prototype,e),t&&x5(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}function z7e(r,e,t){return e=Ow(e),V7e(r,LJ()?Reflect.construct(e,t||[],Ow(r).constructor):e.apply(r,t))}function V7e(r,e){if(e&&(Fp(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return j7e(r)}function j7e(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function LJ(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(LJ=function(){return!!r})()}function Ow(r){return Ow=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ow(r)}function $7e(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&uD(r,e)}function uD(r,e){return uD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},uD(r,e)}function WA(r,e,t){return e=OJ(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function OJ(r){var e=H7e(r,"string");return Fp(e)=="symbol"?e:e+""}function H7e(r,e){if(Fp(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Fp(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var XA=function(r){function e(){return B7e(this,e),z7e(this,e,arguments)}return $7e(e,r),U7e(e,[{key:"getTickValueCoord",value:function(i){var s=i.coordinate,n=this.props,a=n.angle,o=n.cx,l=n.cy;return Lt(o,l,s,a)}},{key:"getTickTextAnchor",value:function(){var i=this.props.orientation,s;switch(i){case"left":s="end";break;case"right":s="start";break;default:s="middle";break}return s}},{key:"getViewBox",value:function(){var i=this.props,s=i.cx,n=i.cy,a=i.angle,o=i.ticks,l=P7e(o,function(u){return u.coordinate||0}),c=O7e(o,function(u){return u.coordinate||0});return{cx:s,cy:n,startAngle:a,endAngle:a,innerRadius:c.coordinate||0,outerRadius:l.coordinate||0}}},{key:"renderAxisLine",value:function(){var i=this.props,s=i.cx,n=i.cy,a=i.angle,o=i.ticks,l=i.axisLine,c=S5(i,N7e),u=o.reduce(function(p,m){return[Math.min(p[0],m.coordinate),Math.max(p[1],m.coordinate)]},[1/0,-1/0]),h=Lt(s,n,u[0],a),d=Lt(s,n,u[1],a),f=eu(eu(eu({},Se(c,!1)),{},{fill:"none"},Se(l,!1)),{},{x1:h.x,y1:h.y,x2:d.x,y2:d.y});return U.createElement("line",g_({className:"recharts-polar-radius-axis-line"},f))}},{key:"renderTicks",value:function(){var i=this,s=this.props,n=s.ticks,a=s.tick,o=s.angle,l=s.tickFormatter,c=s.stroke,u=S5(s,k7e),h=this.getTickTextAnchor(),d=Se(u,!1),f=Se(a,!1),p=n.map(function(m,g){var _=i.getTickValueCoord(m),v=eu(eu(eu(eu({textAnchor:h,transform:"rotate(".concat(90-o,", ").concat(_.x,", ").concat(_.y,")")},d),{},{stroke:"none",fill:c},f),{},{index:g},_),{},{payload:m});return U.createElement(et,g_({className:Re("recharts-polar-radius-axis-tick",yJ(a)),key:"tick-".concat(m.coordinate)},Eh(i.props,m,g)),e.renderTickItem(a,v,l?l(m.value,g):m.value))});return U.createElement(et,{className:"recharts-polar-radius-axis-ticks"},p)}},{key:"render",value:function(){var i=this.props,s=i.ticks,n=i.axisLine,a=i.tick;return!s||!s.length?null:U.createElement(et,{className:Re("recharts-polar-radius-axis",this.props.className)},n&&this.renderAxisLine(),a&&this.renderTicks(),Ki.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(i,s,n){var a;return U.isValidElement(i)?a=U.cloneElement(i,s):Ce(i)?a=i(s):a=U.createElement(Ah,g_({},s,{className:"recharts-polar-radius-axis-tick-value"}),n),a}}])}(E.PureComponent);WA(XA,"displayName","PolarRadiusAxis");WA(XA,"axisType","radiusAxis");WA(XA,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function Bp(r){"@babel/helpers - typeof";return Bp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bp(r)}function fu(){return fu=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},fu.apply(this,arguments)}function b5(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function tu(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?b5(Object(t),!0).forEach(function(i){qA(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):b5(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function G7e(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function w5(r,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,kJ(i.key),i)}}function W7e(r,e,t){return e&&w5(r.prototype,e),t&&w5(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}function X7e(r,e,t){return e=Nw(e),q7e(r,NJ()?Reflect.construct(e,t||[],Nw(r).constructor):e.apply(r,t))}function q7e(r,e){if(e&&(Bp(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Y7e(r)}function Y7e(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function NJ(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(NJ=function(){return!!r})()}function Nw(r){return Nw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Nw(r)}function K7e(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&hD(r,e)}function hD(r,e){return hD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},hD(r,e)}function qA(r,e,t){return e=kJ(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function kJ(r){var e=Z7e(r,"string");return Bp(e)=="symbol"?e:e+""}function Z7e(r,e){if(Bp(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Bp(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var Q7e=Math.PI/180,T5=1e-5,YA=function(r){function e(){return G7e(this,e),X7e(this,e,arguments)}return K7e(e,r),W7e(e,[{key:"getTickLineCoord",value:function(i){var s=this.props,n=s.cx,a=s.cy,o=s.radius,l=s.orientation,c=s.tickSize,u=c||8,h=Lt(n,a,o,i.coordinate),d=Lt(n,a,o+(l==="inner"?-1:1)*u,i.coordinate);return{x1:h.x,y1:h.y,x2:d.x,y2:d.y}}},{key:"getTickTextAnchor",value:function(i){var s=this.props.orientation,n=Math.cos(-i.coordinate*Q7e),a;return n>T5?a=s==="outer"?"start":"end":n<-T5?a=s==="outer"?"end":"start":a="middle",a}},{key:"renderAxisLine",value:function(){var i=this.props,s=i.cx,n=i.cy,a=i.radius,o=i.axisLine,l=i.axisLineType,c=tu(tu({},Se(this.props,!1)),{},{fill:"none"},Se(o,!1));if(l==="circle")return U.createElement(GA,fu({className:"recharts-polar-angle-axis-line"},c,{cx:s,cy:n,r:a}));var u=this.props.ticks,h=u.map(function(d){return Lt(s,n,a,d.coordinate)});return U.createElement(f7e,fu({className:"recharts-polar-angle-axis-line"},c,{points:h}))}},{key:"renderTicks",value:function(){var i=this,s=this.props,n=s.ticks,a=s.tick,o=s.tickLine,l=s.tickFormatter,c=s.stroke,u=Se(this.props,!1),h=Se(a,!1),d=tu(tu({},u),{},{fill:"none"},Se(o,!1)),f=n.map(function(p,m){var g=i.getTickLineCoord(p),_=i.getTickTextAnchor(p),v=tu(tu(tu({textAnchor:_},u),{},{stroke:"none",fill:c},h),{},{index:m,payload:p,x:g.x2,y:g.y2});return U.createElement(et,fu({className:Re("recharts-polar-angle-axis-tick",yJ(a)),key:"tick-".concat(p.coordinate)},Eh(i.props,p,m)),o&&U.createElement("line",fu({className:"recharts-polar-angle-axis-tick-line"},d,g)),a&&e.renderTickItem(a,v,l?l(p.value,m):p.value))});return U.createElement(et,{className:"recharts-polar-angle-axis-ticks"},f)}},{key:"render",value:function(){var i=this.props,s=i.ticks,n=i.radius,a=i.axisLine;return n<=0||!s||!s.length?null:U.createElement(et,{className:Re("recharts-polar-angle-axis",this.props.className)},a&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(i,s,n){var a;return U.isValidElement(i)?a=U.cloneElement(i,s):Ce(i)?a=i(s):a=U.createElement(Ah,fu({},s,{className:"recharts-polar-angle-axis-tick-value"}),n),a}}])}(E.PureComponent);qA(YA,"displayName","PolarAngleAxis");qA(YA,"axisType","angleAxis");qA(YA,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var J7e=jZ,eZe=J7e(Object.getPrototypeOf,Object),tZe=eZe,iZe=ol,rZe=tZe,sZe=ll,nZe="[object Object]",aZe=Function.prototype,oZe=Object.prototype,FJ=aZe.toString,lZe=oZe.hasOwnProperty,cZe=FJ.call(Object);function uZe(r){if(!sZe(r)||iZe(r)!=nZe)return!1;var e=rZe(r);if(e===null)return!0;var t=lZe.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&FJ.call(t)==cZe}var hZe=uZe;const dZe=pt(hZe);var fZe=ol,pZe=ll,mZe="[object Boolean]";function gZe(r){return r===!0||r===!1||pZe(r)&&fZe(r)==mZe}var _Ze=gZe;const vZe=pt(_Ze);function $v(r){"@babel/helpers - typeof";return $v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$v(r)}function kw(){return kw=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},kw.apply(this,arguments)}function yZe(r,e){return wZe(r)||bZe(r,e)||xZe(r,e)||SZe()}function SZe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xZe(r,e){if(r){if(typeof r=="string")return E5(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return E5(r,e)}}function E5(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=r[t];return i}function bZe(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var i,s,n,a,o=[],l=!0,c=!1;try{if(n=(t=t.call(r)).next,e!==0)for(;!(l=(i=n.call(t)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(u){c=!0,s=u}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(c)throw s}}return o}}function wZe(r){if(Array.isArray(r))return r}function A5(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function C5(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?A5(Object(t),!0).forEach(function(i){TZe(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):A5(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function TZe(r,e,t){return e=EZe(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function EZe(r){var e=AZe(r,"string");return $v(e)=="symbol"?e:e+""}function AZe(r,e){if($v(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if($v(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}var P5=function(e,t,i,s,n){var a=i-s,o;return o="M ".concat(e,",").concat(t),o+="L ".concat(e+i,",").concat(t),o+="L ".concat(e+i-a/2,",").concat(t+n),o+="L ".concat(e+i-a/2-s,",").concat(t+n),o+="L ".concat(e,",").concat(t," Z"),o},CZe={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},PZe=function(e){var t=C5(C5({},CZe),e),i=E.useRef(),s=E.useState(-1),n=yZe(s,2),a=n[0],o=n[1];E.useEffect(function(){if(i.current&&i.current.getTotalLength)try{var y=i.current.getTotalLength();y&&o(y)}catch{}},[]);var l=t.x,c=t.y,u=t.upperWidth,h=t.lowerWidth,d=t.height,f=t.className,p=t.animationEasing,m=t.animationDuration,g=t.animationBegin,_=t.isUpdateAnimationActive;if(l!==+l||c!==+c||u!==+u||h!==+h||d!==+d||u===0&&h===0||d===0)return null;var v=Re("recharts-trapezoid",f);return _?U.createElement(Ha,{canBegin:a>0,from:{upperWidth:0,lowerWidth:0,height:d,x:l,y:c},to:{upperWidth:u,lowerWidth:h,height:d,x:l,y:c},duration:m,animationEasing:p,isActive:_},function(y){var x=y.upperWidth,S=y.lowerWidth,w=y.height,T=y.x,A=y.y;return U.createElement(Ha,{canBegin:a>0,from:"0px ".concat(a===-1?1:a,"px"),to:"".concat(a,"px 0px"),attributeName:"strokeDasharray",begin:g,duration:m,easing:p},U.createElement("path",kw({},Se(t,!0),{className:v,d:P5(T,A,x,S,w),ref:i})))}):U.createElement("g",null,U.createElement("path",kw({},Se(t,!0),{className:v,d:P5(l,c,u,h,d)})))},IZe=["option","shapeType","propTransformer","activeClassName","isActive"];function Hv(r){"@babel/helpers - typeof";return Hv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Hv(r)}function MZe(r,e){if(r==null)return{};var t=RZe(r,e),i,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(r,i)&&(t[i]=r[i])}return t}function RZe(r,e){if(r==null)return{};var t={};for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(e.indexOf(i)>=0)continue;t[i]=r[i]}return t}function I5(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function Fw(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?I5(Object(t),!0).forEach(function(i){DZe(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):I5(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function DZe(r,e,t){return e=LZe(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function LZe(r){var e=OZe(r,"string");return Hv(e)=="symbol"?e:e+""}function OZe(r,e){if(Hv(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Hv(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function NZe(r,e){return Fw(Fw({},e),r)}function kZe(r,e){return r==="symbols"}function M5(r){var e=r.shapeType,t=r.elementProps;switch(e){case"rectangle":return U.createElement(hk,t);case"trapezoid":return U.createElement(PZe,t);case"sector":return U.createElement(bJ,t);case"symbols":if(kZe(e))return U.createElement(IN,t);break;default:return null}}function FZe(r){return E.isValidElement(r)?r.props:r}function BJ(r){var e=r.option,t=r.shapeType,i=r.propTransformer,s=i===void 0?NZe:i,n=r.activeClassName,a=n===void 0?"recharts-active-shape":n,o=r.isActive,l=MZe(r,IZe),c;if(E.isValidElement(e))c=E.cloneElement(e,Fw(Fw({},l),FZe(e)));else if(Ce(e))c=e(l);else if(dZe(e)&&!vZe(e)){var u=s(e,l);c=U.createElement(M5,{shapeType:t,elementProps:u})}else{var h=l;c=U.createElement(M5,{shapeType:t,elementProps:h})}return o?U.createElement(et,{className:a},c):c}function KA(r,e){return e!=null&&"trapezoids"in r.props}function ZA(r,e){return e!=null&&"sectors"in r.props}function Gv(r,e){return e!=null&&"points"in r.props}function BZe(r,e){var t,i,s=r.x===(e==null||(t=e.labelViewBox)===null||t===void 0?void 0:t.x)||r.x===e.x,n=r.y===(e==null||(i=e.labelViewBox)===null||i===void 0?void 0:i.y)||r.y===e.y;return s&&n}function UZe(r,e){var t=r.endAngle===e.endAngle,i=r.startAngle===e.startAngle;return t&&i}function zZe(r,e){var t=r.x===e.x,i=r.y===e.y,s=r.z===e.z;return t&&i&&s}function VZe(r,e){var t;return KA(r,e)?t=BZe:ZA(r,e)?t=UZe:Gv(r,e)&&(t=zZe),t}function jZe(r,e){var t;return KA(r,e)?t="trapezoids":ZA(r,e)?t="sectors":Gv(r,e)&&(t="points"),t}function $Ze(r,e){if(KA(r,e)){var t;return(t=e.tooltipPayload)===null||t===void 0||(t=t[0])===null||t===void 0||(t=t.payload)===null||t===void 0?void 0:t.payload}if(ZA(r,e)){var i;return(i=e.tooltipPayload)===null||i===void 0||(i=i[0])===null||i===void 0||(i=i.payload)===null||i===void 0?void 0:i.payload}return Gv(r,e)?e.payload:{}}function HZe(r){var e=r.activeTooltipItem,t=r.graphicalItem,i=r.itemData,s=jZe(t,e),n=$Ze(t,e),a=i.filter(function(l,c){var u=Yy(n,l),h=t.props[s].filter(function(p){var m=VZe(t,e);return m(p,e)}),d=t.props[s].indexOf(h[h.length-1]),f=c===d;return u&&f}),o=i.indexOf(a[a.length-1]);return o}var yx;function Up(r){"@babel/helpers - typeof";return Up=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Up(r)}function ef(){return ef=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},ef.apply(this,arguments)}function R5(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function At(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?R5(Object(t),!0).forEach(function(i){Js(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):R5(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function GZe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function D5(r,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,zJ(i.key),i)}}function WZe(r,e,t){return e&&D5(r.prototype,e),t&&D5(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}function XZe(r,e,t){return e=Bw(e),qZe(r,UJ()?Reflect.construct(e,t||[],Bw(r).constructor):e.apply(r,t))}function qZe(r,e){if(e&&(Up(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return YZe(r)}function YZe(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function UJ(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(UJ=function(){return!!r})()}function Bw(r){return Bw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Bw(r)}function KZe(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&dD(r,e)}function dD(r,e){return dD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},dD(r,e)}function Js(r,e,t){return e=zJ(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function zJ(r){var e=ZZe(r,"string");return Up(e)=="symbol"?e:e+""}function ZZe(r,e){if(Up(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Up(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var ul=function(r){function e(t){var i;return GZe(this,e),i=XZe(this,e,[t]),Js(i,"pieRef",null),Js(i,"sectorRefs",[]),Js(i,"id",wm("recharts-pie-")),Js(i,"handleAnimationEnd",function(){var s=i.props.onAnimationEnd;i.setState({isAnimationFinished:!0}),Ce(s)&&s()}),Js(i,"handleAnimationStart",function(){var s=i.props.onAnimationStart;i.setState({isAnimationFinished:!1}),Ce(s)&&s()}),i.state={isAnimationFinished:!t.isAnimationActive,prevIsAnimationActive:t.isAnimationActive,prevAnimationId:t.animationId,sectorToFocus:0},i}return KZe(e,r),WZe(e,[{key:"isActiveIndex",value:function(i){var s=this.props.activeIndex;return Array.isArray(s)?s.indexOf(i)!==-1:i===s}},{key:"hasActiveIndex",value:function(){var i=this.props.activeIndex;return Array.isArray(i)?i.length!==0:i||i===0}},{key:"renderLabels",value:function(i){var s=this.props.isAnimationActive;if(s&&!this.state.isAnimationFinished)return null;var n=this.props,a=n.label,o=n.labelLine,l=n.dataKey,c=n.valueKey,u=Se(this.props,!1),h=Se(a,!1),d=Se(o,!1),f=a&&a.offsetRadius||20,p=i.map(function(m,g){var _=(m.startAngle+m.endAngle)/2,v=Lt(m.cx,m.cy,m.outerRadius+f,_),y=At(At(At(At({},u),m),{},{stroke:"none"},h),{},{index:g,textAnchor:e.getTextAnchor(v.x,m.cx)},v),x=At(At(At(At({},u),m),{},{fill:"none",stroke:m.fill},d),{},{index:g,points:[Lt(m.cx,m.cy,m.outerRadius,_),v]}),S=l;return Pe(l)&&Pe(c)?S="value":Pe(l)&&(S=c),U.createElement(et,{key:"label-".concat(m.startAngle,"-").concat(m.endAngle,"-").concat(m.midAngle,"-").concat(g)},o&&e.renderLabelLineItem(o,x,"line"),e.renderLabelItem(a,y,ki(m,S)))});return U.createElement(et,{className:"recharts-pie-labels"},p)}},{key:"renderSectorsStatically",value:function(i){var s=this,n=this.props,a=n.activeShape,o=n.blendStroke,l=n.inactiveShape;return i.map(function(c,u){if((c==null?void 0:c.startAngle)===0&&(c==null?void 0:c.endAngle)===0&&i.length!==1)return null;var h=s.isActiveIndex(u),d=l&&s.hasActiveIndex()?l:null,f=h?a:d,p=At(At({},c),{},{stroke:o?c.fill:c.stroke,tabIndex:-1});return U.createElement(et,ef({ref:function(g){g&&!s.sectorRefs.includes(g)&&s.sectorRefs.push(g)},tabIndex:-1,className:"recharts-pie-sector"},Eh(s.props,c,u),{key:"sector-".concat(c==null?void 0:c.startAngle,"-").concat(c==null?void 0:c.endAngle,"-").concat(c.midAngle,"-").concat(u)}),U.createElement(BJ,ef({option:f,isActive:h,shapeType:"sector"},p)))})}},{key:"renderSectorsWithAnimation",value:function(){var i=this,s=this.props,n=s.sectors,a=s.isAnimationActive,o=s.animationBegin,l=s.animationDuration,c=s.animationEasing,u=s.animationId,h=this.state,d=h.prevSectors,f=h.prevIsAnimationActive;return U.createElement(Ha,{begin:o,duration:l,isActive:a,easing:c,from:{t:0},to:{t:1},key:"pie-".concat(u,"-").concat(f),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(p){var m=p.t,g=[],_=n&&n[0],v=_.startAngle;return n.forEach(function(y,x){var S=d&&d[x],w=x>0?Cs(y,"paddingAngle",0):0;if(S){var T=Ss(S.endAngle-S.startAngle,y.endAngle-y.startAngle),A=At(At({},y),{},{startAngle:v+w,endAngle:v+T(m)+w});g.push(A),v=A.endAngle}else{var C=y.endAngle,P=y.startAngle,I=Ss(0,C-P),M=I(m),N=At(At({},y),{},{startAngle:v+w,endAngle:v+M+w});g.push(N),v=N.endAngle}}),U.createElement(et,null,i.renderSectorsStatically(g))})}},{key:"attachKeyboardHandlers",value:function(i){var s=this;i.onkeydown=function(n){if(!n.altKey)switch(n.key){case"ArrowLeft":{var a=++s.state.sectorToFocus%s.sectorRefs.length;s.sectorRefs[a].focus(),s.setState({sectorToFocus:a});break}case"ArrowRight":{var o=--s.state.sectorToFocus<0?s.sectorRefs.length-1:s.state.sectorToFocus%s.sectorRefs.length;s.sectorRefs[o].focus(),s.setState({sectorToFocus:o});break}case"Escape":{s.sectorRefs[s.state.sectorToFocus].blur(),s.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var i=this.props,s=i.sectors,n=i.isAnimationActive,a=this.state.prevSectors;return n&&s&&s.length&&(!a||!Yy(a,s))?this.renderSectorsWithAnimation():this.renderSectorsStatically(s)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var i=this,s=this.props,n=s.hide,a=s.sectors,o=s.className,l=s.label,c=s.cx,u=s.cy,h=s.innerRadius,d=s.outerRadius,f=s.isAnimationActive,p=this.state.isAnimationFinished;if(n||!a||!a.length||!oe(c)||!oe(u)||!oe(h)||!oe(d))return null;var m=Re("recharts-pie",o);return U.createElement(et,{tabIndex:this.props.rootTabIndex,className:m,ref:function(_){i.pieRef=_}},this.renderSectors(),l&&this.renderLabels(a),Ki.renderCallByParent(this.props,null,!1),(!f||p)&&Go.renderCallByParent(this.props,a,!1))}}],[{key:"getDerivedStateFromProps",value:function(i,s){return s.prevIsAnimationActive!==i.isAnimationActive?{prevIsAnimationActive:i.isAnimationActive,prevAnimationId:i.animationId,curSectors:i.sectors,prevSectors:[],isAnimationFinished:!0}:i.isAnimationActive&&i.animationId!==s.prevAnimationId?{prevAnimationId:i.animationId,curSectors:i.sectors,prevSectors:s.curSectors,isAnimationFinished:!0}:i.sectors!==s.curSectors?{curSectors:i.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(i,s){return i>s?"start":i<s?"end":"middle"}},{key:"renderLabelLineItem",value:function(i,s,n){if(U.isValidElement(i))return U.cloneElement(i,s);if(Ce(i))return i(s);var a=Re("recharts-pie-label-line",typeof i!="boolean"?i.className:"");return U.createElement(Iw,ef({},s,{key:n,type:"linear",className:a}))}},{key:"renderLabelItem",value:function(i,s,n){if(U.isValidElement(i))return U.cloneElement(i,s);var a=n;if(Ce(i)&&(a=i(s),U.isValidElement(a)))return a;var o=Re("recharts-pie-label-text",typeof i!="boolean"&&!Ce(i)?i.className:"");return U.createElement(Ah,ef({},s,{alignmentBaseline:"middle",className:o}),a)}}])}(E.PureComponent);yx=ul;Js(ul,"displayName","Pie");Js(ul,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!Uh.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});Js(ul,"parseDeltaAngle",function(r,e){var t=Nr(e-r),i=Math.min(Math.abs(e-r),360);return t*i});Js(ul,"getRealPieData",function(r){var e=r.data,t=r.children,i=Se(r,!1),s=Ps(t,LA);return e&&e.length?e.map(function(n,a){return At(At(At({payload:n},i),n),s&&s[a]&&s[a].props)}):s&&s.length?s.map(function(n){return At(At({},i),n.props)}):[]});Js(ul,"parseCoordinateOfPie",function(r,e){var t=e.top,i=e.left,s=e.width,n=e.height,a=vJ(s,n),o=i+kr(r.cx,s,s/2),l=t+kr(r.cy,n,n/2),c=kr(r.innerRadius,a,0),u=kr(r.outerRadius,a,a*.8),h=r.maxRadius||Math.sqrt(s*s+n*n)/2;return{cx:o,cy:l,innerRadius:c,outerRadius:u,maxRadius:h}});Js(ul,"getComposedData",function(r){var e=r.item,t=r.offset,i=e.type.defaultProps!==void 0?At(At({},e.type.defaultProps),e.props):e.props,s=yx.getRealPieData(i);if(!s||!s.length)return null;var n=i.cornerRadius,a=i.startAngle,o=i.endAngle,l=i.paddingAngle,c=i.dataKey,u=i.nameKey,h=i.valueKey,d=i.tooltipType,f=Math.abs(i.minAngle),p=yx.parseCoordinateOfPie(i,t),m=yx.parseDeltaAngle(a,o),g=Math.abs(m),_=c;Pe(c)&&Pe(h)?($o(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),_="value"):Pe(c)&&($o(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),_=h);var v=s.filter(function(A){return ki(A,_,0)!==0}).length,y=(g>=360?v:v-1)*l,x=g-v*f-y,S=s.reduce(function(A,C){var P=ki(C,_,0);return A+(oe(P)?P:0)},0),w;if(S>0){var T;w=s.map(function(A,C){var P=ki(A,_,0),I=ki(A,u,C),M=(oe(P)?P:0)/S,N;C?N=T.endAngle+Nr(m)*l*(P!==0?1:0):N=a;var k=N+Nr(m)*((P!==0?f:0)+M*x),V=(N+k)/2,B=(p.innerRadius+p.outerRadius)/2,R=[{name:I,value:P,payload:A,dataKey:_,type:d}],L=Lt(p.cx,p.cy,B,V);return T=At(At(At({percent:M,cornerRadius:n,name:I,tooltipPayload:R,midAngle:V,middleRadius:B,tooltipPosition:L},A),p),{},{value:ki(A,_),startAngle:N,endAngle:k,payload:A,paddingAngle:Nr(m)*l}),T})}return At(At({},p),{},{sectors:w,data:s})});var QZe=Math.ceil,JZe=Math.max;function eQe(r,e,t,i){for(var s=-1,n=JZe(QZe((e-r)/(t||1)),0),a=Array(n);n--;)a[i?n:++s]=r,r+=t;return a}var tQe=eQe,iQe=aQ,L5=1/0,rQe=17976931348623157e292;function sQe(r){if(!r)return r===0?r:0;if(r=iQe(r),r===L5||r===-L5){var e=r<0?-1:1;return e*rQe}return r===r?r:0}var nQe=sQe,aQe=tQe,oQe=DA,kP=nQe;function lQe(r){return function(e,t,i){return i&&typeof i!="number"&&oQe(e,t,i)&&(t=i=void 0),e=kP(e),t===void 0?(t=e,e=0):t=kP(t),i=i===void 0?e<t?1:-1:kP(i),aQe(e,t,i,r)}}var cQe=lQe,uQe=cQe,hQe=uQe(),dQe=hQe;const Uw=pt(dQe);function Wv(r){"@babel/helpers - typeof";return Wv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wv(r)}function O5(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function N5(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?O5(Object(t),!0).forEach(function(i){VJ(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):O5(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function VJ(r,e,t){return e=fQe(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function fQe(r){var e=pQe(r,"string");return Wv(e)=="symbol"?e:e+""}function pQe(r,e){if(Wv(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Wv(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}var mQe=["Webkit","Moz","O","ms"],gQe=function(e,t){var i=e.replace(/(\w)/,function(n){return n.toUpperCase()}),s=mQe.reduce(function(n,a){return N5(N5({},n),{},VJ({},a+i,t))},{});return s[e]=t,s};function zp(r){"@babel/helpers - typeof";return zp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zp(r)}function zw(){return zw=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},zw.apply(this,arguments)}function k5(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function FP(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?k5(Object(t),!0).forEach(function(i){ms(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):k5(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function _Qe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function F5(r,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,$J(i.key),i)}}function vQe(r,e,t){return e&&F5(r.prototype,e),t&&F5(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}function yQe(r,e,t){return e=Vw(e),SQe(r,jJ()?Reflect.construct(e,t||[],Vw(r).constructor):e.apply(r,t))}function SQe(r,e){if(e&&(zp(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return xQe(r)}function xQe(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function jJ(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(jJ=function(){return!!r})()}function Vw(r){return Vw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Vw(r)}function bQe(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&fD(r,e)}function fD(r,e){return fD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},fD(r,e)}function ms(r,e,t){return e=$J(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function $J(r){var e=wQe(r,"string");return zp(e)=="symbol"?e:e+""}function wQe(r,e){if(zp(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(zp(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var TQe=function(e){var t=e.data,i=e.startIndex,s=e.endIndex,n=e.x,a=e.width,o=e.travellerWidth;if(!t||!t.length)return{};var l=t.length,c=d_().domain(Uw(0,l)).range([n,n+a-o]),u=c.domain().map(function(h){return c(h)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:c(i),endX:c(s),scale:c,scaleValues:u}},B5=function(e){return e.changedTouches&&!!e.changedTouches.length},Vp=function(r){function e(t){var i;return _Qe(this,e),i=yQe(this,e,[t]),ms(i,"handleDrag",function(s){i.leaveTimer&&(clearTimeout(i.leaveTimer),i.leaveTimer=null),i.state.isTravellerMoving?i.handleTravellerMove(s):i.state.isSlideMoving&&i.handleSlideDrag(s)}),ms(i,"handleTouchMove",function(s){s.changedTouches!=null&&s.changedTouches.length>0&&i.handleDrag(s.changedTouches[0])}),ms(i,"handleDragEnd",function(){i.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var s=i.props,n=s.endIndex,a=s.onDragEnd,o=s.startIndex;a==null||a({endIndex:n,startIndex:o})}),i.detachDragEndListener()}),ms(i,"handleLeaveWrapper",function(){(i.state.isTravellerMoving||i.state.isSlideMoving)&&(i.leaveTimer=window.setTimeout(i.handleDragEnd,i.props.leaveTimeOut))}),ms(i,"handleEnterSlideOrTraveller",function(){i.setState({isTextActive:!0})}),ms(i,"handleLeaveSlideOrTraveller",function(){i.setState({isTextActive:!1})}),ms(i,"handleSlideDragStart",function(s){var n=B5(s)?s.changedTouches[0]:s;i.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:n.pageX}),i.attachDragEndListener()}),i.travellerDragStartHandlers={startX:i.handleTravellerDragStart.bind(i,"startX"),endX:i.handleTravellerDragStart.bind(i,"endX")},i.state={},i}return bQe(e,r),vQe(e,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(i){var s=i.startX,n=i.endX,a=this.state.scaleValues,o=this.props,l=o.gap,c=o.data,u=c.length-1,h=Math.min(s,n),d=Math.max(s,n),f=e.getIndexInRange(a,h),p=e.getIndexInRange(a,d);return{startIndex:f-f%l,endIndex:p===u?u:p-p%l}}},{key:"getTextOfTick",value:function(i){var s=this.props,n=s.data,a=s.tickFormatter,o=s.dataKey,l=ki(n[i],o,i);return Ce(a)?a(l,i):l}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(i){var s=this.state,n=s.slideMoveStartX,a=s.startX,o=s.endX,l=this.props,c=l.x,u=l.width,h=l.travellerWidth,d=l.startIndex,f=l.endIndex,p=l.onChange,m=i.pageX-n;m>0?m=Math.min(m,c+u-h-o,c+u-h-a):m<0&&(m=Math.max(m,c-a,c-o));var g=this.getIndex({startX:a+m,endX:o+m});(g.startIndex!==d||g.endIndex!==f)&&p&&p(g),this.setState({startX:a+m,endX:o+m,slideMoveStartX:i.pageX})}},{key:"handleTravellerDragStart",value:function(i,s){var n=B5(s)?s.changedTouches[0]:s;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:i,brushMoveStartX:n.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(i){var s=this.state,n=s.brushMoveStartX,a=s.movingTravellerId,o=s.endX,l=s.startX,c=this.state[a],u=this.props,h=u.x,d=u.width,f=u.travellerWidth,p=u.onChange,m=u.gap,g=u.data,_={startX:this.state.startX,endX:this.state.endX},v=i.pageX-n;v>0?v=Math.min(v,h+d-f-c):v<0&&(v=Math.max(v,h-c)),_[a]=c+v;var y=this.getIndex(_),x=y.startIndex,S=y.endIndex,w=function(){var A=g.length-1;return a==="startX"&&(o>l?x%m===0:S%m===0)||o<l&&S===A||a==="endX"&&(o>l?S%m===0:x%m===0)||o>l&&S===A};this.setState(ms(ms({},a,c+v),"brushMoveStartX",i.pageX),function(){p&&w()&&p(y)})}},{key:"handleTravellerMoveKeyboard",value:function(i,s){var n=this,a=this.state,o=a.scaleValues,l=a.startX,c=a.endX,u=this.state[s],h=o.indexOf(u);if(h!==-1){var d=h+i;if(!(d===-1||d>=o.length)){var f=o[d];s==="startX"&&f>=c||s==="endX"&&f<=l||this.setState(ms({},s,f),function(){n.props.onChange(n.getIndex({startX:n.state.startX,endX:n.state.endX}))})}}}},{key:"renderBackground",value:function(){var i=this.props,s=i.x,n=i.y,a=i.width,o=i.height,l=i.fill,c=i.stroke;return U.createElement("rect",{stroke:c,fill:l,x:s,y:n,width:a,height:o})}},{key:"renderPanorama",value:function(){var i=this.props,s=i.x,n=i.y,a=i.width,o=i.height,l=i.data,c=i.children,u=i.padding,h=E.Children.only(c);return h?U.cloneElement(h,{x:s,y:n,width:a,height:o,margin:u,compact:!0,data:l}):null}},{key:"renderTravellerLayer",value:function(i,s){var n,a,o=this,l=this.props,c=l.y,u=l.travellerWidth,h=l.height,d=l.traveller,f=l.ariaLabel,p=l.data,m=l.startIndex,g=l.endIndex,_=Math.max(i,this.props.x),v=FP(FP({},Se(this.props,!1)),{},{x:_,y:c,width:u,height:h}),y=f||"Min value: ".concat((n=p[m])===null||n===void 0?void 0:n.name,", Max value: ").concat((a=p[g])===null||a===void 0?void 0:a.name);return U.createElement(et,{tabIndex:0,role:"slider","aria-label":y,"aria-valuenow":i,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[s],onTouchStart:this.travellerDragStartHandlers[s],onKeyDown:function(S){["ArrowLeft","ArrowRight"].includes(S.key)&&(S.preventDefault(),S.stopPropagation(),o.handleTravellerMoveKeyboard(S.key==="ArrowRight"?1:-1,s))},onFocus:function(){o.setState({isTravellerFocused:!0})},onBlur:function(){o.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},e.renderTraveller(d,v))}},{key:"renderSlide",value:function(i,s){var n=this.props,a=n.y,o=n.height,l=n.stroke,c=n.travellerWidth,u=Math.min(i,s)+c,h=Math.max(Math.abs(s-i)-c,0);return U.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:l,fillOpacity:.2,x:u,y:a,width:h,height:o})}},{key:"renderText",value:function(){var i=this.props,s=i.startIndex,n=i.endIndex,a=i.y,o=i.height,l=i.travellerWidth,c=i.stroke,u=this.state,h=u.startX,d=u.endX,f=5,p={pointerEvents:"none",fill:c};return U.createElement(et,{className:"recharts-brush-texts"},U.createElement(Ah,zw({textAnchor:"end",verticalAnchor:"middle",x:Math.min(h,d)-f,y:a+o/2},p),this.getTextOfTick(s)),U.createElement(Ah,zw({textAnchor:"start",verticalAnchor:"middle",x:Math.max(h,d)+l+f,y:a+o/2},p),this.getTextOfTick(n)))}},{key:"render",value:function(){var i=this.props,s=i.data,n=i.className,a=i.children,o=i.x,l=i.y,c=i.width,u=i.height,h=i.alwaysShowText,d=this.state,f=d.startX,p=d.endX,m=d.isTextActive,g=d.isSlideMoving,_=d.isTravellerMoving,v=d.isTravellerFocused;if(!s||!s.length||!oe(o)||!oe(l)||!oe(c)||!oe(u)||c<=0||u<=0)return null;var y=Re("recharts-brush",n),x=U.Children.count(a)===1,S=gQe("userSelect","none");return U.createElement(et,{className:y,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:S},this.renderBackground(),x&&this.renderPanorama(),this.renderSlide(f,p),this.renderTravellerLayer(f,"startX"),this.renderTravellerLayer(p,"endX"),(m||g||_||v||h)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(i){var s=i.x,n=i.y,a=i.width,o=i.height,l=i.stroke,c=Math.floor(n+o/2)-1;return U.createElement(U.Fragment,null,U.createElement("rect",{x:s,y:n,width:a,height:o,fill:l,stroke:"none"}),U.createElement("line",{x1:s+1,y1:c,x2:s+a-1,y2:c,fill:"none",stroke:"#fff"}),U.createElement("line",{x1:s+1,y1:c+2,x2:s+a-1,y2:c+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(i,s){var n;return U.isValidElement(i)?n=U.cloneElement(i,s):Ce(i)?n=i(s):n=e.renderDefaultTraveller(s),n}},{key:"getDerivedStateFromProps",value:function(i,s){var n=i.data,a=i.width,o=i.x,l=i.travellerWidth,c=i.updateId,u=i.startIndex,h=i.endIndex;if(n!==s.prevData||c!==s.prevUpdateId)return FP({prevData:n,prevTravellerWidth:l,prevUpdateId:c,prevX:o,prevWidth:a},n&&n.length?TQe({data:n,width:a,x:o,travellerWidth:l,startIndex:u,endIndex:h}):{scale:null,scaleValues:null});if(s.scale&&(a!==s.prevWidth||o!==s.prevX||l!==s.prevTravellerWidth)){s.scale.range([o,o+a-l]);var d=s.scale.domain().map(function(f){return s.scale(f)});return{prevData:n,prevTravellerWidth:l,prevUpdateId:c,prevX:o,prevWidth:a,startX:s.scale(i.startIndex),endX:s.scale(i.endIndex),scaleValues:d}}return null}},{key:"getIndexInRange",value:function(i,s){for(var n=i.length,a=0,o=n-1;o-a>1;){var l=Math.floor((a+o)/2);i[l]>s?o=l:a=l}return s>=i[o]?o:a}}])}(E.PureComponent);ms(Vp,"displayName","Brush");ms(Vp,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var EQe=FN;function AQe(r,e){var t;return EQe(r,function(i,s,n){return t=e(i,s,n),!t}),!!t}var CQe=AQe,PQe=OZ,IQe=Fc,MQe=CQe,RQe=ss,DQe=DA;function LQe(r,e,t){var i=RQe(r)?PQe:MQe;return t&&DQe(r,e,t)&&(e=void 0),i(r,IQe(e))}var OQe=LQe;const NQe=pt(OQe);var ka=function(e,t){var i=e.alwaysShow,s=e.ifOverflow;return i&&(s="extendDomain"),s===t},U5=tQ;function kQe(r,e,t){e=="__proto__"&&U5?U5(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}var FQe=kQe,BQe=FQe,UQe=JZ,zQe=Fc;function VQe(r,e){var t={};return e=zQe(e),UQe(r,function(i,s,n){BQe(t,s,e(i,s,n))}),t}var jQe=VQe;const $Qe=pt(jQe);function HQe(r,e){for(var t=-1,i=r==null?0:r.length;++t<i;)if(!e(r[t],t,r))return!1;return!0}var GQe=HQe,WQe=FN;function XQe(r,e){var t=!0;return WQe(r,function(i,s,n){return t=!!e(i,s,n),t}),t}var qQe=XQe,YQe=GQe,KQe=qQe,ZQe=Fc,QQe=ss,JQe=DA;function eJe(r,e,t){var i=QQe(r)?YQe:KQe;return t&&JQe(r,e,t)&&(e=void 0),i(r,ZQe(e))}var tJe=eJe;const iJe=pt(tJe);var rJe=["x","y"];function Xv(r){"@babel/helpers - typeof";return Xv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xv(r)}function pD(){return pD=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},pD.apply(this,arguments)}function z5(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function xg(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?z5(Object(t),!0).forEach(function(i){sJe(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):z5(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function sJe(r,e,t){return e=nJe(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function nJe(r){var e=aJe(r,"string");return Xv(e)=="symbol"?e:e+""}function aJe(r,e){if(Xv(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Xv(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function oJe(r,e){if(r==null)return{};var t=lJe(r,e),i,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(r,i)&&(t[i]=r[i])}return t}function lJe(r,e){if(r==null)return{};var t={};for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(e.indexOf(i)>=0)continue;t[i]=r[i]}return t}function cJe(r,e){var t=r.x,i=r.y,s=oJe(r,rJe),n="".concat(t),a=parseInt(n,10),o="".concat(i),l=parseInt(o,10),c="".concat(e.height||s.height),u=parseInt(c,10),h="".concat(e.width||s.width),d=parseInt(h,10);return xg(xg(xg(xg(xg({},e),s),a?{x:a}:{}),l?{y:l}:{}),{},{height:u,width:d,name:e.name,radius:e.radius})}function V5(r){return U.createElement(BJ,pD({shapeType:"rectangle",propTransformer:cJe,activeClassName:"recharts-active-bar"},r))}var uJe=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(i,s){if(typeof e=="number")return e;var n=oe(i)||DFe(i);return n?e(i,s):(n||Ph(),t)}},hJe=["value","background"],HJ;function jp(r){"@babel/helpers - typeof";return jp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jp(r)}function dJe(r,e){if(r==null)return{};var t=fJe(r,e),i,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(r,i)&&(t[i]=r[i])}return t}function fJe(r,e){if(r==null)return{};var t={};for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(e.indexOf(i)>=0)continue;t[i]=r[i]}return t}function jw(){return jw=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},jw.apply(this,arguments)}function j5(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function xi(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?j5(Object(t),!0).forEach(function(i){ic(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):j5(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function pJe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function $5(r,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,WJ(i.key),i)}}function mJe(r,e,t){return e&&$5(r.prototype,e),t&&$5(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}function gJe(r,e,t){return e=$w(e),_Je(r,GJ()?Reflect.construct(e,t||[],$w(r).constructor):e.apply(r,t))}function _Je(r,e){if(e&&(jp(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return vJe(r)}function vJe(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function GJ(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(GJ=function(){return!!r})()}function $w(r){return $w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},$w(r)}function yJe(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&mD(r,e)}function mD(r,e){return mD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},mD(r,e)}function ic(r,e,t){return e=WJ(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function WJ(r){var e=SJe(r,"string");return jp(e)=="symbol"?e:e+""}function SJe(r,e){if(jp(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(jp(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var $h=function(r){function e(){var t;pJe(this,e);for(var i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return t=gJe(this,e,[].concat(s)),ic(t,"state",{isAnimationFinished:!1}),ic(t,"id",wm("recharts-bar-")),ic(t,"handleAnimationEnd",function(){var a=t.props.onAnimationEnd;t.setState({isAnimationFinished:!0}),a&&a()}),ic(t,"handleAnimationStart",function(){var a=t.props.onAnimationStart;t.setState({isAnimationFinished:!1}),a&&a()}),t}return yJe(e,r),mJe(e,[{key:"renderRectanglesStatically",value:function(i){var s=this,n=this.props,a=n.shape,o=n.dataKey,l=n.activeIndex,c=n.activeBar,u=Se(this.props,!1);return i&&i.map(function(h,d){var f=d===l,p=f?c:a,m=xi(xi(xi({},u),h),{},{isActive:f,option:p,index:d,dataKey:o,onAnimationStart:s.handleAnimationStart,onAnimationEnd:s.handleAnimationEnd});return U.createElement(et,jw({className:"recharts-bar-rectangle"},Eh(s.props,h,d),{key:"rectangle-".concat(h==null?void 0:h.x,"-").concat(h==null?void 0:h.y,"-").concat(h==null?void 0:h.value,"-").concat(d)}),U.createElement(V5,m))})}},{key:"renderRectanglesWithAnimation",value:function(){var i=this,s=this.props,n=s.data,a=s.layout,o=s.isAnimationActive,l=s.animationBegin,c=s.animationDuration,u=s.animationEasing,h=s.animationId,d=this.state.prevData;return U.createElement(Ha,{begin:l,duration:c,isActive:o,easing:u,from:{t:0},to:{t:1},key:"bar-".concat(h),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(f){var p=f.t,m=n.map(function(g,_){var v=d&&d[_];if(v){var y=Ss(v.x,g.x),x=Ss(v.y,g.y),S=Ss(v.width,g.width),w=Ss(v.height,g.height);return xi(xi({},g),{},{x:y(p),y:x(p),width:S(p),height:w(p)})}if(a==="horizontal"){var T=Ss(0,g.height),A=T(p);return xi(xi({},g),{},{y:g.y+g.height-A,height:A})}var C=Ss(0,g.width),P=C(p);return xi(xi({},g),{},{width:P})});return U.createElement(et,null,i.renderRectanglesStatically(m))})}},{key:"renderRectangles",value:function(){var i=this.props,s=i.data,n=i.isAnimationActive,a=this.state.prevData;return n&&s&&s.length&&(!a||!Yy(a,s))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(s)}},{key:"renderBackground",value:function(){var i=this,s=this.props,n=s.data,a=s.dataKey,o=s.activeIndex,l=Se(this.props.background,!1);return n.map(function(c,u){c.value;var h=c.background,d=dJe(c,hJe);if(!h)return null;var f=xi(xi(xi(xi(xi({},d),{},{fill:"#eee"},h),l),Eh(i.props,c,u)),{},{onAnimationStart:i.handleAnimationStart,onAnimationEnd:i.handleAnimationEnd,dataKey:a,index:u,className:"recharts-bar-background-rectangle"});return U.createElement(V5,jw({key:"background-bar-".concat(u),option:i.props.background,isActive:u===o},f))})}},{key:"renderErrorBar",value:function(i,s){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var n=this.props,a=n.data,o=n.xAxis,l=n.yAxis,c=n.layout,u=n.children,h=Ps(u,Ky);if(!h)return null;var d=c==="vertical"?a[0].height/2:a[0].width/2,f=function(g,_){var v=Array.isArray(g.value)?g.value[1]:g.value;return{x:g.x,y:g.y,value:v,errorVal:ki(g,_)}},p={clipPath:i?"url(#clipPath-".concat(s,")"):null};return U.createElement(et,p,h.map(function(m){return U.cloneElement(m,{key:"error-bar-".concat(s,"-").concat(m.props.dataKey),data:a,xAxis:o,yAxis:l,layout:c,offset:d,dataPointFormatter:f})}))}},{key:"render",value:function(){var i=this.props,s=i.hide,n=i.data,a=i.className,o=i.xAxis,l=i.yAxis,c=i.left,u=i.top,h=i.width,d=i.height,f=i.isAnimationActive,p=i.background,m=i.id;if(s||!n||!n.length)return null;var g=this.state.isAnimationFinished,_=Re("recharts-bar",a),v=o&&o.allowDataOverflow,y=l&&l.allowDataOverflow,x=v||y,S=Pe(m)?this.id:m;return U.createElement(et,{className:_},v||y?U.createElement("defs",null,U.createElement("clipPath",{id:"clipPath-".concat(S)},U.createElement("rect",{x:v?c:c-h/2,y:y?u:u-d/2,width:v?h:h*2,height:y?d:d*2}))):null,U.createElement(et,{className:"recharts-bar-rectangles",clipPath:x?"url(#clipPath-".concat(S,")"):null},p?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(x,S),(!f||g)&&Go.renderCallByParent(this.props,n))}}],[{key:"getDerivedStateFromProps",value:function(i,s){return i.animationId!==s.prevAnimationId?{prevAnimationId:i.animationId,curData:i.data,prevData:s.curData}:i.data!==s.curData?{curData:i.data}:null}}])}(E.PureComponent);HJ=$h;ic($h,"displayName","Bar");ic($h,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!Uh.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});ic($h,"getComposedData",function(r){var e=r.props,t=r.item,i=r.barPosition,s=r.bandSize,n=r.xAxis,a=r.yAxis,o=r.xAxisTicks,l=r.yAxisTicks,c=r.stackedData,u=r.dataStartIndex,h=r.displayedData,d=r.offset,f=Qqe(i,t);if(!f)return null;var p=e.layout,m=t.type.defaultProps,g=m!==void 0?xi(xi({},m),t.props):t.props,_=g.dataKey,v=g.children,y=g.minPointSize,x=p==="horizontal"?a:n,S=c?x.scale.domain():null,w=n9e({numericAxis:x}),T=Ps(v,LA),A=h.map(function(C,P){var I,M,N,k,V,B;c?I=Jqe(c[u+P],S):(I=ki(C,_),Array.isArray(I)||(I=[w,I]));var R=uJe(y,HJ.defaultProps.minPointSize)(I[1],P);if(p==="horizontal"){var L,D=[a.scale(I[0]),a.scale(I[1])],F=D[0],j=D[1];M=D$({axis:n,ticks:o,bandSize:s,offset:f.offset,entry:C,index:P}),N=(L=j??F)!==null&&L!==void 0?L:void 0,k=f.size;var z=F-j;if(V=Number.isNaN(z)?0:z,B={x:M,y:a.y,width:k,height:a.height},Math.abs(R)>0&&Math.abs(V)<Math.abs(R)){var $=Nr(V||R)*(Math.abs(R)-Math.abs(V));N-=$,V+=$}}else{var H=[n.scale(I[0]),n.scale(I[1])],G=H[0],Y=H[1];if(M=G,N=D$({axis:a,ticks:l,bandSize:s,offset:f.offset,entry:C,index:P}),k=Y-G,V=f.size,B={x:n.x,y:N,width:n.width,height:V},Math.abs(R)>0&&Math.abs(k)<Math.abs(R)){var W=Nr(k||R)*(Math.abs(R)-Math.abs(k));k+=W}}return xi(xi(xi({},C),{},{x:M,y:N,width:k,height:V,value:c?I:I[1],payload:C,background:B},T&&T[P]&&T[P].props),{},{tooltipPayload:[gJ(t,C)],tooltipPosition:{x:M+k/2,y:N+V/2}})});return xi({data:A,layout:p},d)});function qv(r){"@babel/helpers - typeof";return qv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qv(r)}function xJe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function H5(r,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,XJ(i.key),i)}}function bJe(r,e,t){return e&&H5(r.prototype,e),t&&H5(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}function G5(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function kn(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?G5(Object(t),!0).forEach(function(i){QA(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):G5(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function QA(r,e,t){return e=XJ(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function XJ(r){var e=wJe(r,"string");return qv(e)=="symbol"?e:e+""}function wJe(r,e){if(qv(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(qv(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}var qJ=function(e,t,i,s,n){var a=e.width,o=e.height,l=e.layout,c=e.children,u=Object.keys(t),h={left:i.left,leftMirror:i.left,right:a-i.right,rightMirror:a-i.right,top:i.top,topMirror:i.top,bottom:o-i.bottom,bottomMirror:o-i.bottom},d=!!_s(c,$h);return u.reduce(function(f,p){var m=t[p],g=m.orientation,_=m.domain,v=m.padding,y=v===void 0?{}:v,x=m.mirror,S=m.reversed,w="".concat(g).concat(x?"Mirror":""),T,A,C,P,I;if(m.type==="number"&&(m.padding==="gap"||m.padding==="no-gap")){var M=_[1]-_[0],N=1/0,k=m.categoricalDomain.sort(NFe);if(k.forEach(function(H,G){G>0&&(N=Math.min((H||0)-(k[G-1]||0),N))}),Number.isFinite(N)){var V=N/M,B=m.layout==="vertical"?i.height:i.width;if(m.padding==="gap"&&(T=V*B/2),m.padding==="no-gap"){var R=kr(e.barCategoryGap,V*B),L=V*B/2;T=L-R-(L-R)/B*R}}}s==="xAxis"?A=[i.left+(y.left||0)+(T||0),i.left+i.width-(y.right||0)-(T||0)]:s==="yAxis"?A=l==="horizontal"?[i.top+i.height-(y.bottom||0),i.top+(y.top||0)]:[i.top+(y.top||0)+(T||0),i.top+i.height-(y.bottom||0)-(T||0)]:A=m.range,S&&(A=[A[1],A[0]]);var D=dJ(m,n,d),F=D.scale,j=D.realScaleType;F.domain(_).range(A),fJ(F);var z=pJ(F,kn(kn({},m),{},{realScaleType:j}));s==="xAxis"?(I=g==="top"&&!x||g==="bottom"&&x,C=i.left,P=h[w]-I*m.height):s==="yAxis"&&(I=g==="left"&&!x||g==="right"&&x,C=h[w]-I*m.width,P=i.top);var $=kn(kn(kn({},m),z),{},{realScaleType:j,x:C,y:P,scale:F,width:s==="xAxis"?i.width:m.width,height:s==="yAxis"?i.height:m.height});return $.bandSize=Aw($,z),!m.hide&&s==="xAxis"?h[w]+=(I?-1:1)*$.height:m.hide||(h[w]+=(I?-1:1)*$.width),kn(kn({},f),{},QA({},p,$))},{})},YJ=function(e,t){var i=e.x,s=e.y,n=t.x,a=t.y;return{x:Math.min(i,n),y:Math.min(s,a),width:Math.abs(n-i),height:Math.abs(a-s)}},TJe=function(e){var t=e.x1,i=e.y1,s=e.x2,n=e.y2;return YJ({x:t,y:i},{x:s,y:n})},KJ=function(){function r(e){xJe(this,r),this.scale=e}return bJe(r,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=i.bandAware,n=i.position;if(t!==void 0){if(n)switch(n){case"start":return this.scale(t);case"middle":{var a=this.bandwidth?this.bandwidth()/2:0;return this.scale(t)+a}case"end":{var o=this.bandwidth?this.bandwidth():0;return this.scale(t)+o}default:return this.scale(t)}if(s){var l=this.bandwidth?this.bandwidth()/2:0;return this.scale(t)+l}return this.scale(t)}}},{key:"isInRange",value:function(t){var i=this.range(),s=i[0],n=i[i.length-1];return s<=n?t>=s&&t<=n:t>=n&&t<=s}}],[{key:"create",value:function(t){return new r(t)}}])}();QA(KJ,"EPS",1e-4);var dk=function(e){var t=Object.keys(e).reduce(function(i,s){return kn(kn({},i),{},QA({},s,KJ.create(e[s])))},{});return kn(kn({},t),{},{apply:function(s){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.bandAware,o=n.position;return $Qe(s,function(l,c){return t[c].apply(l,{bandAware:a,position:o})})},isInRange:function(s){return iJe(s,function(n,a){return t[a].isInRange(n)})}})};function EJe(r){return(r%180+180)%180}var AJe=function(e){var t=e.width,i=e.height,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=EJe(s),a=n*Math.PI/180,o=Math.atan(i/t),l=a>o&&a<Math.PI-o?i/Math.sin(a):t/Math.cos(a);return Math.abs(l)},CJe=Bke(function(r){return{x:r.left,y:r.top,width:r.width,height:r.height}},function(r){return["l",r.left,"t",r.top,"w",r.width,"h",r.height].join("")}),ZJ=E.createContext(void 0),QJ=E.createContext(void 0),JJ=E.createContext(void 0),PJe=E.createContext({}),eee=E.createContext(void 0),tee=E.createContext(0),iee=E.createContext(0),W5=function(e){var t=e.state,i=t.xAxisMap,s=t.yAxisMap,n=t.offset,a=e.clipPathId,o=e.children,l=e.width,c=e.height,u=CJe(n);return U.createElement(ZJ.Provider,{value:i},U.createElement(QJ.Provider,{value:s},U.createElement(PJe.Provider,{value:n},U.createElement(JJ.Provider,{value:u},U.createElement(eee.Provider,{value:a},U.createElement(tee.Provider,{value:c},U.createElement(iee.Provider,{value:l},o)))))))},IJe=function(){return E.useContext(eee)},ree=function(e){var t=E.useContext(ZJ);t==null&&Ph();var i=t[e];return i==null&&Ph(),i},see=function(e){var t=E.useContext(QJ);t==null&&Ph();var i=t[e];return i==null&&Ph(),i},MJe=function(){var e=E.useContext(JJ);return e},nee=function(){return E.useContext(iee)},aee=function(){return E.useContext(tee)};function $p(r){"@babel/helpers - typeof";return $p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$p(r)}function RJe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function DJe(r,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,lee(i.key),i)}}function LJe(r,e,t){return e&&DJe(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function OJe(r,e,t){return e=Hw(e),NJe(r,oee()?Reflect.construct(e,t||[],Hw(r).constructor):e.apply(r,t))}function NJe(r,e){if(e&&($p(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return kJe(r)}function kJe(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function oee(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(oee=function(){return!!r})()}function Hw(r){return Hw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Hw(r)}function FJe(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&gD(r,e)}function gD(r,e){return gD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},gD(r,e)}function X5(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function q5(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?X5(Object(t),!0).forEach(function(i){fk(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):X5(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function fk(r,e,t){return e=lee(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function lee(r){var e=BJe(r,"string");return $p(e)=="symbol"?e:e+""}function BJe(r,e){if($p(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if($p(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function UJe(r,e){return $Je(r)||jJe(r,e)||VJe(r,e)||zJe()}function zJe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function VJe(r,e){if(r){if(typeof r=="string")return Y5(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Y5(r,e)}}function Y5(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=r[t];return i}function jJe(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var i,s,n,a,o=[],l=!0,c=!1;try{if(n=(t=t.call(r)).next,e!==0)for(;!(l=(i=n.call(t)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(u){c=!0,s=u}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(c)throw s}}return o}}function $Je(r){if(Array.isArray(r))return r}function _D(){return _D=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},_D.apply(this,arguments)}var HJe=function(e,t){var i;return U.isValidElement(e)?i=U.cloneElement(e,t):Ce(e)?i=e(t):i=U.createElement("line",_D({},t,{className:"recharts-reference-line-line"})),i},GJe=function(e,t,i,s,n,a,o,l,c){var u=n.x,h=n.y,d=n.width,f=n.height;if(i){var p=c.y,m=e.y.apply(p,{position:a});if(ka(c,"discard")&&!e.y.isInRange(m))return null;var g=[{x:u+d,y:m},{x:u,y:m}];return l==="left"?g.reverse():g}if(t){var _=c.x,v=e.x.apply(_,{position:a});if(ka(c,"discard")&&!e.x.isInRange(v))return null;var y=[{x:v,y:h+f},{x:v,y:h}];return o==="top"?y.reverse():y}if(s){var x=c.segment,S=x.map(function(w){return e.apply(w,{position:a})});return ka(c,"discard")&&NQe(S,function(w){return!e.isInRange(w)})?null:S}return null};function WJe(r){var e=r.x,t=r.y,i=r.segment,s=r.xAxisId,n=r.yAxisId,a=r.shape,o=r.className,l=r.alwaysShow,c=IJe(),u=ree(s),h=see(n),d=MJe();if(!c||!d)return null;$o(l===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var f=dk({x:u.scale,y:h.scale}),p=Ui(e),m=Ui(t),g=i&&i.length===2,_=GJe(f,p,m,g,d,r.position,u.orientation,h.orientation,r);if(!_)return null;var v=UJe(_,2),y=v[0],x=y.x,S=y.y,w=v[1],T=w.x,A=w.y,C=ka(r,"hidden")?"url(#".concat(c,")"):void 0,P=q5(q5({clipPath:C},Se(r,!0)),{},{x1:x,y1:S,x2:T,y2:A});return U.createElement(et,{className:Re("recharts-reference-line",o)},HJe(a,P),Ki.renderCallByParent(r,TJe({x1:x,y1:S,x2:T,y2:A})))}var pk=function(r){function e(){return RJe(this,e),OJe(this,e,arguments)}return FJe(e,r),LJe(e,[{key:"render",value:function(){return U.createElement(WJe,this.props)}}])}(U.Component);fk(pk,"displayName","ReferenceLine");fk(pk,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function vD(){return vD=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},vD.apply(this,arguments)}function Hp(r){"@babel/helpers - typeof";return Hp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Hp(r)}function K5(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function Z5(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?K5(Object(t),!0).forEach(function(i){JA(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):K5(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function XJe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function qJe(r,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,uee(i.key),i)}}function YJe(r,e,t){return e&&qJe(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function KJe(r,e,t){return e=Gw(e),ZJe(r,cee()?Reflect.construct(e,t||[],Gw(r).constructor):e.apply(r,t))}function ZJe(r,e){if(e&&(Hp(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return QJe(r)}function QJe(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function cee(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(cee=function(){return!!r})()}function Gw(r){return Gw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Gw(r)}function JJe(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&yD(r,e)}function yD(r,e){return yD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},yD(r,e)}function JA(r,e,t){return e=uee(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function uee(r){var e=eet(r,"string");return Hp(e)=="symbol"?e:e+""}function eet(r,e){if(Hp(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Hp(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var tet=function(e){var t=e.x,i=e.y,s=e.xAxis,n=e.yAxis,a=dk({x:s.scale,y:n.scale}),o=a.apply({x:t,y:i},{bandAware:!0});return ka(e,"discard")&&!a.isInRange(o)?null:o},e1=function(r){function e(){return XJe(this,e),KJe(this,e,arguments)}return JJe(e,r),YJe(e,[{key:"render",value:function(){var i=this.props,s=i.x,n=i.y,a=i.r,o=i.alwaysShow,l=i.clipPathId,c=Ui(s),u=Ui(n);if($o(o===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!c||!u)return null;var h=tet(this.props);if(!h)return null;var d=h.x,f=h.y,p=this.props,m=p.shape,g=p.className,_=ka(this.props,"hidden")?"url(#".concat(l,")"):void 0,v=Z5(Z5({clipPath:_},Se(this.props,!0)),{},{cx:d,cy:f});return U.createElement(et,{className:Re("recharts-reference-dot",g)},e.renderDot(m,v),Ki.renderCallByParent(this.props,{x:d-a,y:f-a,width:2*a,height:2*a}))}}])}(U.Component);JA(e1,"displayName","ReferenceDot");JA(e1,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});JA(e1,"renderDot",function(r,e){var t;return U.isValidElement(r)?t=U.cloneElement(r,e):Ce(r)?t=r(e):t=U.createElement(GA,vD({},e,{cx:e.cx,cy:e.cy,className:"recharts-reference-dot-dot"})),t});function SD(){return SD=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},SD.apply(this,arguments)}function Gp(r){"@babel/helpers - typeof";return Gp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Gp(r)}function Q5(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function J5(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Q5(Object(t),!0).forEach(function(i){t1(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Q5(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function iet(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function ret(r,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,dee(i.key),i)}}function set(r,e,t){return e&&ret(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function net(r,e,t){return e=Ww(e),aet(r,hee()?Reflect.construct(e,t||[],Ww(r).constructor):e.apply(r,t))}function aet(r,e){if(e&&(Gp(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return oet(r)}function oet(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function hee(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(hee=function(){return!!r})()}function Ww(r){return Ww=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ww(r)}function cet(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&xD(r,e)}function xD(r,e){return xD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},xD(r,e)}function t1(r,e,t){return e=dee(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function dee(r){var e=uet(r,"string");return Gp(e)=="symbol"?e:e+""}function uet(r,e){if(Gp(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Gp(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var het=function(e,t,i,s,n){var a=n.x1,o=n.x2,l=n.y1,c=n.y2,u=n.xAxis,h=n.yAxis;if(!u||!h)return null;var d=dk({x:u.scale,y:h.scale}),f={x:e?d.x.apply(a,{position:"start"}):d.x.rangeMin,y:i?d.y.apply(l,{position:"start"}):d.y.rangeMin},p={x:t?d.x.apply(o,{position:"end"}):d.x.rangeMax,y:s?d.y.apply(c,{position:"end"}):d.y.rangeMax};return ka(n,"discard")&&(!d.isInRange(f)||!d.isInRange(p))?null:YJ(f,p)},i1=function(r){function e(){return iet(this,e),net(this,e,arguments)}return cet(e,r),set(e,[{key:"render",value:function(){var i=this.props,s=i.x1,n=i.x2,a=i.y1,o=i.y2,l=i.className,c=i.alwaysShow,u=i.clipPathId;$o(c===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var h=Ui(s),d=Ui(n),f=Ui(a),p=Ui(o),m=this.props.shape;if(!h&&!d&&!f&&!p&&!m)return null;var g=het(h,d,f,p,this.props);if(!g&&!m)return null;var _=ka(this.props,"hidden")?"url(#".concat(u,")"):void 0;return U.createElement(et,{className:Re("recharts-reference-area",l)},e.renderRect(m,J5(J5({clipPath:_},Se(this.props,!0)),g)),Ki.renderCallByParent(this.props,g))}}])}(U.Component);t1(i1,"displayName","ReferenceArea");t1(i1,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});t1(i1,"renderRect",function(r,e){var t;return U.isValidElement(r)?t=U.cloneElement(r,e):Ce(r)?t=r(e):t=U.createElement(hk,SD({},e,{className:"recharts-reference-area-rect"})),t});function fee(r,e,t){if(e<1)return[];if(e===1&&t===void 0)return r;for(var i=[],s=0;s<r.length;s+=e)i.push(r[s]);return i}function det(r,e,t){var i={width:r.width+e.width,height:r.height+e.height};return AJe(i,t)}function fet(r,e,t){var i=t==="width",s=r.x,n=r.y,a=r.width,o=r.height;return e===1?{start:i?s:n,end:i?s+a:n+o}:{start:i?s+a:n+o,end:i?s:n}}function Xw(r,e,t,i,s){if(r*e<r*i||r*e>r*s)return!1;var n=t();return r*(e-r*n/2-i)>=0&&r*(e+r*n/2-s)<=0}function pet(r,e){return fee(r,e+1)}function met(r,e,t,i,s){for(var n=(i||[]).slice(),a=e.start,o=e.end,l=0,c=1,u=a,h=function(){var p=i==null?void 0:i[l];if(p===void 0)return{v:fee(i,c)};var m=l,g,_=function(){return g===void 0&&(g=t(p,m)),g},v=p.coordinate,y=l===0||Xw(r,v,_,u,o);y||(l=0,u=a,c+=1),y&&(u=v+r*(_()/2+s),l+=c)},d;c<=n.length;)if(d=h(),d)return d.v;return[]}function Yv(r){"@babel/helpers - typeof";return Yv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yv(r)}function eH(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function vr(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?eH(Object(t),!0).forEach(function(i){get(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):eH(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function get(r,e,t){return e=_et(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function _et(r){var e=vet(r,"string");return Yv(e)=="symbol"?e:e+""}function vet(r,e){if(Yv(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Yv(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function yet(r,e,t,i,s){for(var n=(i||[]).slice(),a=n.length,o=e.start,l=e.end,c=function(d){var f=n[d],p,m=function(){return p===void 0&&(p=t(f,d)),p};if(d===a-1){var g=r*(f.coordinate+r*m()/2-l);n[d]=f=vr(vr({},f),{},{tickCoord:g>0?f.coordinate-g*r:f.coordinate})}else n[d]=f=vr(vr({},f),{},{tickCoord:f.coordinate});var _=Xw(r,f.tickCoord,m,o,l);_&&(l=f.tickCoord-r*(m()/2+s),n[d]=vr(vr({},f),{},{isShow:!0}))},u=a-1;u>=0;u--)c(u);return n}function xet(r,e,t,i,s,n){var a=(i||[]).slice(),o=a.length,l=e.start,c=e.end;if(n){var u=i[o-1],h=t(u,o-1),d=r*(u.coordinate+r*h/2-c);a[o-1]=u=vr(vr({},u),{},{tickCoord:d>0?u.coordinate-d*r:u.coordinate});var f=Xw(r,u.tickCoord,function(){return h},l,c);f&&(c=u.tickCoord-r*(h/2+s),a[o-1]=vr(vr({},u),{},{isShow:!0}))}for(var p=n?o-1:o,m=function(v){var y=a[v],x,S=function(){return x===void 0&&(x=t(y,v)),x};if(v===0){var w=r*(y.coordinate-r*S()/2-l);a[v]=y=vr(vr({},y),{},{tickCoord:w<0?y.coordinate-w*r:y.coordinate})}else a[v]=y=vr(vr({},y),{},{tickCoord:y.coordinate});var T=Xw(r,y.tickCoord,S,l,c);T&&(l=y.tickCoord+r*(S()/2+s),a[v]=vr(vr({},y),{},{isShow:!0}))},g=0;g<p;g++)m(g);return a}function bet(r,e,t){var i=r.tick,s=r.ticks,n=r.viewBox,a=r.minTickGap,o=r.orientation,l=r.interval,c=r.tickFormatter,u=r.unit,h=r.angle;if(!s||!s.length||!i)return[];if(oe(l)||Uh.isSsr)return pet(s,typeof l=="number"&&oe(l)?l:0);var d=[],f=o==="top"||o==="bottom"?"width":"height",p=u&&f==="width"?h_(u,{fontSize:e,letterSpacing:t}):{width:0,height:0},m=function(y,x){var S=Ce(c)?c(y.value,x):y.value;return f==="width"?det(h_(S,{fontSize:e,letterSpacing:t}),p,h):h_(S,{fontSize:e,letterSpacing:t})[f]},g=s.length>=2?Nr(s[1].coordinate-s[0].coordinate):1,_=fet(n,g,f);return l==="equidistantPreserveStart"?met(g,_,m,s,a):(l==="preserveStart"||l==="preserveStartEnd"?d=xet(g,_,m,s,a,l==="preserveStartEnd"):d=yet(g,_,m,s,a),d.filter(function(v){return v.isShow}))}var wet=["viewBox"],Tet=["viewBox"],Eet=["ticks"];function Wp(r){"@babel/helpers - typeof";return Wp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wp(r)}function tf(){return tf=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},tf.apply(this,arguments)}function tH(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function Pi(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?tH(Object(t),!0).forEach(function(i){mk(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):tH(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function BP(r,e){if(r==null)return{};var t=Aet(r,e),i,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(r,i)&&(t[i]=r[i])}return t}function Aet(r,e){if(r==null)return{};var t={};for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(e.indexOf(i)>=0)continue;t[i]=r[i]}return t}function Cet(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function iH(r,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,mee(i.key),i)}}function Pet(r,e,t){return e&&iH(r.prototype,e),t&&iH(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}function Iet(r,e,t){return e=qw(e),Met(r,pee()?Reflect.construct(e,t||[],qw(r).constructor):e.apply(r,t))}function Met(r,e){if(e&&(Wp(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ret(r)}function Ret(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function pee(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(pee=function(){return!!r})()}function qw(r){return qw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},qw(r)}function Det(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&bD(r,e)}function bD(r,e){return bD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},bD(r,e)}function mk(r,e,t){return e=mee(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function mee(r){var e=Let(r,"string");return Wp(e)=="symbol"?e:e+""}function Let(r,e){if(Wp(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Wp(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var r1=function(r){function e(t){var i;return Cet(this,e),i=Iet(this,e,[t]),i.state={fontSize:"",letterSpacing:""},i}return Det(e,r),Pet(e,[{key:"shouldComponentUpdate",value:function(i,s){var n=i.viewBox,a=BP(i,wet),o=this.props,l=o.viewBox,c=BP(o,Tet);return!Ff(n,l)||!Ff(a,c)||!Ff(s,this.state)}},{key:"componentDidMount",value:function(){var i=this.layerReference;if(i){var s=i.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];s&&this.setState({fontSize:window.getComputedStyle(s).fontSize,letterSpacing:window.getComputedStyle(s).letterSpacing})}}},{key:"getTickLineCoord",value:function(i){var s=this.props,n=s.x,a=s.y,o=s.width,l=s.height,c=s.orientation,u=s.tickSize,h=s.mirror,d=s.tickMargin,f,p,m,g,_,v,y=h?-1:1,x=i.tickSize||u,S=oe(i.tickCoord)?i.tickCoord:i.coordinate;switch(c){case"top":f=p=i.coordinate,g=a+ +!h*l,m=g-y*x,v=m-y*d,_=S;break;case"left":m=g=i.coordinate,p=n+ +!h*o,f=p-y*x,_=f-y*d,v=S;break;case"right":m=g=i.coordinate,p=n+ +h*o,f=p+y*x,_=f+y*d,v=S;break;default:f=p=i.coordinate,g=a+ +h*l,m=g+y*x,v=m+y*d,_=S;break}return{line:{x1:f,y1:m,x2:p,y2:g},tick:{x:_,y:v}}}},{key:"getTickTextAnchor",value:function(){var i=this.props,s=i.orientation,n=i.mirror,a;switch(s){case"left":a=n?"start":"end";break;case"right":a=n?"end":"start";break;default:a="middle";break}return a}},{key:"getTickVerticalAnchor",value:function(){var i=this.props,s=i.orientation,n=i.mirror,a="end";switch(s){case"left":case"right":a="middle";break;case"top":a=n?"start":"end";break;default:a=n?"end":"start";break}return a}},{key:"renderAxisLine",value:function(){var i=this.props,s=i.x,n=i.y,a=i.width,o=i.height,l=i.orientation,c=i.mirror,u=i.axisLine,h=Pi(Pi(Pi({},Se(this.props,!1)),Se(u,!1)),{},{fill:"none"});if(l==="top"||l==="bottom"){var d=+(l==="top"&&!c||l==="bottom"&&c);h=Pi(Pi({},h),{},{x1:s,y1:n+d*o,x2:s+a,y2:n+d*o})}else{var f=+(l==="left"&&!c||l==="right"&&c);h=Pi(Pi({},h),{},{x1:s+f*a,y1:n,x2:s+f*a,y2:n+o})}return U.createElement("line",tf({},h,{className:Re("recharts-cartesian-axis-line",Cs(u,"className"))}))}},{key:"renderTicks",value:function(i,s,n){var a=this,o=this.props,l=o.tickLine,c=o.stroke,u=o.tick,h=o.tickFormatter,d=o.unit,f=bet(Pi(Pi({},this.props),{},{ticks:i}),s,n),p=this.getTickTextAnchor(),m=this.getTickVerticalAnchor(),g=Se(this.props,!1),_=Se(u,!1),v=Pi(Pi({},g),{},{fill:"none"},Se(l,!1)),y=f.map(function(x,S){var w=a.getTickLineCoord(x),T=w.line,A=w.tick,C=Pi(Pi(Pi(Pi({textAnchor:p,verticalAnchor:m},g),{},{stroke:"none",fill:c},_),A),{},{index:S,payload:x,visibleTicksCount:f.length,tickFormatter:h});return U.createElement(et,tf({className:"recharts-cartesian-axis-tick",key:"tick-".concat(x.value,"-").concat(x.coordinate,"-").concat(x.tickCoord)},Eh(a.props,x,S)),l&&U.createElement("line",tf({},v,T,{className:Re("recharts-cartesian-axis-tick-line",Cs(l,"className"))})),u&&e.renderTickItem(u,C,"".concat(Ce(h)?h(x.value,S):x.value).concat(d||"")))});return U.createElement("g",{className:"recharts-cartesian-axis-ticks"},y)}},{key:"render",value:function(){var i=this,s=this.props,n=s.axisLine,a=s.width,o=s.height,l=s.ticksGenerator,c=s.className,u=s.hide;if(u)return null;var h=this.props,d=h.ticks,f=BP(h,Eet),p=d;return Ce(l)&&(p=d&&d.length>0?l(this.props):l(f)),a<=0||o<=0||!p||!p.length?null:U.createElement(et,{className:Re("recharts-cartesian-axis",c),ref:function(g){i.layerReference=g}},n&&this.renderAxisLine(),this.renderTicks(p,this.state.fontSize,this.state.letterSpacing),Ki.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(i,s,n){var a,o=Re(s.className,"recharts-cartesian-axis-tick-value");return U.isValidElement(i)?a=U.cloneElement(i,Pi(Pi({},s),{},{className:o})):Ce(i)?a=i(Pi(Pi({},s),{},{className:o})):a=U.createElement(Ah,tf({},s,{className:"recharts-cartesian-axis-tick-value"}),n),a}}])}(E.Component);mk(r1,"displayName","CartesianAxis");mk(r1,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var Oet=["type","layout","connectNulls","ref"],Net=["key"];function Xp(r){"@babel/helpers - typeof";return Xp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xp(r)}function rH(r,e){if(r==null)return{};var t=ket(r,e),i,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(r,i)&&(t[i]=r[i])}return t}function ket(r,e){if(r==null)return{};var t={};for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(e.indexOf(i)>=0)continue;t[i]=r[i]}return t}function __(){return __=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},__.apply(this,arguments)}function sH(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function fs(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?sH(Object(t),!0).forEach(function(i){Fn(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):sH(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function Id(r){return zet(r)||Uet(r)||Bet(r)||Fet()}function Fet(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Bet(r,e){if(r){if(typeof r=="string")return wD(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return wD(r,e)}}function Uet(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function zet(r){if(Array.isArray(r))return wD(r)}function wD(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=r[t];return i}function Vet(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function nH(r,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,_ee(i.key),i)}}function jet(r,e,t){return e&&nH(r.prototype,e),t&&nH(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}function $et(r,e,t){return e=Yw(e),Het(r,gee()?Reflect.construct(e,t||[],Yw(r).constructor):e.apply(r,t))}function Het(r,e){if(e&&(Xp(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Get(r)}function Get(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function gee(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(gee=function(){return!!r})()}function Yw(r){return Yw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Yw(r)}function Wet(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&TD(r,e)}function TD(r,e){return TD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},TD(r,e)}function Fn(r,e,t){return e=_ee(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function _ee(r){var e=Xet(r,"string");return Xp(e)=="symbol"?e:e+""}function Xet(r,e){if(Xp(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Xp(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var Zy=function(r){function e(){var t;Vet(this,e);for(var i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return t=$et(this,e,[].concat(s)),Fn(t,"state",{isAnimationFinished:!0,totalLength:0}),Fn(t,"generateSimpleStrokeDasharray",function(a,o){return"".concat(o,"px ").concat(a-o,"px")}),Fn(t,"getStrokeDasharray",function(a,o,l){var c=l.reduce(function(_,v){return _+v});if(!c)return t.generateSimpleStrokeDasharray(o,a);for(var u=Math.floor(a/c),h=a%c,d=o-a,f=[],p=0,m=0;p<l.length;m+=l[p],++p)if(m+l[p]>h){f=[].concat(Id(l.slice(0,p)),[h-m]);break}var g=f.length%2===0?[0,d]:[d];return[].concat(Id(e.repeat(l,u)),Id(f),g).map(function(_){return"".concat(_,"px")}).join(", ")}),Fn(t,"id",wm("recharts-line-")),Fn(t,"pathRef",function(a){t.mainCurve=a}),Fn(t,"handleAnimationEnd",function(){t.setState({isAnimationFinished:!0}),t.props.onAnimationEnd&&t.props.onAnimationEnd()}),Fn(t,"handleAnimationStart",function(){t.setState({isAnimationFinished:!1}),t.props.onAnimationStart&&t.props.onAnimationStart()}),t}return Wet(e,r),jet(e,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var i=this.getTotalLength();this.setState({totalLength:i})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var i=this.getTotalLength();i!==this.state.totalLength&&this.setState({totalLength:i})}}},{key:"getTotalLength",value:function(){var i=this.mainCurve;try{return i&&i.getTotalLength&&i.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(i,s){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var n=this.props,a=n.points,o=n.xAxis,l=n.yAxis,c=n.layout,u=n.children,h=Ps(u,Ky);if(!h)return null;var d=function(m,g){return{x:m.x,y:m.y,value:m.value,errorVal:ki(m.payload,g)}},f={clipPath:i?"url(#clipPath-".concat(s,")"):null};return U.createElement(et,f,h.map(function(p){return U.cloneElement(p,{key:"bar-".concat(p.props.dataKey),data:a,xAxis:o,yAxis:l,layout:c,dataPointFormatter:d})}))}},{key:"renderDots",value:function(i,s,n){var a=this.props.isAnimationActive;if(a&&!this.state.isAnimationFinished)return null;var o=this.props,l=o.dot,c=o.points,u=o.dataKey,h=Se(this.props,!1),d=Se(l,!0),f=c.map(function(m,g){var _=fs(fs(fs({key:"dot-".concat(g),r:3},h),d),{},{index:g,cx:m.x,cy:m.y,value:m.value,dataKey:u,payload:m.payload,points:c});return e.renderDotItem(l,_)}),p={clipPath:i?"url(#clipPath-".concat(s?"":"dots-").concat(n,")"):null};return U.createElement(et,__({className:"recharts-line-dots",key:"dots"},p),f)}},{key:"renderCurveStatically",value:function(i,s,n,a){var o=this.props,l=o.type,c=o.layout,u=o.connectNulls;o.ref;var h=rH(o,Oet),d=fs(fs(fs({},Se(h,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:s?"url(#clipPath-".concat(n,")"):null,points:i},a),{},{type:l,layout:c,connectNulls:u});return U.createElement(Iw,__({},d,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(i,s){var n=this,a=this.props,o=a.points,l=a.strokeDasharray,c=a.isAnimationActive,u=a.animationBegin,h=a.animationDuration,d=a.animationEasing,f=a.animationId,p=a.animateNewValues,m=a.width,g=a.height,_=this.state,v=_.prevPoints,y=_.totalLength;return U.createElement(Ha,{begin:u,duration:h,isActive:c,easing:d,from:{t:0},to:{t:1},key:"line-".concat(f),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(x){var S=x.t;if(v){var w=v.length/o.length,T=o.map(function(M,N){var k=Math.floor(N*w);if(v[k]){var V=v[k],B=Ss(V.x,M.x),R=Ss(V.y,M.y);return fs(fs({},M),{},{x:B(S),y:R(S)})}if(p){var L=Ss(m*2,M.x),D=Ss(g/2,M.y);return fs(fs({},M),{},{x:L(S),y:D(S)})}return fs(fs({},M),{},{x:M.x,y:M.y})});return n.renderCurveStatically(T,i,s)}var A=Ss(0,y),C=A(S),P;if(l){var I="".concat(l).split(/[,\s]+/gim).map(function(M){return parseFloat(M)});P=n.getStrokeDasharray(C,y,I)}else P=n.generateSimpleStrokeDasharray(y,C);return n.renderCurveStatically(o,i,s,{strokeDasharray:P})})}},{key:"renderCurve",value:function(i,s){var n=this.props,a=n.points,o=n.isAnimationActive,l=this.state,c=l.prevPoints,u=l.totalLength;return o&&a&&a.length&&(!c&&u>0||!Yy(c,a))?this.renderCurveWithAnimation(i,s):this.renderCurveStatically(a,i,s)}},{key:"render",value:function(){var i,s=this.props,n=s.hide,a=s.dot,o=s.points,l=s.className,c=s.xAxis,u=s.yAxis,h=s.top,d=s.left,f=s.width,p=s.height,m=s.isAnimationActive,g=s.id;if(n||!o||!o.length)return null;var _=this.state.isAnimationFinished,v=o.length===1,y=Re("recharts-line",l),x=c&&c.allowDataOverflow,S=u&&u.allowDataOverflow,w=x||S,T=Pe(g)?this.id:g,A=(i=Se(a,!1))!==null&&i!==void 0?i:{r:3,strokeWidth:2},C=A.r,P=C===void 0?3:C,I=A.strokeWidth,M=I===void 0?2:I,N=HFe(a)?a:{},k=N.clipDot,V=k===void 0?!0:k,B=P*2+M;return U.createElement(et,{className:y},x||S?U.createElement("defs",null,U.createElement("clipPath",{id:"clipPath-".concat(T)},U.createElement("rect",{x:x?d:d-f/2,y:S?h:h-p/2,width:x?f:f*2,height:S?p:p*2})),!V&&U.createElement("clipPath",{id:"clipPath-dots-".concat(T)},U.createElement("rect",{x:d-B/2,y:h-B/2,width:f+B,height:p+B}))):null,!v&&this.renderCurve(w,T),this.renderErrorBar(w,T),(v||a)&&this.renderDots(w,V,T),(!m||_)&&Go.renderCallByParent(this.props,o))}}],[{key:"getDerivedStateFromProps",value:function(i,s){return i.animationId!==s.prevAnimationId?{prevAnimationId:i.animationId,curPoints:i.points,prevPoints:s.curPoints}:i.points!==s.curPoints?{curPoints:i.points}:null}},{key:"repeat",value:function(i,s){for(var n=i.length%2!==0?[].concat(Id(i),[0]):i,a=[],o=0;o<s;++o)a=[].concat(Id(a),Id(n));return a}},{key:"renderDotItem",value:function(i,s){var n;if(U.isValidElement(i))n=U.cloneElement(i,s);else if(Ce(i))n=i(s);else{var a=s.key,o=rH(s,Net),l=Re("recharts-line-dot",typeof i!="boolean"?i.className:"");n=U.createElement(GA,__({key:a},o,{className:l}))}return n}}])}(E.PureComponent);Fn(Zy,"displayName","Line");Fn(Zy,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Uh.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});Fn(Zy,"getComposedData",function(r){var e=r.props,t=r.xAxis,i=r.yAxis,s=r.xAxisTicks,n=r.yAxisTicks,a=r.dataKey,o=r.bandSize,l=r.displayedData,c=r.offset,u=e.layout,h=l.map(function(d,f){var p=ki(d,a);return u==="horizontal"?{x:R$({axis:t,ticks:s,bandSize:o,entry:d,index:f}),y:Pe(p)?null:i.scale(p),value:p,payload:d}:{x:Pe(p)?null:t.scale(p),y:R$({axis:i,ticks:n,bandSize:o,entry:d,index:f}),value:p,payload:d}});return fs({points:h,layout:u},c)});function qp(r){"@babel/helpers - typeof";return qp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qp(r)}function qet(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Yet(r,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,See(i.key),i)}}function Ket(r,e,t){return e&&Yet(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function Zet(r,e,t){return e=Kw(e),Qet(r,vee()?Reflect.construct(e,t||[],Kw(r).constructor):e.apply(r,t))}function Qet(r,e){if(e&&(qp(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Jet(r)}function Jet(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function vee(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(vee=function(){return!!r})()}function Kw(r){return Kw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Kw(r)}function ett(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&ED(r,e)}function ED(r,e){return ED=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},ED(r,e)}function yee(r,e,t){return e=See(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function See(r){var e=ttt(r,"string");return qp(e)=="symbol"?e:e+""}function ttt(r,e){if(qp(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(qp(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function AD(){return AD=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},AD.apply(this,arguments)}function itt(r){var e=r.xAxisId,t=nee(),i=aee(),s=ree(e);return s==null?null:E.createElement(r1,AD({},s,{className:Re("recharts-".concat(s.axisType," ").concat(s.axisType),s.className),viewBox:{x:0,y:0,width:t,height:i},ticksGenerator:function(a){return Mu(a,!0)}}))}var Yp=function(r){function e(){return qet(this,e),Zet(this,e,arguments)}return ett(e,r),Ket(e,[{key:"render",value:function(){return E.createElement(itt,this.props)}}])}(E.Component);yee(Yp,"displayName","XAxis");yee(Yp,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function Kp(r){"@babel/helpers - typeof";return Kp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kp(r)}function rtt(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function stt(r,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,wee(i.key),i)}}function ntt(r,e,t){return e&&stt(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function att(r,e,t){return e=Zw(e),ott(r,xee()?Reflect.construct(e,t||[],Zw(r).constructor):e.apply(r,t))}function ott(r,e){if(e&&(Kp(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ltt(r)}function ltt(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function xee(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(xee=function(){return!!r})()}function Zw(r){return Zw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Zw(r)}function ctt(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&CD(r,e)}function CD(r,e){return CD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},CD(r,e)}function bee(r,e,t){return e=wee(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function wee(r){var e=utt(r,"string");return Kp(e)=="symbol"?e:e+""}function utt(r,e){if(Kp(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Kp(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function PD(){return PD=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},PD.apply(this,arguments)}var htt=function(e){var t=e.yAxisId,i=nee(),s=aee(),n=see(t);return n==null?null:E.createElement(r1,PD({},n,{className:Re("recharts-".concat(n.axisType," ").concat(n.axisType),n.className),viewBox:{x:0,y:0,width:i,height:s},ticksGenerator:function(o){return Mu(o,!0)}}))},Zp=function(r){function e(){return rtt(this,e),att(this,e,arguments)}return ctt(e,r),ntt(e,[{key:"render",value:function(){return E.createElement(htt,this.props)}}])}(E.Component);bee(Zp,"displayName","YAxis");bee(Zp,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function aH(r){return mtt(r)||ptt(r)||ftt(r)||dtt()}function dtt(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ftt(r,e){if(r){if(typeof r=="string")return ID(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ID(r,e)}}function ptt(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function mtt(r){if(Array.isArray(r))return ID(r)}function ID(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=r[t];return i}var MD=function(e,t,i,s,n){var a=Ps(e,pk),o=Ps(e,e1),l=[].concat(aH(a),aH(o)),c=Ps(e,i1),u="".concat(s,"Id"),h=s[0],d=t;if(l.length&&(d=l.reduce(function(m,g){if(g.props[u]===i&&ka(g.props,"extendDomain")&&oe(g.props[h])){var _=g.props[h];return[Math.min(m[0],_),Math.max(m[1],_)]}return m},d)),c.length){var f="".concat(h,"1"),p="".concat(h,"2");d=c.reduce(function(m,g){if(g.props[u]===i&&ka(g.props,"extendDomain")&&oe(g.props[f])&&oe(g.props[p])){var _=g.props[f],v=g.props[p];return[Math.min(m[0],_,v),Math.max(m[1],_,v)]}return m},d)}return n&&n.length&&(d=n.reduce(function(m,g){return oe(g)?[Math.min(m[0],g),Math.max(m[1],g)]:m},d)),d},Tee={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function s(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function n(l,c,u,h,d){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new s(u,h||l,d),p=t?t+c:c;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],f]:l._events[p].push(f):(l._events[p]=f,l._eventsCount++),l}function a(l,c){--l._eventsCount===0?l._events=new i:delete l._events[c]}function o(){this._events=new i,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],u,h;if(this._eventsCount===0)return c;for(h in u=this._events)e.call(u,h)&&c.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},o.prototype.listeners=function(c){var u=t?t+c:c,h=this._events[u];if(!h)return[];if(h.fn)return[h.fn];for(var d=0,f=h.length,p=new Array(f);d<f;d++)p[d]=h[d].fn;return p},o.prototype.listenerCount=function(c){var u=t?t+c:c,h=this._events[u];return h?h.fn?1:h.length:0},o.prototype.emit=function(c,u,h,d,f,p){var m=t?t+c:c;if(!this._events[m])return!1;var g=this._events[m],_=arguments.length,v,y;if(g.fn){switch(g.once&&this.removeListener(c,g.fn,void 0,!0),_){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,u),!0;case 3:return g.fn.call(g.context,u,h),!0;case 4:return g.fn.call(g.context,u,h,d),!0;case 5:return g.fn.call(g.context,u,h,d,f),!0;case 6:return g.fn.call(g.context,u,h,d,f,p),!0}for(y=1,v=new Array(_-1);y<_;y++)v[y-1]=arguments[y];g.fn.apply(g.context,v)}else{var x=g.length,S;for(y=0;y<x;y++)switch(g[y].once&&this.removeListener(c,g[y].fn,void 0,!0),_){case 1:g[y].fn.call(g[y].context);break;case 2:g[y].fn.call(g[y].context,u);break;case 3:g[y].fn.call(g[y].context,u,h);break;case 4:g[y].fn.call(g[y].context,u,h,d);break;default:if(!v)for(S=1,v=new Array(_-1);S<_;S++)v[S-1]=arguments[S];g[y].fn.apply(g[y].context,v)}}return!0},o.prototype.on=function(c,u,h){return n(this,c,u,h,!1)},o.prototype.once=function(c,u,h){return n(this,c,u,h,!0)},o.prototype.removeListener=function(c,u,h,d){var f=t?t+c:c;if(!this._events[f])return this;if(!u)return a(this,f),this;var p=this._events[f];if(p.fn)p.fn===u&&(!d||p.once)&&(!h||p.context===h)&&a(this,f);else{for(var m=0,g=[],_=p.length;m<_;m++)(p[m].fn!==u||d&&!p[m].once||h&&p[m].context!==h)&&g.push(p[m]);g.length?this._events[f]=g.length===1?g[0]:g:a(this,f)}return this},o.prototype.removeAllListeners=function(c){var u;return c?(u=t?t+c:c,this._events[u]&&a(this,u)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,r.exports=o})(Tee);var gtt=Tee.exports;const _tt=pt(gtt);var UP=new _tt,zP="recharts.syncMouseEvents";function Kv(r){"@babel/helpers - typeof";return Kv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kv(r)}function vtt(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function ytt(r,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,Eee(i.key),i)}}function Stt(r,e,t){return e&&ytt(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function VP(r,e,t){return e=Eee(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Eee(r){var e=xtt(r,"string");return Kv(e)=="symbol"?e:e+""}function xtt(r,e){if(Kv(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Kv(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var btt=function(){function r(){vtt(this,r),VP(this,"activeIndex",0),VP(this,"coordinateList",[]),VP(this,"layout","horizontal")}return Stt(r,[{key:"setDetails",value:function(t){var i,s=t.coordinateList,n=s===void 0?null:s,a=t.container,o=a===void 0?null:a,l=t.layout,c=l===void 0?null:l,u=t.offset,h=u===void 0?null:u,d=t.mouseHandlerCallback,f=d===void 0?null:d;this.coordinateList=(i=n??this.coordinateList)!==null&&i!==void 0?i:[],this.container=o??this.container,this.layout=c??this.layout,this.offset=h??this.offset,this.mouseHandlerCallback=f??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(t){if(this.coordinateList.length!==0)switch(t.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(t){this.activeIndex=t}},{key:"spoofMouse",value:function(){var t,i;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var s=this.container.getBoundingClientRect(),n=s.x,a=s.y,o=s.height,l=this.coordinateList[this.activeIndex].coordinate,c=((t=window)===null||t===void 0?void 0:t.scrollX)||0,u=((i=window)===null||i===void 0?void 0:i.scrollY)||0,h=n+l+c,d=a+this.offset.top+o/2+u;this.mouseHandlerCallback({pageX:h,pageY:d})}}}])}();function wtt(r,e,t){if(t==="number"&&e===!0&&Array.isArray(r)){var i=r==null?void 0:r[0],s=r==null?void 0:r[1];if(i&&s&&oe(i)&&oe(s))return!0}return!1}function Ttt(r,e,t,i){var s=i/2;return{stroke:"none",fill:"#ccc",x:r==="horizontal"?e.x-s:t.left+.5,y:r==="horizontal"?t.top+.5:e.y-s,width:r==="horizontal"?i:t.width-1,height:r==="horizontal"?t.height-1:i}}function Aee(r){var e=r.cx,t=r.cy,i=r.radius,s=r.startAngle,n=r.endAngle,a=Lt(e,t,i,s),o=Lt(e,t,i,n);return{points:[a,o],cx:e,cy:t,radius:i,startAngle:s,endAngle:n}}function Ett(r,e,t){var i,s,n,a;if(r==="horizontal")i=e.x,n=i,s=t.top,a=t.top+t.height;else if(r==="vertical")s=e.y,a=s,i=t.left,n=t.left+t.width;else if(e.cx!=null&&e.cy!=null)if(r==="centric"){var o=e.cx,l=e.cy,c=e.innerRadius,u=e.outerRadius,h=e.angle,d=Lt(o,l,c,h),f=Lt(o,l,u,h);i=d.x,s=d.y,n=f.x,a=f.y}else return Aee(e);return[{x:i,y:s},{x:n,y:a}]}function Zv(r){"@babel/helpers - typeof";return Zv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Zv(r)}function oH(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function FS(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?oH(Object(t),!0).forEach(function(i){Att(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):oH(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function Att(r,e,t){return e=Ctt(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Ctt(r){var e=Ptt(r,"string");return Zv(e)=="symbol"?e:e+""}function Ptt(r,e){if(Zv(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Zv(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function Itt(r){var e,t,i=r.element,s=r.tooltipEventType,n=r.isActive,a=r.activeCoordinate,o=r.activePayload,l=r.offset,c=r.activeTooltipIndex,u=r.tooltipAxisBandSize,h=r.layout,d=r.chartName,f=(e=i.props.cursor)!==null&&e!==void 0?e:(t=i.type.defaultProps)===null||t===void 0?void 0:t.cursor;if(!i||!f||!n||!a||d!=="ScatterChart"&&s!=="axis")return null;var p,m=Iw;if(d==="ScatterChart")p=a,m=b7e;else if(d==="BarChart")p=Ttt(h,a,l,u),m=hk;else if(h==="radial"){var g=Aee(a),_=g.cx,v=g.cy,y=g.radius,x=g.startAngle,S=g.endAngle;p={cx:_,cy:v,startAngle:x,endAngle:S,innerRadius:y,outerRadius:y},m=bJ}else p={points:Ett(h,a,l)},m=Iw;var w=FS(FS(FS(FS({stroke:"#ccc",pointerEvents:"none"},l),p),Se(f,!1)),{},{payload:o,payloadIndex:c,className:Re("recharts-tooltip-cursor",f.className)});return E.isValidElement(f)?E.cloneElement(f,w):E.createElement(m,w)}var Mtt=["item"],Rtt=["children","className","width","height","style","compact","title","desc"];function Qp(r){"@babel/helpers - typeof";return Qp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qp(r)}function rf(){return rf=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},rf.apply(this,arguments)}function lH(r,e){return Ott(r)||Ltt(r,e)||Pee(r,e)||Dtt()}function Dtt(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ltt(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var i,s,n,a,o=[],l=!0,c=!1;try{if(n=(t=t.call(r)).next,e!==0)for(;!(l=(i=n.call(t)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(u){c=!0,s=u}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(c)throw s}}return o}}function Ott(r){if(Array.isArray(r))return r}function cH(r,e){if(r==null)return{};var t=Ntt(r,e),i,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(r,i)&&(t[i]=r[i])}return t}function Ntt(r,e){if(r==null)return{};var t={};for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(e.indexOf(i)>=0)continue;t[i]=r[i]}return t}function ktt(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Ftt(r,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,Iee(i.key),i)}}function Btt(r,e,t){return e&&Ftt(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function Utt(r,e,t){return e=Qw(e),ztt(r,Cee()?Reflect.construct(e,t||[],Qw(r).constructor):e.apply(r,t))}function ztt(r,e){if(e&&(Qp(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Vtt(r)}function Vtt(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function Cee(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Cee=function(){return!!r})()}function Qw(r){return Qw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Qw(r)}function jtt(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&RD(r,e)}function RD(r,e){return RD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},RD(r,e)}function Jp(r){return Gtt(r)||Htt(r)||Pee(r)||$tt()}function $tt(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Pee(r,e){if(r){if(typeof r=="string")return DD(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return DD(r,e)}}function Htt(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function Gtt(r){if(Array.isArray(r))return DD(r)}function DD(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=r[t];return i}function uH(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function Z(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?uH(Object(t),!0).forEach(function(i){xe(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):uH(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function xe(r,e,t){return e=Iee(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Iee(r){var e=Wtt(r,"string");return Qp(e)=="symbol"?e:e+""}function Wtt(r,e){if(Qp(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(Qp(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}var Xtt={xAxis:["bottom","top"],yAxis:["left","right"]},qtt={width:"100%",height:"100%"},Mee={x:0,y:0};function BS(r){return r}var Ytt=function(e,t){return t==="horizontal"?e.x:t==="vertical"?e.y:t==="centric"?e.angle:e.radius},Ktt=function(e,t,i,s){var n=t.find(function(u){return u&&u.index===i});if(n){if(e==="horizontal")return{x:n.coordinate,y:s.y};if(e==="vertical")return{x:s.x,y:n.coordinate};if(e==="centric"){var a=n.coordinate,o=s.radius;return Z(Z(Z({},s),Lt(s.cx,s.cy,o,a)),{},{angle:a,radius:o})}var l=n.coordinate,c=s.angle;return Z(Z(Z({},s),Lt(s.cx,s.cy,l,c)),{},{angle:c,radius:l})}return Mee},s1=function(e,t){var i=t.graphicalItems,s=t.dataStartIndex,n=t.dataEndIndex,a=(i??[]).reduce(function(o,l){var c=l.props.data;return c&&c.length?[].concat(Jp(o),Jp(c)):o},[]);return a.length>0?a:e&&e.length&&oe(s)&&oe(n)?e.slice(s,n+1):[]};function Ree(r){return r==="number"?[0,"auto"]:void 0}var LD=function(e,t,i,s){var n=e.graphicalItems,a=e.tooltipAxis,o=s1(t,e);return i<0||!n||!n.length||i>=o.length?null:n.reduce(function(l,c){var u,h=(u=c.props.data)!==null&&u!==void 0?u:t;h&&e.dataStartIndex+e.dataEndIndex!==0&&e.dataEndIndex-e.dataStartIndex>=i&&(h=h.slice(e.dataStartIndex,e.dataEndIndex+1));var d;if(a.dataKey&&!a.allowDuplicatedCategory){var f=h===void 0?o:h;d=Qb(f,a.dataKey,s)}else d=h&&h[i]||o[i];return d?[].concat(Jp(l),[gJ(c,d)]):l},[])},hH=function(e,t,i,s){var n=s||{x:e.chartX,y:e.chartY},a=Ytt(n,i),o=e.orderedTooltipTicks,l=e.tooltipAxis,c=e.tooltipTicks,u=Wqe(a,o,c,l);if(u>=0&&c){var h=c[u]&&c[u].value,d=LD(e,t,u,h),f=Ktt(i,o,u,n);return{activeTooltipIndex:u,activeLabel:h,activePayload:d,activeCoordinate:f}}return null},Ztt=function(e,t){var i=t.axes,s=t.graphicalItems,n=t.axisType,a=t.axisIdKey,o=t.stackGroups,l=t.dataStartIndex,c=t.dataEndIndex,u=e.layout,h=e.children,d=e.stackOffset,f=hJ(u,n);return i.reduce(function(p,m){var g,_=m.type.defaultProps!==void 0?Z(Z({},m.type.defaultProps),m.props):m.props,v=_.type,y=_.dataKey,x=_.allowDataOverflow,S=_.allowDuplicatedCategory,w=_.scale,T=_.ticks,A=_.includeHidden,C=_[a];if(p[C])return p;var P=s1(e.data,{graphicalItems:s.filter(function(z){var $,H=a in z.props?z.props[a]:($=z.type.defaultProps)===null||$===void 0?void 0:$[a];return H===C}),dataStartIndex:l,dataEndIndex:c}),I=P.length,M,N,k;wtt(_.domain,x,v)&&(M=XR(_.domain,null,x),f&&(v==="number"||w!=="auto")&&(k=f_(P,y,"category")));var V=Ree(v);if(!M||M.length===0){var B,R=(B=_.domain)!==null&&B!==void 0?B:V;if(y){if(M=f_(P,y,v),v==="category"&&f){var L=OFe(M);S&&L?(N=M,M=Uw(0,I)):S||(M=N$(R,M,m).reduce(function(z,$){return z.indexOf($)>=0?z:[].concat(Jp(z),[$])},[]))}else if(v==="category")S?M=M.filter(function(z){return z!==""&&!Pe(z)}):M=N$(R,M,m).reduce(function(z,$){return z.indexOf($)>=0||$===""||Pe($)?z:[].concat(Jp(z),[$])},[]);else if(v==="number"){var D=Zqe(P,s.filter(function(z){var $,H,G=a in z.props?z.props[a]:($=z.type.defaultProps)===null||$===void 0?void 0:$[a],Y="hide"in z.props?z.props.hide:(H=z.type.defaultProps)===null||H===void 0?void 0:H.hide;return G===C&&(A||!Y)}),y,n,u);D&&(M=D)}f&&(v==="number"||w!=="auto")&&(k=f_(P,y,"category"))}else f?M=Uw(0,I):o&&o[C]&&o[C].hasStack&&v==="number"?M=d==="expand"?[0,1]:mJ(o[C].stackGroups,l,c):M=uJ(P,s.filter(function(z){var $=a in z.props?z.props[a]:z.type.defaultProps[a],H="hide"in z.props?z.props.hide:z.type.defaultProps.hide;return $===C&&(A||!H)}),v,u,!0);if(v==="number")M=MD(h,M,C,n,T),R&&(M=XR(R,M,x));else if(v==="category"&&R){var F=R,j=M.every(function(z){return F.indexOf(z)>=0});j&&(M=F)}}return Z(Z({},p),{},xe({},C,Z(Z({},_),{},{axisType:n,domain:M,categoricalDomain:k,duplicateDomain:N,originalDomain:(g=_.domain)!==null&&g!==void 0?g:V,isCategorical:f,layout:u})))},{})},Qtt=function(e,t){var i=t.graphicalItems,s=t.Axis,n=t.axisType,a=t.axisIdKey,o=t.stackGroups,l=t.dataStartIndex,c=t.dataEndIndex,u=e.layout,h=e.children,d=s1(e.data,{graphicalItems:i,dataStartIndex:l,dataEndIndex:c}),f=d.length,p=hJ(u,n),m=-1;return i.reduce(function(g,_){var v=_.type.defaultProps!==void 0?Z(Z({},_.type.defaultProps),_.props):_.props,y=v[a],x=Ree("number");if(!g[y]){m++;var S;return p?S=Uw(0,f):o&&o[y]&&o[y].hasStack?(S=mJ(o[y].stackGroups,l,c),S=MD(h,S,y,n)):(S=XR(x,uJ(d,i.filter(function(w){var T,A,C=a in w.props?w.props[a]:(T=w.type.defaultProps)===null||T===void 0?void 0:T[a],P="hide"in w.props?w.props.hide:(A=w.type.defaultProps)===null||A===void 0?void 0:A.hide;return C===y&&!P}),"number",u),s.defaultProps.allowDataOverflow),S=MD(h,S,y,n)),Z(Z({},g),{},xe({},y,Z(Z({axisType:n},s.defaultProps),{},{hide:!0,orientation:Cs(Xtt,"".concat(n,".").concat(m%2),null),domain:S,originalDomain:x,isCategorical:p,layout:u})))}return g},{})},Jtt=function(e,t){var i=t.axisType,s=i===void 0?"xAxis":i,n=t.AxisComp,a=t.graphicalItems,o=t.stackGroups,l=t.dataStartIndex,c=t.dataEndIndex,u=e.children,h="".concat(s,"Id"),d=Ps(u,n),f={};return d&&d.length?f=Ztt(e,{axes:d,graphicalItems:a,axisType:s,axisIdKey:h,stackGroups:o,dataStartIndex:l,dataEndIndex:c}):a&&a.length&&(f=Qtt(e,{Axis:n,graphicalItems:a,axisType:s,axisIdKey:h,stackGroups:o,dataStartIndex:l,dataEndIndex:c})),f},eit=function(e){var t=Od(e),i=Mu(t,!1,!0);return{tooltipTicks:i,orderedTooltipTicks:BN(i,function(s){return s.coordinate}),tooltipAxis:t,tooltipAxisBandSize:Aw(t,i)}},dH=function(e){var t=e.children,i=e.defaultShowTooltip,s=_s(t,Vp),n=0,a=0;return e.data&&e.data.length!==0&&(a=e.data.length-1),s&&s.props&&(s.props.startIndex>=0&&(n=s.props.startIndex),s.props.endIndex>=0&&(a=s.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:n,dataEndIndex:a,activeTooltipIndex:-1,isTooltipActive:!!i}},tit=function(e){return!e||!e.length?!1:e.some(function(t){var i=jo(t&&t.type);return i&&i.indexOf("Bar")>=0})},fH=function(e){return e==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:e==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:e==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},iit=function(e,t){var i=e.props,s=e.graphicalItems,n=e.xAxisMap,a=n===void 0?{}:n,o=e.yAxisMap,l=o===void 0?{}:o,c=i.width,u=i.height,h=i.children,d=i.margin||{},f=_s(h,Vp),p=_s(h,Bf),m=Object.keys(l).reduce(function(S,w){var T=l[w],A=T.orientation;return!T.mirror&&!T.hide?Z(Z({},S),{},xe({},A,S[A]+T.width)):S},{left:d.left||0,right:d.right||0}),g=Object.keys(a).reduce(function(S,w){var T=a[w],A=T.orientation;return!T.mirror&&!T.hide?Z(Z({},S),{},xe({},A,Cs(S,"".concat(A))+T.height)):S},{top:d.top||0,bottom:d.bottom||0}),_=Z(Z({},g),m),v=_.bottom;f&&(_.bottom+=f.props.height||Vp.defaultProps.height),p&&t&&(_=Yqe(_,s,i,t));var y=c-_.left-_.right,x=u-_.top-_.bottom;return Z(Z({brushBottom:v},_),{},{width:Math.max(y,0),height:Math.max(x,0)})},rit=function(e,t){if(t==="xAxis")return e[t].width;if(t==="yAxis")return e[t].height},gk=function(e){var t=e.chartName,i=e.GraphicalChild,s=e.defaultTooltipEventType,n=s===void 0?"axis":s,a=e.validateTooltipEventTypes,o=a===void 0?["axis"]:a,l=e.axisComponents,c=e.legendContent,u=e.formatAxisMap,h=e.defaultProps,d=function(_,v){var y=v.graphicalItems,x=v.stackGroups,S=v.offset,w=v.updateId,T=v.dataStartIndex,A=v.dataEndIndex,C=_.barSize,P=_.layout,I=_.barGap,M=_.barCategoryGap,N=_.maxBarSize,k=fH(P),V=k.numericAxisName,B=k.cateAxisName,R=tit(y),L=[];return y.forEach(function(D,F){var j=s1(_.data,{graphicalItems:[D],dataStartIndex:T,dataEndIndex:A}),z=D.type.defaultProps!==void 0?Z(Z({},D.type.defaultProps),D.props):D.props,$=z.dataKey,H=z.maxBarSize,G=z["".concat(V,"Id")],Y=z["".concat(B,"Id")],W={},ie=l.reduce(function(ni,Ci){var er=v["".concat(Ci.axisType,"Map")],lr=z["".concat(Ci.axisType,"Id")];er&&er[lr]||Ci.axisType==="zAxis"||Ph();var Cr=er[lr];return Z(Z({},ni),{},xe(xe({},Ci.axisType,Cr),"".concat(Ci.axisType,"Ticks"),Mu(Cr)))},W),q=ie[B],K=ie["".concat(B,"Ticks")],te=x&&x[G]&&x[G].hasStack&&a9e(D,x[G].stackGroups),X=jo(D.type).indexOf("Bar")>=0,_e=Aw(q,K),pe=[],ze=R&&Xqe({barSize:C,stackGroups:x,totalSize:rit(ie,B)});if(X){var Fe,vt,ne=Pe(H)?N:H,vi=(Fe=(vt=Aw(q,K,!0))!==null&&vt!==void 0?vt:ne)!==null&&Fe!==void 0?Fe:0;pe=qqe({barGap:I,barCategoryGap:M,bandSize:vi!==_e?vi:_e,sizeList:ze[Y],maxBarSize:ne}),vi!==_e&&(pe=pe.map(function(ni){return Z(Z({},ni),{},{position:Z(Z({},ni.position),{},{offset:ni.position.offset-vi/2})})}))}var pi=D&&D.type&&D.type.getComposedData;pi&&L.push({props:Z(Z({},pi(Z(Z({},ie),{},{displayedData:j,props:_,dataKey:$,item:D,bandSize:_e,barPosition:pe,offset:S,stackedData:te,layout:P,dataStartIndex:T,dataEndIndex:A}))),{},xe(xe(xe({key:D.key||"item-".concat(F)},V,ie[V]),B,ie[B]),"animationId",w)),childIndex:XFe(D,_.children),item:D})}),L},f=function(_,v){var y=_.props,x=_.dataStartIndex,S=_.dataEndIndex,w=_.updateId;if(!P4({props:y}))return null;var T=y.children,A=y.layout,C=y.stackOffset,P=y.data,I=y.reverseStackOrder,M=fH(A),N=M.numericAxisName,k=M.cateAxisName,V=Ps(T,i),B=s9e(P,V,"".concat(N,"Id"),"".concat(k,"Id"),C,I),R=l.reduce(function(z,$){var H="".concat($.axisType,"Map");return Z(Z({},z),{},xe({},H,Jtt(y,Z(Z({},$),{},{graphicalItems:V,stackGroups:$.axisType===N&&B,dataStartIndex:x,dataEndIndex:S}))))},{}),L=iit(Z(Z({},R),{},{props:y,graphicalItems:V}),v==null?void 0:v.legendBBox);Object.keys(R).forEach(function(z){R[z]=u(y,R[z],L,z.replace("Map",""),t)});var D=R["".concat(k,"Map")],F=eit(D),j=d(y,Z(Z({},R),{},{dataStartIndex:x,dataEndIndex:S,updateId:w,graphicalItems:V,stackGroups:B,offset:L}));return Z(Z({formattedGraphicalItems:j,graphicalItems:V,offset:L,stackGroups:B},F),R)},p=function(g){function _(v){var y,x,S;return ktt(this,_),S=Utt(this,_,[v]),xe(S,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),xe(S,"accessibilityManager",new btt),xe(S,"handleLegendBBoxUpdate",function(w){if(w){var T=S.state,A=T.dataStartIndex,C=T.dataEndIndex,P=T.updateId;S.setState(Z({legendBBox:w},f({props:S.props,dataStartIndex:A,dataEndIndex:C,updateId:P},Z(Z({},S.state),{},{legendBBox:w}))))}}),xe(S,"handleReceiveSyncEvent",function(w,T,A){if(S.props.syncId===w){if(A===S.eventEmitterSymbol&&typeof S.props.syncMethod!="function")return;S.applySyncEvent(T)}}),xe(S,"handleBrushChange",function(w){var T=w.startIndex,A=w.endIndex;if(T!==S.state.dataStartIndex||A!==S.state.dataEndIndex){var C=S.state.updateId;S.setState(function(){return Z({dataStartIndex:T,dataEndIndex:A},f({props:S.props,dataStartIndex:T,dataEndIndex:A,updateId:C},S.state))}),S.triggerSyncEvent({dataStartIndex:T,dataEndIndex:A})}}),xe(S,"handleMouseEnter",function(w){var T=S.getMouseInfo(w);if(T){var A=Z(Z({},T),{},{isTooltipActive:!0});S.setState(A),S.triggerSyncEvent(A);var C=S.props.onMouseEnter;Ce(C)&&C(A,w)}}),xe(S,"triggeredAfterMouseMove",function(w){var T=S.getMouseInfo(w),A=T?Z(Z({},T),{},{isTooltipActive:!0}):{isTooltipActive:!1};S.setState(A),S.triggerSyncEvent(A);var C=S.props.onMouseMove;Ce(C)&&C(A,w)}),xe(S,"handleItemMouseEnter",function(w){S.setState(function(){return{isTooltipActive:!0,activeItem:w,activePayload:w.tooltipPayload,activeCoordinate:w.tooltipPosition||{x:w.cx,y:w.cy}}})}),xe(S,"handleItemMouseLeave",function(){S.setState(function(){return{isTooltipActive:!1}})}),xe(S,"handleMouseMove",function(w){w.persist(),S.throttleTriggeredAfterMouseMove(w)}),xe(S,"handleMouseLeave",function(w){S.throttleTriggeredAfterMouseMove.cancel();var T={isTooltipActive:!1};S.setState(T),S.triggerSyncEvent(T);var A=S.props.onMouseLeave;Ce(A)&&A(T,w)}),xe(S,"handleOuterEvent",function(w){var T=WFe(w),A=Cs(S.props,"".concat(T));if(T&&Ce(A)){var C,P;/.*touch.*/i.test(T)?P=S.getMouseInfo(w.changedTouches[0]):P=S.getMouseInfo(w),A((C=P)!==null&&C!==void 0?C:{},w)}}),xe(S,"handleClick",function(w){var T=S.getMouseInfo(w);if(T){var A=Z(Z({},T),{},{isTooltipActive:!0});S.setState(A),S.triggerSyncEvent(A);var C=S.props.onClick;Ce(C)&&C(A,w)}}),xe(S,"handleMouseDown",function(w){var T=S.props.onMouseDown;if(Ce(T)){var A=S.getMouseInfo(w);T(A,w)}}),xe(S,"handleMouseUp",function(w){var T=S.props.onMouseUp;if(Ce(T)){var A=S.getMouseInfo(w);T(A,w)}}),xe(S,"handleTouchMove",function(w){w.changedTouches!=null&&w.changedTouches.length>0&&S.throttleTriggeredAfterMouseMove(w.changedTouches[0])}),xe(S,"handleTouchStart",function(w){w.changedTouches!=null&&w.changedTouches.length>0&&S.handleMouseDown(w.changedTouches[0])}),xe(S,"handleTouchEnd",function(w){w.changedTouches!=null&&w.changedTouches.length>0&&S.handleMouseUp(w.changedTouches[0])}),xe(S,"handleDoubleClick",function(w){var T=S.props.onDoubleClick;if(Ce(T)){var A=S.getMouseInfo(w);T(A,w)}}),xe(S,"handleContextMenu",function(w){var T=S.props.onContextMenu;if(Ce(T)){var A=S.getMouseInfo(w);T(A,w)}}),xe(S,"triggerSyncEvent",function(w){S.props.syncId!==void 0&&UP.emit(zP,S.props.syncId,w,S.eventEmitterSymbol)}),xe(S,"applySyncEvent",function(w){var T=S.props,A=T.layout,C=T.syncMethod,P=S.state.updateId,I=w.dataStartIndex,M=w.dataEndIndex;if(w.dataStartIndex!==void 0||w.dataEndIndex!==void 0)S.setState(Z({dataStartIndex:I,dataEndIndex:M},f({props:S.props,dataStartIndex:I,dataEndIndex:M,updateId:P},S.state)));else if(w.activeTooltipIndex!==void 0){var N=w.chartX,k=w.chartY,V=w.activeTooltipIndex,B=S.state,R=B.offset,L=B.tooltipTicks;if(!R)return;if(typeof C=="function")V=C(L,w);else if(C==="value"){V=-1;for(var D=0;D<L.length;D++)if(L[D].value===w.activeLabel){V=D;break}}var F=Z(Z({},R),{},{x:R.left,y:R.top}),j=Math.min(N,F.x+F.width),z=Math.min(k,F.y+F.height),$=L[V]&&L[V].value,H=LD(S.state,S.props.data,V),G=L[V]?{x:A==="horizontal"?L[V].coordinate:j,y:A==="horizontal"?z:L[V].coordinate}:Mee;S.setState(Z(Z({},w),{},{activeLabel:$,activeCoordinate:G,activePayload:H,activeTooltipIndex:V}))}else S.setState(w)}),xe(S,"renderCursor",function(w){var T,A=S.state,C=A.isTooltipActive,P=A.activeCoordinate,I=A.activePayload,M=A.offset,N=A.activeTooltipIndex,k=A.tooltipAxisBandSize,V=S.getTooltipEventType(),B=(T=w.props.active)!==null&&T!==void 0?T:C,R=S.props.layout,L=w.key||"_recharts-cursor";return U.createElement(Itt,{key:L,activeCoordinate:P,activePayload:I,activeTooltipIndex:N,chartName:t,element:w,isActive:B,layout:R,offset:M,tooltipAxisBandSize:k,tooltipEventType:V})}),xe(S,"renderPolarAxis",function(w,T,A){var C=Cs(w,"type.axisType"),P=Cs(S.state,"".concat(C,"Map")),I=w.type.defaultProps,M=I!==void 0?Z(Z({},I),w.props):w.props,N=P&&P[M["".concat(C,"Id")]];return E.cloneElement(w,Z(Z({},N),{},{className:Re(C,N.className),key:w.key||"".concat(T,"-").concat(A),ticks:Mu(N,!0)}))}),xe(S,"renderPolarGrid",function(w){var T=w.props,A=T.radialLines,C=T.polarAngles,P=T.polarRadius,I=S.state,M=I.radiusAxisMap,N=I.angleAxisMap,k=Od(M),V=Od(N),B=V.cx,R=V.cy,L=V.innerRadius,D=V.outerRadius;return E.cloneElement(w,{polarAngles:Array.isArray(C)?C:Mu(V,!0).map(function(F){return F.coordinate}),polarRadius:Array.isArray(P)?P:Mu(k,!0).map(function(F){return F.coordinate}),cx:B,cy:R,innerRadius:L,outerRadius:D,key:w.key||"polar-grid",radialLines:A})}),xe(S,"renderLegend",function(){var w=S.state.formattedGraphicalItems,T=S.props,A=T.children,C=T.width,P=T.height,I=S.props.margin||{},M=C-(I.left||0)-(I.right||0),N=lJ({children:A,formattedGraphicalItems:w,legendWidth:M,legendContent:c});if(!N)return null;var k=N.item,V=cH(N,Mtt);return E.cloneElement(k,Z(Z({},V),{},{chartWidth:C,chartHeight:P,margin:I,onBBoxUpdate:S.handleLegendBBoxUpdate}))}),xe(S,"renderTooltip",function(){var w,T=S.props,A=T.children,C=T.accessibilityLayer,P=_s(A,va);if(!P)return null;var I=S.state,M=I.isTooltipActive,N=I.activeCoordinate,k=I.activePayload,V=I.activeLabel,B=I.offset,R=(w=P.props.active)!==null&&w!==void 0?w:M;return E.cloneElement(P,{viewBox:Z(Z({},B),{},{x:B.left,y:B.top}),active:R,label:V,payload:R?k:[],coordinate:N,accessibilityLayer:C})}),xe(S,"renderBrush",function(w){var T=S.props,A=T.margin,C=T.data,P=S.state,I=P.offset,M=P.dataStartIndex,N=P.dataEndIndex,k=P.updateId;return E.cloneElement(w,{key:w.key||"_recharts-brush",onChange:LS(S.handleBrushChange,w.props.onChange),data:C,x:oe(w.props.x)?w.props.x:I.left,y:oe(w.props.y)?w.props.y:I.top+I.height+I.brushBottom-(A.bottom||0),width:oe(w.props.width)?w.props.width:I.width,startIndex:M,endIndex:N,updateId:"brush-".concat(k)})}),xe(S,"renderReferenceElement",function(w,T,A){if(!w)return null;var C=S,P=C.clipPathId,I=S.state,M=I.xAxisMap,N=I.yAxisMap,k=I.offset,V=w.type.defaultProps||{},B=w.props,R=B.xAxisId,L=R===void 0?V.xAxisId:R,D=B.yAxisId,F=D===void 0?V.yAxisId:D;return E.cloneElement(w,{key:w.key||"".concat(T,"-").concat(A),xAxis:M[L],yAxis:N[F],viewBox:{x:k.left,y:k.top,width:k.width,height:k.height},clipPathId:P})}),xe(S,"renderActivePoints",function(w){var T=w.item,A=w.activePoint,C=w.basePoint,P=w.childIndex,I=w.isRange,M=[],N=T.props.key,k=T.item.type.defaultProps!==void 0?Z(Z({},T.item.type.defaultProps),T.item.props):T.item.props,V=k.activeDot,B=k.dataKey,R=Z(Z({index:P,dataKey:B,cx:A.x,cy:A.y,r:4,fill:uk(T.item),strokeWidth:2,stroke:"#fff",payload:A.payload,value:A.value},Se(V,!1)),Jb(V));return M.push(_.renderActiveDot(V,R,"".concat(N,"-activePoint-").concat(P))),C?M.push(_.renderActiveDot(V,Z(Z({},R),{},{cx:C.x,cy:C.y}),"".concat(N,"-basePoint-").concat(P))):I&&M.push(null),M}),xe(S,"renderGraphicChild",function(w,T,A){var C=S.filterFormatItem(w,T,A);if(!C)return null;var P=S.getTooltipEventType(),I=S.state,M=I.isTooltipActive,N=I.tooltipAxis,k=I.activeTooltipIndex,V=I.activeLabel,B=S.props.children,R=_s(B,va),L=C.props,D=L.points,F=L.isRange,j=L.baseLine,z=C.item.type.defaultProps!==void 0?Z(Z({},C.item.type.defaultProps),C.item.props):C.item.props,$=z.activeDot,H=z.hide,G=z.activeBar,Y=z.activeShape,W=!!(!H&&M&&R&&($||G||Y)),ie={};P!=="axis"&&R&&R.props.trigger==="click"?ie={onClick:LS(S.handleItemMouseEnter,w.props.onClick)}:P!=="axis"&&(ie={onMouseLeave:LS(S.handleItemMouseLeave,w.props.onMouseLeave),onMouseEnter:LS(S.handleItemMouseEnter,w.props.onMouseEnter)});var q=E.cloneElement(w,Z(Z({},C.props),ie));function K(Ci){return typeof N.dataKey=="function"?N.dataKey(Ci.payload):null}if(W)if(k>=0){var te,X;if(N.dataKey&&!N.allowDuplicatedCategory){var _e=typeof N.dataKey=="function"?K:"payload.".concat(N.dataKey.toString());te=Qb(D,_e,V),X=F&&j&&Qb(j,_e,V)}else te=D==null?void 0:D[k],X=F&&j&&j[k];if(Y||G){var pe=w.props.activeIndex!==void 0?w.props.activeIndex:k;return[E.cloneElement(w,Z(Z(Z({},C.props),ie),{},{activeIndex:pe})),null,null]}if(!Pe(te))return[q].concat(Jp(S.renderActivePoints({item:C,activePoint:te,basePoint:X,childIndex:k,isRange:F})))}else{var ze,Fe=(ze=S.getItemByXY(S.state.activeCoordinate))!==null&&ze!==void 0?ze:{graphicalItem:q},vt=Fe.graphicalItem,ne=vt.item,vi=ne===void 0?w:ne,pi=vt.childIndex,ni=Z(Z(Z({},C.props),ie),{},{activeIndex:pi});return[E.cloneElement(vi,ni),null,null]}return F?[q,null,null]:[q,null]}),xe(S,"renderCustomized",function(w,T,A){return E.cloneElement(w,Z(Z({key:"recharts-customized-".concat(A)},S.props),S.state))}),xe(S,"renderMap",{CartesianGrid:{handler:BS,once:!0},ReferenceArea:{handler:S.renderReferenceElement},ReferenceLine:{handler:BS},ReferenceDot:{handler:S.renderReferenceElement},XAxis:{handler:BS},YAxis:{handler:BS},Brush:{handler:S.renderBrush,once:!0},Bar:{handler:S.renderGraphicChild},Line:{handler:S.renderGraphicChild},Area:{handler:S.renderGraphicChild},Radar:{handler:S.renderGraphicChild},RadialBar:{handler:S.renderGraphicChild},Scatter:{handler:S.renderGraphicChild},Pie:{handler:S.renderGraphicChild},Funnel:{handler:S.renderGraphicChild},Tooltip:{handler:S.renderCursor,once:!0},PolarGrid:{handler:S.renderPolarGrid,once:!0},PolarAngleAxis:{handler:S.renderPolarAxis},PolarRadiusAxis:{handler:S.renderPolarAxis},Customized:{handler:S.renderCustomized}}),S.clipPathId="".concat((y=v.id)!==null&&y!==void 0?y:wm("recharts"),"-clip"),S.throttleTriggeredAfterMouseMove=oQ(S.triggeredAfterMouseMove,(x=v.throttleDelay)!==null&&x!==void 0?x:1e3/60),S.state={},S}return jtt(_,g),Btt(_,[{key:"componentDidMount",value:function(){var y,x;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(y=this.props.margin.left)!==null&&y!==void 0?y:0,top:(x=this.props.margin.top)!==null&&x!==void 0?x:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var y=this.props,x=y.children,S=y.data,w=y.height,T=y.layout,A=_s(x,va);if(A){var C=A.props.defaultIndex;if(!(typeof C!="number"||C<0||C>this.state.tooltipTicks.length-1)){var P=this.state.tooltipTicks[C]&&this.state.tooltipTicks[C].value,I=LD(this.state,S,C,P),M=this.state.tooltipTicks[C].coordinate,N=(this.state.offset.top+w)/2,k=T==="horizontal",V=k?{x:M,y:N}:{y:M,x:N},B=this.state.formattedGraphicalItems.find(function(L){var D=L.item;return D.type.name==="Scatter"});B&&(V=Z(Z({},V),B.props.points[C].tooltipPosition),I=B.props.points[C].tooltipPayload);var R={activeTooltipIndex:C,isTooltipActive:!0,activeLabel:P,activePayload:I,activeCoordinate:V};this.setState(R),this.renderCursor(A),this.accessibilityManager.setIndex(C)}}}},{key:"getSnapshotBeforeUpdate",value:function(y,x){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==x.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==y.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==y.margin){var S,w;this.accessibilityManager.setDetails({offset:{left:(S=this.props.margin.left)!==null&&S!==void 0?S:0,top:(w=this.props.margin.top)!==null&&w!==void 0?w:0}})}return null}},{key:"componentDidUpdate",value:function(y){lR([_s(y.children,va)],[_s(this.props.children,va)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var y=_s(this.props.children,va);if(y&&typeof y.props.shared=="boolean"){var x=y.props.shared?"axis":"item";return o.indexOf(x)>=0?x:n}return n}},{key:"getMouseInfo",value:function(y){if(!this.container)return null;var x=this.container,S=x.getBoundingClientRect(),w=SWe(S),T={chartX:Math.round(y.pageX-w.left),chartY:Math.round(y.pageY-w.top)},A=S.width/x.offsetWidth||1,C=this.inRange(T.chartX,T.chartY,A);if(!C)return null;var P=this.state,I=P.xAxisMap,M=P.yAxisMap,N=this.getTooltipEventType(),k=hH(this.state,this.props.data,this.props.layout,C);if(N!=="axis"&&I&&M){var V=Od(I).scale,B=Od(M).scale,R=V&&V.invert?V.invert(T.chartX):null,L=B&&B.invert?B.invert(T.chartY):null;return Z(Z({},T),{},{xValue:R,yValue:L},k)}return k?Z(Z({},T),k):null}},{key:"inRange",value:function(y,x){var S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,w=this.props.layout,T=y/S,A=x/S;if(w==="horizontal"||w==="vertical"){var C=this.state.offset,P=T>=C.left&&T<=C.left+C.width&&A>=C.top&&A<=C.top+C.height;return P?{x:T,y:A}:null}var I=this.state,M=I.angleAxisMap,N=I.radiusAxisMap;if(M&&N){var k=Od(M);return B$({x:T,y:A},k)}return null}},{key:"parseEventsOfWrapper",value:function(){var y=this.props.children,x=this.getTooltipEventType(),S=_s(y,va),w={};S&&x==="axis"&&(S.props.trigger==="click"?w={onClick:this.handleClick}:w={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var T=Jb(this.props,this.handleOuterEvent);return Z(Z({},T),w)}},{key:"addListener",value:function(){UP.on(zP,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){UP.removeListener(zP,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(y,x,S){for(var w=this.state.formattedGraphicalItems,T=0,A=w.length;T<A;T++){var C=w[T];if(C.item===y||C.props.key===y.key||x===jo(C.item.type)&&S===C.childIndex)return C}return null}},{key:"renderClipPath",value:function(){var y=this.clipPathId,x=this.state.offset,S=x.left,w=x.top,T=x.height,A=x.width;return U.createElement("defs",null,U.createElement("clipPath",{id:y},U.createElement("rect",{x:S,y:w,height:T,width:A})))}},{key:"getXScales",value:function(){var y=this.state.xAxisMap;return y?Object.entries(y).reduce(function(x,S){var w=lH(S,2),T=w[0],A=w[1];return Z(Z({},x),{},xe({},T,A.scale))},{}):null}},{key:"getYScales",value:function(){var y=this.state.yAxisMap;return y?Object.entries(y).reduce(function(x,S){var w=lH(S,2),T=w[0],A=w[1];return Z(Z({},x),{},xe({},T,A.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(y){var x;return(x=this.state.xAxisMap)===null||x===void 0||(x=x[y])===null||x===void 0?void 0:x.scale}},{key:"getYScaleByAxisId",value:function(y){var x;return(x=this.state.yAxisMap)===null||x===void 0||(x=x[y])===null||x===void 0?void 0:x.scale}},{key:"getItemByXY",value:function(y){var x=this.state,S=x.formattedGraphicalItems,w=x.activeItem;if(S&&S.length)for(var T=0,A=S.length;T<A;T++){var C=S[T],P=C.props,I=C.item,M=I.type.defaultProps!==void 0?Z(Z({},I.type.defaultProps),I.props):I.props,N=jo(I.type);if(N==="Bar"){var k=(P.data||[]).find(function(L){return i7e(y,L)});if(k)return{graphicalItem:C,payload:k}}else if(N==="RadialBar"){var V=(P.data||[]).find(function(L){return B$(y,L)});if(V)return{graphicalItem:C,payload:V}}else if(KA(C,w)||ZA(C,w)||Gv(C,w)){var B=HZe({graphicalItem:C,activeTooltipItem:w,itemData:M.data}),R=M.activeIndex===void 0?B:M.activeIndex;return{graphicalItem:Z(Z({},C),{},{childIndex:R}),payload:Gv(C,w)?M.data[B]:C.props.data[B]}}}return null}},{key:"render",value:function(){var y=this;if(!P4(this))return null;var x=this.props,S=x.children,w=x.className,T=x.width,A=x.height,C=x.style,P=x.compact,I=x.title,M=x.desc,N=cH(x,Rtt),k=Se(N,!1);if(P)return U.createElement(W5,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},U.createElement(uR,rf({},k,{width:T,height:A,title:I,desc:M}),this.renderClipPath(),M4(S,this.renderMap)));if(this.props.accessibilityLayer){var V,B;k.tabIndex=(V=this.props.tabIndex)!==null&&V!==void 0?V:0,k.role=(B=this.props.role)!==null&&B!==void 0?B:"application",k.onKeyDown=function(L){y.accessibilityManager.keyboardEvent(L)},k.onFocus=function(){y.accessibilityManager.focus()}}var R=this.parseEventsOfWrapper();return U.createElement(W5,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},U.createElement("div",rf({className:Re("recharts-wrapper",w),style:Z({position:"relative",cursor:"default",width:T,height:A},C)},R,{ref:function(D){y.container=D}}),U.createElement(uR,rf({},k,{width:T,height:A,title:I,desc:M,style:qtt}),this.renderClipPath(),M4(S,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(E.Component);xe(p,"displayName",t),xe(p,"defaultProps",Z({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},h)),xe(p,"getDerivedStateFromProps",function(g,_){var v=g.dataKey,y=g.data,x=g.children,S=g.width,w=g.height,T=g.layout,A=g.stackOffset,C=g.margin,P=_.dataStartIndex,I=_.dataEndIndex;if(_.updateId===void 0){var M=dH(g);return Z(Z(Z({},M),{},{updateId:0},f(Z(Z({props:g},M),{},{updateId:0}),_)),{},{prevDataKey:v,prevData:y,prevWidth:S,prevHeight:w,prevLayout:T,prevStackOffset:A,prevMargin:C,prevChildren:x})}if(v!==_.prevDataKey||y!==_.prevData||S!==_.prevWidth||w!==_.prevHeight||T!==_.prevLayout||A!==_.prevStackOffset||!Ff(C,_.prevMargin)){var N=dH(g),k={chartX:_.chartX,chartY:_.chartY,isTooltipActive:_.isTooltipActive},V=Z(Z({},hH(_,y,T)),{},{updateId:_.updateId+1}),B=Z(Z(Z({},N),k),V);return Z(Z(Z({},B),f(Z({props:g},B),_)),{},{prevDataKey:v,prevData:y,prevWidth:S,prevHeight:w,prevLayout:T,prevStackOffset:A,prevMargin:C,prevChildren:x})}if(!lR(x,_.prevChildren)){var R,L,D,F,j=_s(x,Vp),z=j&&(R=(L=j.props)===null||L===void 0?void 0:L.startIndex)!==null&&R!==void 0?R:P,$=j&&(D=(F=j.props)===null||F===void 0?void 0:F.endIndex)!==null&&D!==void 0?D:I,H=z!==P||$!==I,G=!Pe(y),Y=G&&!H?_.updateId:_.updateId+1;return Z(Z({updateId:Y},f(Z(Z({props:g},_),{},{updateId:Y,dataStartIndex:z,dataEndIndex:$}),_)),{},{prevChildren:x,dataStartIndex:z,dataEndIndex:$})}return null}),xe(p,"renderActiveDot",function(g,_,v){var y;return E.isValidElement(g)?y=E.cloneElement(g,_):Ce(g)?y=g(_):y=U.createElement(GA,_),U.createElement(et,{className:"recharts-active-dot",key:v},y)});var m=E.forwardRef(function(_,v){return U.createElement(p,rf({},_,{ref:v}))});return m.displayName=p.displayName,m},sit=gk({chartName:"LineChart",GraphicalChild:Zy,axisComponents:[{axisType:"xAxis",AxisComp:Yp},{axisType:"yAxis",AxisComp:Zp}],formatAxisMap:qJ}),nit=gk({chartName:"BarChart",GraphicalChild:$h,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:Yp},{axisType:"yAxis",AxisComp:Zp}],formatAxisMap:qJ}),ait=gk({chartName:"PieChart",GraphicalChild:ul,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:YA},{axisType:"radiusAxis",AxisComp:XA}],formatAxisMap:g9e,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});const oit={light:"",dark:".dark"},Dee=E.createContext(null);function Lee(){const r=E.useContext(Dee);if(!r)throw new Error("useChart must be used within a <ChartContainer />");return r}const Sx=E.forwardRef(({id:r,className:e,children:t,config:i,...s},n)=>{const a=E.useId(),o=`chart-${r||a.replace(/:/g,"")}`;return b.jsx(Dee.Provider,{value:{config:i},children:b.jsxs("div",{"data-chart":o,ref:n,className:ye("flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",e),...s,children:[b.jsx(lit,{id:o,config:i}),b.jsx(vx,{children:t})]})})});Sx.displayName="Chart";const lit=({id:r,config:e})=>{const t=Object.entries(e).filter(([i,s])=>s.theme||s.color);return t.length?b.jsx("style",{dangerouslySetInnerHTML:{__html:Object.entries(oit).map(([i,s])=>`
${s} [data-chart=${r}] {
${t.map(([n,a])=>{var l;const o=((l=a.theme)==null?void 0:l[i])||a.color;return o?`  --color-${n}: ${o};`:null}).join(`
`)}
}
`).join(`
`)}}):null},jP=va,OD=E.forwardRef(({active:r,payload:e,className:t,indicator:i="dot",hideLabel:s=!1,hideIndicator:n=!1,label:a,labelFormatter:o,labelClassName:l,formatter:c,color:u,nameKey:h,labelKey:d},f)=>{const{config:p}=Lee(),m=E.useMemo(()=>{var S;if(s||!(e!=null&&e.length))return null;const[_]=e,v=`${d||_.dataKey||_.name||"value"}`,y=ND(p,_,v),x=!d&&typeof a=="string"?((S=p[a])==null?void 0:S.label)||a:y==null?void 0:y.label;return o?b.jsx("div",{className:ye("font-medium",l),children:o(x,e)}):x?b.jsx("div",{className:ye("font-medium",l),children:x}):null},[a,o,e,s,l,p,d]);if(!r||!(e!=null&&e.length))return null;const g=e.length===1&&i!=="dot";return b.jsxs("div",{ref:f,className:ye("grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",t),children:[g?null:m,b.jsx("div",{className:"grid gap-1.5",children:e.map((_,v)=>{const y=`${h||_.name||_.dataKey||"value"}`,x=ND(p,_,y),S=u||_.payload.fill||_.color;return b.jsx("div",{className:ye("flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",i==="dot"&&"items-center"),children:c&&(_==null?void 0:_.value)!==void 0&&_.name?c(_.value,_.name,_,v,_.payload):b.jsxs(b.Fragment,{children:[x!=null&&x.icon?b.jsx(x.icon,{}):!n&&b.jsx("div",{className:ye("shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",{"h-2.5 w-2.5":i==="dot","w-1":i==="line","w-0 border-[1.5px] border-dashed bg-transparent":i==="dashed","my-0.5":g&&i==="dashed"}),style:{"--color-bg":S,"--color-border":S}}),b.jsxs("div",{className:ye("flex flex-1 justify-between leading-none",g?"items-end":"items-center"),children:[b.jsxs("div",{className:"grid gap-1.5",children:[g?m:null,b.jsx("span",{className:"text-muted-foreground",children:(x==null?void 0:x.label)||_.name})]}),_.value&&b.jsx("span",{className:"font-mono font-medium tabular-nums text-foreground",children:_.value.toLocaleString()})]})]})},_.dataKey)})})]})});OD.displayName="ChartTooltip";const cit=E.forwardRef(({className:r,hideIcon:e=!1,payload:t,verticalAlign:i="bottom",nameKey:s},n)=>{const{config:a}=Lee();return t!=null&&t.length?b.jsx("div",{ref:n,className:ye("flex items-center justify-center gap-4",i==="top"?"pb-3":"pt-3",r),children:t.map(o=>{const l=`${s||o.dataKey||"value"}`,c=ND(a,o,l);return b.jsxs("div",{className:ye("flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"),children:[c!=null&&c.icon&&!e?b.jsx(c.icon,{}):b.jsx("div",{className:"h-2 w-2 shrink-0 rounded-[2px]",style:{backgroundColor:o.color}}),c==null?void 0:c.label]},o.value)})}):null});cit.displayName="ChartLegend";function ND(r,e,t){if(typeof e!="object"||e===null)return;const i="payload"in e&&typeof e.payload=="object"&&e.payload!==null?e.payload:void 0;let s=t;return t in e&&typeof e[t]=="string"?s=e[t]:i&&t in i&&typeof i[t]=="string"&&(s=i[t]),s in r?r[s]:r[t]}const uit=({restaurantId:r})=>{const[e,t]=E.useState(null),[i,s]=E.useState(!0),{toast:n}=Ar(),a=["#8884d8","#82ca9d","#ffc658","#ff7300","#8dd1e1","#d084d0"];E.useEffect(()=>{o()},[r]);const o=async()=>{try{const{data:l,error:c}=await nt.from("menu_items").select(`
          *,
          menu_item_reviews (
            rating,
            review_text
          )
        `).eq("restaurant_id",r);if(c)throw c;if(!l){t({totalMenuItems:0,activeMenuItems:0,totalReviews:0,averageRating:0,totalViews:0,categoryData:[],popularItems:[],dietaryStats:{vegetarian:0,vegan:0,glutenFree:0,nutFree:0},priceRanges:[],viewTrends:[]});return}const u=new Date;u.setDate(u.getDate()-7);const{data:h,error:d}=await nt.from("menu_item_views").select(`
          viewed_at,
          menu_item_id,
          menu_items!inner(restaurant_id)
        `).eq("menu_items.restaurant_id",r).gte("viewed_at",u.toISOString());if(d)throw d;const f=l.length,p=l.filter(C=>C.is_active).length,m=l.flatMap(C=>C.menu_item_reviews||[]),g=m.length,_=g>0?m.reduce((C,P)=>C+P.rating,0)/g:0,v=l.reduce((C,P)=>C+(P.view_count||0),0),y=new Map;l.forEach(C=>{y.has(C.category)||y.set(C.category,{category:C.category,items:[],totalPrice:0,totalRating:0,reviewCount:0,totalViews:0});const P=y.get(C.category);P.items.push(C),P.totalPrice+=C.price,P.totalViews+=C.view_count||0;const I=C.menu_item_reviews||[];I.length>0&&(P.totalRating+=I.reduce((M,N)=>M+N.rating,0),P.reviewCount+=I.length)});const x=Array.from(y.values()).map(C=>({category:C.category,count:C.items.length,avgPrice:C.totalPrice/C.items.length,avgRating:C.reviewCount>0?C.totalRating/C.reviewCount:0,totalViews:C.totalViews})),S=l.map(C=>{const P=C.menu_item_reviews||[];return{title:C.title,price:C.price,reviewCount:P.length,avgRating:P.length>0?P.reduce((I,M)=>I+M.rating,0)/P.length:0,viewCount:C.view_count||0}}).sort((C,P)=>P.viewCount-C.viewCount||P.reviewCount-C.reviewCount||P.avgRating-C.avgRating).slice(0,5),w={vegetarian:l.filter(C=>C.is_vegetarian).length,vegan:l.filter(C=>C.is_vegan).length,glutenFree:l.filter(C=>C.is_gluten_free).length,nutFree:l.filter(C=>C.is_nut_free).length},T=[{range:"$0-10",count:0},{range:"$10-20",count:0},{range:"$20-30",count:0},{range:"$30+",count:0}];l.forEach(C=>{const P=C.price;P<10?T[0].count++:P<20?T[1].count++:P<30?T[2].count++:T[3].count++});const A=[];for(let C=6;C>=0;C--){const P=new Date;P.setDate(P.getDate()-C);const I=P.toISOString().split("T")[0],M=(h||[]).filter(N=>N.viewed_at.startsWith(I)).length;A.push({date:P.toLocaleDateString("en-US",{month:"short",day:"numeric"}),views:M})}t({totalMenuItems:f,activeMenuItems:p,totalReviews:g,averageRating:_,totalViews:v,categoryData:x,popularItems:S,dietaryStats:w,priceRanges:T,viewTrends:A})}catch(l){n({title:"Error loading analytics",description:l.message,variant:"destructive"})}finally{s(!1)}};return i?b.jsx("div",{className:"space-y-6",children:b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[1,2,3,4].map(l=>b.jsx(Vt,{className:"animate-pulse",children:b.jsxs(jt,{className:"p-6",children:[b.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),b.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/2"})]})},l))})}):e?b.jsxs("div",{className:"space-y-6",children:[b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[b.jsx(Vt,{children:b.jsx(jt,{className:"p-6",children:b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{children:[b.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Items"}),b.jsx("p",{className:"text-2xl font-bold",children:e.totalMenuItems})]}),b.jsx(bf,{className:"h-8 w-8 text-blue-600"})]})})}),b.jsx(Vt,{children:b.jsx(jt,{className:"p-6",children:b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{children:[b.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Items"}),b.jsx("p",{className:"text-2xl font-bold text-green-600",children:e.activeMenuItems})]}),b.jsx(Ase,{className:"h-8 w-8 text-green-600"})]})})}),b.jsx(Vt,{children:b.jsx(jt,{className:"p-6",children:b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{children:[b.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Views"}),b.jsx("p",{className:"text-2xl font-bold text-purple-600",children:e.totalViews})]}),b.jsx(bf,{className:"h-8 w-8 text-purple-600"})]})})}),b.jsx(Vt,{children:b.jsx(jt,{className:"p-6",children:b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{children:[b.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Reviews"}),b.jsx("p",{className:"text-2xl font-bold",children:e.totalReviews})]}),b.jsx(Ise,{className:"h-8 w-8 text-indigo-600"})]})})}),b.jsx(Vt,{children:b.jsx(jt,{className:"p-6",children:b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{children:[b.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Avg Rating"}),b.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:e.averageRating.toFixed(1)})]}),b.jsx(ip,{className:"h-8 w-8 text-yellow-600"})]})})})]}),b.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[b.jsxs(Vt,{children:[b.jsxs(Dr,{children:[b.jsx(Lr,{children:"View Trends (Last 7 Days)"}),b.jsx(Or,{children:"Daily menu item views"})]}),b.jsx(jt,{children:b.jsx(Sx,{config:{},className:"h-[300px]",children:b.jsx(vx,{width:"100%",height:"100%",children:b.jsxs(sit,{data:e.viewTrends,children:[b.jsx(Yp,{dataKey:"date"}),b.jsx(Zp,{}),b.jsx(jP,{content:b.jsx(OD,{}),formatter:l=>[l,"Views"]}),b.jsx(Zy,{dataKey:"views",stroke:"#8884d8",strokeWidth:2})]})})})})]}),b.jsxs(Vt,{children:[b.jsxs(Dr,{children:[b.jsx(Lr,{children:"Category Views"}),b.jsx(Or,{children:"Total views by category"})]}),b.jsx(jt,{children:b.jsx(Sx,{config:{},className:"h-[300px]",children:b.jsx(vx,{width:"100%",height:"100%",children:b.jsxs(nit,{data:e.categoryData,children:[b.jsx(Yp,{dataKey:"category"}),b.jsx(Zp,{}),b.jsx(jP,{content:b.jsx(OD,{}),formatter:(l,c)=>[l,c==="totalViews"?"Views":c]}),b.jsx($h,{dataKey:"totalViews",fill:"#82ca9d"})]})})})})]})]}),b.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[b.jsxs(Vt,{children:[b.jsxs(Dr,{children:[b.jsx(Lr,{children:"Most Popular Items"}),b.jsx(Or,{children:"Based on views, reviews and ratings"})]}),b.jsx(jt,{children:b.jsx("div",{className:"space-y-4",children:e.popularItems.map((l,c)=>b.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[b.jsxs("div",{className:"flex-1",children:[b.jsx("p",{className:"font-medium",children:l.title}),b.jsxs("p",{className:"text-sm text-gray-600",children:["$",l.price.toFixed(2)]})]}),b.jsxs("div",{className:"text-right",children:[b.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[b.jsx(bf,{className:"h-4 w-4 text-purple-500"}),b.jsx("span",{className:"text-sm font-medium",children:l.viewCount})]}),b.jsxs("div",{className:"flex items-center gap-1",children:[b.jsx(ip,{className:"h-4 w-4 text-yellow-500"}),b.jsx("span",{className:"text-sm",children:l.avgRating.toFixed(1)})]}),b.jsxs("p",{className:"text-xs text-gray-500",children:[l.reviewCount," reviews"]})]})]},c))})})]}),b.jsxs(Vt,{children:[b.jsxs(Dr,{children:[b.jsx(Lr,{children:"Price Distribution"}),b.jsx(Or,{children:"Items by price range"})]}),b.jsx(jt,{children:b.jsx(Sx,{config:{},className:"h-[300px]",children:b.jsx(vx,{width:"100%",height:"100%",children:b.jsxs(ait,{children:[b.jsx(ul,{data:e.priceRanges,cx:"50%",cy:"50%",labelLine:!1,label:({range:l,count:c})=>`${l}: ${c}`,outerRadius:80,fill:"#8884d8",dataKey:"count",children:e.priceRanges.map((l,c)=>b.jsx(LA,{fill:a[c%a.length]},`cell-${c}`))}),b.jsx(jP,{})]})})})})]})]}),b.jsxs(Vt,{children:[b.jsxs(Dr,{children:[b.jsx(Lr,{children:"Dietary Options"}),b.jsx(Or,{children:"Special dietary accommodations"})]}),b.jsx(jt,{children:b.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsx("span",{className:"text-sm font-medium",children:"Vegetarian"}),b.jsx("span",{className:"text-2xl font-bold text-green-600",children:e.dietaryStats.vegetarian})]}),b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsx("span",{className:"text-sm font-medium",children:"Vegan"}),b.jsx("span",{className:"text-2xl font-bold text-green-500",children:e.dietaryStats.vegan})]}),b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsx("span",{className:"text-sm font-medium",children:"Gluten Free"}),b.jsx("span",{className:"text-2xl font-bold text-blue-600",children:e.dietaryStats.glutenFree})]}),b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsx("span",{className:"text-sm font-medium",children:"Nut Free"}),b.jsx("span",{className:"text-2xl font-bold text-orange-600",children:e.dietaryStats.nutFree})]})]})})]}),b.jsxs(Vt,{children:[b.jsxs(Dr,{children:[b.jsx(Lr,{children:"Category Insights"}),b.jsx(Or,{children:"Performance metrics by category"})]}),b.jsx(jt,{children:b.jsx("div",{className:"overflow-x-auto",children:b.jsxs("table",{className:"w-full",children:[b.jsx("thead",{children:b.jsxs("tr",{className:"border-b",children:[b.jsx("th",{className:"text-left p-2",children:"Category"}),b.jsx("th",{className:"text-right p-2",children:"Items"}),b.jsx("th",{className:"text-right p-2",children:"Total Views"}),b.jsx("th",{className:"text-right p-2",children:"Avg Price"}),b.jsx("th",{className:"text-right p-2",children:"Avg Rating"})]})}),b.jsx("tbody",{children:e.categoryData.map((l,c)=>b.jsxs("tr",{className:"border-b",children:[b.jsx("td",{className:"p-2 font-medium",children:l.category}),b.jsx("td",{className:"p-2 text-right",children:l.count}),b.jsx("td",{className:"p-2 text-right",children:l.totalViews}),b.jsxs("td",{className:"p-2 text-right",children:["$",l.avgPrice.toFixed(2)]}),b.jsx("td",{className:"p-2 text-right",children:l.avgRating>0?l.avgRating.toFixed(1):"N/A"})]},c))})]})})})]})]}):b.jsx(Vt,{children:b.jsx(jt,{className:"p-6",children:b.jsx("p",{className:"text-gray-500",children:"No analytics data available."})})})},hit=({restaurantId:r})=>b.jsxs(Vt,{children:[b.jsxs(Dr,{children:[b.jsx(Lr,{children:"Analytics Dashboard"}),b.jsx(Or,{children:"Insights into your menu performance and customer preferences"})]}),b.jsx(jt,{children:b.jsx(uit,{restaurantId:r})})]}),dit=({onSignOut:r})=>{const[e,t]=E.useState(null),[i,s]=E.useState([]),[n,a]=E.useState(!1),[o,l]=E.useState(null),[c,u]=E.useState("menu"),[h,d]=E.useState(!0),{toast:f}=Ar();E.useEffect(()=>{p()},[]);const p=async()=>{try{const{data:S,error:w}=await nt.from("restaurants").select("*").single();if(w&&w.code!=="PGRST116")throw w;if(t(S),S){const{data:T,error:A}=await nt.from("menu_items").select("*").eq("restaurant_id",S.id).order("sort_order",{ascending:!0});if(A)throw A;s(T||[])}}catch(S){f({title:"Error loading data",description:S.message,variant:"destructive"})}finally{d(!1)}},m=S=>{t(S),p()},g=()=>{a(!1),l(null),p()},_=async()=>{await nt.auth.signOut(),r()},v=()=>{a(!0)},y=S=>{l(S),a(!0)},x=S=>{s(S)};return h?b.jsx("div",{className:"min-h-screen flex items-center justify-center",children:b.jsxs("div",{className:"text-center",children:[b.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto"}),b.jsx("p",{className:"mt-4 text-gray-600",children:"Loading your dashboard..."})]})}):b.jsxs("div",{className:"min-h-screen bg-gray-50",children:[b.jsx(uLe,{onSignOut:_}),b.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e?b.jsxs("div",{className:"space-y-8",children:[b.jsx(KV,{restaurant:e,onUpdate:m}),b.jsx(SDe,{restaurant:e,onUpdate:m}),b.jsx(cLe,{restaurantId:e.id,restaurantName:e.name}),b.jsx(hLe,{activeTab:c,onTabChange:u}),c==="menu"?b.jsx(t3e,{menuItems:i,onAddMenuItem:v,onEditMenuItem:y,onDeleteMenuItem:p,onReorderItems:x}):b.jsx(hit,{restaurantId:e.id})]}):b.jsx(KV,{restaurant:null,onUpdate:m}),n&&b.jsx(xDe,{restaurantId:(e==null?void 0:e.id)||"",menuItem:o,onSave:g,onCancel:()=>{a(!1),l(null)}})]})]})},fit=()=>{const[r,e]=E.useState(null),[t,i]=E.useState(!0);E.useEffect(()=>{(async()=>{const{data:{user:o}}=await nt.auth.getUser();e(o),i(!1)})();const{data:{subscription:a}}=nt.auth.onAuthStateChange((o,l)=>{e((l==null?void 0:l.user)??null)});return()=>a.unsubscribe()},[]);const s=()=>{e(null)};return t?b.jsx("div",{className:"min-h-screen flex items-center justify-center",children:b.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):r?b.jsx(dit,{onSignOut:s}):b.jsx(zRe,{onAuthSuccess:n=>e(n)})},pit=()=>{const{id:r}=Ole(),e=d6(),{toast:t}=Ar(),[i,s]=E.useState(null),[n,a]=E.useState(!0);return E.useEffect(()=>{(async()=>{if(r)try{const{data:l,error:c}=await nt.from("menu_items").select("id, title, description, price, model_url, image_url").eq("id",r).single();if(c)throw c;s(l)}catch(l){console.error("Error fetching menu item:",l),t({title:"Error",description:"Failed to load menu item",variant:"destructive"}),e("/")}finally{a(!1)}})()},[r,e,t]),n?b.jsx(yO,{}):i?b.jsx("div",{className:"min-h-screen bg-background",children:b.jsxs("div",{className:"container mx-auto px-4 py-8",children:[b.jsxs(tt,{onClick:()=>e("/"),variant:"outline",className:"mb-6",children:[b.jsx(Gx,{className:"w-4 h-4 mr-2"}),"Back to Menu"]}),b.jsxs("div",{className:"max-w-4xl mx-auto",children:[b.jsxs("div",{className:"mb-6",children:[b.jsx("h1",{className:"text-3xl font-bold mb-2",children:i.title}),i.description&&b.jsx("p",{className:"text-lg text-muted-foreground mb-2",children:i.description}),b.jsxs("p",{className:"text-2xl font-bold text-primary",children:["$",i.price.toFixed(2)]})]}),b.jsxs("div",{className:"bg-card rounded-lg p-6 shadow-lg",children:[b.jsx("h2",{className:"text-xl font-semibold mb-4",children:"3D Model Viewer"}),b.jsx("div",{className:"w-full h-96 rounded-lg overflow-hidden",children:i.model_url?b.jsx(qY,{splatUrl:i.model_url,className:"h-full"}):b.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center rounded-lg",children:b.jsxs("div",{className:"text-center",children:[b.jsx("p",{className:"text-muted-foreground",children:"No 3D model available"}),b.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"This item doesn't have a 3D model to display"})]})})})]})]})]})}):b.jsx("div",{className:"min-h-screen flex items-center justify-center",children:b.jsxs("div",{className:"text-center",children:[b.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Menu item not found"}),b.jsxs(tt,{onClick:()=>e("/"),children:[b.jsx(Gx,{className:"w-4 h-4 mr-2"}),"Back to Menu"]})]})})},mit=()=>{const r=cy();return E.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",r.pathname)},[r.pathname]),b.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:b.jsxs("div",{className:"text-center",children:[b.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),b.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),b.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})},git=new ile,_it=()=>b.jsx(sle,{client:git,children:b.jsx(gne,{attribute:"class",defaultTheme:"system",children:b.jsxs(Doe,{children:[b.jsx(fne,{}),b.jsx(qne,{}),b.jsx(rce,{children:b.jsxs(Kle,{children:[b.jsx(Ag,{path:"/",element:b.jsx(URe,{})}),b.jsx(Ag,{path:"/admin",element:b.jsx(fit,{})}),b.jsx(Ag,{path:"/menu-item/:id",element:b.jsx(pit,{})}),b.jsx(Ag,{path:"*",element:b.jsx(mit,{})})]})})]})})});NW(document.getElementById("root")).render(b.jsx(_it,{}));export{Fee as g};
